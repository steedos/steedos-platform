{"version":3,"sources":["meteor://ğŸ’»app/packages/steedos_audit/lib/audit_records.coffee","meteor://ğŸ’»app/lib/audit_records.coffee","meteor://ğŸ’»app/packages/steedos_audit/models/audit_records.coffee","meteor://ğŸ’»app/models/audit_records.coffee","meteor://ğŸ’»app/packages/steedos_audit/models/audit_login.coffee"],"names":["getLookupFieldModifier","getLookupFieldValue","insertRecord","transformFieldValue","updateRecord","Creator","AuditRecords","reference_to","value","space_id","name_field_key","obj","previous_ids","reference_to_object","values","_","isArray","isObject","o","ids","getObject","NAME_FIELD_KEY","getCollection","find","_id","$in","fields","fetch","getOrderlySetByIds","pluck","join","field","isFunction","optionsFunction","isString","options","selected_value","utcOffset","isNull","isUndefined","type","moment","utc","format","isBoolean","map","option","contains","label","compact","userId","object_name","new_doc","collection","doc","record_id","space","_makeNewID","field_name","related_to","insert","previous_doc","modifier","modifierSet","modifierUnset","ref","$set","$unset","each","v","k","db_new_value","db_previous_value","new_value","previous_value","toString","JSON","stringify","name","add","action","Objects","audit_records","icon","index","object","enable_audit","push","filterable","is_name","created","required","is_wide","created_by","list_views","all","filter_scope","columns","filter_fields","recent","permission_set","user","allowCreate","allowDelete","allowEdit","allowRead","modifyAllRecords","viewAllRecords","admin","audit_login","username","login_time","source_ip","location","login_type","status","browser","platform","application","client_version","api_type","api_version","login_url"],"mappings":"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","file":"/packages/steedos_audit.js","sourcesContent":["Creator.AuditRecords = {}\r\n\r\ngetLookupFieldValue = (reference_to, value, space_id)->\r\n\tif _.isArray(reference_to) && _.isObject(value)\r\n\t\treference_to = value.o\r\n\t\tprevious_ids = value.ids\r\n\tif !_.isArray(previous_ids)\r\n\t\tprevious_ids = if value then [value] else []\r\n\treference_to_object = Creator.getObject(reference_to, space_id)\r\n\tname_field_key = reference_to_object.NAME_FIELD_KEY\r\n\tvalues = Creator.getCollection(reference_to, space_id).find({_id: {$in: previous_ids}}, {fields: {_id:1, \"#{name_field_key}\": 1}}).fetch()\r\n\tvalues = Creator.getOrderlySetByIds(values, previous_ids)\r\n\treturn (_.pluck values, name_field_key).join(',')\r\n\r\ngetLookupFieldModifier = (field, value, space_id)->\r\n\treference_to = field.reference_to\r\n\tif _.isFunction(reference_to)\r\n\t\treference_to = reference_to()\r\n\tif _.isFunction(field.optionsFunction)\r\n\t\tif _.isString(reference_to)\r\n\t\t\tif value\r\n\t\t\t\treturn getLookupFieldValue(reference_to, value, space_id)\r\n\t\telse\r\n\t\t\treturn ''\r\n\telse\r\n\t\treturn getLookupFieldValue(reference_to, value, space_id)\r\n\r\n###\r\nå­—æ®µå€¼è½¬æ¢è§„åˆ™:\r\n1 æ—¥æœŸ æ ¼å¼å­˜å‚¨ä¸º (String): 2018-01-02\r\n2 æ—¶é—´ æ ¼å¼å­˜å‚¨ä¸º (String): 2018-01-02 23:12\r\n2 lookup å’Œä¸‹æ‹‰æ¡†ï¼Œéƒ½æ˜¯å¯¹åº”çš„æ˜¾ç¤ºåç§° (name | label)\r\n3 boolean å°±å­˜æ˜¯/å¦\r\n4 å¤šè¡Œæ–‡æœ¬\\grid\\lookupæœ‰optionsFunctionå¹¶ä¸”æ²¡æœ‰reference_toæ—¶ ä¸è®°å½•æ–°æ—§å€¼, åªè®°å½•ä¿®æ”¹æ—¶é—´, ä¿®æ”¹äºº, ä¿®æ”¹çš„å­—æ®µæ˜¾ç¤ºå\r\n###\r\ntransformFieldValue = (field, value, options)->\r\n\r\n\tif _.isNull(value) || _.isUndefined(value)\r\n\t\treturn\r\n\r\n\tutcOffset = options.utcOffset\r\n\tspace_id = options.space_id\r\n\r\n\tswitch field.type\r\n\t\twhen 'date'\r\n\t\t\treturn moment.utc(value).format('YYYY-MM-DD')\r\n\t\twhen 'datetime'\r\n\t\t\treturn moment(value).utcOffset(utcOffset).format('YYYY-MM-DD HH:mm')\r\n\t\twhen 'boolean'\r\n\t\t\tif _.isBoolean(value)\r\n\t\t\t\tif value\r\n\t\t\t\t\treturn 'æ˜¯'\r\n\t\t\t\telse\r\n\t\t\t\t\treturn 'å¦'\r\n\t\twhen 'select'\r\n\t\t\tif _.isString(value)\r\n\t\t\t\tvalue = [value]\r\n\t\t\tselected_value = _.map field.options, (option)->\r\n\t\t\t\tif _.contains(value, option.value)\r\n\t\t\t\t\treturn option.label\r\n\t\t\treturn _.compact(selected_value).join(',')\r\n\t\twhen 'checkbox'\r\n\t\t\tif _.isString(value)\r\n\t\t\t\tvalue = [value]\r\n\t\t\tselected_value = _.map field.options, (option)->\r\n\t\t\t\tif _.contains(value, option.value)\r\n\t\t\t\t\treturn option.label\r\n\t\t\treturn _.compact(selected_value).join(',')\r\n\t\twhen 'lookup'\r\n\t\t\treturn getLookupFieldModifier(field, value, space_id)\r\n\t\twhen 'master_detail'\r\n\t\t\treturn getLookupFieldModifier(field, value, space_id)\r\n\t\twhen 'textarea'\r\n\t\t\treturn ''\r\n\t\twhen 'code'\r\n\t\t\treturn ''\r\n\t\twhen 'html'\r\n\t\t\treturn ''\r\n\t\twhen 'markdown'\r\n\t\t\treturn ''\r\n\t\twhen 'grid'\r\n\t\t\treturn ''\r\n\t\telse\r\n\t\t\treturn value\r\n\r\n# æ–°å»ºæ—¶, ä¸è®°å½•æ˜ç»†\r\ninsertRecord = (userId, object_name, new_doc)->\r\n#\tif !userId\r\n#\t\treturn\r\n\r\n\tcollection = Creator.getCollection(\"audit_records\")\r\n\tspace_id = new_doc.space\r\n\trecord_id = new_doc._id\r\n\tdoc = {\r\n\t\t_id: collection._makeNewID()\r\n\t\tspace: space_id\r\n\t\tfield_name: \"å·²åˆ›å»ºã€‚\"\r\n\t\trelated_to: {\r\n\t\t\to: object_name\r\n\t\t\tids: [record_id]\r\n\t\t}\r\n\t}\r\n\tcollection.insert doc\r\n\r\n# ä¿®æ”¹æ—¶, è®°å½•å­—æ®µå˜æ›´æ˜ç»†\r\nupdateRecord = (userId, object_name, new_doc, previous_doc, modifier)->\r\n#\tif !userId\r\n#\t\treturn\r\n\r\n\tspace_id = new_doc.space\r\n\trecord_id = new_doc._id\r\n\r\n\tfields = Creator.getObject(object_name, space_id)?.fields\r\n\r\n\tmodifierSet = modifier.$set\r\n\r\n\tmodifierUnset = modifier.$unset\r\n\r\n\t### TODO utcOffset åº”è¯¥æ¥è‡ªæ•°æ®åº“,å¾… #984 å¤„ç†å è°ƒæ•´\r\n\r\n    utcOffset = Creator.getCollection(\"users\").findOne({_id: userId})?.utcOffset\r\n\r\n\tif !_.isNumber(utcOffset)\r\n\t\tutcOffset = 8\r\n\t###\r\n\r\n\tutcOffset = 8\r\n\r\n\toptions = {utcOffset: utcOffset, space_id: space_id}\r\n\r\n\t_.each modifierSet, (v, k)->\r\n\t\tfield = fields?[k]\r\n\t\tprevious_value = previous_doc[k]\r\n\t\tnew_value = v\r\n\r\n\t\tdb_previous_value = null\r\n\t\tdb_new_value = null\r\n\r\n\t\tswitch field.type\r\n\t\t\twhen 'date'\r\n\t\t\t\tif new_value?.toString() != previous_value?.toString()\r\n\t\t\t\t\tif new_value\r\n\t\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\r\n\t\t\t\t\tif previous_value\r\n\t\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\r\n\t\t\twhen 'datetime'\r\n\t\t\t\tif new_value?.toString() != previous_value?.toString()\r\n\t\t\t\t\tif new_value\r\n\t\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\r\n\t\t\t\t\tif previous_value\r\n\t\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\r\n\t\t\twhen 'textarea'\r\n\t\t\t\tif previous_value != new_value\r\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\r\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\r\n\t\t\twhen 'code'\r\n\t\t\t\tif previous_value != new_value\r\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\r\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\r\n\t\t\twhen 'html'\r\n\t\t\t\tif previous_value != new_value\r\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\r\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\r\n\t\t\twhen 'markdown'\r\n\t\t\t\tif previous_value != new_value\r\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\r\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\r\n\t\t\twhen 'grid'\r\n\t\t\t\tif JSON.stringify(previous_value) != JSON.stringify(new_value)\r\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\r\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\r\n\t\t\twhen 'boolean'\r\n\t\t\t\tif previous_value != new_value\r\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\r\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\r\n\t\t\twhen 'select'\r\n\t\t\t\tif previous_value?.toString() != new_value?.toString()\r\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\r\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\r\n\t\t\twhen 'checkbox'\r\n\t\t\t\tif previous_value?.toString() != new_value?.toString()\r\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\r\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\r\n\t\t\twhen 'lookup'\r\n\t\t\t\tif JSON.stringify(previous_value) != JSON.stringify(new_value)\r\n\t\t\t\t\tif previous_value\r\n\t\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\r\n\t\t\t\t\tif new_value\r\n\t\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\r\n\t\t\twhen 'master_detail'\r\n\t\t\t\tif JSON.stringify(previous_value) != JSON.stringify(new_value)\r\n\t\t\t\t\tif previous_value\r\n\t\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\r\n\t\t\t\t\tif new_value\r\n\t\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\r\n\t\t\telse\r\n\t\t\t\tif new_value != previous_value\r\n\t\t\t\t\tdb_previous_value = previous_value\r\n\t\t\t\t\tdb_new_value = new_value\r\n\r\n\r\n\t\tif db_new_value != null || db_previous_value != null\r\n\t\t\tcollection = Creator.getCollection(\"audit_records\")\r\n\t\t\tdoc = {\r\n\t\t\t\t_id: collection._makeNewID()\r\n\t\t\t\tspace: space_id\r\n\t\t\t\tfield_name: field.label || field.name\r\n\t\t\t\tprevious_value: db_previous_value\r\n\t\t\t\tnew_value: db_new_value\r\n\t\t\t\trelated_to: {\r\n\t\t\t\t\to: object_name\r\n\t\t\t\t\tids: [record_id]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcollection.insert doc\r\n\r\n\t_.each modifierUnset, (v, k)->\r\n\t\tfield = fields?[k]\r\n\t\tprevious_value = previous_doc[k]\r\n\t\tif previous_value || _.isBoolean(previous_value)\r\n\t\t\tcollection = Creator.getCollection(\"audit_records\")\r\n\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\r\n\t\t\tdoc = {\r\n\t\t\t\t_id: collection._makeNewID()\r\n\t\t\t\tspace: space_id\r\n\t\t\t\tfield_name: field.label || field.name\r\n\t\t\t\tprevious_value: db_previous_value\r\n\t\t\t\trelated_to: {\r\n\t\t\t\t\to: object_name\r\n\t\t\t\t\tids: [record_id]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcollection.insert doc\r\n\r\nCreator.AuditRecords.add = (action, userId, object_name, new_doc, previous_doc, modifier)->\r\n\tif action == 'update'\r\n\t\tupdateRecord(userId, object_name, new_doc, previous_doc, modifier)\r\n\telse if action == 'insert'\r\n\t\tinsertRecord(userId, object_name, new_doc)\r\n","var getLookupFieldModifier, getLookupFieldValue, insertRecord, transformFieldValue, updateRecord;\n\nCreator.AuditRecords = {};\n\ngetLookupFieldValue = function(reference_to, value, space_id) {\n  var name_field_key, obj, previous_ids, reference_to_object, values;\n  if (_.isArray(reference_to) && _.isObject(value)) {\n    reference_to = value.o;\n    previous_ids = value.ids;\n  }\n  if (!_.isArray(previous_ids)) {\n    previous_ids = value ? [value] : [];\n  }\n  reference_to_object = Creator.getObject(reference_to, space_id);\n  name_field_key = reference_to_object.NAME_FIELD_KEY;\n  values = Creator.getCollection(reference_to, space_id).find({\n    _id: {\n      $in: previous_ids\n    }\n  }, {\n    fields: (\n      obj = {\n        _id: 1\n      },\n      obj[\"\" + name_field_key] = 1,\n      obj\n    )\n  }).fetch();\n  values = Creator.getOrderlySetByIds(values, previous_ids);\n  return (_.pluck(values, name_field_key)).join(',');\n};\n\ngetLookupFieldModifier = function(field, value, space_id) {\n  var reference_to;\n  reference_to = field.reference_to;\n  if (_.isFunction(reference_to)) {\n    reference_to = reference_to();\n  }\n  if (_.isFunction(field.optionsFunction)) {\n    if (_.isString(reference_to)) {\n      if (value) {\n        return getLookupFieldValue(reference_to, value, space_id);\n      }\n    } else {\n      return '';\n    }\n  } else {\n    return getLookupFieldValue(reference_to, value, space_id);\n  }\n};\n\n\n/*\nå­—æ®µå€¼è½¬æ¢è§„åˆ™:\n1 æ—¥æœŸ æ ¼å¼å­˜å‚¨ä¸º (String): 2018-01-02\n2 æ—¶é—´ æ ¼å¼å­˜å‚¨ä¸º (String): 2018-01-02 23:12\n2 lookup å’Œä¸‹æ‹‰æ¡†ï¼Œéƒ½æ˜¯å¯¹åº”çš„æ˜¾ç¤ºåç§° (name | label)\n3 boolean å°±å­˜æ˜¯/å¦\n4 å¤šè¡Œæ–‡æœ¬\\grid\\lookupæœ‰optionsFunctionå¹¶ä¸”æ²¡æœ‰reference_toæ—¶ ä¸è®°å½•æ–°æ—§å€¼, åªè®°å½•ä¿®æ”¹æ—¶é—´, ä¿®æ”¹äºº, ä¿®æ”¹çš„å­—æ®µæ˜¾ç¤ºå\n */\n\ntransformFieldValue = function(field, value, options) {\n  var selected_value, space_id, utcOffset;\n  if (_.isNull(value) || _.isUndefined(value)) {\n    return;\n  }\n  utcOffset = options.utcOffset;\n  space_id = options.space_id;\n  switch (field.type) {\n    case 'date':\n      return moment.utc(value).format('YYYY-MM-DD');\n    case 'datetime':\n      return moment(value).utcOffset(utcOffset).format('YYYY-MM-DD HH:mm');\n    case 'boolean':\n      if (_.isBoolean(value)) {\n        if (value) {\n          return 'æ˜¯';\n        } else {\n          return 'å¦';\n        }\n      }\n      break;\n    case 'select':\n      if (_.isString(value)) {\n        value = [value];\n      }\n      selected_value = _.map(field.options, function(option) {\n        if (_.contains(value, option.value)) {\n          return option.label;\n        }\n      });\n      return _.compact(selected_value).join(',');\n    case 'checkbox':\n      if (_.isString(value)) {\n        value = [value];\n      }\n      selected_value = _.map(field.options, function(option) {\n        if (_.contains(value, option.value)) {\n          return option.label;\n        }\n      });\n      return _.compact(selected_value).join(',');\n    case 'lookup':\n      return getLookupFieldModifier(field, value, space_id);\n    case 'master_detail':\n      return getLookupFieldModifier(field, value, space_id);\n    case 'textarea':\n      return '';\n    case 'code':\n      return '';\n    case 'html':\n      return '';\n    case 'markdown':\n      return '';\n    case 'grid':\n      return '';\n    default:\n      return value;\n  }\n};\n\ninsertRecord = function(userId, object_name, new_doc) {\n  var collection, doc, record_id, space_id;\n  collection = Creator.getCollection(\"audit_records\");\n  space_id = new_doc.space;\n  record_id = new_doc._id;\n  doc = {\n    _id: collection._makeNewID(),\n    space: space_id,\n    field_name: \"å·²åˆ›å»ºã€‚\",\n    related_to: {\n      o: object_name,\n      ids: [record_id]\n    }\n  };\n  return collection.insert(doc);\n};\n\nupdateRecord = function(userId, object_name, new_doc, previous_doc, modifier) {\n  var fields, modifierSet, modifierUnset, options, record_id, ref, space_id, utcOffset;\n  space_id = new_doc.space;\n  record_id = new_doc._id;\n  fields = (ref = Creator.getObject(object_name, space_id)) != null ? ref.fields : void 0;\n  modifierSet = modifier.$set;\n  modifierUnset = modifier.$unset;\n\n  /* TODO utcOffset åº”è¯¥æ¥è‡ªæ•°æ®åº“,å¾… #984 å¤„ç†å è°ƒæ•´\n  \n     utcOffset = Creator.getCollection(\"users\").findOne({_id: userId})?.utcOffset\n  \n  \tif !_.isNumber(utcOffset)\n  \t\tutcOffset = 8\n   */\n  utcOffset = 8;\n  options = {\n    utcOffset: utcOffset,\n    space_id: space_id\n  };\n  _.each(modifierSet, function(v, k) {\n    var collection, db_new_value, db_previous_value, doc, field, new_value, previous_value;\n    field = fields != null ? fields[k] : void 0;\n    previous_value = previous_doc[k];\n    new_value = v;\n    db_previous_value = null;\n    db_new_value = null;\n    switch (field.type) {\n      case 'date':\n        if ((new_value != null ? new_value.toString() : void 0) !== (previous_value != null ? previous_value.toString() : void 0)) {\n          if (new_value) {\n            db_new_value = transformFieldValue(field, new_value, options);\n          }\n          if (previous_value) {\n            db_previous_value = transformFieldValue(field, previous_value, options);\n          }\n        }\n        break;\n      case 'datetime':\n        if ((new_value != null ? new_value.toString() : void 0) !== (previous_value != null ? previous_value.toString() : void 0)) {\n          if (new_value) {\n            db_new_value = transformFieldValue(field, new_value, options);\n          }\n          if (previous_value) {\n            db_previous_value = transformFieldValue(field, previous_value, options);\n          }\n        }\n        break;\n      case 'textarea':\n        if (previous_value !== new_value) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'code':\n        if (previous_value !== new_value) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'html':\n        if (previous_value !== new_value) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'markdown':\n        if (previous_value !== new_value) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'grid':\n        if (JSON.stringify(previous_value) !== JSON.stringify(new_value)) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'boolean':\n        if (previous_value !== new_value) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'select':\n        if ((previous_value != null ? previous_value.toString() : void 0) !== (new_value != null ? new_value.toString() : void 0)) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'checkbox':\n        if ((previous_value != null ? previous_value.toString() : void 0) !== (new_value != null ? new_value.toString() : void 0)) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'lookup':\n        if (JSON.stringify(previous_value) !== JSON.stringify(new_value)) {\n          if (previous_value) {\n            db_previous_value = transformFieldValue(field, previous_value, options);\n          }\n          if (new_value) {\n            db_new_value = transformFieldValue(field, new_value, options);\n          }\n        }\n        break;\n      case 'master_detail':\n        if (JSON.stringify(previous_value) !== JSON.stringify(new_value)) {\n          if (previous_value) {\n            db_previous_value = transformFieldValue(field, previous_value, options);\n          }\n          if (new_value) {\n            db_new_value = transformFieldValue(field, new_value, options);\n          }\n        }\n        break;\n      default:\n        if (new_value !== previous_value) {\n          db_previous_value = previous_value;\n          db_new_value = new_value;\n        }\n    }\n    if (db_new_value !== null || db_previous_value !== null) {\n      collection = Creator.getCollection(\"audit_records\");\n      doc = {\n        _id: collection._makeNewID(),\n        space: space_id,\n        field_name: field.label || field.name,\n        previous_value: db_previous_value,\n        new_value: db_new_value,\n        related_to: {\n          o: object_name,\n          ids: [record_id]\n        }\n      };\n      return collection.insert(doc);\n    }\n  });\n  return _.each(modifierUnset, function(v, k) {\n    var collection, db_previous_value, doc, field, previous_value;\n    field = fields != null ? fields[k] : void 0;\n    previous_value = previous_doc[k];\n    if (previous_value || _.isBoolean(previous_value)) {\n      collection = Creator.getCollection(\"audit_records\");\n      db_previous_value = transformFieldValue(field, previous_value, options);\n      doc = {\n        _id: collection._makeNewID(),\n        space: space_id,\n        field_name: field.label || field.name,\n        previous_value: db_previous_value,\n        related_to: {\n          o: object_name,\n          ids: [record_id]\n        }\n      };\n      return collection.insert(doc);\n    }\n  });\n};\n\nCreator.AuditRecords.add = function(action, userId, object_name, new_doc, previous_doc, modifier) {\n  if (action === 'update') {\n    return updateRecord(userId, object_name, new_doc, previous_doc, modifier);\n  } else if (action === 'insert') {\n    return insertRecord(userId, object_name, new_doc);\n  }\n};\n","Creator.Objects.audit_records =\r\n\tname: \"audit_records\"\r\n\tlabel: \"å­—æ®µå†å²\"\r\n\ticon: \"record\"\r\n\tfields:\r\n\t\trelated_to:\r\n\t\t\tlabel: \"ç›¸å…³é¡¹\"\r\n\t\t\ttype: \"lookup\"\r\n\t\t\tindex: true\r\n\t\t\treference_to: ()->\r\n\t\t\t\to = []\r\n\t\t\t\t_.each Creator.Objects, (object, object_name)->\r\n\t\t\t\t\tif object.enable_audit\r\n\t\t\t\t\t\to.push object.name\r\n\t\t\t\treturn o\r\n\t\t\tfilterable:true\r\n\t\t\tis_name: true\r\n\t\tcreated:\r\n\t\t\tlabel:\"æ—¶é—´\"\r\n\t\t\tfilterable:true\r\n\t\tfield_name:\r\n\t\t\tlabel: \"å­—æ®µ\"\r\n\t\t\ttype: \"text\"\r\n\t\t\trequired: true\r\n\t\t\tis_wide: true\r\n\t\tcreated_by:\r\n\t\t\tlabel:\"ç”¨æˆ·\"\r\n\t\tprevious_value:\r\n\t\t\tlabel: \"åŸå§‹å€¼\"\r\n\t\t\ttype: \"text\"\r\n\t\tnew_value:\r\n\t\t\tlabel: \"æ–°å€¼\"\r\n\t\t\ttype: \"text\"\r\n\r\n\r\n\tlist_views:\r\n\t\tall:\r\n\t\t\tlabel: \"å…¨éƒ¨\"\r\n\t\t\tfilter_scope: \"space\"\r\n\t\t\tcolumns: [\"related_to\", \"created\", \"field_name\", \"created_by\", \"previous_value\", \"new_value\"]\r\n\t\t\tfilter_fields: [\"related_to\"]\r\n\t\trecent:\r\n\t\t\tlabel: \"æœ€è¿‘æŸ¥çœ‹\"\r\n\t\t\tfilter_scope: \"space\"\r\n\r\n\tpermission_set:\r\n\t\tuser:\r\n\t\t\tallowCreate: false\r\n\t\t\tallowDelete: false\r\n\t\t\tallowEdit: false\r\n\t\t\tallowRead: true\r\n\t\t\tmodifyAllRecords: false\r\n\t\t\tviewAllRecords: false\r\n\t\tadmin:\r\n\t\t\tallowCreate: false\r\n\t\t\tallowDelete: false\r\n\t\t\tallowEdit: false\r\n\t\t\tallowRead: true\r\n\t\t\tmodifyAllRecords: false\r\n\t\t\tviewAllRecords: true","Creator.Objects.audit_records = {\n  name: \"audit_records\",\n  label: \"å­—æ®µå†å²\",\n  icon: \"record\",\n  fields: {\n    related_to: {\n      label: \"ç›¸å…³é¡¹\",\n      type: \"lookup\",\n      index: true,\n      reference_to: function() {\n        var o;\n        o = [];\n        _.each(Creator.Objects, function(object, object_name) {\n          if (object.enable_audit) {\n            return o.push(object.name);\n          }\n        });\n        return o;\n      },\n      filterable: true,\n      is_name: true\n    },\n    created: {\n      label: \"æ—¶é—´\",\n      filterable: true\n    },\n    field_name: {\n      label: \"å­—æ®µ\",\n      type: \"text\",\n      required: true,\n      is_wide: true\n    },\n    created_by: {\n      label: \"ç”¨æˆ·\"\n    },\n    previous_value: {\n      label: \"åŸå§‹å€¼\",\n      type: \"text\"\n    },\n    new_value: {\n      label: \"æ–°å€¼\",\n      type: \"text\"\n    }\n  },\n  list_views: {\n    all: {\n      label: \"å…¨éƒ¨\",\n      filter_scope: \"space\",\n      columns: [\"related_to\", \"created\", \"field_name\", \"created_by\", \"previous_value\", \"new_value\"],\n      filter_fields: [\"related_to\"]\n    },\n    recent: {\n      label: \"æœ€è¿‘æŸ¥çœ‹\",\n      filter_scope: \"space\"\n    }\n  },\n  permission_set: {\n    user: {\n      allowCreate: false,\n      allowDelete: false,\n      allowEdit: false,\n      allowRead: true,\n      modifyAllRecords: false,\n      viewAllRecords: false\n    },\n    admin: {\n      allowCreate: false,\n      allowDelete: false,\n      allowEdit: false,\n      allowRead: true,\n      modifyAllRecords: false,\n      viewAllRecords: true\n    }\n  }\n};\n","Creator.Objects.audit_login =\r\n\tname: \"audit_login\"\r\n\tlabel: \"ç™»å½•æ—¥å¿—\"\r\n\ticon: \"record\"\r\n\tfields:\r\n\t\tusername:\r\n\t\t\tlabel: \"ç”¨æˆ·å\"\r\n\t\t\ttype: \"text\"\r\n\t\t\tis_name: true\r\n\r\n\t\tlogin_time:\r\n\t\t\tlabel:\"ç™»å½•æ—¶é—´\"\r\n\t\t\ttype: \"datetime\"\r\n\r\n\t\tsource_ip:\r\n\t\t\tlabel: \"IPåœ°å€\"\r\n\t\t\ttype: \"text\"\r\n\r\n\t\tlocation:\r\n\t\t\tlabel:\"ä½ç½®\"\r\n\t\t\ttype: \"text\"\r\n\r\n\t\tlogin_type:\r\n\t\t\tlabel: \"ç™»å½•æ–¹å¼\"\r\n\t\t\ttype: \"text\"\r\n\r\n\t\tstatus:\r\n\t\t\tlabel: \"çŠ¶æ€\"\r\n\t\t\ttype: \"text\"\r\n\r\n\t\tbrowser:\r\n\t\t\tlabel: \"æµè§ˆå™¨\"\r\n\t\t\ttype: \"text\"\r\n\r\n\t\tplatform:\r\n\t\t\tlabel: \"ç³»ç»Ÿ\"\r\n\t\t\ttype: \"text\"\r\n\r\n\t\tapplication:\r\n\t\t\tlabel: \"åº”ç”¨\"\r\n\t\t\ttype: \"text\"\r\n\r\n\t\tclient_version:\r\n\t\t\tlabel: \"å®¢æˆ·ç«¯ç‰ˆæœ¬\"\r\n\t\t\ttype: \"text\"\r\n\r\n\t\tapi_type:\r\n\t\t\tlabel: \"apiç±»å‹\"\r\n\t\t\ttype: \"text\"\r\n\r\n\t\tapi_version:\r\n\t\t\tlabel: \"apiç‰ˆæœ¬\"\r\n\t\t\ttype: \"text\"\r\n\r\n\t\tlogin_url:\r\n\t\t\tlabel: \"ç™»å½•URL\"\r\n\t\t\ttype: \"text\"\r\n\r\n\tlist_views:\r\n\t\tall:\r\n\t\t\tlabel: \"å…¨éƒ¨\"\r\n\t\t\tfilter_scope: \"space\"\r\n\t\t\tcolumns: [\"username\", \"login_time\", \"source_ip\", \"location\", \"login_type\", \"status\", \"browser\", \"platform\", \"application\", \"client_version\", \"api_type\", \"api_version\", \"login_url\"]\r\n\t\trecent:\r\n\t\t\tlabel: \"æœ€è¿‘æŸ¥çœ‹\"\r\n\t\t\tfilter_scope: \"space\"\r\n\r\n\tpermission_set:\r\n\t\tuser:\r\n\t\t\tallowCreate: false\r\n\t\t\tallowDelete: false\r\n\t\t\tallowEdit: false\r\n\t\t\tallowRead: true\r\n\t\t\tmodifyAllRecords: false\r\n\t\t\tviewAllRecords: false\r\n\t\tadmin:\r\n\t\t\tallowCreate: false\r\n\t\t\tallowDelete: false\r\n\t\t\tallowEdit: false\r\n\t\t\tallowRead: true\r\n\t\t\tmodifyAllRecords: false\r\n\t\t\tviewAllRecords: true"]}