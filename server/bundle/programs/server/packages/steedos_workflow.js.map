{"version":3,"sources":["meteor://ðŸ’»app/packages/steedos:workflow/checkNpm.js","meteor://ðŸ’»app/packages/steedos:workflow/lib/URI.js","meteor://ðŸ’»app/packages/steedos_workflow/lib/core.coffee","meteor://ðŸ’»app/lib/core.coffee","meteor://ðŸ’»app/packages/steedos_workflow/lib/models/instance_tasks.coffee","meteor://ðŸ’»app/packages/steedos_workflow/lib/models/auth_tokens.coffee","meteor://ðŸ’»app/packages/steedos_workflow/client/lib/instance_readonly_template.coffee","meteor://ðŸ’»app/client/lib/instance_readonly_template.coffee","meteor://ðŸ’»app/packages/steedos_workflow/client/lib/template_manager.coffee","meteor://ðŸ’»app/client/lib/template_manager.coffee","meteor://ðŸ’»app/packages/steedos:workflow/client/coreform/inputTypes/coreform-table/steedos-table.js","meteor://ðŸ’»app/packages/steedos_workflow/client/views/instance/_image_sign.coffee","meteor://ðŸ’»app/client/views/instance/_image_sign.coffee","meteor://ðŸ’»app/packages/steedos_workflow/client/views/instance/_traces_handler.coffee","meteor://ðŸ’»app/client/views/instance/_traces_handler.coffee","meteor://ðŸ’»app/packages/steedos_workflow/client/views/instance/_instance_form.coffee","meteor://ðŸ’»app/client/views/instance/_instance_form.coffee","meteor://ðŸ’»app/packages/steedos:workflow/client/views/instance/_instance_attachments.js","meteor://ðŸ’»app/packages/steedos_workflow/client/views/instance/_instance_sign_text.coffee","meteor://ðŸ’»app/client/views/instance/_instance_sign_text.coffee","meteor://ðŸ’»app/packages/steedos_workflow/client/views/instance/_traces_help.coffee","meteor://ðŸ’»app/client/views/instance/_traces_help.coffee","meteor://ðŸ’»app/packages/steedos_workflow/client/views/instance/_related_instances.coffee","meteor://ðŸ’»app/client/views/instance/_related_instances.coffee","meteor://ðŸ’»app/packages/steedos_workflow/client/views/instance/_related_records.coffee","meteor://ðŸ’»app/client/views/instance/_related_records.coffee","meteor://ðŸ’»app/packages/steedos:workflow/routes/getSpaceUsers.js","meteor://ðŸ’»app/packages/steedos:workflow/routes/getFormulaUserObjects.js","meteor://ðŸ’»app/packages/steedos:workflow/routes/init_formula_values.js","meteor://ðŸ’»app/packages/steedos:workflow/routes/api_workflow_forward.js","meteor://ðŸ’»app/packages/steedos_workflow/routes/test_webhook.coffee","meteor://ðŸ’»app/routes/test_webhook.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/set_instance_step_approve.coffee","meteor://ðŸ’»app/packages/steedos:workflow/server/methods/get_instance_data.js","meteor://ðŸ’»app/packages/steedos:workflow/server/methods/save_instance.js","meteor://ðŸ’»app/packages/steedos:workflow/server/methods/trace_approve_cc.js","meteor://ðŸ’»app/packages/steedos:workflow/server/methods/forward_instance.js","meteor://ðŸ’»app/packages/steedos:workflow/server/methods/cfs_instances.js","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/instance_approve.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/instance_return.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/instance_remind.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/next_step_users_not_found.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/instance_number_rules.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/check_main_attach.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/related_instances.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/edit_flow_positions.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/start_flow.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/instance_traces.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/instance_batch.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/flow.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/hide_instance.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/methods/instance_value.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/routes/instance.coffee","meteor://ðŸ’»app/server/routes/instance.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/routes/steedos_css.coffee","meteor://ðŸ’»app/server/routes/steedos_css.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/routes/instance_draft_view.coffee","meteor://ðŸ’»app/server/routes/instance_draft_view.coffee","meteor://ðŸ’»app/packages/steedos:workflow/server/lib/1_form_formula.js","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/categories.coffee","meteor://ðŸ’»app/server/publications/categories.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/cfs_instances.coffee","meteor://ðŸ’»app/server/publications/cfs_instances.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/flow_positions.coffee","meteor://ðŸ’»app/server/publications/flow_positions.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/flow_positions_tabular.coffee","meteor://ðŸ’»app/server/publications/flow_positions_tabular.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/flow_roles.coffee","meteor://ðŸ’»app/server/publications/flow_roles.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/flows.coffee","meteor://ðŸ’»app/server/publications/flows.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/forms.coffee","meteor://ðŸ’»app/server/publications/forms.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/instance_data.coffee","meteor://ðŸ’»app/server/publications/instance_data.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/instance_list.coffee","meteor://ðŸ’»app/server/publications/instance_list.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/instance_tabular.coffee","meteor://ðŸ’»app/server/publications/instance_tabular.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/instance_draft.coffee","meteor://ðŸ’»app/server/publications/instance_draft.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/distributed_instances_state_by_ids.coffee","meteor://ðŸ’»app/server/publications/distributed_instances_state_by_ids.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/related_instaces.coffee","meteor://ðŸ’»app/server/publications/related_instaces.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/space_user_signs.coffee","meteor://ðŸ’»app/server/publications/space_user_signs.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/user_inbox_instance.coffee","meteor://ðŸ’»app/server/publications/user_inbox_instance.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/publications/flow_main_attach_template.coffee","meteor://ðŸ’»app/server/publications/flow_main_attach_template.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/flow-template/workflow_template.coffee","meteor://ðŸ’»app/server/flow-template/workflow_template.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/schedule/auto_finish_process_delegation.coffee","meteor://ðŸ’»app/server/schedule/auto_finish_process_delegation.coffee","meteor://ðŸ’»app/packages/steedos_workflow/server/schedule/timeout_auto_submit.coffee","meteor://ðŸ’»app/server/schedule/timeout_auto_submit.coffee","meteor://ðŸ’»app/packages/steedos_workflow/related_instances_tabular.coffee","meteor://ðŸ’»app/related_instances_tabular.coffee","meteor://ðŸ’»app/packages/steedos_workflow/tabular.coffee","meteor://ðŸ’»app/tabular.coffee"],"names":["checkNpmVersions","module","link","v","root","factory","define","amd","URI","punycode","IPv6","SecondLevelDomains","SLD","_URI","url","base","_urlSupplied","arguments","length","_baseSupplied","undefined","TypeError","location","href","absoluteTo","version","p","prototype","hasOwn","Object","hasOwnProperty","escapeRegEx","string","replace","getType","value","String","toString","call","slice","isArray","obj","filterArrayValues","data","lookup","i","_match","test","splice","arrayContains","list","_type","match","arraysEqual","one","two","sort","l","trimSlashes","text","trim_expression","_parts","protocol","username","password","hostname","urn","port","path","query","fragment","duplicateQueryParameters","escapeQuerySpace","protocol_expression","idn_expression","punycode_expression","ip4_expression","ip6_expression","find_uri_expression","findUri","start","end","trim","defaultPorts","http","https","ftp","gopher","ws","wss","invalid_hostname_characters","domAttributes","getDomAttribute","node","nodeName","toLowerCase","type","escapeForDumbFirefox36","escape","strictEncodeURIComponent","encodeURIComponent","encode","decode","decodeURIComponent","iso8859","unescape","unicode","characters","pathname","expression","map","reserved","urnpath","encodeQuery","escaped","decodeQuery","e","_part","generateAccessor","_group","c","generateSegmentedPathFunction","_sep","_codingFuncName","_innerCodingFuncName","actualCodingFunc","segments","split","join","decodePath","decodeUrnPath","recodePath","recodeUrnPath","encodeReserved","parse","parts","pos","indexOf","substring","parseAuthority","parseHost","bracketPos","t","charAt","firstColon","firstSlash","nextColon","parseUserinfo","lastIndexOf","shift","parseQuery","items","splits","name","push","build","buildAuthority","buildHost","buildUserinfo","buildQuery","unique","key","buildQueryParameter","addQuery","concat","removeQuery","hasQuery","withinArray","_booly","Boolean","op","commonPath","Math","min","withinString","callback","options","_start","_end","_trim","_attributeOpen","lastIndex","exec","index","ignoreHtml","attributeOpen","max","search","ignore","result","ensureValidHostname","toASCII","noConflict","removeAll","unconflicted","URITemplate","deferBuild","_deferred_build","_string","clone","valueOf","generateSimpleAccessor","generatePrefixAccessor","_key","hash","res","_object","attribute","src","is","what","ip","ip4","ip6","sld","idn","relative","has","_protocol","_port","_hostname","scheme","x","origin","authority","host","userinfo","resource","subdomain","domain","sub","RegExp","tld","get","ReferenceError","directory","filename","decodePathSegment","mutatedDirectory","normalizePath","suffix","s","segment","separator","absolute","Error","pop","unshift","segmentCoded","q","setQuery","setSearch","addSearch","removeSearch","hasSearch","normalize","normalizeProtocol","normalizeQuery","normalizeFragment","normalizeHostname","normalizePort","best","_path","_was_relative","_leadingParents","_parent","_pos","normalizePathname","normalizeSearch","normalizeHash","d","readable","uri","toUnicode","qp","kv","resolved","properties","basedir","relativeTo","relativeParts","baseParts","common","relativePath","basePath","parents","equals","one_map","two_map","checked","one_query","two_query","Workflow","ImageSign","TracesHandler","TracesTemplate","InstanceformTemplate","InstanceAttachmentTemplate","InstanceSignText","RelatedInstances","RelatedRecords","InstanceMacro","context","TracesManager","isOpinionField_from_string","field_formula","includesOpinionField","form","form_version","_form_version","field_formulas","fields","Array","Meteor","isServer","uuflowManager","getFormVersion","db","forms","findOne","_id","form_versions","forEach","f","ref","console","log","f1","formula","_","some","helpers","instance_tasks","Collection","_simpleSchema","SimpleSchema","instance","trace","is_finished","user","user_name","handler","handler_name","handler_organization","handler_organization_name","handler_organization_fullname","start_date","Date","due_date","is_read","is_error","values","deadline","remind_date","reminded_count","Number","read_date","description","modified","modified_by","sign_show","judge","next_steps","finish_date","cost_time","space","instance_name","submitter","submitter_name","applicant","applicant_name","applicant_organization_name","submit_date","flow","flow_name","step","step_name","category_name","instance_state","distribute_from_instance","forward_from_instance","keywords","is_archived","category","auth_tokens","_getLocale","_getRequiredFields","_getStartStepEditableFields","_getStartStepRequiredFields","_getTemplateData","_getViewHtml","getLinkText","marked","require","InstanceReadOnlyTemplate","instance_attachment","afSelectUserRead","afFormGroupRead","afFormGroup","create","tempalteName","steedosData","template","templateCompiled","templateRenderFunction","SpacebarsCompiler","compile","isBody","eval","Template","Blaze","createInstanceSignText","instanceSignTextCompiled","instanceSignTextHtml","instanceSignTextRenderFunction","instanceSignText","createImageSign","imageSignCompiled","imageSignHtml","imageSignRenderFunction","imageSign","createTracesHanlder","tracesHanlderCompiled","tracesHanlderHtml","tracesHanlderRenderFunction","instance_traces_handler","init","item","label","detail_url","Steedos","absoluteUrl","getValue","field","locale","utcOffset","date","fieldOptions","hours","month","nameField","records","seconds","selectedOption","selectedOptions","splitedValues","t0","t1","uiSchema","year","n","itemSplits","encodeURI","error","is_multiselect","getProperty","fullname","TAPi18n","__","formatDate","is_textarea","Npm","Spacebars","SafeString","find","filter","is_percent","numberToPercentString","digits","numberToString","isClient","authRequest","JSON","stringify","async","objectFind","filters","original","Creator","getObject","reference_to","NAME_FIELD_KEY","reference_to_field","getObjectNameFieldKey","getLabel","code","findPropertyByPK","getInstanceFormVersion","form_fields","current","where","historys","getFlowVersion","flow_version","flows","viewHtml","Assets","getText","ref1","toLocaleLowerCase","rev","is_required","steps","editableCode","startStep","keys","permissions","requiredFields","intersection","WorkflowManager","WorkflowManager_format","getAutoformSchemaValues","insname","ins_state","state","ins_final_decision","ins_code","ins_is_archived","ins_is_deleted","applicantContext","sessionUserId","editable","startStepEditableFields","passing","moment","format","getInstanceView","body","instanceCompiled","instanceRenderFunction","instanceTemplate","TemplateManager","getTemplate","templateName","instance_readonly_view","toHTMLWithData","getTracesView","traceCompiled","traceRenderFunction","tracesHtml","instance_style","trace_readonly_view","traces","getAttachmentView","attachmentCompiled","attachmentHtml","attachmentRenderFunction","attachments_readonly_view","getRelatedInstancesView","relatedInstancesCompiled","relatedInstancesHtml","relatedInstancesRenderFunction","related_instances_view","getRelatedRecordsView","relatedRecordsCompiled","relatedRecordsHtml","relatedRecordsRenderFunction","related_records_view","getOnLoadScript","form_script","getInstanceHtml","allCssLink","attachment","creatorService","cssHref","formDescription","formDescriptionHtml","html","ins_record_ids","instanceBoxStyle","jqHref","onLoadScript","openFileScript","related_instances","related_records","showTracesBtn","showTracesScript","traceCheck","width","settings","webservices","creator","record_ids","isMobile","showTrace","final_decision","showAttachments","isEmpty","tagger","styles","plugins","add_styles","formId","instance_title","pageTitle","pageTitleTrClass","val","CoreForm","pageTitleFieldName","handleTableTemplate","_export","table_fields","table_field","field_permission","pureCode","required","title_permission","removeSpecialCharacter","isOpinionField","tr_start","td_colspan","tr_end","includes","permission","_template","table","_templateHelps","steedos_instance","getInstance","atts","id","style","disabled","instanceId","form_types","ApproveManager","isReadOnly","steedos_form","innersubformContext","doc_values","Session","a","b","getAutoformSchema","instance_box_style","box","ins","print_template","instance_template","SteedosTable","checkItem","item_index","fieldObj","getField","fieldVal","getItemModalValue","sf_name","sfields","sf","InstanceManager","checkFormFieldValue","$","setTableItemValue","item_value","tableValue","getTableValue","getTableItemValue","removeTableItem","removed","setTableValue","getValidValue","validValue","handleData","instanceFields","getInstanceFields","getModalData","Form_formula","getFormulaFieldVariable","AutoForm","getFormValues","insertDoc","addItem","_item_value","getKeys","append","getTr","updateItem","tds","getRemoveTd","sfield","getTd","empty","runFormula","removeItem","hide","showModal","method","modalData","setTimeout","Modal","show","getCurrentDataForForm","ss","getFormSchema","schema","objectKeys","_makeGeneric","getThead","isObject","thead","trs","sf_length","wide_fields","filterProperty","is_wide","getTbody","sfieldsEditable","tbody","tr","td","td_value","getTDValue","view","CFDataManager","getFormulaSpaceUsers","u","getFormulaOrganizations","o","getFormulaOrganization","pluck","addInputType","valueOut","valueConverters","stringToStringArray","stringToNumber","stringToNumberArray","stringToBoolean","stringToBooleanArray","stringToDate","stringToDateArray","contextAdjust","maxlength","afTable","events","event","new_item_index","currentTarget","dataset","set","rendered","str","addItemTr","getCurrentStep","step_type","ccHasEditPermission","autorun","currentData","spaceUserSign","userId","space_user_signs","imageURL","sign","showSignImage","traceShowSignImage","objectUrl","object_name","record_id","app_id","getObjectUrl","unempty","unequals","include","ref2","ref3","getInstanceFlowVersion","approves","ref4","approve","judge_name","opinion_fields_code","sign_field_code","after_field","before_field","pre_fields","pre_wide_fields","sort_approve","order","p1","p2","_p1","_p2","getTime","_t","getCfClass","getTableThead","getTableBody","showLabel","templateData","getOpinionFieldStepsName","top_keywords","foo1","opinionFields","foo","json_formula","s1","error1","yijianlan","stepName","image_sign","only_cc_opinion","only_cc","default_description","only_handler","showCCOpinion","markDownToHtml","markDownString","f_label","that","isSection","registerHelper","ins_attach_download_url","getPermissions","instanceformChangeEvent","preventDefault","openWindow","target","onCreated","compiled","instanceCustomTemplate","instanceView","renderFunction","View","instance_custom_template","onRendered","currentApprove","currentStep","formula_fields","instanceNumberFields","setInstanceFormApplicant","nextSteps","nextStepUsers","InstanceEvent","initEvents","getCurrentApprove","each","element","schemaKey","toastr","reason","getFieldValue","InstanceNumberRules","instanceNumberBuilder","trigger","run","showMainTitle","workflowMainAttachTitle","enabled_add_main_attachment","current_step","currentTrace","getCurrentTrace","main_attach_count","cfs","instances","count","distribute_main_attach_count","start_step","getStartStep","can_edit_main_attach","enabled_edit_normal_attachment","getFlow","upload_after_being_distributed","isCC","getCCStep","can_edit_normal_attach","main_attachment","main_attach","normal_attachments","selector","$ne","dfis","distribute_from_instances","$in","distribute_main","firstVersionMain","metadata","parent","attachmentUploadedAt","uploadedAt","firstVersion","sortBy","instanceIds","attachments_count","flow_files","files","isDraftAndFlowfilesExist","compact","attachments","$or","fetch","myApprove","myTrace","isInbox","defaultDescription","approve_sort","approvesGroup","approves_sorted","completed_date","hasNext","haveDescriptionApprove","is_completed","last","top_approves","union","top_approve","groupBy","handlerApproves","descriptionApproves","workflow","showBlankApproveDescription","_display","isMyApprove","myApproveDescription","approveId","now","isOpinionOfField","imageSignData","getLastSignApprove","getHandlerSignShowApproves","lastMyApproveDescription","showApprove","judge_description","is_approved","is_rejected","is_readed","addClass","dateFormat","getFullYear","getStepName","stepId","getInstanceStep","showDeleteButton","approved","from_user","isShowModificationButton","approve_admins","isShow","contains","isEditing","is_editing","isShowDescription","getApproveStatusIcon","approveJudge","autoSubmitted","approveStatusIcon","getApproveStatusText","approveStatusText","getApproveJudgeClass","isForward","showForwardDeleteButton","forward_instance","isDistribute","showDistributeDeleteButton","hasFlowAdminPermission","finishDateSchema","isAndroidOrIOS","autoform","optional","readonly","dateTimePickerOptions","ignoreReadonly","widgetPositioning","horizontal","finishDateValues","showTracesView","show_modal_traces_list","space_settings","getInstanceStateText","instance_id","getInstanceStateColor","cla","firstTrace","last_distribute_from","dis_info","$exists","created","created_by","UUflow_api","getNameForUser","users","from_user_name","isCCOrDistributeOrForwardTerminated","judgeTerminated","instanceExists","agentDescription","userName","traceName","traceId","handlerDoc","handlerId","users_can_read_cc_handler_detail_info","getContactInfoForUser","stopPropagation","calling","err","removeClass","success","allowMultiple","closest","target_user_id","openSafeObjectUrl","forward_space","forwardspace","forwardinstance","Tracker","afterFlush","on","scrollTop","finish_input","opinion_input","showRelatedInstaces","related_instaces","related_instace_url","isCordova","show_delete","showRelatedRecords","relatedRecordUrl","objcetName","ids","process","env","CREATOR_NODE_ENV","JsonRoutes","add","req","next","hashData","action","to_users","sendResult","stack","errors","errorMessage","message","workflowMethods","methods","set_instance_step_approve","ins_id","step_approve","stepsApprovesOptions","apply","set_instance_skip_steps","get_instance_data","formCached","flowCached","draft_save_instance","inbox_save_instance","cc_do","cc_user_ids","cc_read","cc_submit","cc_remove","batch_cancel_cc","approve_ids","cc_save","space_id","flow_id","hasSaveInstanceToAttachment","isForwardAttachments","selectedUsers","action_type","related","from_approve_id","forward_remove","trace_id","approve_id","cancelDistribute","cfs_instances_remove","file_id","cfs_instances_set_current","cfs_instances_lock","user_id","cfs_instances_unlock","download_space_instance_attachments_to_disk","spaceId","cfsRecordIds","set_approve_have_read","change_approve_info","update_approve_sign","sign_type","lastSignApprove","update_sign_show","objs","myApprove_id","instance_return","instance_remind","remind_users","remind_count","remind_deadline","action_types","next_step_users_not_found","deal_type","params","_eval","check_main_attach","remove_related","re_ins_id","update_instance_related","updateFlowPosition","updateFlowRole","start_flow","flowId","get_instance_traces","categoryId","flowIds","get_batch_instances","get_batch_instances_count","get_my_approves","change_flow_state","hide_instance","insId","is_hidden","getInstanceValues","Cookies","getInstanceReadOnly","_hasPermission","_locale","_parent_instances","dataBuf","hide_traces","spaceUserCount","getAPILoginUser","access_token","getUserIdFromAccessToken","spaces","space_users","hasInstancePermissions","_parent_id","_parent_ins","charset","Buffer","setHeader","statusCode","ret_sync_token","spaceUser","spaceUserOrganizations","sync_token","APIAuthenticationCheck","headers","isSpaceAdmin","organizations","canMonitor","canAdmin","$gt","$nin","inbox_uers","cc_users","outbox_users","skip","limit","copies","allCss","WebApp","getRefreshableAssets","css","rootUrl","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","ROOT_URL","endsWith","h","g","m","k","getEach","uniq","mixin","dest","handerUserObject","organization","hr","sort_no","mobile","work_phone","position","userRoles","roles","handerOrgObject","org","init_formula_values","autoFormDoc","approver","__values","tableFields","tableValues","formulaTableValues","__tableValues","tablefield","getFormulaUserObjects","getFormulaOrgObjects","getFormulaUserObject","publish","check","ready","categories","app","flow_positions","role","publishComposite","tableName","Match","Optional","unblock","children","flow_roles","createTemplateFormAndFlow","perms","company_id","distribute_optional_users","distribute_to_self","enable_amisform","versionId","handle","self","latest","observeChanges","changed","added","onStop","stop","flow_ids","distribute_end_notification","allow_select_step","amis_schema","getMiniInstance","getMyapproveModified","instance_fields_0","miniApproveFields","needChange","triggerChangeFields","triggerChangeFieldsValues","myApproveModifieds","_instanceId","_trace","changeFields","_change","_rev","_my_approve_modifieds","isEqual","getInstanceTraces","_insId","inbox_users","asyncLastFinishedApprove","lastFinishedApproveAggregate","instanceid","dataMap","operation","rawCollection","aggregate","toArray","doc","isFunction","wrapAsync","getMyApprove","getMyLastFinishedApprove","getStepCurrentName","notFinishedTraces","agent","stepCurrentName","$slice","myLastFinishedApprove","agent_user_name","my_finish_date","is_cc","cc_count","tabularName","instance_ids","related_instance_ids","_async_get_flow_instances_aggregate","_get_flow_instances_aggregate","_items","$match","$group","$sum","_changeData","_flowsData","_init","dataItem","flow_instance","observe","getCollection","workflowTemplate","startup","absolute_path_cn","absolute_path_us","filesList_cn","filesList_us","fs","mime","path_cn","path_us","readFileList","pathDir","filesList","readdirSync","stat","statSync","isDirectory","workflowTemplates","resolve","existsSync","file","readFileSync","go_next","rule","schedule","cron","auto_finish_process_delegation","scheduleJob","bindEnvironment","time","process_delegation_rules","update","enabled","end_time","$lte","$set","multi","timeEnd","timeout_auto_submit","timeoutAutoSubmit","TabularTables","related_instances_tabular","Tabular","Table","collection","columns","title","orderable","render","input","step_current_name","current_step_name","dom","lengthChange","extraFields","pageLength","info","searching","responsive","details","autoWidth","changeSelector","curSpaceUser","$and","admins","fl","extend","GetBoxInstancesTabularOptions","_get_inbox_instances_tabular_options","_get_outbox_instances_tabular_options","_handleListFields","instanceTasksListTableTabular","instancesListTableTabular","newInstancesListTabular","updateTabularTitle","subs","SubsManager","ins_fields","pub","onUnload","instance_list","_tableColumns","drawCallback","ellipsisLink","emptyTd","colSpan","isPad","perfectScrollbar","oInstance","attr","click","goPage","height","pages","ceil","fnRecordsDisplay","_iDisplayLength","DataTable","page","draw","blur","currentPage","keydown","keyCode","createdRow","row","dataIndex","FlowRouter","setAttribute","agent_view","cc_view","instanceNamePriorityClass","modifiedFromNow","modifiedString","priorityIcon","priorityIconClass","priorityValue","step_current_name_view","unread","momentReactiveFromNow","priority","visible","cc_tag","record_need","lengthMenu","space_user","pagingType","is_list_display","inbox_instances","outbox_instances","getSort","flowInstances","ReactiveVar","_changeOrder"],"mappings":"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;AACAjG,SAAKgB,IAAItD,UAAJ,CAAe,CAAf,EAAkBmb,GAAlB,CAAsB,CAAtB,CAAL;;AAEA,QAAGrwB,QAAH;AACC,aAAOqE,OAAOsH,WAAP,CAAmB,WAASykB,UAAT,GAAoB,QAApB,GAA4B5Y,EAA/C,CAAP;AADD;AAGC,aAAO9L,QAAQC,WAAR,CAAoB,WAASykB,UAAT,GAAoB,QAApB,GAA4B5Y,EAAhD,CAAP;ACIE;AD9BJ;AAAA,CADD,C;;;;;;;;;;;;;;;;;;;;;;;AEAA;;;;;;;AAOA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,K;;;;;;;;;;;AC/BA;;;;;;;AAOA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,K;;;;;;;;;;;AC/BA;;;;;;;AAOA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,K;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpCA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,K;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzmBA,IAAG8Y,QAAQC,GAAR,CAAYC,gBAAZ,KAAgC,aAAnC;AACIC,aAAWC,GAAX,CAAe,MAAf,EAAuB,eAAvB,EAAwC,UAACC,GAAD,EAAMlzB,GAAN,EAAWmzB,IAAX;AACpC,QAAA54B,CAAA,EAAA64B,QAAA;;AAAA;AAEIA,iBAAWF,IAAIhf,IAAf;AACA1M,cAAQC,GAAR,CAAY,UAAZ,EAAwB2rB,SAASC,MAAjC;AACA7rB,cAAQC,GAAR,CAAY,aAAZ,EAA2B2rB,SAAS7F,SAApC;AACA/lB,cAAQC,GAAR,CAAY,YAAZ,EAA0B2rB,SAASE,QAAnC;ACCN,aDEMN,WAAWO,UAAX,CAAsBvzB,GAAtB,EACQ;AAAAwR,cAAM,GAAN;AACA1b,cAAM;AADN,OADR,CCFN;ADNE,aAAA0Z,KAAA;AAWMjV,UAAAiV,KAAA;AACFhI,cAAQgI,KAAR,CAAcjV,EAAEi5B,KAAhB;ACCN,aDAMR,WAAWO,UAAX,CAAsBvzB,GAAtB,EACI;AAAAwR,cAAM,GAAN;AACA1b,cAAM;AAAE29B,kBAAQ,CAAC;AAACC,0BAAcn5B,EAAEo5B;AAAjB,WAAD;AAAV;AADN,OADJ,CCAN;AAUD;ADxBD;AC0BH,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3BD,IAAAC,eAAA;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACFhtB,OAAOitB,OAAP,CACC;AAAAC,6BAA2B,UAACC,MAAD,EAASC,YAAT,EAAuBC,oBAAvB;AAC1B,WAAOL,gBAAgBE,yBAAhB,CAA0CI,KAA1C,CAAgD,IAAhD,EAAsD9/B,SAAtD,CAAP;AADD;AAEA+/B,2BAAyB,UAACJ,MAAD,EAAS5G,MAAT,EAAiBkG,MAAjB;AACxB,WAAOO,gBAAgBO,uBAAhB,CAAwCD,KAAxC,CAA8C,IAA9C,EAAoD9/B,SAApD,CAAP;AAHD;AAAA,CADD,E;;;;;;;;;;;ACDA;;;;;;;AAOA,MAAM;AAAEw/B;AAAF,IAAsBhoB,OAAO,CAAC,mBAAD,CAAnC;;AACAhF,MAAM,CAACitB,OAAP,CAAe;AAEdO,mBAAiB,EAAE,UAAU1E,WAAV,EAAuB2E,UAAvB,EAAmCC,UAAnC,EAA+C;AACjE,WAAOV,eAAe,CAACQ,iBAAhB,CAAkCF,KAAlC,CAAwC,IAAxC,EAA8C9/B,SAA9C,CAAP;AACA;AAJa,CAAf,E;;;;;;;;;;;ACRA,MAAM;AAAEw/B;AAAF,IAAsBhoB,OAAO,CAAC,mBAAD,CAAnC;;AACAhF,MAAM,CAACitB,OAAP,CAAe;AAEdU,qBAAmB,EAAE,UAAUxZ,GAAV,EAAe;AACnC,WAAO6Y,eAAe,CAACW,mBAAhB,CAAoCL,KAApC,CAA0C,IAA1C,EAAgD9/B,SAAhD,CAAP;AACA,GAJa;AAMdogC,qBAAmB,EAAE,UAAUtR,OAAV,EAAmB;AACvC,WAAO0Q,eAAe,CAACY,mBAAhB,CAAoCN,KAApC,CAA0C,IAA1C,EAAgD9/B,SAAhD,CAAP;AACA;AARa,CAAf,E;;;;;;;;;;;ACDA;;;;;;;AAOA,MAAM;AAAEw/B;AAAF,IAAsBhoB,OAAO,CAAC,mBAAD,CAAnC;;AACAhF,MAAM,CAACitB,OAAP,CAAe;AACdY,OAAK,EAAE,UAAUvR,OAAV,EAAmBwR,WAAnB,EAAgClrB,WAAhC,EAA6C;AACnD,WAAOoqB,eAAe,CAACa,KAAhB,CAAsBP,KAAtB,CAA4B,IAA5B,EAAkC9/B,SAAlC,CAAP;AACA,GAHa;AAKdugC,SAAO,EAAE,UAAUzR,OAAV,EAAmB;AAC3B,WAAO0Q,eAAe,CAACe,OAAhB,CAAwBT,KAAxB,CAA8B,IAA9B,EAAoC9/B,SAApC,CAAP;AACA,GAPa;AASdwgC,WAAS,EAAE,UAAUb,MAAV,EAAkBvqB,WAAlB,EAA+BohB,SAA/B,EAA0CjJ,mBAA1C,EAA+D;AACzE,WAAOiS,eAAe,CAACgB,SAAhB,CAA0BV,KAA1B,CAAgC,IAAhC,EAAsC9/B,SAAtC,CAAP;AACA,GAXa;AAadygC,WAAS,EAAE,UAAU3a,UAAV,EAAsBiS,SAAtB,EAAiC;AAC3C,WAAOyH,eAAe,CAACiB,SAAhB,CAA0BX,KAA1B,CAAgC,IAAhC,EAAsC9/B,SAAtC,CAAP;AACA,GAfa;AAiBd0gC,iBAAe,EAAE,UAAUpF,WAAV,EAAuBqF,WAAvB,EAAoC;AACpD,WAAOnB,eAAe,CAACkB,eAAhB,CAAgCZ,KAAhC,CAAsC,IAAtC,EAA4C9/B,SAA5C,CAAP;AACA,GAnBa;AAqBd4gC,SAAO,EAAE,UAAUjB,MAAV,EAAkBvqB,WAAlB,EAA+BohB,SAA/B,EAA0CjJ,mBAA1C,EAA+D;AACvE,WAAOiS,eAAe,CAACoB,OAAhB,CAAwBd,KAAxB,CAA8B,IAA9B,EAAoC9/B,SAApC,CAAP;AACA;AAvBa,CAAf,E;;;;;;;;;;;ACRA;;;;;;;AAOA,MAAM;AAAEw/B;AAAF,IAAsBhoB,OAAO,CAAC,mBAAD,CAAnC;;AACAhF,MAAM,CAACitB,OAAP,CAAe;AACd;AACArF,kBAAgB,EAAE,UAAUkB,WAAV,EAAuBuF,QAAvB,EAAiCC,OAAjC,EAA0CC,2BAA1C,EAAuE3rB,WAAvE,EAAoF4rB,oBAApF,EAA0GC,aAA1G,EAAyHC,WAAzH,EAAsIC,OAAtI,EAA+IC,eAA/I,EAAgK;AACjL,QAAI,CAAC,KAAKzT,MAAV,EACC,MAAM,IAAInb,MAAM,CAACpE,KAAX,CAAiB,gBAAjB,CAAN;AAED;AACA,GAPa;AAUdizB,gBAAc,EAAE,UAAU/F,WAAV,EAAuBgG,QAAvB,EAAiCC,UAAjC,EAA6C;AAC5D,WAAO/B,eAAe,CAAC6B,cAAhB,CAA+BvB,KAA/B,CAAqC,IAArC,EAA2C9/B,SAA3C,CAAP;AACA,GAZa;AAcdwhC,kBAAgB,EAAE,UAAUlG,WAAV,EAAuBqF,WAAvB,EAAoC;AACrD,WAAOnB,eAAe,CAACgC,gBAAhB,CAAiC1B,KAAjC,CAAuC,IAAvC,EAA6C9/B,SAA7C,CAAP;AACA;AAhBa,CAAf,E;;;;;;;;;;;ACRA;;;;;;;AAOA,MAAM;AAAEw/B;AAAF,IAAsBhoB,OAAO,CAAC,mBAAD,CAAnC;;AACAhF,MAAM,CAACitB,OAAP,CAAe;AACXgC,sBAAoB,EAAE,UAAUC,OAAV,EAAmB;AACrC,WAAOlC,eAAe,CAACiC,oBAAhB,CAAqC3B,KAArC,CAA2C,IAA3C,EAAiD9/B,SAAjD,CAAP;AACH,GAHU;AAKX2hC,2BAAyB,EAAE,UAAUD,OAAV,EAAmB;AAC1C,WAAOlC,eAAe,CAACmC,yBAAhB,CAA0C7B,KAA1C,CAAgD,IAAhD,EAAsD9/B,SAAtD,CAAP;AACH,GAPU;AASX4hC,oBAAkB,EAAE,UAAUF,OAAV,EAAmBG,OAAnB,EAA4B1tB,SAA5B,EAAuC;AACvD,WAAOqrB,eAAe,CAACoC,kBAAhB,CAAmC9B,KAAnC,CAAyC,IAAzC,EAA+C9/B,SAA/C,CAAP;AACH,GAXU;AAaX8hC,sBAAoB,EAAE,UAAUJ,OAAV,EAAmB;AACrC,WAAOlC,eAAe,CAACsC,oBAAhB,CAAqChC,KAArC,CAA2C,IAA3C,EAAiD9/B,SAAjD,CAAP;AACH,GAfU;AAiBX+hC,6CAA2C,EAAE,UAAUC,OAAV,EAAmBC,YAAnB,EAAiC;AAC1E,WAAOzC,eAAe,CAACuC,2CAAhB,CAA4DjC,KAA5D,CAAkE,IAAlE,EAAwE9/B,SAAxE,CAAP;AACH;AAnBU,CAAf,E;;;;;;;;;;;;ACRA,IAAAw/B,eAAA;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACFhtB,OAAOitB,OAAP,CACC;AAAAyC,yBAAuB,UAACpc,UAAD,EAAa2W,OAAb,EAAsB1E,SAAtB;AACtB,WAAOyH,gBAAgB0C,qBAAhB,CAAsCpC,KAAtC,CAA4C,IAA5C,EAAkD9/B,SAAlD,CAAP;AADD;AAGAmiC,uBAAqB,UAACrc,UAAD,EAAa2W,OAAb,EAAsB1E,SAAtB,EAAiC3iB,WAAjC,EAA8CM,WAA9C;AACpB,WAAO8pB,gBAAgB2C,mBAAhB,CAAoCrC,KAApC,CAA0C,IAA1C,EAAgD9/B,SAAhD,CAAP;AAJD;AAMAoiC,uBAAqB,UAACtc,UAAD,EAAa2W,OAAb,EAAsB1E,SAAtB,EAAiC9I,eAAjC,EAAkD7Z,WAAlD,EAA+DitB,SAA/D,EAA0EC,eAA1E;AACpB,WAAO9C,gBAAgB4C,mBAAhB,CAAoCtC,KAApC,CAA0C,IAA1C,EAAgD9/B,SAAhD,CAAP;AAPD;AAUAuiC,oBAAkB,UAACC,IAAD,EAAOC,YAAP;AACjB,WAAOjD,gBAAgB+C,gBAAhB,CAAiCzC,KAAjC,CAAuC,IAAvC,EAA6C9/B,SAA7C,CAAP;AAXD;AAAA,CADD,E;;;;;;;;;;;;ACDA,IAAAw/B,eAAA;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACFhtB,OAAOitB,OAAP,CACC;AAAAiD,mBAAiB,UAAC5T,OAAD,EAAUuE,MAAV;AAChB,WAAOmM,gBAAgBkD,eAAhB,CAAgC5C,KAAhC,CAAsC,IAAtC,EAA4C9/B,SAA5C,CAAP;AADD;AAAA,CADD,E;;;;;;;;;;;;ACDA,IAAAw/B,eAAA;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACFhtB,OAAOitB,OAAP,CACC;AAAAkD,mBAAiB,UAACC,YAAD,EAAeC,YAAf,EAA6BC,eAA7B,EAA8CxH,WAA9C,EAA2DyH,YAA3D,EAAyEzB,QAAzE;AAChB,WAAO9B,gBAAgBmD,eAAhB,CAAgC7C,KAAhC,CAAsC,IAAtC,EAA4C9/B,SAA5C,CAAP;AADD;AAAA,CADD,E;;;;;;;;;;;;ACDA,IAAAw/B,eAAA;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACFhtB,OAAOitB,OAAP,CACC;AAAAuD,6BAA2B,UAACC,SAAD,EAAY1sB,SAAZ,EAAuB2sB,MAAvB;AAC1B,WAAO1D,gBAAgBwD,yBAAhB,CAA0ClD,KAA1C,CAAgD,IAAhD,EAAsD9/B,SAAtD,CAAP;AADD;AAAA,CADD,E;;;;;;;;;;;;ACDA,IAAAmjC,KAAA,EAAA3D,eAAA;;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACF2D,QAAQ3rB,QAAQ,MAAR,CAAR;AAEAhF,OAAOitB,OAAP,CACC;AAAAjM,yBAAuB,UAACwO,OAAD,EAAUx5B,IAAV;AACtB,WAAOg3B,gBAAgBhM,qBAAhB,CAAsCsM,KAAtC,CAA4C,IAA5C,EAAkD9/B,SAAlD,CAAP;AADD;AAAA,CADD,E;;;;;;;;;;;;ACHA,IAAAw/B,eAAA;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACFhtB,OAAOitB,OAAP,CACC;AAAA2D,qBAAmB,UAACzD,MAAD,EAASn3B,IAAT;AAClB,WAAOg3B,gBAAgB4D,iBAAhB,CAAkCtD,KAAlC,CAAwC,IAAxC,EAA8C9/B,SAA9C,CAAP;AADD;AAAA,CADD,E;;;;;;;;;;;;ACDA,IAAAw/B,eAAA;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACFhtB,OAAOitB,OAAP,CACC;AAAA4D,kBAAgB,UAAC1D,MAAD,EAAS2D,SAAT;AACf,WAAO9D,gBAAgB6D,cAAhB,CAA+BvD,KAA/B,CAAqC,IAArC,EAA2C9/B,SAA3C,CAAP;AADD;AAGAujC,2BAAyB,UAAC5D,MAAD,EAAS/c,iBAAT;AACxB,WAAO4c,gBAAgB+D,uBAAhB,CAAwCzD,KAAxC,CAA8C,IAA9C,EAAoD9/B,SAApD,CAAP;AAJD;AAAA,CADD,E;;;;;;;;;;;;ACDA,IAAAw/B,eAAA;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACFhtB,OAAOitB,OAAP,CACC;AAAA+D,sBAAoB,UAAC9hC,IAAD;AACnB,WAAO89B,gBAAgBgE,kBAAhB,CAAmC1D,KAAnC,CAAyC,IAAzC,EAA+C9/B,SAA/C,CAAP;AADD;AAGAyjC,kBAAgB,UAAC/hC,IAAD;AACf,WAAO89B,gBAAgBiE,cAAhB,CAA+B3D,KAA/B,CAAqC,IAArC,EAA2C9/B,SAA3C,CAAP;AAJD;AAAA,CADD,E;;;;;;;;;;;;ACDA,IAAAw/B,eAAA;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACFhtB,OAAOitB,OAAP,CACC;AAAAiE,cAAY,UAAC9tB,KAAD,EAAQ+tB,MAAR,EAAgB5/B,KAAhB;AAEX,WAAOy7B,gBAAgBkE,UAAhB,CAA2B5D,KAA3B,CAAiC,IAAjC,EAAuC9/B,SAAvC,CAAP;AAFD;AAAA,CADD,E;;;;;;;;;;;;ACDA,IAAAw/B,eAAA;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACFhtB,OAAOitB,OAAP,CACC;AAAAmE,uBAAqB,UAACjE,MAAD;AACpB,WAAOH,gBAAgBoE,mBAAhB,CAAoC9D,KAApC,CAA0C,IAA1C,EAAgD9/B,SAAhD,CAAP;AADD;AAAA,CADD,E;;;;;;;;;;;;ACDA,IAAAw/B,eAAA;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACFhtB,OAAOitB,OAAP,CACC;AAAA,yBAAuB,UAAC7pB,KAAD,EAAQiuB,UAAR,EAAoBC,OAApB;AACtB,WAAOtE,gBAAgBuE,mBAAhB,CAAoCjE,KAApC,CAA0C,IAA1C,EAAgD9/B,SAAhD,CAAP;AADD;AAGA,+BAA6B,UAAC4V,KAAD,EAAQiuB,UAAR,EAAoBC,OAApB;AAC5B,WAAOtE,gBAAgBwE,yBAAhB,CAA0ClE,KAA1C,CAAgD,IAAhD,EAAsD9/B,SAAtD,CAAP;AAJD;AAMA,qBAAmB,UAAC+1B,WAAD;AAClB,WAAOyJ,gBAAgByE,eAAhB,CAAgCnE,KAAhC,CAAsC,IAAtC,EAA4C9/B,SAA5C,CAAP;AAPD;AAAA,CADD,E;;;;;;;;;;;;ACDA,IAAAw/B,eAAA;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACFhtB,OAAOitB,OAAP,CACC;AAAAyE,qBAAmB,UAACrmB,KAAD;AAClB,WAAO2hB,gBAAgB0E,iBAAhB,CAAkCpE,KAAlC,CAAwC,IAAxC,EAA8C9/B,SAA9C,CAAP;AADD;AAAA,CADD,E;;;;;;;;;;;;;;;;;;;;;;;;ACDA,IAAAw/B,eAAA;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACFhtB,OAAOitB,OAAP,CAEC;AAAA0E,iBAAe,UAACC,KAAD,EAAQC,SAAR;AACd,WAAO7E,gBAAgB2E,aAAhB,CAA8BrE,KAA9B,CAAoC,IAApC,EAA0C9/B,SAA1C,CAAP;AADD;AAAA,CAFD,E;;;;;;;;;;;;ACDA,IAAAw/B,eAAA;AAAEA,kBAAoBhoB,QAAQ,mBAAR,EAAAgoB,eAApB;AACFhtB,OAAOitB,OAAP,CACC;AAAA6E,qBAAmB,UAACF,KAAD;AAClB,WAAO5E,gBAAgB8E,iBAAhB,CAAkCxE,KAAlC,CAAwC,IAAxC,EAA8C9/B,SAA9C,CAAP;AADD;AAAA,CADD,E;;;;;;;;;;;;ACDA,IAAAukC,OAAA,EAAAC,mBAAA;AAAAD,UAAU/sB,QAAQ,SAAR,CAAV;;AAEAgtB,sBAAsB,UAAC1F,GAAD,EAAMlzB,GAAN,EAAWmzB,IAAX,EAAiBh1B,OAAjB;AAErB,MAAA06B,cAAA,EAAAC,OAAA,EAAAC,iBAAA,EAAAC,OAAA,EAAAxpB,KAAA,EAAAypB,WAAA,EAAAviB,IAAA,EAAAvO,QAAA,EAAA+R,UAAA,EAAA3S,GAAA,EAAA8K,IAAA,EAAArI,KAAA,EAAAosB,OAAA,EAAA8C,cAAA,EAAA5wB,IAAA,EAAAyZ,MAAA;;AAAAzZ,SAAO2F,QAAQkrB,eAAR,CAAwBjG,GAAxB,EAA6BlzB,GAA7B,CAAP;;AAEA,MAAAkzB,OAAA,QAAA3rB,MAAA2rB,IAAA17B,KAAA,YAAA+P,IAAe6xB,YAAf,GAAe,MAAf,GAAe,MAAf;AACCrX,aAAS9T,QAAQorB,wBAAR,CAAiCnG,IAAI17B,KAAJ,CAAU4hC,YAA3C,CAAT;;AACA,QAAGrX,MAAH;AACCzZ,aAAO1B,OAAOypB,KAAP,CAAanpB,OAAb,CAAqB;AAACC,aAAK4a;AAAN,OAArB,CAAP;AAHF;ACQE;;ADHFqU,YAAUlD,IAAIoE,MAAJ,CAAWttB,KAArB;AAEAkQ,eAAagZ,IAAIoE,MAAJ,CAAW5H,WAAxB;AAEAvnB,aAAWnB,GAAGuhB,SAAH,CAAarhB,OAAb,CAAqB;AAACC,SAAK+S;AAAN,GAArB,CAAX;AAEAlQ,UAAQhD,GAAGsyB,MAAH,CAAUpyB,OAAV,CAAkB;AAACC,SAAKivB;AAAN,GAAlB,CAAR;AAEA6C,gBAAA,CAAA5mB,OAAA6gB,IAAA17B,KAAA,YAAA6a,KAAyB4mB,WAAzB,GAAyB,MAAzB;;AAEA,MAAG,CAAC96B,OAAJ;AACCA,cAAU;AAACwZ,iBAAW;AAAZ,KAAV;AADD;AAGCxZ,YAAQwZ,SAAR,GAAoB,IAApB;ACMC;;ADJF,MAAGshB,gBAAe,GAAlB;AACC,QAAG96B,OAAH;AACCA,cAAQwZ,SAAR,GAAoB,KAApB;AADD;AAGCxZ,gBAAU;AAACwZ,mBAAW;AAAZ,OAAV;AAJF;ACaE;;ADPF,MAAG,CAACxZ,QAAQ0Z,eAAZ;AACC1Z,YAAQ0Z,eAAR,GAA0B,IAA1B;ACSC;;ADPF,MAAG,CAAC7N,KAAJ;AACCgpB,eAAWO,UAAX,CAAsBvzB,GAAtB,EACC;AAAAwR,YAAM,GAAN;AACA1b,YACC;AAAA,iBAAS,mCAAT;AACA,mBAAW;AADX;AAFD,KADD;AAKA;ACWC;;ADTF,MAAI,CAACqS,QAAL;AACC6qB,eAAWO,UAAX,CAAsBvzB,GAAtB,EACC;AAAAwR,YAAM,GAAN;AACA1b,YACC;AAAA,iBAAS,sCAAT;AACA,mBAAW;AADX;AAFD,KADD;AAKA;ACaC;;ADXF,MAAG,CAACwS,IAAJ;AACC0qB,eAAWO,UAAX,CAAsBvzB,GAAtB,EACC;AAAAwR,YAAM,GAAN;AACA1b,YACC;AAAA,iBAAS,oDAAT;AACA,mBAAW;AADX;AAFD,KADD;AAKA;ACeC;;ADbF,MAAGqS,SAAS6B,KAAT,KAAkBosB,OAArB;AACCpD,eAAWO,UAAX,CAAsBvzB,GAAtB,EACC;AAAAwR,YAAM,GAAN;AACA1b,YACC;AAAA,iBAAS,+CAAT;AACA,mBAAW;AADX;AAFD,KADD;AAKA;ACiBC;;ADbFojC,mBAAiBlyB,GAAGuyB,WAAH,CAAeppB,IAAf,CAAoB;AAAE7H,UAAMA,KAAKnB,GAAb;AAAkB6C,WAAOosB;AAAzB,GAApB,EAAwD5N,KAAxD,EAAjB;;AAEA,MAAG0Q,mBAAkB,CAArB;AACC,QAAG,CAAClvB,KAAJ;AACCgpB,iBAAWO,UAAX,CAAsBvzB,GAAtB,EACC;AAAAwR,cAAM,GAAN;AACA1b,cACC;AAAA,mBAAS,uCAAT;AACA,qBAAW;AADX;AAFD,OADD;AAKA;AAPF;AC2BE;;ADjBF+iC,mBAAiB7lB,gBAAgBwmB,sBAAhB,CAAuClxB,IAAvC,EAA6CH,QAA7C,CAAjB;;AAEA,MAAG,CAAC0wB,cAAD,IAAoB1wB,SAAS2C,wBAAhC;AACCiuB,wBAAoBnxB,EAAE6jB,KAAF,CAAQ,CAACtjB,SAAS2C,wBAAV,CAAR,EAA6C3C,SAASshB,yBAAT,IAAsC,EAAnF,CAApB;AAEAoP,qBAAiBjxB,EAAEuI,IAAF,CAAO4oB,iBAAP,EAA0B,UAACU,UAAD;AAC1C,UAAAC,WAAA;;AAAAA,oBAAc1yB,GAAGuhB,SAAH,CAAarhB,OAAb,CAAqB;AAACC,aAAIsyB;AAAL,OAArB,EAAuC;AAAC/yB,gBAAQ;AAACuO,kBAAQ;AAAT;AAAT,OAAvC,CAAd;AAEA,aAAOjC,gBAAgBwmB,sBAAhB,CAAuClxB,IAAvC,EAA6CoxB,WAA7C,CAAP;AAHgB,MAAjB;AC2BC;;ADtBF,MAAG,CAACb,cAAJ;AACCC,cAAU7qB,QAAQI,MAAR,CAAe/F,KAAKnB,GAApB,EAAyB,IAAzB,CAAV;AACAqI,YAAQI,QAAQC,EAAR,CAAW,4BAAX,EAAyC,EAAzC,EAA6CipB,OAA7C,CAAR;AACA94B,QAAI25B,OAAJ,GAAc,OAAd;AACA3G,eAAWO,UAAX,CAAsBvzB,GAAtB,EACC;AAAAwR,YAAM,GAAN;AACA1b,YACC;AAAA,iBAAS0Z,KAAT;AACA,mBAAW;AADX;AAFD,KADD;AAKA;AC0BC;;ADxBFkH,SAAO7K,yBAAyBsK,eAAzB,CAAyC7N,IAAzC,EAA+C0B,KAA/C,EAAsD7B,QAAtD,EAAgEhK,OAAhE,CAAP;AACA66B,YAAU,IAAIY,MAAJ,CAAWljB,IAAX,CAAV;AACA1W,MAAI65B,SAAJ,CAAc,cAAd,EAA8B,0BAA9B;AACA75B,MAAI65B,SAAJ,CAAc,gBAAd,EAAgCb,QAAQ3kC,MAAxC;AACA2L,MAAI65B,SAAJ,CAAc,eAAd,EAA+B,cAAWb,QAAQ3kC,MAAR,GAAiB,CAA5B,IAA8B,GAA9B,GAAiC2kC,QAAQ3kC,MAAxE;AACA2L,MAAI85B,UAAJ,GAAiB,GAAjB;AC0BC,SDzBD95B,IAAI5H,GAAJ,CAAQse,IAAR,CCyBC;ADnIoB,CAAtB;;AA4GAsc,WAAWC,GAAX,CAAe,KAAf,EAAsB,mDAAtB,EAA2E2F,mBAA3E;AAEA5F,WAAWC,GAAX,CAAe,KAAf,EAAsB,kEAAtB,EAA0F,UAACC,GAAD,EAAMlzB,GAAN,EAAWmzB,IAAX;AACzF,MAAAh1B,OAAA;AAAA6B,MAAI65B,SAAJ,CAAc,cAAd,EAA8B,0BAA9B;AACA75B,MAAI65B,SAAJ,CAAc,qBAAd,EAAqC,yBAAuBtqB,UAAU2jB,IAAIoE,MAAJ,CAAWrtB,aAArB,CAA5D;AACAjK,MAAI65B,SAAJ,CAAc,mBAAd,EAAmC,EAAnC;AAEA17B,YAAU;AAACoE,cAAU;AAAX,GAAV;AAEA,SAAOq2B,oBAAoB1F,GAApB,EAAyBlzB,GAAzB,EAA8BmzB,IAA9B,EAAoCh1B,OAApC,CAAP;AAPD,G,CAQA;;;;;AAKA60B,WAAWC,GAAX,CAAe,KAAf,EAAsB,yBAAtB,EAAiD,UAACC,GAAD,EAAMlzB,GAAN,EAAWmzB,IAAX;AAEhD,MAAA7rB,CAAA,EAAAywB,MAAA,EAAAG,OAAA,EAAAjmB,KAAA,EAAAjc,CAAA,EAAAuyB,SAAA,EAAA/wB,KAAA,EAAA+P,GAAA,EAAA8K,IAAA,EAAAwQ,IAAA,EAAAC,IAAA,EAAAiX,cAAA,EAAA3D,OAAA,EAAA4D,SAAA,EAAAC,sBAAA,EAAAC,UAAA,EAAAjE,OAAA;;AAAA,MAAG,CAAChoB,QAAQksB,sBAAR,CAA+BjH,GAA/B,EAAoClzB,GAApC,CAAJ;AACC;ACgCC;;AD9BFi2B,YAAU/C,IAAInR,MAAd;AAEAqU,YAAUlD,IAAIkH,OAAJ,CAAY,YAAZ,CAAV;;AAEA,MAAG,CAAIhE,OAAP;AACCpD,eAAWO,UAAX,CAAsBvzB,GAAtB,EACC;AAAAwR,YAAM,GAAN;AACA1b,YACC;AAAA,iBAAS,wCAAT;AACA,mBAAW;AADX;AAFD,KADD;AAKA;ACgCC;;AD9BFiiC,WAAA,CAAAxwB,MAAA2rB,IAAA17B,KAAA,YAAA+P,IAAoBwwB,MAApB,GAAoB,MAApB;;AAEA,MAAG,CAACA,MAAJ;AACC/E,eAAWO,UAAX,CAAsBvzB,GAAtB,EACC;AAAAwR,YAAM,GAAN;AACA1b,YACC;AAAA,iBAAS,oCAAT;AACA,mBAAW;AADX;AAFD,KADD;AAKA;ACiCC;;AD/BF0B,UAAQ,EAAR;AAEAuiC,mBAAiB,IAAIjxB,IAAJ,GAAWkb,OAAX,EAAjB;AAEAkU,YAAUH,OAAO78B,KAAP,CAAa,GAAb,CAAV;AAGA+W,UAAQjL,GAAGiL,KAAH,CAAS9B,IAAT,CAAc;AAAChJ,SAAK;AAACuiB,WAAKwO;AAAN;AAAN,GAAd,EAAqCvN,KAArC,EAAR;AAEA30B,MAAI,CAAJ;;AACA,SAAMA,IAAIic,MAAM5d,MAAhB;AACCiT,QAAI2K,MAAMjc,CAAN,CAAJ;AACAgkC,gBAAYhzB,GAAGuyB,WAAH,CAAeryB,OAAf,CAAuB;AAAC8C,aAAO1C,EAAE0C,KAAV;AAAiB1B,YAAM2tB;AAAvB,KAAvB,CAAZ;;AACA,QAAG,CAAC+D,SAAJ;AACChH,iBAAWO,UAAX,CAAsBvzB,GAAtB,EACC;AAAAwR,cAAM,GAAN;AACA1b,cACC;AAAA,mBAAS,gDAA8CwR,EAAEH,GAAzD;AACA,qBAAW;AADX;AAFD,OADD;AAKA;AAND,YC6CG;;ADnCH,QAAG,CAAC8G,QAAQosB,YAAR,CAAqBjE,OAArB,EAA8BH,OAA9B,CAAJ;AACCgE,+BAAyBjzB,GAAGszB,aAAH,CAAiBnqB,IAAjB,CAAsB;AAC9ChJ,aAAK;AACJuiB,eAAKsQ,UAAUM;AADX;AADyC,OAAtB,EAItB3P,KAJsB,EAAzB;;AAMA,UAAG,CAAC3X,gBAAgBunB,UAAhB,CAA2BjzB,CAA3B,EAA8B0yB,SAA9B,EAAyCC,sBAAzC,CAAD,IAAqE,CAACjnB,gBAAgBwnB,QAAhB,CAAyBlzB,CAAzB,EAA4B0yB,SAA5B,EAAuCC,sBAAvC,CAAzE;AACCjH,mBAAWO,UAAX,CAAsBvzB,GAAtB,EACC;AAAAwR,gBAAM,GAAN;AACA1b,gBACC;AAAA,qBAAS,gDAA8CwR,EAAEH,GAAzD;AACA,uBAAW;AADX;AAFD,SADD;AAKA;AAbF;ACoDG;;ADtCHnR;AA3BD;;AA8BAwB,QAAMgT,IAAN,GAAa;AAACkf,SAAKwO;AAAN,GAAb;AAEA1gC,QAAMwS,KAAN,GAAcosB,OAAd;;AAEA,OAAA/jB,OAAA6gB,IAAA17B,KAAA,YAAA6a,KAAc6nB,UAAd,GAAc,MAAd;AACCA,iBAAa,IAAIpxB,IAAJ,CAASQ,OAAO4pB,IAAI17B,KAAJ,CAAU0iC,UAAjB,CAAT,CAAb;AACA1iC,UAAMiS,QAAN,GAAiB;AAACgxB,WAAKP;AAAN,KAAjB;ACyCC;;ADvCF,OAAArX,OAAAqQ,IAAA17B,KAAA,YAAAqrB,KAAcjL,cAAd,GAAc,MAAd;AACCpgB,UAAMogB,cAAN,GAAuB;AAAC8R,WAAMwJ,IAAI17B,KAAJ,CAAUogB,cAAV,CAAyB1c,KAAzB,CAA+B,GAA/B;AAAP,KAAvB;AADD;AAGC1D,UAAMogB,cAAN,GAAuB;AAAC8iB,YAAM,CAAC,YAAD,EAAe,UAAf;AAAP,KAAvB;AC6CC;;AD3CF,OAAA5X,OAAAoQ,IAAA17B,KAAA,YAAAsrB,KAAczP,KAAd,GAAc,MAAd;AACC7b,UAAM6b,KAAN,GAAc;AAACqW,WAAKwJ,IAAI17B,KAAJ,CAAU6b,KAAV,CAAgBnY,KAAhB,CAAsB,GAAtB;AAAN,KAAd;AADD;AAGC1D,UAAM6b,KAAN,GAAc,WAAd;AC+CC;;AD5CFkV,cAAYvhB,GAAGuhB,SAAH,CAAapY,IAAb,CAAkB3Y,KAAlB,EAAyB;AAACkP,YAAQ;AAACi0B,kBAAY,CAAb;AAAgBC,gBAAU,CAA1B;AAA6BC,oBAAc,CAA3C;AAA8C5lB,cAAQ,CAAtD;AAAyDwV,mBAAa;AAAtE,KAAT;AAAmFqQ,UAAM,CAAzF;AAA4FC,WAAO;AAAnG,GAAzB,EAAkIpQ,KAAlI,EAAZ;AACApC,YAAUlhB,OAAV,CAAkB,UAACc,QAAD;AAEjB,QAAAsiB,WAAA;AAAAA,kBAAcnC,IAAIC,SAAJ,CAAcpY,IAAd,CAAmB;AAAC,2BAAqBhI,SAAShB,GAA/B;AAAmC,0BAAoB,IAAvD;AAA6D,6BAAuB;AAACoiB,aAAK;AAAN;AAApF,KAAnB,EAAqH;AAAC7iB,cAAQ;AAACs0B,gBAAQ;AAAT;AAAT,KAArH,EAA4IrQ,KAA5I,EAAd;ACkEE,WDhEFxiB,SAASsiB,WAAT,GAAuBA,WCgErB;ADpEH;AAOAuI,aAAWO,UAAX,CAAsBvzB,GAAtB,EACE;AAAAwR,UAAM,GAAN;AACA1b,UACC;AAAA,gBAAU,SAAV;AACA,oBAAcikC,cADd;AAEA,cAAQxR;AAFR;AAFD,GADF;AA9FD,G;;;;;;;;;;;;AE5HAyK,WAAWC,GAAX,CAAe,KAAf,EAAsB,cAAtB,EAAsC,UAACC,GAAD,EAAMlzB,GAAN,EAAWmzB,IAAX;AACrC,MAAA8H,MAAA,EAAA7kB,UAAA;AAAApW,MAAI65B,SAAJ,CAAc,cAAd,EAA8B,UAA9B;AACAoB,WAASC,OAAOC,oBAAP,EAAT;AAEA/kB,eAAa,EAAb;AAEA6kB,SAAO5zB,OAAP,CAAe,UAAC+zB,GAAD;AACd,QAAA7kB,OAAA,EAAA8kB,OAAA;;AAAA,QAAGC,0BAA0BC,oBAA7B;AACCF,gBAAUC,0BAA0BE,QAApC;;AACA,UAAGH,QAAQI,QAAR,CAAiB,GAAjB,CAAH;AACCllB,kBAAU8kB,QAAQjmC,OAAR,CAAgBkmC,0BAA0BC,oBAA1B,GAAiD,GAAjE,EAAsE,EAAtE,IAA4EH,IAAInnC,GAA1F;AADD;AAGCsiB,kBAAU8kB,QAAQjmC,OAAR,CAAgBkmC,0BAA0BC,oBAA1C,EAAgE,EAAhE,IAAsEH,IAAInnC,GAApF;AALF;AAAA;AAOCsiB,gBAAU3P,OAAOsH,WAAP,CAAmBktB,IAAInnC,GAAvB,CAAV;ACCE;;AACD,WDDFmiB,cAAc,iBAAeG,OAAf,GAAuB,ICCnC;ADVH;AAWAvW,MAAI85B,UAAJ,GAAiB,GAAjB;ACEC,SDDD95B,IAAI5H,GAAJ,CAAQge,UAAR,CCCC;ADnBF,G;;;;;;;;;;;;AEDA4c,WAAWC,GAAX,CAAe,KAAf,EAAsB,6CAAtB,EAAqE,UAACC,GAAD,EAAMlzB,GAAN,EAAWmzB,IAAX;AACpE,MAAA6F,OAAA,EAAAxuB,IAAA,EAAAutB,MAAA,EAAAzxB,IAAA,EAAAoQ,IAAA,EAAAvO,QAAA,EAAAhK,OAAA,EAAA6L,KAAA,EAAAosB,OAAA,EAAA9tB,IAAA,EAAA2tB,OAAA;;AAAA,MAAG,CAAChoB,QAAQksB,sBAAR,CAA+BjH,GAA/B,EAAoClzB,GAApC,CAAJ;AACC;ACEC;;ADAFi2B,YAAU/C,IAAInR,MAAd;AAEAzZ,SAAOtB,GAAGqpB,KAAH,CAASnpB,OAAT,CAAiB;AAAEC,SAAK8uB;AAAP,GAAjB,CAAP;AAEAG,YAAUlD,IAAIoE,MAAJ,CAAWttB,KAArB;AAEA+tB,WAAS7E,IAAIoE,MAAJ,CAAW9sB,IAApB;AAEAR,UAAQhD,GAAGsyB,MAAH,CAAUpyB,OAAV,CAAkB;AAAEC,SAAKivB;AAAP,GAAlB,CAAR;AAEA5rB,SAAOxD,GAAGiL,KAAH,CAAS/K,OAAT,CAAiB;AAAEC,SAAK4wB;AAAP,GAAjB,EAAkC;AAAErxB,YAAQ;AAAE9J,YAAM,CAAR;AAAW,qBAAe,CAA1B;AAA6B0J,YAAM;AAAnC;AAAV,GAAlC,CAAP;AAEAA,SAAOU,GAAGC,KAAH,CAASC,OAAT,CAAiB;AAAEC,SAAKqD,KAAKlE;AAAZ,GAAjB,EAAqC;AAAEI,YAAQ;AAAE,qBAAe;AAAjB;AAAV,GAArC,CAAP;AAEAvI,YAAU;AACTwZ,eAAW,KADF;AAETE,qBAAiB,KAFR;AAGTrD,kBAAc,SAHL;AAITZ,cAAU,IAJD;AAKTyD,WAAO,MALE;AAMTtC,oBAAgB,kBANP;AAOTkD,aAAS,wMAKCzN,KAAK5N,IALN,GAKW;AAZX,GAAV;AA6BAuL,aAAW;AACVqC,UAAMA,KAAKrD,GADD;AAEV6K,kBAAcxH,KAAKoH,OAAL,CAAazK,GAFjB;AAGVb,UAAMA,KAAKa,GAHD;AAIVZ,kBAAcD,KAAKsL,OAAL,CAAazK,GAJjB;AAKV+B,YAAQ,EALE;AAMVtM,UAAM4N,KAAK5N,IAND;AAOVoN,WAAOosB;AAPG,GAAX;AAUA1f,SAAO7K,yBAAyBsK,eAAzB,CAAyC7N,IAAzC,EAA+C0B,KAA/C,EAAsD7B,QAAtD,EAAgEhK,OAAhE,CAAP;AAEA66B,YAAU,IAAIY,MAAJ,CAAWljB,IAAX,CAAV;AAEA1W,MAAI65B,SAAJ,CAAc,gBAAd,EAAgCb,QAAQ3kC,MAAxC;AAEA2L,MAAI65B,SAAJ,CAAc,eAAd,EAA+B,cAAWb,QAAQ3kC,MAAR,GAAiB,CAA5B,IAA8B,GAA9B,GAAiC2kC,QAAQ3kC,MAAxE;AAEA2L,MAAI85B,UAAJ,GAAiB,GAAjB;ACZC,SDcD95B,IAAI5H,GAAJ,CAAQse,IAAR,CCdC;ADrDF,G;;;;;;;;;;;AEAA/P,KAAK,CAAC7R,SAAN,CAAgBoqB,cAAhB,GAAiC,UAASwc,CAAT,EAAY9kC,CAAZ,EAAc;AAC3C,MAAI+kC,CAAC,GAAG,EAAR;AACA,OAAKt0B,OAAL,CAAa,UAASpL,CAAT,EAAW;AACpB,QAAI2/B,CAAC,GAAG3/B,CAAC,GAAEA,CAAC,CAACy/B,CAAD,CAAH,GAAO,IAAhB;AACA,QAAIz3B,CAAC,GAAG,KAAR;;AACA,QAAG23B,CAAC,YAAYj1B,KAAhB,EAAsB;AAClB1C,OAAC,GAAG23B,CAAC,CAACriB,QAAF,CAAW3iB,CAAX,CAAJ;AACH,KAFD,MAEK;AACDqN,OAAC,GAAIrN,CAAC,KAAKrC,SAAP,GAAmB,KAAnB,GAAyBqnC,CAAC,IAAEhlC,CAAhC;AACH;;AACD,QAAGqN,CAAH,EAAK;AACD03B,OAAC,CAAC9+B,IAAF,CAAOZ,CAAP;AACH;AACJ,GAXD;AAYA,SAAO0/B,CAAP;AACH,CAfD;;AAiBAh1B,KAAK,CAAC7R,SAAN,CAAgB4a,WAAhB,GAA8B,UAASmsB,CAAT,EAAW;AACrC,MAAIvoC,CAAC,GAAG,IAAIqT,KAAJ,EAAR;AACA,OAAKU,OAAL,CAAa,UAASpL,CAAT,EAAW;AACpB,QAAI2/B,CAAC,GAAG3/B,CAAC,GAAEA,CAAC,CAAC4/B,CAAD,CAAH,GAAO,IAAhB;AACAvoC,KAAC,CAACuJ,IAAF,CAAO++B,CAAP;AACH,GAHD;AAIA,SAAOtoC,CAAP;AACH,CAPD;;AASAqT,KAAK,CAAC7R,SAAN,CAAgBgnC,OAAhB,GAA0B,UAAStqB,IAAT,EAAc;AACpC,MAAIe,GAAG,GAAG,EAAV;;AACA,OAAI,IAAIvc,CAAC,GAAG,CAAZ,EAAgBA,CAAC,GAAG,KAAK3B,MAAzB,EAAkC2B,CAAC,EAAnC,EAAsC;AAClCuc,OAAG,CAAC1V,IAAJ,CAAS,KAAK7G,CAAL,EAAQwb,IAAR,CAAT;AACH;;AACD,SAAOe,GAAP;AACH,CAND;;AAQA5L,KAAK,CAAC7R,SAAN,CAAgBinC,IAAhB,GAAuB,YAAU;AAC7B,MAAIrhB,CAAC,GAAG,EAAR;AACA,OAAKrT,OAAL,CAAa,UAASsT,CAAT,EAAW;AACpB,QAAGD,CAAC,CAAC9e,OAAF,CAAU+e,CAAV,IAAe,CAAlB,EACI;AAACD,OAAC,CAACA,CAAC,CAACrmB,MAAH,CAAD,GAAcsmB,CAAd;AAAgB;AACxB,GAHD;AAIA,SAAOD,CAAP;AACH,CAPD;;AASAmC,YAAY,GAAG,EAAf;;AAGAA,YAAY,CAACmf,KAAb,GAAqB,UAASC,IAAT,EAAe97B,GAAf,EAAmB;AACpC,OAAI,IAAI/C,GAAR,IAAe+C,GAAf,EAAmB;AACf87B,QAAI,CAAC7+B,GAAD,CAAJ,GAAY+C,GAAG,CAAC/C,GAAD,CAAf;AACH;;AACD,SAAO6+B,IAAP;AACH,CALD;;AAQApf,YAAY,CAACqf,gBAAb,GAAgC,UAASpc,CAAT,EAAW;AAEvC,MAAGA,CAAC,YAAYnZ,KAAhB,EAAsB;AAClB,QAAI2B,IAAI,GAAG,EAAX;AAEAA,QAAI,CAAC1L,IAAL,GAAYkjB,CAAC,CAACpQ,WAAF,CAAc,MAAd,CAAZ;AACApH,QAAI,CAAC6zB,YAAL,GAAoB,EAApB;AACA7zB,QAAI,CAAC6zB,YAAL,CAAkBv/B,IAAlB,GAAyBkjB,CAAC,CAACpQ,WAAF,CAAc,cAAd,EAA8BA,WAA9B,CAA0C,MAA1C,CAAzB;AACApH,QAAI,CAAC6zB,YAAL,CAAkBxsB,QAAlB,GAA6BmQ,CAAC,CAACpQ,WAAF,CAAc,cAAd,EAA8BA,WAA9B,CAA0C,UAA1C,CAA7B;AAEApH,QAAI,CAAC8zB,EAAL,GAAUtc,CAAC,CAACpQ,WAAF,CAAc,IAAd,CAAV;AAEApH,QAAI,CAAC+zB,OAAL,GAAevc,CAAC,CAACpQ,WAAF,CAAc,SAAd,CAAf;AAENpH,QAAI,CAACg0B,MAAL,GAAcxc,CAAC,CAACpQ,WAAF,CAAc,QAAd,CAAd;AAEApH,QAAI,CAACi0B,UAAL,GAAkBzc,CAAC,CAACpQ,WAAF,CAAc,YAAd,CAAlB;AAEApH,QAAI,CAACk0B,QAAL,GAAgB1c,CAAC,CAACpQ,WAAF,CAAc,UAAd,CAAhB;AAEM,QAAI+sB,SAAS,GAAG3c,CAAC,CAACpQ,WAAF,CAAc,OAAd,CAAhB;AACA,QAAIgtB,KAAK,GAAG,IAAI/1B,KAAJ,EAAZ;AACA81B,aAAS,CAACp1B,OAAV,CAAkB,UAASrR,CAAT,EAAW;AACzB0mC,WAAK,GAAGA,KAAK,CAACn/B,MAAN,CAAavH,CAAb,CAAR;AACH,KAFD;AAGA0mC,SAAK,CAACX,IAAN;AACAzzB,QAAI,CAACo0B,KAAL,GAAaA,KAAb;AACA,WAAOp0B,IAAP;AACH,GA1BD,MA0BK;AACD,WAAOwX,CAAP;AACH;AACJ,CA/BD;;AAiCAjD,YAAY,CAAC8f,eAAb,GAA+B,UAAS3c,CAAT,EAAW;AAEtC,MAAGA,CAAC,YAAYrZ,KAAhB,EAAsB;AAClB,QAAIi2B,GAAG,GAAG,EAAV;AACNA,OAAG,CAAC7iB,EAAJ,GAASiG,CAAC,CAACtQ,WAAF,CAAc,KAAd,CAAT;AACMktB,OAAG,CAAChgC,IAAJ,GAAWojB,CAAC,CAACtQ,WAAF,CAAc,MAAd,CAAX;AACAktB,OAAG,CAACjtB,QAAJ,GAAeqQ,CAAC,CAACtQ,WAAF,CAAc,UAAd,CAAf;AAEA,WAAOktB,GAAP;AACH,GAPD,MAOK;AACD,WAAO5c,CAAP;AACH;AACJ,CAZD;AAgBA;;;;;;;AAKAnD,YAAY,CAACggB,mBAAb,GAAmC,UAASn2B,MAAT,EAAiBo2B,WAAjB,EAA8BC,QAA9B,EAAwC3yB,SAAxC,EAAmDgsB,OAAnD,EAA2D;AAC1F,MAAI4G,QAAQ,GAAG,EAAf,CAD0F,CAE1F;;AACA,MAAGt2B,MAAM,IAAIA,MAAM,CAACrS,MAAjB,IAA2ByoC,WAA9B,EAA2C;AACvC;AACAp2B,UAAM,CAACW,OAAP,CAAe,UAAS+G,KAAT,EAAe;AAC1B,UAAIjV,IAAI,GAAGiV,KAAK,CAACjV,IAAjB;;AACA,UAAGA,IAAH,EAAS;AACL,YAAGA,IAAI,KAAK,OAAZ,EAAqB;AACjB;;;;;;;AAOA,cAAI8jC,WAAW,GAAG7uB,KAAK,CAACsN,OAAxB;AAAA,cACIwhB,WAAW,GAAGJ,WAAW,CAAC1uB,KAAK,CAACoD,IAAP,CAD7B;AAAA,cAEI2rB,kBAAkB,GAAG,EAFzB;AAAA,cAGIC,aAAa,GAAG,EAHpB,CARiB,CAYjB;;AACA,cAAGH,WAAW,IAAIA,WAAW,CAAC5oC,MAA3B,IAAqC6oC,WAArC,IAAoDA,WAAW,YAAYv2B,KAA9E,EAAqF;AACjFu2B,uBAAW,CAAC71B,OAAZ,CAAoB,UAAS4U,UAAT,EAAoB;AACpCkhB,gCAAkB,CAACtgC,IAAnB,CAAwBggB,YAAY,CAACggB,mBAAb,CAAiCI,WAAjC,EAA8ChhB,UAA9C,CAAxB;AACH,aAFD,EAEG,IAFH,EADiF,CAIjF;;AACAghB,uBAAW,CAAC51B,OAAZ,CAAoB,UAASg2B,UAAT,EAAoB;AACpCD,2BAAa,CAACC,UAAU,CAAC7rB,IAAZ,CAAb,GAAiC2rB,kBAAkB,CAACrB,OAAnB,CAA2BuB,UAAU,CAAC7rB,IAAtC,CAAjC;AACH,aAFD;AAGAwrB,oBAAQ,GAAGngB,YAAY,CAACmf,KAAb,CAAmBgB,QAAnB,EAA6BI,aAA7B,CAAX;AACH;AACJ,SAvBD,MAuBO,IAAIjkC,IAAI,IAAI,MAAZ,EAAmB;AACtB6jC,kBAAQ,CAAC5uB,KAAK,CAACoD,IAAP,CAAR,GAAuBqL,YAAY,CAACqf,gBAAb,CAA8BlpB,eAAe,CAACsqB,qBAAhB,CAAsClH,OAAtC,EAA+C0G,WAAW,CAAC1uB,KAAK,CAACoD,IAAP,CAA1D,CAA9B,CAAvB;AAEH,SAHM,MAGA,IAAIrY,IAAI,IAAI,OAAZ,EAAoB;AACvB6jC,kBAAQ,CAAC5uB,KAAK,CAACoD,IAAP,CAAR,GAAuBqL,YAAY,CAAC8f,eAAb,CAA6B3pB,eAAe,CAACuqB,oBAAhB,CAAqCT,WAAW,CAAC1uB,KAAK,CAACoD,IAAP,CAAhD,CAA7B,CAAvB;AAEH,SAHM,MAGA,IAAIrY,IAAI,IAAI,OAAZ,EAAoB;AACtC6jC,kBAAQ,CAAC5uB,KAAK,CAACoD,IAAP,CAAR,GAAuBsrB,WAAW,CAAC1uB,KAAK,CAACoD,IAAP,CAAX,IAA2B,EAAlD;AAEA,SAHkB,MAGZ;AACS;AACAwrB,kBAAQ,CAAC5uB,KAAK,CAACoD,IAAP,CAAR,GAAuBsrB,WAAW,CAAC1uB,KAAK,CAACoD,IAAP,CAAlC;AACH;AACJ;AACJ,KAxCD,EAwCG,IAxCH;AAyCH,GA9CyF,CA+C1F;;;AACAwrB,UAAQ,CAAC,UAAD,CAAR,GAAuBhqB,eAAe,CAACwqB,oBAAhB,CAAqCpH,OAArC,EAA8C2G,QAA9C,CAAvB,CAhD0F,CAiD1F;;AACAC,UAAQ,CAAC,WAAD,CAAR,GAAwBhqB,eAAe,CAACwqB,oBAAhB,CAAqCpH,OAArC,EAA8ChsB,SAA9C,CAAxB;AAEA,SAAO4yB,QAAP;AACH,CArDD,C;;;;;;;;;;;;AC5GAp2B,OAAO62B,OAAP,CAAe,YAAf,EAA6B,UAACrH,OAAD;AAC5BsH,QAAMtH,OAAN,EAAe7gC,MAAf;;AAEA,OAAO,KAAKwsB,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACAC;;ADEF,OAAOvH,OAAP;AACC,WAAO,KAAKuH,KAAL,EAAP;ACAC;;ADGF,SAAO32B,GAAG42B,UAAH,CAAcztB,IAAd,CAAmB;AAAEnG,WAAOosB;AAAT,GAAnB,EAAuC;AAAE1vB,YAAQ;AAAE9J,YAAM,CAAR;AAAWoN,aAAO,CAAlB;AAAqBqyB,eAAS,CAA9B;AAAiCwB,WAAK;AAAtC;AAAV,GAAvC,CAAP;AAVD,G;;;;;;;;;;;;AECAj3B,OAAO62B,OAAP,CAAe,eAAf,EAAgC,UAACtT,WAAD;AAC/BuT,QAAMvT,WAAN,EAAmBxjB,KAAnB;;AAEA,OAAO,KAAKob,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACDC;;ADGF,OAAOxT,WAAP;AACE,WAAO,KAAKwT,KAAL,EAAP;ACDA;;ADGF,SAAOrV,IAAIC,SAAJ,CAAcpY,IAAd,CAAmB;AAAC,yBAAqB;AAACuZ,WAAKS;AAAN,KAAtB;AAA2CO,SAAK,CAAC;AAAC,6BAAuB;AAACnB,aAAK;AAAN;AAAxB,KAAD,EAAsC;AAAC,6BAAuB,IAAxB;AAA8B,wBAAkB,KAAKxH;AAArD,KAAtC;AAAhD,GAAnB,CAAP;AATD,G;;;;;;;;;;;;AECAnb,OAAO62B,OAAP,CAAe,gBAAf,EAAiC,UAACrH,OAAD;AAEhC,OAAO,KAAKrU,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACFC;;ADIF,OAAOvH,OAAP;AACC,WAAO,KAAKuH,KAAL,EAAP;ACFC;;ADIF,SAAO32B,GAAG82B,cAAH,CAAkB3tB,IAAlB,CAAuB;AAACnG,WAAOosB;AAAR,GAAvB,EAAyC;AAAC1vB,YAAQ;AAACq3B,YAAK,CAAN;AAAS1N,aAAO,CAAhB;AAAmBuM,WAAK;AAAxB;AAAT,GAAzC,CAAP;AARD,G;;;;;;;;;;;;AEFAh2B,OAAOo3B,gBAAP,CAAwB,wBAAxB,EAAkD,UAACC,SAAD,EAAYrL,GAAZ,EAAiBlsB,MAAjB;AACjDg3B,QAAMO,SAAN,EAAiB1oC,MAAjB;AACAmoC,QAAM9K,GAAN,EAAWjsB,KAAX;AACA+2B,QAAMh3B,MAAN,EAAcw3B,MAAMC,QAAN,CAAenpC,MAAf,CAAd;;AAEA,OAAO,KAAK+sB,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACAC;;ADEF,OAAKS,OAAL;ACAC,SDED;AAAAjuB,UAAM;AACL,WAAKiuB,OAAL;ACAI,aDCJp3B,GAAG82B,cAAH,CAAkB3tB,IAAlB,CAAuB;AAAChJ,aAAK;AAACuiB,eAAKkJ;AAAN;AAAN,OAAvB,EAA0C;AAAAlsB,gBAAQA;AAAR,OAA1C,CCDI;ADDL;AAIA23B,cAAU,CACT;AACCluB,YAAM,UAACqsB,QAAD;AACL,aAAC4B,OAAD;ACMM,eDJNp3B,GAAGs3B,UAAH,CAAcnuB,IAAd,CAAmB;AAAEhJ,eAAKq1B,SAASuB;AAAhB,SAAnB,EAA2C;AAAAr3B,kBAAQ;AAAA9J,kBAAM;AAAN;AAAR,SAA3C,CCIM;ADRR;AAAA,KADS,EAOT;AACCuT,YAAM,UAACqsB,QAAD;AACL,aAAC4B,OAAD;ACWM,eDTNp3B,GAAGszB,aAAH,CAAiBnqB,IAAjB,CAAsB;AAAEhJ,eAAKq1B,SAASI;AAAhB,SAAtB,EAA6C;AAAAl2B,kBAAQ;AAAAiJ,sBAAU;AAAV;AAAR,SAA7C,CCSM;ADbR;AAAA,KAPS,EAaT;AACCQ,YAAM,UAACqsB,QAAD;AACL,aAAC4B,OAAD;ACgBM,eDdNp3B,GAAGuyB,WAAH,CAAeppB,IAAf,CAAoB;AACnBnG,iBAAOwyB,SAASxyB,KADG;AAEnB1B,gBAAM;AAAAohB,iBAAK8S,SAASnM;AAAd;AAFa,SAApB,EAGG;AAAA3pB,kBACF;AAAAsD,mBAAO,CAAP;AACA1B,kBAAM,CADN;AAEA1L,kBAAM;AAFN;AADE,SAHH,CCcM;ADlBR;AAAA,KAbS;AAJV,GCFC;ADRF,G;;;;;;;;;;;;AEECgK,OAAO62B,OAAP,CAAe,YAAf,EAA6B,UAACrH,OAAD;AAE5B,OAAO,KAAKrU,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACFA;;ADID,OAAOvH,OAAP;AACC,WAAO,KAAKuH,KAAL,EAAP;ACFA;;ADKD,SAAO32B,GAAGs3B,UAAH,CAAcnuB,IAAd,CAAmB;AAACnG,WAAOosB;AAAR,GAAnB,EAAqC;AAAC1vB,YAAQ;AAAC9J,YAAK;AAAN;AAAT,GAArC,CAAP;AATD,G;;;;;;;;;;;;AEFDgK,OAAO62B,OAAP,CAAe,OAAf,EAAwB,UAACrH,OAAD;AACvB,OAAO,KAAKrU,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACCC;;ADCF,OAAOvH,OAAP;AACC,WAAO,KAAKuH,KAAL,EAAP;ACCC;;ADEF,MAAG32B,GAAGiL,KAAH,CAAS9B,IAAT,CAAc;AAACnG,WAAOosB;AAAR,GAAd,EAAgC5N,KAAhC,OAA2C,CAA9C;AACCxhB,OAAGsyB,MAAH,CAAUiF,yBAAV,CAAoCnI,OAApC;ACEC;;ADAF,SAAOpvB,GAAGiL,KAAH,CAAS9B,IAAT,CAAc;AAACnG,WAAOosB;AAAR,GAAd,EAAgC;AACtC1vB,YAAQ;AACP9J,YAAM,CADC;AAEP0J,YAAM,CAFC;AAGP+M,aAAO,CAHA;AAIPmrB,aAAO,CAJA;AAKPx0B,aAAO,CALA;AAMPy0B,kBAAY,CANL;AAOPpC,eAAS,CAPF;AAQPqC,iCAA2B,CARpB;AASPC,0BAAoB,CATb;AAUPC,uBAAiB;AAVV;AAD8B,GAAhC,CAAP;AAXD;AA0BAh4B,OAAO62B,OAAP,CAAe,eAAf,EAAgC,UAACrH,OAAD,EAAU2B,MAAV;AAC/B,OAAO,KAAKhW,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACKC;;ADHF,OAAOvH,OAAP;AACC,WAAO,KAAKuH,KAAL,EAAP;ACKC;;ADHF,OAAO5F,MAAP;AACC,WAAO,KAAK4F,KAAL,EAAP;ACKC;;ADHF,SAAO32B,GAAGiL,KAAH,CAAS9B,IAAT,CAAc;AAAChJ,SAAK4wB,MAAN;AAAc/tB,WAAOosB;AAArB,GAAd,EAA6C;AACnD1vB,YAAQ;AACP9J,YAAM,CADC;AAEP0J,YAAM,CAFC;AAGP+M,aAAO,CAHA;AAIPmrB,aAAO,CAJA;AAKPx0B,aAAO,CALA;AAMPy0B,kBAAY,CANL;AAOPpC,eAAS,CAPF;AAQPqC,iCAA2B,CARpB;AASPC,0BAAoB,CATb;AAUPC,uBAAiB;AAVV;AAD2C,GAA7C,CAAP;AAVD;AA0BAh4B,OAAO62B,OAAP,CAAe,cAAf,EAA+B,UAACrH,OAAD,EAAU2B,MAAV,EAAkB8G,SAAlB;AAC9B,MAAA9sB,cAAA,EAAA+sB,MAAA,EAAAC,IAAA;;AAAA,OAAO,KAAKhd,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACSC;;ADPF,OAAOvH,OAAP;AACC,WAAO,KAAKuH,KAAL,EAAP;ACSC;;ADPF,OAAO5F,MAAP;AACC,WAAO,KAAK4F,KAAL,EAAP;ACSC;;ADPF,OAAOkB,SAAP;AACC,WAAO,KAAKlB,KAAL,EAAP;ACSC;;ADNFoB,SAAO,IAAP;;AAEAhtB,mBAAiB,UAACgI,EAAD,EAAM8kB,SAAN;AAChB,QAAAr0B,IAAA,EAAAwH,YAAA;AAAAxH,WAAOxD,GAAGiL,KAAH,CAAS/K,OAAT,CAAiB;AAACC,WAAM4S;AAAP,KAAjB,CAAP;;AACA,QAAGvP,IAAH;AACCwH,qBAAexH,KAAKoH,OAApB;AACAI,mBAAagtB,MAAb,GAAsB,IAAtB;;AAEA,UAAGhtB,aAAa7K,GAAb,KAAoB03B,SAAvB;AACC7sB,uBAAexH,KAAKsH,QAAL,CAAcL,gBAAd,CAA+B,KAA/B,EAAsCotB,SAAtC,CAAf;AACA7sB,qBAAagtB,MAAb,GAAsB,KAAtB;ACSG;;ADPJ,aAAOhtB,YAAP;ACSE;ADnBa,GAAjB;;AAWA8sB,WAAS93B,GAAGiL,KAAH,CAAS9B,IAAT,CAAc;AAAChJ,SAAK4wB;AAAN,GAAd,EAA6B;AAACrxB,YAAQ;AAACS,WAAK,CAAN;AAAS,0BAAoB;AAA7B;AAAT,GAA7B,EAAwE83B,cAAxE,CAAuF;AAC/FC,aAAS,UAACnlB,EAAD;ACkBL,aDjBHglB,KAAKG,OAAL,CAAa,eAAb,EAA8BL,SAA9B,EAAyC9sB,eAAegI,EAAf,EAAmB8kB,SAAnB,CAAzC,CCiBG;ADnB2F;AAAA,GAAvF,CAAT;AAMAE,OAAKI,KAAL,CAAW,eAAX,EAA4BN,SAA5B,EAAuC9sB,eAAegmB,MAAf,EAAuB8G,SAAvB,CAAvC;AACAE,OAAKpB,KAAL;ACiBC,SDhBDoB,KAAKK,MAAL,CAAY;ACiBT,WDhBFN,OAAOO,IAAP,ECgBE;ADjBH,ICgBC;ADnDF;AAsCAz4B,OAAO62B,OAAP,CAAe,2BAAf,EAA4C,UAAC6B,QAAD;AAC3C,OAAO,KAAKvd,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACmBC;;ADjBF,OAAO2B,QAAP;AACC,WAAO,KAAK3B,KAAL,EAAP;ACmBC;;ADjBF,SAAO32B,GAAGiL,KAAH,CAAS9B,IAAT,CAAc;AAAChJ,SAAK;AAACuiB,WAAK4V;AAAN;AAAN,GAAd,EAAsC;AAC5C54B,YAAQ;AACP9J,YAAM,CADC;AAEP0J,YAAM,CAFC;AAGP+M,aAAO,CAHA;AAIPmrB,aAAO,CAJA;AAKPx0B,aAAO,CALA;AAMP00B,iCAA2B,CANpB;AAOPC,0BAAoB,CAPb;AAQPY,mCAA6B,CARtB;AASPd,kBAAY,CATL;AAUPG,uBAAiB;AAVV;AADoC,GAAtC,CAAP;AAPD;AAsBAh4B,OAAO62B,OAAP,CAAe,MAAf,EAAuB,UAACrH,OAAD,EAAU2B,MAAV;AACtB,OAAO,KAAKhW,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACwBC;;ADtBF,OAAOvH,OAAP;AACC,WAAO,KAAKuH,KAAL,EAAP;ACwBC;;ADtBF,OAAO5F,MAAP;AACC,WAAO,KAAK4F,KAAL,EAAP;ACwBC;;ADrBF,SAAO32B,GAAGiL,KAAH,CAAS9B,IAAT,CAAc;AAAChJ,SAAK4wB,MAAN;AAAc/tB,WAAOosB;AAArB,GAAd,EAA6C;AACnD1vB,YAAQ;AACPsU,sBAAgB,CADT;AAEPC,yBAAmB,CAFZ;AAGP+F,cAAQ,CAHD;AAIP0d,iCAA2B,CAJpB;AAKPC,0BAAoB,CALb;AAMP5V,sCAAgC,CANzB;AAOPwW,mCAA6B,CAPtB;AAQPd,kBAAY,CARL;AASPe,yBAAmB,CATZ;AAUPZ,uBAAiB;AAVV;AAD2C,GAA7C,CAAP;AAXD;AAyBAh4B,OAAO62B,OAAP,CAAe,YAAf,EAA6B,UAACrH,OAAD,EAAU2B,MAAV;AAC5B,OAAO,KAAKhW,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;AC4BC;;AD1BF,OAAOvH,OAAP;AACC,WAAO,KAAKuH,KAAL,EAAP;AC4BC;;AD1BF,OAAO5F,MAAP;AACC,WAAO,KAAK4F,KAAL,EAAP;AC4BC;;AD1BF,SAAOrV,IAAIgC,KAAJ,CAAUna,IAAV,CAAe;AAAE,sBAAkBimB,OAApB;AAA6B,4BAAwB,OAArD;AAA8D,0BAAsB2B;AAApF,GAAf,CAAP;AAVD;AAYAnxB,OAAOo3B,gBAAP,CAAwB,eAAxB,EAAyC,UAACC,SAAD,EAAYrL,GAAZ,EAAiBlsB,MAAjB;AACxCg3B,QAAMO,SAAN,EAAiB1oC,MAAjB;AACAmoC,QAAM9K,GAAN,EAAWjsB,KAAX;AACA+2B,QAAMh3B,MAAN,EAAcw3B,MAAMC,QAAN,CAAenpC,MAAf,CAAd;;AAEA,OAAO,KAAK+sB,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACgCC;;AD9BF,OAAKS,OAAL;ACgCC,SD9BD;AAAAjuB,UAAM;AACL,WAAKiuB,OAAL;ACgCI,aD/BJp3B,GAAGiL,KAAH,CAAS9B,IAAT,CAAc;AAAChJ,aAAK;AAACuiB,eAAKkJ;AAAN;AAAN,OAAd,EAAiC;AAAAlsB,gBAAQA;AAAR,OAAjC,CC+BI;ADjCL;AAIA23B,cAAU,CACT;AACCluB,YAAM,UAAC3F,IAAD;AACL,aAAC4zB,OAAD;ACsCM,eDpCNp3B,GAAGuyB,WAAH,CAAeppB,IAAf,CAAoB;AACnBnG,iBAAOQ,KAAKR,KADO;AAEnB1B,gBAAMkC,KAAKoH,OAAL,CAAalI;AAFA,SAApB,EAGG;AAAAhD,kBACF;AAAAsD,mBAAO,CAAP;AACA1B,kBAAM,CADN;AAEA1L,kBAAM;AAFN;AADE,SAHH,CCoCM;ADxCR;AAAA,KADS,EAaT;AACCuT,YAAM,UAAC3F,IAAD;AACL,aAAC4zB,OAAD;ACwCM,eDtCNp3B,GAAGC,KAAH,CAASkJ,IAAT,CAAc;AACbnG,iBAAOQ,KAAKR,KADC;AAEb7C,eAAKqD,KAAKlE;AAFG,SAAd,EAGG;AAAAI,kBACF;AAAAsD,mBAAO,CAAP;AACA7C,iBAAK,CADL;AAEAvK,kBAAM,CAFN;AAGAsO,sBAAU;AAHV;AADE,SAHH,CCsCM;AD1CR;AAAA,KAbS,EA0BT;AACCiF,YAAM,UAAC3F,IAAD;AACL,aAAC4zB,OAAD;AC0CM,eDxCNp3B,GAAG42B,UAAH,CAAcztB,IAAd,CAAmB;AAClBnG,iBAAOQ,KAAKR;AADM,SAAnB,EAEG;AAAAtD,kBACF;AAAAsD,mBAAO,CAAP;AACA7C,iBAAK,CADL;AAEAvK,kBAAM;AAFN;AADE,SAFH,CCwCM;AD5CR;AAAA,KA1BS;AAJV,GC8BC;ADxCF,G;;;;;;;;;;;;AErJAgK,OAAO62B,OAAP,CAAe,OAAf,EAAwB,UAACrH,OAAD;AACvB,OAAO,KAAKrU,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACCC;;ADCF,OAAOvH,OAAP;AACC,WAAO,KAAKuH,KAAL,EAAP;ACCC;;ADEF,SAAO32B,GAAGC,KAAH,CAASkJ,IAAT,CAAc;AAACnG,WAAOosB;AAAR,GAAd,EAAgC;AAAC1vB,YAAQ;AAAC9J,YAAM,CAAP;AAAUsO,gBAAU,CAApB;AAAuBmI,aAAO,CAA9B;AAAiC7J,mBAAa,CAA9C;AAAiDuL,sBAAgB,CAAjE;AAAoE0qB,mBAAa;AAAjF;AAAT,GAAhC,CAAP;AARD;AAUA74B,OAAO62B,OAAP,CAAe,eAAf,EAAgC,UAACrH,OAAD,EAAUje,MAAV;AAC/B,OAAO,KAAK4J,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACYC;;ADVF,OAAOvH,OAAP;AACC,WAAO,KAAKuH,KAAL,EAAP;ACYC;;ADTF,SAAO32B,GAAGC,KAAH,CAASkJ,IAAT,CAAc;AAAChJ,SAAKgR,MAAN;AAAcnO,WAAOosB;AAArB,GAAd,EAA6C;AAAC1vB,YAAQ;AAAC9J,YAAM,CAAP;AAAUsO,gBAAU,CAApB;AAAuBmI,aAAO,CAA9B;AAAiC7J,mBAAa,CAA9C;AAAiDuL,sBAAgB,CAAjE;AAAoE0qB,mBAAa;AAAjF;AAAT,GAA7C,CAAP;AARD;AAWA74B,OAAO62B,OAAP,CAAe,cAAf,EAA+B,UAACrH,OAAD,EAAUje,MAAV,EAAkB0mB,SAAlB;AAC9B,MAAA93B,cAAA,EAAA+3B,MAAA,EAAAC,IAAA;;AAAA,OAAO,KAAKhd,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACwBC;;ADtBF,OAAOvH,OAAP;AACC,WAAO,KAAKuH,KAAL,EAAP;ACwBC;;ADtBF,OAAOxlB,MAAP;AACC,WAAO,KAAKwlB,KAAL,EAAP;ACwBC;;ADtBF,OAAOkB,SAAP;AACC,WAAO,KAAKlB,KAAL,EAAP;ACwBC;;ADrBFoB,SAAO,IAAP;;AAEAh4B,mBAAiB,UAACgT,EAAD,EAAM8kB,SAAN;AAChB,QAAAv4B,IAAA,EAAAC,YAAA;AAAAD,WAAOU,GAAGC,KAAH,CAASC,OAAT,CAAiB;AAACC,WAAM4S;AAAP,KAAjB,CAAP;;AACA,QAAG,CAACzT,IAAJ;AACC,aAAO,EAAP;ACyBE;;ADxBHC,mBAAeD,KAAKsL,OAApB;AACArL,iBAAay4B,MAAb,GAAsB,IAAtB;;AACA,QAAGz4B,aAAaY,GAAb,KAAoB03B,SAAvB;AACCt4B,qBAAeD,KAAKwL,QAAL,CAAcL,gBAAd,CAA+B,KAA/B,EAAsCotB,SAAtC,CAAf;AACAt4B,mBAAay4B,MAAb,GAAsB,KAAtB;AC0BE;;ADzBH,WAAOz4B,YAAP;AATgB,GAAjB;;AAWAu4B,WAAS93B,GAAGC,KAAH,CAASkJ,IAAT,CAAc;AAAChJ,SAAKgR;AAAN,GAAd,EAA6B;AAACzR,YAAQ;AAACS,WAAK,CAAN;AAAS,0BAAoB;AAA7B;AAAT,GAA7B,EAAwE83B,cAAxE,CAAuF;AAC/FC,aAAS,UAACnlB,EAAD;ACkCL,aDjCHglB,KAAKG,OAAL,CAAa,eAAb,EAA8BL,SAA9B,EAAyC93B,eAAegT,EAAf,EAAmB8kB,SAAnB,CAAzC,CCiCG;ADnC2F;AAAA,GAAvF,CAAT;AAKAE,OAAKI,KAAL,CAAW,eAAX,EAA4BN,SAA5B,EAAuC93B,eAAeoR,MAAf,EAAuB0mB,SAAvB,CAAvC;AACAE,OAAKpB,KAAL;ACkCC,SDjCDoB,KAAKK,MAAL,CAAY;ACkCT,WDjCFN,OAAOO,IAAP,ECiCE;ADlCH,ICiCC;ADnEF,G;;;;;;;;;;;;AErBAz4B,OAAO62B,OAAP,CAAe,eAAf,EAAgC,UAACvjB,UAAD,EAAaY,GAAb;AAC/B,MAAA4kB,eAAA,EAAAC,oBAAA,EAAAb,MAAA,EAAA32B,QAAA,EAAAy3B,iBAAA,EAAAC,iBAAA,EAAAC,UAAA,EAAAf,IAAA,EAAAgB,mBAAA,EAAAC,yBAAA;;AAAA,OAAO,KAAKje,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACEC;;ADAF,QAAQzjB,cAAclT,GAAGuhB,SAAH,CAAapY,IAAb,CAAkB;AAAChJ,SAAK+S;AAAN,GAAlB,EAAqCsO,KAArC,EAAtB;AACC,WAAO,KAAKmV,KAAL,EAAP;ACIC;;ADFFoB,SAAO,IAAP;AAEAc,sBAAoB,CAAC,KAAD,EAAQ,aAAR,EAAuB,MAAvB,EAA+B,SAA/B,EAA0C,cAA1C,EAA0D,MAA1D,EAAkE,YAAlE,EAAgF,aAAhF,EACnB,SADmB,EACR,OADQ,EACC,aADD,EACgB,gBADhB,EACkC,WADlC,EAC+C,gBAD/C,EACiE,gBADjE,CAApB;AAGAE,wBAAsB,CAAC,cAAD,EAAiB,cAAjB,EAAiC,mBAAjC,EAAsD,wBAAtD,EAAgF,QAAhF,EAA0F,aAA1F,CAAtB;AAEAC,8BAA4B,EAA5B;AAEAJ,sBAAoB;AACnB,qBAAiB,CADE;AAInB,iDAA6C,CAJ1B;AAKnB,4CAAwC,CALrB;AAMnB,iCAA6B,CANV;AAQnB,gCAA4B,CART;AAUnB,gCAA4B,CAVT;AAWnB,mCAA+B,CAXZ;AAYnB,sCAAkC,CAZf;AAanB,mCAA+B,CAbZ;AAcnB,gCAA4B,CAdT;AAenB,mCAA+B,CAfZ;AAgBnB,gCAA4B,CAhBT;AAiBnB,uCAAmC,CAjBhB;AAkBnB,sCAAkC;AAlBf,GAApB;;AAqBAD,yBAAuB,UAAC1qB,MAAD;AACtB,QAAAgrB,kBAAA;AAAAA,yBAAqB,IAAIt5B,KAAJ,EAArB;;ACLE,QAAIsO,UAAU,IAAd,EAAoB;ADOtBA,aAAQ5N,OAAR,CAAgB,UAACe,KAAD;AACf,YAAAb,GAAA;ACLK,eAAOa,SAAS,IAAT,GAAgB,CAACb,MAAMa,MAAM4a,QAAb,KAA0B,IAA1B,GAAiCzb,IDK5CF,OCL4C,CDKpC,UAAC6b,OAAD;AACxB,cAAIA,QAAQ5a,IAAR,KAAgBy2B,KAAKhd,MAArB,IAA+BmB,QAAQ1a,OAAR,KAAmBu2B,KAAKhd,MAA3D;ACJQ,mBDQPke,mBAAmBpjC,IAAnB,CAAwBqmB,QAAQ3Z,SAAhC,CCRO;AACD;ADER,SCL6D,CAAjC,GDK5B,MCLY,GDKZ,MCLK;ADIN;ACEG;;ADMH,WAAO02B,kBAAP;AAXsB,GAAvB;;AAcAP,oBAAkB,UAACQ,WAAD;AACjB,QAAA/3B,QAAA,EAAAZ,GAAA,EAAA8K,IAAA,EAAAkd,sBAAA,EAAAta,MAAA;AAAA9M,eAAWnB,GAAGuhB,SAAH,CAAarhB,OAAb,CAAqB;AAACC,WAAK+4B;AAAN,KAArB,EAAyC;AAACx5B,cAAQk5B;AAAT,KAAzC,CAAX;;AAEA,QAAGz3B,QAAH;AAEC43B,0BAAoB14B,OAApB,CAA4B,UAACjK,GAAD;AAC3B,YAAGA,QAAO,wBAAV;ACFM,iBDGL4iC,0BAA0B5iC,GAA1B,IAAiCuiC,qBAAqBx3B,SAAS8M,MAA9B,CCH5B;ADEN;ACAM,iBDGL+qB,0BAA0B5iC,GAA1B,IAAiC+K,SAAS/K,GAAT,CCH5B;AACD;ADFN;AAQAmyB,+BAAA,EAAAhoB,MAAAP,GAAAwoB,cAAA,CAAAtoB,OAAA;ACHK8C,eAAO7B,SAAS6B,KDGrB;ACFK5M,aAAK;ADEV,SCDM;AACDsJ,gBAAQ;AACNwC,kBAAQ;AADF;AADP,ODCN,MCGU,IDHV,GCGiB3B,IDHwH2B,MAAzI,GAAyI,MAAzI,KAAmJ,KAAnJ;;AAEA,UAAGqmB,sBAAH;AAECta,iBAAS,IAAItO,KAAJ,EAAT;;ACEI,YAAIwB,YAAY,IAAhB,EAAsB;AACpB,cAAI,CAACkK,OAAOlK,SAAS8M,MAAjB,KAA4B,IAAhC,EAAsC;AACpC5C,iBDFUhL,OCEV,CDFkB,UAACe,KAAD;AACzB,kBAAA+3B,MAAA,EAAAnd,QAAA,EAAAH,IAAA;;AAAAsd,uBAASv4B,EAAElI,KAAF,CAAQ0I,KAAR,CAAT;AAEA4a,yBAAW,IAAIrc,KAAJ,EAAX;;ACGS,kBAAIyB,SAAS,IAAb,EAAmB;AACjB,oBAAI,CAACya,OAAOza,MAAM4a,QAAd,KAA2B,IAA/B,EAAqC;AACnCH,uBDHIxb,OCGJ,CDHY,UAAC6b,OAAD;AACxB,wBAAGA,QAAQ/pB,IAAR,KAAgB,IAAhB,IAAwB+pB,QAAQ5a,IAAR,KAAgBy2B,KAAKhd,MAA7C,IAAuDmB,QAAQ1a,OAAR,KAAmBu2B,KAAKhd,MAA/E,IAA0F,CAACna,EAAEkQ,OAAF,CAAUoL,QAAQG,eAAlB,CAA9F;ACIgB,6BDHfL,SAASnmB,IAAT,CAAcqmB,OAAd,CCGe;AACD;ADNhB,mBCGa;AAKD;AACF;;ADLVid,qBAAOnd,QAAP,GAAkBA,QAAlB;ACOS,qBDLT/N,OAAOpY,IAAP,CAAYsjC,MAAZ,CCKS;ADhBV,aCEQ;AAgBD;AACF;;ADNLh4B,iBAAS8M,MAAT,GAAkBA,MAAlB;AA7BF;ACsCG;;ADPH,WAAO9M,QAAP;AAlCiB,GAAlB;;AAqCA23B,eAAa,UAACM,YAAD;AACZ,QAAAC,OAAA,EAAAC,IAAA;;AAAA,QAAGF,YAAH;AAECC,gBAAU,KAAV;AAEAC,aAAO14B,EAAEuI,IAAF,CAAO4vB,mBAAP,EAA4B,UAAC3iC,GAAD;AAClC,YAAA0C,IAAA,EAAAygC,qBAAA;;AAAAzgC,eAAO1C,GAAP;;AAEA,YAAGA,QAAO,wBAAV;AACC0C,iBAAO,QAAP;ACOI;;ADLL,YAAG8H,EAAEhH,GAAF,CAAMw/B,YAAN,EAAoBtgC,IAApB,CAAH;AAEC,cAAG1C,QAAO,wBAAV;AAECmjC,oCAAwBZ,qBAAqBS,aAAanrB,MAAlC,CAAxB;AAIA,mBAAO,CAACrN,EAAE44B,OAAF,CAAUR,0BAA0B5iC,GAA1B,CAAV,EAA0CmjC,qBAA1C,CAAR;AAND;AAQC,mBAAO,CAAC34B,EAAE44B,OAAF,CAAUR,0BAA0B5iC,GAA1B,CAAV,EAA0CgjC,aAAahjC,GAAb,CAA1C,CAAR;AAVF;ACaK;ADnBC,QAAP;;AAkBA,UAAGkjC,IAAH;AACCD,kBAAU,IAAV;ACIG;;ADAJ,aAAOA,OAAP;ACEE;;ADAH,WAAO,IAAP;AA9BY,GAAb;;AAgCAvB,WAAS93B,GAAGuhB,SAAH,CAAapY,IAAb,CAAkB;AAAChJ,SAAK+S;AAAN,GAAlB,EAAqC+kB,cAArC,CAAoD;AAC5DC,aAAS,UAACnlB,EAAD,EAAKrT,MAAL;AACR,UAAGoU,QAAO,OAAP,IAAkBglB,WAAWp5B,MAAX,CAArB;ACIK,eDHJq4B,KAAKG,OAAL,CAAa,WAAb,EAA0BnlB,EAA1B,EAA8B2lB,gBAAgB3lB,EAAhB,CAA9B,CCGI;AACD;ADPuD;AAI5DsC,aAAS,UAACtC,EAAD;ACML,aDLHglB,KAAK1iB,OAAL,CAAa,WAAb,EAA0BtC,EAA1B,CCKG;ADVwD;AAAA,GAApD,CAAT;AAQA5R,aAAWu3B,gBAAgBxlB,UAAhB,CAAX;AAEA6kB,OAAKI,KAAL,CAAW,WAAX,EAAAh3B,YAAA,OAAwBA,SAAUhB,GAAlC,GAAkC,MAAlC,EAAuCgB,QAAvC;AAEA42B,OAAKpB,KAAL;ACIC,SDFDoB,KAAKK,MAAL,CAAY;ACGT,WDFFN,OAAOO,IAAP,ECEE;ADHH,ICEC;ADxIF;AA0IAz4B,OAAO62B,OAAP,CAAe,iBAAf,EAAkC,UAACvjB,UAAD;AACjC,MAAAumB,iBAAA,EAAA3B,MAAA,EAAAC,IAAA;;AAAA,OAAO,KAAKhd,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACKC;;ADHF,OAAOzjB,UAAP;AACC,WAAO,KAAKyjB,KAAL,EAAP;ACKC;;ADHFoB,SAAO,IAAP;;AAEA0B,sBAAoB,UAACC,MAAD;AACnB,WAAO15B,GAAGuhB,SAAH,CAAarhB,OAAb,CAAqB;AAACC,WAAKu5B;AAAN,KAArB,EAAoC;AAACh6B,cAAQ;AAACS,aAAK,CAAN;AAAS8N,gBAAQ;AAAjB;AAAT,KAApC,CAAP;AADmB,GAApB;;AAIA6pB,WAAU93B,GAAGuhB,SAAH,CAAapY,IAAb,CAAkB;AAAChJ,SAAK+S;AAAN,GAAlB,EAAqC+kB,cAArC,CAAoD;AAC7DC,aAAS,UAACnlB,EAAD;ACYL,aDXHglB,KAAKG,OAAL,CAAa,iBAAb,EAAgChlB,UAAhC,EAA4CumB,kBAAkBvmB,UAAlB,CAA5C,CCWG;ADbyD;AAAA,GAApD,CAAV;AAKA6kB,OAAKI,KAAL,CAAW,iBAAX,EAA8BjlB,UAA9B,EAA0CumB,kBAAkBvmB,UAAlB,CAA1C;AAEA6kB,OAAKpB,KAAL;ACWC,SDVDoB,KAAKK,MAAL,CAAY;ACWT,WDVFN,OAAOO,IAAP,ECUE;ADXH,ICUC;AD/BF,G;;;;;;;;;;;;AEzICz4B,OAAO62B,OAAP,CAAe,gBAAf,EAAiC,UAACrH,OAAD,EAAUtb,GAAV,EAAeid,MAAf;AAEhC,MAAAvgC,KAAA;;AAAA,OAAO,KAAKuqB,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACAA;;ADED,OAAOvH,OAAP;AACC,WAAO,KAAKuH,KAAL,EAAP;ACAA;;ADEDnmC,UAAQ;AAACwS,WAAOosB;AAAR,GAAR;;AACA,MAAGtb,QAAO,OAAV;AACCtjB,UAAMmpC,WAAN,GAAoB,KAAK5e,MAAzB;AADD,SAEK,IAAGjH,QAAO,QAAV;AACJtjB,UAAMqjC,YAAN,GAAqB,KAAK9Y,MAA1B;AADI,SAEA,IAAGjH,QAAO,OAAV;AACJtjB,UAAM0S,SAAN,GAAkB,KAAK6X,MAAvB;AACAvqB,UAAM6b,KAAN,GAAc,OAAd;AAFI,SAGA,IAAGyH,QAAO,SAAV;AACJtjB,UAAM0S,SAAN,GAAkB,KAAK6X,MAAvB;AACAvqB,UAAM6b,KAAN,GAAc,SAAd;AAFI,SAGA,IAAGyH,QAAO,WAAV;AACJtjB,UAAM0S,SAAN,GAAkB,KAAK6X,MAAvB;AACAvqB,UAAM6b,KAAN,GAAc,WAAd;AAFI,SAGA,IAAGyH,QAAO,SAAV;AACJtjB,UAAMgT,IAAN,GAAautB,MAAb;AACAvgC,UAAM6b,KAAN,GAAc;AAACqW,WAAK,CAAC,SAAD,EAAW,WAAX;AAAN,KAAd;AAFI;AAIJlyB,UAAM6b,KAAN,GAAc,MAAd;ACIA;;ADFD,SAAOrM,GAAGuhB,SAAH,CAAapY,IAAb,CAAkB3Y,KAAlB,EAAyB;AAACkP,YAAQ;AAAC9J,YAAK,CAAN;AAASqzB,eAAQ,CAAjB;AAAoB3pB,YAAK,CAAzB;AAA4BkE,YAAM,CAAlC;AAAqCR,aAAM,CAA3C;AAA8CP,gBAAS,CAAvD;AAA0DW,iBAAW,CAArE;AAAwEa,mBAAY,CAApF;AAAuF1E,oBAAc,CAArG;AAAwGyL,oBAAc;AAAtH;AAAT,GAAzB,CAAP;AA5BD,G;;;;;;;;;;;;AEDD,IAAA4uB,wBAAA,EAAAC,4BAAA;;AAAAA,+BAA+B,UAACC,UAAD,EAAa/e,MAAb,EAAqBgf,OAArB,EAA8B7iC,QAA9B;AAC9B,MAAA8iC,SAAA;AAAAA,cAAY,CAAC;AACZ,cAAU;AACT,aAAOF;AADE;AADE,GAAD,EAIT;AAAC,gBAAY;AAAC,cAAQ,CAAT;AAAY,kBAAY;AAAxB;AAAb,GAJS,EAIkD;AAAC,eAAW;AAAZ,GAJlD,EAI4E;AAAC,eAAW;AAAZ,GAJ5E,EAKX;AAAC,cAAU;AAAC,8BAAwB,IAAzB;AAA+BpW,WAAI,CAAC;AAAC,4BAAoB3I;AAArB,OAAD,EAA8B;AAAC,yBAAiBA;AAAlB,OAA9B;AAAnC;AAAX,GALW,EAMX;AAAC,cAAU;AAAC,aAAO,MAAR;AAAgB,qBAAe;AAAC,iBAAS;AAAV;AAA/B;AAAX,GANW,CAAZ;ACqCC,SD5BD/a,GAAGuhB,SAAH,CAAa0Y,aAAb,GAA6BC,SAA7B,CAAuCF,SAAvC,EAAkDG,OAAlD,CAA0D,UAAC/P,GAAD,EAAMt7B,IAAN;AACzD,QAAGs7B,GAAH;AACC,YAAM,IAAI5uB,KAAJ,CAAU4uB,GAAV,CAAN;AC6BE;;AD3BHt7B,SAAKuR,OAAL,CAAa,UAAC+5B,GAAD;AC6BT,aD5BHL,QAAQlkC,IAAR,CAAaukC,GAAb,CC4BG;AD7BJ;;AAGA,QAAGljC,YAAY0J,EAAEy5B,UAAF,CAAanjC,QAAb,CAAf;AACCA;AC6BE;ADrCJ,IC4BC;ADtC6B,CAA/B;;AAqBA0iC,2BAA2Bh6B,OAAO06B,SAAP,CAAiBT,4BAAjB,CAA3B;AAEAj6B,OAAO62B,OAAP,CAAe,kBAAf,EAAmC,UAACQ,SAAD,EAAYrL,GAAZ,EAAiBlsB,MAAjB;AAClC,MAAA66B,YAAA,EAAAC,wBAAA,EAAAC,kBAAA,EAAA3C,MAAA,EAAAC,IAAA;;AAAA,OAAO,KAAKhd,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACgCC;;AD9BFD,QAAMO,SAAN,EAAiB1oC,MAAjB;AAEAmoC,QAAM9K,GAAN,EAAWjsB,KAAX;AAEA+2B,QAAMh3B,MAAN,EAAcw3B,MAAMC,QAAN,CAAenpC,MAAf,CAAd;AAEA0R,SAAOk0B,QAAP,GAAkB,CAAlB;AAEAmE,SAAO,IAAP;;AAEAyC,6BAA2B,UAACzf,MAAD,EAAS7H,UAAT;AAC1B,QAAApkB,IAAA;AAAAA,WAAO,EAAP;AACA8qC,6BAAyB1mB,UAAzB,EAAqC6H,MAArC,EAA6CjsB,IAA7C;;AACA,QAAGA,KAAKzB,MAAL,GAAc,CAAjB;AACC,aAAOyB,KAAK,CAAL,CAAP;AC4BE;ADhCuB,GAA3B;;AAOAyrC,iBAAe,UAACxf,MAAD,EAAS7H,UAAT;AACd,QAAAgJ,OAAA,EAAAF,QAAA,EAAA7a,QAAA,EAAAa,OAAA,EAAA4hB,SAAA,EAAA8W,iBAAA;AAAAv5B,eAAWnB,GAAGuhB,SAAH,CAAarhB,OAAb,CAAqB;AAACC,WAAK+S;AAAN,KAArB,EAAwC;AAACxT,cAAQ;AAACuO,gBAAQ;AAAT;AAAT,KAAxC,CAAX;AACA2V,gBAAY,IAAZ;;AAEA,QAAG,CAACziB,QAAJ;AACC;ACkCE;;ADhCH,QAAG,CAACA,SAAS8M,MAAV,IAAoB9M,SAAS8M,MAAT,CAAgB5gB,MAAhB,GAAyB,CAAhD;AACC;ACkCE;;ADhCHqtC,wBAAoBv5B,SAAS8M,MAAT,CAAgBiK,cAAhB,CAA+B,aAA/B,EAA8C,KAA9C,CAApB;;AAEA,QAAGwiB,kBAAkBrtC,MAAlB,GAA2B,CAA9B;AACC2uB,iBAAW0e,kBAAkB,CAAlB,EAAqB1e,QAArB,CAA8B9D,cAA9B,CAA6C,aAA7C,EAA4D,KAA5D,EAAmEA,cAAnE,CAAkF,SAAlF,EAA6F6C,MAA7F,CAAX;;AAEA,UAAGiB,SAAS3uB,MAAT,GAAkB,CAArB;AACC6uB,kBAAUF,SAAS,CAAT,CAAV;AACA4H,oBAAY;AACX7Q,cAAImJ,QAAQ/b,GADD;AAEXgB,oBAAU+a,QAAQ/a,QAFP;AAGXC,iBAAO8a,QAAQ9a,KAHJ;AAIXY,mBAASka,QAAQla,OAJN;AAKXH,sBAAYqa,QAAQra,UALT;AAMX84B,iBAAOze,QAAQye,KANJ;AAOXp5B,qBAAW2a,QAAQ3a;AAPR,SAAZ;AALF;AC8CG;;AD/BH,QAAG,CAACqiB,SAAJ;AACC5hB,gBAAU,KAAV;AACAb,eAAS8M,MAAT,CAAgB5N,OAAhB,CAAwB,UAACe,KAAD;AACvB,YAAAb,GAAA;ACiCI,eAAOa,SAAS,IAAT,GAAgB,CAACb,MAAMa,MAAM4a,QAAb,KAA0B,IAA1B,GAAiCzb,IDjC3CF,OCiC2C,CDjCnC,UAAC6b,OAAD;AACxB,cAAGA,QAAQ/pB,IAAR,KAAgB,IAAhB,IAAyB+pB,QAAQ5a,IAAR,KAAgByZ,MAAzC,IAAoDmB,QAAQ7a,WAAR,KAAuB,KAA9E;AACC,gBAAG6a,QAAQla,OAAX;AACCA,wBAAU,IAAV;ACkCM;;AACD,mBDlCN4hB,YAAY;AAAC7Q,kBAAImJ,QAAQ/b,GAAb;AAAkB6B,uBAASA,OAA3B;AAAoCH,0BAAYqa,QAAQra,UAAxD;AAAoE84B,qBAAOze,QAAQye,KAAnF;AAA0Fp5B,yBAAW2a,QAAQ3a;AAA7G,aCkCN;AAOD;AD7CP,SCiC4D,CAAjC,GDjC3B,MCiCW,GDjCX,MCiCI;ADlCL;ACiDE;;AD1CH,WAAOqiB,SAAP;AApCc,GAAf;;AAsCA6W,uBAAqB,UAACvnB,UAAD;AACpB,QAAA/R,QAAA,EAAAZ,GAAA,EAAA8K,IAAA,EAAAuvB,eAAA;AAAAz5B,eAAWnB,GAAGuhB,SAAH,CAAarhB,OAAb,CAAqB;AAACC,WAAK+S;AAAN,KAArB,EAAwC;AAACxT,cAAQ;AAAC,uBAAe,CAAhB;AAAmB,kBAAU;AAACm7B,kBAAQ,CAAC;AAAV;AAA7B;AAAT,KAAxC,CAAX;;AACA,QAAG15B,QAAH;AACCy5B,wBAAA,CAAAr6B,MAAAY,SAAA8M,MAAA,aAAA5C,OAAA9K,IAAA,cAAA8K,KAAuCzV,IAAvC,GAAuC,MAAvC,GAAuC,MAAvC;ACsDE;;ADpDH,WAAOglC,eAAP;AALoB,GAArB;;AAOA9C,WAAS93B,GAAGuhB,SAAH,CAAapY,IAAb,CAAkB;AAAChJ,SAAK;AAACuiB,WAAKkJ;AAAN;AAAN,GAAlB,EAAqC;AAAClsB,YAAQ;AAACuO,cAAQ;AAAT;AAAT,GAArC,EAA4DgqB,cAA5D,CAA2E;AACnFC,aAAS,UAACnlB,EAAD;AACR,UAAAvK,KAAA,EAAArH,QAAA,EAAAyiB,SAAA,EAAAkX,qBAAA,EAAAv6B,GAAA,EAAA8K,IAAA;AAAAlK,iBAAWnB,GAAGuhB,SAAH,CAAarhB,OAAb,CAAqB;AAACC,aAAK4S;AAAN,OAArB,EAAgC;AAACrT,gBAAQA;AAAT,OAAhC,CAAX;;AACA,UAAU,CAAIyB,QAAd;AAAA;ACoEI;;ADnEJyiB,kBAAY2W,aAAaxC,KAAKhd,MAAlB,EAA0BhI,EAA1B,CAAZ;AACA+nB,8BAAwBN,yBAAyBzC,KAAKhd,MAA9B,EAAsChI,EAAtC,CAAxB;;AACA,UAAG6Q,SAAH;AACCziB,iBAASa,OAAT,GAAmB4hB,UAAU5hB,OAA7B;AACAb,iBAASU,UAAT,GAAsB+hB,UAAU/hB,UAAhC;;AACA,YAAG+hB,UAAU+W,KAAb;AACCx5B,mBAAS45B,eAAT,GAA2BnX,UAAUriB,SAArC;AAJF;AAAA;AAMCJ,iBAASa,OAAT,GAAmB,IAAnB;ACsEG;;ADpEJ,UAAG84B,qBAAH;AACC35B,iBAAS65B,cAAT,GAA0BF,sBAAsBh4B,WAAhD;ACsEG;;ADpEJ3B,eAAS85B,KAAT,KAAA16B,MAAAY,SAAAyyB,QAAA,YAAArzB,IAAoCgS,QAApC,CAA6CwlB,KAAKhd,MAAlD,IAAiB,MAAjB,KAA6D,KAA7D;AACA5Z,eAAS+5B,QAAT,KAAA7vB,OAAAlK,SAAAyyB,QAAA,YAAAvoB,KAAuChe,MAAvC,GAAuC,MAAvC,KAAiD,CAAjD;AACA,aAAO8T,SAASyyB,QAAhB;;AACA;ACsEK,eDrEJmE,KAAKG,OAAL,CAAa,WAAb,EAA0BnlB,EAA1B,EAA8B5R,QAA9B,CCqEI;ADtEL,eAAA2c,MAAA;AAEMtV,gBAAAsV,MAAA;AACLtd,gBAAQC,GAAR,CAAY,iCAAZ,EAA+C+H,MAAMmkB,OAArD;AACAnsB,gBAAQC,GAAR,CAAY,eAAZ,EAA6Bs3B,KAAKhd,MAAlC;AACAva,gBAAQC,GAAR,CAAY,aAAZ,EAA2Bw2B,SAA3B;AACAz2B,gBAAQC,GAAR,CAAY,OAAZ,EAAqBkJ,KAAKC,SAAL,CAAegiB,GAAf,CAArB;ACuEI,eDtEJprB,QAAQC,GAAR,CAAY,aAAZ,EAA2BkJ,KAAKC,SAAL,CAAega,SAAf,CAA3B,CCsEI;AACD;ADlG8E;AA4BnFvO,aAAS,UAACtC,EAAD;ACyEL,aDxEHglB,KAAK1iB,OAAL,CAAa,WAAb,EAA0BtC,EAA1B,CCwEG;ADrG+E;AAAA,GAA3E,CAAT;AAgCA6Y,MAAIvrB,OAAJ,CAAY,UAAC0S,EAAD;AACX,QAAA5R,QAAA,EAAAyiB,SAAA,EAAAkX,qBAAA,EAAAv6B,GAAA,EAAA8K,IAAA;AAAAlK,eAAWnB,GAAGuhB,SAAH,CAAarhB,OAAb,CAAqB;AAACC,WAAK4S;AAAN,KAArB,EAAgC;AAACrT,cAAQA;AAAT,KAAhC,CAAX;;AACA,QAAU,CAAIyB,QAAd;AAAA;AC+EG;;AD9EHyiB,gBAAY2W,aAAaxC,KAAKhd,MAAlB,EAA0BhI,EAA1B,CAAZ;AACA+nB,4BAAwBN,yBAAyBzC,KAAKhd,MAA9B,EAAsChI,EAAtC,CAAxB;;AACA,QAAG6Q,SAAH;AACCziB,eAASa,OAAT,GAAmB4hB,UAAU5hB,OAA7B;AACAb,eAASU,UAAT,GAAsB+hB,UAAU/hB,UAAhC;;AACA,UAAG+hB,UAAU+W,KAAb;AACEx5B,iBAAS45B,eAAT,GAA2BnX,UAAUriB,SAArC;AAJH;AAAA;AAMCJ,eAASa,OAAT,GAAmB,IAAnB;ACiFE;;AD/EH,QAAG84B,qBAAH;AACC35B,eAAS65B,cAAT,GAA0BF,sBAAsBh4B,WAAhD;ACiFE;;AD/EH3B,aAAS85B,KAAT,KAAA16B,MAAAY,SAAAyyB,QAAA,YAAArzB,IAAoCgS,QAApC,CAA6CwlB,KAAKhd,MAAlD,IAAiB,MAAjB,KAA6D,KAA7D;AACA5Z,aAAS+5B,QAAT,KAAA7vB,OAAAlK,SAAAyyB,QAAA,YAAAvoB,KAAuChe,MAAvC,GAAuC,MAAvC,KAAiD,CAAjD;AACA,WAAO8T,SAASyyB,QAAhB;ACiFE,WDhFFmE,KAAKI,KAAL,CAAW,WAAX,EAAwBplB,EAAxB,EAA4B5R,QAA5B,CCgFE;ADnGH;AAqBA42B,OAAKpB,KAAL;ACiFC,SDhFDoB,KAAKK,MAAL,CAAY;ACiFT,WDhFFN,OAAOO,IAAP,ECgFE;ADjFH,ICgFC;ADxMF;AA2HAz4B,OAAO62B,OAAP,CAAe,wBAAf,EAAyC,UAAC0E,WAAD,EAAcvP,GAAd,EAAmBlsB,MAAnB;AACxC,OAAO,KAAKqb,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACmFC;;ADjFFD,QAAMyE,WAAN,EAAmB5sC,MAAnB;AAEAmoC,QAAM9K,GAAN,EAAWjsB,KAAX;AAEA+2B,QAAMh3B,MAAN,EAAcw3B,MAAMC,QAAN,CAAenpC,MAAf,CAAd;ACiFC,SD3EDgS,GAAGe,cAAH,CAAkBoI,IAAlB,CAAuB;AACtBhJ,SAAK;AACJuiB,WAAKkJ;AADD;AADiB,GAAvB,EAIG;AACFlsB,YAAQA;AADN,GAJH,CC2EC;ADzFF;AAsBAE,OAAO62B,OAAP,CAAe,mBAAf,EAAoC,UAAC0E,WAAD,EAAcvP,GAAd,EAAmBlsB,MAAnB;AACnC,OAAO,KAAKqb,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;AC6EC;;AD3EFD,QAAMyE,WAAN,EAAmB5sC,MAAnB;AAEAmoC,QAAM9K,GAAN,EAAWjsB,KAAX;AAEA+2B,QAAMh3B,MAAN,EAAcw3B,MAAMC,QAAN,CAAenpC,MAAf,CAAd;AC2EC,SDrEDgS,GAAGuhB,SAAH,CAAapY,IAAb,CAAkB;AACjBhJ,SAAK;AACJuiB,WAAKkJ;AADD;AADY,GAAlB,EAIG;AACFlsB,YAAQA;AADN,GAJH,CCqEC;ADnFF,G;;;;;;;;;;;;AExKAE,OAAO62B,OAAP,CAAe,iBAAf,EAAkC,UAACrH,OAAD;AACjC,MAAArU,MAAA;AAAA2b,QAAMtH,OAAN,EAAe7gC,MAAf;;AAEA,OAAO,KAAKwsB,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACCC;;ADCF5b,WAAS,KAAKA,MAAd;AACA,SAAO/a,GAAGuhB,SAAH,CAAapY,IAAb,CAAkB;AAACkD,WAAM,OAAP;AAAerJ,WAAMosB,OAArB;AAA6BlsB,eAAU6X,MAAvC;AAA8C2I,SAAI,CAAC;AAACiW,mBAAa;AAAC3Q,iBAAQ;AAAT;AAAd,KAAD,EAAiC;AAAC2Q,mBAAa;AAAd,KAAjC;AAAlD,GAAlB,EAA0H;AAACj6B,YAAQ;AAACS,WAAK,CAAN;AAASkM,aAAO,CAAhB;AAAmBrJ,aAAO,CAA1B;AAA6BE,iBAAW,CAAxC;AAA2Cy2B,mBAAa,CAAxD;AAA2Dl3B,gBAAU,CAArE;AAAwE7M,YAAM;AAA9E,KAAT;AAA2FjG,UAAK;AAAC8S,gBAAU,CAAC;AAAZ;AAAhG,GAA1H,CAAP;AAPD,G;;;;;;;;;;;;AEAA7C,OAAO62B,OAAP,CAAe,oCAAf,EAAqD,UAAC2E,YAAD;AACpD,MAAAtD,MAAA,EAAAC,IAAA;AAAArB,QAAM0E,YAAN,EAAoBz7B,KAApB;;AAEA,OAAO,KAAKob,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACCC;;ADCF,OAAOyE,YAAP;AACC,WAAO,KAAKzE,KAAL,EAAP;ACCC;;ADCF,MAAG/1B,EAAEkQ,OAAF,CAAUsqB,YAAV,CAAH;AACC,WAAO,KAAKzE,KAAL,EAAP;ACCC;;ADCFoB,SAAO,IAAP;AAEAD,WAAS93B,GAAGuhB,SAAH,CAAapY,IAAb,CAAkB;AAAChJ,SAAK;AAACuiB,WAAK0Y;AAAN;AAAN,GAAlB,EAA8C;AAAC17B,YAAQ;AAAC2M,aAAO,CAAR;AAAW4B,cAAO;AAAC4sB,gBAAQ;AAAT;AAAlB;AAAT,GAA9C,EAA0F5C,cAA1F,CAAyG;AACjHE,WAAO,UAACplB,EAAD,EAAKrT,MAAL;ACWH,aDVHq4B,KAAKI,KAAL,CAAW,WAAX,EAAwBplB,EAAxB,EAA4B;AAAC1G,eAAO3M,OAAO2M,KAAf;AAAsBrK,iBAAStC,OAAOuO,MAAP,CAAc,CAAd,EAAiB+N,QAAjB,CAA0B,CAA1B,EAA6Bha;AAA5D,OAA5B,CCUG;ADZ6G;AAIjHk2B,aAAS,UAACnlB,EAAD,EAAKrT,MAAL;AACR,UAAGA,OAAO2M,KAAV;AACC0rB,aAAKG,OAAL,CAAa,WAAb,EAA0BnlB,EAA1B,EAA8B;AAAC1G,iBAAO3M,OAAO2M;AAAf,SAA9B;ACgBG;;ADfJ,UAAG3M,OAAOuO,MAAV;ACiBK,eDhBJ8pB,KAAKG,OAAL,CAAa,WAAb,EAA0BnlB,EAA1B,EAA8B;AAAC/Q,mBAAStC,OAAOuO,MAAP,CAAc,CAAd,EAAiB+N,QAAjB,CAA0B,CAA1B,EAA6Bha;AAAvC,SAA9B,CCgBI;AAGD;AD3B4G;AAAA,GAAzG,CAAT;AAWA,OAAK20B,KAAL;ACoBC,SDnBD,KAAKyB,MAAL,CAAY;ACoBT,WDnBFN,OAAOO,IAAP,ECmBE;ADpBH,ICmBC;AD7CF,G;;;;;;;;;;;;AEAAz4B,OAAO62B,OAAP,CAAe,kBAAf,EAAmC,UAACvjB,UAAD,EAAalD,iBAAb;AAClC,MAAAzP,GAAA,EAAA86B,oBAAA;;AAAA,OAAO,KAAKtgB,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACEC;;ADAF,OAAOzjB,UAAP;AACC,WAAO,KAAKyjB,KAAL,EAAP;ACEC;;ADAF0E,yBAAA,CAAA96B,MAAAP,GAAAuhB,SAAA,CAAArhB,OAAA,CAAAgT,UAAA;ACEGxT,YAAQ;AACNsQ,yBAAmB;AADb;ADFX,SCKQ,IDLR,GCKezP,IDL2EyP,iBAA1F,GAA0F,MAA1F;;AAEA,MAAGqrB,wBAAwBz6B,EAAEjS,OAAF,CAAU0sC,oBAAV,CAA3B;AACC,WAAOr7B,GAAGuhB,SAAH,CAAapY,IAAb,CAAkB;AAAChJ,WAAK;AAACuiB,aAAM2Y;AAAP;AAAN,KAAlB,EAAuD;AAAC37B,cAAQ;AAACS,aAAK,CAAN;AAASvK,cAAM,CAAf;AAAkBoN,eAAO;AAAzB;AAAT,KAAvD,CAAP;AADD;AAGC,WAAO,KAAK2zB,KAAL,EAAP;ACeC;AD3BH,G;;;;;;;;;;;;AEAA,IAAG/2B,OAAOC,QAAV;AACID,SAAO62B,OAAP,CAAe,kBAAf,EAAmC,UAACrH,OAAD;AAC/BsH,UAAMtH,OAAN,EAAe7gC,MAAf;;AAEA,SAAO,KAAKwsB,MAAZ;AACI,aAAO,KAAK4b,KAAL,EAAP;ACAP;;ADEG,WAAO32B,GAAGgb,gBAAH,CAAoB7R,IAApB,CAAyB;AAAEnG,aAAOosB;AAAT,KAAzB,EAA6C;AAAC1vB,cAAQ;AAACwpB,oBAAY,CAAb;AAAgBD,iBAAS,CAAzB;AAA4BvmB,qBAAa;AAAzC;AAAT,KAA7C,CAAP;AANJ;ACeH,C;;;;;;;;;;;;AChBD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAmCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;OAnCA,IAAA44B,mCAAA,EAAAC,6BAAA;;AAqFAA,gCAAgC,UAACnM,OAAD,EAAUrU,MAAV,EAAkBygB,MAAlB,EAA0BtkC,QAA1B;ACG9B,SDFD8I,GAAGuhB,SAAH,CAAa0Y,aAAb,GAA6BC,SAA7B,CAAuC,CACtC;AACCuB,YAAQ;AACPz4B,aAAOosB,OADA;AAEP1L,WAAK,CAAC;AAACiW,qBAAa5e;AAAd,OAAD,EAAwB;AAAC6Y,kBAAU7Y;AAAX,OAAxB;AAFE;AADT,GADsC,EAOtC;AACC2gB,YAAQ;AACPv7B,WAAK;AAACqD,cAAM,OAAP;AAAgBU,kBAAU;AAA1B,OADE;AACsCsd,aAAO;AAACma,cAAM;AAAP;AAD7C;AADT,GAPsC,CAAvC,EAYGxB,OAZH,CAYW,UAAC/P,GAAD,EAAMt7B,IAAN;AACV,QAAGs7B,GAAH;AACC,YAAM,IAAI5uB,KAAJ,CAAU4uB,GAAV,CAAN;ACcE;;ADZHt7B,SAAKuR,OAAL,CAAa,UAAC+5B,GAAD;ACcT,aDbHoB,OAAO3lC,IAAP,CAAYukC,GAAZ,CCaG;ADdJ;;AAGA,QAAGljC,YAAY0J,EAAEy5B,UAAF,CAAanjC,QAAb,CAAf;AACCA;ACcE;ADlCJ,ICEC;ADH8B,CAAhC;;AAwBAokC,sCAAsC17B,OAAO06B,SAAP,CAAiBiB,6BAAjB,CAAtC;AAEA37B,OAAO62B,OAAP,CAAe,+BAAf,EAAgD,UAACrH,OAAD;AAE/C,MAAAwM,WAAA,EAAAC,UAAA,EAAAC,KAAA,EAAAhtC,IAAA,EAAAgpC,MAAA,EAAAtnC,KAAA,EAAAunC,IAAA;;AAAA,OAAO,KAAKhd,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACgBC;;ADdFoB,SAAO,IAAP;AAEAvnC,UAAQ;AAACwS,WAAOosB;AAAR,GAAR;AAEA5+B,QAAMkzB,GAAN,GAAY,CAAC;AAACiW,iBAAa,KAAK5e;AAAnB,GAAD,EAA6B;AAAC6Y,cAAU,KAAK7Y;AAAhB,GAA7B,CAAZ;AAEAjsB,SAAO,EAAP;;AACAwsC,sCAAoClM,OAApC,EAA6C2I,KAAKhd,MAAlD,EAA0DjsB,IAA1D;;AAEA+sC,eAAa,EAAb;;AAEAj7B,IAAEyf,IAAF,CAAOvxB,IAAP,EAAa,UAACitC,QAAD;ACmBV,WDlBFF,WAAWhmC,IAAX,CAAgB;AAACsK,WAAK47B,SAAS57B,GAAT,CAAaqD,IAAnB;AAAyBU,gBAAU63B,SAAS57B,GAAT,CAAa+D,QAAhD;AAA0Dsd,aAAOua,SAASva;AAA1E,KAAhB,CCkBE;ADnBH;;AAGAuW,OAAKI,KAAL,CAAW,gBAAX,EAA6B/I,OAA7B,EAAsC;AAACnkB,WAAO4wB;AAAR,GAAtC;;AAEAD,gBAAc,UAACxB,GAAD,EAAM/N,MAAN;AACb,QAAA2P,aAAA;AAAAA,oBAAgBp7B,EAAEuI,IAAF,CAAO0yB,UAAP,EAAmB,UAACv7B,CAAD;AAClC,aAAOA,EAAEH,GAAF,KAASi6B,IAAI52B,IAApB;AADe,MAAhB;;AAEA,QAAGw4B,aAAH;AACC,UAAG3P,WAAU,OAAb;AACC2P,sBAAcxa,KAAd;AADD,aAEK,IAAG6K,WAAU,SAAb;AACJ2P,sBAAcxa,KAAd;AAJF;AAAA,WAKK,IAAG6K,WAAU,OAAb;AACJwP,iBAAWhmC,IAAX,CAAgB;AAACsK,aAAKi6B,IAAI52B,IAAV;AAAgBU,kBAAUk2B,IAAIl2B,QAA9B;AAAwCsd,eAAO;AAA/C,OAAhB;AC+BE;;AACD,WD9BFuW,KAAKG,OAAL,CAAa,gBAAb,EAA+B9I,OAA/B,EAAwC;AAACnkB,aAAO4wB;AAAR,KAAxC,CC8BE;ADzCW,GAAd;;AAaAC,UAAQ,IAAR;AACAhE,WAAS93B,GAAGuhB,SAAH,CAAapY,IAAb,CAAkB3Y,KAAlB,EAAyB;AAACkP,YAAQ;AAACS,WAAK,CAAN;AAASw5B,mBAAa,CAAtB;AAAyB/F,gBAAU,CAAnC;AAAsCpwB,YAAM,CAA5C;AAA+CU,gBAAU;AAAzD;AAAT,GAAzB,EAAgG+3B,OAAhG,CAAwG;AAChH9D,WAAO,UAACiC,GAAD;AACN,UAAG,CAAC0B,KAAJ;ACyCK,eDxCJF,YAAYxB,GAAZ,EAAiB,OAAjB,CCwCI;AACD;AD5C2G;AAIhH/kB,aAAS,UAAC+kB,GAAD;AACR,UAAG,CAAC0B,KAAJ;AC2CK,eD1CJF,YAAYxB,GAAZ,EAAiB,SAAjB,CC0CI;AACD;ADjD2G;AAAA,GAAxG,CAAT;AAQA0B,UAAQ,KAAR;AAEA/D,OAAKpB,KAAL;AC4CC,SD3CDoB,KAAKK,MAAL,CAAY;AC4CT,WD3CFN,OAAOO,IAAP,EC2CE;AD5CH,IC2CC;ADzFF,G;;;;;;;;;;;;AE9GAz4B,OAAO62B,OAAP,CAAe,2BAAf,EAA4C,UAACrH,OAAD,EAAU2B,MAAV;AAC3C2F,QAAMtH,OAAN,EAAe7gC,MAAf;AACAmoC,QAAM3F,MAAN,EAAcxiC,MAAd;;AAEA,OAAO,KAAKwsB,MAAZ;AACC,WAAO,KAAK4b,KAAL,EAAP;ACDC;;ADGF,QAAOvH,WAAW2B,MAAlB;AACC,WAAO,KAAK4F,KAAL,EAAP;ACDC;;ADGF,SAAO1sB,QAAQiyB,aAAR,CAAsB,WAAtB,EAAmC/yB,IAAnC,CAAwC;AAAEnG,WAAOosB,OAAT;AAAkB,gBAAY,OAA9B;AAAuC,kBAAc2B,MAArD;AAA8Dn7B,UAAM;AAApE,GAAxC,CAAP;AAVD,G;;;;;;;;;;;;AEDAumC,mBAAmB,EAAnB;AAKAA,iBAAiB,IAAjB,IAAwB,EAAxB;AAKAA,iBAAiB,OAAjB,IAA2B,EAA3B;AAEAv8B,OAAOw8B,OAAP,CAAe;AACd,MAAAC,gBAAA,EAAAC,gBAAA,EAAAC,YAAA,EAAAC,YAAA,EAAAC,EAAA,EAAAC,IAAA,EAAAnsC,IAAA,EAAAosC,OAAA,EAAAC,OAAA,EAAAC,YAAA,EAAAt8B,GAAA,EAAA8K,IAAA;AAAAoxB,OAAK73B,QAAQ,IAAR,CAAL;AACArU,SAAOqU,QAAQ,MAAR,CAAP;AACA83B,SAAO93B,QAAQ,MAAR,CAAP;;AACAi4B,iBAAe,UAACC,OAAD,EAAUC,SAAV;AACd,QAAAzZ,KAAA;AAAAA,YAAQmZ,GAAGO,WAAH,CAAeF,OAAf,CAAR;ACDE,WDEFxZ,MAAMjjB,OAAN,CAAc,UAACzK,IAAD,EAAO8B,KAAP;AACb,UAAA9I,GAAA,EAAAquC,IAAA;AAAAA,aAAOR,GAAGS,QAAH,CAAY3sC,KAAK4D,IAAL,CAAU2oC,OAAV,EAAmBlnC,IAAnB,CAAZ,CAAP;;AACA,UAAGqnC,KAAKE,WAAL,EAAH;ACAK,eDEJN,aAAatsC,KAAK4D,IAAL,CAAU2oC,OAAV,EAAmBlnC,IAAnB,CAAb,EAAuCmnC,SAAvC,CCFI;ADAL;AAICnuC,cAAM,EAAN;AACAA,YAAI2B,IAAJ,GAAWusC,OAAX;AACAluC,YAAIgH,IAAJ,GAAWA,IAAX;ACDI,eDEJmnC,UAAUlnC,IAAV,CAAejH,GAAf,CCFI;AACD;ADRL,MCFE;ADAY,GAAf;;AAcA2tC,iBAAe,EAAf;AACAI,YAAA,CAAAp8B,MAAAX,OAAA0Q,QAAA,CAAA8sB,iBAAA,YAAA78B,IAA6Co8B,OAA7C,GAA6C,MAA7C;;AACA,MAAGA,OAAH;AACCN,uBAAmB9rC,KAAK8sC,OAAL,CAAaV,OAAb,CAAnB;AACAn8B,YAAQC,GAAR,CAAY,kBAAZ,EAAgC47B,gBAAhC;;AACA,QAAGI,GAAGa,UAAH,CAAcjB,gBAAd,CAAH;AACCQ,mBAAaR,gBAAb,EAA+BE,YAA/B;AACAA,mBAAal8B,OAAb,CAAqB,UAACk9B,IAAD;AACpB,YAAAzuC,IAAA,EAAAyE,CAAA;;AAAA;AACC,cAAGmpC,KAAKruC,OAAL,CAAakvC,KAAK3nC,IAAlB,MAA2B,kBAA9B;AACC9G,mBAAO2tC,GAAGe,YAAH,CAAgBjtC,KAAK4D,IAAL,CAAUopC,KAAKhtC,IAAf,EAAqBgtC,KAAK3nC,IAA1B,CAAhB,EAAiD,MAAjD,CAAP;ACCM,mBDANumC,iBAAiB,OAAjB,EAA0BtmC,IAA1B,CAA+B8T,KAAKlV,KAAL,CAAW3F,IAAX,CAA/B,CCAM;ADHR;AAAA,iBAAA0Z,KAAA;AAIMjV,cAAAiV,KAAA;AACLhI,kBAAQgI,KAAR,CAAc,kBAAd,EAAkCjY,KAAK4D,IAAL,CAAUopC,KAAKhtC,IAAf,EAAqBgtC,KAAK3nC,IAA1B,CAAlC;ACGK,iBDFL4K,QAAQgI,KAAR,CAAcjV,EAAEi5B,KAAhB,CCEK;AACD;ADVN;AALF;ACkBE;;ADHFgQ,iBAAe,EAAf;AACAI,YAAA,CAAAvxB,OAAAzL,OAAA0Q,QAAA,CAAA8sB,iBAAA,YAAA/xB,KAA6CuxB,OAA7C,GAA6C,MAA7C;;AACA,MAAGA,OAAH;AACCN,uBAAmB/rC,KAAK8sC,OAAL,CAAaT,OAAb,CAAnB;AACAp8B,YAAQC,GAAR,CAAY,kBAAZ,EAAgC67B,gBAAhC;;AACA,QAAGG,GAAGa,UAAH,CAAchB,gBAAd,CAAH;AACCO,mBAAaP,gBAAb,EAA+BE,YAA/B;ACKG,aDJHA,aAAan8B,OAAb,CAAqB,UAACk9B,IAAD;AACpB,YAAAzuC,IAAA,EAAAyE,CAAA;;AAAA;AACC,cAAGmpC,KAAKruC,OAAL,CAAakvC,KAAK3nC,IAAlB,MAA2B,kBAA9B;AACC9G,mBAAO2tC,GAAGe,YAAH,CAAgBjtC,KAAK4D,IAAL,CAAUopC,KAAKhtC,IAAf,EAAqBgtC,KAAK3nC,IAA1B,CAAhB,EAAiD,MAAjD,CAAP;ACMM,mBDLNumC,iBAAiB,IAAjB,EAAuBtmC,IAAvB,CAA4B8T,KAAKlV,KAAL,CAAW3F,IAAX,CAA5B,CCKM;ADRR;AAAA,iBAAA0Z,KAAA;AAIMjV,cAAAiV,KAAA;AACLhI,kBAAQgI,KAAR,CAAc,kBAAd,EAAkCjY,KAAK4D,IAAL,CAAUopC,KAAKhtC,IAAf,EAAqBgtC,KAAK3nC,IAA1B,CAAlC;ACQK,iBDPL4K,QAAQgI,KAAR,CAAcjV,EAAEi5B,KAAhB,CCOK;AACD;ADfN,QCIG;ADTL;ACuBE;AD5DH,G;;;;;;;;;;;;;;;;;;;;;;;;AEZA;;;;;;;;;;GAWA5sB,OAAOw8B,OAAP,CAAe;AACd,MAAAqB,OAAA,EAAAl9B,GAAA,EAAAm9B,IAAA,EAAAC,QAAA;;AAAA,OAAAp9B,MAAAX,OAAA0Q,QAAA,CAAAstB,IAAA,YAAAr9B,IAAyBs9B,8BAAzB,GAAyB,MAAzB;AACCF,eAAW/4B,QAAQ,eAAR,CAAX;AAEA84B,WAAO99B,OAAO0Q,QAAP,CAAgBstB,IAAhB,CAAqBC,8BAA5B;AACAJ,cAAU,IAAV;ACEE,WDDFE,SAASG,WAAT,CAAqBJ,IAArB,EAA2B99B,OAAOm+B,eAAP,CAAuB;AACjD,UAAAxqC,CAAA,EAAA6xB,GAAA;;AAAA;AACC,YAAG,CAACqY,OAAJ;AACC;ACGI;;ADFLA,kBAAU,KAAV;AACAj9B,gBAAQw9B,IAAR,CAAa,gCAAb;AAEA5Y,cAAM,IAAItjB,IAAJ,EAAN;AAGA9B,WAAGi+B,wBAAH,CAA4BC,MAA5B,CAAmC;AAAEC,mBAAS,IAAX;AAAiBC,oBAAU;AAAEC,kBAAMjZ;AAAR;AAA3B,SAAnC,EAA+E;AAAEkZ,gBAAM;AAAEH,qBAAS;AAAX;AAAR,SAA/E,EAA6G;AAAEI,iBAAO;AAAT,SAA7G;AAEA/9B,gBAAQg+B,OAAR,CAAgB,gCAAhB;ACWI,eDVJf,UAAU,ICUN;ADtBL,eAAAj1B,KAAA;AAcMjV,YAAAiV,KAAA;AACLhI,gBAAQgI,KAAR,CAAc,6CAAd;AACAhI,gBAAQgI,KAAR,CAAcjV,EAAEi5B,KAAhB;ACWI,eDVJiR,UAAU,ICUN;AACD;AD7BsB,OAoBzB,UAAClqC,CAAD;AACDiN,cAAQC,GAAR,CAAY,mEAAZ;ACWG,aDVHD,QAAQC,GAAR,CAAYlN,EAAEi5B,KAAd,CCUG;ADhCuB,MAA3B,CCCE;AAiCD;ADxCH,G;;;;;;;;;;;;AEXA;;;;;;;;;;GAWA5sB,OAAOw8B,OAAP,CAAe;AACd,MAAAqB,OAAA,EAAAl9B,GAAA,EAAAm9B,IAAA,EAAAC,QAAA;;AAAA,OAAAp9B,MAAAX,OAAA0Q,QAAA,CAAAstB,IAAA,YAAAr9B,IAAyBk+B,mBAAzB,GAAyB,MAAzB;AACCd,eAAW/4B,QAAQ,eAAR,CAAX;AAEA84B,WAAO99B,OAAO0Q,QAAP,CAAgBstB,IAAhB,CAAqBa,mBAA5B;AACAhB,cAAU,IAAV;ACEE,WDDFE,SAASG,WAAT,CAAqBJ,IAArB,EAA2B99B,OAAOm+B,eAAP,CAAuB;AACjD,UAAAxqC,CAAA;;AAAA;AACC,YAAG,CAACkqC,OAAJ;AACC;ACGI;;ADFLA,kBAAU,KAAV;AACAj9B,gBAAQw9B,IAAR,CAAa,qBAAb;AAEAl+B,sBAAc4+B,iBAAd;AAEAl+B,gBAAQg+B,OAAR,CAAgB,qBAAhB;ACEI,eDDJf,UAAU,ICCN;ADVL,eAAAj1B,KAAA;AAWMjV,YAAAiV,KAAA;AACLhI,gBAAQgI,KAAR,CAAc,kCAAd;AACAhI,gBAAQgI,KAAR,CAAcjV,EAAEi5B,KAAhB;ACEI,eDDJiR,UAAU,ICCN;AACD;ADjBsB,OAiBzB,UAAClqC,CAAD;AACDiN,cAAQC,GAAR,CAAY,wDAAZ;ACEG,aDDHD,QAAQC,GAAR,CAAYlN,EAAEi5B,KAAd,CCCG;ADpBuB,MAA3B,CCCE;AAqBD;AD5BH;AA2BA5sB,OAAOitB,OAAP,CACC;AAAA4R,uBAAqB,UAAC1R,MAAD;AACpBjtB,kBAAc4+B,iBAAd,CAAgC3R,MAAhC;AACA,WAAO,IAAP;AAFD;AAAA,CADD,E;;;;;;;;;;;;AEtCAntB,OAAOw8B,OAAP,CAAe;ACCb,SDADuC,cAAcC,yBAAd,GAA0C,IAAIC,QAAQC,KAAZ,CACzC;AAAAlpC,UAAM,2BAAN;AACAmpC,gBAAY/+B,GAAGuhB,SADf;AAEAyd,aAAS,CACR;AACClwC,YAAM,KADP;AAECmwC,aAAO,qDAFR;AAGCC,iBAAW,KAHZ;AAIC7uB,aAAO,KAJR;AAKC8uB,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAAgF,KAAA,EAAA7+B,GAAA;AAAA6+B,gBAAQ,mIAAmIhF,IAAIj6B,GAAvI,GAA6I,GAArJ;;AAEA,aAAAI,MAAAo+B,cAAAC,yBAAA,CAAA5uB,iBAAA,YAAAzP,IAA8DgS,QAA9D,CAAuE6nB,IAAIj6B,GAA3E,IAAG,MAAH;AACCi/B,mBAAS,WAAT;ACCK;;ADCNA,iBAAS,GAAT;AACA,eAAOA,KAAP;AAZF;AAAA,KADQ,EAeR;AACCtwC,YAAM,MADP;AAECowC,iBAAW,KAFZ;AAGC7uB,aAAO,KAHR;AAIC8uB,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAA7+B,QAAA,EAAA7N,IAAA;AAAAA,eAAO,EAAP;;AACA,YAAGkS,OAAO6J,QAAP,KAAoBxC,QAAQyJ,QAAR,MAAsBzJ,QAAQskB,SAAR,EAA1C,CAAH;AACC79B,iBAAO,EAAP;ACEK;;ADAN6N,mBAAW,KAAX;;AAEA,YAAGqE,OAAOC,QAAV;AACCtE,qBAAW,KAAKA,QAAhB;ACCK;;ADAN,YAAGA,QAAH;AACC7N,iBAAOkS,OAAOsH,WAAP,CAAmB,oBAAkBkzB,IAAIp3B,KAAtB,GAA4B,iBAA5B,GAAgDo3B,IAAIj6B,GAApD,GAA0D,gBAA7E,CAAP;AADD;AAGCzS,iBAAOuZ,QAAQC,WAAR,CAAoB,oBAAkBkzB,IAAIp3B,KAAtB,GAA4B,iBAA5B,GAAgDo3B,IAAIj6B,GAApD,GAA0D,gBAA9E,CAAP;ACEK;;ADDN,eAAO,iBAAei6B,IAAIj6B,GAAnB,GAAuB,0BAAvB,GAAiDzS,IAAjD,GAAsD,IAAtD,GAA6D0sC,IAAIxkC,IAAjE,GAAwE,MAA/E;AAjBF;AAAA,KAfQ,EAkCR;AACC9G,YAAM,gBADP;AAECmwC,aAAOhqC,EAAE,0BAAF,CAFR;AAGCiqC,iBAAW;AAHZ,KAlCQ,EAuCR;AACCpwC,YAAM,WADP;AAECmwC,aAAOhqC,EAAE,gBAAF,CAFR;AAGCiqC,iBAAW;AAHZ,KAvCQ,EA4CR;AACCpwC,YAAM,mBADP;AAECmwC,aAAOhqC,EAAE,gBAAF,CAFR;AAGCkqC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAAx3B,KAAA,EAAAy8B,iBAAA;;AAAA,YAAGjF,IAAI/tB,KAAJ,KAAa,WAAhB;AACCzJ,kBAAQw3B,IAAIxpB,cAAJ,IAAsB,UAA9B;ACEK;;ADANyuB,4BAAoBjF,IAAIkF,iBAAJ,IAAyB,EAA7C;AAEA,eAAO,qCAC4B18B,KAD5B,GACkC,KADlC,GACsCy8B,iBADtC,GACwD,QAD/D;AATF;AAAA,KA5CQ,CAFT;AA6DAE,SAAK,IA7DL;AA8DAC,kBAAc,KA9Dd;AA+DAC,iBAAa,CAAC,OAAD,EAAU,gBAAV,EAA4B,OAA5B,EAAqC,UAArC,CA/Db;AAgEAC,gBAAY,EAhEZ;AAiEAC,UAAM,KAjEN;AAkEAC,eAAW,IAlEX;AAmEAC,gBACC;AAAAC,eAAS;AAAT,KApED;AAqEAC,eAAW,KArEX;AAsEAC,oBAAgB,UAAC1d,QAAD,EAAWvH,MAAX;AACf,UAAAklB,YAAA,EAAA3H,QAAA,EAAArtB,KAAA,EAAAqoB,aAAA,EAAA/yB,GAAA,EAAA8K,IAAA,EAAArI,KAAA,EAAAosB,OAAA;;AAAA,WAAOrU,MAAP;AACC,eAAO;AAAC5a,eAAK,CAAC;AAAP,SAAP;ACGG;;ADDJivB,gBAAU9M,SAAStf,KAAnB;;AACA,WAAOosB,OAAP;AACC,aAAA9M,YAAA,QAAA/hB,MAAA+hB,SAAA4d,IAAA,YAAA3/B,IAAmBlT,MAAnB,GAAmB,MAAnB,GAAmB,MAAnB,IAA4B,CAA5B;AACC+hC,oBAAU9M,SAAS4d,IAAT,CAAcx3B,WAAd,CAA0B,OAA1B,EAAmC,CAAnC,CAAV;AAFF;ACMI;;ADHJ,WAAO0mB,OAAP;AACC,eAAO;AAACjvB,eAAK,CAAC;AAAP,SAAP;ACOG;;ADNJ6C,cAAQhD,GAAGsyB,MAAH,CAAUpyB,OAAV,CAAkBkvB,OAAlB,CAAR;;AACA,UAAG,CAACpsB,KAAJ;AACCsf,iBAASjW,KAAT,GAAiB,MAAjB;ACQG;;ADPJ,UAAG,CAACrJ,MAAMm9B,MAAN,CAAa5tB,QAAb,CAAsBwI,MAAtB,CAAJ;AAECud,mBAAW,EAAX;AACA2H,uBAAejgC,GAAGuyB,WAAH,CAAeryB,OAAf,CAAuB;AACrC8C,iBAAOosB,OAD8B;AAErC,kBAAQrU;AAF6B,SAAvB,CAAf;;AAIA,YAAGklB,YAAH;AACC3M,0BAAgBtzB,GAAGszB,aAAH,CAAiBnqB,IAAjB,CAAsB;AACrChJ,iBAAK;AACJuiB,mBAAKud,aAAa3M;AADd;AADgC,WAAtB,EAIb3P,KAJa,EAAhB;AAKA1Y,kBAAQjL,GAAGiL,KAAH,CAAS9B,IAAT,CAAc;AAAEnG,mBAAOosB;AAAT,WAAd,CAAR;AACAnkB,gBAAM5K,OAAN,CAAc,UAAC+/B,EAAD;AACb,gBAAGp0B,gBAAgBunB,UAAhB,CAA2B6M,EAA3B,EAA+BH,YAA/B,EAA6C3M,aAA7C,KAA+DtnB,gBAAgBwnB,QAAhB,CAAyB4M,EAAzB,EAA6BH,YAA7B,EAA2C3M,aAA3C,CAAlE;ACUQ,qBDTPgF,SAASziC,IAAT,CAAcuqC,GAAGjgC,GAAjB,CCSO;AACD;ADZR;ACcI;;ADVL,aAAAmiB,YAAA,QAAAjX,OAAAiX,SAAA4d,IAAA,YAAA70B,KAAmBhe,MAAnB,GAAmB,MAAnB,GAAmB,MAAnB,IAA4B,CAA5B;AACCi1B,mBAAS4d,IAAT,CAAc,CAAd,EAAiBxc,GAAjB,GAAuB,CAAC;AAACxgB,uBAAW6X;AAAZ,WAAD,EAAsB;AAAC3X,uBAAW2X;AAAZ,WAAtB,EAA2C;AAAC4e,yBAAa5e;AAAd,WAA3C,EAAkE;AAAC8Y,0BAAc9Y;AAAf,WAAlE,EACrB;AAAC6Y,sBAAU7Y;AAAX,WADqB,EACD;AAAEvX,kBAAM;AAAEkf,mBAAK4V;AAAP;AAAR,WADC,CAAvB;AADD;AAIC13B,YAAEy/B,MAAF,CAAS/d,QAAT,EAAmB;AAClBoB,iBAAK,CAAC;AAACxgB,yBAAW6X;AAAZ,aAAD,EAAsB;AAAC3X,yBAAW2X;AAAZ,aAAtB,EAA2C;AAAC4e,2BAAa5e;AAAd,aAA3C,EAAkE;AAAC8Y,4BAAc9Y;AAAf,aAAlE,EACJ;AAAC6Y,wBAAU7Y;AAAX,aADI,EACgB;AAAEvX,oBAAM;AAAEkf,qBAAK4V;AAAP;AAAR,aADhB;AADa,WAAnB;AAtBF;ACoEI;;ADzCJ,aAAOhW,QAAP;AA9GD;AAAA,GADyC,CCAzC;ADDF,G;;;;;;;;;;;;AEAA,IAAAge,6BAAA,EAAAC,oCAAA,EAAAC,qCAAA,EAAAC,iBAAA,EAAAC,6BAAA,EAAAC,yBAAA,EAAAC,uBAAA,EAAAC,kBAAA;;AAAA55B,QAAQ65B,IAAR,CAAa,iBAAb,IAAkC,IAAIC,WAAJ,EAAlC;;AAGAN,oBAAoB,UAAC/gC,MAAD;AACnB,MAAAshC,UAAA;AAAAA,eAAa,IAAIrhC,KAAJ,EAAb;;ACGC,MAAID,UAAU,IAAd,EAAoB;ADDrBA,WAAQW,OAAR,CAAgB,UAACC,CAAD;AACf,UAAAC,GAAA;;AAAA,UAAGD,EAAEnO,IAAF,KAAU,OAAb;ACIM,eDHLqO,QAAQC,GAAR,CAAY,+BAAZ,CCGK;ADJN,aAEK,IAAGH,EAAEnO,IAAF,KAAU,SAAb;ACIC,eAAOmO,KAAK,IAAL,GAAY,CAACC,MAAMD,EAAEZ,MAAT,KAAoB,IAApB,GAA2Ba,IDHxCF,OCGwC,CDHhC,UAACK,EAAD;ACIZ,iBDHNsgC,WAAWnrC,IAAX,CAAgB6K,EAAhB,CCGM;ADJP,SCGmD,CAA3B,GDHxB,MCGY,GDHZ,MCGK;ADJD;ACQC,eDJLsgC,WAAWnrC,IAAX,CAAgByK,CAAhB,CCIK;AACD;ADZN;ACcE;;ADLF,SAAO0gC,UAAP;AAZmB,CAApB;;AAeAH,qBAAqB,cAArB;;AAGAF,4BAA4B,UAAC5P,MAAD,EAASrxB,MAAT;AAC3B,MAAAshC,UAAA,EAAA5qC,GAAA,EAAAe,OAAA;AAAAA,YAAU;AACTvB,UAAM,WADG;AAETmpC,gBAAY/+B,GAAGuhB,SAFN;AAGT0f,SAAK,kBAHI;AAITC,cAAU;ACON,aDNHthC,OAAOuX,UAAP,CAAkBvR,SAASu7B,aAAT,CAAuBC,aAAzC,EAAwD,GAAxD,CCMG;ADXK;AAOTC,kBAAc,UAAC/wB,QAAD;AACb,UAAAgxB,YAAA,EAAAC,OAAA,EAAAtC,KAAA;AAAAsC,gBAAUzsB,EAAE,mBAAF,CAAV;;AACA,UAAGysB,QAAQl0C,MAAX;AACCk0C,gBAAQ,CAAR,EAAWC,OAAX,GAAqB,GAArB;ACQG;;ADPJ,UAAG,CAACv6B,QAAQyJ,QAAR,EAAD,IAAuB,CAACzJ,QAAQw6B,KAAR,EAA3B;AACC7hC,eAAOuX,UAAP,CAAkBvR,SAASu7B,aAAT,CAAuBC,aAAzC,EAAwD,GAAxD;AACAtsB,UAAE,gBAAF,EAAoBmW,SAApB,CAA8B,CAA9B,EAAiC0L,KAAjC,CAAuC;ACSjC,iBDRL7hB,EAAE,gBAAF,EAAoB4sB,gBAApB,CAAqC,QAArC,CCQK;ADTN;AAFD;AAKC5sB,UAAE,gBAAF,EAAoBmW,SAApB,CAA8B,CAA9B;ACUG;;ADRJgU,cAAQhqC,EAAE,kBAAF,CAAR;AACAqsC,qBAAehxB,SAASqxB,SAAT,CAAmB7e,MAAnB,GAA4B3Z,IAA5B,CAAiC,yCAAjC,CAAf;ACUG,aDTHm4B,aAAaM,IAAb,CAAkB,OAAlB,EAA2B3C,KAA3B,EAAkC7K,GAAlC,CAAsC,QAAtC,EAAgD,SAAhD,EAA2DyN,KAA3D,CAAiE;AAChE,YAAAC,MAAA,EAAA1C,KAAA;;AAAA,YAAG,CAACtqB,EAAE,IAAF,EAAQ3L,IAAR,CAAa,OAAb,EAAsB9b,MAA1B;AACC+xC,kBAAQtqB,EAAE,wGAAF,CAAR;;AACA,cAAG7N,QAAQyJ,QAAR,EAAH;AACC0uB,kBAAMhL,GAAN,CAAU;AACT/jB,qBAAM,MADG;AAET0xB,sBAAQ;AAFC,aAAV;AADD;AAMC3C,kBAAMhL,GAAN,CAAU;AACT/jB,qBAAM,MADG;AAET0xB,sBAAQ;AAFC,aAAV;ACcK;;ADVN3C,gBAAMwC,IAAN,CAAW,OAAX,EAAoB3C,KAApB,EAA2B2C,IAA3B,CAAgC,aAAhC,EAA+C3C,KAA/C;AACAnqB,YAAE,IAAF,EAAQ8B,KAAR,GAAgBP,MAAhB,CAAuB+oB,KAAvB;;AACA0C,mBAAS,UAACpqC,KAAD;AACR,gBAAAsqC,KAAA;;AAAA,gBAAGtqC,QAAQ,CAAX;AACCsqC,sBAAQjrC,KAAKkrC,IAAL,CAAU3xB,SAAS4xB,gBAAT,KAA8B5xB,SAAS6xB,eAAjD,CAAR;;AACA,kBAAGzqC,QAAQsqC,KAAX;AAECtqC,wBAAQsqC,KAAR;ACYO;;ADXRtqC;ACaO,qBDZP4Y,SAASqxB,SAAT,CAAmBS,SAAnB,GAA+BC,IAA/B,CAAoC3qC,KAApC,EAA2C4qC,IAA3C,CAAgD,MAAhD,CCYO;AACD;ADpBC,WAAT;;AAQAlD,gBAAMmD,IAAN,CAAW,UAAChvC,CAAD;AACV,gBAAAivC,WAAA;AAAAA,0BAAc1tB,EAAE,IAAF,EAAQvD,GAAR,EAAd;AACAuwB,mBAAOU,WAAP;ACgBM,mBDfN1tB,EAAE,IAAF,EAAQgO,MAAR,GAAiBpT,IAAjB,CAAsB,KAAtB,CCeM;ADlBP;ACoBK,iBDhBL0vB,MAAMqD,OAAN,CAAc,UAAClvC,CAAD;AACb,gBAAAivC,WAAA;;AAAA,gBAAGjvC,EAAEmvC,OAAF,CAAUl0C,QAAV,OAAwB,IAA3B;AACCg0C,4BAAc1tB,EAAE,IAAF,EAAQvD,GAAR,EAAd;ACkBO,qBDjBPuwB,OAAOU,WAAP,CCiBO;AACD;ADrBR,YCgBK;AAOD;ADlDN,QCSG;AD7BK;AAoDTG,gBAAY,UAACC,GAAD,EAAM9zC,IAAN,EAAY+zC,SAAZ;AACX,UAAGjjC,OAAO6J,QAAV;AACC,YAAG3a,KAAKqR,GAAL,KAAY2iC,WAAWl4B,OAAX,GAAqB0lB,MAArB,CAA4Bpd,UAA3C;ACsBM,iBDrBL0vB,IAAIG,YAAJ,CAAiB,OAAjB,EAA0B,UAA1B,CCqBK;ADvBP;ACyBI;AD9EI;AAwDT/D,aAAS,CACR;AACClwC,YAAM,KADP;AAECowC,iBAAW,KAFZ;AAGCC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAA4I,UAAA,EAAAC,OAAA,EAAAx/B,SAAA,EAAAy/B,yBAAA,EAAAzgC,QAAA,EAAA0gC,eAAA,EAAAC,cAAA,EAAAC,YAAA,EAAAC,iBAAA,EAAAC,aAAA,EAAAhjC,GAAA,EAAA8K,IAAA,EAAAm4B,sBAAA,EAAAC,MAAA;AAAAL,yBAAiBr2B,OAAOqtB,IAAI33B,QAAX,EAAqBuK,MAArB,CAA4B,YAA5B,CAAjB;AAEAvK,mBAAW23B,IAAI33B,QAAf;;AACA,YAAGgR,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,OAAtB,IAAiCw/B,IAAI/tB,KAAJ,KAAa,OAAjD;AACC5J,qBAAW23B,IAAIv4B,UAAJ,IAAkBu4B,IAAI33B,QAAjC;ACyBK;;ADvBN,YAAGgR,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,QAAtB,IAAkC6Y,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,SAA3D;AACC6H,qBAAW23B,IAAI72B,WAAJ,IAAmB62B,IAAI72B,WAAlC;ACyBK;;ADvBN4/B,0BAAkBl8B,QAAQy8B,qBAAR,CAA8BjhC,QAA9B,CAAlB;AACAgB,oBAAY22B,IAAI32B,SAAhB;AACAw/B,kBAAU,EAAV;AACAO,iCAAyB,EAAzB;;AAEA,YAAGpJ,IAAIa,KAAJ,IAAa,GAAA16B,MAAA65B,IAAAT,WAAA,YAAAp5B,IAAkBgS,QAAlB,CAA2B3S,OAAOmb,MAAP,EAA3B,IAAC,MAAD,CAAb,IAA4DtH,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,OAArF;AACCqoC,oBAAU,8BAA8Br6B,QAAQC,EAAR,CAAW,mBAAX,CAA9B,GAAgE,YAA1E;AACA26B,mCAAyB,4BAA0B//B,SAA1B,GAAoC,SAApC,GAA6C22B,IAAIkF,iBAAjD,GAAmE,gBAA5F;AAFD;AAIC,cAAG7rB,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,OAAtB,IAAiCw/B,IAAIkF,iBAAxC;AACCkE,qCAAyB,4BAA0B//B,SAA1B,GAAoC,SAApC,GAA6C22B,IAAIkF,iBAAjD,GAAmE,gBAA5F;AADD;AAGCkE,qCAAyB,4BAA0B//B,SAA1B,GAAoC,QAA7D;AAPF;ACgCM;;ADvBNu/B,qBAAa,EAAb;;AACA,YAAG5I,IAAIW,eAAJ,IAAuBtnB,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,OAAhD;AACCooC,uBAAa,8BAA8Bp6B,QAAQC,EAAR,CAAW,sCAAX,EAAmD;AAAC8gB,sBAAUyQ,IAAIW;AAAf,WAAnD,CAA9B,GAAoH,WAAjI;AC2BK;;ADzBN0I,iBAAS,EAAT;;AAMA,YAAGhwB,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,OAAtB,IAAiCw/B,IAAIp4B,OAAJ,KAAe,KAAnD;AACCyhC,mBAAS,uCAAT;AADD,eAEK,IAAGhwB,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,SAAtB,IAAmCw/B,IAAI3I,SAAJ,KAAiB,IAAvD;AACJgS,mBAAS,4BAAT;ACsBK;;ADpBNJ,uBAAe,EAAf;AACAC,4BAAoB,EAApB;AACAC,wBAAA,CAAAl4B,OAAA+uB,IAAAl4B,MAAA,YAAAmJ,KAA4Bs4B,QAA5B,GAA4B,MAA5B;;AACA,gBAAOJ,aAAP;AAAA,eACM,IADN;AAEED,gCAAoB,QAApB;AADI;;AADN,eAGM,IAHN;AAIEA,gCAAoB,SAApB;AADI;;AAHN,eAKM,IALN;AAMEA,gCAAoB,OAApB;AANF;;AAOA,YAAGA,iBAAH;AACCJ,sCAA4B,mCAAiCI,iBAA7D;ACyBK;;ADvBN,eAAO,oCAC6BG,MAD7B,GACoC,oCADpC,GAEwBP,yBAFxB,GAEkD,IAFlD,GAEsD9I,IAAIxkC,IAF1D,GAEiEqtC,OAFjE,GAE2ED,UAF3E,GAEsF,WAFtF,GAGK5I,IAAI/2B,cAHT,GAGwB,gDAHxB,GAK2BmgC,sBAL3B,GAKkD,4CALlD,GAMsCJ,cANtC,GAMqD,IANrD,GAMyDD,eANzD,GAMyE,iBANhF;AAvDF;AAAA,KADQ,EAkER;AACCr0C,YAAM,6BADP;AAECmwC,aAAOhqC,EAAE,uCAAF,CAFR;AAGC2uC,eAAS;AAHV,KAlEQ,EAuER;AACC90C,YAAM,MADP;AAECmwC,aAAOhqC,EAAE,gBAAF,CAFR;AAGCkqC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAA4I,UAAA,EAAAC,OAAA,EAAAC,yBAAA,EAAAI,iBAAA,EAAAC,aAAA,EAAAhjC,GAAA,EAAA8K,IAAA,EAAAm4B,sBAAA,EAAAC,MAAA;AAAAR,kBAAU,EAAV;AACAO,iCAAyB,EAAzB;;AAEA,YAAGpJ,IAAIa,KAAJ,IAAa,GAAA16B,MAAA65B,IAAAT,WAAA,YAAAp5B,IAAkBgS,QAAlB,CAA2B3S,OAAOmb,MAAP,EAA3B,IAAC,MAAD,CAAb,IAA4DtH,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,OAArF;AACCqoC,oBAAU,8BAA8Br6B,QAAQC,EAAR,CAAW,mBAAX,CAA9B,GAAgE,YAA1E;ACgBK;;ADdNm6B,qBAAa,EAAb;;AACA,YAAG5I,IAAIW,eAAP;AACCiI,uBAAa,8BAA8Bp6B,QAAQC,EAAR,CAAW,sCAAX,EAAmD;AAAC8gB,sBAAUyQ,IAAIW;AAAf,WAAnD,CAA9B,GAAoH,WAAjI;ACkBK;;ADhBN0I,iBAAS,EAAT;;AAEA,YAAGhwB,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,OAAtB,IAAiCw/B,IAAIp4B,OAAJ,KAAe,KAAnD;AACCyhC,mBAAS,uCAAT;AADD,eAEK,IAAGhwB,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,SAAtB,IAAmCw/B,IAAI3I,SAAJ,KAAiB,IAAvD;AACJgS,mBAAS,4BAAT;ACiBK;;ADfNH,4BAAoB,EAApB;AACAC,wBAAA,CAAAl4B,OAAA+uB,IAAAl4B,MAAA,YAAAmJ,KAA4Bs4B,QAA5B,GAA4B,MAA5B;;AACA,gBAAOJ,aAAP;AAAA,eACM,IADN;AAEED,gCAAoB,QAApB;AADI;;AADN,eAGM,IAHN;AAIEA,gCAAoB,SAApB;AADI;;AAHN,eAKM,IALN;AAMEA,gCAAoB,OAApB;AANF;;AAOA,YAAGA,iBAAH;AACCJ,sCAA4B,mCAAiCI,iBAA7D;ACoBK;;ADnBN,eAAO,oCAC4BG,MAD5B,GACmC,oCADnC,GAEuBP,yBAFvB,GAEiD,IAFjD,GAEqD9I,IAAIxkC,IAFzD,GAEgEqtC,OAFhE,GAE0ED,UAF1E,GAEqF,QAF5F;AAhCF;AAoCCY,eAAS,KApCV;AAqCC1E,iBAAW;AArCZ,KAvEQ,EA8GR;AACCpwC,YAAM,gBADP;AAECmwC,aAAOhqC,EAAE,0BAAF,CAFR;AAGC2uC,eAAS,KAHV;AAIC1E,iBAAW;AAJZ,KA9GQ,EAoHR;AACCpwC,YAAM,aADP;AAECmwC,aAAOhqC,EAAE,uBAAF,CAFR;AAGCkqC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAGA,IAAI72B,WAAP;AACC,iBAAOwJ,OAAOqtB,IAAI72B,WAAX,EAAwByJ,MAAxB,CAA+B,kBAA/B,CAAP;ACiBK;ADtBR;AAOC42B,eAAS,KAPV;AAQC1E,iBAAW;AARZ,KApHQ,EA8HR;AACCpwC,YAAM,WADP;AAECmwC,aAAOhqC,EAAE,gBAAF,CAFR;AAGC2uC,eAAS,KAHV;AAIC1E,iBAAW;AAJZ,KA9HQ,EAoIR;AACCpwC,YAAM,mBADP;AAECmwC,aAAOhqC,EAAE,6BAAF,CAFR;AAGCkqC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAAyJ,MAAA,EAAAjhC,KAAA,EAAAy8B,iBAAA;;AAAA,YAAGjF,IAAI/tB,KAAJ,KAAa,WAAhB;AACCzJ,kBAAQw3B,IAAIxpB,cAAJ,IAAsB,UAA9B;ACiBK;;ADfNyuB,4BAAoBjF,IAAIkF,iBAAJ,IAAyB,EAA7C;AAEAuE,iBAAS,EAAT;;AAEA,YAAGzJ,IAAIc,QAAJ,GAAe,CAAlB;AACC2I,mBAASj7B,QAAQC,EAAR,CAAW,QAAX,CAAT;ACeK;;ADbN,eAAO,qCAC2BjG,KAD3B,GACiC,KADjC,GACqCy8B,iBADrC,GACyDwE,MADzD,GACgE,QADvE;AAdF;AAiBCD,eAAS,KAjBV;AAkBC1E,iBAAW;AAlBZ,KApIQ,EAwJR;AACCpwC,YAAM,UADP;AAECmwC,aAAOhqC,EAAE,oBAAF,CAFR;AAGCkqC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,eAAOrtB,OAAOqtB,IAAI33B,QAAX,EAAqBuK,MAArB,CAA4B,kBAA5B,CAAP;AAJF;AAMC42B,eAAS,KANV;AAOC1E,iBAAW;AAPZ,KAxJQ,EAiKR;AACCpwC,YAAM,YADP;AAECmwC,aAAOhqC,EAAE,sBAAF,CAFR;AAGCkqC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAGA,IAAIv4B,UAAP;AACC,iBAAOkL,OAAOqtB,IAAIv4B,UAAX,EAAuBmL,MAAvB,CAA8B,kBAA9B,CAAP;ACYK;ADjBR;AAOC42B,eAAS,KAPV;AAQC1E,iBAAW;AARZ,KAjKQ,EA2KR;AACCpwC,YAAM,gBADP;AAECqwC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAGA,IAAIY,cAAP;AACC,iBAAOjuB,OAAOqtB,IAAIY,cAAX,EAA2BhuB,MAA3B,CAAkC,kBAAlC,CAAP;ACYK;ADhBR;AAMC42B,eAAS,KANV;AAOC1E,iBAAW;AAPZ,KA3KQ,EAoLR;AACCpwC,YAAM,UADP;AAEC80C,eAAS;AAFV,KApLQ,EAwLR;AACC90C,YAAM,UADP;AAEC80C,eAAS;AAFV,KAxLQ,EA4LR;AACC90C,YAAM,aADP;AAECqwC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAA75B,GAAA;;AAAA,aAAA65B,OAAA,QAAA75B,MAAA65B,IAAAl4B,MAAA,YAAA3B,IAAgBujC,WAAhB,GAAgB,MAAhB,GAAgB,MAAhB,KAA+B1J,IAAIl4B,MAAJ,CAAW4hC,WAAX,KAA0B,MAAzD;AACC,cAAA1J,OAAA,OAAGA,IAAKn2B,WAAR,GAAQ,MAAR;AACC,mBAAOhP,EAAE,KAAF,CAAP;ACWM;;ADVP,iBAAOA,EAAE,IAAF,CAAP;ACYK;ADlBR;AAOC2uC,eAAS,KAPV;AAQC1E,iBAAW;AARZ,KA5LQ,CAxDA;AA+PTK,SAAQ;AAEP,UAAGt4B,QAAQyJ,QAAR,EAAH;ACaK,eDZJ,ICYI;ADbL;ACeK,eDZJ,KCYI;AACD;ADlBG,OA/PC;AAqQTiM,WAAO,CAAC,CAAC,CAAD,EAAI,MAAJ,CAAD,CArQE;AAsQT8iB,iBAAa,CAAC,MAAD,EAAS,MAAT,EAAiB,aAAjB,EAAgC,OAAhC,EAAyC,OAAzC,EAAkD,WAAlD,EAA+D,cAA/D,EACZ,cADY,EACI,OADJ,EACa,UADb,EACyB,SADzB,EACoC,mBADpC,EACyD,QADzD,EACmE,UADnE,EAC+E,gBAD/E,EACiG,WADjG,EAC8G,WAD9G,EAC2H,iBAD3H,CAtQJ;AAwQTD,kBAAc,IAxQL;AAyQTuE,gBAAY,CAAC,EAAD,EAAI,EAAJ,EAAO,EAAP,EAAU,EAAV,EAAa,EAAb,EAAgB,GAAhB,CAzQH;AA0QTrE,gBAAY,EA1QH;AA2QTC,UAAM,KA3QG;AA4QTC,eAAW,IA5QF;AA6QTC,gBACC;AAAAC,eAAS;AAAT,KA9QQ;AA+QTC,eAAW,KA/QF;AAgRTC,oBAAgB,UAAC1d,QAAD,EAAWvH,MAAX;AACf,UAAAxa,GAAA,EAAAyC,KAAA,EAAAghC,UAAA;;AAAA,WAAOjpB,MAAP;AACC,eAAO;AAAC5a,eAAK,CAAC;AAAP,SAAP;ACkBG;;ADjBJ6C,cAAQsf,SAAStf,KAAjB;;AACA,WAAOA,KAAP;AACC,aAAAsf,YAAA,QAAA/hB,MAAA+hB,SAAA4d,IAAA,YAAA3/B,IAAmBlT,MAAnB,GAAmB,MAAnB,GAAmB,MAAnB,IAA4B,CAA5B;AACC2V,kBAAQsf,SAAS4d,IAAT,CAAcx3B,WAAd,CAA0B,OAA1B,EAAmC,CAAnC,CAAR;AAFF;ACsBI;;ADnBJ,WAAO1F,KAAP;AACC,eAAO;AAAC7C,eAAK,CAAC;AAAP,SAAP;ACuBG;;ADtBJ6jC,mBAAahkC,GAAGuyB,WAAH,CAAeryB,OAAf,CAAuB;AAACoB,cAAMyZ,MAAP;AAAe/X,eAAOA;AAAtB,OAAvB,EAAqD;AAACtD,gBAAQ;AAACS,eAAK;AAAN;AAAT,OAArD,CAAb;;AACA,WAAO6jC,UAAP;AACC,eAAO;AAAC7jC,eAAK,CAAC;AAAP,SAAP;ACiCG;;ADhCJ,aAAOmiB,QAAP;AA5RQ;AA6RT2hB,gBAAY;AA7RH,GAAV;;AA0SA,MAAGlT,MAAH;AACC36B,UAAM,iBAAiB26B,MAAvB;AAEA55B,YAAQvB,IAAR,GAAeQ,GAAf;AAEAuoC,kBAAcpd,SAAd,CAAwB7hB,MAAxB,GAAiCA,MAAjC;AAEAshC,iBAAaP,kBAAkB9B,cAAcpd,SAAd,CAAwB7hB,MAA1C,CAAb;AAEAshC,eAAW3gC,OAAX,CAAmB,UAACC,CAAD;AAClB,UAAGA,EAAEnO,IAAF,KAAU,OAAV,IAAqBmO,EAAE4jC,eAA1B;ACoBK,eDnBJ/sC,QAAQ6nC,OAAR,CAAgBnpC,IAAhB,CACC;AAAA/G,gBAAOwR,EAAE1K,IAAF,IAAU0K,EAAEkK,IAAnB;AACAy0B,iBAAOhqC,EAAEqL,EAAE1K,IAAF,IAAU0K,EAAEkK,IAAd,CADP;AAEAo5B,mBAAS,KAFT;AAGA1E,qBAAW,KAHX;AAIAC,kBAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AAEP,gBAAA9rC,KAAA,EAAA4T,MAAA;AAAAA,qBAASk4B,IAAIl4B,MAAJ,IAAc,EAAvB;AAEA5T,oBAAQ4T,OAAO5B,EAAEkK,IAAT,CAAR;;AAEA,oBAAOlK,EAAEnO,IAAT;AAAA,mBACM,MADN;AAEE7D,iCAAA,OAAQA,MAAOsH,IAAf,GAAe,MAAf;AADI;;AADN,mBAGM,OAHN;AAIEtH,iCAAA,OAAQA,MAAOqa,QAAf,GAAe,MAAf;AADI;;AAHN,mBAKM,MALN;AAME,oBAAGra,KAAH;AACCA,0BAAQye,OAAOze,KAAP,EAAc0e,MAAd,CAAqB,YAArB,CAAR;ACoBQ;;ADtBL;;AALN,mBAQM,UARN;AASE,oBAAG1e,KAAH;AACCA,0BAAQye,OAAOze,KAAP,EAAc0e,MAAd,CAAqB,kBAArB,CAAR;ACsBQ;;ADxBL;;AARN,mBAWM,UAXN;AAYE,oBAAG1e,UAAS,IAAT,IAAiBA,UAAS,MAA7B;AACCA,0BAAQsa,QAAQC,EAAR,CAAW,yBAAX,CAAR;AADD;AAGCva,0BAAQsa,QAAQC,EAAR,CAAW,wBAAX,CAAR;ACwBQ;;AD5BL;;AAXN,mBAgBM,OAhBN;AAiBE,oBAAGva,KAAH;AACC,sBAAGsS,EAAEjS,OAAF,CAAUL,KAAV,CAAH;AACCA,4BAAQsS,EAAEsY,KAAF,CAAQ5qB,KAAR,EAAe,QAAf,EAAyBE,QAAzB,EAAR;AADD;AAGCF,4BAAQA,MAAM,QAAN,CAAR;AAJF;AC+BS;;ADhDX;;AAuBA,mBAAOA,KAAP;AAjCD;AAAA,SADD,CCmBI;AA6CD;ADlEL;ACoEC;;AD7BF,SAAO6I,OAAP;AA3V2B,CAA5B;;AA+VAupC,gCAAgC,UAAC3P,MAAD,EAASrxB,MAAT;AAC/B,MAAAshC,UAAA,EAAA5qC,GAAA,EAAAe,OAAA;AAAAA,YAAU;AACTvB,UAAM,gBADG;AAETmpC,gBAAY/+B,GAAGe,cAFN;AAGTkgC,SAAK,wBAHI;AAITC,cAAU;AC+BN,aD9BHthC,OAAOuX,UAAP,CAAkBvR,SAASu7B,aAAT,CAAuBC,aAAzC,EAAwD,GAAxD,CC8BG;ADnCK;AAOTC,kBAAc,UAAC/wB,QAAD;AACb,UAAAgxB,YAAA,EAAAC,OAAA,EAAAtC,KAAA;AAAAsC,gBAAUzsB,EAAE,mBAAF,CAAV;;AACA,UAAGysB,QAAQl0C,MAAX;AACCk0C,gBAAQ,CAAR,EAAWC,OAAX,GAAqB,GAArB;ACgCG;;AD/BJ,UAAG,CAACv6B,QAAQyJ,QAAR,EAAD,IAAuB,CAACzJ,QAAQw6B,KAAR,EAA3B;AACC7hC,eAAOuX,UAAP,CAAkBvR,SAASu7B,aAAT,CAAuBC,aAAzC,EAAwD,GAAxD;AACAtsB,UAAE,gBAAF,EAAoBmW,SAApB,CAA8B,CAA9B,EAAiC0L,KAAjC,CAAuC;ACiCjC,iBDhCL7hB,EAAE,gBAAF,EAAoB4sB,gBAApB,CAAqC,QAArC,CCgCK;ADjCN;AAFD;AAKC5sB,UAAE,gBAAF,EAAoBmW,SAApB,CAA8B,CAA9B;ACkCG;;ADhCJgU,cAAQhqC,EAAE,kBAAF,CAAR;AACAqsC,qBAAehxB,SAASqxB,SAAT,CAAmB7e,MAAnB,GAA4B3Z,IAA5B,CAAiC,yCAAjC,CAAf;ACkCG,aDjCHm4B,aAAaM,IAAb,CAAkB,OAAlB,EAA2B3C,KAA3B,EAAkC7K,GAAlC,CAAsC,QAAtC,EAAgD,SAAhD,EAA2DyN,KAA3D,CAAiE;AAChE,YAAAC,MAAA,EAAA1C,KAAA;;AAAA,YAAG,CAACtqB,EAAE,IAAF,EAAQ3L,IAAR,CAAa,OAAb,EAAsB9b,MAA1B;AACC+xC,kBAAQtqB,EAAE,wGAAF,CAAR;;AACA,cAAG7N,QAAQyJ,QAAR,EAAH;AACC0uB,kBAAMhL,GAAN,CAAU;AACT/jB,qBAAM,MADG;AAET0xB,sBAAQ;AAFC,aAAV;AADD;AAMC3C,kBAAMhL,GAAN,CAAU;AACT/jB,qBAAM,MADG;AAET0xB,sBAAQ;AAFC,aAAV;ACsCK;;ADlCN3C,gBAAMwC,IAAN,CAAW,OAAX,EAAoB3C,KAApB,EAA2B2C,IAA3B,CAAgC,aAAhC,EAA+C3C,KAA/C;AACAnqB,YAAE,IAAF,EAAQ8B,KAAR,GAAgBP,MAAhB,CAAuB+oB,KAAvB;;AACA0C,mBAAS,UAACpqC,KAAD;AACR,gBAAAsqC,KAAA;;AAAA,gBAAGtqC,QAAQ,CAAX;AACCsqC,sBAAQjrC,KAAKkrC,IAAL,CAAU3xB,SAAS4xB,gBAAT,KAA8B5xB,SAAS6xB,eAAjD,CAAR;;AACA,kBAAGzqC,QAAQsqC,KAAX;AAECtqC,wBAAQsqC,KAAR;ACoCO;;ADnCRtqC;ACqCO,qBDpCP4Y,SAASqxB,SAAT,CAAmBS,SAAnB,GAA+BC,IAA/B,CAAoC3qC,KAApC,EAA2C4qC,IAA3C,CAAgD,MAAhD,CCoCO;AACD;AD5CC,WAAT;;AAQAlD,gBAAMmD,IAAN,CAAW,UAAChvC,CAAD;AACV,gBAAAivC,WAAA;AAAAA,0BAAc1tB,EAAE,IAAF,EAAQvD,GAAR,EAAd;AACAuwB,mBAAOU,WAAP;ACwCM,mBDvCN1tB,EAAE,IAAF,EAAQgO,MAAR,GAAiBpT,IAAjB,CAAsB,KAAtB,CCuCM;AD1CP;AC4CK,iBDxCL0vB,MAAMqD,OAAN,CAAc,UAAClvC,CAAD;AACb,gBAAAivC,WAAA;;AAAA,gBAAGjvC,EAAEmvC,OAAF,CAAUl0C,QAAV,OAAwB,IAA3B;AACCg0C,4BAAc1tB,EAAE,IAAF,EAAQvD,GAAR,EAAd;AC0CO,qBDzCPuwB,OAAOU,WAAP,CCyCO;AACD;AD7CR,YCwCK;AAOD;AD1EN,QCiCG;ADrDK;AAoDTG,gBAAY,UAACC,GAAD,EAAM9zC,IAAN,EAAY+zC,SAAZ;AACX,UAAGjjC,OAAO6J,QAAV;AACC,YAAG3a,KAAKqS,QAAL,KAAiB2hC,WAAWl4B,OAAX,GAAqB0lB,MAArB,CAA4Bpd,UAAhD;AC8CM,iBD7CL0vB,IAAIG,YAAJ,CAAiB,OAAjB,EAA0B,UAA1B,CC6CK;AD/CP;ACiDI;ADtGI;AAwDT/D,aAAS,CACR;AACClwC,YAAM,KADP;AAECowC,iBAAW,KAFZ;AAGCC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAA4I,UAAA,EAAAC,OAAA,EAAAx/B,SAAA,EAAAy/B,yBAAA,EAAAzgC,QAAA,EAAA0gC,eAAA,EAAAC,cAAA,EAAAC,YAAA,EAAAC,iBAAA,EAAAC,aAAA,EAAAhjC,GAAA,EAAAijC,sBAAA,EAAAC,MAAA;AAAAL,yBAAiBr2B,OAAOqtB,IAAI33B,QAAX,EAAqBuK,MAArB,CAA4B,YAA5B,CAAjB;AAEAvK,mBAAW23B,IAAI33B,QAAf;;AACA,YAAGgR,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,OAAtB,IAAiCw/B,IAAIv2B,cAAJ,KAAsB,OAA1D;AACCpB,qBAAW23B,IAAIv4B,UAAJ,IAAkBu4B,IAAI33B,QAAjC;ACiDK;;AD/CN,YAAGgR,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,QAAzB;AACC6H,qBAAW23B,IAAI72B,WAAJ,IAAmB62B,IAAI33B,QAAlC;ACiDK;;AD/CN0gC,0BAAkBl8B,QAAQy8B,qBAAR,CAA8BjhC,QAA9B,CAAlB;AACAgB,oBAAY22B,IAAI32B,SAAhB;AACAw/B,kBAAU,EAAV;AACAO,iCAAyB,EAAzB;;AAEA,YAAGpJ,IAAIjoC,IAAJ,KAAY,IAAZ,IAAoBshB,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,OAA7C;AACCqoC,oBAAU,8BAA8Br6B,QAAQC,EAAR,CAAW,mBAAX,CAA9B,GAAgE,YAA1E;AACA26B,mCAAyB,4BAA0B//B,SAA1B,GAAoC,SAApC,GAA6C22B,IAAIz2B,SAAjD,GAA2D,gBAApF;AAFD;AAIC,cAAGy2B,IAAIz2B,SAAP;AACC6/B,qCAAyB,4BAA0B//B,SAA1B,GAAoC,SAApC,GAA6C22B,IAAIz2B,SAAjD,GAA2D,gBAApF;AADD;AAGC6/B,qCAAyB,4BAA0B//B,SAA1B,GAAoC,QAA7D;AAPF;ACwDM;;AD/CNu/B,qBAAa,EAAb;;AACA,YAAG5I,IAAIW,eAAJ,IAAuBtnB,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,OAAhD;AACCooC,uBAAa,8BAA8Bp6B,QAAQC,EAAR,CAAW,sCAAX,EAAmD;AAAC8gB,sBAAUyQ,IAAIW;AAAf,WAAnD,CAA9B,GAAoH,WAAjI;ACmDK;;ADjDN0I,iBAAS,EAAT;;AAEA,YAAGhwB,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,OAAtB,IAAiCw/B,IAAIp4B,OAAJ,KAAe,KAAnD;AACCyhC,mBAAS,uCAAT;AADD,eAEK,IAAGhwB,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,SAAtB,IAAmCw/B,IAAI3I,SAAJ,KAAiB,IAAvD;AACJgS,mBAAS,4BAAT;ACkDK;;ADhDNJ,uBAAe,EAAf;AACAC,4BAAoB,EAApB;AACAC,wBAAA,CAAAhjC,MAAA65B,IAAAl4B,MAAA,YAAA3B,IAA4BojC,QAA5B,GAA4B,MAA5B;;AACA,gBAAOJ,aAAP;AAAA,eACM,IADN;AAEED,gCAAoB,QAApB;AADI;;AADN,eAGM,IAHN;AAIEA,gCAAoB,SAApB;AADI;;AAHN,eAKM,IALN;AAMEA,gCAAoB,OAApB;AANF;;AAOA,YAAGA,iBAAH;AACCJ,sCAA4B,mCAAiCI,iBAA7D;ACqDK;;ADnDN,eAAO,oCAC6BG,MAD7B,GACoC,oCADpC,GAEwBP,yBAFxB,GAEkD,IAFlD,GAEsD9I,IAAIn3B,aAF1D,GAE0EggC,OAF1E,GAEoFD,UAFpF,GAE+F,WAF/F,GAGK5I,IAAI/2B,cAHT,GAGwB,gDAHxB,GAK2BmgC,sBAL3B,GAKkD,4CALlD,GAMsCJ,cANtC,GAMqD,IANrD,GAMyDD,eANzD,GAMyE,iBANhF;AAnDF;AAAA,KADQ,EA8DR;AACCr0C,YAAM,6BADP;AAECmwC,aAAOhqC,EAAE,uCAAF,CAFR;AAGC2uC,eAAS;AAHV,KA9DQ,EAmER;AACC90C,YAAM,eADP;AAECmwC,aAAOhqC,EAAE,gBAAF,CAFR;AAGCkqC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAA4I,UAAA,EAAAC,OAAA,EAAAC,yBAAA,EAAAI,iBAAA,EAAAC,aAAA,EAAAhjC,GAAA,EAAA8K,IAAA,EAAAm4B,sBAAA,EAAAC,MAAA;AAAAR,kBAAU,EAAV;AACAO,iCAAyB,EAAzB;;AAEA,YAAGpJ,IAAIa,KAAJ,IAAa,GAAA16B,MAAA65B,IAAAT,WAAA,YAAAp5B,IAAkBgS,QAAlB,CAA2B3S,OAAOmb,MAAP,EAA3B,IAAC,MAAD,CAAb,IAA4DtH,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,OAArF;AACCqoC,oBAAU,8BAA8Br6B,QAAQC,EAAR,CAAW,mBAAX,CAA9B,GAAgE,YAA1E;AC4CK;;AD1CNm6B,qBAAa,EAAb;;AACA,YAAG5I,IAAIW,eAAP;AACCiI,uBAAa,8BAA8Bp6B,QAAQC,EAAR,CAAW,sCAAX,EAAmD;AAAC8gB,sBAAUyQ,IAAIW;AAAf,WAAnD,CAA9B,GAAoH,WAAjI;AC8CK;;AD5CN0I,iBAAS,EAAT;;AAEA,YAAGhwB,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,OAAtB,IAAiCw/B,IAAIp4B,OAAJ,KAAe,KAAnD;AACCyhC,mBAAS,uCAAT;AADD,eAEK,IAAGhwB,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,SAAtB,IAAmCw/B,IAAI3I,SAAJ,KAAiB,IAAvD;AACJgS,mBAAS,4BAAT;AC6CK;;AD3CNH,4BAAoB,EAApB;AACAC,wBAAA,CAAAl4B,OAAA+uB,IAAAl4B,MAAA,YAAAmJ,KAA4Bs4B,QAA5B,GAA4B,MAA5B;;AACA,gBAAOJ,aAAP;AAAA,eACM,IADN;AAEED,gCAAoB,QAApB;AADI;;AADN,eAGM,IAHN;AAIEA,gCAAoB,SAApB;AADI;;AAHN,eAKM,IALN;AAMEA,gCAAoB,OAApB;AANF;;AAOA,YAAGA,iBAAH;AACCJ,sCAA4B,mCAAiCI,iBAA7D;ACgDK;;AD/CN,eAAO,oCAC4BG,MAD5B,GACmC,oCADnC,GAEuBP,yBAFvB,GAEiD,IAFjD,GAEqD9I,IAAIn3B,aAFzD,GAEyEggC,OAFzE,GAEmFD,UAFnF,GAE8F,QAFrG;AAhCF;AAoCCY,eAAS,KApCV;AAqCC1E,iBAAW;AArCZ,KAnEQ,EA0GR;AACCpwC,YAAM,gBADP;AAECmwC,aAAOhqC,EAAE,0BAAF,CAFR;AAGC2uC,eAAS,KAHV;AAIC1E,iBAAW;AAJZ,KA1GQ,EAgHR;AACCpwC,YAAM,aADP;AAECmwC,aAAOhqC,EAAE,uBAAF,CAFR;AAGCkqC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAGA,IAAI72B,WAAP;AACC,iBAAOwJ,OAAOqtB,IAAI72B,WAAX,EAAwByJ,MAAxB,CAA+B,kBAA/B,CAAP;AC6CK;ADlDR;AAOC42B,eAAS,KAPV;AAQC1E,iBAAW;AARZ,KAhHQ,EA0HR;AACCpwC,YAAM,WADP;AAECmwC,aAAOhqC,EAAE,gBAAF,CAFR;AAGC2uC,eAAS,KAHV;AAIC1E,iBAAW;AAJZ,KA1HQ,EAgIR;AACCpwC,YAAM,WADP;AAECmwC,aAAOhqC,EAAE,6BAAF,CAFR;AAGCkqC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAAyJ,MAAA,EAAAjhC,KAAA,EAAAy8B,iBAAA;;AAAA,YAAGjF,IAAIv2B,cAAJ,KAAsB,WAAzB;AACCjB,kBAAQw3B,IAAIx3B,KAAJ,IAAa,UAArB;AC6CK;;AD3CNy8B,4BAAoBjF,IAAIz2B,SAAJ,IAAiB,EAArC;AAEAkgC,iBAAS,EAAT;;AAEA,YAAGzJ,IAAIc,QAAJ,GAAe,CAAlB;AACC2I,mBAASj7B,QAAQC,EAAR,CAAW,QAAX,CAAT;AC2CK;;ADzCN,eAAO,qCAC2BjG,KAD3B,GACiC,KADjC,GACqCy8B,iBADrC,GACyDwE,MADzD,GACgE,QADvE;AAdF;AAiBCD,eAAS,KAjBV;AAkBC1E,iBAAW;AAlBZ,KAhIQ,EAoJR;AACCpwC,YAAM,UADP;AAECmwC,aAAOhqC,EAAE,oBAAF,CAFR;AAGCkqC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,eAAOrtB,OAAOqtB,IAAI33B,QAAX,EAAqBuK,MAArB,CAA4B,kBAA5B,CAAP;AAJF;AAMC42B,eAAS,KANV;AAOC1E,iBAAW;AAPZ,KApJQ,EA6JR;AACCpwC,YAAM,YADP;AAECmwC,aAAOhqC,EAAE,sBAAF,CAFR;AAGCkqC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAGA,IAAIv4B,UAAP;AACC,iBAAOkL,OAAOqtB,IAAIv4B,UAAX,EAAuBmL,MAAvB,CAA8B,kBAA9B,CAAP;ACwCK;AD7CR;AAOC42B,eAAS,KAPV;AAQC1E,iBAAW;AARZ,KA7JQ,EAuKR;AACCpwC,YAAM,aADP;AAECqwC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAGA,IAAIt3B,WAAP;AACC,iBAAOiK,OAAOqtB,IAAIt3B,WAAX,EAAwBkK,MAAxB,CAA+B,kBAA/B,CAAP;ACwCK;AD5CR;AAMC42B,eAAS,KANV;AAOC1E,iBAAW;AAPZ,KAvKQ,EAgLR;AACCpwC,YAAM,UADP;AAEC80C,eAAS;AAFV,KAhLQ,EAoLR;AACC90C,YAAM,UADP;AAEC80C,eAAS;AAFV,KApLQ,EAwLR;AACC90C,YAAM,aADP;AAECqwC,cAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AACP,YAAA75B,GAAA;;AAAA,aAAA65B,OAAA,QAAA75B,MAAA65B,IAAAl4B,MAAA,YAAA3B,IAAgBujC,WAAhB,GAAgB,MAAhB,GAAgB,MAAhB,KAA+B1J,IAAIl4B,MAAJ,CAAW4hC,WAAX,KAA0B,MAAzD;AACC,cAAA1J,OAAA,OAAGA,IAAKn2B,WAAR,GAAQ,MAAR;AACC,mBAAOhP,EAAE,KAAF,CAAP;ACuCM;;ADtCP,iBAAOA,EAAE,IAAF,CAAP;ACwCK;AD9CR;AAOC2uC,eAAS,KAPV;AAQC1E,iBAAW;AARZ,KAxLQ,CAxDA;AA2PTK,SAAQ;AAEP,UAAGt4B,QAAQyJ,QAAR,EAAH;ACyCK,eDxCJ,ICwCI;ADzCL;AC2CK,eDxCJ,KCwCI;AACD;AD9CG,OA3PC;AAiQTiM,WAAO,CAAC,CAAC,CAAD,EAAI,MAAJ,CAAD,CAjQE;AAkQT8iB,iBAAa,CAAC,UAAD,EAAa,MAAb,EAAqB,MAArB,EAA6B,aAA7B,EAA4C,gBAA5C,EAA8D,OAA9D,EAAuE,WAAvE,EAAoF,cAApF,EACZ,cADY,EACI,MADJ,EACY,SADZ,EACuB,WADvB,EACoC,QADpC,EAC8C,UAD9C,EAC0D,gBAD1D,EAC4E,WAD5E,EACyF,WADzF,EACsG,iBADtG,CAlQJ;AAoQTD,kBAAc,IApQL;AAqQTuE,gBAAY,CAAC,EAAD,EAAI,EAAJ,EAAO,EAAP,EAAU,EAAV,EAAa,EAAb,EAAgB,GAAhB,CArQH;AAsQTrE,gBAAY,EAtQH;AAuQTC,UAAM,KAvQG;AAwQTC,eAAW,IAxQF;AAyQTC,gBACC;AAAAC,eAAS;AAAT,KA1QQ;AA2QTC,eAAW,KA3QF;AA4QTC,oBAAgB,UAAC1d,QAAD,EAAWvH,MAAX;AACf,UAAAxa,GAAA,EAAAyC,KAAA,EAAAghC,UAAA;;AAAA,WAAOjpB,MAAP;AACC,eAAO;AAAC5a,eAAK,CAAC;AAAP,SAAP;AC8CG;;AD7CJ6C,cAAQsf,SAAStf,KAAjB;;AACA,WAAOA,KAAP;AACC,aAAAsf,YAAA,QAAA/hB,MAAA+hB,SAAA4d,IAAA,YAAA3/B,IAAmBlT,MAAnB,GAAmB,MAAnB,GAAmB,MAAnB,IAA4B,CAA5B;AACC2V,kBAAQsf,SAAS4d,IAAT,CAAcx3B,WAAd,CAA0B,OAA1B,EAAmC,CAAnC,CAAR;AAFF;ACkDI;;AD/CJ,WAAO1F,KAAP;AACC,eAAO;AAAC7C,eAAK,CAAC;AAAP,SAAP;ACmDG;;ADlDJ6jC,mBAAahkC,GAAGuyB,WAAH,CAAeryB,OAAf,CAAuB;AAACoB,cAAMyZ,MAAP;AAAe/X,eAAOA;AAAtB,OAAvB,EAAqD;AAACtD,gBAAQ;AAACS,eAAK;AAAN;AAAT,OAArD,CAAb;;AACA,WAAO6jC,UAAP;AACC,eAAO;AAAC7jC,eAAK,CAAC;AAAP,SAAP;AC6DG;;AD5DJ,aAAOmiB,QAAP;AAxRQ;AAyRT2hB,gBAAY;AAzRH,GAAV;;AA6RA,MAAGlT,MAAH;AACC36B,UAAM,iBAAiB26B,MAAvB;AAEA55B,YAAQvB,IAAR,GAAeQ,GAAf;AAEAuoC,kBAAc59B,cAAd,CAA6BrB,MAA7B,GAAsCA,MAAtC;AAEAshC,iBAAaP,kBAAkB9B,cAAc59B,cAAd,CAA6BrB,MAA/C,CAAb;AAEAshC,eAAW3gC,OAAX,CAAmB,UAACC,CAAD;AAClB,UAAGA,EAAEnO,IAAF,KAAU,OAAV,IAAqBmO,EAAE4jC,eAA1B;ACyDK,eDxDJ/sC,QAAQ6nC,OAAR,CAAgBnpC,IAAhB,CACC;AAAA/G,gBAAOwR,EAAE1K,IAAF,IAAU0K,EAAEkK,IAAnB;AACAy0B,iBAAOhqC,EAAEqL,EAAE1K,IAAF,IAAU0K,EAAEkK,IAAd,CADP;AAEAo5B,mBAAS,KAFT;AAGA1E,qBAAW,KAHX;AAIAC,kBAAQ,UAAC5tB,GAAD,EAAMpf,IAAN,EAAYioC,GAAZ;AAEP,gBAAA9rC,KAAA,EAAA4T,MAAA;AAAAA,qBAASk4B,IAAIl4B,MAAJ,IAAc,EAAvB;AAEA5T,oBAAQ4T,OAAO5B,EAAEkK,IAAT,CAAR;;AAEA,oBAAOlK,EAAEnO,IAAT;AAAA,mBACM,MADN;AAEE7D,iCAAA,OAAQA,MAAOsH,IAAf,GAAe,MAAf;AADI;;AADN,mBAGM,OAHN;AAIEtH,iCAAA,OAAQA,MAAOqa,QAAf,GAAe,MAAf;AADI;;AAHN,mBAKM,MALN;AAME,oBAAGra,KAAH;AACCA,0BAAQye,OAAOze,KAAP,EAAc0e,MAAd,CAAqB,YAArB,CAAR;ACyDQ;;AD3DL;;AALN,mBAQM,UARN;AASE,oBAAG1e,KAAH;AACCA,0BAAQye,OAAOze,KAAP,EAAc0e,MAAd,CAAqB,kBAArB,CAAR;AC2DQ;;AD7DL;;AARN,mBAWM,UAXN;AAYE,oBAAG1e,UAAS,IAAT,IAAiBA,UAAS,MAA7B;AACCA,0BAAQsa,QAAQC,EAAR,CAAW,yBAAX,CAAR;AADD;AAGCva,0BAAQsa,QAAQC,EAAR,CAAW,wBAAX,CAAR;AC6DQ;;ADjEL;;AAXN,mBAgBM,OAhBN;AAiBE,oBAAGva,KAAH;AACC,sBAAGsS,EAAEjS,OAAF,CAAUL,KAAV,CAAH;AACCA,4BAAQsS,EAAEsY,KAAF,CAAQ5qB,KAAR,EAAe,QAAf,EAAyBE,QAAzB,EAAR;AADD;AAGCF,4BAAQA,MAAM,QAAN,CAAR;AAJF;ACoES;;ADrFX;;AAuBA,mBAAOA,KAAP;AAjCD;AAAA,SADD,CCwDI;AA6CD;ADvGL;ACyGC;;ADlEF,SAAO6I,OAAP;AA9U+B,CAAhC;;AAiVAyI,OAAOw8B,OAAP,CAAe;AACduC,gBAAcpd,SAAd,GAA0B,IAAIsd,QAAQC,KAAZ,CAAkB6B,2BAAlB,CAA1B;AACAhC,gBAAc59B,cAAd,GAA+B,IAAI89B,QAAQC,KAAZ,CAAkB4B,+BAAlB,CAA/B;AACA/B,gBAAcwF,eAAd,GAAgC,IAAItF,QAAQC,KAAZ,CAAkBwB,8BAA8B,OAA9B,CAAlB,CAAhC;ACoEC,SDnED3B,cAAcyF,gBAAd,GAAiC,IAAIvF,QAAQC,KAAZ,CAAkBwB,8BAA8B,QAA9B,CAAlB,CCmEhC;ADvEF;;AAOAA,gCAAgC,UAACxsB,GAAD,EAAMid,MAAN,EAAcrxB,MAAd;AAC/B,MAAAtJ,GAAA,EAAAe,OAAA;AAAAf,QAAM,iBAAiB0d,GAAjB,GAAuBid,MAA7B;;AACA,MAAGjd,QAAO,OAAV;AACC3c,cAAUopC,qCAAqCxP,MAArC,EAA6CrxB,MAA7C,CAAV;AADD,SAEK,IAAGoU,QAAO,QAAV;AACJ3c,cAAUqpC,sCAAsCzP,MAAtC,EAA8CrxB,MAA9C,CAAV;AADI;AAGJvI,cAAUwpC,0BAA0B5P,MAA1B,EAAkCrxB,MAAlC,CAAV;;AACA,QAAG,CAACqxB,MAAJ;AACC55B,cAAQvB,IAAR,GAAe,iBAAf;AALG;AC2EH;;ADrEF,MAAGm7B,MAAH;AACC55B,YAAQvB,IAAR,GAAeQ,GAAf;ACuEC;;ADtEF,SAAOe,OAAP;AAZ+B,CAAhC;;AAcAopC,uCAAuC,UAACxP,MAAD,EAASrxB,MAAT;AACtC,MAAAvI,OAAA;AAAAA,YAAUupC,8BAA8B3P,MAA9B,EAAsCrxB,MAAtC,CAAV;;AAEA,MAAG,CAACqxB,MAAJ;AACC55B,YAAQvB,IAAR,GAAe,iBAAf;ACyEC;;ADvEFuB,UAAQwlB,KAAR,GAAgB,CAAC,CAAC,CAAD,EAAI,MAAJ,CAAD,CAAhB;;AAEAxlB,UAAQktC,OAAR,GAAkB,UAAC/hB,QAAD,EAAW3yB,IAAX;AACjB6Q,YAAQC,GAAR,CAAY,kBAAZ,EAA+B9Q,IAA/B;AACA,WAAOA,IAAP;AAFiB,GAAlB;;AAIA,SAAOwH,OAAP;AAZsC,CAAvC;;AAcAqpC,wCAAwC,UAACzP,MAAD,EAASrxB,MAAT;AACvC,MAAAvI,OAAA;AAAAA,YAAUupC,8BAA8B3P,MAA9B,EAAsCrxB,MAAtC,CAAV;;AAEA,MAAG,CAACqxB,MAAJ;AACC55B,YAAQvB,IAAR,GAAe,kBAAf;ACyEC;;ADvEFuB,UAAQwlB,KAAR,GAAgB,CAAC,CAAC,CAAD,EAAI,CAAC,CAAL,CAAD,CAAhB;;AAEAxlB,UAAQktC,OAAR,GAAkB,UAAC/hB,QAAD,EAAW3yB,IAAX;AACjB6Q,YAAQC,GAAR,CAAY,mBAAZ,EAAgC9Q,IAAhC;AAQA,WAAOA,IAAP;AATiB,GAAlB;;AAWA,SAAOwH,OAAP;AAnBuC,CAAxC;;AAqBA,IAAGyI,OAAO6J,QAAV;AACCk1B,gBAAc2F,aAAd,GAA8B,IAAIC,WAAJ,EAA9B;ACkEA;;ADhED3kC,OAAOw8B,OAAP,CAAe;ACmEb,SDlEDtR,QAAQlQ,OAAR,CAAgB,UAACjnB,CAAD;AACf,QAAGiM,OAAO6J,QAAP,IAAmB,CAACxC,QAAQyJ,QAAR,EAAvB;AACC,UAAG+C,QAAQ7Y,GAAR,CAAY,QAAZ,KAAyB6Y,QAAQ7Y,GAAR,CAAY,KAAZ,MAAsB,OAAlD;ACmEK,eDlEJgF,OAAOnR,IAAP,CAAY,yBAAZ,EAAuCglB,QAAQ7Y,GAAR,CAAY,KAAZ,CAAvC,EAA2D6Y,QAAQ7Y,GAAR,CAAY,QAAZ,CAA3D,EAAkF,UAAC4N,KAAD,EAAQxQ,MAAR;AACjF4oC,kCAAwBntB,QAAQ7Y,GAAR,CAAY,KAAZ,CAAxB,EAA4C6Y,QAAQ7Y,GAAR,CAAY,QAAZ,CAA5C,EAAmE5C,MAAnE;ACmEK,iBDlEL4N,SAASu7B,aAAT,CAAuBqD,YAAvB,ECkEK;ADpEN,UCkEI;ADpEN;ACyEG;AD1EJ,ICkEC;ADnEF;;AASA5D,0BAA0B,UAAC9sB,GAAD,EAAMid,MAAN,EAAcrxB,MAAd;AACzB,MAAA8D,IAAA,EAAApN,GAAA,EAAAmK,GAAA,EAAA8K,IAAA,EAAAwQ,IAAA;;AAAA,MAAG,CAACnc,MAAJ;AACC8D,WAAOxD,GAAGiL,KAAH,CAAS/K,OAAT,CAAiB;AAACC,WAAK4wB;AAAN,KAAjB,EAAgC;AAACrxB,cAAQ;AAACJ,cAAM;AAAP;AAAT,KAAhC,CAAP;AACAI,aAAA,CAAAa,MAAAP,GAAAC,KAAA,CAAAC,OAAA;AC8EIC,WAAKqD,QAAQ,IAAR,GAAeA,KAAKlE,IAApB,GAA2B,KAAK;AD9EzC,OC+EK;AACDI,cAAQ;AACN,0BAAkB;AADZ;AADP,KD/EL,MCmFS,IDnFT,GCmFgB,CAAC2L,OAAO9K,IAAIqK,OAAZ,KAAwB,IAAxB,GAA+BS,KDnF+C3L,MCmF9E,GDnF8E,MAA9F,GAA8F,MAA9F;ACoFC;;ADlFFA,WAAS+gC,kBAAkB/gC,MAAlB,CAAT;;AAEA,OAAAA,UAAA,QAAAmc,OAAAnc,OAAAwY,cAAA,qCAAA2D,KAAoDxuB,MAApD,GAAoD,MAApD,GAAoD,MAApD,IAA6D,CAA7D;AACC+I,UAAM,iBAAiB0d,GAAjB,GAAuBid,MAA7B;;AACA,QAAGnxB,OAAO6J,QAAV;AACCk1B,oBAAc2F,aAAd,CAA4BjqB,GAA5B,CAAgC,IAAIwkB,QAAQC,KAAZ,CAAkBwB,8BAA8BxsB,GAA9B,EAAmCid,MAAnC,EAA2CrxB,MAA3C,CAAlB,CAAhC;AADD;AAGC,UAAIm/B,QAAQC,KAAZ,CAAkBwB,8BAA8BxsB,GAA9B,EAAmCid,MAAnC,EAA2CrxB,MAA3C,CAAlB;ACmFE;;AACD,WDnFFc,QAAQC,GAAR,CAAY,oBAAZ,EAAkCrK,GAAlC,CCmFE;AACD;ADjGuB,CAA1B;;AAeA,IAAGwJ,OAAOC,QAAV;AACCD,SAAOitB,OAAP,CACC;AAAA+T,6BAAyB,UAAC9sB,GAAD,EAAMid,MAAN;AACxB,UAAArxB,MAAA,EAAA8D,IAAA,EAAAjD,GAAA,EAAA8K,IAAA;AAAAu1B,8BAAwB9sB,GAAxB,EAA6Bid,MAA7B;AAEAvtB,aAAOxD,GAAGiL,KAAH,CAAS/K,OAAT,CAAiB;AAACC,aAAK4wB;AAAN,OAAjB,EAAgC;AAACrxB,gBAAQ;AAACJ,gBAAM;AAAP;AAAT,OAAhC,CAAP;AACAI,eAAA,CAAAa,MAAAP,GAAAC,KAAA,CAAAC,OAAA;AC4FKC,aAAKqD,QAAQ,IAAR,GAAeA,KAAKlE,IAApB,GAA2B,KAAK;AD5F1C,SC6FM;AACDI,gBAAQ;AACN,4BAAkB;AADZ;AADP,OD7FN,MCiGU,IDjGV,GCiGiB,CAAC2L,OAAO9K,IAAIqK,OAAZ,KAAwB,IAAxB,GAA+BS,KDjG8C3L,MCiG7E,GDjG6E,MAA9F,GAA8F,MAA9F;AACA,aAAOA,MAAP;AALD;AAAA,GADD;AC0GA,C","file":"/packages/steedos_workflow.js","sourcesContent":["import { checkNpmVersions } from 'meteor/tmeasday:check-npm-versions';\ncheckNpmVersions({\n\t\"node-schedule\": \"^1.3.1\",\n\t\"xml2js\": \"^0.4.19\",\n}, 'steedos:workflow');","/*!\n * URI.js - Mutating URLs\n *\n * Version: 1.17.0\n *\n * Author: Rodney Rehm\n * Web: http://medialize.github.io/URI.js/\n *\n * Licensed under\n *   MIT License http://www.opensource.org/licenses/mit-license\n *   GPL v3 http://opensource.org/licenses/GPL-3.0\n *\n */\n(function (root, factory) {\n\t'use strict';\n\t// https://github.com/umdjs/umd/blob/master/returnExports.js\n\t// if (typeof exports === 'object') {\n\t//   // Node\n\t//   module.exports = factory(require('./punycode'), require('./IPv6'), require('./SecondLevelDomains'));\n\t// } else\n\tif (typeof define === 'function' && define.amd) {\n\t\t// AMD. Register as an anonymous module.\n\t\tdefine(['./punycode', './IPv6', './SecondLevelDomains'], factory);\n\t} else {\n\t\t// Browser globals (root is window)\n\t\troot.URI = factory(root.punycode, root.IPv6, root.SecondLevelDomains, root);\n\t}\n}(this, function (punycode, IPv6, SLD, root) {\n\t'use strict';\n\t/*global location, escape, unescape */\n\t// FIXME: v2.0.0 renamce non-camelCase properties to uppercase\n\t/*jshint camelcase: false */\n\n\t// save current URI variable, if any\n\tvar _URI = root && root.URI;\n\n\tfunction URI(url, base) {\n\t\tvar _urlSupplied = arguments.length >= 1;\n\t\tvar _baseSupplied = arguments.length >= 2;\n\n\t\t// Allow instantiation without the 'new' keyword\n\t\tif (!(this instanceof URI)) {\n\t\t\tif (_urlSupplied) {\n\t\t\t\tif (_baseSupplied) {\n\t\t\t\t\treturn new URI(url, base);\n\t\t\t\t}\n\n\t\t\t\treturn new URI(url);\n\t\t\t}\n\n\t\t\treturn new URI();\n\t\t}\n\n\t\tif (url === undefined) {\n\t\t\tif (_urlSupplied) {\n\t\t\t\tthrow new TypeError('undefined is not a valid argument for URI');\n\t\t\t}\n\n\t\t\tif (typeof location !== 'undefined') {\n\t\t\t\turl = location.href + '';\n\t\t\t} else {\n\t\t\t\turl = '';\n\t\t\t}\n\t\t}\n\n\t\tthis.href(url);\n\n\t\t// resolve to base according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#constructor\n\t\tif (base !== undefined) {\n\t\t\treturn this.absoluteTo(base);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tURI.version = '1.17.0';\n\n\tvar p = URI.prototype;\n\tvar hasOwn = Object.prototype.hasOwnProperty;\n\n\tfunction escapeRegEx(string) {\n\t\t// https://github.com/medialize/URI.js/commit/85ac21783c11f8ccab06106dba9735a31a86924d#commitcomment-821963\n\t\treturn string.replace(/([.*+?^=!:${}()|[\\]\\/\\\\])/g, '\\\\$1');\n\t}\n\n\tfunction getType(value) {\n\t\t// IE8 doesn't return [Object Undefined] but [Object Object] for undefined value\n\t\tif (value === undefined) {\n\t\t\treturn 'Undefined';\n\t\t}\n\n\t\treturn String(Object.prototype.toString.call(value)).slice(8, -1);\n\t}\n\n\tfunction isArray(obj) {\n\t\treturn getType(obj) === 'Array';\n\t}\n\n\tfunction filterArrayValues(data, value) {\n\t\tvar lookup = {};\n\t\tvar i, length;\n\n\t\tif (getType(value) === 'RegExp') {\n\t\t\tlookup = null;\n\t\t} else if (isArray(value)) {\n\t\t\tfor (i = 0, length = value.length; i < length; i++) {\n\t\t\t\tlookup[value[i]] = true;\n\t\t\t}\n\t\t} else {\n\t\t\tlookup[value] = true;\n\t\t}\n\n\t\tfor (i = 0, length = data.length; i < length; i++) {\n\t\t\t/*jshint laxbreak: true */\n\t\t\tvar _match = lookup && lookup[data[i]] !== undefined\n\t\t\t\t|| !lookup && value.test(data[i]);\n\t\t\t/*jshint laxbreak: false */\n\t\t\tif (_match) {\n\t\t\t\tdata.splice(i, 1);\n\t\t\t\tlength--;\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\n\t\treturn data;\n\t}\n\n\tfunction arrayContains(list, value) {\n\t\tvar i, length;\n\n\t\t// value may be string, number, array, regexp\n\t\tif (isArray(value)) {\n\t\t\t// Note: this can be optimized to O(n) (instead of current O(m * n))\n\t\t\tfor (i = 0, length = value.length; i < length; i++) {\n\t\t\t\tif (!arrayContains(list, value[i])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\tvar _type = getType(value);\n\t\tfor (i = 0, length = list.length; i < length; i++) {\n\t\t\tif (_type === 'RegExp') {\n\t\t\t\tif (typeof list[i] === 'string' && list[i].match(value)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} else if (list[i] === value) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tfunction arraysEqual(one, two) {\n\t\tif (!isArray(one) || !isArray(two)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// arrays can't be equal if they have different amount of content\n\t\tif (one.length !== two.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\tone.sort();\n\t\ttwo.sort();\n\n\t\tfor (var i = 0, l = one.length; i < l; i++) {\n\t\t\tif (one[i] !== two[i]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfunction trimSlashes(text) {\n\t\tvar trim_expression = /^\\/+|\\/+$/g;\n\t\treturn text.replace(trim_expression, '');\n\t}\n\n\tURI._parts = function() {\n\t\treturn {\n\t\t\tprotocol: null,\n\t\t\tusername: null,\n\t\t\tpassword: null,\n\t\t\thostname: null,\n\t\t\turn: null,\n\t\t\tport: null,\n\t\t\tpath: null,\n\t\t\tquery: null,\n\t\t\tfragment: null,\n\t\t\t// state\n\t\t\tduplicateQueryParameters: URI.duplicateQueryParameters,\n\t\t\tescapeQuerySpace: URI.escapeQuerySpace\n\t\t};\n\t};\n\t// state: allow duplicate query parameters (a=1&a=1)\n\tURI.duplicateQueryParameters = false;\n\t// state: replaces + with %20 (space in query strings)\n\tURI.escapeQuerySpace = true;\n\t// static properties\n\tURI.protocol_expression = /^[a-z][a-z0-9.+-]*$/i;\n\tURI.idn_expression = /[^a-z0-9\\.-]/i;\n\tURI.punycode_expression = /(xn--)/i;\n\t// well, 333.444.555.666 matches, but it sure ain't no IPv4 - do we care?\n\tURI.ip4_expression = /^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$/;\n\t// credits to Rich Brown\n\t// source: http://forums.intermapper.com/viewtopic.php?p=1096#1096\n\t// specification: http://www.ietf.org/rfc/rfc4291.txt\n\tURI.ip6_expression = /^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/;\n\t// expression used is \"gruber revised\" (@gruber v2) determined to be the\n\t// best solution in a regex-golf we did a couple of ages ago at\n\t// * http://mathiasbynens.be/demo/url-regex\n\t// * http://rodneyrehm.de/t/url-regex.html\n\tURI.find_uri_expression = /\\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?Â«Â»â€œâ€â€˜â€™]))/ig;\n\tURI.findUri = {\n\t\t// valid \"scheme://\" or \"www.\"\n\t\tstart: /\\b(?:([a-z][a-z0-9.+-]*:\\/\\/)|www\\.)/gi,\n\t\t// everything up to the next whitespace\n\t\tend: /[\\s\\r\\n]|$/,\n\t\t// trim trailing punctuation captured by end RegExp\n\t\ttrim: /[`!()\\[\\]{};:'\".,<>?Â«Â»â€œâ€â€žâ€˜â€™]+$/\n\t};\n\t// http://www.iana.org/assignments/uri-schemes.html\n\t// http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers#Well-known_ports\n\tURI.defaultPorts = {\n\t\thttp: '80',\n\t\thttps: '443',\n\t\tftp: '21',\n\t\tgopher: '70',\n\t\tws: '80',\n\t\twss: '443'\n\t};\n\t// allowed hostname characters according to RFC 3986\n\t// ALPHA DIGIT \"-\" \".\" \"_\" \"~\" \"!\" \"$\" \"&\" \"'\" \"(\" \")\" \"*\" \"+\" \",\" \";\" \"=\" %encoded\n\t// I've never seen a (non-IDN) hostname other than: ALPHA DIGIT . -\n\tURI.invalid_hostname_characters = /[^a-zA-Z0-9\\.-]/;\n\t// map DOM Elements to their URI attribute\n\tURI.domAttributes = {\n\t\t'a': 'href',\n\t\t'blockquote': 'cite',\n\t\t'link': 'href',\n\t\t'base': 'href',\n\t\t'script': 'src',\n\t\t'form': 'action',\n\t\t'img': 'src',\n\t\t'area': 'href',\n\t\t'iframe': 'src',\n\t\t'embed': 'src',\n\t\t'source': 'src',\n\t\t'track': 'src',\n\t\t'input': 'src', // but only if type=\"image\"\n\t\t'audio': 'src',\n\t\t'video': 'src'\n\t};\n\tURI.getDomAttribute = function(node) {\n\t\tif (!node || !node.nodeName) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tvar nodeName = node.nodeName.toLowerCase();\n\t\t// <input> should only expose src for type=\"image\"\n\t\tif (nodeName === 'input' && node.type !== 'image') {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn URI.domAttributes[nodeName];\n\t};\n\n\tfunction escapeForDumbFirefox36(value) {\n\t\t// https://github.com/medialize/URI.js/issues/91\n\t\treturn escape(value);\n\t}\n\n\t// encoding / decoding according to RFC3986\n\tfunction strictEncodeURIComponent(string) {\n\t\t// see https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/encodeURIComponent\n\t\treturn encodeURIComponent(string)\n\t\t\t.replace(/[!'()*]/g, escapeForDumbFirefox36)\n\t\t\t.replace(/\\*/g, '%2A');\n\t}\n\tURI.encode = strictEncodeURIComponent;\n\tURI.decode = decodeURIComponent;\n\tURI.iso8859 = function() {\n\t\tURI.encode = escape;\n\t\tURI.decode = unescape;\n\t};\n\tURI.unicode = function() {\n\t\tURI.encode = strictEncodeURIComponent;\n\t\tURI.decode = decodeURIComponent;\n\t};\n\tURI.characters = {\n\t\tpathname: {\n\t\t\tencode: {\n\t\t\t\t// RFC3986 2.1: For consistency, URI producers and normalizers should\n\t\t\t\t// use uppercase hexadecimal digits for all percent-encodings.\n\t\t\t\texpression: /%(24|26|2B|2C|3B|3D|3A|40)/ig,\n\t\t\t\tmap: {\n\t\t\t\t\t// -._~!'()*\n\t\t\t\t\t'%24': '$',\n\t\t\t\t\t'%26': '&',\n\t\t\t\t\t'%2B': '+',\n\t\t\t\t\t'%2C': ',',\n\t\t\t\t\t'%3B': ';',\n\t\t\t\t\t'%3D': '=',\n\t\t\t\t\t'%3A': ':',\n\t\t\t\t\t'%40': '@'\n\t\t\t\t}\n\t\t\t},\n\t\t\tdecode: {\n\t\t\t\texpression: /[\\/\\?#]/g,\n\t\t\t\tmap: {\n\t\t\t\t\t'/': '%2F',\n\t\t\t\t\t'?': '%3F',\n\t\t\t\t\t'#': '%23'\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\treserved: {\n\t\t\tencode: {\n\t\t\t\t// RFC3986 2.1: For consistency, URI producers and normalizers should\n\t\t\t\t// use uppercase hexadecimal digits for all percent-encodings.\n\t\t\t\texpression: /%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,\n\t\t\t\tmap: {\n\t\t\t\t\t// gen-delims\n\t\t\t\t\t'%3A': ':',\n\t\t\t\t\t'%2F': '/',\n\t\t\t\t\t'%3F': '?',\n\t\t\t\t\t'%23': '#',\n\t\t\t\t\t'%5B': '[',\n\t\t\t\t\t'%5D': ']',\n\t\t\t\t\t'%40': '@',\n\t\t\t\t\t// sub-delims\n\t\t\t\t\t'%21': '!',\n\t\t\t\t\t'%24': '$',\n\t\t\t\t\t'%26': '&',\n\t\t\t\t\t'%27': '\\'',\n\t\t\t\t\t'%28': '(',\n\t\t\t\t\t'%29': ')',\n\t\t\t\t\t'%2A': '*',\n\t\t\t\t\t'%2B': '+',\n\t\t\t\t\t'%2C': ',',\n\t\t\t\t\t'%3B': ';',\n\t\t\t\t\t'%3D': '='\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\turnpath: {\n\t\t\t// The characters under `encode` are the characters called out by RFC 2141 as being acceptable\n\t\t\t// for usage in a URN. RFC2141 also calls out \"-\", \".\", and \"_\" as acceptable characters, but\n\t\t\t// these aren't encoded by encodeURIComponent, so we don't have to call them out here. Also\n\t\t\t// note that the colon character is not featured in the encoding map; this is because URI.js\n\t\t\t// gives the colons in URNs semantic meaning as the delimiters of path segements, and so it\n\t\t\t// should not appear unencoded in a segment itself.\n\t\t\t// See also the note above about RFC3986 and capitalalized hex digits.\n\t\t\tencode: {\n\t\t\t\texpression: /%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,\n\t\t\t\tmap: {\n\t\t\t\t\t'%21': '!',\n\t\t\t\t\t'%24': '$',\n\t\t\t\t\t'%27': '\\'',\n\t\t\t\t\t'%28': '(',\n\t\t\t\t\t'%29': ')',\n\t\t\t\t\t'%2A': '*',\n\t\t\t\t\t'%2B': '+',\n\t\t\t\t\t'%2C': ',',\n\t\t\t\t\t'%3B': ';',\n\t\t\t\t\t'%3D': '=',\n\t\t\t\t\t'%40': '@'\n\t\t\t\t}\n\t\t\t},\n\t\t\t// These characters are the characters called out by RFC2141 as \"reserved\" characters that\n\t\t\t// should never appear in a URN, plus the colon character (see note above).\n\t\t\tdecode: {\n\t\t\t\texpression: /[\\/\\?#:]/g,\n\t\t\t\tmap: {\n\t\t\t\t\t'/': '%2F',\n\t\t\t\t\t'?': '%3F',\n\t\t\t\t\t'#': '%23',\n\t\t\t\t\t':': '%3A'\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\tURI.encodeQuery = function(string, escapeQuerySpace) {\n\t\tvar escaped = URI.encode(string + '');\n\t\tif (escapeQuerySpace === undefined) {\n\t\t\tescapeQuerySpace = URI.escapeQuerySpace;\n\t\t}\n\n\t\treturn escapeQuerySpace ? escaped.replace(/%20/g, '+') : escaped;\n\t};\n\tURI.decodeQuery = function(string, escapeQuerySpace) {\n\t\tstring += '';\n\t\tif (escapeQuerySpace === undefined) {\n\t\t\tescapeQuerySpace = URI.escapeQuerySpace;\n\t\t}\n\n\t\ttry {\n\t\t\treturn URI.decode(escapeQuerySpace ? string.replace(/\\+/g, '%20') : string);\n\t\t} catch(e) {\n\t\t\t// we're not going to mess with weird encodings,\n\t\t\t// give up and return the undecoded original string\n\t\t\t// see https://github.com/medialize/URI.js/issues/87\n\t\t\t// see https://github.com/medialize/URI.js/issues/92\n\t\t\treturn string;\n\t\t}\n\t};\n\t// generate encode/decode path functions\n\tvar _parts = {'encode':'encode', 'decode':'decode'};\n\tvar _part;\n\tvar generateAccessor = function(_group, _part) {\n\t\treturn function(string) {\n\t\t\ttry {\n\t\t\t\treturn URI[_part](string + '').replace(URI.characters[_group][_part].expression, function(c) {\n\t\t\t\t\treturn URI.characters[_group][_part].map[c];\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\t// we're not going to mess with weird encodings,\n\t\t\t\t// give up and return the undecoded original string\n\t\t\t\t// see https://github.com/medialize/URI.js/issues/87\n\t\t\t\t// see https://github.com/medialize/URI.js/issues/92\n\t\t\t\treturn string;\n\t\t\t}\n\t\t};\n\t};\n\n\tfor (_part in _parts) {\n\t\tURI[_part + 'PathSegment'] = generateAccessor('pathname', _parts[_part]);\n\t\tURI[_part + 'UrnPathSegment'] = generateAccessor('urnpath', _parts[_part]);\n\t}\n\n\tvar generateSegmentedPathFunction = function(_sep, _codingFuncName, _innerCodingFuncName) {\n\t\treturn function(string) {\n\t\t\t// Why pass in names of functions, rather than the function objects themselves? The\n\t\t\t// definitions of some functions (but in particular, URI.decode) will occasionally change due\n\t\t\t// to URI.js having ISO8859 and Unicode modes. Passing in the name and getting it will ensure\n\t\t\t// that the functions we use here are \"fresh\".\n\t\t\tvar actualCodingFunc;\n\t\t\tif (!_innerCodingFuncName) {\n\t\t\t\tactualCodingFunc = URI[_codingFuncName];\n\t\t\t} else {\n\t\t\t\tactualCodingFunc = function(string) {\n\t\t\t\t\treturn URI[_codingFuncName](URI[_innerCodingFuncName](string));\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tvar segments = (string + '').split(_sep);\n\n\t\t\tfor (var i = 0, length = segments.length; i < length; i++) {\n\t\t\t\tsegments[i] = actualCodingFunc(segments[i]);\n\t\t\t}\n\n\t\t\treturn segments.join(_sep);\n\t\t};\n\t};\n\n\t// This takes place outside the above loop because we don't want, e.g., encodeUrnPath functions.\n\tURI.decodePath = generateSegmentedPathFunction('/', 'decodePathSegment');\n\tURI.decodeUrnPath = generateSegmentedPathFunction(':', 'decodeUrnPathSegment');\n\tURI.recodePath = generateSegmentedPathFunction('/', 'encodePathSegment', 'decode');\n\tURI.recodeUrnPath = generateSegmentedPathFunction(':', 'encodeUrnPathSegment', 'decode');\n\n\tURI.encodeReserved = generateAccessor('reserved', 'encode');\n\n\tURI.parse = function(string, parts) {\n\t\tvar pos;\n\t\tif (!parts) {\n\t\t\tparts = {};\n\t\t}\n\t\t// [protocol\"://\"[username[\":\"password]\"@\"]hostname[\":\"port]\"/\"?][path][\"?\"querystring][\"#\"fragment]\n\n\t\t// extract fragment\n\t\tpos = string.indexOf('#');\n\t\tif (pos > -1) {\n\t\t\t// escaping?\n\t\t\tparts.fragment = string.substring(pos + 1) || null;\n\t\t\tstring = string.substring(0, pos);\n\t\t}\n\n\t\t// extract query\n\t\tpos = string.indexOf('?');\n\t\tif (pos > -1) {\n\t\t\t// escaping?\n\t\t\tparts.query = string.substring(pos + 1) || null;\n\t\t\tstring = string.substring(0, pos);\n\t\t}\n\n\t\t// extract protocol\n\t\tif (string.substring(0, 2) === '//') {\n\t\t\t// relative-scheme\n\t\t\tparts.protocol = null;\n\t\t\tstring = string.substring(2);\n\t\t\t// extract \"user:pass@host:port\"\n\t\t\tstring = URI.parseAuthority(string, parts);\n\t\t} else {\n\t\t\tpos = string.indexOf(':');\n\t\t\tif (pos > -1) {\n\t\t\t\tparts.protocol = string.substring(0, pos) || null;\n\t\t\t\tif (parts.protocol && !parts.protocol.match(URI.protocol_expression)) {\n\t\t\t\t\t// : may be within the path\n\t\t\t\t\tparts.protocol = undefined;\n\t\t\t\t} else if (string.substring(pos + 1, pos + 3) === '//') {\n\t\t\t\t\tstring = string.substring(pos + 3);\n\n\t\t\t\t\t// extract \"user:pass@host:port\"\n\t\t\t\t\tstring = URI.parseAuthority(string, parts);\n\t\t\t\t} else {\n\t\t\t\t\tstring = string.substring(pos + 1);\n\t\t\t\t\tparts.urn = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// what's left must be the path\n\t\tparts.path = string;\n\n\t\t// and we're done\n\t\treturn parts;\n\t};\n\tURI.parseHost = function(string, parts) {\n\t\t// Copy chrome, IE, opera backslash-handling behavior.\n\t\t// Back slashes before the query string get converted to forward slashes\n\t\t// See: https://github.com/joyent/node/blob/386fd24f49b0e9d1a8a076592a404168faeecc34/lib/url.js#L115-L124\n\t\t// See: https://code.google.com/p/chromium/issues/detail?id=25916\n\t\t// https://github.com/medialize/URI.js/pull/233\n\t\tstring = string.replace(/\\\\/g, '/');\n\n\t\t// extract host:port\n\t\tvar pos = string.indexOf('/');\n\t\tvar bracketPos;\n\t\tvar t;\n\n\t\tif (pos === -1) {\n\t\t\tpos = string.length;\n\t\t}\n\n\t\tif (string.charAt(0) === '[') {\n\t\t\t// IPv6 host - http://tools.ietf.org/html/draft-ietf-6man-text-addr-representation-04#section-6\n\t\t\t// I claim most client software breaks on IPv6 anyways. To simplify things, URI only accepts\n\t\t\t// IPv6+port in the format [2001:db8::1]:80 (for the time being)\n\t\t\tbracketPos = string.indexOf(']');\n\t\t\tparts.hostname = string.substring(1, bracketPos) || null;\n\t\t\tparts.port = string.substring(bracketPos + 2, pos) || null;\n\t\t\tif (parts.port === '/') {\n\t\t\t\tparts.port = null;\n\t\t\t}\n\t\t} else {\n\t\t\tvar firstColon = string.indexOf(':');\n\t\t\tvar firstSlash = string.indexOf('/');\n\t\t\tvar nextColon = string.indexOf(':', firstColon + 1);\n\t\t\tif (nextColon !== -1 && (firstSlash === -1 || nextColon < firstSlash)) {\n\t\t\t\t// IPv6 host contains multiple colons - but no port\n\t\t\t\t// this notation is actually not allowed by RFC 3986, but we're a liberal parser\n\t\t\t\tparts.hostname = string.substring(0, pos) || null;\n\t\t\t\tparts.port = null;\n\t\t\t} else {\n\t\t\t\tt = string.substring(0, pos).split(':');\n\t\t\t\tparts.hostname = t[0] || null;\n\t\t\t\tparts.port = t[1] || null;\n\t\t\t}\n\t\t}\n\n\t\tif (parts.hostname && string.substring(pos).charAt(0) !== '/') {\n\t\t\tpos++;\n\t\t\tstring = '/' + string;\n\t\t}\n\n\t\treturn string.substring(pos) || '/';\n\t};\n\tURI.parseAuthority = function(string, parts) {\n\t\tstring = URI.parseUserinfo(string, parts);\n\t\treturn URI.parseHost(string, parts);\n\t};\n\tURI.parseUserinfo = function(string, parts) {\n\t\t// extract username:password\n\t\tvar firstSlash = string.indexOf('/');\n\t\tvar pos = string.lastIndexOf('@', firstSlash > -1 ? firstSlash : string.length - 1);\n\t\tvar t;\n\n\t\t// authority@ must come before /path\n\t\tif (pos > -1 && (firstSlash === -1 || pos < firstSlash)) {\n\t\t\tt = string.substring(0, pos).split(':');\n\t\t\tparts.username = t[0] ? URI.decode(t[0]) : null;\n\t\t\tt.shift();\n\t\t\tparts.password = t[0] ? URI.decode(t.join(':')) : null;\n\t\t\tstring = string.substring(pos + 1);\n\t\t} else {\n\t\t\tparts.username = null;\n\t\t\tparts.password = null;\n\t\t}\n\n\t\treturn string;\n\t};\n\tURI.parseQuery = function(string, escapeQuerySpace) {\n\t\tif (!string) {\n\t\t\treturn {};\n\t\t}\n\n\t\t// throw out the funky business - \"?\"[name\"=\"value\"&\"]+\n\t\tstring = string.replace(/&+/g, '&').replace(/^\\?*&*|&+$/g, '');\n\n\t\tif (!string) {\n\t\t\treturn {};\n\t\t}\n\n\t\tvar items = {};\n\t\tvar splits = string.split('&');\n\t\tvar length = splits.length;\n\t\tvar v, name, value;\n\n\t\tfor (var i = 0; i < length; i++) {\n\t\t\tv = splits[i].split('=');\n\t\t\tname = URI.decodeQuery(v.shift(), escapeQuerySpace);\n\t\t\t// no \"=\" is null according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#collect-url-parameters\n\t\t\tvalue = v.length ? URI.decodeQuery(v.join('='), escapeQuerySpace) : null;\n\n\t\t\tif (hasOwn.call(items, name)) {\n\t\t\t\tif (typeof items[name] === 'string' || items[name] === null) {\n\t\t\t\t\titems[name] = [items[name]];\n\t\t\t\t}\n\n\t\t\t\titems[name].push(value);\n\t\t\t} else {\n\t\t\t\titems[name] = value;\n\t\t\t}\n\t\t}\n\n\t\treturn items;\n\t};\n\n\tURI.build = function(parts) {\n\t\tvar t = '';\n\n\t\tif (parts.protocol) {\n\t\t\tt += parts.protocol + ':';\n\t\t}\n\n\t\tif (!parts.urn && (t || parts.hostname)) {\n\t\t\tt += '//';\n\t\t}\n\n\t\tt += (URI.buildAuthority(parts) || '');\n\n\t\tif (typeof parts.path === 'string') {\n\t\t\tif (parts.path.charAt(0) !== '/' && typeof parts.hostname === 'string') {\n\t\t\t\tt += '/';\n\t\t\t}\n\n\t\t\tt += parts.path;\n\t\t}\n\n\t\tif (typeof parts.query === 'string' && parts.query) {\n\t\t\tt += '?' + parts.query;\n\t\t}\n\n\t\tif (typeof parts.fragment === 'string' && parts.fragment) {\n\t\t\tt += '#' + parts.fragment;\n\t\t}\n\t\treturn t;\n\t};\n\tURI.buildHost = function(parts) {\n\t\tvar t = '';\n\n\t\tif (!parts.hostname) {\n\t\t\treturn '';\n\t\t} else if (URI.ip6_expression.test(parts.hostname)) {\n\t\t\tt += '[' + parts.hostname + ']';\n\t\t} else {\n\t\t\tt += parts.hostname;\n\t\t}\n\n\t\tif (parts.port) {\n\t\t\tt += ':' + parts.port;\n\t\t}\n\n\t\treturn t;\n\t};\n\tURI.buildAuthority = function(parts) {\n\t\treturn URI.buildUserinfo(parts) + URI.buildHost(parts);\n\t};\n\tURI.buildUserinfo = function(parts) {\n\t\tvar t = '';\n\n\t\tif (parts.username) {\n\t\t\tt += URI.encode(parts.username);\n\n\t\t\tif (parts.password) {\n\t\t\t\tt += ':' + URI.encode(parts.password);\n\t\t\t}\n\n\t\t\tt += '@';\n\t\t}\n\n\t\treturn t;\n\t};\n\tURI.buildQuery = function(data, duplicateQueryParameters, escapeQuerySpace) {\n\t\t// according to http://tools.ietf.org/html/rfc3986 or http://labs.apache.org/webarch/uri/rfc/rfc3986.html\n\t\t// being Â»-._~!$&'()*+,;=:@/?Â« %HEX and alnum are allowed\n\t\t// the RFC explicitly states ?/foo being a valid use case, no mention of parameter syntax!\n\t\t// URI.js treats the query string as being application/x-www-form-urlencoded\n\t\t// see http://www.w3.org/TR/REC-html40/interact/forms.html#form-content-type\n\n\t\tvar t = '';\n\t\tvar unique, key, i, length;\n\t\tfor (key in data) {\n\t\t\tif (hasOwn.call(data, key) && key) {\n\t\t\t\tif (isArray(data[key])) {\n\t\t\t\t\tunique = {};\n\t\t\t\t\tfor (i = 0, length = data[key].length; i < length; i++) {\n\t\t\t\t\t\tif (data[key][i] !== undefined && unique[data[key][i] + ''] === undefined) {\n\t\t\t\t\t\t\tt += '&' + URI.buildQueryParameter(key, data[key][i], escapeQuerySpace);\n\t\t\t\t\t\t\tif (duplicateQueryParameters !== true) {\n\t\t\t\t\t\t\t\tunique[data[key][i] + ''] = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (data[key] !== undefined) {\n\t\t\t\t\tt += '&' + URI.buildQueryParameter(key, data[key], escapeQuerySpace);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn t.substring(1);\n\t};\n\tURI.buildQueryParameter = function(name, value, escapeQuerySpace) {\n\t\t// http://www.w3.org/TR/REC-html40/interact/forms.html#form-content-type -- application/x-www-form-urlencoded\n\t\t// don't append \"=\" for null values, according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#url-parameter-serialization\n\t\treturn URI.encodeQuery(name, escapeQuerySpace) + (value !== null ? '=' + URI.encodeQuery(value, escapeQuerySpace) : '');\n\t};\n\n\tURI.addQuery = function(data, name, value) {\n\t\tif (typeof name === 'object') {\n\t\t\tfor (var key in name) {\n\t\t\t\tif (hasOwn.call(name, key)) {\n\t\t\t\t\tURI.addQuery(data, key, name[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (typeof name === 'string') {\n\t\t\tif (data[name] === undefined) {\n\t\t\t\tdata[name] = value;\n\t\t\t\treturn;\n\t\t\t} else if (typeof data[name] === 'string') {\n\t\t\t\tdata[name] = [data[name]];\n\t\t\t}\n\n\t\t\tif (!isArray(value)) {\n\t\t\t\tvalue = [value];\n\t\t\t}\n\n\t\t\tdata[name] = (data[name] || []).concat(value);\n\t\t} else {\n\t\t\tthrow new TypeError('URI.addQuery() accepts an object, string as the name parameter');\n\t\t}\n\t};\n\tURI.removeQuery = function(data, name, value) {\n\t\tvar i, length, key;\n\n\t\tif (isArray(name)) {\n\t\t\tfor (i = 0, length = name.length; i < length; i++) {\n\t\t\t\tdata[name[i]] = undefined;\n\t\t\t}\n\t\t} else if (getType(name) === 'RegExp') {\n\t\t\tfor (key in data) {\n\t\t\t\tif (name.test(key)) {\n\t\t\t\t\tdata[key] = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (typeof name === 'object') {\n\t\t\tfor (key in name) {\n\t\t\t\tif (hasOwn.call(name, key)) {\n\t\t\t\t\tURI.removeQuery(data, key, name[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (typeof name === 'string') {\n\t\t\tif (value !== undefined) {\n\t\t\t\tif (getType(value) === 'RegExp') {\n\t\t\t\t\tif (!isArray(data[name]) && value.test(data[name])) {\n\t\t\t\t\t\tdata[name] = undefined;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata[name] = filterArrayValues(data[name], value);\n\t\t\t\t\t}\n\t\t\t\t} else if (data[name] === String(value) && (!isArray(value) || value.length === 1)) {\n\t\t\t\t\tdata[name] = undefined;\n\t\t\t\t} else if (isArray(data[name])) {\n\t\t\t\t\tdata[name] = filterArrayValues(data[name], value);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdata[name] = undefined;\n\t\t\t}\n\t\t} else {\n\t\t\tthrow new TypeError('URI.removeQuery() accepts an object, string, RegExp as the first parameter');\n\t\t}\n\t};\n\tURI.hasQuery = function(data, name, value, withinArray) {\n\t\tif (typeof name === 'object') {\n\t\t\tfor (var key in name) {\n\t\t\t\tif (hasOwn.call(name, key)) {\n\t\t\t\t\tif (!URI.hasQuery(data, key, name[key])) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t} else if (typeof name !== 'string') {\n\t\t\tthrow new TypeError('URI.hasQuery() accepts an object, string as the name parameter');\n\t\t}\n\n\t\tswitch (getType(value)) {\n\t\t\tcase 'Undefined':\n\t\t\t\t// true if exists (but may be empty)\n\t\t\t\treturn name in data; // data[name] !== undefined;\n\n\t\t\tcase 'Boolean':\n\t\t\t\t// true if exists and non-empty\n\t\t\t\tvar _booly = Boolean(isArray(data[name]) ? data[name].length : data[name]);\n\t\t\t\treturn value === _booly;\n\n\t\t\tcase 'Function':\n\t\t\t\t// allow complex comparison\n\t\t\t\treturn !!value(data[name], name, data);\n\n\t\t\tcase 'Array':\n\t\t\t\tif (!isArray(data[name])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar op = withinArray ? arrayContains : arraysEqual;\n\t\t\t\treturn op(data[name], value);\n\n\t\t\tcase 'RegExp':\n\t\t\t\tif (!isArray(data[name])) {\n\t\t\t\t\treturn Boolean(data[name] && data[name].match(value));\n\t\t\t\t}\n\n\t\t\t\tif (!withinArray) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn arrayContains(data[name], value);\n\n\t\t\tcase 'Number':\n\t\t\t\tvalue = String(value);\n\t\t\t/* falls through */\n\t\t\tcase 'String':\n\t\t\t\tif (!isArray(data[name])) {\n\t\t\t\t\treturn data[name] === value;\n\t\t\t\t}\n\n\t\t\t\tif (!withinArray) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn arrayContains(data[name], value);\n\n\t\t\tdefault:\n\t\t\t\tthrow new TypeError('URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter');\n\t\t}\n\t};\n\n\n\tURI.commonPath = function(one, two) {\n\t\tvar length = Math.min(one.length, two.length);\n\t\tvar pos;\n\n\t\t// find first non-matching character\n\t\tfor (pos = 0; pos < length; pos++) {\n\t\t\tif (one.charAt(pos) !== two.charAt(pos)) {\n\t\t\t\tpos--;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (pos < 1) {\n\t\t\treturn one.charAt(0) === two.charAt(0) && one.charAt(0) === '/' ? '/' : '';\n\t\t}\n\n\t\t// revert to last /\n\t\tif (one.charAt(pos) !== '/' || two.charAt(pos) !== '/') {\n\t\t\tpos = one.substring(0, pos).lastIndexOf('/');\n\t\t}\n\n\t\treturn one.substring(0, pos + 1);\n\t};\n\n\tURI.withinString = function(string, callback, options) {\n\t\toptions || (options = {});\n\t\tvar _start = options.start || URI.findUri.start;\n\t\tvar _end = options.end || URI.findUri.end;\n\t\tvar _trim = options.trim || URI.findUri.trim;\n\t\tvar _attributeOpen = /[a-z0-9-]=[\"']?$/i;\n\n\t\t_start.lastIndex = 0;\n\t\twhile (true) {\n\t\t\tvar match = _start.exec(string);\n\t\t\tif (!match) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tvar start = match.index;\n\t\t\tif (options.ignoreHtml) {\n\t\t\t\t// attribut(e=[\"']?$)\n\t\t\t\tvar attributeOpen = string.slice(Math.max(start - 3, 0), start);\n\t\t\t\tif (attributeOpen && _attributeOpen.test(attributeOpen)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar end = start + string.slice(start).search(_end);\n\t\t\tvar slice = string.slice(start, end).replace(_trim, '');\n\t\t\tif (options.ignore && options.ignore.test(slice)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tend = start + slice.length;\n\t\t\tvar result = callback(slice, start, end, string);\n\t\t\tstring = string.slice(0, start) + result + string.slice(end);\n\t\t\t_start.lastIndex = start + result.length;\n\t\t}\n\n\t\t_start.lastIndex = 0;\n\t\treturn string;\n\t};\n\n\tURI.ensureValidHostname = function(v) {\n\t\t// Theoretically URIs allow percent-encoding in Hostnames (according to RFC 3986)\n\t\t// they are not part of DNS and therefore ignored by URI.js\n\n\t\tif (v.match(URI.invalid_hostname_characters)) {\n\t\t\t// test punycode\n\t\t\tif (!punycode) {\n\t\t\t\tthrow new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-] and Punycode.js is not available');\n\t\t\t}\n\n\t\t\tif (punycode.toASCII(v).match(URI.invalid_hostname_characters)) {\n\t\t\t\tthrow new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-]');\n\t\t\t}\n\t\t}\n\t};\n\n\t// noConflict\n\tURI.noConflict = function(removeAll) {\n\t\tif (removeAll) {\n\t\t\tvar unconflicted = {\n\t\t\t\tURI: this.noConflict()\n\t\t\t};\n\n\t\t\tif (root.URITemplate && typeof root.URITemplate.noConflict === 'function') {\n\t\t\t\tunconflicted.URITemplate = root.URITemplate.noConflict();\n\t\t\t}\n\n\t\t\tif (root.IPv6 && typeof root.IPv6.noConflict === 'function') {\n\t\t\t\tunconflicted.IPv6 = root.IPv6.noConflict();\n\t\t\t}\n\n\t\t\tif (root.SecondLevelDomains && typeof root.SecondLevelDomains.noConflict === 'function') {\n\t\t\t\tunconflicted.SecondLevelDomains = root.SecondLevelDomains.noConflict();\n\t\t\t}\n\n\t\t\treturn unconflicted;\n\t\t} else if (root.URI === this) {\n\t\t\troot.URI = _URI;\n\t\t}\n\n\t\treturn this;\n\t};\n\n\tp.build = function(deferBuild) {\n\t\tif (deferBuild === true) {\n\t\t\tthis._deferred_build = true;\n\t\t} else if (deferBuild === undefined || this._deferred_build) {\n\t\t\tthis._string = URI.build(this._parts);\n\t\t\tthis._deferred_build = false;\n\t\t}\n\n\t\treturn this;\n\t};\n\n\tp.clone = function() {\n\t\treturn new URI(this);\n\t};\n\n\tp.valueOf = p.toString = function() {\n\t\treturn this.build(false)._string;\n\t};\n\n\n\tfunction generateSimpleAccessor(_part){\n\t\treturn function(v, build) {\n\t\t\tif (v === undefined) {\n\t\t\t\treturn this._parts[_part] || '';\n\t\t\t} else {\n\t\t\t\tthis._parts[_part] = v || null;\n\t\t\t\tthis.build(!build);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t};\n\t}\n\n\tfunction generatePrefixAccessor(_part, _key){\n\t\treturn function(v, build) {\n\t\t\tif (v === undefined) {\n\t\t\t\treturn this._parts[_part] || '';\n\t\t\t} else {\n\t\t\t\tif (v !== null) {\n\t\t\t\t\tv = v + '';\n\t\t\t\t\tif (v.charAt(0) === _key) {\n\t\t\t\t\t\tv = v.substring(1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis._parts[_part] = v;\n\t\t\t\tthis.build(!build);\n\t\t\t\treturn this;\n\t\t\t}\n\t\t};\n\t}\n\n\tp.protocol = generateSimpleAccessor('protocol');\n\tp.username = generateSimpleAccessor('username');\n\tp.password = generateSimpleAccessor('password');\n\tp.hostname = generateSimpleAccessor('hostname');\n\tp.port = generateSimpleAccessor('port');\n\tp.query = generatePrefixAccessor('query', '?');\n\tp.fragment = generatePrefixAccessor('fragment', '#');\n\n\tp.search = function(v, build) {\n\t\tvar t = this.query(v, build);\n\t\treturn typeof t === 'string' && t.length ? ('?' + t) : t;\n\t};\n\tp.hash = function(v, build) {\n\t\tvar t = this.fragment(v, build);\n\t\treturn typeof t === 'string' && t.length ? ('#' + t) : t;\n\t};\n\n\tp.pathname = function(v, build) {\n\t\tif (v === undefined || v === true) {\n\t\t\tvar res = this._parts.path || (this._parts.hostname ? '/' : '');\n\t\t\treturn v ? (this._parts.urn ? URI.decodeUrnPath : URI.decodePath)(res) : res;\n\t\t} else {\n\t\t\tif (this._parts.urn) {\n\t\t\t\tthis._parts.path = v ? URI.recodeUrnPath(v) : '';\n\t\t\t} else {\n\t\t\t\tthis._parts.path = v ? URI.recodePath(v) : '/';\n\t\t\t}\n\t\t\tthis.build(!build);\n\t\t\treturn this;\n\t\t}\n\t};\n\tp.path = p.pathname;\n\tp.href = function(href, build) {\n\t\tvar key;\n\n\t\tif (href === undefined) {\n\t\t\treturn this.toString();\n\t\t}\n\n\t\tthis._string = '';\n\t\tthis._parts = URI._parts();\n\n\t\tvar _URI = href instanceof URI;\n\t\tvar _object = typeof href === 'object' && (href.hostname || href.path || href.pathname);\n\t\tif (href.nodeName) {\n\t\t\tvar attribute = URI.getDomAttribute(href);\n\t\t\thref = href[attribute] || '';\n\t\t\t_object = false;\n\t\t}\n\n\t\t// window.location is reported to be an object, but it's not the sort\n\t\t// of object we're looking for:\n\t\t// * location.protocol ends with a colon\n\t\t// * location.query != object.search\n\t\t// * location.hash != object.fragment\n\t\t// simply serializing the unknown object should do the trick\n\t\t// (for location, not for everything...)\n\t\tif (!_URI && _object && href.pathname !== undefined) {\n\t\t\thref = href.toString();\n\t\t}\n\n\t\tif (typeof href === 'string' || href instanceof String) {\n\t\t\tthis._parts = URI.parse(String(href), this._parts);\n\t\t} else if (_URI || _object) {\n\t\t\tvar src = _URI ? href._parts : href;\n\t\t\tfor (key in src) {\n\t\t\t\tif (hasOwn.call(this._parts, key)) {\n\t\t\t\t\tthis._parts[key] = src[key];\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthrow new TypeError('invalid input');\n\t\t}\n\n\t\tthis.build(!build);\n\t\treturn this;\n\t};\n\n\t// identification accessors\n\tp.is = function(what) {\n\t\tvar ip = false;\n\t\tvar ip4 = false;\n\t\tvar ip6 = false;\n\t\tvar name = false;\n\t\tvar sld = false;\n\t\tvar idn = false;\n\t\tvar punycode = false;\n\t\tvar relative = !this._parts.urn;\n\n\t\tif (this._parts.hostname) {\n\t\t\trelative = false;\n\t\t\tip4 = URI.ip4_expression.test(this._parts.hostname);\n\t\t\tip6 = URI.ip6_expression.test(this._parts.hostname);\n\t\t\tip = ip4 || ip6;\n\t\t\tname = !ip;\n\t\t\tsld = name && SLD && SLD.has(this._parts.hostname);\n\t\t\tidn = name && URI.idn_expression.test(this._parts.hostname);\n\t\t\tpunycode = name && URI.punycode_expression.test(this._parts.hostname);\n\t\t}\n\n\t\tswitch (what.toLowerCase()) {\n\t\t\tcase 'relative':\n\t\t\t\treturn relative;\n\n\t\t\tcase 'absolute':\n\t\t\t\treturn !relative;\n\n\t\t\t// hostname identification\n\t\t\tcase 'domain':\n\t\t\tcase 'name':\n\t\t\t\treturn name;\n\n\t\t\tcase 'sld':\n\t\t\t\treturn sld;\n\n\t\t\tcase 'ip':\n\t\t\t\treturn ip;\n\n\t\t\tcase 'ip4':\n\t\t\tcase 'ipv4':\n\t\t\tcase 'inet4':\n\t\t\t\treturn ip4;\n\n\t\t\tcase 'ip6':\n\t\t\tcase 'ipv6':\n\t\t\tcase 'inet6':\n\t\t\t\treturn ip6;\n\n\t\t\tcase 'idn':\n\t\t\t\treturn idn;\n\n\t\t\tcase 'url':\n\t\t\t\treturn !this._parts.urn;\n\n\t\t\tcase 'urn':\n\t\t\t\treturn !!this._parts.urn;\n\n\t\t\tcase 'punycode':\n\t\t\t\treturn punycode;\n\t\t}\n\n\t\treturn null;\n\t};\n\n\t// component specific input validation\n\tvar _protocol = p.protocol;\n\tvar _port = p.port;\n\tvar _hostname = p.hostname;\n\n\tp.protocol = function(v, build) {\n\t\tif (v !== undefined) {\n\t\t\tif (v) {\n\t\t\t\t// accept trailing ://\n\t\t\t\tv = v.replace(/:(\\/\\/)?$/, '');\n\n\t\t\t\tif (!v.match(URI.protocol_expression)) {\n\t\t\t\t\tthrow new TypeError('Protocol \"' + v + '\" contains characters other than [A-Z0-9.+-] or doesn\\'t start with [A-Z]');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn _protocol.call(this, v, build);\n\t};\n\tp.scheme = p.protocol;\n\tp.port = function(v, build) {\n\t\tif (this._parts.urn) {\n\t\t\treturn v === undefined ? '' : this;\n\t\t}\n\n\t\tif (v !== undefined) {\n\t\t\tif (v === 0) {\n\t\t\t\tv = null;\n\t\t\t}\n\n\t\t\tif (v) {\n\t\t\t\tv += '';\n\t\t\t\tif (v.charAt(0) === ':') {\n\t\t\t\t\tv = v.substring(1);\n\t\t\t\t}\n\n\t\t\t\tif (v.match(/[^0-9]/)) {\n\t\t\t\t\tthrow new TypeError('Port \"' + v + '\" contains characters other than [0-9]');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn _port.call(this, v, build);\n\t};\n\tp.hostname = function(v, build) {\n\t\tif (this._parts.urn) {\n\t\t\treturn v === undefined ? '' : this;\n\t\t}\n\n\t\tif (v !== undefined) {\n\t\t\tvar x = {};\n\t\t\tvar res = URI.parseHost(v, x);\n\t\t\tif (res !== '/') {\n\t\t\t\tthrow new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-]');\n\t\t\t}\n\n\t\t\tv = x.hostname;\n\t\t}\n\t\treturn _hostname.call(this, v, build);\n\t};\n\n\t// compound accessors\n\tp.origin = function(v, build) {\n\t\tvar parts;\n\n\t\tif (this._parts.urn) {\n\t\t\treturn v === undefined ? '' : this;\n\t\t}\n\n\t\tif (v === undefined) {\n\t\t\tvar protocol = this.protocol();\n\t\t\tvar authority = this.authority();\n\t\t\tif (!authority) return '';\n\t\t\treturn (protocol ? protocol + '://' : '') + this.authority();\n\t\t} else {\n\t\t\tvar origin = URI(v);\n\t\t\tthis\n\t\t\t\t.protocol(origin.protocol())\n\t\t\t\t.authority(origin.authority())\n\t\t\t\t.build(!build);\n\t\t\treturn this;\n\t\t}\n\t};\n\tp.host = function(v, build) {\n\t\tif (this._parts.urn) {\n\t\t\treturn v === undefined ? '' : this;\n\t\t}\n\n\t\tif (v === undefined) {\n\t\t\treturn this._parts.hostname ? URI.buildHost(this._parts) : '';\n\t\t} else {\n\t\t\tvar res = URI.parseHost(v, this._parts);\n\t\t\tif (res !== '/') {\n\t\t\t\tthrow new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-]');\n\t\t\t}\n\n\t\t\tthis.build(!build);\n\t\t\treturn this;\n\t\t}\n\t};\n\tp.authority = function(v, build) {\n\t\tif (this._parts.urn) {\n\t\t\treturn v === undefined ? '' : this;\n\t\t}\n\n\t\tif (v === undefined) {\n\t\t\treturn this._parts.hostname ? URI.buildAuthority(this._parts) : '';\n\t\t} else {\n\t\t\tvar res = URI.parseAuthority(v, this._parts);\n\t\t\tif (res !== '/') {\n\t\t\t\tthrow new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-]');\n\t\t\t}\n\n\t\t\tthis.build(!build);\n\t\t\treturn this;\n\t\t}\n\t};\n\tp.userinfo = function(v, build) {\n\t\tif (this._parts.urn) {\n\t\t\treturn v === undefined ? '' : this;\n\t\t}\n\n\t\tif (v === undefined) {\n\t\t\tif (!this._parts.username) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tvar t = URI.buildUserinfo(this._parts);\n\t\t\treturn t.substring(0, t.length -1);\n\t\t} else {\n\t\t\tif (v[v.length-1] !== '@') {\n\t\t\t\tv += '@';\n\t\t\t}\n\n\t\t\tURI.parseUserinfo(v, this._parts);\n\t\t\tthis.build(!build);\n\t\t\treturn this;\n\t\t}\n\t};\n\tp.resource = function(v, build) {\n\t\tvar parts;\n\n\t\tif (v === undefined) {\n\t\t\treturn this.path() + this.search() + this.hash();\n\t\t}\n\n\t\tparts = URI.parse(v);\n\t\tthis._parts.path = parts.path;\n\t\tthis._parts.query = parts.query;\n\t\tthis._parts.fragment = parts.fragment;\n\t\tthis.build(!build);\n\t\treturn this;\n\t};\n\n\t// fraction accessors\n\tp.subdomain = function(v, build) {\n\t\tif (this._parts.urn) {\n\t\t\treturn v === undefined ? '' : this;\n\t\t}\n\n\t\t// convenience, return \"www\" from \"www.example.org\"\n\t\tif (v === undefined) {\n\t\t\tif (!this._parts.hostname || this.is('IP')) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\t// grab domain and add another segment\n\t\t\tvar end = this._parts.hostname.length - this.domain().length - 1;\n\t\t\treturn this._parts.hostname.substring(0, end) || '';\n\t\t} else {\n\t\t\tvar e = this._parts.hostname.length - this.domain().length;\n\t\t\tvar sub = this._parts.hostname.substring(0, e);\n\t\t\tvar replace = new RegExp('^' + escapeRegEx(sub));\n\n\t\t\tif (v && v.charAt(v.length - 1) !== '.') {\n\t\t\t\tv += '.';\n\t\t\t}\n\n\t\t\tif (v) {\n\t\t\t\tURI.ensureValidHostname(v);\n\t\t\t}\n\n\t\t\tthis._parts.hostname = this._parts.hostname.replace(replace, v);\n\t\t\tthis.build(!build);\n\t\t\treturn this;\n\t\t}\n\t};\n\tp.domain = function(v, build) {\n\t\tif (this._parts.urn) {\n\t\t\treturn v === undefined ? '' : this;\n\t\t}\n\n\t\tif (typeof v === 'boolean') {\n\t\t\tbuild = v;\n\t\t\tv = undefined;\n\t\t}\n\n\t\t// convenience, return \"example.org\" from \"www.example.org\"\n\t\tif (v === undefined) {\n\t\t\tif (!this._parts.hostname || this.is('IP')) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\t// if hostname consists of 1 or 2 segments, it must be the domain\n\t\t\tvar t = this._parts.hostname.match(/\\./g);\n\t\t\tif (t && t.length < 2) {\n\t\t\t\treturn this._parts.hostname;\n\t\t\t}\n\n\t\t\t// grab tld and add another segment\n\t\t\tvar end = this._parts.hostname.length - this.tld(build).length - 1;\n\t\t\tend = this._parts.hostname.lastIndexOf('.', end -1) + 1;\n\t\t\treturn this._parts.hostname.substring(end) || '';\n\t\t} else {\n\t\t\tif (!v) {\n\t\t\t\tthrow new TypeError('cannot set domain empty');\n\t\t\t}\n\n\t\t\tURI.ensureValidHostname(v);\n\n\t\t\tif (!this._parts.hostname || this.is('IP')) {\n\t\t\t\tthis._parts.hostname = v;\n\t\t\t} else {\n\t\t\t\tvar replace = new RegExp(escapeRegEx(this.domain()) + '$');\n\t\t\t\tthis._parts.hostname = this._parts.hostname.replace(replace, v);\n\t\t\t}\n\n\t\t\tthis.build(!build);\n\t\t\treturn this;\n\t\t}\n\t};\n\tp.tld = function(v, build) {\n\t\tif (this._parts.urn) {\n\t\t\treturn v === undefined ? '' : this;\n\t\t}\n\n\t\tif (typeof v === 'boolean') {\n\t\t\tbuild = v;\n\t\t\tv = undefined;\n\t\t}\n\n\t\t// return \"org\" from \"www.example.org\"\n\t\tif (v === undefined) {\n\t\t\tif (!this._parts.hostname || this.is('IP')) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tvar pos = this._parts.hostname.lastIndexOf('.');\n\t\t\tvar tld = this._parts.hostname.substring(pos + 1);\n\n\t\t\tif (build !== true && SLD && SLD.list[tld.toLowerCase()]) {\n\t\t\t\treturn SLD.get(this._parts.hostname) || tld;\n\t\t\t}\n\n\t\t\treturn tld;\n\t\t} else {\n\t\t\tvar replace;\n\n\t\t\tif (!v) {\n\t\t\t\tthrow new TypeError('cannot set TLD empty');\n\t\t\t} else if (v.match(/[^a-zA-Z0-9-]/)) {\n\t\t\t\tif (SLD && SLD.is(v)) {\n\t\t\t\t\treplace = new RegExp(escapeRegEx(this.tld()) + '$');\n\t\t\t\t\tthis._parts.hostname = this._parts.hostname.replace(replace, v);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new TypeError('TLD \"' + v + '\" contains characters other than [A-Z0-9]');\n\t\t\t\t}\n\t\t\t} else if (!this._parts.hostname || this.is('IP')) {\n\t\t\t\tthrow new ReferenceError('cannot set TLD on non-domain host');\n\t\t\t} else {\n\t\t\t\treplace = new RegExp(escapeRegEx(this.tld()) + '$');\n\t\t\t\tthis._parts.hostname = this._parts.hostname.replace(replace, v);\n\t\t\t}\n\n\t\t\tthis.build(!build);\n\t\t\treturn this;\n\t\t}\n\t};\n\tp.directory = function(v, build) {\n\t\tif (this._parts.urn) {\n\t\t\treturn v === undefined ? '' : this;\n\t\t}\n\n\t\tif (v === undefined || v === true) {\n\t\t\tif (!this._parts.path && !this._parts.hostname) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif (this._parts.path === '/') {\n\t\t\t\treturn '/';\n\t\t\t}\n\n\t\t\tvar end = this._parts.path.length - this.filename().length - 1;\n\t\t\tvar res = this._parts.path.substring(0, end) || (this._parts.hostname ? '/' : '');\n\n\t\t\treturn v ? URI.decodePath(res) : res;\n\n\t\t} else {\n\t\t\tvar e = this._parts.path.length - this.filename().length;\n\t\t\tvar directory = this._parts.path.substring(0, e);\n\t\t\tvar replace = new RegExp('^' + escapeRegEx(directory));\n\n\t\t\t// fully qualifier directories begin with a slash\n\t\t\tif (!this.is('relative')) {\n\t\t\t\tif (!v) {\n\t\t\t\t\tv = '/';\n\t\t\t\t}\n\n\t\t\t\tif (v.charAt(0) !== '/') {\n\t\t\t\t\tv = '/' + v;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// directories always end with a slash\n\t\t\tif (v && v.charAt(v.length - 1) !== '/') {\n\t\t\t\tv += '/';\n\t\t\t}\n\n\t\t\tv = URI.recodePath(v);\n\t\t\tthis._parts.path = this._parts.path.replace(replace, v);\n\t\t\tthis.build(!build);\n\t\t\treturn this;\n\t\t}\n\t};\n\tp.filename = function(v, build) {\n\t\tif (this._parts.urn) {\n\t\t\treturn v === undefined ? '' : this;\n\t\t}\n\n\t\tif (v === undefined || v === true) {\n\t\t\tif (!this._parts.path || this._parts.path === '/') {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tvar pos = this._parts.path.lastIndexOf('/');\n\t\t\tvar res = this._parts.path.substring(pos+1);\n\n\t\t\treturn v ? URI.decodePathSegment(res) : res;\n\t\t} else {\n\t\t\tvar mutatedDirectory = false;\n\n\t\t\tif (v.charAt(0) === '/') {\n\t\t\t\tv = v.substring(1);\n\t\t\t}\n\n\t\t\tif (v.match(/\\.?\\//)) {\n\t\t\t\tmutatedDirectory = true;\n\t\t\t}\n\n\t\t\tvar replace = new RegExp(escapeRegEx(this.filename()) + '$');\n\t\t\tv = URI.recodePath(v);\n\t\t\tthis._parts.path = this._parts.path.replace(replace, v);\n\n\t\t\tif (mutatedDirectory) {\n\t\t\t\tthis.normalizePath(build);\n\t\t\t} else {\n\t\t\t\tthis.build(!build);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\t};\n\tp.suffix = function(v, build) {\n\t\tif (this._parts.urn) {\n\t\t\treturn v === undefined ? '' : this;\n\t\t}\n\n\t\tif (v === undefined || v === true) {\n\t\t\tif (!this._parts.path || this._parts.path === '/') {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tvar filename = this.filename();\n\t\t\tvar pos = filename.lastIndexOf('.');\n\t\t\tvar s, res;\n\n\t\t\tif (pos === -1) {\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\t// suffix may only contain alnum characters (yup, I made this up.)\n\t\t\ts = filename.substring(pos+1);\n\t\t\tres = (/^[a-z0-9%]+$/i).test(s) ? s : '';\n\t\t\treturn v ? URI.decodePathSegment(res) : res;\n\t\t} else {\n\t\t\tif (v.charAt(0) === '.') {\n\t\t\t\tv = v.substring(1);\n\t\t\t}\n\n\t\t\tvar suffix = this.suffix();\n\t\t\tvar replace;\n\n\t\t\tif (!suffix) {\n\t\t\t\tif (!v) {\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\n\t\t\t\tthis._parts.path += '.' + URI.recodePath(v);\n\t\t\t} else if (!v) {\n\t\t\t\treplace = new RegExp(escapeRegEx('.' + suffix) + '$');\n\t\t\t} else {\n\t\t\t\treplace = new RegExp(escapeRegEx(suffix) + '$');\n\t\t\t}\n\n\t\t\tif (replace) {\n\t\t\t\tv = URI.recodePath(v);\n\t\t\t\tthis._parts.path = this._parts.path.replace(replace, v);\n\t\t\t}\n\n\t\t\tthis.build(!build);\n\t\t\treturn this;\n\t\t}\n\t};\n\tp.segment = function(segment, v, build) {\n\t\tvar separator = this._parts.urn ? ':' : '/';\n\t\tvar path = this.path();\n\t\tvar absolute = path.substring(0, 1) === '/';\n\t\tvar segments = path.split(separator);\n\n\t\tif (segment !== undefined && typeof segment !== 'number') {\n\t\t\tbuild = v;\n\t\t\tv = segment;\n\t\t\tsegment = undefined;\n\t\t}\n\n\t\tif (segment !== undefined && typeof segment !== 'number') {\n\t\t\tthrow new Error('Bad segment \"' + segment + '\", must be 0-based integer');\n\t\t}\n\n\t\tif (absolute) {\n\t\t\tsegments.shift();\n\t\t}\n\n\t\tif (segment < 0) {\n\t\t\t// allow negative indexes to address from the end\n\t\t\tsegment = Math.max(segments.length + segment, 0);\n\t\t}\n\n\t\tif (v === undefined) {\n\t\t\t/*jshint laxbreak: true */\n\t\t\treturn segment === undefined\n\t\t\t\t? segments\n\t\t\t\t: segments[segment];\n\t\t\t/*jshint laxbreak: false */\n\t\t} else if (segment === null || segments[segment] === undefined) {\n\t\t\tif (isArray(v)) {\n\t\t\t\tsegments = [];\n\t\t\t\t// collapse empty elements within array\n\t\t\t\tfor (var i=0, l=v.length; i < l; i++) {\n\t\t\t\t\tif (!v[i].length && (!segments.length || !segments[segments.length -1].length)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (segments.length && !segments[segments.length -1].length) {\n\t\t\t\t\t\tsegments.pop();\n\t\t\t\t\t}\n\n\t\t\t\t\tsegments.push(trimSlashes(v[i]));\n\t\t\t\t}\n\t\t\t} else if (v || typeof v === 'string') {\n\t\t\t\tv = trimSlashes(v);\n\t\t\t\tif (segments[segments.length -1] === '') {\n\t\t\t\t\t// empty trailing elements have to be overwritten\n\t\t\t\t\t// to prevent results such as /foo//bar\n\t\t\t\t\tsegments[segments.length -1] = v;\n\t\t\t\t} else {\n\t\t\t\t\tsegments.push(v);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (v) {\n\t\t\t\tsegments[segment] = trimSlashes(v);\n\t\t\t} else {\n\t\t\t\tsegments.splice(segment, 1);\n\t\t\t}\n\t\t}\n\n\t\tif (absolute) {\n\t\t\tsegments.unshift('');\n\t\t}\n\n\t\treturn this.path(segments.join(separator), build);\n\t};\n\tp.segmentCoded = function(segment, v, build) {\n\t\tvar segments, i, l;\n\n\t\tif (typeof segment !== 'number') {\n\t\t\tbuild = v;\n\t\t\tv = segment;\n\t\t\tsegment = undefined;\n\t\t}\n\n\t\tif (v === undefined) {\n\t\t\tsegments = this.segment(segment, v, build);\n\t\t\tif (!isArray(segments)) {\n\t\t\t\tsegments = segments !== undefined ? URI.decode(segments) : undefined;\n\t\t\t} else {\n\t\t\t\tfor (i = 0, l = segments.length; i < l; i++) {\n\t\t\t\t\tsegments[i] = URI.decode(segments[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn segments;\n\t\t}\n\n\t\tif (!isArray(v)) {\n\t\t\tv = (typeof v === 'string' || v instanceof String) ? URI.encode(v) : v;\n\t\t} else {\n\t\t\tfor (i = 0, l = v.length; i < l; i++) {\n\t\t\t\tv[i] = URI.encode(v[i]);\n\t\t\t}\n\t\t}\n\n\t\treturn this.segment(segment, v, build);\n\t};\n\n\t// mutating query string\n\tvar q = p.query;\n\tp.query = function(v, build) {\n\t\tif (v === true) {\n\t\t\treturn URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n\t\t} else if (typeof v === 'function') {\n\t\t\tvar data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n\t\t\tvar result = v.call(this, data);\n\t\t\tthis._parts.query = URI.buildQuery(result || data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n\t\t\tthis.build(!build);\n\t\t\treturn this;\n\t\t} else if (v !== undefined && typeof v !== 'string') {\n\t\t\tthis._parts.query = URI.buildQuery(v, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n\t\t\tthis.build(!build);\n\t\t\treturn this;\n\t\t} else {\n\t\t\treturn q.call(this, v, build);\n\t\t}\n\t};\n\tp.setQuery = function(name, value, build) {\n\t\tvar data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n\n\t\tif (typeof name === 'string' || name instanceof String) {\n\t\t\tdata[name] = value !== undefined ? value : null;\n\t\t} else if (typeof name === 'object') {\n\t\t\tfor (var key in name) {\n\t\t\t\tif (hasOwn.call(name, key)) {\n\t\t\t\t\tdata[key] = name[key];\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthrow new TypeError('URI.addQuery() accepts an object, string as the name parameter');\n\t\t}\n\n\t\tthis._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n\t\tif (typeof name !== 'string') {\n\t\t\tbuild = value;\n\t\t}\n\n\t\tthis.build(!build);\n\t\treturn this;\n\t};\n\tp.addQuery = function(name, value, build) {\n\t\tvar data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n\t\tURI.addQuery(data, name, value === undefined ? null : value);\n\t\tthis._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n\t\tif (typeof name !== 'string') {\n\t\t\tbuild = value;\n\t\t}\n\n\t\tthis.build(!build);\n\t\treturn this;\n\t};\n\tp.removeQuery = function(name, value, build) {\n\t\tvar data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n\t\tURI.removeQuery(data, name, value);\n\t\tthis._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n\t\tif (typeof name !== 'string') {\n\t\t\tbuild = value;\n\t\t}\n\n\t\tthis.build(!build);\n\t\treturn this;\n\t};\n\tp.hasQuery = function(name, value, withinArray) {\n\t\tvar data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n\t\treturn URI.hasQuery(data, name, value, withinArray);\n\t};\n\tp.setSearch = p.setQuery;\n\tp.addSearch = p.addQuery;\n\tp.removeSearch = p.removeQuery;\n\tp.hasSearch = p.hasQuery;\n\n\t// sanitizing URLs\n\tp.normalize = function() {\n\t\tif (this._parts.urn) {\n\t\t\treturn this\n\t\t\t\t.normalizeProtocol(false)\n\t\t\t\t.normalizePath(false)\n\t\t\t\t.normalizeQuery(false)\n\t\t\t\t.normalizeFragment(false)\n\t\t\t\t.build();\n\t\t}\n\n\t\treturn this\n\t\t\t.normalizeProtocol(false)\n\t\t\t.normalizeHostname(false)\n\t\t\t.normalizePort(false)\n\t\t\t.normalizePath(false)\n\t\t\t.normalizeQuery(false)\n\t\t\t.normalizeFragment(false)\n\t\t\t.build();\n\t};\n\tp.normalizeProtocol = function(build) {\n\t\tif (typeof this._parts.protocol === 'string') {\n\t\t\tthis._parts.protocol = this._parts.protocol.toLowerCase();\n\t\t\tthis.build(!build);\n\t\t}\n\n\t\treturn this;\n\t};\n\tp.normalizeHostname = function(build) {\n\t\tif (this._parts.hostname) {\n\t\t\tif (this.is('IDN') && punycode) {\n\t\t\t\tthis._parts.hostname = punycode.toASCII(this._parts.hostname);\n\t\t\t} else if (this.is('IPv6') && IPv6) {\n\t\t\t\tthis._parts.hostname = IPv6.best(this._parts.hostname);\n\t\t\t}\n\n\t\t\tthis._parts.hostname = this._parts.hostname.toLowerCase();\n\t\t\tthis.build(!build);\n\t\t}\n\n\t\treturn this;\n\t};\n\tp.normalizePort = function(build) {\n\t\t// remove port of it's the protocol's default\n\t\tif (typeof this._parts.protocol === 'string' && this._parts.port === URI.defaultPorts[this._parts.protocol]) {\n\t\t\tthis._parts.port = null;\n\t\t\tthis.build(!build);\n\t\t}\n\n\t\treturn this;\n\t};\n\tp.normalizePath = function(build) {\n\t\tvar _path = this._parts.path;\n\t\tif (!_path) {\n\t\t\treturn this;\n\t\t}\n\n\t\tif (this._parts.urn) {\n\t\t\tthis._parts.path = URI.recodeUrnPath(this._parts.path);\n\t\t\tthis.build(!build);\n\t\t\treturn this;\n\t\t}\n\n\t\tif (this._parts.path === '/') {\n\t\t\treturn this;\n\t\t}\n\n\t\tvar _was_relative;\n\t\tvar _leadingParents = '';\n\t\tvar _parent, _pos;\n\n\t\t// handle relative paths\n\t\tif (_path.charAt(0) !== '/') {\n\t\t\t_was_relative = true;\n\t\t\t_path = '/' + _path;\n\t\t}\n\n\t\t// handle relative files (as opposed to directories)\n\t\tif (_path.slice(-3) === '/..' || _path.slice(-2) === '/.') {\n\t\t\t_path += '/';\n\t\t}\n\n\t\t// resolve simples\n\t\t_path = _path\n\t\t\t.replace(/(\\/(\\.\\/)+)|(\\/\\.$)/g, '/')\n\t\t\t.replace(/\\/{2,}/g, '/');\n\n\t\t// remember leading parents\n\t\tif (_was_relative) {\n\t\t\t_leadingParents = _path.substring(1).match(/^(\\.\\.\\/)+/) || '';\n\t\t\tif (_leadingParents) {\n\t\t\t\t_leadingParents = _leadingParents[0];\n\t\t\t}\n\t\t}\n\n\t\t// resolve parents\n\t\twhile (true) {\n\t\t\t_parent = _path.indexOf('/..');\n\t\t\tif (_parent === -1) {\n\t\t\t\t// no more ../ to resolve\n\t\t\t\tbreak;\n\t\t\t} else if (_parent === 0) {\n\t\t\t\t// top level cannot be relative, skip it\n\t\t\t\t_path = _path.substring(3);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t_pos = _path.substring(0, _parent).lastIndexOf('/');\n\t\t\tif (_pos === -1) {\n\t\t\t\t_pos = _parent;\n\t\t\t}\n\t\t\t_path = _path.substring(0, _pos) + _path.substring(_parent + 3);\n\t\t}\n\n\t\t// revert to relative\n\t\tif (_was_relative && this.is('relative')) {\n\t\t\t_path = _leadingParents + _path.substring(1);\n\t\t}\n\n\t\t_path = URI.recodePath(_path);\n\t\tthis._parts.path = _path;\n\t\tthis.build(!build);\n\t\treturn this;\n\t};\n\tp.normalizePathname = p.normalizePath;\n\tp.normalizeQuery = function(build) {\n\t\tif (typeof this._parts.query === 'string') {\n\t\t\tif (!this._parts.query.length) {\n\t\t\t\tthis._parts.query = null;\n\t\t\t} else {\n\t\t\t\tthis.query(URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace));\n\t\t\t}\n\n\t\t\tthis.build(!build);\n\t\t}\n\n\t\treturn this;\n\t};\n\tp.normalizeFragment = function(build) {\n\t\tif (!this._parts.fragment) {\n\t\t\tthis._parts.fragment = null;\n\t\t\tthis.build(!build);\n\t\t}\n\n\t\treturn this;\n\t};\n\tp.normalizeSearch = p.normalizeQuery;\n\tp.normalizeHash = p.normalizeFragment;\n\n\tp.iso8859 = function() {\n\t\t// expect unicode input, iso8859 output\n\t\tvar e = URI.encode;\n\t\tvar d = URI.decode;\n\n\t\tURI.encode = escape;\n\t\tURI.decode = decodeURIComponent;\n\t\ttry {\n\t\t\tthis.normalize();\n\t\t} finally {\n\t\t\tURI.encode = e;\n\t\t\tURI.decode = d;\n\t\t}\n\t\treturn this;\n\t};\n\n\tp.unicode = function() {\n\t\t// expect iso8859 input, unicode output\n\t\tvar e = URI.encode;\n\t\tvar d = URI.decode;\n\n\t\tURI.encode = strictEncodeURIComponent;\n\t\tURI.decode = unescape;\n\t\ttry {\n\t\t\tthis.normalize();\n\t\t} finally {\n\t\t\tURI.encode = e;\n\t\t\tURI.decode = d;\n\t\t}\n\t\treturn this;\n\t};\n\n\tp.readable = function() {\n\t\tvar uri = this.clone();\n\t\t// removing username, password, because they shouldn't be displayed according to RFC 3986\n\t\turi.username('').password('').normalize();\n\t\tvar t = '';\n\t\tif (uri._parts.protocol) {\n\t\t\tt += uri._parts.protocol + '://';\n\t\t}\n\n\t\tif (uri._parts.hostname) {\n\t\t\tif (uri.is('punycode') && punycode) {\n\t\t\t\tt += punycode.toUnicode(uri._parts.hostname);\n\t\t\t\tif (uri._parts.port) {\n\t\t\t\t\tt += ':' + uri._parts.port;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tt += uri.host();\n\t\t\t}\n\t\t}\n\n\t\tif (uri._parts.hostname && uri._parts.path && uri._parts.path.charAt(0) !== '/') {\n\t\t\tt += '/';\n\t\t}\n\n\t\tt += uri.path(true);\n\t\tif (uri._parts.query) {\n\t\t\tvar q = '';\n\t\t\tfor (var i = 0, qp = uri._parts.query.split('&'), l = qp.length; i < l; i++) {\n\t\t\t\tvar kv = (qp[i] || '').split('=');\n\t\t\t\tq += '&' + URI.decodeQuery(kv[0], this._parts.escapeQuerySpace)\n\t\t\t\t\t.replace(/&/g, '%26');\n\n\t\t\t\tif (kv[1] !== undefined) {\n\t\t\t\t\tq += '=' + URI.decodeQuery(kv[1], this._parts.escapeQuerySpace)\n\t\t\t\t\t\t.replace(/&/g, '%26');\n\t\t\t\t}\n\t\t\t}\n\t\t\tt += '?' + q.substring(1);\n\t\t}\n\n\t\tt += URI.decodeQuery(uri.hash(), true);\n\t\treturn t;\n\t};\n\n\t// resolving relative and absolute URLs\n\tp.absoluteTo = function(base) {\n\t\tvar resolved = this.clone();\n\t\tvar properties = ['protocol', 'username', 'password', 'hostname', 'port'];\n\t\tvar basedir, i, p;\n\n\t\tif (this._parts.urn) {\n\t\t\tthrow new Error('URNs do not have any generally defined hierarchical components');\n\t\t}\n\n\t\tif (!(base instanceof URI)) {\n\t\t\tbase = new URI(base);\n\t\t}\n\n\t\tif (!resolved._parts.protocol) {\n\t\t\tresolved._parts.protocol = base._parts.protocol;\n\t\t}\n\n\t\tif (this._parts.hostname) {\n\t\t\treturn resolved;\n\t\t}\n\n\t\tfor (i = 0; (p = properties[i]); i++) {\n\t\t\tresolved._parts[p] = base._parts[p];\n\t\t}\n\n\t\tif (!resolved._parts.path) {\n\t\t\tresolved._parts.path = base._parts.path;\n\t\t\tif (!resolved._parts.query) {\n\t\t\t\tresolved._parts.query = base._parts.query;\n\t\t\t}\n\t\t} else if (resolved._parts.path.substring(-2) === '..') {\n\t\t\tresolved._parts.path += '/';\n\t\t}\n\n\t\tif (resolved.path().charAt(0) !== '/') {\n\t\t\tbasedir = base.directory();\n\t\t\tbasedir = basedir ? basedir : base.path().indexOf('/') === 0 ? '/' : '';\n\t\t\tresolved._parts.path = (basedir ? (basedir + '/') : '') + resolved._parts.path;\n\t\t\tresolved.normalizePath();\n\t\t}\n\n\t\tresolved.build();\n\t\treturn resolved;\n\t};\n\tp.relativeTo = function(base) {\n\t\tvar relative = this.clone().normalize();\n\t\tvar relativeParts, baseParts, common, relativePath, basePath;\n\n\t\tif (relative._parts.urn) {\n\t\t\tthrow new Error('URNs do not have any generally defined hierarchical components');\n\t\t}\n\n\t\tbase = new URI(base).normalize();\n\t\trelativeParts = relative._parts;\n\t\tbaseParts = base._parts;\n\t\trelativePath = relative.path();\n\t\tbasePath = base.path();\n\n\t\tif (relativePath.charAt(0) !== '/') {\n\t\t\tthrow new Error('URI is already relative');\n\t\t}\n\n\t\tif (basePath.charAt(0) !== '/') {\n\t\t\tthrow new Error('Cannot calculate a URI relative to another relative URI');\n\t\t}\n\n\t\tif (relativeParts.protocol === baseParts.protocol) {\n\t\t\trelativeParts.protocol = null;\n\t\t}\n\n\t\tif (relativeParts.username !== baseParts.username || relativeParts.password !== baseParts.password) {\n\t\t\treturn relative.build();\n\t\t}\n\n\t\tif (relativeParts.protocol !== null || relativeParts.username !== null || relativeParts.password !== null) {\n\t\t\treturn relative.build();\n\t\t}\n\n\t\tif (relativeParts.hostname === baseParts.hostname && relativeParts.port === baseParts.port) {\n\t\t\trelativeParts.hostname = null;\n\t\t\trelativeParts.port = null;\n\t\t} else {\n\t\t\treturn relative.build();\n\t\t}\n\n\t\tif (relativePath === basePath) {\n\t\t\trelativeParts.path = '';\n\t\t\treturn relative.build();\n\t\t}\n\n\t\t// determine common sub path\n\t\tcommon = URI.commonPath(relativePath, basePath);\n\n\t\t// If the paths have nothing in common, return a relative URL with the absolute path.\n\t\tif (!common) {\n\t\t\treturn relative.build();\n\t\t}\n\n\t\tvar parents = baseParts.path\n\t\t\t.substring(common.length)\n\t\t\t.replace(/[^\\/]*$/, '')\n\t\t\t.replace(/.*?\\//g, '../');\n\n\t\trelativeParts.path = (parents + relativeParts.path.substring(common.length)) || './';\n\n\t\treturn relative.build();\n\t};\n\n\t// comparing URIs\n\tp.equals = function(uri) {\n\t\tvar one = this.clone();\n\t\tvar two = new URI(uri);\n\t\tvar one_map = {};\n\t\tvar two_map = {};\n\t\tvar checked = {};\n\t\tvar one_query, two_query, key;\n\n\t\tone.normalize();\n\t\ttwo.normalize();\n\n\t\t// exact match\n\t\tif (one.toString() === two.toString()) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// extract query string\n\t\tone_query = one.query();\n\t\ttwo_query = two.query();\n\t\tone.query('');\n\t\ttwo.query('');\n\n\t\t// definitely not equal if not even non-query parts match\n\t\tif (one.toString() !== two.toString()) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// query parameters have the same length, even if they're permuted\n\t\tif (one_query.length !== two_query.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\tone_map = URI.parseQuery(one_query, this._parts.escapeQuerySpace);\n\t\ttwo_map = URI.parseQuery(two_query, this._parts.escapeQuerySpace);\n\n\t\tfor (key in one_map) {\n\t\t\tif (hasOwn.call(one_map, key)) {\n\t\t\t\tif (!isArray(one_map[key])) {\n\t\t\t\t\tif (one_map[key] !== two_map[key]) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else if (!arraysEqual(one_map[key], two_map[key])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tchecked[key] = true;\n\t\t\t}\n\t\t}\n\n\t\tfor (key in two_map) {\n\t\t\tif (hasOwn.call(two_map, key)) {\n\t\t\t\tif (!checked[key]) {\n\t\t\t\t\t// two contains a parameter not present in one\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t};\n\n\t// state\n\tp.duplicateQueryParameters = function(v) {\n\t\tthis._parts.duplicateQueryParameters = !!v;\n\t\treturn this;\n\t};\n\n\tp.escapeQuerySpace = function(v) {\n\t\tthis._parts.escapeQuerySpace = !!v;\n\t\treturn this;\n\t};\n\n\treturn URI;\n}));","Workflow = {}\n\n@ImageSign = {};\n\n@TracesHandler = {};\n\n@TracesTemplate = {};\n\n@InstanceformTemplate = {};\n\n@InstanceAttachmentTemplate = {};\n\n@InstanceSignText = {}\n\n@RelatedInstances = {}\n\n@RelatedRecords = {}\n\n@InstanceMacro = {context: {}}\n\n@TracesManager = {};\n\nInstanceSignText.isOpinionField_from_string = (field_formula)->\n\treturn (field_formula?.indexOf(\"{traces.\") > -1 || field_formula?.indexOf(\"{signature.traces.\") > -1 || field_formula?.indexOf(\"{yijianlan:\") > -1 || field_formula?.indexOf(\"{\\\"yijianlan\\\":\") > -1 || field_formula?.indexOf(\"{'yijianlan':\") > -1)\n\nInstanceSignText.includesOpinionField = (form, form_version)->\n\tfield_formulas = new Array();\n\n\t_form_version = {}\n\n\tif Meteor.isServer\n\t\t_form_version = uuflowManager.getFormVersion(db.forms.findOne({_id: form}), form_version)\n\telse\n\t\t_form_version = db.form_versions.findOne({_id: form_version, form: form})\n\n\tfields = _form_version?.fields || []\n\n\tfields.forEach (f)->\n\t\tif f.type == 'table'\n\t\t\tconsole.log 'ignore opinion field in table'\n\t\telse if f.type == 'section'\n\t\t\tf?.fields?.forEach (f1)->\n\t\t\t\tfield_formulas.push f1.formula\n\t\telse\n\t\t\tfield_formulas.push f.formula\n\n\t_.some field_formulas, (field_formula)->\n\t\treturn InstanceformTemplate.helpers.isOpinionField_from_string(field_formula)\n\n","             \n\nWorkflow = {};\n\nthis.ImageSign = {};\n\nthis.TracesHandler = {};\n\nthis.TracesTemplate = {};\n\nthis.InstanceformTemplate = {};\n\nthis.InstanceAttachmentTemplate = {};\n\nthis.InstanceSignText = {};\n\nthis.RelatedInstances = {};\n\nthis.RelatedRecords = {};\n\nthis.InstanceMacro = {\n  context: {}\n};\n\nthis.TracesManager = {};\n\nInstanceSignText.isOpinionField_from_string = function(field_formula) {\n  return (field_formula != null ? field_formula.indexOf(\"{traces.\") : void 0) > -1 || (field_formula != null ? field_formula.indexOf(\"{signature.traces.\") : void 0) > -1 || (field_formula != null ? field_formula.indexOf(\"{yijianlan:\") : void 0) > -1 || (field_formula != null ? field_formula.indexOf(\"{\\\"yijianlan\\\":\") : void 0) > -1 || (field_formula != null ? field_formula.indexOf(\"{'yijianlan':\") : void 0) > -1;\n};\n\nInstanceSignText.includesOpinionField = function(form, form_version) {\n  var _form_version, field_formulas, fields;\n  field_formulas = new Array();\n  _form_version = {};\n  if (Meteor.isServer) {\n    _form_version = uuflowManager.getFormVersion(db.forms.findOne({\n      _id: form\n    }), form_version);\n  } else {\n    _form_version = db.form_versions.findOne({\n      _id: form_version,\n      form: form\n    });\n  }\n  fields = (_form_version != null ? _form_version.fields : void 0) || [];\n  fields.forEach(function(f) {\n    var ref;\n    if (f.type === 'table') {\n      return console.log('ignore opinion field in table');\n    } else if (f.type === 'section') {\n      return f != null ? (ref = f.fields) != null ? ref.forEach(function(f1) {\n        return field_formulas.push(f1.formula);\n      }) : void 0 : void 0;\n    } else {\n      return field_formulas.push(f.formula);\n    }\n  });\n  return _.some(field_formulas, function(field_formula) {\n    return InstanceformTemplate.helpers.isOpinionField_from_string(field_formula);\n  });\n};\n","db.instance_tasks = new Meteor.Collection('instance_tasks')\n\ndb.instance_tasks._simpleSchema = new SimpleSchema\n    instance:\n        type: String\n    trace:\n        type: String\n    is_finished:\n        type: String\n    user:\n        type: String\n    user_name:\n        type: String\n    handler:\n        type: String\n    handler_name:\n        type: String\n    handler_organization:\n        type: String\n    handler_organization_name:\n        type: String\n    handler_organization_fullname:\n        type: String\n    start_date:\n        type: Date\n    due_date:\n        type: Date\n    is_read:\n        type: Boolean\n    is_error:\n        type: Boolean\n    values:\n        type: Object\n    deadline:\n        type: Date\n    remind_date:\n        type: Date\n    reminded_count:\n        type: Number\n    read_date:\n        type: Date\n    description:\n        type: String\n    modified:\n        type: Date\n    modified_by:\n        type: String\n    sign_show:\n        type: Boolean\n    judge:\n        type: String\n    next_steps:\n        type: Array\n    \"next_steps.$\":\n        type: Object\n    \"next_steps.$.step\":\n        type: String\n    \"next_steps.$.users\":\n        type: [String]\n    finish_date:\n        type: Date\n    cost_time:\n        type: Number\n    space:\n        type: String\n    instance_name:\n        type: String\n    submitter:\n        type: String\n    submitter_name:\n        type: String\n    applicant:\n        type: String\n    applicant_name:\n        type: String\n    applicant_organization_name:\n        type: String\n    submit_date:\n        type: Date\n    flow:\n        type: String\n    flow_name:\n        type: String\n    form:\n        type: String\n    step:\n        type: String\n    step_name:\n        type: String\n    category_name:\n        type: String\n    instance_state:\n        type: String\n    distribute_from_instance:\n        type: String\n    forward_from_instance:\n        type: String\n    keywords:\n        type: String\n    is_archived:\n        type: Boolean\n    category:\n        type: String\n","db.auth_tokens = new Meteor.Collection('auth_tokens')","marked = require(\"marked\")\n\nInstanceReadOnlyTemplate = {};\n\n\nInstanceReadOnlyTemplate.instance_attachment = \"\"\"\n\t<tr>\n\t\t<td class=\"ins-attach-view\">\n\t\t\t<a href=\"{{ins_attach_download_url _id absolute}}\" class=\"ins_attach_href\" target=\"_parent\" data-name=\"{{this.name}}\" data-type=\"{{this.original.type}}\" data-id=\"{{_id}}\">{{this.name}}</a>\n\t\t</td>\n\t</tr>\n\"\"\"\n\nInstanceReadOnlyTemplate.afSelectUserRead = \"\"\"\n\t<div class='selectUser form-control ins_applicant'>{{value}}</div>\n\"\"\"\n\n\nInstanceReadOnlyTemplate.afFormGroupRead = \"\"\"\n\t<div class='form-group'>\n\t\t{{#with getField this.name}}\n\t\t\t{{#if equals type 'section'}}\n\t\t\t\t\t<div class='section callout callout-default'>\n\t\t\t\t\t\t<label class=\"control-label\">{{f_label this}}</label>\n\t\t\t\t\t\t<p>{{{description}}}</p>\n\t\t\t\t\t</div>\n\t\t\t{{else}}\n\t\t\t\t{{#if equals type 'table'}}\n\t\t\t\t\t<div class=\"panel panel-default steedos-table\">\n\t\t\t\t\t\t<div class=\"panel-body\" style=\"padding:0px;\">\n\t\t\t\t\t\t\t<div class=\"panel-heading\" >\n\t\t\t\t\t\t\t\t<label class='control-label'>{{getLabel code}}</label>\n\t\t\t\t\t\t\t\t<span class=\"description\">{{{description}}}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"readonly-table\" style=\"padding:0px;overflow-x:auto;\">\n\t\t\t\t\t\t\t\t\t<table type='table' class=\"table table-bordered table-condensed autoform-table\" style='margin-bottom:0px;' {{this.atts}} id=\"{{this.code}}Table\" name=\"{{this.code}}\" data-schema-key=\"{{this.name}}\">\n\t\t\t\t\t\t\t\t\t\t<thead id=\"{{this.name}}Thead\" name=\"{{this.name}}Thead\">\n\t\t\t\t\t\t\t\t\t\t\t{{{getTableThead this}}}\n\t\t\t\t\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t\t\t\t\t<tbody id=\"{{this.name}}Tbody\" name=\"{{this.name}}Tbody\">\n\t\t\t\t\t\t\t\t\t\t\t{{{getTableBody this}}}\n\t\t\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{{else}}\n\t\t\t\t\t{{#if showLabel}}\n\t\t\t\t\t\t<label>{{getLabel code}}</label>\n\t\t\t\t\t{{/if}}\n\t\t\t\t\t<div class='{{getCfClass this}} form-control' readonly disabled>{{{getValue code}}}</div>\n\t\t\t\t{{/if}}\n\t\t\t{{/if}}\n\t\t{{/with}}\n\t</div>\n\"\"\"\n\nInstanceReadOnlyTemplate.afFormGroup = \"\"\"\n\n\t{{#with getField this.name}}\n\t\t\t{{#if equals type 'section'}}\n\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t<div class='section callout callout-default'>\n\t\t\t\t\t\t<label class=\"control-label\">{{f_label this}}</label>\n\t\t\t\t\t\t<p>{{{description}}}</p>\n\t\t\t\t\t</div>\n  \t\t\t\t</div>\n\t\t\t{{else}}\n\t\t\t\t{{#if equals type 'table'}}\n\t\t\t\t\t<div class=\"panel panel-default steedos-table\">\n\t\t\t\t\t\t<div class=\"panel-body\" style=\"padding:0px;\">\n\t\t\t\t\t\t\t<div class=\"panel-heading\" >\n\t\t\t\t\t\t\t\t<label class='control-label'>{{getLabel code}}</label>\n\t\t\t\t\t\t\t\t<span class=\"description\">{{{description}}}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"readonly-table\" style=\"padding:0px;overflow-x:auto;\">\n\t\t\t\t\t\t\t\t\t<table type='table' class=\"table table-bordered table-condensed autoform-table\" style='margin-bottom:0px;' {{this.atts}} id=\"{{this.code}}Table\" name=\"{{this.code}}\" data-schema-key=\"{{this.name}}\">\n\t\t\t\t\t\t\t\t\t\t<thead id=\"{{this.name}}Thead\" name=\"{{this.name}}Thead\">\n\t\t\t\t\t\t\t\t\t\t\t{{{getTableThead this}}}\n\t\t\t\t\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t\t\t\t\t<tbody id=\"{{this.name}}Tbody\" name=\"{{this.name}}Tbody\">\n\t\t\t\t\t\t\t\t\t\t\t{{{getTableBody this}}}\n\t\t\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{{else}}\n\t\t\t\t\t{{#if equals type 'input'}}\n\t\t\t\t\t\t<div class=\"form-group\" data-required=\"{{#if is_required}}true{{/if}}\">\n\t\t\t\t\t\t\t<label for=\"7ZQnDsXBGohZMetA5\" class=\"control-label\">{{getLabel code}}</label>\n\t\t\t\t\t\t\t{{#if is_textarea}}\n\t\t\t\t\t\t\t\t<textarea title=\"{{getLabel code}}\" name=\"{{code}}\" {{getPermissions code}} data-schema-key=\"{{getLabel code}}\" class=\"form-control\"></textarea>\n\t\t\t\t\t\t\t{{/if}}\n\t\t\t\t\t\t\t{{#unless is_textarea}}\n\t\t\t\t\t\t\t\t<input type=\"text\" title=\"{{getLabel code}}\" name=\"{{code}}\" {{getPermissions code}} data-schema-key=\"{{getLabel code}}\" class=\"form-control\">\n\t\t\t\t\t\t\t{{/unless}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{{else}}\n\t\t\t\t\t\t{{#if equals type 'number'}}\n\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t<label for=\"7ZQnDsXBGohZMetA5\" class=\"control-label\">{{getLabel code}}</label>\n\t\t\t\t\t\t\t\t<input type=\"number\" title=\"{{getLabel code}}\" name=\"{{code}}\" data-schema-key=\"{{getLabel code}}\" class=\"form-control\">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{{else}}\n\t\t\t\t\t\t\t{{#if equals type 'date'}}\n\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t<label for=\"7ZQnDsXBGohZMetA5\" class=\"control-label\">{{getLabel code}}</label>\n\t\t\t\t\t\t\t\t\t<input type=\"text\" title=\"{{getLabel code}}\" name=\"{{code}}\" data-type=\"date\" data-schema-key=\"{{getLabel code}}\" class=\"form-control\">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{{else}}\n\t\t\t\t\t\t\t\t{{#if equals type 'dateTime'}}\n\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t<label for=\"7ZQnDsXBGohZMetA5\" class=\"control-label\">{{getLabel code}}</label>\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" title=\"{{getLabel code}}\" name=\"{{code}}\" data-type='datetime' data-schema-key=\"{{getLabel code}}\" class=\"form-control\">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{{else}}\n\t\t\t\t\t\t\t\t\t{{#if equals type 'password'}}\n\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t\t<label for=\"7ZQnDsXBGohZMetA5\" class=\"control-label\">{{getLabel code}}</label>\n\t\t\t\t\t\t\t\t\t\t\t<input type=\"password\" title=\"{{getLabel code}}\" name=\"{{code}}\" data-schema-key=\"{{getLabel code}}\" class=\"form-control\">\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{{else}}\n\t\t\t\t\t\t\t\t\t\t{{#if equals type 'select'}}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t\t\t<label for=\"7ZQnDsXBGohZMetA5\" class=\"control-label\">{{getLabel code}}</label>\n\t\t\t\t\t\t\t\t\t\t\t\t<select name=\"{{code}}\" data-schema-key=\"{{getLabel code}}\" class=\"form-control\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{#each options this}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"{{value}}\">{{label}}</option>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{/each}}\n\t\t\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{{else}}\n\t\t\t\t\t\t\t\t\t\t\t{{#if equals type 'radio'}}\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\"7ZQnDsXBGohZMetA5\" class=\"control-label\">{{getLabel code}}</label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"af-radio-group\" data-schema-key=\"{{getLabel code}}\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{#each options this}}\n        \t\t\t\t\t\t\t\t\t\t\t\t<label class=\"radio-inline fix-indent\"><input type=\"radio\" value=\"{{value}}\" name=\"{{../code}}\" class=\"radio-inline fix-indent\"> {{label}}</label>\n    \t\t\t\t\t\t\t\t\t\t\t\t\t{{/each}}\n    \t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{{else}}\n\t\t\t\t\t\t\t\t\t\t\t\t{{#if equals type 'multiSelect'}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\"7ZQnDsXBGohZMetA5\" class=\"control-label\">{{getLabel code}}</label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"af-checkbox-group\" data-schema-key=\"{{getLabel code}}\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{#each options this}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\"checkbox-inline fix-indent\"><input type=\"checkbox\" value=\"{{value}}\" name=\"{{../code}}\" class=\"checkbox-inline fix-indent\"> {{label}}</label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{/each}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{{else}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{#if equals type 'url'}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\"7ZQnDsXBGohZMetA5\" class=\"control-label\">{{getLabel code}}</label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"url\" title=\"{{getLabel code}}\" name=\"{{code}}\" data-schema-key=\"{{getLabel code}}\" class=\"form-control\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{else}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{#if equals type 'email'}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\"7ZQnDsXBGohZMetA5\" class=\"control-label\">{{getLabel code}}</label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"email\" title=\"{{getLabel code}}\" name=\"{{code}}\" data-schema-key=\"{{getLabel code}}\" class=\"form-control\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{else}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{#if equals type 'checkbox'}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\"7ZQnDsXBGohZMetA5\" class=\"control-label\">{{getLabel code}}</label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"checkbox\" data-schema-key=\"{{getLabel code}}\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label style=\"width: 100%;\"><input type=\"checkbox\" value=\"true\" name=\"{{code}}\" class=\"checkbox-inline fix-indent\"></label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{else}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\"7ZQnDsXBGohZMetA5\" class=\"control-label\">{{getLabel code}}</label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class='{{getCfClass this}} form-control' readonly disabled>{{{getValue code}}}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{/if}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{/if}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{/if}}\n\t\t\t\t\t\t\t\t\t\t\t\t{{/if}}\n\t\t\t\t\t\t\t\t\t\t\t{{/if}}\n\t\t\t\t\t\t\t\t\t\t{{/if}}\n\t\t\t\t\t\t\t\t\t{{/if}}\n\t\t\t\t\t\t\t\t{{/if}}\n\t\t\t\t\t\t\t{{/if}}\n\t\t\t\t\t\t{{/if}}\n\t\t\t\t\t{{/if}}\n\t\t\t\t{{/if}}\n\t\t\t{{/if}}\n\t\t{{/with}}\n\"\"\"\n\nInstanceReadOnlyTemplate.create = (tempalteName, steedosData) ->\n\ttemplate = InstanceReadOnlyTemplate[tempalteName]\n\n\ttemplateCompiled = SpacebarsCompiler.compile(template, {isBody: true});\n\n\ttemplateRenderFunction = eval(templateCompiled);\n\n\tTemplate[tempalteName] = new Blaze.Template(tempalteName, templateRenderFunction);\n\tTemplate[tempalteName].steedosData = steedosData\n\tTemplate[tempalteName].helpers InstanceformTemplate.helpers\n\nInstanceReadOnlyTemplate.createInstanceSignText = (steedosData)->\n\tinstanceSignTextHtml = _getViewHtml('client/views/instance/instance_sign_text.html')\n\n\tinstanceSignTextCompiled = SpacebarsCompiler.compile(instanceSignTextHtml, {isBody: true});\n\n\tinstanceSignTextRenderFunction = eval(instanceSignTextCompiled);\n\n\tTemplate.instanceSignText = new Blaze.Template(\"instanceSignText\", instanceSignTextRenderFunction);\n\tTemplate.instanceSignText.steedosData = steedosData\n\tTemplate.instanceSignText.helpers InstanceSignText.helpers\n\nInstanceReadOnlyTemplate.createImageSign = (steedosData) ->\n\timageSignHtml = _getViewHtml('client/views/instance/image_sign.html')\n\timageSignCompiled = SpacebarsCompiler.compile(imageSignHtml, {isBody: true});\n\timageSignRenderFunction = eval(imageSignCompiled);\n\tTemplate.imageSign = new Blaze.Template(\"imageSign\", imageSignRenderFunction);\n\tTemplate.imageSign.steedosData = steedosData\n\tTemplate.imageSign.helpers ImageSign.helpers\n\nInstanceReadOnlyTemplate.createTracesHanlder = (steedosData) ->\n\ttracesHanlderHtml = _getViewHtml('client/views/instance/traces_handler.html')\n\ttracesHanlderCompiled = SpacebarsCompiler.compile(tracesHanlderHtml, {isBody: true});\n\ttracesHanlderRenderFunction = eval(tracesHanlderCompiled);\n\tTemplate.instance_traces_handler = new Blaze.Template(\"instance_traces_handler\", tracesHanlderRenderFunction);\n\tTemplate.instance_traces_handler.steedosData = steedosData\n\tTemplate.instance_traces_handler.helpers TracesHandler.helpers\n\n\nInstanceReadOnlyTemplate.init = (steedosData) ->\n\tInstanceReadOnlyTemplate.create(\"afSelectUserRead\", steedosData);\n\n\tif Meteor.isServer\n\t\tInstanceReadOnlyTemplate.create(\"afFormGroup\", steedosData);\n\n\tInstanceReadOnlyTemplate.create(\"afFormGroupRead\", steedosData);\n\tif Meteor.isServer\n\t\tInstanceReadOnlyTemplate.create(\"instance_attachment\", {absolute: steedosData.absolute});\n\t\tInstanceReadOnlyTemplate.createImageSign(steedosData)\n\t\tInstanceReadOnlyTemplate.createTracesHanlder(steedosData);\n\t\tInstanceReadOnlyTemplate.createInstanceSignText(steedosData)\n\ngetLinkText = (item, label, detail_url)->\n\tif detail_url\n\t\tdetail_url = detail_url.replace(\"{_id}\", item._id)\n\t\tif !/^http(s?):\\/\\//.test(detail_url)\n\t\t\tdetail_url = Steedos.absoluteUrl(detail_url)\n\t\treturn '<a href=\"'+detail_url+'\" target=\"_blank\">'+label+'</a>';\n\telse\n\t\treturn label\n\nInstanceReadOnlyTemplate.getValue = (value, field, locale, utcOffset) ->\n\tif !value && value != false\n\t\treturn ''\n\tif [\"select\", \"multiSelect\", \"radio\"].indexOf(field.type) > -1\n\t\tfieldOptions = field.options.split(\"\\n\").map (n)->\n\t\t\titemSplits = n.split(\":\")\n\t\t\treturn {\n\t\t\t\tlabel: itemSplits[0],\n\t\t\t\tvalue: itemSplits[1] || n\n\t\t\t}\n\tswitch field.type\n\t\twhen 'email'\n\t\t\tvalue = if value then '<a href=\\'mailto:' + value + '\\'>' + value + '</a>' else ''\n\t\twhen 'url'\n\t\t\tif value\n\t\t\t\tif value.indexOf(\"http\") == 0\n\t\t\t\t\ttry\n\t\t\t\t\t\tvalue = \"<a href='\" + encodeURI(value) + \"' target='_blank'>\" + value + \"</a>\";\n\t\t\t\t\tcatch e\n\t\t\t\t\t\tvalue = \"<a href='' target='_blank'>\" + value + \"</a>\";\n\n\t\t\t\telse\n\t\t\t\t\tvalue = \"<a href='http://\" + encodeURI(value) + \"' target='_blank'>\" + value + \"</a>\";\n\t\t\telse\n\t\t\t\tvalue = ''\n\t\twhen 'group'\n\t\t\tif field.is_multiselect\n\t\t\t\tvalue = value?.getProperty(\"fullname\").toString()\n\t\t\telse\n\t\t\t\tvalue = value?.fullname\n\t\twhen 'user'\n\t\t\tif field.is_multiselect\n\t\t\t\tvalue = value?.getProperty(\"name\").toString()\n\t\t\telse\n\t\t\t\tvalue = value?.name\n\t\twhen 'password'\n\t\t\tvalue = '******'\n\t\twhen 'checkbox'\n\t\t\tif value && value != 'false'\n\t\t\t\tvalue = TAPi18n.__(\"form_field_checkbox_yes\", {}, locale)\n\t\t\telse\n\t\t\t\tvalue = TAPi18n.__(\"form_field_checkbox_no\", {}, locale)\n\t\twhen 'dateTime'\n\t\t\tif value && value.length == 16\n\t\t\t\tt = value.split(\"T\")\n\t\t\t\tt0 = t[0].split(\"-\");\n\t\t\t\tt1 = t[1].split(\":\");\n\n\t\t\t\tyear = t0[0];\n\t\t\t\tmonth = t0[1];\n\t\t\t\tdate = t0[2];\n\t\t\t\thours = t1[0];\n\t\t\t\tseconds = t1[1];\n\n\t\t\t\tvalue = new Date(year, month - 1, date, hours, seconds)\n\t\t\telse\n\t\t\t\tvalue = new Date(value)\n\n\t\t\tvalue = InstanceReadOnlyTemplate.formatDate(value, utcOffset);\n\t\twhen 'input'\n\t\t\tif field.is_textarea\n\t\t\t\tif Meteor.isServer\n\t\t\t\t\tmarked = Npm.require('marked')\n\t\t\t\tvalue = Spacebars.SafeString(marked.parse(value))\n\t\twhen 'select'\n\t\t\tselectedOption = fieldOptions.find((item) -> return item.value == value)\n\t\t\tif selectedOption\n\t\t\t\tvalue = selectedOption.label\n\t\twhen 'radio'\n\t\t\tselectedOption = fieldOptions.find((item) -> return item.value == value)\n\t\t\tif selectedOption\n\t\t\t\tvalue = selectedOption.label\n\t\twhen 'multiSelect'\n\t\t\tsplitedValues = value.split(\",\")\n\t\t\tselectedOptions = fieldOptions.filter((item) -> return splitedValues.indexOf(item.value) > -1)\n\t\t\tif selectedOptions.length\n\t\t\t\tvalue = selectedOptions.map((item) -> return item.label).join(\",\")\n\t\twhen 'number'\n\t\t\tif value or value == 0\n\t\t\t\tif field.is_percent\n\t\t\t\t\tvalue = Steedos.numberToPercentString value, field.digits\n\t\t\t\telse\n\t\t\t\t\tvalue = Steedos.numberToString value, field.digits\n\t\twhen 'odata'\n\t\t\tdetail_url = field.detail_url\n\t\t\tif field.is_multiselect\n\t\t\t\tvalue = _.map value, (item)->\n\t\t\t\t\treturn getLinkText(item, item['@label'], detail_url)\n\t\t\telse\n\t\t\t\tvalue = getLinkText(value, value['@label'], detail_url)\n\t\twhen 'image'\n\t\t\tif field.is_multiselect\n\t\t\t\tvalue = _.map value, (item)->\n\t\t\t\t\treturn '<div class=\"antd-ImageControl-item is-uploaded\">\n\t\t\t\t\t\t<div class=\"antd-Image antd-Image--thumb antd-ImageControl-image\">\n\t\t\t\t\t\t\t<div class=\"antd-Image-thumbWrap\">\n\t\t\t\t\t\t\t\t<div class=\"antd-Image-thumb\"><img class=\"antd-Image-image\"\n\t\t\t\t\t\t\t\t\t\tsrc=\"/api/files/images/'+item+'\"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>'\n\t\t\t\tvalue = value.join(\"\");\n\t\t\telse\n\t\t\t\tvalue = '<div class=\"antd-ImageControl-item is-uploaded\">\n\t\t\t\t\t\t<div class=\"antd-Image antd-Image--thumb antd-ImageControl-image\">\n\t\t\t\t\t\t\t<div class=\"antd-Image-thumbWrap\">\n\t\t\t\t\t\t\t\t<div class=\"antd-Image-thumb\"><img class=\"antd-Image-image\"\n\t\t\t\t\t\t\t\t\t\tsrc=\"/api/files/images/'+value+'\"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>'\n\t\twhen 'file'\n\t\t\tif value\n\t\t\t\tif !field.is_multiselect\n\t\t\t\t\tvalue = [value]\n\t\t\t\tif Meteor.isClient\n\t\t\t\t\tres = Steedos.authRequest('/api/v1/cfs_files_filerecord?filters=[[\"_id\",\"in\", '+JSON.stringify(value)+']]&fields=[\"_id\",\"original\"]', {async:false})\n\t\t\t\t\trecords = res.data.items\n\t\t\t\telse if Meteor.isServer\n\t\t\t\t\trecords = Steedos.objectFind(\"cfs_files_filerecord\", { filters: [[\"_id\", 'in', value]], fields: [\"_id\", \"original\"] });\n\n\t\t\t\tvalue = _.map records, (item)->\n\t\t\t\t\treturn \"<a href='#{Steedos.absoluteUrl('/api/files/files/'+item._id+'?download=true')}' target='_blank' style='display: block;'>#{item.original.name}</a>\"\n\n\t\t\t\tvalue = value.join(\"\");\n\t\twhen 'lookup'\n\t\t\tif value\n\t\t\t\tif !field.is_multiselect\n\t\t\t\t\tvalue = [value]\n\t\t\t\tif Meteor.isClient\n\t\t\t\t\tuiSchema = Creator.getObject(field.reference_to)\n\t\t\t\t\tnameField = uiSchema?.NAME_FIELD_KEY || 'name'\n\t\t\t\t\tres = Steedos.authRequest('/api/v1/'+field.reference_to+'?filters=[[\"'+(field.reference_to_field || '_id')+'\",\"in\", '+JSON.stringify(value)+']]&fields=[\"_id\",\"'+nameField+'\"]', {async:false})\n\t\t\t\t\trecords = res.data.items\n\t\t\t\telse if Meteor.isServer\n\t\t\t\t\tnameField = Steedos.getObjectNameFieldKey(field.reference_to);\n\t\t\t\t\trecords = Steedos.objectFind(field.reference_to, { filters: [[(field.reference_to_field || '_id'), 'in', value]], fields: [\"_id\", nameField] });\n\t\t\t\tvalue = _.map records, (item)->\n\t\t\t\t\treturn \"<a href='#{Steedos.absoluteUrl('/app/-/'+field.reference_to+'/view/'+item._id)}' target='_blank'>#{item[nameField]}</a>\"\n\n\t\t\t\tvalue = value.join(\"\");\t\n\t\twhen 'html'\n\t\t\tvalue = if value then \"<div class=\\\"steedos-html\\\">#{value}</div>\" else ''\n\n\treturn value;\n\nInstanceReadOnlyTemplate.getLabel = (fields, code) ->\n\tfield = fields.findPropertyByPK(\"code\", code)\n\tif field\n\t\tif field.name\n\t\t\treturn field.name\n\t\telse\n\t\t\treturn field.code\n\n\nInstanceReadOnlyTemplate.getInstanceFormVersion = (instance)->\n\tform = db.forms.findOne(instance.form);\n\n\tform_version = {}\n\n\tform_fields = [];\n\n\tif form.current._id == instance.form_version\n\t\tform_version = form.current\n\telse\n\t\tform_version = _.where(form.historys, {_id: instance.form_version})[0]\n\n\tform_version.fields.forEach (field)->\n\t\tif field.type == 'section'\n\t\t\tform_fields.push(field);\n\t\t\tif field.fields\n\t\t\t\tfield.fields.forEach (f) ->\n\t\t\t\t\tform_fields.push(f);\n\t\telse if field.type == 'table'\n\t\t\tfield['sfields'] = field['fields']\n\t\t\tdelete field['fields']\n\t\t\tform_fields.push(field);\n\t\telse\n\t\t\tform_fields.push(field);\n\n\tform_version.fields = form_fields;\n\n\treturn form_version;\n\nInstanceReadOnlyTemplate.getFlowVersion = (instance)->\n\tflow = db.flows.findOne(instance.flow);\n\tflow_version = {}\n\tif flow.current._id == instance.flow_version\n\t\tflow_version = flow.current\n\telse\n\t\tflow_version = _.where(flow.historys, {_id: instance.flow_version})[0]\n\n\treturn flow_version;\n\n\n_getViewHtml = (path) ->\n\tviewHtml = Assets.getText(path)\n\n\tif viewHtml\n\t\tviewHtml = viewHtml.replace(/<template[\\w\\s\\\"\\=']+>/i,\"\").replace(/<\\/template>/i,\"\")\n\n\treturn viewHtml;\n\n_getLocale = (user)->\n\tif user?.locale?.toLocaleLowerCase() == 'zh-cn'\n\t\tlocale = \"zh-CN\"\n\telse if user?.locale?.toLocaleLowerCase() == 'en-us'\n\t\tlocale = \"en\"\n\telse\n\t\tlocale = \"zh-CN\"\n\treturn locale\n\n\n_getRequiredFields = (fields, rev)->\n\tif !rev\n\t\trev = [];\n\n\tfields.forEach (field)->\n\t\tif field.type == 'section'\n\t\t\t_getRequiredFields(field.fields, rev)\n\t\telse if field.type == 'table'\n\n\t\telse\n\t\t\tif field.is_required\n\t\t\t\trev.push field.code\n\treturn rev;\n\n_getStartStepEditableFields = (fields, steps)->\n\tstartStep = steps.findPropertyByPK(\"step_type\",\"start\")\n\n\teditableCode = []\n\n\t_.keys(startStep.permissions).forEach (key)->\n\t\tif startStep.permissions[key] == 'editable'\n\t\t\teditableCode.push key\n\n\treturn editableCode\n\n_getStartStepRequiredFields = (fields, steps)->\n\trequiredFields = _getRequiredFields(fields)\n\n\teditableCode = _getStartStepEditableFields(fields, steps)\n\n\treturn _.intersection(requiredFields, editableCode)\n\n_getTemplateData = (user, space, instance, options)->\n\tif Meteor.isServer\n\t\tform_version = InstanceReadOnlyTemplate.getInstanceFormVersion(instance)\n\telse\n\t\tform_version = WorkflowManager.getInstanceFormVersion(instance)\n\n\tlocale = _getLocale(user)\n\n\tsteedosData = {}\n\n\tif Meteor.isClient\n\t\tsteedosData = _.clone(WorkflowManager_format.getAutoformSchemaValues())\n\t\tsteedosData.insname = instance.name\n\t\tsteedosData.ins_state = instance.state\n\t\tsteedosData.ins_final_decision = instance.ins_final_decision\n\t\tsteedosData.ins_code = instance.code\n\t\tsteedosData.ins_is_archived = instance.is_archived\n\t\tsteedosData.ins_is_deleted = instance.ins_is_deleted\n\t\tsteedosData.applicant_name = instance.applicant_name\n\t\tsteedosData.applicantContext = instance.applicant_name\n\n\tsteedosData.instance = instance\n\tsteedosData.form_version = form_version\n\tsteedosData.locale = locale\n\tsteedosData.utcOffset = user.utcOffset\n\tsteedosData.space = instance.space\n\tsteedosData.sessionUserId = user._id\n\n\tif Meteor.isServer\n\t\tif options?.editable\n\t\t\tform = db.forms.findOne({_id: instance.form})\n\n\t\t\tflow = db.flows.findOne({_id: instance.flow})\n\n\t\t\tsteedosData.startStepEditableFields = _getStartStepEditableFields(form.current.fields, flow.current.steps);\n\n\treturn steedosData;\n\nInstanceReadOnlyTemplate.formatDate = (date, utcOffset)->\n\tif Meteor.isServer\n\t\tpassing = false;\n\telse\n\t\tpassing = true;\n\n\tif !utcOffset && utcOffset !=0\n\t\tutcOffset = 8\n\n\treturn moment(date).utcOffset(utcOffset, passing).format(\"YYYY-MM-DD HH:mm\");\n\nInstanceReadOnlyTemplate.getInstanceView = (user, space, instance, options)->\n\n\tsteedosData = _getTemplateData(user, space, instance, options)\n\n\tsteedosData.absolute = false;\n\n\tif options?.absolute\n\t\tsteedosData.absolute = true;\n\n\tinstanceTemplate = TemplateManager.getTemplate(instance, options?.templateName);\n\n\tinstanceTemplate = instanceTemplate.replace(/afSelectUser/g,\"afSelectUserRead\")\n\n\tif !options?.editable\n\t\tinstanceTemplate = instanceTemplate.replace(/afFormGroup/g,\"afFormGroupRead\")\n\n\tinstanceCompiled = SpacebarsCompiler.compile(instanceTemplate, {isBody: true});\n\n\tinstanceRenderFunction = eval(instanceCompiled);\n\n\tTemplate.instance_readonly_view = new Blaze.Template(\"instance_readonly_view\", instanceRenderFunction);\n\n\tTemplate.instance_readonly_view.steedosData = steedosData\n\n\tTemplate.instance_readonly_view.helpers InstanceformTemplate.helpers\n\n\tInstanceReadOnlyTemplate.init(steedosData);\n\n\tbody = Blaze.toHTMLWithData(Template.instance_readonly_view, steedosData)\n\n\treturn \"\"\"\n\t\t<div id='instanceform' >\n\t\t\t#{body}\n\t\t</div>\n\t\"\"\"\n\nInstanceReadOnlyTemplate.getTracesView = (user, space, instance, options)->\n\n\tsteedosData = _getTemplateData(user, space, instance)\n\n\tform = db.forms.findOne(instance.form);\n\tif form.instance_style == \"table\" || options?.templateName == \"table\"\n\t\ttracesHtml = _getViewHtml('client/views/instance/traces_table.html')\n\telse\n\t\ttracesHtml = _getViewHtml('client/views/instance/traces.html')\n\n\ttraceCompiled = SpacebarsCompiler.compile(tracesHtml, {isBody: true});\n\n\ttraceRenderFunction = eval(traceCompiled);\n\n\tTemplate.trace_readonly_view = new Blaze.Template(\"trace_readonly_view\", traceRenderFunction);\n\n\tTemplate.trace_readonly_view.steedosData = steedosData\n\n\tTemplate.trace_readonly_view.helpers TracesTemplate.helpers\n\n\tbody = Blaze.toHTMLWithData(Template.trace_readonly_view, instance.traces)\n\n\treturn body;\n\nInstanceReadOnlyTemplate.getAttachmentView = (user, space, instance)->\n\n\tsteedosData = _getTemplateData(user, space, instance)\n\n\tattachmentHtml = _getViewHtml('client/views/instance/instance_attachments.html')\n\n\tattachmentCompiled = SpacebarsCompiler.compile(attachmentHtml, {isBody: true});\n\n\tattachmentRenderFunction = eval(attachmentCompiled);\n\n\tTemplate.attachments_readonly_view = new Blaze.Template(\"attachments_readonly_view\", attachmentRenderFunction);\n\n\tTemplate.attachments_readonly_view.steedosData = steedosData\n\n\tTemplate.attachments_readonly_view.helpers InstanceAttachmentTemplate.helpers\n\n\tbody = Blaze.toHTMLWithData(Template.attachments_readonly_view)\n\n\treturn body;\n\nInstanceReadOnlyTemplate.getRelatedInstancesView = (user, space, instance, options)->\n\tsteedosData = _getTemplateData(user, space, instance)\n\n\tsteedosData.absolute = false;\n\n\tif options?.absolute\n\t\tsteedosData.absolute = true;\n\n\trelatedInstancesHtml = _getViewHtml('client/views/instance/related_instances.html')\n\n\trelatedInstancesCompiled = SpacebarsCompiler.compile(relatedInstancesHtml, {isBody: true});\n\n\trelatedInstancesRenderFunction = eval(relatedInstancesCompiled);\n\n\tTemplate.related_instances_view = new Blaze.Template(\"related_instances_view\", relatedInstancesRenderFunction);\n\n\tTemplate.related_instances_view.steedosData = steedosData\n\n\tTemplate.related_instances_view.helpers RelatedInstances.helpers\n\n\tbody = Blaze.toHTMLWithData(Template.related_instances_view, steedosData)\n\n\treturn body;\n\nInstanceReadOnlyTemplate.getRelatedRecordsView = (user, space, instance, options)->\n\tsteedosData = _getTemplateData(user, space, instance)\n\n\tsteedosData.absolute = false;\n\n\tif options?.absolute\n\t\tsteedosData.absolute = true;\n\n\trelatedRecordsHtml = _getViewHtml('client/views/instance/related_records.html')\n\n\trelatedRecordsCompiled = SpacebarsCompiler.compile(relatedRecordsHtml, {isBody: true});\n\n\trelatedRecordsRenderFunction = eval(relatedRecordsCompiled);\n\n\tTemplate.related_records_view = new Blaze.Template(\"related_records_view\", relatedRecordsRenderFunction);\n\n\tTemplate.related_records_view.steedosData = steedosData\n\n\tTemplate.related_records_view.helpers RelatedRecords.helpers\n\n\tbody = Blaze.toHTMLWithData(Template.related_records_view, steedosData)\n\n\treturn body;\n\nInstanceReadOnlyTemplate.getOnLoadScript = (instance)->\n\tform_version = WorkflowManager.getFormVersion(instance.form, instance.form_version)\n\n\tform_script = form_version.form_script;\n\n\tif form_script && form_script.replace(/\\n/g,\"\").replace(/\\s/g,\"\").length > 0\n\t\tform_script = \"CoreForm = {};CoreForm.instanceform = {};\" + form_script\n\t\tform_script += \";if(CoreForm.form_OnLoad){window.onload = CoreForm.form_OnLoad();}\"\n\telse\n\t\tform_script = \"\"\n\n\n\nInstanceReadOnlyTemplate.getInstanceHtml = (user, space, instance, options)->\n\n\tbody = InstanceReadOnlyTemplate.getInstanceView(user, space, instance, options);\n\n\tonLoadScript = InstanceReadOnlyTemplate.getOnLoadScript(instance);\n\n\tcreatorService = Meteor.settings.public.webservices?.creator?.url\n\tins_record_ids = instance.record_ids\n\tlocale = _getLocale(user);\n\topenFileScript = \"\"\"\n\t\t\tif(window.isNode && isNode()){\n\t\t\t\tattachs = document.getElementsByClassName(\"ins_attach_href\");\n\t\t\t\tfor(var i = 0; i < attachs.length; i++){\n\t\t\t\t\tattach = attachs[i];\n\t\t\t\t\tattach.addEventListener(\"click\", function(e){\n\t\t\t\t\t\tif(isImage(this.dataset.type) || isHtml(this.dataset.type)){\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\topenWindow(\"/api/files/instances/\" + this.dataset.id);\n\t\t\t\t\t\t}else if(nw_core.canOpenFile(this.dataset.name)){\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tnw_core.openFile(this.href, this.dataset.name)\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar flow = \"#{instance.flow}\";\n\t\t\tvar space = \"#{instance.space}\";\n\n\t\t\tfunction getCookie(name){\n\t\t\t\tlet pattern = RegExp(name + \"=.[^;]*\")\n\t\t\t\tlet matched = document.cookie.match(pattern)\n\t\t\t\tif(matched){\n\t\t\t\t\tlet cookie = matched[0].split('=')\n\t\t\t\t\treturn cookie[1]\n\t\t\t\t}\n\t\t\t\treturn ''\n\t\t\t}\n\n\t\t\tvar records = document.getElementsByClassName(\"ins-related-records\");\n\t\t\tfor(var i = 0; i < records.length; i++){\n\t\t\t\t\tvar record = records[i];\n\t\t\t\t\trecord.addEventListener(\"click\", function(e){\n\t\t\t\t\t\tvar creatorService = \"#{creatorService}\"\n\t\t\t\t\t\tvar ins_record_ids = #{JSON.stringify(ins_record_ids)}\n\t\t\t\t\t\tif(creatorService && ins_record_ids && ins_record_ids.length > 0){\n\t\t\t\t\t\t\tvar objcetName = ins_record_ids[0].o\n\t\t\t\t\t\t\tvar id = ins_record_ids[0].ids[0]\n\t\t\t\t\t\t\tvar uobj = {};\n\t\t\t\t\t\t\tuobj[\"X-User-Id\"] = getCookie(\"X-User-Id\");\n\t\t\t\t\t\t\tuobj[\"X-Auth-Token\"] = getCookie(\"X-Auth-Token\");\n\t\t\t\t\t\t\tredirectUrl = creatorService + \"app/-/\" + objcetName + \"/view/\" + id + \"?\" + $.param(uobj);\n\t\t\t\t\t\t\topenWindow(redirectUrl);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\"\"\";\n\n\n\tif !Steedos.isMobile()\n\t\tform = db.forms.findOne(instance.form);\n\t\tif form?.instance_style == 'table'\n\t\t\tinstance_style = \"instance-table\"\n\n\tif options?.templateName == 'table'\n\t\tinstance_style = \"instance-table\"\n\n\tif options?.instance_style\n\t\tinstance_style = options.instance_style\n\n\tif !options || options.showTrace == true\n\t\ttrace = InstanceReadOnlyTemplate.getTracesView(user, space, instance)\n\telse\n\t\ttrace = \"\"\n\n\tinstanceBoxStyle = \"\";\n\n\tif instance && instance.final_decision\n\t\tif instance.final_decision == \"approved\"\n\t\t\tinstanceBoxStyle = \"box-success\"\n\t\telse if (instance.final_decision == \"rejected\")\n\t\t\tinstanceBoxStyle = \"box-danger\"\n\tif !options || options.showAttachments == true\n\t\tattachment = InstanceReadOnlyTemplate.getAttachmentView(user, space, instance)\n\t\trelated_instances = InstanceReadOnlyTemplate.getRelatedInstancesView(user, space, instance, options)\n\t\trelated_records = InstanceReadOnlyTemplate.getRelatedRecordsView(user, space, instance, options)\n\telse\n\t\tattachment = \"\"\n\t\trelated_instances = \"\"\n\t\trelated_records = \"\"\n\n\n\twidth = \"960px\"\n\t#\tå¦‚æžœç»™tableçš„parentè®¾ç½®widthï¼Œåˆ™ä¼šå¯¼è‡´é˜¿é‡Œäº‘é‚®ç®±æ˜¾ç¤ºtable å¼‚å¸¸\n\tif options?.width\n\t\twidth = \"\"\n\n\tcssHref = Meteor.absoluteUrl(\"steedos-css\")\n\t\n\tjqHref = Meteor.absoluteUrl(\"website/libs/jquery.min.js\")\n\n\tallCssLink = \"\"\"<link rel=\"stylesheet\" type=\"text/css\" class=\"__meteor-css__\" href=\"#{cssHref}\">\"\"\"\n\n\ttraceCheck = \"\"\n\tif !_.isEmpty(trace)\n\t\ttraceCheck = \"checked\"\n\tif options?.tagger == 'email' || options?.editable\n\t\tshowTracesBtn = \"\"\n\telse\n\t\tshowTracesBtn = \"\"\"\n\t\t\t<div class=\"navigation-bar btn-group no-print\" style=\"min-width: 600px; z-index: 999; box-sizing: border-box;\">\n\t\t\t\t<div class=\"print-tool\">\n\t\t\t\t\t<label class=\"cbx-label\"><input type=\"checkbox\" class=\"cbx-print cbx-print-attachments\" id=\"cbx-print-attachments\" checked=\"checked\"><span>#{TAPi18n.__('instance_attachment', {}, locale)}</span></label>\n\t\t\t\t\t<label class=\"cbx-label\"><input type=\"checkbox\" class=\"cbx-print cbx-print-traces\" id=\"cbx-print-traces\" checked=\"#{traceCheck}\"><span>#{TAPi18n.__('instance_approval_history', {}, locale)}</span></label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\"\"\"\n\n\tshowTracesScript = \"\"\"\n\t\t$( document ).ready(function(){\n\t\t\tvar b = document.getElementById('cbx-print-traces');\n\t\t\tvar t = document.getElementsByClassName('instance-traces')[0];\n\t\t\tif (b && b.checked && t){\n\t\t\t\tt.style = 'display: block;'\n\t\t\t} else if(t){\n\t\t\t\tt.style = 'display: none;'\n\t\t\t}\n\t\t\tif(b){\n\t\t\t\tb.addEventListener('change', function(e){\n\t\t\t\t\tif (e.target.checked){\n\t\t\t\t\t\tt.style = 'display: block;'\n\t\t\t\t\t} else {\n\t\t\t\t\t\tt.style = 'display: none;'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\n\t\t\tvar attachmentsCheckbox = document.getElementById('cbx-print-attachments');\n\t\t\tvar attachmentsView = document.getElementsByClassName('attachments-section')[0];\n\t\t\tif (attachmentsCheckbox && attachmentsCheckbox.checked && attachmentsView){\n\t\t\t\tattachmentsView.style = 'display: block;'\n\t\t\t} else if(attachmentsView){\n\t\t\t\tattachmentsView.style = 'display: none;'\n\t\t\t}\n\t\t\tif(attachmentsCheckbox){\n\t\t\t\tattachmentsCheckbox.addEventListener('change', function(e){\n\t\t\t\t\tif (e.target.checked){\n\t\t\t\t\t\tattachmentsView.style = 'display: block;'\n\t\t\t\t\t} else {\n\t\t\t\t\t\tattachmentsView.style = 'display: none;'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\"\"\"\n\n\tif options?.styles\n\t\tallCssLink = \"\"\n\n\tform = db.forms.findOne({_id: instance.form});\n\tformDescriptionHtml = \"\"\n\tif form\n\t\tformDescription = form.description\n\t\tif formDescription\n\t\t\tformDescription = formDescription.replace(/\\n/g,\"<br/>\")\n\t\t\tformDescriptionHtml = \"\"\"\n\t\t\t\t<div class=\"box-header  with-border instance-header\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t#{formDescription}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\"\"\"\n\n\thtml = \"\"\"\n\t\t<!DOCTYPE html>\n\t\t<html>\n\t\t\t<head>\n\t\t\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"/>\n\t\t\t\t#{allCssLink}\n\t\t\t\t<script src=\"#{jqHref}\" type=\"text/javascript\"></script>\n\t\t\t\t<script src=\"/js/nw_core.js\" type=\"text/javascript\"></script>\n\t\t\t\t#{options.plugins || \"\"}\n\n\t\t\t\t<style>\n\t\t\t\t\t.steedos{\n\t\t\t\t\t\twidth: #{width};\n\t\t\t\t\t\tmargin-left: auto;\n\t\t\t\t\t\tmargin-right: auto;\n\t\t\t\t\t}\n\n\t\t\t\t\t.instance-view .instance-name{\n\t\t\t\t\t\tdisplay: inline !important\n\t\t\t\t\t}\n\t\t\t\t\t.box-tools{\n\t\t\t\t\t\tdisplay: none;\n\t\t\t\t\t}\n\t\t\t\t\t.box.collapsed-box .box-body,.box.collapsed-box .box-footer {\n\t\t\t\t\t  display: block;\n\t\t\t\t\t}\n\n\t\t\t\t\tbody{\n\t\t\t\t\t\tbackground: azure !important;\n\t\t\t\t\t}\n\n\t\t\t\t\t.instance-view .instance-traces{\n\t\t\t\t\t\tpadding-left: 15px;\n\t\t\t\t\t\tpadding-right: 15px;\n\t\t\t\t\t}\n\n\t\t\t\t\t.antd-ImageControl-item {\n\t\t\t\t\tborder-radius: var(--ImageControl-addBtn-borderRadius);\n\t\t\t\t\tvertical-align: top;\n\t\t\t\t\tpadding: var(--gap-xs);\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\tmargin-right: var(--gap-base);\n\t\t\t\t\tmargin-bottom: var(--gap-base);\n\t\t\t\t\tposition: relative;\n\t\t\t\t\twidth: 7.5rem;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-item.is-invalid {\n\t\t\t\t\tpadding: 0;\n\t\t\t\t\tborder-color: var(--FileControl-danger-color);\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-item svg.icon-refresh {\n\t\t\t\t\ttransform: rotate(180deg);\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-filename {\n\t\t\t\t\tdisplay: inline-flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tcolor: var(--FileControl-danger-color);\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-filename > svg.icon-image {\n\t\t\t\t\tmargin-bottom: 8px;\n\t\t\t\t\twidth: 24px;\n\t\t\t\t\theight: 24px;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-filename > span {\n\t\t\t\t\tmax-width: 100%;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\twhite-space: nowrap;\n\t\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-image {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tpadding: 0;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-itemClear {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tcolor: #999;\n\t\t\t\t\ttop: 5px;\n\t\t\t\t\tright: 5px;\n\t\t\t\t\tline-height: 1;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-itemClear > svg {\n\t\t\t\t\ttop: 0;\n\t\t\t\t\twidth: 10px;\n\t\t\t\t\theight: 10px;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-itemInfo {\n\t\t\t\t\tdisplay: inline-flex;\n\t\t\t\t\twidth: 110px;\n\t\t\t\t\theight: 110px;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\talign-content: center;\n\t\t\t\t\tflex-wrap: wrap;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-itemInfo > p {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tfont-size: 12px;\n\t\t\t\t\tmargin-bottom: 5px;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-progress {\n\t\t\t\t\twidth: 70px;\n\t\t\t\t\theight: 5px;\n\t\t\t\t\tbackground: #ebebeb;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-progressValue {\n\t\t\t\t\theight: 5px;\n\t\t\t\t\tborder-radius: var(--ImageControl-progress-borderRadius);\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\tbackground: var(--info);\n\t\t\t\t\tmin-width: 10%;\n\t\t\t\t\ttransition: ease-out width var(--animation-duration);\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-item.is-invalid .antd-ImageControl-itemClear {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-item.is-invalid:hover .antd-ImageControl-itemClear {\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-errorMsg {\n\t\t\t\t\tcolor: var(--danger);\n\t\t\t\t\tmargin: 5px 0 0;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-uploadBtn {\n\t\t\t\t\tmargin-top: 5px;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-cropperWrapper {\n\t\t\t\t\tposition: relative;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-cropperWrapper img {\n\t\t\t\t\tmax-width: 100%;\n\t\t\t\t\tmax-height: 400px;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-croperToolbar {\n\t\t\t\t\tdisplay: inline-flex;\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\tright: 0;\n\t\t\t\t\tbottom: 0;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\talign-items: flex-end;\n\t\t\t\t\tbackground: #fff;\n\t\t\t\t\tborder-radius: 4px;\n\t\t\t\t\tmargin: 0.5rem;\n\t\t\t\t\tbox-shadow: 0 0 4px 0 rgba(0, 0, 0, 0.1);\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-croperToolbar > a {\n\t\t\t\t\tcolor: var(--Form-item-fontColor);\n\t\t\t\t\tpadding: 2px 5px;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tfont-size: 18px;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-croperToolbar > a:hover {\n\t\t\t\t\tcolor: var(--link-color);\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-acceptTip {\n\t\t\t\t\theight: 120px;\n\t\t\t\t\tcolor: #999;\n\t\t\t\t\tborder: 2px dashed var(--borderColor);\n\t\t\t\t\tborder-color: var(--info);\n\t\t\t\t\tbackground: #f3f9fe;\n\t\t\t\t\tborder-radius: var(--borderRadius);\n\t\t\t\t\tline-height: 120px;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-fixed-size {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tpadding: 0;\n\t\t\t\t\t}\n\t\t\t\t\t.antd-ImageControl-fixed-size .antd-ImageControl-itemOverlay {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\t}\n\n\t\t\t\t\t.antd-Images {\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tflex-wrap: wrap;\n\t\t\t\t\t\tmargin: calc(var(--gap-xs) * -1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Images-item {\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tmargin: var(--gap-xs);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image {\n\t\t\t\t\t\tborder: var(--borderWidth) solid var(--borderColor);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image--thumb {\n\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\tpadding: var(--gap-xs);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image-thumbWrap {\n\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image-image {\n\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image-image--loading {\n\t\t\t\t\t\tvisibility: hidden;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image--original .antd-Image-image {\n\t\t\t\t\t\tmax-width: 100%;\n\t\t\t\t\t\tmax-height: 100%;\n\t\t\t\t\t\twidth: auto;\n\t\t\t\t\t\tmargin: auto;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image-thumb {\n\t\t\t\t\t\twidth: 6.875rem;\n\t\t\t\t\t\theight: 6.875rem;\n\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t\toverflow: hidden;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image-thumb > img {\n\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\tleft: 50%;\n\t\t\t\t\t\ttop: 50%;\n\t\t\t\t\t\tmax-height: 100%;\n\t\t\t\t\t\twidth: auto;\n\t\t\t\t\t\ttransform: translate(-50%, -50%);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image-info {\n\t\t\t\t\t\tpadding: 5px 10px;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image--thumb .antd-Image-info {\n\t\t\t\t\t\twidth: 6.875rem;\n\t\t\t\t\t\tpadding: 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image-thumb--4-3 {\n\t\t\t\t\t\theight: 5.15625rem;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image-thumb--16-9 {\n\t\t\t\t\t\theight: 3.8671875rem;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image-thumb--fixed-size {\n\t\t\t\t\t\tmin-width: 6.875rem;\n\t\t\t\t\t\tmin-height: 6.875rem;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\tpadding: 0;\n\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image-thumb--fixed-size .antd-Image-thumb {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image-thumb--fixed-size .antd-Image-thumb > img {\n\t\t\t\t\t\twidth: auto;\n\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t.antd-Image-thumb--w-full > img {\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\theight: auto;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t#{options?.styles || \"\"}\n\n\t\t\t\t\t#{options?.add_styles || \"\"}\n\t\t\t\t</style>\n\t\t\t</head>\n\t\t\t<body>\n\t\t\t\t<div class=\"steedos workflow instance-print\">\n\t\t\t\t\t<div class=\"skin-green skin-admin-lte\">\n\t\t\t\t\t\t<div class=\"wrapper\">\n\t\t\t\t\t\t\t<div class=\"content-wrapper\">\n\t\t\t\t\t\t\t\t#{showTracesBtn}\n\t\t\t\t\t\t\t\t<div class=\"instance-print\">\n\t\t\t\t\t\t\t\t\t<div class=\"instance #{instance_style}\">\n\t\t\t\t\t\t\t\t\t\t<form name=\"instanceForm\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"instance-form box #{instanceBoxStyle}\">\n\t\t\t\t\t\t\t\t\t\t\t\t#{formDescriptionHtml}\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"box-body\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"col-md-12\" style=\"box-sizing: border-box;\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class='attachments-section'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t#{attachment}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t#{related_instances}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t#{related_records}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#{body}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t\t\t\t#{trace}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</body>\n\t\t\t<script>#{openFileScript};#{onLoadScript};#{showTracesScript}</script>\n\t\t</html>\n\t\"\"\"\n\n\treturn html","var _getLocale, _getRequiredFields, _getStartStepEditableFields, _getStartStepRequiredFields, _getTemplateData, _getViewHtml, getLinkText, marked;                          \n\nmarked = require(\"marked\");\n\nInstanceReadOnlyTemplate = {};\n\nInstanceReadOnlyTemplate.instance_attachment = \"<tr>\\n\t<td class=\\\"ins-attach-view\\\">\\n\t\t<a href=\\\"{{ins_attach_download_url _id absolute}}\\\" class=\\\"ins_attach_href\\\" target=\\\"_parent\\\" data-name=\\\"{{this.name}}\\\" data-type=\\\"{{this.original.type}}\\\" data-id=\\\"{{_id}}\\\">{{this.name}}</a>\\n\t</td>\\n</tr>\";\n\nInstanceReadOnlyTemplate.afSelectUserRead = \"<div class='selectUser form-control ins_applicant'>{{value}}</div>\";\n\nInstanceReadOnlyTemplate.afFormGroupRead = \"<div class='form-group'>\\n\t{{#with getField this.name}}\\n\t\t{{#if equals type 'section'}}\\n\t\t\t\t<div class='section callout callout-default'>\\n\t\t\t\t\t<label class=\\\"control-label\\\">{{f_label this}}</label>\\n\t\t\t\t\t<p>{{{description}}}</p>\\n\t\t\t\t</div>\\n\t\t{{else}}\\n\t\t\t{{#if equals type 'table'}}\\n\t\t\t\t<div class=\\\"panel panel-default steedos-table\\\">\\n\t\t\t\t\t<div class=\\\"panel-body\\\" style=\\\"padding:0px;\\\">\\n\t\t\t\t\t\t<div class=\\\"panel-heading\\\" >\\n\t\t\t\t\t\t\t<label class='control-label'>{{getLabel code}}</label>\\n\t\t\t\t\t\t\t<span class=\\\"description\\\">{{{description}}}</span>\\n\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t<div class=\\\"readonly-table\\\" style=\\\"padding:0px;overflow-x:auto;\\\">\\n\t\t\t\t\t\t\t\t<table type='table' class=\\\"table table-bordered table-condensed autoform-table\\\" style='margin-bottom:0px;' {{this.atts}} id=\\\"{{this.code}}Table\\\" name=\\\"{{this.code}}\\\" data-schema-key=\\\"{{this.name}}\\\">\\n\t\t\t\t\t\t\t\t\t<thead id=\\\"{{this.name}}Thead\\\" name=\\\"{{this.name}}Thead\\\">\\n\t\t\t\t\t\t\t\t\t\t{{{getTableThead this}}}\\n\t\t\t\t\t\t\t\t\t</thead>\\n\t\t\t\t\t\t\t\t\t<tbody id=\\\"{{this.name}}Tbody\\\" name=\\\"{{this.name}}Tbody\\\">\\n\t\t\t\t\t\t\t\t\t\t{{{getTableBody this}}}\\n\t\t\t\t\t\t\t\t\t</tbody>\\n\t\t\t\t\t\t\t\t</table>\\n\t\t\t\t\t\t</div>\\n\t\t\t\t\t</div>\\n\t\t\t\t</div>\\n\t\t\t{{else}}\\n\t\t\t\t{{#if showLabel}}\\n\t\t\t\t\t<label>{{getLabel code}}</label>\\n\t\t\t\t{{/if}}\\n\t\t\t\t<div class='{{getCfClass this}} form-control' readonly disabled>{{{getValue code}}}</div>\\n\t\t\t{{/if}}\\n\t\t{{/if}}\\n\t{{/with}}\\n</div>\";\n\nInstanceReadOnlyTemplate.afFormGroup = \"\\n{{#with getField this.name}}\\n\t\t{{#if equals type 'section'}}\\n\t\t\t<div class=\\\"form-group\\\">\\n\t\t\t\t<div class='section callout callout-default'>\\n\t\t\t\t\t<label class=\\\"control-label\\\">{{f_label this}}</label>\\n\t\t\t\t\t<p>{{{description}}}</p>\\n\t\t\t\t</div>\\n  \t\t\t\t</div>\\n\t\t{{else}}\\n\t\t\t{{#if equals type 'table'}}\\n\t\t\t\t<div class=\\\"panel panel-default steedos-table\\\">\\n\t\t\t\t\t<div class=\\\"panel-body\\\" style=\\\"padding:0px;\\\">\\n\t\t\t\t\t\t<div class=\\\"panel-heading\\\" >\\n\t\t\t\t\t\t\t<label class='control-label'>{{getLabel code}}</label>\\n\t\t\t\t\t\t\t<span class=\\\"description\\\">{{{description}}}</span>\\n\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t<div class=\\\"readonly-table\\\" style=\\\"padding:0px;overflow-x:auto;\\\">\\n\t\t\t\t\t\t\t\t<table type='table' class=\\\"table table-bordered table-condensed autoform-table\\\" style='margin-bottom:0px;' {{this.atts}} id=\\\"{{this.code}}Table\\\" name=\\\"{{this.code}}\\\" data-schema-key=\\\"{{this.name}}\\\">\\n\t\t\t\t\t\t\t\t\t<thead id=\\\"{{this.name}}Thead\\\" name=\\\"{{this.name}}Thead\\\">\\n\t\t\t\t\t\t\t\t\t\t{{{getTableThead this}}}\\n\t\t\t\t\t\t\t\t\t</thead>\\n\t\t\t\t\t\t\t\t\t<tbody id=\\\"{{this.name}}Tbody\\\" name=\\\"{{this.name}}Tbody\\\">\\n\t\t\t\t\t\t\t\t\t\t{{{getTableBody this}}}\\n\t\t\t\t\t\t\t\t\t</tbody>\\n\t\t\t\t\t\t\t\t</table>\\n\t\t\t\t\t\t</div>\\n\t\t\t\t\t</div>\\n\t\t\t\t</div>\\n\t\t\t{{else}}\\n\t\t\t\t{{#if equals type 'input'}}\\n\t\t\t\t\t<div class=\\\"form-group\\\" data-required=\\\"{{#if is_required}}true{{/if}}\\\">\\n\t\t\t\t\t\t<label for=\\\"7ZQnDsXBGohZMetA5\\\" class=\\\"control-label\\\">{{getLabel code}}</label>\\n\t\t\t\t\t\t{{#if is_textarea}}\\n\t\t\t\t\t\t\t<textarea title=\\\"{{getLabel code}}\\\" name=\\\"{{code}}\\\" {{getPermissions code}} data-schema-key=\\\"{{getLabel code}}\\\" class=\\\"form-control\\\"></textarea>\\n\t\t\t\t\t\t{{/if}}\\n\t\t\t\t\t\t{{#unless is_textarea}}\\n\t\t\t\t\t\t\t<input type=\\\"text\\\" title=\\\"{{getLabel code}}\\\" name=\\\"{{code}}\\\" {{getPermissions code}} data-schema-key=\\\"{{getLabel code}}\\\" class=\\\"form-control\\\">\\n\t\t\t\t\t\t{{/unless}}\\n\t\t\t\t\t</div>\\n\t\t\t\t{{else}}\\n\t\t\t\t\t{{#if equals type 'number'}}\\n\t\t\t\t\t\t<div class=\\\"form-group\\\">\\n\t\t\t\t\t\t\t<label for=\\\"7ZQnDsXBGohZMetA5\\\" class=\\\"control-label\\\">{{getLabel code}}</label>\\n\t\t\t\t\t\t\t<input type=\\\"number\\\" title=\\\"{{getLabel code}}\\\" name=\\\"{{code}}\\\" data-schema-key=\\\"{{getLabel code}}\\\" class=\\\"form-control\\\">\\n\t\t\t\t\t\t</div>\\n\t\t\t\t\t{{else}}\\n\t\t\t\t\t\t{{#if equals type 'date'}}\\n\t\t\t\t\t\t\t<div class=\\\"form-group\\\">\\n\t\t\t\t\t\t\t\t<label for=\\\"7ZQnDsXBGohZMetA5\\\" class=\\\"control-label\\\">{{getLabel code}}</label>\\n\t\t\t\t\t\t\t\t<input type=\\\"text\\\" title=\\\"{{getLabel code}}\\\" name=\\\"{{code}}\\\" data-type=\\\"date\\\" data-schema-key=\\\"{{getLabel code}}\\\" class=\\\"form-control\\\">\\n\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t{{else}}\\n\t\t\t\t\t\t\t{{#if equals type 'dateTime'}}\\n\t\t\t\t\t\t\t\t<div class=\\\"form-group\\\">\\n\t\t\t\t\t\t\t\t\t<label for=\\\"7ZQnDsXBGohZMetA5\\\" class=\\\"control-label\\\">{{getLabel code}}</label>\\n\t\t\t\t\t\t\t\t\t<input type=\\\"text\\\" title=\\\"{{getLabel code}}\\\" name=\\\"{{code}}\\\" data-type='datetime' data-schema-key=\\\"{{getLabel code}}\\\" class=\\\"form-control\\\">\\n\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t{{else}}\\n\t\t\t\t\t\t\t\t{{#if equals type 'password'}}\\n\t\t\t\t\t\t\t\t\t<div class=\\\"form-group\\\">\\n\t\t\t\t\t\t\t\t\t\t<label for=\\\"7ZQnDsXBGohZMetA5\\\" class=\\\"control-label\\\">{{getLabel code}}</label>\\n\t\t\t\t\t\t\t\t\t\t<input type=\\\"password\\\" title=\\\"{{getLabel code}}\\\" name=\\\"{{code}}\\\" data-schema-key=\\\"{{getLabel code}}\\\" class=\\\"form-control\\\">\\n\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t{{else}}\\n\t\t\t\t\t\t\t\t\t{{#if equals type 'select'}}\\n\t\t\t\t\t\t\t\t\t\t<div class=\\\"form-group\\\">\\n\t\t\t\t\t\t\t\t\t\t\t<label for=\\\"7ZQnDsXBGohZMetA5\\\" class=\\\"control-label\\\">{{getLabel code}}</label>\\n\t\t\t\t\t\t\t\t\t\t\t<select name=\\\"{{code}}\\\" data-schema-key=\\\"{{getLabel code}}\\\" class=\\\"form-control\\\">\\n\t\t\t\t\t\t\t\t\t\t\t\t{{#each options this}}\\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\\\"{{value}}\\\">{{label}}</option>\\n\t\t\t\t\t\t\t\t\t\t\t\t{{/each}}\\n\t\t\t\t\t\t\t\t\t\t\t</select>\\n\t\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t\t{{else}}\\n\t\t\t\t\t\t\t\t\t\t{{#if equals type 'radio'}}\\n\t\t\t\t\t\t\t\t\t\t\t<div class=\\\"form-group\\\">\\n\t\t\t\t\t\t\t\t\t\t\t\t<label for=\\\"7ZQnDsXBGohZMetA5\\\" class=\\\"control-label\\\">{{getLabel code}}</label>\\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\\\"af-radio-group\\\" data-schema-key=\\\"{{getLabel code}}\\\">\\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{#each options this}}\\n        \t\t\t\t\t\t\t\t\t\t\t\t<label class=\\\"radio-inline fix-indent\\\"><input type=\\\"radio\\\" value=\\\"{{value}}\\\" name=\\\"{{../code}}\\\" class=\\\"radio-inline fix-indent\\\"> {{label}}</label>\\n    \t\t\t\t\t\t\t\t\t\t\t\t\t{{/each}}\\n    \t\t\t\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t\t\t{{else}}\\n\t\t\t\t\t\t\t\t\t\t\t{{#if equals type 'multiSelect'}}\\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\\\"form-group\\\">\\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\\\"7ZQnDsXBGohZMetA5\\\" class=\\\"control-label\\\">{{getLabel code}}</label>\\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\\\"af-checkbox-group\\\" data-schema-key=\\\"{{getLabel code}}\\\">\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{#each options this}}\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label class=\\\"checkbox-inline fix-indent\\\"><input type=\\\"checkbox\\\" value=\\\"{{value}}\\\" name=\\\"{{../code}}\\\" class=\\\"checkbox-inline fix-indent\\\"> {{label}}</label>\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{/each}}\\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t\t\t\t{{else}}\\n\t\t\t\t\t\t\t\t\t\t\t\t{{#if equals type 'url'}}\\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\\\"form-group\\\">\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\\\"7ZQnDsXBGohZMetA5\\\" class=\\\"control-label\\\">{{getLabel code}}</label>\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\\\"url\\\" title=\\\"{{getLabel code}}\\\" name=\\\"{{code}}\\\" data-schema-key=\\\"{{getLabel code}}\\\" class=\\\"form-control\\\">\\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t\t\t\t\t{{else}}\\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{#if equals type 'email'}}\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\\\"form-group\\\">\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\\\"7ZQnDsXBGohZMetA5\\\" class=\\\"control-label\\\">{{getLabel code}}</label>\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\\\"email\\\" title=\\\"{{getLabel code}}\\\" name=\\\"{{code}}\\\" data-schema-key=\\\"{{getLabel code}}\\\" class=\\\"form-control\\\">\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{else}}\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{#if equals type 'checkbox'}}\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\\\"form-group\\\">\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\\\"7ZQnDsXBGohZMetA5\\\" class=\\\"control-label\\\">{{getLabel code}}</label>\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\\\"checkbox\\\" data-schema-key=\\\"{{getLabel code}}\\\">\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label style=\\\"width: 100%;\\\"><input type=\\\"checkbox\\\" value=\\\"true\\\" name=\\\"{{code}}\\\" class=\\\"checkbox-inline fix-indent\\\"></label>\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{else}}\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\\\"form-group\\\">\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\\\"7ZQnDsXBGohZMetA5\\\" class=\\\"control-label\\\">{{getLabel code}}</label>\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class='{{getCfClass this}} form-control' readonly disabled>{{{getValue code}}}</div>\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{/if}}\\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{/if}}\\n\t\t\t\t\t\t\t\t\t\t\t\t{{/if}}\\n\t\t\t\t\t\t\t\t\t\t\t{{/if}}\\n\t\t\t\t\t\t\t\t\t\t{{/if}}\\n\t\t\t\t\t\t\t\t\t{{/if}}\\n\t\t\t\t\t\t\t\t{{/if}}\\n\t\t\t\t\t\t\t{{/if}}\\n\t\t\t\t\t\t{{/if}}\\n\t\t\t\t\t{{/if}}\\n\t\t\t\t{{/if}}\\n\t\t\t{{/if}}\\n\t\t{{/if}}\\n\t{{/with}}\";\n\nInstanceReadOnlyTemplate.create = function(tempalteName, steedosData) {\n  var template, templateCompiled, templateRenderFunction;\n  template = InstanceReadOnlyTemplate[tempalteName];\n  templateCompiled = SpacebarsCompiler.compile(template, {\n    isBody: true\n  });\n  templateRenderFunction = eval(templateCompiled);\n  Template[tempalteName] = new Blaze.Template(tempalteName, templateRenderFunction);\n  Template[tempalteName].steedosData = steedosData;\n  return Template[tempalteName].helpers(InstanceformTemplate.helpers);\n};\n\nInstanceReadOnlyTemplate.createInstanceSignText = function(steedosData) {\n  var instanceSignTextCompiled, instanceSignTextHtml, instanceSignTextRenderFunction;\n  instanceSignTextHtml = _getViewHtml('client/views/instance/instance_sign_text.html');\n  instanceSignTextCompiled = SpacebarsCompiler.compile(instanceSignTextHtml, {\n    isBody: true\n  });\n  instanceSignTextRenderFunction = eval(instanceSignTextCompiled);\n  Template.instanceSignText = new Blaze.Template(\"instanceSignText\", instanceSignTextRenderFunction);\n  Template.instanceSignText.steedosData = steedosData;\n  return Template.instanceSignText.helpers(InstanceSignText.helpers);\n};\n\nInstanceReadOnlyTemplate.createImageSign = function(steedosData) {\n  var imageSignCompiled, imageSignHtml, imageSignRenderFunction;\n  imageSignHtml = _getViewHtml('client/views/instance/image_sign.html');\n  imageSignCompiled = SpacebarsCompiler.compile(imageSignHtml, {\n    isBody: true\n  });\n  imageSignRenderFunction = eval(imageSignCompiled);\n  Template.imageSign = new Blaze.Template(\"imageSign\", imageSignRenderFunction);\n  Template.imageSign.steedosData = steedosData;\n  return Template.imageSign.helpers(ImageSign.helpers);\n};\n\nInstanceReadOnlyTemplate.createTracesHanlder = function(steedosData) {\n  var tracesHanlderCompiled, tracesHanlderHtml, tracesHanlderRenderFunction;\n  tracesHanlderHtml = _getViewHtml('client/views/instance/traces_handler.html');\n  tracesHanlderCompiled = SpacebarsCompiler.compile(tracesHanlderHtml, {\n    isBody: true\n  });\n  tracesHanlderRenderFunction = eval(tracesHanlderCompiled);\n  Template.instance_traces_handler = new Blaze.Template(\"instance_traces_handler\", tracesHanlderRenderFunction);\n  Template.instance_traces_handler.steedosData = steedosData;\n  return Template.instance_traces_handler.helpers(TracesHandler.helpers);\n};\n\nInstanceReadOnlyTemplate.init = function(steedosData) {\n  InstanceReadOnlyTemplate.create(\"afSelectUserRead\", steedosData);\n  if (Meteor.isServer) {\n    InstanceReadOnlyTemplate.create(\"afFormGroup\", steedosData);\n  }\n  InstanceReadOnlyTemplate.create(\"afFormGroupRead\", steedosData);\n  if (Meteor.isServer) {\n    InstanceReadOnlyTemplate.create(\"instance_attachment\", {\n      absolute: steedosData.absolute\n    });\n    InstanceReadOnlyTemplate.createImageSign(steedosData);\n    InstanceReadOnlyTemplate.createTracesHanlder(steedosData);\n    return InstanceReadOnlyTemplate.createInstanceSignText(steedosData);\n  }\n};\n\ngetLinkText = function(item, label, detail_url) {\n  if (detail_url) {\n    detail_url = detail_url.replace(\"{_id}\", item._id);\n    if (!/^http(s?):\\/\\//.test(detail_url)) {\n      detail_url = Steedos.absoluteUrl(detail_url);\n    }\n    return '<a href=\"' + detail_url + '\" target=\"_blank\">' + label + '</a>';\n  } else {\n    return label;\n  }\n};\n\nInstanceReadOnlyTemplate.getValue = function(value, field, locale, utcOffset) {\n  var date, detail_url, e, fieldOptions, hours, month, nameField, records, res, seconds, selectedOption, selectedOptions, splitedValues, t, t0, t1, uiSchema, year;\n  if (!value && value !== false) {\n    return '';\n  }\n  if ([\"select\", \"multiSelect\", \"radio\"].indexOf(field.type) > -1) {\n    fieldOptions = field.options.split(\"\\n\").map(function(n) {\n      var itemSplits;\n      itemSplits = n.split(\":\");\n      return {\n        label: itemSplits[0],\n        value: itemSplits[1] || n\n      };\n    });\n  }\n  switch (field.type) {\n    case 'email':\n      value = value ? '<a href=\\'mailto:' + value + '\\'>' + value + '</a>' : '';\n      break;\n    case 'url':\n      if (value) {\n        if (value.indexOf(\"http\") === 0) {\n          try {\n            value = \"<a href='\" + encodeURI(value) + \"' target='_blank'>\" + value + \"</a>\";\n          } catch (error) {\n            e = error;\n            value = \"<a href='' target='_blank'>\" + value + \"</a>\";\n          }\n        } else {\n          value = \"<a href='http://\" + encodeURI(value) + \"' target='_blank'>\" + value + \"</a>\";\n        }\n      } else {\n        value = '';\n      }\n      break;\n    case 'group':\n      if (field.is_multiselect) {\n        value = value != null ? value.getProperty(\"fullname\").toString() : void 0;\n      } else {\n        value = value != null ? value.fullname : void 0;\n      }\n      break;\n    case 'user':\n      if (field.is_multiselect) {\n        value = value != null ? value.getProperty(\"name\").toString() : void 0;\n      } else {\n        value = value != null ? value.name : void 0;\n      }\n      break;\n    case 'password':\n      value = '******';\n      break;\n    case 'checkbox':\n      if (value && value !== 'false') {\n        value = TAPi18n.__(\"form_field_checkbox_yes\", {}, locale);\n      } else {\n        value = TAPi18n.__(\"form_field_checkbox_no\", {}, locale);\n      }\n      break;\n    case 'dateTime':\n      if (value && value.length === 16) {\n        t = value.split(\"T\");\n        t0 = t[0].split(\"-\");\n        t1 = t[1].split(\":\");\n        year = t0[0];\n        month = t0[1];\n        date = t0[2];\n        hours = t1[0];\n        seconds = t1[1];\n        value = new Date(year, month - 1, date, hours, seconds);\n      } else {\n        value = new Date(value);\n      }\n      value = InstanceReadOnlyTemplate.formatDate(value, utcOffset);\n      break;\n    case 'input':\n      if (field.is_textarea) {\n        if (Meteor.isServer) {\n          marked = Npm.require('marked');\n        }\n        value = Spacebars.SafeString(marked.parse(value));\n      }\n      break;\n    case 'select':\n      selectedOption = fieldOptions.find(function(item) {\n        return item.value === value;\n      });\n      if (selectedOption) {\n        value = selectedOption.label;\n      }\n      break;\n    case 'radio':\n      selectedOption = fieldOptions.find(function(item) {\n        return item.value === value;\n      });\n      if (selectedOption) {\n        value = selectedOption.label;\n      }\n      break;\n    case 'multiSelect':\n      splitedValues = value.split(\",\");\n      selectedOptions = fieldOptions.filter(function(item) {\n        return splitedValues.indexOf(item.value) > -1;\n      });\n      if (selectedOptions.length) {\n        value = selectedOptions.map(function(item) {\n          return item.label;\n        }).join(\",\");\n      }\n      break;\n    case 'number':\n      if (value || value === 0) {\n        if (field.is_percent) {\n          value = Steedos.numberToPercentString(value, field.digits);\n        } else {\n          value = Steedos.numberToString(value, field.digits);\n        }\n      }\n      break;\n    case 'odata':\n      detail_url = field.detail_url;\n      if (field.is_multiselect) {\n        value = _.map(value, function(item) {\n          return getLinkText(item, item['@label'], detail_url);\n        });\n      } else {\n        value = getLinkText(value, value['@label'], detail_url);\n      }\n      break;\n    case 'image':\n      if (field.is_multiselect) {\n        value = _.map(value, function(item) {\n          return '<div class=\"antd-ImageControl-item is-uploaded\"> <div class=\"antd-Image antd-Image--thumb antd-ImageControl-image\"> <div class=\"antd-Image-thumbWrap\"> <div class=\"antd-Image-thumb\"><img class=\"antd-Image-image\" src=\"/api/files/images/' + item + '\"></div> </div> </div> </div>';\n        });\n        value = value.join(\"\");\n      } else {\n        value = '<div class=\"antd-ImageControl-item is-uploaded\"> <div class=\"antd-Image antd-Image--thumb antd-ImageControl-image\"> <div class=\"antd-Image-thumbWrap\"> <div class=\"antd-Image-thumb\"><img class=\"antd-Image-image\" src=\"/api/files/images/' + value + '\"></div> </div> </div> </div>';\n      }\n      break;\n    case 'file':\n      if (value) {\n        if (!field.is_multiselect) {\n          value = [value];\n        }\n        if (Meteor.isClient) {\n          res = Steedos.authRequest('/api/v1/cfs_files_filerecord?filters=[[\"_id\",\"in\", ' + JSON.stringify(value) + ']]&fields=[\"_id\",\"original\"]', {\n            async: false\n          });\n          records = res.data.items;\n        } else if (Meteor.isServer) {\n          records = Steedos.objectFind(\"cfs_files_filerecord\", {\n            filters: [[\"_id\", 'in', value]],\n            fields: [\"_id\", \"original\"]\n          });\n        }\n        value = _.map(records, function(item) {\n          return \"<a href='\" + (Steedos.absoluteUrl('/api/files/files/' + item._id + '?download=true')) + \"' target='_blank' style='display: block;'>\" + item.original.name + \"</a>\";\n        });\n        value = value.join(\"\");\n      }\n      break;\n    case 'lookup':\n      if (value) {\n        if (!field.is_multiselect) {\n          value = [value];\n        }\n        if (Meteor.isClient) {\n          uiSchema = Creator.getObject(field.reference_to);\n          nameField = (uiSchema != null ? uiSchema.NAME_FIELD_KEY : void 0) || 'name';\n          res = Steedos.authRequest('/api/v1/' + field.reference_to + '?filters=[[\"' + (field.reference_to_field || '_id') + '\",\"in\", ' + JSON.stringify(value) + ']]&fields=[\"_id\",\"' + nameField + '\"]', {\n            async: false\n          });\n          records = res.data.items;\n        } else if (Meteor.isServer) {\n          nameField = Steedos.getObjectNameFieldKey(field.reference_to);\n          records = Steedos.objectFind(field.reference_to, {\n            filters: [[field.reference_to_field || '_id', 'in', value]],\n            fields: [\"_id\", nameField]\n          });\n        }\n        value = _.map(records, function(item) {\n          return \"<a href='\" + (Steedos.absoluteUrl('/app/-/' + field.reference_to + '/view/' + item._id)) + \"' target='_blank'>\" + item[nameField] + \"</a>\";\n        });\n        value = value.join(\"\");\n      }\n      break;\n    case 'html':\n      value = value ? \"<div class=\\\"steedos-html\\\">\" + value + \"</div>\" : '';\n  }\n  return value;\n};\n\nInstanceReadOnlyTemplate.getLabel = function(fields, code) {\n  var field;\n  field = fields.findPropertyByPK(\"code\", code);\n  if (field) {\n    if (field.name) {\n      return field.name;\n    } else {\n      return field.code;\n    }\n  }\n};\n\nInstanceReadOnlyTemplate.getInstanceFormVersion = function(instance) {\n  var form, form_fields, form_version;\n  form = db.forms.findOne(instance.form);\n  form_version = {};\n  form_fields = [];\n  if (form.current._id === instance.form_version) {\n    form_version = form.current;\n  } else {\n    form_version = _.where(form.historys, {\n      _id: instance.form_version\n    })[0];\n  }\n  form_version.fields.forEach(function(field) {\n    if (field.type === 'section') {\n      form_fields.push(field);\n      if (field.fields) {\n        return field.fields.forEach(function(f) {\n          return form_fields.push(f);\n        });\n      }\n    } else if (field.type === 'table') {\n      field['sfields'] = field['fields'];\n      delete field['fields'];\n      return form_fields.push(field);\n    } else {\n      return form_fields.push(field);\n    }\n  });\n  form_version.fields = form_fields;\n  return form_version;\n};\n\nInstanceReadOnlyTemplate.getFlowVersion = function(instance) {\n  var flow, flow_version;\n  flow = db.flows.findOne(instance.flow);\n  flow_version = {};\n  if (flow.current._id === instance.flow_version) {\n    flow_version = flow.current;\n  } else {\n    flow_version = _.where(flow.historys, {\n      _id: instance.flow_version\n    })[0];\n  }\n  return flow_version;\n};\n\n_getViewHtml = function(path) {\n  var viewHtml;\n  viewHtml = Assets.getText(path);\n  if (viewHtml) {\n    viewHtml = viewHtml.replace(/<template[\\w\\s\\\"\\=']+>/i, \"\").replace(/<\\/template>/i, \"\");\n  }\n  return viewHtml;\n};\n\n_getLocale = function(user) {\n  var locale, ref, ref1;\n  if ((user != null ? (ref = user.locale) != null ? ref.toLocaleLowerCase() : void 0 : void 0) === 'zh-cn') {\n    locale = \"zh-CN\";\n  } else if ((user != null ? (ref1 = user.locale) != null ? ref1.toLocaleLowerCase() : void 0 : void 0) === 'en-us') {\n    locale = \"en\";\n  } else {\n    locale = \"zh-CN\";\n  }\n  return locale;\n};\n\n_getRequiredFields = function(fields, rev) {\n  if (!rev) {\n    rev = [];\n  }\n  fields.forEach(function(field) {\n    if (field.type === 'section') {\n      return _getRequiredFields(field.fields, rev);\n    } else if (field.type === 'table') {\n\n    } else {\n      if (field.is_required) {\n        return rev.push(field.code);\n      }\n    }\n  });\n  return rev;\n};\n\n_getStartStepEditableFields = function(fields, steps) {\n  var editableCode, startStep;\n  startStep = steps.findPropertyByPK(\"step_type\", \"start\");\n  editableCode = [];\n  _.keys(startStep.permissions).forEach(function(key) {\n    if (startStep.permissions[key] === 'editable') {\n      return editableCode.push(key);\n    }\n  });\n  return editableCode;\n};\n\n_getStartStepRequiredFields = function(fields, steps) {\n  var editableCode, requiredFields;\n  requiredFields = _getRequiredFields(fields);\n  editableCode = _getStartStepEditableFields(fields, steps);\n  return _.intersection(requiredFields, editableCode);\n};\n\n_getTemplateData = function(user, space, instance, options) {\n  var flow, form, form_version, locale, steedosData;\n  if (Meteor.isServer) {\n    form_version = InstanceReadOnlyTemplate.getInstanceFormVersion(instance);\n  } else {\n    form_version = WorkflowManager.getInstanceFormVersion(instance);\n  }\n  locale = _getLocale(user);\n  steedosData = {};\n  if (Meteor.isClient) {\n    steedosData = _.clone(WorkflowManager_format.getAutoformSchemaValues());\n    steedosData.insname = instance.name;\n    steedosData.ins_state = instance.state;\n    steedosData.ins_final_decision = instance.ins_final_decision;\n    steedosData.ins_code = instance.code;\n    steedosData.ins_is_archived = instance.is_archived;\n    steedosData.ins_is_deleted = instance.ins_is_deleted;\n    steedosData.applicant_name = instance.applicant_name;\n    steedosData.applicantContext = instance.applicant_name;\n  }\n  steedosData.instance = instance;\n  steedosData.form_version = form_version;\n  steedosData.locale = locale;\n  steedosData.utcOffset = user.utcOffset;\n  steedosData.space = instance.space;\n  steedosData.sessionUserId = user._id;\n  if (Meteor.isServer) {\n    if (options != null ? options.editable : void 0) {\n      form = db.forms.findOne({\n        _id: instance.form\n      });\n      flow = db.flows.findOne({\n        _id: instance.flow\n      });\n      steedosData.startStepEditableFields = _getStartStepEditableFields(form.current.fields, flow.current.steps);\n    }\n  }\n  return steedosData;\n};\n\nInstanceReadOnlyTemplate.formatDate = function(date, utcOffset) {\n  var passing;\n  if (Meteor.isServer) {\n    passing = false;\n  } else {\n    passing = true;\n  }\n  if (!utcOffset && utcOffset !== 0) {\n    utcOffset = 8;\n  }\n  return moment(date).utcOffset(utcOffset, passing).format(\"YYYY-MM-DD HH:mm\");\n};\n\nInstanceReadOnlyTemplate.getInstanceView = function(user, space, instance, options) {\n  var body, instanceCompiled, instanceRenderFunction, instanceTemplate, steedosData;\n  steedosData = _getTemplateData(user, space, instance, options);\n  steedosData.absolute = false;\n  if (options != null ? options.absolute : void 0) {\n    steedosData.absolute = true;\n  }\n  instanceTemplate = TemplateManager.getTemplate(instance, options != null ? options.templateName : void 0);\n  instanceTemplate = instanceTemplate.replace(/afSelectUser/g, \"afSelectUserRead\");\n  if (!(options != null ? options.editable : void 0)) {\n    instanceTemplate = instanceTemplate.replace(/afFormGroup/g, \"afFormGroupRead\");\n  }\n  instanceCompiled = SpacebarsCompiler.compile(instanceTemplate, {\n    isBody: true\n  });\n  instanceRenderFunction = eval(instanceCompiled);\n  Template.instance_readonly_view = new Blaze.Template(\"instance_readonly_view\", instanceRenderFunction);\n  Template.instance_readonly_view.steedosData = steedosData;\n  Template.instance_readonly_view.helpers(InstanceformTemplate.helpers);\n  InstanceReadOnlyTemplate.init(steedosData);\n  body = Blaze.toHTMLWithData(Template.instance_readonly_view, steedosData);\n  return \"<div id='instanceform' >\\n\t\" + body + \"\\n</div>\";\n};\n\nInstanceReadOnlyTemplate.getTracesView = function(user, space, instance, options) {\n  var body, form, steedosData, traceCompiled, traceRenderFunction, tracesHtml;\n  steedosData = _getTemplateData(user, space, instance);\n  form = db.forms.findOne(instance.form);\n  if (form.instance_style === \"table\" || (options != null ? options.templateName : void 0) === \"table\") {\n    tracesHtml = _getViewHtml('client/views/instance/traces_table.html');\n  } else {\n    tracesHtml = _getViewHtml('client/views/instance/traces.html');\n  }\n  traceCompiled = SpacebarsCompiler.compile(tracesHtml, {\n    isBody: true\n  });\n  traceRenderFunction = eval(traceCompiled);\n  Template.trace_readonly_view = new Blaze.Template(\"trace_readonly_view\", traceRenderFunction);\n  Template.trace_readonly_view.steedosData = steedosData;\n  Template.trace_readonly_view.helpers(TracesTemplate.helpers);\n  body = Blaze.toHTMLWithData(Template.trace_readonly_view, instance.traces);\n  return body;\n};\n\nInstanceReadOnlyTemplate.getAttachmentView = function(user, space, instance) {\n  var attachmentCompiled, attachmentHtml, attachmentRenderFunction, body, steedosData;\n  steedosData = _getTemplateData(user, space, instance);\n  attachmentHtml = _getViewHtml('client/views/instance/instance_attachments.html');\n  attachmentCompiled = SpacebarsCompiler.compile(attachmentHtml, {\n    isBody: true\n  });\n  attachmentRenderFunction = eval(attachmentCompiled);\n  Template.attachments_readonly_view = new Blaze.Template(\"attachments_readonly_view\", attachmentRenderFunction);\n  Template.attachments_readonly_view.steedosData = steedosData;\n  Template.attachments_readonly_view.helpers(InstanceAttachmentTemplate.helpers);\n  body = Blaze.toHTMLWithData(Template.attachments_readonly_view);\n  return body;\n};\n\nInstanceReadOnlyTemplate.getRelatedInstancesView = function(user, space, instance, options) {\n  var body, relatedInstancesCompiled, relatedInstancesHtml, relatedInstancesRenderFunction, steedosData;\n  steedosData = _getTemplateData(user, space, instance);\n  steedosData.absolute = false;\n  if (options != null ? options.absolute : void 0) {\n    steedosData.absolute = true;\n  }\n  relatedInstancesHtml = _getViewHtml('client/views/instance/related_instances.html');\n  relatedInstancesCompiled = SpacebarsCompiler.compile(relatedInstancesHtml, {\n    isBody: true\n  });\n  relatedInstancesRenderFunction = eval(relatedInstancesCompiled);\n  Template.related_instances_view = new Blaze.Template(\"related_instances_view\", relatedInstancesRenderFunction);\n  Template.related_instances_view.steedosData = steedosData;\n  Template.related_instances_view.helpers(RelatedInstances.helpers);\n  body = Blaze.toHTMLWithData(Template.related_instances_view, steedosData);\n  return body;\n};\n\nInstanceReadOnlyTemplate.getRelatedRecordsView = function(user, space, instance, options) {\n  var body, relatedRecordsCompiled, relatedRecordsHtml, relatedRecordsRenderFunction, steedosData;\n  steedosData = _getTemplateData(user, space, instance);\n  steedosData.absolute = false;\n  if (options != null ? options.absolute : void 0) {\n    steedosData.absolute = true;\n  }\n  relatedRecordsHtml = _getViewHtml('client/views/instance/related_records.html');\n  relatedRecordsCompiled = SpacebarsCompiler.compile(relatedRecordsHtml, {\n    isBody: true\n  });\n  relatedRecordsRenderFunction = eval(relatedRecordsCompiled);\n  Template.related_records_view = new Blaze.Template(\"related_records_view\", relatedRecordsRenderFunction);\n  Template.related_records_view.steedosData = steedosData;\n  Template.related_records_view.helpers(RelatedRecords.helpers);\n  body = Blaze.toHTMLWithData(Template.related_records_view, steedosData);\n  return body;\n};\n\nInstanceReadOnlyTemplate.getOnLoadScript = function(instance) {\n  var form_script, form_version;\n  form_version = WorkflowManager.getFormVersion(instance.form, instance.form_version);\n  form_script = form_version.form_script;\n  if (form_script && form_script.replace(/\\n/g, \"\").replace(/\\s/g, \"\").length > 0) {\n    form_script = \"CoreForm = {};CoreForm.instanceform = {};\" + form_script;\n    return form_script += \";if(CoreForm.form_OnLoad){window.onload = CoreForm.form_OnLoad();}\";\n  } else {\n    return form_script = \"\";\n  }\n};\n\nInstanceReadOnlyTemplate.getInstanceHtml = function(user, space, instance, options) {\n  var allCssLink, attachment, body, creatorService, cssHref, form, formDescription, formDescriptionHtml, html, ins_record_ids, instanceBoxStyle, instance_style, jqHref, locale, onLoadScript, openFileScript, ref, ref1, related_instances, related_records, showTracesBtn, showTracesScript, trace, traceCheck, width;\n  body = InstanceReadOnlyTemplate.getInstanceView(user, space, instance, options);\n  onLoadScript = InstanceReadOnlyTemplate.getOnLoadScript(instance);\n  creatorService = (ref = Meteor.settings[\"public\"].webservices) != null ? (ref1 = ref.creator) != null ? ref1.url : void 0 : void 0;\n  ins_record_ids = instance.record_ids;\n  locale = _getLocale(user);\n  openFileScript = \"if(window.isNode && isNode()){\\n\tattachs = document.getElementsByClassName(\\\"ins_attach_href\\\");\\n\tfor(var i = 0; i < attachs.length; i++){\\n\t\tattach = attachs[i];\\n\t\tattach.addEventListener(\\\"click\\\", function(e){\\n\t\t\tif(isImage(this.dataset.type) || isHtml(this.dataset.type)){\\n\t\t\t\te.preventDefault();\\n\t\t\t\topenWindow(\\\"/api/files/instances/\\\" + this.dataset.id);\\n\t\t\t}else if(nw_core.canOpenFile(this.dataset.name)){\\n\t\t\t\te.preventDefault();\\n\t\t\t\tnw_core.openFile(this.href, this.dataset.name)\\n\t\t\t}\\n\t\t});\\n\t}\\n}\\n\\nvar flow = \\\"\" + instance.flow + \"\\\";\\nvar space = \\\"\" + instance.space + \"\\\";\\n\\nfunction getCookie(name){\\n\tlet pattern = RegExp(name + \\\"=.[^;]*\\\")\\n\tlet matched = document.cookie.match(pattern)\\n\tif(matched){\\n\t\tlet cookie = matched[0].split('=')\\n\t\treturn cookie[1]\\n\t}\\n\treturn ''\\n}\\n\\nvar records = document.getElementsByClassName(\\\"ins-related-records\\\");\\nfor(var i = 0; i < records.length; i++){\\n\t\tvar record = records[i];\\n\t\trecord.addEventListener(\\\"click\\\", function(e){\\n\t\t\tvar creatorService = \\\"\" + creatorService + \"\\\"\\n\t\t\tvar ins_record_ids = \" + (JSON.stringify(ins_record_ids)) + \"\\n\t\t\tif(creatorService && ins_record_ids && ins_record_ids.length > 0){\\n\t\t\t\tvar objcetName = ins_record_ids[0].o\\n\t\t\t\tvar id = ins_record_ids[0].ids[0]\\n\t\t\t\tvar uobj = {};\\n\t\t\t\tuobj[\\\"X-User-Id\\\"] = getCookie(\\\"X-User-Id\\\");\\n\t\t\t\tuobj[\\\"X-Auth-Token\\\"] = getCookie(\\\"X-Auth-Token\\\");\\n\t\t\t\tredirectUrl = creatorService + \\\"app/-/\\\" + objcetName + \\\"/view/\\\" + id + \\\"?\\\" + $.param(uobj);\\n\t\t\t\topenWindow(redirectUrl);\\n\t\t\t}\\n\t\t});\\n\t}\\n\";\n  if (!Steedos.isMobile()) {\n    form = db.forms.findOne(instance.form);\n    if ((form != null ? form.instance_style : void 0) === 'table') {\n      instance_style = \"instance-table\";\n    }\n  }\n  if ((options != null ? options.templateName : void 0) === 'table') {\n    instance_style = \"instance-table\";\n  }\n  if (options != null ? options.instance_style : void 0) {\n    instance_style = options.instance_style;\n  }\n  if (!options || options.showTrace === true) {\n    trace = InstanceReadOnlyTemplate.getTracesView(user, space, instance);\n  } else {\n    trace = \"\";\n  }\n  instanceBoxStyle = \"\";\n  if (instance && instance.final_decision) {\n    if (instance.final_decision === \"approved\") {\n      instanceBoxStyle = \"box-success\";\n    } else if (instance.final_decision === \"rejected\") {\n      instanceBoxStyle = \"box-danger\";\n    }\n  }\n  if (!options || options.showAttachments === true) {\n    attachment = InstanceReadOnlyTemplate.getAttachmentView(user, space, instance);\n    related_instances = InstanceReadOnlyTemplate.getRelatedInstancesView(user, space, instance, options);\n    related_records = InstanceReadOnlyTemplate.getRelatedRecordsView(user, space, instance, options);\n  } else {\n    attachment = \"\";\n    related_instances = \"\";\n    related_records = \"\";\n  }\n  width = \"960px\";\n  if (options != null ? options.width : void 0) {\n    width = \"\";\n  }\n  cssHref = Meteor.absoluteUrl(\"steedos-css\");\n  jqHref = Meteor.absoluteUrl(\"website/libs/jquery.min.js\");\n  allCssLink = \"<link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" class=\\\"__meteor-css__\\\" href=\\\"\" + cssHref + \"\\\">\";\n  traceCheck = \"\";\n  if (!_.isEmpty(trace)) {\n    traceCheck = \"checked\";\n  }\n  if ((options != null ? options.tagger : void 0) === 'email' || (options != null ? options.editable : void 0)) {\n    showTracesBtn = \"\";\n  } else {\n    showTracesBtn = \"<div class=\\\"navigation-bar btn-group no-print\\\" style=\\\"min-width: 600px; z-index: 999; box-sizing: border-box;\\\">\\n\t<div class=\\\"print-tool\\\">\\n\t\t<label class=\\\"cbx-label\\\"><input type=\\\"checkbox\\\" class=\\\"cbx-print cbx-print-attachments\\\" id=\\\"cbx-print-attachments\\\" checked=\\\"checked\\\"><span>\" + (TAPi18n.__('instance_attachment', {}, locale)) + \"</span></label>\\n\t\t<label class=\\\"cbx-label\\\"><input type=\\\"checkbox\\\" class=\\\"cbx-print cbx-print-traces\\\" id=\\\"cbx-print-traces\\\" checked=\\\"\" + traceCheck + \"\\\"><span>\" + (TAPi18n.__('instance_approval_history', {}, locale)) + \"</span></label>\\n\t</div>\\n</div>\";\n  }\n  showTracesScript = \"$( document ).ready(function(){\\n\tvar b = document.getElementById('cbx-print-traces');\\n\tvar t = document.getElementsByClassName('instance-traces')[0];\\n\tif (b && b.checked && t){\\n\t\tt.style = 'display: block;'\\n\t} else if(t){\\n\t\tt.style = 'display: none;'\\n\t}\\n\tif(b){\\n\t\tb.addEventListener('change', function(e){\\n\t\t\tif (e.target.checked){\\n\t\t\t\tt.style = 'display: block;'\\n\t\t\t} else {\\n\t\t\t\tt.style = 'display: none;'\\n\t\t\t}\\n\t\t});\\n\t}\\n\\n\\n\tvar attachmentsCheckbox = document.getElementById('cbx-print-attachments');\\n\tvar attachmentsView = document.getElementsByClassName('attachments-section')[0];\\n\tif (attachmentsCheckbox && attachmentsCheckbox.checked && attachmentsView){\\n\t\tattachmentsView.style = 'display: block;'\\n\t} else if(attachmentsView){\\n\t\tattachmentsView.style = 'display: none;'\\n\t}\\n\tif(attachmentsCheckbox){\\n\t\tattachmentsCheckbox.addEventListener('change', function(e){\\n\t\t\tif (e.target.checked){\\n\t\t\t\tattachmentsView.style = 'display: block;'\\n\t\t\t} else {\\n\t\t\t\tattachmentsView.style = 'display: none;'\\n\t\t\t}\\n\t\t});\\n\t}\\n});\\n\";\n  if (options != null ? options.styles : void 0) {\n    allCssLink = \"\";\n  }\n  form = db.forms.findOne({\n    _id: instance.form\n  });\n  formDescriptionHtml = \"\";\n  if (form) {\n    formDescription = form.description;\n    if (formDescription) {\n      formDescription = formDescription.replace(/\\n/g, \"<br/>\");\n      formDescriptionHtml = \"<div class=\\\"box-header  with-border instance-header\\\">\\n\t<div>\\n\t\t\" + formDescription + \"\\n\t</div>\\n</div>\";\n    }\n  }\n  html = \"<!DOCTYPE html>\\n<html>\\n\t<head>\\n\t\t<meta http-equiv=\\\"Content-Type\\\" content=\\\"text/html; charset=UTF-8\\\"/>\\n\t\t\" + allCssLink + \"\\n\t\t<script src=\\\"\" + jqHref + \"\\\" type=\\\"text/javascript\\\"></script>\\n\t\t<script src=\\\"/js/nw_core.js\\\" type=\\\"text/javascript\\\"></script>\\n\t\t\" + (options.plugins || \"\") + \"\\n\\n\t\t<style>\\n\t\t\t.steedos{\\n\t\t\t\twidth: \" + width + \";\\n\t\t\t\tmargin-left: auto;\\n\t\t\t\tmargin-right: auto;\\n\t\t\t}\\n\\n\t\t\t.instance-view .instance-name{\\n\t\t\t\tdisplay: inline !important\\n\t\t\t}\\n\t\t\t.box-tools{\\n\t\t\t\tdisplay: none;\\n\t\t\t}\\n\t\t\t.box.collapsed-box .box-body,.box.collapsed-box .box-footer {\\n\t\t\t  display: block;\\n\t\t\t}\\n\\n\t\t\tbody{\\n\t\t\t\tbackground: azure !important;\\n\t\t\t}\\n\\n\t\t\t.instance-view .instance-traces{\\n\t\t\t\tpadding-left: 15px;\\n\t\t\t\tpadding-right: 15px;\\n\t\t\t}\\n\\n\t\t\t.antd-ImageControl-item {\\n\t\t\tborder-radius: var(--ImageControl-addBtn-borderRadius);\\n\t\t\tvertical-align: top;\\n\t\t\tpadding: var(--gap-xs);\\n\t\t\tdisplay: inline-block;\\n\t\t\tmargin-right: var(--gap-base);\\n\t\t\tmargin-bottom: var(--gap-base);\\n\t\t\tposition: relative;\\n\t\t\twidth: 7.5rem;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-item.is-invalid {\\n\t\t\tpadding: 0;\\n\t\t\tborder-color: var(--FileControl-danger-color);\\n\t\t\t}\\n\t\t\t.antd-ImageControl-item svg.icon-refresh {\\n\t\t\ttransform: rotate(180deg);\\n\t\t\t}\\n\t\t\t.antd-ImageControl-filename {\\n\t\t\tdisplay: inline-flex;\\n\t\t\tflex-direction: column;\\n\t\t\tjustify-content: center;\\n\t\t\talign-items: center;\\n\t\t\tcolor: var(--FileControl-danger-color);\\n\t\t\t}\\n\t\t\t.antd-ImageControl-filename > svg.icon-image {\\n\t\t\tmargin-bottom: 8px;\\n\t\t\twidth: 24px;\\n\t\t\theight: 24px;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-filename > span {\\n\t\t\tmax-width: 100%;\\n\t\t\toverflow: hidden;\\n\t\t\twhite-space: nowrap;\\n\t\t\ttext-overflow: ellipsis;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-image {\\n\t\t\twidth: 100%;\\n\t\t\theight: 100%;\\n\t\t\tpadding: 0;\\n\t\t\tborder: none;\\n\t\t\tdisplay: block;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-itemClear {\\n\t\t\tposition: absolute;\\n\t\t\tcursor: pointer;\\n\t\t\tcolor: #999;\\n\t\t\ttop: 5px;\\n\t\t\tright: 5px;\\n\t\t\tline-height: 1;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-itemClear > svg {\\n\t\t\ttop: 0;\\n\t\t\twidth: 10px;\\n\t\t\theight: 10px;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-itemInfo {\\n\t\t\tdisplay: inline-flex;\\n\t\t\twidth: 110px;\\n\t\t\theight: 110px;\\n\t\t\tjustify-content: center;\\n\t\t\talign-items: center;\\n\t\t\talign-content: center;\\n\t\t\tflex-wrap: wrap;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-itemInfo > p {\\n\t\t\twidth: 100%;\\n\t\t\ttext-align: center;\\n\t\t\tfont-size: 12px;\\n\t\t\tmargin-bottom: 5px;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-progress {\\n\t\t\twidth: 70px;\\n\t\t\theight: 5px;\\n\t\t\tbackground: #ebebeb;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-progressValue {\\n\t\t\theight: 5px;\\n\t\t\tborder-radius: var(--ImageControl-progress-borderRadius);\\n\t\t\tdisplay: block;\\n\t\t\tbackground: var(--info);\\n\t\t\tmin-width: 10%;\\n\t\t\ttransition: ease-out width var(--animation-duration);\\n\t\t\t}\\n\t\t\t.antd-ImageControl-item.is-invalid .antd-ImageControl-itemClear {\\n\t\t\tdisplay: none;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-item.is-invalid:hover .antd-ImageControl-itemClear {\\n\t\t\tdisplay: block;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-errorMsg {\\n\t\t\tcolor: var(--danger);\\n\t\t\tmargin: 5px 0 0;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-uploadBtn {\\n\t\t\tmargin-top: 5px;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-cropperWrapper {\\n\t\t\tposition: relative;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-cropperWrapper img {\\n\t\t\tmax-width: 100%;\\n\t\t\tmax-height: 400px;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-croperToolbar {\\n\t\t\tdisplay: inline-flex;\\n\t\t\tposition: absolute;\\n\t\t\tright: 0;\\n\t\t\tbottom: 0;\\n\t\t\tflex-direction: column;\\n\t\t\talign-items: flex-end;\\n\t\t\tbackground: #fff;\\n\t\t\tborder-radius: 4px;\\n\t\t\tmargin: 0.5rem;\\n\t\t\tbox-shadow: 0 0 4px 0 rgba(0, 0, 0, 0.1);\\n\t\t\t}\\n\t\t\t.antd-ImageControl-croperToolbar > a {\\n\t\t\tcolor: var(--Form-item-fontColor);\\n\t\t\tpadding: 2px 5px;\\n\t\t\tcursor: pointer;\\n\t\t\tfont-size: 18px;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-croperToolbar > a:hover {\\n\t\t\tcolor: var(--link-color);\\n\t\t\t}\\n\t\t\t.antd-ImageControl-acceptTip {\\n\t\t\theight: 120px;\\n\t\t\tcolor: #999;\\n\t\t\tborder: 2px dashed var(--borderColor);\\n\t\t\tborder-color: var(--info);\\n\t\t\tbackground: #f3f9fe;\\n\t\t\tborder-radius: var(--borderRadius);\\n\t\t\tline-height: 120px;\\n\t\t\ttext-align: center;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-fixed-size {\\n\t\t\twidth: 100%;\\n\t\t\theight: 100%;\\n\t\t\tpadding: 0;\\n\t\t\t}\\n\t\t\t.antd-ImageControl-fixed-size .antd-ImageControl-itemOverlay {\\n\t\t\twidth: 100%;\\n\t\t\theight: 100%;\\n\t\t\t}\\n\\n\t\t\t.antd-Images {\\n\t\t\t\tdisplay: flex;\\n\t\t\t\tflex-wrap: wrap;\\n\t\t\t\tmargin: calc(var(--gap-xs) * -1);\\n\t\t\t\t}\\n\t\t\t\t.antd-Images-item {\\n\t\t\t\tdisplay: flex;\\n\t\t\t\tmargin: var(--gap-xs);\\n\t\t\t\t}\\n\t\t\t\t.antd-Image {\\n\t\t\t\tborder: var(--borderWidth) solid var(--borderColor);\\n\t\t\t\t}\\n\t\t\t\t.antd-Image--thumb {\\n\t\t\t\tdisplay: inline-block;\\n\t\t\t\tpadding: var(--gap-xs);\\n\t\t\t\t}\\n\t\t\t\t.antd-Image-thumbWrap {\\n\t\t\t\tposition: relative;\\n\t\t\t\t}\\n\t\t\t\t.antd-Image-image {\\n\t\t\t\tdisplay: block;\\n\t\t\t\t}\\n\t\t\t\t.antd-Image-image--loading {\\n\t\t\t\tvisibility: hidden;\\n\t\t\t\t}\\n\t\t\t\t.antd-Image--original .antd-Image-image {\\n\t\t\t\tmax-width: 100%;\\n\t\t\t\tmax-height: 100%;\\n\t\t\t\twidth: auto;\\n\t\t\t\tmargin: auto;\\n\t\t\t\t}\\n\t\t\t\t.antd-Image-thumb {\\n\t\t\t\twidth: 6.875rem;\\n\t\t\t\theight: 6.875rem;\\n\t\t\t\tposition: relative;\\n\t\t\t\toverflow: hidden;\\n\t\t\t\t}\\n\t\t\t\t.antd-Image-thumb > img {\\n\t\t\t\tposition: absolute;\\n\t\t\t\tleft: 50%;\\n\t\t\t\ttop: 50%;\\n\t\t\t\tmax-height: 100%;\\n\t\t\t\twidth: auto;\\n\t\t\t\ttransform: translate(-50%, -50%);\\n\t\t\t\t}\\n\t\t\t\t.antd-Image-info {\\n\t\t\t\tpadding: 5px 10px;\\n\t\t\t\t}\\n\t\t\t\t.antd-Image--thumb .antd-Image-info {\\n\t\t\t\twidth: 6.875rem;\\n\t\t\t\tpadding: 0;\\n\t\t\t\t}\\n\t\t\t\t.antd-Image-thumb--4-3 {\\n\t\t\t\theight: 5.15625rem;\\n\t\t\t\t}\\n\t\t\t\t.antd-Image-thumb--16-9 {\\n\t\t\t\theight: 3.8671875rem;\\n\t\t\t\t}\\n\t\t\t\t.antd-Image-thumb--fixed-size {\\n\t\t\t\tmin-width: 6.875rem;\\n\t\t\t\tmin-height: 6.875rem;\\n\t\t\t\twidth: 100%;\\n\t\t\t\tpadding: 0;\\n\t\t\t\theight: 100%;\\n\t\t\t\t}\\n\t\t\t\t.antd-Image-thumb--fixed-size .antd-Image-thumb {\\n\t\t\t\twidth: 100%;\\n\t\t\t\t}\\n\t\t\t\t.antd-Image-thumb--fixed-size .antd-Image-thumb > img {\\n\t\t\t\twidth: auto;\\n\t\t\t\theight: 100%;\\n\t\t\t\t}\\n\t\t\t\t.antd-Image-thumb--w-full > img {\\n\t\t\t\twidth: 100%;\\n\t\t\t\theight: auto;\\n\t\t\t\t}\\n\\n\t\t\t\" + ((options != null ? options.styles : void 0) || \"\") + \"\\n\\n\t\t\t\" + ((options != null ? options.add_styles : void 0) || \"\") + \"\\n\t\t</style>\\n\t</head>\\n\t<body>\\n\t\t<div class=\\\"steedos workflow instance-print\\\">\\n\t\t\t<div class=\\\"skin-green skin-admin-lte\\\">\\n\t\t\t\t<div class=\\\"wrapper\\\">\\n\t\t\t\t\t<div class=\\\"content-wrapper\\\">\\n\t\t\t\t\t\t\" + showTracesBtn + \"\\n\t\t\t\t\t\t<div class=\\\"instance-print\\\">\\n\t\t\t\t\t\t\t<div class=\\\"instance \" + instance_style + \"\\\">\\n\t\t\t\t\t\t\t\t<form name=\\\"instanceForm\\\">\\n\t\t\t\t\t\t\t\t\t<div class=\\\"instance-form box \" + instanceBoxStyle + \"\\\">\\n\t\t\t\t\t\t\t\t\t\t\" + formDescriptionHtml + \"\\n\t\t\t\t\t\t\t\t\t\t<div class=\\\"box-body\\\">\\n\t\t\t\t\t\t\t\t\t\t\t<div class=\\\"col-md-12\\\" style=\\\"box-sizing: border-box;\\\">\\n\t\t\t\t\t\t\t\t\t\t\t\t<div class='attachments-section'>\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\" + attachment + \"\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\" + related_instances + \"\\n\t\t\t\t\t\t\t\t\t\t\t\t\t\" + related_records + \"\\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t\t\t\t\t\" + body + \"\\n\t\t\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t\t</div>\\n\t\t\t\t\t\t\t\t</form>\\n\t\t\t\t\t\t\t\t\" + trace + \"\\n\t\t\t\t\t\t\t</div>\\n\\n\t\t\t\t\t\t</div>\\n\t\t\t\t\t</div>\\n\t\t\t\t</div>\\n\t\t\t</div>\\n\t\t</div>\\n\t</body>\\n\t<script>\" + openFileScript + \";\" + onLoadScript + \";\" + showTracesScript + \"</script>\\n</html>\";\n  return html;\n};\n","TemplateManager = {};\n\nformId = 'instanceform';\n\n\nTemplateManager.instance_title = ()->\n\tpageTitle = \"\"\"\n\t\t{{instance.name}}\n\t\"\"\"\n\n\tpageTitleTrClass = \"instance-name\"\n\n\tif CoreForm?.pageTitleFieldName\n\t\tpageTitle = \"\"\"\n\t\t\t\t{{> afFormGroup name=\"#{CoreForm.pageTitleFieldName}\" label=false}}\n\t\t\"\"\"\n\t\tpageTitleTrClass = \"\"\n\n\tif CoreForm?.pageTitle\n\t\tpageTitle = \"\"\"\n\t\t\t#{CoreForm.pageTitle}\n\t\t\"\"\"\n\t\tpageTitleTrClass = \"\"\n\n\tval =\n\t\tpageTitle: pageTitle\n\t\tpageTitleTrClass: pageTitleTrClass\n\n\treturn val\n\nTemplateManager.handleTableTemplate = (instance, _export) ->\n\n\ttemplate = \"\"\"\n\t<div class='instance-template'>\n\t\t<table class=\"table-page-title form-table no-border text-align-center\" style=\"width: 100%;display: inline-table;\">\n\t\t\t<tr class=\"#{this.instance_title().pageTitleTrClass}\">\n\t\t\t\t<td class=\"instance-table-name-td page-title\">\n\t\t\t\t\t#{this.instance_title().pageTitle}\n\t\t\t\t</td>\n\t\t\t</tr>\n\n\t\t</table>\n\t\t<table class=\"table-page-body form-table\">\n\t\t\t\t<tr style=\"height:0px\">\n\t\t\t\t\t<th style='width: 16%'></th>\n\t\t\t\t\t<th></th>\n\t\t\t\t\t<th style='width: 16%'></th>\n\t\t\t\t\t<th></th>\n\t\t\t\t</tr>\n\t\"\"\";\n\n\ttable_fields = InstanceformTemplate.helpers.table_fields(instance)\n\n\ttable_fields && table_fields.forEach (table_field)->\n\n\t\trequired = \"\"\n\t\tif !CoreForm?.pageTitleFieldName || CoreForm?.pageTitleFieldName != table_field.code\n\t\t\tif table_field.is_required\n\t\t\t\trequired = \"is-required\"\n\n\t\t\tif _export\n\t\t\t\trequired = \"\";\n\n\t\t\tpureCode = Steedos.removeSpecialCharacter(table_field.code);\n\n\t\t\tif InstanceformTemplate.helpers.isOpinionField(table_field)\n\t\t\t\ttemplate += table_field.tr_start\n\t\t\t\ttemplate += \"\"\"\n\t\t\t\t\t<td class=\"td-title #{required}\">\n\t\t\t\t\t\t{{afFieldLabelText name=\"#{table_field.code}\"}}\n\t\t\t\t\t</td>\n\t\t\t\t\t<td class=\"td-field opinion-field opinion-field-#{pureCode} automatic\" colspan = \"#{table_field.td_colspan}\">\n\t\t\t\t\t\t{{> instanceSignText name=\"#{table_field.code}\"}}\n\t\t\t\t\t</td>\n\t\t\t\t\"\"\"\n\t\t\t\ttemplate += table_field.tr_end\n\t\t\telse\n\t\t\t\tif InstanceformTemplate.helpers.includes(table_field.type, 'section,table')\n\t\t\t\t\ttemplate += table_field.tr_start\n\t\t\t\t\ttemplate += \"\"\"\n\t\t\t\t\t\t<td class=\"td-childfield td-childfield-#{pureCode}\" colspan = \"#{table_field.td_colspan}\">\n\t\t\t\t\t\t   {{> afFormGroup name=\"#{table_field.code}\" label=false}}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\"\"\"\n\t\t\t\t\ttemplate += table_field.tr_end\n\t\t\t\telse\n\t\t\t\t\ttemplate += table_field.tr_start\n\n\t\t\t\t\tif _export\n\t\t\t\t\t\ttitle_permission = \"\"\n\t\t\t\t\t\tfield_permission = \"\"\n\t\t\t\t\telse\n\t\t\t\t\t\ttitle_permission = \"title-\" + table_field.permission\n\t\t\t\t\t\tfield_permission = \"field-\" + table_field.permission\n\n\t\t\t\t\ttemplate += \"\"\"\n\t\t\t\t\t\t<td class=\"td-title td-title-#{pureCode} #{title_permission} #{required}\">\n\t\t\t\t\t\t\t{{afFieldLabelText name=\"#{table_field.code}\"}}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td class=\"td-field td-field-#{pureCode} #{field_permission}\" colspan = \"#{table_field.td_colspan}\">\n\t\t\t\t\t\t\t{{> afFormGroup name=\"#{table_field.code}\" label=false}}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\"\"\"\n\t\t\t\t\ttemplate += table_field.tr_end\n\n\ttemplate += \"\"\"\n\t\t</table>\n\n\t\t<table class=\"table-page-footer form-table no-border\">\n\t\t\t<tr class=\"applicant-wrapper\">\n\t\t\t\t<td class=\"nowrap\">\n\t\t\t\t\t<div class='inline-left'>\n\t\t\t\t\t\t<label class=\"control-label\">{{_t \"instance_initiator\"}}ï¼š</label>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='instance-table-wrapper-td inline-left'>\n\t\t\t\t\t\t{{>Template.dynamic  template=\"afSelectUser\" data=applicantContext}}\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t\t<td class=\"nowrap\">\n\t\t\t\t\t<div class='pull-left'>\n\t\t\t\t\t\t<div class='inline-left'>\n\t\t\t\t\t\t\t<label>{{_t \"instance_submit_date\"}}ï¼š</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class='inline-right'>\n\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t{{formatDate instance.submit_date '{\"format\":\"YYYY-MM-DD\"}'}}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t</div>\n\t\"\"\"\n\treturn template\n\n#æ­¤å¤„æ¨¡æ¿å…¬ç”¨ä¸Žï¼šinstance ç¼–è¾‘ã€æŸ¥çœ‹ã€æ‰“å°ã€è½¬å‘æ—¶ç”Ÿæˆé™„ä»¶ã€å‘é€é‚®ä»¶bodyéƒ¨åˆ†(table æ¨¡æ¿)\n#å¦‚æžœæœ‰ä¿®æ”¹ï¼Œè¯·æµ‹è¯•ç¡®è®¤å…¶ä»–åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚\nTemplateManager._template =\n\tdefault: (instance)->\n\n\t\ttemplate = \"\"\"\n\t\t\t<div class=\"with-border col-md-12\">\n\t\t\t\t<div class=\"instance-name\">\n\t\t\t\t\t<h3 class=\"box-title\">#{TemplateManager.instance_title().pageTitle}</h3>\n\t\t\t\t\t<span class=\"help-block\"></span>\n\t\t\t\t</div>\n\t\t\t\t<span class=\"help-block\"></span>\n\t\t\t</div>\n\t\t\t{{#each steedos_form.fields}}\n\t\t\t\t{{#if isOpinionField this}}\n\t\t\t\t\t<div class=\"{{#if this.is_wide}}col-md-12{{else}}col-md-6{{/if}} field-{{this.code}}\">\n\t\t\t\t\t\t<div class=\"form-group automatic opinion-field-{{this.code}}\">\n\t\t\t\t\t\t\t<label class=\"control-label\">{{afFieldLabelText name=this.code}}</label>\n\n\t\t\t\t\t\t\t{{> instanceSignText name=this.code}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{{else}}\n\t\t\t\t\t{{#if includes this.type 'section,table'}}\n\t\t\t\t\t\t<div class=\"col-md-12 field-{{this.code}}\">\n\t\t\t\t\t\t\t{{> afFormGroup name=this.code label=false}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{{else}}\n\t\t\t\t\t\t<div class=\"{{#if this.is_wide}}col-md-12{{else}}col-md-6{{/if}} field-{{this.code}}\">\n\t\t\t\t\t\t{{> afFormGroup name=this.code}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{{/if}}\n\t\t\t\t{{/if}}\n\t\t\t{{/each}}\n\t\t\t<div class=\"col-md-12\">\n\t\t\t\t<div class=\"applicant-wrapper form-group form-horizontal\">\n\t\t\t\t<div class=\"input-group\">\n\t\t\t\t\t<div class=\"input-group-addon\">\n\t\t\t\t\t  {{_t \"instance_initiator\"}}&nbsp;:\n\t\t\t\t\t</div>\n\t\t\t\t\t{{>Template.dynamic  template=\"afSelectUser\" data=applicantContext}}\n\t\t\t\t  </div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\"\"\"\n\t\treturn template\n\n\ttable: (instance)->\n\t\treturn TemplateManager.handleTableTemplate(instance)\n#\ttable: '''\n#\t\t<table class=\"box-header  with-border\" style=\"width: 100%;display: inline-table;\">\n#\t\t\t<tr class=\"instance-name\">\n#\t\t\t\t<td class=\"instance-table-name-td\">\n#\t\t\t\t\t<h3 class=\"box-title\">{{instance.name}}</h3>\n#\t\t\t\t\t<span class=\"help-block\"></span>\n#\t\t\t\t</td>\n#\t\t\t</tr>\n#            <tr class=\"applicant-wrapper\">\n#\t\t\t\t<td class=\"instance-table-wrapper-td\">\n#\t\t\t\t\t<label class=\"control-label\">{{_t \"instance_initiator\"}}&nbsp;:</label>\n#\t\t\t\t\t{{>Template.dynamic  template=\"afSelectUser\" data=applicantContext}}\n#\t\t\t\t</td>\n#\t\t\t</tr>\n#        </table>\n#\t\t<table class=\"form-table\">\n#\t\t    {{#each table_fields}}\n#\t\t\t\t{{#if isOpinionField this}}\n#\t\t\t\t\t{{{tr_start}}}\n#\t\t\t\t\t\t<td class=\"td-title {{#if is_required}}is-required{{/if}}\">\n#\t\t\t\t\t\t\t{{afFieldLabelText name=this.code}}\n#\t\t\t\t\t\t</td>\n#\t\t\t\t\t\t<td class=\"td-field opinion-field\" colspan = '{{td_colspan}}'>\n#\t\t\t\t\t\t\t{{> instanceSignText step=(getOpinionFieldStepName this) default=''}}\n#\t\t\t\t\t\t</td>\n#\t\t\t\t\t{{{tr_end}}}\n#\t\t\t\t{{else}}\n#\t\t\t\t\t{{#if includes this.type 'section,table'}}\n#\t\t\t\t\t\t{{{tr_start}}}\n#\t\t\t\t\t\t\t<td class=\"td-childfield\" colspan = '{{td_colspan}}'>\n#\t\t\t\t\t\t\t   {{> afFormGroup name=this.code label=false}}\n#\t\t\t\t\t\t\t</td>\n#\t\t\t\t\t\t{{{tr_end}}}\n#\t\t\t\t\t{{else}}\n#\t\t\t\t\t\t{{{tr_start}}}\n#\t\t\t\t\t\t\t<td class=\"td-title {{#if is_required}}is-required{{/if}}\">\n#\t\t\t\t\t\t\t\t{{afFieldLabelText name=this.code}}\n#\t\t\t\t\t\t\t</td>\n#\t\t\t\t\t\t\t<td class=\"td-field {{permission}}\" colspan = '{{td_colspan}}'>\n#\t\t\t\t\t\t\t\t{{> afFormGroup name=this.code label=false}}\n#\t\t\t\t\t\t\t</td>\n#\t\t\t\t\t\t{{{tr_end}}}\n#\t\t\t\t\t{{/if}}\n#\t\t\t\t{{/if}}\n#\n#\t\t    {{/each}}\n#\t\t</table>\n#\t'''\n\nTemplateManager._templateHelps =\n\tapplicantContext: ->\n\t\tsteedos_instance = WorkflowManager.getInstance();\n\t\tdata = {\n\t\t\tname: 'ins_applicant',\n\t\t\tatts: {\n\t\t\t\tname: 'ins_applicant',\n\t\t\t\tid: 'ins_applicant',\n\t\t\t\tclass: 'selectUser form-control',\n\t\t\t\tstyle: 'padding:6px 12px;width:140px;display:inline'\n\t\t\t}\n\t\t}\n#\t\tif not steedos_instance || steedos_instance.state != \"draft\"\n\t\tdata.atts.disabled = true\n\t\treturn data;\n\ninstanceId: ->\n\treturn 'instanceform';#\"instance_\" + Session.get(\"instanceId\");\n\nform_types: ->\n\tif ApproveManager.isReadOnly()\n\t\treturn 'disabled';\n\telse\n\t\treturn 'method';\n\nsteedos_form: ->\n\tform_version = WorkflowManager.getInstanceFormVersion();\n\tif form_version\n\t\treturn form_version\n\ninnersubformContext: (obj)->\n\tdoc_values = WorkflowManager_format.getAutoformSchemaValues();\n\tobj[\"tableValues\"] = if doc_values then doc_values[obj.code] else []\n\tobj[\"formId\"] = formId;\n\treturn obj;\n\ninstance: ->\n\tSession.get(\"change_date\")\n\tif (Session.get(\"instanceId\"))\n\t\tsteedos_instance = WorkflowManager.getInstance();\n\t\treturn steedos_instance;\n\nequals: (a, b) ->\n\treturn (a == b)\n\nincludes: (a, b) ->\n\treturn b.split(',').includes(a);\n\nfields: ->\n\tform_version = WorkflowManager.getInstanceFormVersion();\n\tif form_version\n\t\treturn new SimpleSchema(WorkflowManager_format.getAutoformSchema(form_version));\n\ndoc_values: ->\n\tWorkflowManager_format.getAutoformSchemaValues();\n\ninstance_box_style: ->\n\tbox = Session.get(\"box\")\n\tif box == \"inbox\" || box == \"draft\"\n\t\tjudge = Session.get(\"judge\")\n\t\tif judge\n\t\t\tif (judge == \"approved\")\n\t\t\t\treturn \"box-success\"\n\t\t\telse if (judge == \"rejected\")\n\t\t\t\treturn \"box-danger\"\n\tins = WorkflowManager.getInstance();\n\tif ins && ins.final_decision\n\t\tif ins.final_decision == \"approved\"\n\t\t\treturn \"box-success\"\n\t\telse if (ins.final_decision == \"rejected\")\n\t\t\treturn \"box-danger\"\n\n\nTemplateManager.getTemplate = (instance, templateName) ->\n\tflow = db.flows.findOne(instance.flow);\n\tform = db.forms.findOne(instance.form);\n\n\tif templateName\n\t\tif templateName == 'table'\n\t\t\treturn TemplateManager._template.table(instance)\n\t\treturn TemplateManager._template.default(instance)\n\n\tif Session?.get(\"instancePrint\")\n\t\tif flow?.print_template\n\t\t\treturn \"<div class='instance-template'>\" + flow.print_template + \"</div>\"\n\t\telse\n\t\t\tif flow?.instance_template\n\t\t\t\treturn \"<div class='instance-template'>\" + flow.instance_template + \"</div>\"\n\t\t\telse\n\t\t\t\treturn TemplateManager._template.table(instance)\n\telse\n\t\tif Steedos.isMobile()\n\t\t\treturn TemplateManager._template.default(instance)\n\n\t\tif flow?.instance_template\n\t\t\treturn \"<div class='instance-template'>\" + flow.instance_template + \"</div>\"\n\n\t\tif form?.instance_style\n\t\t\tif form.instance_style == 'table'\n\t\t\t\treturn TemplateManager._template.table(instance)\n\t\t\treturn TemplateManager._template.default(instance)\n\t\telse\n\t\t\treturn TemplateManager._template.default(instance)\n\n#TemplateManager.exportTemplate = (flowId) ->\n#\ttemplate = TemplateManager.getTemplate(flowId);\n#\n#\tflow = WorkflowManager.getFlow(flowId);\n#\n#\tif flow?.instance_template\n#\t\treturn template;\n#\n#\treturn template;\n\n","var formId;                 \n\nTemplateManager = {};\n\nformId = 'instanceform';\n\nTemplateManager.instance_title = function() {\n  var pageTitle, pageTitleTrClass, val;\n  pageTitle = \"{{instance.name}}\";\n  pageTitleTrClass = \"instance-name\";\n  if (typeof CoreForm !== \"undefined\" && CoreForm !== null ? CoreForm.pageTitleFieldName : void 0) {\n    pageTitle = \"{{> afFormGroup name=\\\"\" + CoreForm.pageTitleFieldName + \"\\\" label=false}}\";\n    pageTitleTrClass = \"\";\n  }\n  if (typeof CoreForm !== \"undefined\" && CoreForm !== null ? CoreForm.pageTitle : void 0) {\n    pageTitle = \"\" + CoreForm.pageTitle;\n    pageTitleTrClass = \"\";\n  }\n  val = {\n    pageTitle: pageTitle,\n    pageTitleTrClass: pageTitleTrClass\n  };\n  return val;\n};\n\nTemplateManager.handleTableTemplate = function(instance, _export) {\n  var table_fields, template;\n  template = \"<div class='instance-template'>\\n\t<table class=\\\"table-page-title form-table no-border text-align-center\\\" style=\\\"width: 100%;display: inline-table;\\\">\\n\t\t<tr class=\\\"\" + (this.instance_title().pageTitleTrClass) + \"\\\">\\n\t\t\t<td class=\\\"instance-table-name-td page-title\\\">\\n\t\t\t\t\" + (this.instance_title().pageTitle) + \"\\n\t\t\t</td>\\n\t\t</tr>\\n\\n\t</table>\\n\t<table class=\\\"table-page-body form-table\\\">\\n\t\t\t<tr style=\\\"height:0px\\\">\\n\t\t\t\t<th style='width: 16%'></th>\\n\t\t\t\t<th></th>\\n\t\t\t\t<th style='width: 16%'></th>\\n\t\t\t\t<th></th>\\n\t\t\t</tr>\";\n  table_fields = InstanceformTemplate.helpers.table_fields(instance);\n  table_fields && table_fields.forEach(function(table_field) {\n    var field_permission, pureCode, required, title_permission;\n    required = \"\";\n    if (!(typeof CoreForm !== \"undefined\" && CoreForm !== null ? CoreForm.pageTitleFieldName : void 0) || (typeof CoreForm !== \"undefined\" && CoreForm !== null ? CoreForm.pageTitleFieldName : void 0) !== table_field.code) {\n      if (table_field.is_required) {\n        required = \"is-required\";\n      }\n      if (_export) {\n        required = \"\";\n      }\n      pureCode = Steedos.removeSpecialCharacter(table_field.code);\n      if (InstanceformTemplate.helpers.isOpinionField(table_field)) {\n        template += table_field.tr_start;\n        template += \"<td class=\\\"td-title \" + required + \"\\\">\\n\t{{afFieldLabelText name=\\\"\" + table_field.code + \"\\\"}}\\n</td>\\n<td class=\\\"td-field opinion-field opinion-field-\" + pureCode + \" automatic\\\" colspan = \\\"\" + table_field.td_colspan + \"\\\">\\n\t{{> instanceSignText name=\\\"\" + table_field.code + \"\\\"}}\\n</td>\";\n        return template += table_field.tr_end;\n      } else {\n        if (InstanceformTemplate.helpers.includes(table_field.type, 'section,table')) {\n          template += table_field.tr_start;\n          template += \"<td class=\\\"td-childfield td-childfield-\" + pureCode + \"\\\" colspan = \\\"\" + table_field.td_colspan + \"\\\">\\n   {{> afFormGroup name=\\\"\" + table_field.code + \"\\\" label=false}}\\n</td>\";\n          return template += table_field.tr_end;\n        } else {\n          template += table_field.tr_start;\n          if (_export) {\n            title_permission = \"\";\n            field_permission = \"\";\n          } else {\n            title_permission = \"title-\" + table_field.permission;\n            field_permission = \"field-\" + table_field.permission;\n          }\n          template += \"<td class=\\\"td-title td-title-\" + pureCode + \" \" + title_permission + \" \" + required + \"\\\">\\n\t{{afFieldLabelText name=\\\"\" + table_field.code + \"\\\"}}\\n</td>\\n<td class=\\\"td-field td-field-\" + pureCode + \" \" + field_permission + \"\\\" colspan = \\\"\" + table_field.td_colspan + \"\\\">\\n\t{{> afFormGroup name=\\\"\" + table_field.code + \"\\\" label=false}}\\n</td>\";\n          return template += table_field.tr_end;\n        }\n      }\n    }\n  });\n  template += \"\t</table>\\n\\n\t<table class=\\\"table-page-footer form-table no-border\\\">\\n\t\t<tr class=\\\"applicant-wrapper\\\">\\n\t\t\t<td class=\\\"nowrap\\\">\\n\t\t\t\t<div class='inline-left'>\\n\t\t\t\t\t<label class=\\\"control-label\\\">{{_t \\\"instance_initiator\\\"}}ï¼š</label>\\n\t\t\t\t</div>\\n\t\t\t\t<div class='instance-table-wrapper-td inline-left'>\\n\t\t\t\t\t{{>Template.dynamic  template=\\\"afSelectUser\\\" data=applicantContext}}\\n\t\t\t\t</div>\\n\t\t\t</td>\\n\t\t\t<td class=\\\"nowrap\\\">\\n\t\t\t\t<div class='pull-left'>\\n\t\t\t\t\t<div class='inline-left'>\\n\t\t\t\t\t\t<label>{{_t \\\"instance_submit_date\\\"}}ï¼š</label>\\n\t\t\t\t\t</div>\\n\t\t\t\t\t<div class='inline-right'>\\n\t\t\t\t\t\t<div class=\\\"form-group\\\">\\n\t\t\t\t\t\t\t{{formatDate instance.submit_date '{\\\"format\\\":\\\"YYYY-MM-DD\\\"}'}}\\n\t\t\t\t\t\t</div>\\n\t\t\t\t\t</div>\\n\t\t\t\t</div>\\n\t\t\t</td>\\n\t\t</tr>\\n\t</table>\\n</div>\";\n  return template;\n};\n\nTemplateManager._template = {\n  \"default\": function(instance) {\n    var template;\n    template = \"<div class=\\\"with-border col-md-12\\\">\\n\t<div class=\\\"instance-name\\\">\\n\t\t<h3 class=\\\"box-title\\\">\" + (TemplateManager.instance_title().pageTitle) + \"</h3>\\n\t\t<span class=\\\"help-block\\\"></span>\\n\t</div>\\n\t<span class=\\\"help-block\\\"></span>\\n</div>\\n{{#each steedos_form.fields}}\\n\t{{#if isOpinionField this}}\\n\t\t<div class=\\\"{{#if this.is_wide}}col-md-12{{else}}col-md-6{{/if}} field-{{this.code}}\\\">\\n\t\t\t<div class=\\\"form-group automatic opinion-field-{{this.code}}\\\">\\n\t\t\t\t<label class=\\\"control-label\\\">{{afFieldLabelText name=this.code}}</label>\\n\\n\t\t\t\t{{> instanceSignText name=this.code}}\\n\t\t\t</div>\\n\t\t</div>\\n\t{{else}}\\n\t\t{{#if includes this.type 'section,table'}}\\n\t\t\t<div class=\\\"col-md-12 field-{{this.code}}\\\">\\n\t\t\t\t{{> afFormGroup name=this.code label=false}}\\n\t\t\t</div>\\n\t\t{{else}}\\n\t\t\t<div class=\\\"{{#if this.is_wide}}col-md-12{{else}}col-md-6{{/if}} field-{{this.code}}\\\">\\n\t\t\t{{> afFormGroup name=this.code}}\\n\t\t\t</div>\\n\t\t{{/if}}\\n\t{{/if}}\\n{{/each}}\\n<div class=\\\"col-md-12\\\">\\n\t<div class=\\\"applicant-wrapper form-group form-horizontal\\\">\\n\t<div class=\\\"input-group\\\">\\n\t\t<div class=\\\"input-group-addon\\\">\\n\t\t  {{_t \\\"instance_initiator\\\"}}&nbsp;:\\n\t\t</div>\\n\t\t{{>Template.dynamic  template=\\\"afSelectUser\\\" data=applicantContext}}\\n\t  </div>\\n\t</div>\\n</div>\";\n    return template;\n  },\n  table: function(instance) {\n    return TemplateManager.handleTableTemplate(instance);\n  }\n};\n\nTemplateManager._templateHelps = {\n  applicantContext: function() {\n    var data, steedos_instance;\n    steedos_instance = WorkflowManager.getInstance();\n    data = {\n      name: 'ins_applicant',\n      atts: {\n        name: 'ins_applicant',\n        id: 'ins_applicant',\n        \"class\": 'selectUser form-control',\n        style: 'padding:6px 12px;width:140px;display:inline'\n      }\n    };\n    data.atts.disabled = true;\n    return data;\n  }\n};\n\n({\n  instanceId: function() {\n    return 'instanceform';\n  },\n  form_types: function() {\n    if (ApproveManager.isReadOnly()) {\n      return 'disabled';\n    } else {\n      return 'method';\n    }\n  },\n  steedos_form: function() {\n    var form_version;\n    form_version = WorkflowManager.getInstanceFormVersion();\n    if (form_version) {\n      return form_version;\n    }\n  },\n  innersubformContext: function(obj) {\n    var doc_values;\n    doc_values = WorkflowManager_format.getAutoformSchemaValues();\n    obj[\"tableValues\"] = doc_values ? doc_values[obj.code] : [];\n    obj[\"formId\"] = formId;\n    return obj;\n  },\n  instance: function() {\n    var steedos_instance;\n    Session.get(\"change_date\");\n    if (Session.get(\"instanceId\")) {\n      steedos_instance = WorkflowManager.getInstance();\n      return steedos_instance;\n    }\n  },\n  equals: function(a, b) {\n    return a === b;\n  },\n  includes: function(a, b) {\n    return b.split(',').includes(a);\n  },\n  fields: function() {\n    var form_version;\n    form_version = WorkflowManager.getInstanceFormVersion();\n    if (form_version) {\n      return new SimpleSchema(WorkflowManager_format.getAutoformSchema(form_version));\n    }\n  },\n  doc_values: function() {\n    return WorkflowManager_format.getAutoformSchemaValues();\n  },\n  instance_box_style: function() {\n    var box, ins, judge;\n    box = Session.get(\"box\");\n    if (box === \"inbox\" || box === \"draft\") {\n      judge = Session.get(\"judge\");\n      if (judge) {\n        if (judge === \"approved\") {\n          return \"box-success\";\n        } else if (judge === \"rejected\") {\n          return \"box-danger\";\n        }\n      }\n    }\n    ins = WorkflowManager.getInstance();\n    if (ins && ins.final_decision) {\n      if (ins.final_decision === \"approved\") {\n        return \"box-success\";\n      } else if (ins.final_decision === \"rejected\") {\n        return \"box-danger\";\n      }\n    }\n  }\n});\n\nTemplateManager.getTemplate = function(instance, templateName) {\n  var flow, form;\n  flow = db.flows.findOne(instance.flow);\n  form = db.forms.findOne(instance.form);\n  if (templateName) {\n    if (templateName === 'table') {\n      return TemplateManager._template.table(instance);\n    }\n    return TemplateManager._template[\"default\"](instance);\n  }\n  if (typeof Session !== \"undefined\" && Session !== null ? Session.get(\"instancePrint\") : void 0) {\n    if (flow != null ? flow.print_template : void 0) {\n      return \"<div class='instance-template'>\" + flow.print_template + \"</div>\";\n    } else {\n      if (flow != null ? flow.instance_template : void 0) {\n        return \"<div class='instance-template'>\" + flow.instance_template + \"</div>\";\n      } else {\n        return TemplateManager._template.table(instance);\n      }\n    }\n  } else {\n    if (Steedos.isMobile()) {\n      return TemplateManager._template[\"default\"](instance);\n    }\n    if (flow != null ? flow.instance_template : void 0) {\n      return \"<div class='instance-template'>\" + flow.instance_template + \"</div>\";\n    }\n    if (form != null ? form.instance_style : void 0) {\n      if (form.instance_style === 'table') {\n        return TemplateManager._template.table(instance);\n      }\n      return TemplateManager._template[\"default\"](instance);\n    } else {\n      return TemplateManager._template[\"default\"](instance);\n    }\n  }\n};\n","SteedosTable = {};\n\nSteedosTable.formId = \"instanceform\";\n\nSteedosTable.checkItem = function (field, item_index) {\n    var fieldObj = SteedosTable.getField(field);\n\n    var fieldVal = SteedosTable.getItemModalValue(field, item_index);\n\n    var sf_name = '';\n    var rev = true;\n    fieldObj.sfields.forEach(function (sf) {\n        if (sf.permission == 'editable') {\n            sf_name = fieldObj.code + \".\" + sf.code;\n            if (!InstanceManager.checkFormFieldValue($(\"[name='\" + sf_name + \"']\")[0], sf_name, fieldVal[sf.code])) {\n                rev = false;\n            }\n        }\n    });\n\n    return rev;\n}\n\nSteedosTable.setTableItemValue = function (field, item_index, item_value) {\n\n    var tableValue = SteedosTable.getTableValue(field);\n    tableValue[item_index] = item_value;\n}\n\nSteedosTable.getTableItemValue = function (field, item_index) {\n    return SteedosTable.getTableValue(field)[item_index];\n}\n\nSteedosTable.removeTableItem = function (field, item_index) {\n    var item_value = SteedosTable.getTableItemValue(field, item_index);\n    item_value.removed = true;\n}\n\nSteedosTable.setTableValue = function (field, value) {\n    $(\"table[name='\" + field + \"']\").val({\n        val: value\n    });\n}\n\nSteedosTable.getTableValue = function (field) {\n    return $(\"table[name='\" + field + \"']\").val().val;\n}\n\nSteedosTable.getValidValue = function (field) {\n    var value = SteedosTable.getTableValue(field);\n\n    if (!value) {\n        return\n    }\n\n    var validValue = [];\n\n    value.forEach(function (v) {\n        if (!v.removed) {\n            validValue.push(v);\n        }\n    });\n    return validValue;\n}\n\n\nSteedosTable.handleData = function (field, values) {\n\n    if (!values || !(values instanceof Array)) {\n        return values;\n    }\n\n    var fieldObj = SteedosTable.getField(field);\n\n    values.forEach(function (v) {\n        fieldObj.sfields.forEach(function (f) {\n            if (f.type == 'user' || f.type == 'group') {\n                var value = v[f.code]\n                if (f.is_multiselect) {\n                    if (value && value.length > 0 && typeof (value[0]) == 'object') {\n                        v[f.code] = v[f.code].getProperty(\"id\");\n                    }\n                } else {\n                    if (value && typeof (value) == 'object') {\n                        v[f.code] = v[f.code].id;\n                    }\n                }\n            } else if (f.type == 'dateTime') {\n                var value = v[f.code]\n                if (value) {\n                    if (value.length == 16) {\n                        var t = value.split(\"T\");\n                        var t0 = t[0].split(\"-\");\n                        var t1 = t[1].split(\":\");\n\n                        year = t0[0];\n                        month = t0[1];\n                        date = t0[2];\n                        hours = t1[0];\n                        seconds = t1[1];\n                        value = new Date(year, month - 1, date, hours, seconds);\n                        v[f.code] = value;\n                    }\n\n                }\n            }\n        });\n    });\n    return values;\n}\n\nSteedosTable.getField = function (field) {\n    var instanceFields = WorkflowManager.getInstanceFields();\n    if (!instanceFields)\n        return;\n\n    var fieldObj = instanceFields.findPropertyByPK(\"code\", field);\n\n    return fieldObj;\n}\n\n\nSteedosTable.getModalData = function (field, index) {\n\n    var data = {};\n\n    var fieldObj = SteedosTable.getField(field);\n\n    if (!fieldObj) {\n        return;\n    }\n\n    data.field = fieldObj;\n\n    data.field.formula = Form_formula.getFormulaFieldVariable(\"Form_formula.field_values\", fieldObj.sfields);\n\n    data.value = {};\n\n    data.value[field] = SteedosTable.getTableItemValue(field, index);\n\n    data.index = index;\n\n    return data;\n}\n\n\n\nSteedosTable.getItemModalValue = function (field, item_index) {\n\n    if (!AutoForm.getFormValues(\"steedos_table_modal_\" + field + \"_\" + item_index)) {\n        return {}\n    }\n\n    var item_value = AutoForm.getFormValues(\"steedos_table_modal_\" + field + \"_\" + item_index).insertDoc[field];\n    return item_value;\n}\n\n\nSteedosTable.addItem = function (field, index, _item_value) {\n    var keys = SteedosTable.getKeys(field);\n    var item_value = _item_value || SteedosTable.getItemModalValue(field, index);\n    $(\"tbody[name='\" + field + \"Tbody']\").append(SteedosTable.getTr(keys, item_value, index, field, true))\n\n}\n\nSteedosTable.updateItem = function (field, index, _item_value) {\n\n    var item = $(\"tr[name='\" + field + \"_item_\" + index + \"']\");\n\n    var item_value = _item_value || SteedosTable.getItemModalValue(field, index);\n\n    if (item && item.length > 0) {\n        var keys = SteedosTable.getKeys(field);\n        var tds = SteedosTable.getRemoveTd(field, index);\n\n        var sfields = SteedosTable.getField(field).sfields;\n\n        keys.forEach(function (key) {\n            var sfield = sfields.findPropertyByPK(\"code\", key);\n\n            var value = item_value[key];\n\n            tds = tds + SteedosTable.getTd(sfield, index, value);\n\n        });\n\n        item.empty();\n\n        item.append(tds);\n\n    } else {\n\n        SteedosTable.addItem(field, index);\n    }\n\n    if (SteedosTable.getTableValue(field)) {\n\n        SteedosTable.setTableItemValue(field, index, item_value);\n\n        //SteedosTable.valueHash[field][index] = item_value;\n\n    } else {\n        //SteedosTable.valueHash[field] = [item_value];\n\n        SteedosTable.setTableValue(field, [item_value])\n\n    }\n\n    //æ‰§è¡Œä¸»è¡¨å…¬å¼è®¡ç®—\n    InstanceManager.runFormula(field);\n\n}\n\nSteedosTable.removeItem = function (field, index) {\n\n    $(\"tr[name='\" + field + \"_item_\" + index + \"']\").hide();\n\n    SteedosTable.removeTableItem(field, index);\n\n    InstanceManager.runFormula(field);\n}\n\nSteedosTable.showModal = function (field, index, method) {\n\n\n    var modalData = SteedosTable.getModalData(field, index);\n\n    modalData.method = method;\n    setTimeout(function(){\n        Modal.show(\"steedosTableModal\", modalData);\n    }, 300)\n}\n\nSteedosTable.getKeys = function (field) {\n    if (!AutoForm.getCurrentDataForForm(SteedosTable.formId)) {\n        return [];\n    }\n\n    var ss = AutoForm.getFormSchema(SteedosTable.formId);\n\n    var keys = [];\n\n    if (ss.schema(field + \".$\").type === Object) {\n        keys = ss.objectKeys(SimpleSchema._makeGeneric(field) + '.$')\n    }\n\n    return keys;\n\n}\n\nSteedosTable.getThead = function (field, editable) {\n\n    var fieldObj = field;\n    if (!_.isObject(field))\n        fieldObj = SteedosTable.getField(field);\n\n    if (!fieldObj) {\n        return '';\n    }\n\n    var thead = '',\n        trs = '',\n        label = '',\n        width = 100;\n\n    if (editable) {\n        // trs = \"<th class='removed'></th>\"\n        trs = \"\"\n    }\n\n    var sfields = fieldObj.sfields;\n\n    if (!sfields) {\n        return thead;\n    }\n\n    var sf_length = sfields.length;\n\n    if (sf_length > 0) {\n        var wide_fields = sfields.filterProperty(\"is_wide\", true);\n\n        width = 100 / (sf_length + wide_fields.length);\n    }\n\n    sfields.forEach(function (sf, index) {\n\n        label = (sf.name != null && sf.name.length > 0) ? sf.name : sf.code;\n\n        trs = trs + \"<td \"; // nowrap='nowrap'\n\n        trs = trs + \" class='title \" + sf.type + \"'\";\n\n        if (index != (sf_length - 1)) {\n            if (sf.is_wide) {\n                trs = trs + \"style='width:\" + width * 2 + \"%'\"\n            } else {\n                trs = trs + \"style='width:\" + width + \"%'\"\n            }\n        }\n\n        trs = trs + \">\" + label + \"</td>\"\n    });\n\n    thead = '<tr>' + trs + '</tr>';\n\n    return thead;\n}\n\nSteedosTable.getTbody = function (keys, field, values, editable, sfieldsEditable) {\n    var tbody = \"\";\n\n    if (values instanceof Array) {\n        values.forEach(function (value, index) {\n            tbody = tbody + SteedosTable.getTr(keys, value, index, field, editable, sfieldsEditable);\n        });\n    }\n\n    return tbody;\n}\n\nSteedosTable.getTr = function (keys, item_value, index, field, editable, sfieldsEditable) {\n\n    var fieldObj = field;\n    if (!_.isObject(field))\n        fieldObj = SteedosTable.getField(field);\n\n    var tr = \"<tr id='\" + fieldObj.code + \"_item_\" + index + \"' name='\" + fieldObj.code + \"_item_\" + index + \"' data-index='\" + index + \"'\"\n\n    if (editable || sfieldsEditable) {\n        tr = tr + \"' class='item edit'\"\n    } else {\n        if (Steedos.isMobile()) {\n            tr = tr + \" class='item item-readonly'\"\n        } else {\n            tr = tr + \" class='item '\"\n        }\n    }\n\n    if (item_value.removed) {\n        tr = tr + \" style='display:none' \";\n    }\n\n    tr = tr + \"'>\";\n\n    var tds = \"\";\n\n    if (editable) {\n        tds = SteedosTable.getRemoveTd(fieldObj.code, index);\n    }\n\n    var sfields = fieldObj.sfields;\n\n    keys.forEach(function (key) {\n        var sfield = sfields.findPropertyByPK(\"code\", key);\n\n        var value = item_value[key];\n\n        tds = tds + SteedosTable.getTd(sfield, index, value);\n\n    });\n\n    tr = tr + tds + \"</tr>\";\n    return tr;\n}\n\nSteedosTable.getRemoveTd = function (field, index) {\n    // return \"<td class='steedosTable-item-remove removed' data-index='\" + index + \"'><i class='fa fa-times' aria-hidden='true'></td>\";\n    return \"\"\n}\n\nSteedosTable.getTd = function (field, index, value) {\n    var td = \"<td \";\n\n    td = td + \" class='steedosTable-item-field \" + field.type + \"' \";\n\n    var td_value = \"\";\n\n    if (Meteor.isClient) {\n        td_value = SteedosTable.getTDValue(field, value)\n    } else {\n        locale = Template.instance().view.template.steedosData.locale\n\n        utcOffset = Template.instance().view.template.steedosData.utcOffset\n\n        td_value = InstanceReadOnlyTemplate.getValue(value, field, locale, utcOffset)\n    }\n\n    td = td + \" data-index='\" + index + \"'>\" + td_value + \"</td>\"\n\n    return td;\n}\n\n\nSteedosTable.getTDValue = function (field, value) {\n    var td_value = \"\";\n    if (!field) {\n        return td_value\n    }\n    try {\n        var fieldOptions = [];\n        if([\"select\", \"multiSelect\", \"radio\"].indexOf(field.type) > -1){\n            fieldOptions = field.options.split(\"\\n\").map(function(n){\n                var itemSplits = n.split(\":\")\n                return {\n                    label: itemSplits[0],\n                    value: itemSplits[1] || n\n                }\n            });\n        }\n\n        switch (field.type) {\n            case 'user':\n                if (value) {\n                    if (field.is_multiselect) {\n                        if (value.length > 0) {\n                            if (\"string\" == typeof (value[0])) {\n                                td_value = CFDataManager.getFormulaSpaceUsers(value).getProperty(\"name\").toString();\n                            } else {\n                                td_value = value.getProperty(\"name\").toString();\n                            }\n                        }\n                    } else {\n                        if (\"string\" == typeof (value)) {\n                            var u = CFDataManager.getFormulaSpaceUsers(value);\n                            td_value = u ? u.name : '';\n                        } else {\n                            td_value = value.name;\n                        }\n                    }\n                }\n                break;\n            case 'group':\n                if (value) {\n                    if (field.is_multiselect) {\n                        if (value.length > 0) {\n                            if (\"string\" == typeof (value[0])) {\n                                td_value = CFDataManager.getFormulaOrganizations(value).getProperty(\"name\").toString();\n                            } else {\n                                td_value = value.getProperty(\"name\").toString();\n                            }\n                        }\n                    } else {\n                        if (\"string\" == typeof (value)) {\n                            var o = CFDataManager.getFormulaOrganization(value);\n                            td_value = o ? o.name : '';\n                        } else {\n                            td_value = value.name;\n                        }\n                    }\n                }\n                break;\n            case 'checkbox':\n                if (value === true || value == 'true') {\n                    td_value = TAPi18n.__(\"form_field_checkbox_yes\");\n                } else {\n                    td_value = TAPi18n.__(\"form_field_checkbox_no\");\n                }\n                break;\n            case 'email':\n                td_value = value ? \"<a href='mailto:\" + value + \"'>\" + value + \"</a>\" : \"\";\n                break;\n            case 'url':\n                if (value) {\n                    if (value.indexOf(\"http\") == 0) {\n                        try {\n                            td_value = \"<a href='\" + encodeURI(value) + \"' target='_blank'>\" + value + \"</a>\";\n                        } catch (e) {\n                            td_value = \"<a href='' target='_blank'>\" + value + \"</a>\";\n                        }\n\n                    } else {\n                        td_value = \"<a href='http://\" + encodeURI(value) + \"' target='_blank'>http://\" + value + \"</a>\";\n                    }\n                } else {\n                    td_value = \"\";\n                }\n                break;\n            case 'password':\n                td_value = '******';\n                break;\n            case 'date':\n                if (value) {\n                    if (value.length == 10) {\n                        var t = value.split(\"-\");\n                        year = t[0];\n                        month = t[1];\n                        date = t[2];\n                        value = new Date(year, month - 1, date);\n                    } else {\n                        value = new Date(value)\n                    }\n                    td_value = $.format.date(value, 'yyyy-MM-dd');\n                }\n                break;\n            case 'dateTime':\n                if (value) {\n                    if (value.length == 16) {\n                        var t = value.split(\"T\");\n                        var t0 = t[0].split(\"-\");\n                        var t1 = t[1].split(\":\");\n\n                        year = t0[0];\n                        month = t0[1];\n                        date = t0[2];\n                        hours = t1[0];\n                        seconds = t1[1];\n\n                        value = new Date(year, month - 1, date, hours, seconds);\n\n                    } else {\n\n                        value = new Date(value)\n                    }\n                    td_value = $.format.date(value, 'yyyy-MM-dd HH:mm');\n                }\n                break;\n            case 'select':\n                var selectedOption = fieldOptions.find(function(item){ return item.value == value; })\n                if(selectedOption){\n                    td_value = selectedOption.label\n                }\n                break;\n            case 'radio':\n                var selectedOption = fieldOptions.find(function(item){ return item.value == value; })\n                if(selectedOption){\n                    td_value = selectedOption.label\n                }\n                break;\n            case 'multiSelect':\n                var splitedValues = value.split(\",\");\n                var selectedOptions = fieldOptions.filter(function(item){ return splitedValues.indexOf(item.value) > -1; });\n                if(selectedOptions.length){\n                    td_value = selectedOptions.map(function(item){ return item.label; }).join(\",\");\n                }\n                break;\n            case 'number':\n                if (value || value == 0) {\n                    if (field.is_percent) {\n                        td_value = Steedos.numberToPercentString(value, field.digits);\n                    } else {\n                        td_value = Steedos.numberToString(value, field.digits);\n                    }\n                }\n                break;\n            case 'odata':\n                if (value) {\n                    if (field.is_multiselect) {\n                        td_value = _.pluck(value, '@label').toString()\n                    } else {\n                        td_value = value['@label']\n                    }\n                }\n                break;\n            case 'file':\n            case 'lookup':\n            case 'image':\n                td_value = InstanceReadOnlyTemplate.getValue(value, field);\n                break\n            default:\n                td_value = value ? value : '';\n                break;\n        }\n    } catch (e) {\n        e;\n\n        return '';\n    }\n    return td_value;\n};\n\nif (Meteor.isClient) {\n    AutoForm.addInputType(\"table\", {\n        template: \"afTable\",\n        valueOut: function () {\n            var name = this.data(\"schemaKey\");\n            return SteedosTable.getValidValue(name);\n        },\n        valueConverters: {\n            \"stringArray\": AutoForm.valueConverters.stringToStringArray,\n            \"number\": AutoForm.valueConverters.stringToNumber,\n            \"numerArray\": AutoForm.valueConverters.stringToNumberArray,\n            \"boolean\": AutoForm.valueConverters.stringToBoolean,\n            \"booleanArray\": AutoForm.valueConverters.stringToBooleanArray,\n            \"date\": AutoForm.valueConverters.stringToDate,\n            \"dateArray\": AutoForm.valueConverters.stringToDateArray\n        },\n        contextAdjust: function (context) {\n            if (typeof context.atts.maxlength === 'undefined' && typeof context.max === 'number') {\n                context.atts.maxlength = context.max;\n            }\n            return context;\n        }\n    });\n\n    Template.afTable.events({\n        'tap .steedos-table .steedosTable-item-add,.add-item-tr': function (event, template) {\n            var name = template.data.name;\n\n            var tableValue = SteedosTable.getTableValue(name);\n\n            var new_item_index = tableValue ? tableValue.length : 0;\n\n            SteedosTable.showModal(name, new_item_index, \"add\");\n        },\n\n        'tap .steedos-table .steedosTable-item-field': function (event, template) {\n            if (template.data.atts.editable || template.data.atts.sfieldsEditable) {\n                var field = template.data.name;\n                var index = event.currentTarget.dataset.index;\n                SteedosTable.showModal(field, index, \"edit\");\n            }\n        },\n\n        'tap .steedos-table .steedosTable-item-remove': function (event, template) {\n            var field = template.data.name;\n            var item_index = event.currentTarget.dataset.index;\n            Session.set(\"instance_change\", true);\n            SteedosTable.removeItem(field, item_index);\n        },\n\n        'tap .steedos-table .item-readonly': function (event, template) {\n            if (!template.data.atts.editable) {\n                var field = template.data.name;\n                var index = event.currentTarget.dataset.index;\n                SteedosTable.showModal(field, index, \"read\");\n            }\n        }\n    });\n\n\n\n    Template.afTable.rendered = function () {\n\n        var field = this.data.name;\n\n        var sfieldsEditable = this.data.atts.sfieldsEditable;\n\n        var keys = SteedosTable.getKeys(field);\n        var validValue = SteedosTable.handleData(field, this.data.value);\n        SteedosTable.setTableValue(field, validValue);\n\n        $(\"thead[name='\" + field + \"Thead']\").html(SteedosTable.getThead(field, this.data.atts.editable));\n\n        $(\"tbody[name='\" + field + \"Tbody']\").html(SteedosTable.getTbody(keys, field, SteedosTable.getTableValue(field), this.data.atts.editable, sfieldsEditable));\n\n        str = t(\"steedos_table_add_item\");\n        addItemTr = \"<tr class='add-item-tr'><td colspan='\" + keys.length + \"'><i class='ion ion-plus-round'></i>\" + str + \"</td></tr>\";\n\n        if (this.data.atts.editable) {\n            $(\"tfoot[name='\" + field + \"Tfoot']\").append(addItemTr);\n        }\n\n        var c = InstanceManager.getCurrentStep();\n        if (c.step_type == 'counterSign' || InstanceManager.ccHasEditPermission()) {\n            this.autorun(function () {\n                var data = Template.currentData();\n                var field = data.name;\n                var keys = SteedosTable.getKeys(field);\n                var validValue = SteedosTable.handleData(field, data.value);\n                SteedosTable.setTableValue(field, validValue);\n                $(\"tbody[name='\" + field + \"Tbody']\").html(SteedosTable.getTbody(keys, field, SteedosTable.getTableValue(field), data.atts.editable, sfieldsEditable));\n            })\n        }\n\n    };\n}","ImageSign.helpers =\n\tspaceUserSign: (userId)->\n\t\tspace = \"\"\n\n\t\tif Meteor.isServer\n\t\t\tspace = Template.instance().view.template.steedosData.space\n\t\telse\n\t\t\tspace = Session.get(\"spaceId\")\n\n\t\tspaceUserSign = db.space_user_signs.findOne({space: space, user: userId});\n\t\treturn spaceUserSign\n\n\timageURL: (userId)->\n\n\t\tspaceUserSign = ImageSign.helpers.spaceUserSign(userId);\n\n\t\tabsolute = false\n\n\t\tif Meteor.isServer\n\t\t\tabsolute = Template.instance().view.template.steedosData.absolute\n\n\t\tif spaceUserSign?.sign\n\t\t\tif absolute\n\t\t\t\treturn Meteor.absoluteUrl(\"api/files/avatars/\" + spaceUserSign.sign);\n\t\t\telse\n\t\t\t\treturn Steedos.absoluteUrl(\"api/files/avatars/\" + spaceUserSign.sign);\n","ImageSign.helpers = {\n  spaceUserSign: function(userId) {\n    var space, spaceUserSign;\n    space = \"\";\n    if (Meteor.isServer) {\n      space = Template.instance().view.template.steedosData.space;\n    } else {\n      space = Session.get(\"spaceId\");\n    }\n    spaceUserSign = db.space_user_signs.findOne({\n      space: space,\n      user: userId\n    });\n    return spaceUserSign;\n  },\n  imageURL: function(userId) {\n    var absolute, spaceUserSign;\n    spaceUserSign = ImageSign.helpers.spaceUserSign(userId);\n    absolute = false;\n    if (Meteor.isServer) {\n      absolute = Template.instance().view.template.steedosData.absolute;\n    }\n    if (spaceUserSign != null ? spaceUserSign.sign : void 0) {\n      if (absolute) {\n        return Meteor.absoluteUrl(\"api/files/avatars/\" + spaceUserSign.sign);\n      } else {\n        return Steedos.absoluteUrl(\"api/files/avatars/\" + spaceUserSign.sign);\n      }\n    }\n  }\n};\n","TracesHandler.helpers =\n\tshowSignImage: (handler, is_finished, judge, traceShowSignImage) ->\n\t\tif traceShowSignImage == false\n\t\t\treturn false\n\t\tif !is_finished\n\t\t\treturn false\n\t\tif ['returned', 'terminated', 'retrieved'].includes(judge)\n\t\t\treturn false\n\t\tspaceUserSign = ImageSign.helpers.spaceUserSign(handler)\n\n\t\tif spaceUserSign?.sign\n\t\t\treturn true\n\t\telse\n\t\t\treturn false\n\n\tobjectUrl: (object_name, record_id, app_id)->\n\t\treturn Creator.getObjectUrl(object_name, record_id, app_id)","TracesHandler.helpers = {\n  showSignImage: function(handler, is_finished, judge, traceShowSignImage) {\n    var spaceUserSign;\n    if (traceShowSignImage === false) {\n      return false;\n    }\n    if (!is_finished) {\n      return false;\n    }\n    if (['returned', 'terminated', 'retrieved'].includes(judge)) {\n      return false;\n    }\n    spaceUserSign = ImageSign.helpers.spaceUserSign(handler);\n    if (spaceUserSign != null ? spaceUserSign.sign : void 0) {\n      return true;\n    } else {\n      return false;\n    }\n  },\n  objectUrl: function(object_name, record_id, app_id) {\n    return Creator.getObjectUrl(object_name, record_id, app_id);\n  }\n};\n","marked = require(\"marked\")\nInstanceformTemplate.helpers =\n\tapplicantContext: ->\n\t\tsteedos_instance = WorkflowManager.getInstance();\n\t\tdata = {\n\t\t\tname: 'ins_applicant',\n\t\t\tatts: {name: 'ins_applicant', id: 'ins_applicant', class: 'selectUser form-control ins_applicant'},\n\t\t\tvalue: steedos_instance.applicant_name\n\t\t}\n\t\tif not steedos_instance || steedos_instance.state != \"draft\"\n\t\t\tdata.atts.disabled = true\n\t\treturn data;\n\n\tinstanceId: ->\n\t\treturn 'instanceform';#\"instance_\" + Session.get(\"instanceId\");\n\n\tform_types: ->\n\t\tif ApproveManager.isReadOnly()\n\t\t\treturn 'disabled';\n\t\telse\n\t\t\treturn 'method';\n\n\tsteedos_form: ->\n\t\tform_version = WorkflowManager.getInstanceFormVersion();\n\t\tif form_version\n\t\t\treturn form_version\n\n\tinnersubformContext: (obj)->\n\t\tdoc_values = WorkflowManager_format.getAutoformSchemaValues();\n\t\tobj[\"tableValues\"] = if doc_values then doc_values[obj.code] else []\n\t\tobj[\"formId\"] = \"instanceform\";\n\t\treturn obj;\n\n\tinstance: ->\n\t\tSession.get(\"change_date\")\n\t\tif (Session.get(\"instanceId\"))\n\t\t\tsteedos_instance = WorkflowManager.getInstance();\n\t\t\treturn steedos_instance;\n\n\tempty: (val) ->\n\t\tif val\n\t\t\treturn false\n\t\telse\n\t\t\treturn true;\n\n\tunempty: (val) ->\n\t\tif val\n\t\t\treturn true;\n\t\telse\n\t\t\treturn false;\n\n\tequals: (a, b) ->\n\t\treturn (a == b)\n\n\tunequals: (a, b) ->\n\t\treturn !(a == b)\n\n\tincludes: (a, b) ->\n\t\treturn b.split(',').includes(a);\n\n\tinclude: (a, b) ->\n\t\treturn b.split(',').includes(a);\n\n\tfields: ->\n\t\tform_version = WorkflowManager.getInstanceFormVersion();\n\t\tif form_version\n\t\t\treturn new SimpleSchema(WorkflowManager_format.getAutoformSchema(form_version));\n\n\tformatDate: (date, options)->\n\t\tif !date\n\t\t\treturn \"\";\n\t\tif options && typeof(options) == 'string'\n\t\t\toptions = JSON.parse(options);\n\n\t\tif !options.format\n\t\t\toptions = {format: \"YYYY-MM-DD HH:mm\"}\n\n\t\treturn moment(date).format(options.format);\n\n\ttraces: ->\n\t\tif Meteor.isServer\n\t\t\tsteedosData = Template.instance()?.view?.template?.steedosData\n\t\t\tinstance = steedosData?.instance\n\t\t\tflow = InstanceReadOnlyTemplate.getFlowVersion(instance);\n\t\t\tlocale = steedosData?.locale\n\t\t\tif locale.toLocaleLowerCase() == 'zh-cn'\n\t\t\t\tlocale = \"zh-CN\"\n\t\telse\n\t\t\tinstance = WorkflowManager.getInstance();\n\n\t\t\tflow = WorkflowManager.getInstanceFlowVersion()\n\n\t\t\tlocale = Session.get(\"TAPi18n::loaded_lang\")\n\n\t\tif !instance || !flow\n\t\t\treturn {};\n\n\t\tsteps = flow.steps;\n\n\t\ttraces = {};\n\n\t\tinstance.traces?.forEach (trace)->\n\t\t\tstep = steps.findPropertyByPK(\"_id\", trace.step)\n\n\t\t\tapproves = []\n\n\t\t\ttrace.approves?.forEach (approve) ->\n\t\t\t\tif trace.is_finished == true\n# å·²ç»“æŸçš„æ˜¾ç¤ºä¸ºæ ¸å‡†/é©³å›ž/å–æ¶ˆç”³è¯·\n\t\t\t\t\tif approve.judge == 'approved'\n\t\t\t\t\t\tjudge_name = TAPi18n.__(\"Instance State approved\", {}, locale)\n\t\t\t\t\telse if approve.judge == 'rejected'\n\t\t\t\t\t\tjudge_name = TAPi18n.__(\"Instance State rejected\", {}, locale)\n\t\t\t\t\telse if approve.judge == 'terminated'\n\t\t\t\t\t\tjudge_name = TAPi18n.__(\"Instance State terminated\", {}, locale)\n\t\t\t\t\telse if approve.judge == 'reassigned'\n\t\t\t\t\t\tjudge_name = TAPi18n.__(\"Instance State reassigned\", {}, locale)\n\t\t\t\t\telse if approve.judge == 'relocated'\n\t\t\t\t\t\tjudge_name = TAPi18n.__(\"Instance State relocated\", {}, locale)\n\t\t\t\t\telse if approve.judge == ''\n\t\t\t\t\t\tjudge_name = \"\"\n\t\t\t\t\telse\n\t\t\t\t\t\tjudge_name = \"\"\n\n\t\t\t\telse\n\t\t\t\t\tjudge_name = TAPi18n.__(\"Instance State pending\", {}, locale)\n\n\t\t\t\tapproves.push\n\t\t\t\t\t_id: approve._id\n\t\t\t\t\thandler: approve.user\n\t\t\t\t\thandler_name: approve.handler_name\n\t\t\t\t\thandler_organization_name: approve.handler_organization_name\n\t\t\t\t\thandler_organization_fullname: approve.handler_organization_fullname\n\t\t\t\t\tfinish_date: approve.finish_date\n\t\t\t\t\tjudge: approve.judge\n\t\t\t\t\tjudge_name: judge_name\n\t\t\t\t\tdescription: approve.description\n\t\t\t\t\tis_finished: approve.is_finished\n\t\t\t\t\ttype: approve.type\n\t\t\t\t\topinion_fields_code: approve.opinion_fields_code\n\t\t\t\t\tsign_field_code: approve.sign_field_code\n\t\t\t\t\tis_read: approve.is_read\n\t\t\t\t\tsign_show: approve.sign_show\n\n\n\t\t\tif step\n\t\t\t\tif step.name of traces\n\t\t\t\t\ttraces[step.name] = traces[step.name].concat(approves)\n\t\t\t\telse\n\t\t\t\t\ttraces[step.name] = approves\n\n\t\treturn traces;\n\n\n\n\tdoc_values: ->\n\t\tWorkflowManager_format.getAutoformSchemaValues();\n\n\tinstance_box_style: ->\n\t\tbox = Session.get(\"box\")\n\t\tif box == \"inbox\" || box == \"draft\"\n\t\t\tjudge = Session.get(\"judge\")\n\t\t\tif judge\n\t\t\t\tif (judge == \"approved\")\n\t\t\t\t\treturn \"box-success\"\n\t\t\t\telse if (judge == \"rejected\")\n\t\t\t\t\treturn \"box-danger\"\n\t\tins = WorkflowManager.getInstance();\n\t\tif ins && ins.final_decision\n\t\t\tif ins.final_decision == \"approved\"\n\t\t\t\treturn \"box-success\"\n\t\t\telse if (ins.final_decision == \"rejected\")\n\t\t\t\treturn \"box-danger\"\n\n#is_disabled: ->\n#    ins = WorkflowManager.getInstance();\n#    if !ins\n#        return;\n#    if ins.state!=\"draft\"\n#        return \"disabled\";\n#    return;\n\n\ttable_fields: (instance)->\n\t\tif Meteor.isClient\n\t\t\tform_version = WorkflowManager.getInstanceFormVersion();\n\t\telse\n\t\t\tform_version = WorkflowManager.getFormVersion(instance.form, instance.form_version)\n\t\tif form_version\n\t\t\tfields = _.clone(form_version.fields);\n\n\t\t\tfields.forEach (field, index) ->\n\t\t\t\tfield.tr_start = \"\";\n\t\t\t\tfield.tr_end = \"\";\n\t\t\t\ttd_colspan = 1;\n#\t\t\t\tå¼ºåˆ¶è®¾ç½®æ ‡å¤´å­—æ®µä¸ºå®½å­—æ®µ\n\t\t\t\tif CoreForm?.pageTitleFieldName == field.code\n\t\t\t\t\tfield.is_wide = true\n\n\t\t\t\tif field.formula && field.type != 'odata'\n\t\t\t\t\tfield.permission = \"readonly\";\n\n\t\t\t\tif Steedos.isMobile()\n# å¦‚æžœå½“å‰å­—æ®µæ˜¯åˆ†ç»„ã€è¡¨æ ¼ã€å®½å­—æ®µ\n\t\t\t\t\tif field.type == 'section' || field.type == 'table'\n\t\t\t\t\t\tfield.td_colspan = 4;\n\t\t\t\t\telse\n\t\t\t\t\t\tfield.td_colspan = 3;\n\n\t\t\t\t\tif index != 0\n\t\t\t\t\t\tfield.tr_start = \"<tr>\";\n\t\t\t\t\t\tfield.tr_end = \"</tr>\";\n\t\t\t\telse\n\t\t\t\t\tpre_fields = fields.slice(0, index);\n\n\t\t\t\t\tpre_wide_fields = pre_fields.filterProperty(\"is_wide\", true);\n\n\t\t\t\t\ttr_start = \"\";\n\n\t\t\t\t\ttr_end = \"\";\n\n\t\t\t\t\t# å…ˆè®¡ç®—å½“å‰å­—æ®µæ˜¯å¦ä¸ºå®½å­—æ®µ\n\t\t\t\t\tbefore_field = null;\n\t\t\t\t\tafter_field = null;\n\n\t\t\t\t\tif index > 0\n\t\t\t\t\t\tbefore_field = fields[index - 1]\n\n\t\t\t\t\tif index < fields.length - 1\n\t\t\t\t\t\tafter_field = fields[index + 1]\n\n\t\t\t\t\t# å¦‚æžœå½“å‰å­—æ®µæ˜¯åˆ†ç»„ã€è¡¨æ ¼ã€å®½å­—æ®µ\n\t\t\t\t\tif field.type == 'section' || field.type == 'table'\n\t\t\t\t\t\ttd_colspan = 4;\n\t\t\t\t\telse if field.is_wide\n\t\t\t\t\t\ttd_colspan = 3;\n\t\t\t\t\telse\n# å‰åŽéƒ½æ˜¯å®½å­—æ®µ\n\t\t\t\t\t\tif before_field && after_field && before_field.is_wide && after_field.is_wide\n\t\t\t\t\t\t\tfield.is_wide = true;\n\t\t\t\t\t\t\ttd_colspan = 3;\n\n\t\t\t\t\t\t# å½“å‰æ˜¯tr ä¸‹çš„ ç¬¬ä¸€ä¸ªtd & åŽè¾¹çš„å­—æ®µæ˜¯å®½å­—æ®µ\n\t\t\t\t\t\tif (pre_fields.length + pre_wide_fields.length) % 2 == 0 && after_field && after_field.is_wide\n\t\t\t\t\t\t\tfield.is_wide = true;\n\t\t\t\t\t\t\ttd_colspan = 3;\n\n\t\t\t\t\t\t# å½“å‰æ˜¯tr ä¸‹çš„ ç¬¬ä¸€ä¸ªtd & å½“å‰å­—æ®µæ˜¯æœ€åŽä¸€ä¸ªå­—æ®µ\n\t\t\t\t\t\tif (pre_fields.length + pre_wide_fields.length) % 2 == 0 && after_field == null\n\t\t\t\t\t\t\tfield.is_wide = true;\n\t\t\t\t\t\t\ttd_colspan = 3;\n\n\t\t\t\t\tfield.td_colspan = td_colspan;\n\n\n\t\t\t\t\tif index == 0\n# tr_start = \"<tr>\"; ç”±äºŽTemplateçš„ç¼–è¯‘bugï¼Œå¯¼è‡´æ¯æ¬¡ç»™ä¸€ä¸ªtrå¼€å§‹æ—¶ï¼Œä¼šè‡ªåŠ¨è¡¥å¤´æˆ–è¡¥å°¾ã€‚å› æ­¤åœ¨ç¬¬ä¸€è¡Œè¿”å›žä¸€ä¸ªç©ºå­—ç¬¦ä¸².\n\t\t\t\t\t\ttr_start = \"<tr>\";\n\t\t\t\t\telse\n\t\t\t\t\t\tif (pre_fields.length + pre_wide_fields.length) % 2 == 0 || field.is_wide\n\t\t\t\t\t\t\tif field.type == 'table'\n\t\t\t\t\t\t\t\ttr_start = \"<tr class = \\\"tr-child-table\\\">\";\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\ttr_start = \"<tr>\";\n\n\t\t\t\t\tfield.tr_start = tr_start;\n\n\n\t\t\t\t\tif index + 1 == fields.length || field.type == 'section' || field.type == 'table' || field.is_wide\n\t\t\t\t\t\ttr_end = \"</tr>\";\n\n\t\t\t\t\tif (pre_fields.length + pre_wide_fields.length) % 2 != 0\n\t\t\t\t\t\ttr_end = \"</tr>\";\n\n\t\t\t\t\tfield.tr_end = tr_end;\n\n\t\t\treturn fields;\n\n\tsort_approve: (approves, order)->\n\t\tif !approves\n\t\t\treturn []\n\n\t\tif !approves instanceof Array\n\t\t\treturn []\n\t\telse\n\t\t\tif order == 'desc'\n\t\t\t\tapproves.sort (p1, p2) ->\n\t\t\t\t\t_p1 = 0\n\t\t\t\t\t_p2 = 0\n\n\t\t\t\t\tif p1.finish_date\n\t\t\t\t\t\t_p1 = p1.finish_date.getTime()\n\n\t\t\t\t\tif p2.finish_date\n\t\t\t\t\t\t_p2 = p2.finish_date.getTime();\n\n\t\t\t\t\treturn _p2 - _p1\n\t\t\telse\n\t\t\t\tapproves.sort (p1, p2) ->\n\t\t\t\t\t_p1 = 0\n\t\t\t\t\t_p2 = 0\n\n\t\t\t\t\tif p1.finish_date\n\t\t\t\t\t\t_p1 = p1.finish_date.getTime()\n\n\t\t\t\t\tif p2.finish_date\n\t\t\t\t\t\t_p2 = p2.finish_date.getTime();\n\n\t\t\t\t\treturn _p1 - _p2\n\t\treturn approves\n\n\t_t: (key)->\n\t\treturn TAPi18n.__(key)\n\tgetField: (code)->\n\t\tform_version = Template.instance().view.template.steedosData.form_version\n\t\tif form_version\n\t\t\treturn form_version.fields.findPropertyByPK(\"code\", code)\n\n\tgetValue: (code)->\n\t\tinstance = Template.instance().view.template.steedosData.instance\n\n\t\tform_version = Template.instance().view.template.steedosData.form_version\n\n\t\tlocale = Template.instance().view.template.steedosData.locale\n\n\t\tutcOffset = Template.instance().view.template.steedosData.utcOffset\n\n\t\tvalues = instance.values || {}\n\n\t\tif Meteor.isClient\n\t\t\tvalues = WorkflowManager_format.getAutoformSchemaValues()\n\n\t\treturn InstanceReadOnlyTemplate.getValue values[code], form_version.fields.findPropertyByPK(\"code\", code), locale, utcOffset\n\n\tgetLabel: (code)->\n\t\tform_version = Template.instance().view.template.steedosData.form_version\n\t\tInstanceReadOnlyTemplate.getLabel form_version.fields, code\n\n\tgetCfClass: (field)->\n\t\tif field?.type == \"input\" && field?.is_textarea\n\t\t\treturn \"cfTextarea\"\n\n\tgetTableThead: (field)->\n\t\treturn SteedosTable.getThead(field, false)\n\n\tgetTableBody: (field)->\n\n\t\tif Meteor.isServer\n\t\t\tinstance = Template.instance().view.template.steedosData.instance\n\t\t\tvalues = instance.values || {}\n\t\telse\n\t\t\tvalues = WorkflowManager_format.getAutoformSchemaValues()\n\n\t\ttableValue = values[field.code];\n\t\treturn SteedosTable.getTbody(field.sfields.getProperty(\"code\"), field, tableValue, false)\n\n\tshowLabel: (field)->\n\t\ttemplateData = Template.instance().data\n\t\tif templateData.label == false\n\t\t\treturn false\n\t\treturn true\n\n#\tafFieldLabelText: (op)->\n#\t\tif !Template.instance().view.template.steedosData\n#\t\t\treturn AutoForm.getLabelForField(op.name)\n#\t\telse\n#\t\t\tform_version = Template.instance().view.template.steedosData.form_version\n#\t\t\tInstanceReadOnlyTemplate.getLabel form_version.fields, op?.hash?.name\n\n\tisOpinionField: (field)->\n\t\treturn InstanceformTemplate.helpers.isOpinionField_from_string(field.formula)\n\n\tisOpinionField_from_string: (field_formula)->\n\t\treturn InstanceSignText.isOpinionField_from_string(field_formula)\n\n\tincludesOpinionField: (form, form_version)->\n\n\t\tfield_formulas = new Array();\n\n\t\tfields = db.form_versions.findOne({_id: form_version, form: form})?.fields || []\n\n\t\tfields.forEach (f)->\n\t\t\tif f.type == 'table'\n\t\t\t\tconsole.log 'ignore opinion field in table'\n\t\t\telse if f.type == 'section'\n\t\t\t\tf?.fields?.forEach (f1)->\n\t\t\t\t\tfield_formulas.push f1.formula\n\t\t\telse\n\t\t\t\tfield_formulas.push f.formula\n\n\t\t_.some field_formulas, (field_formula)->\n\t\t\treturn InstanceformTemplate.helpers.isOpinionField_from_string(field_formula)\n\n\tgetOpinionFieldStepsName: (field_formula, top_keywords)->\n\n\t\topinionFields = new Array();\n#\t\tconsole.log(\"field_formula\", field_formula)\n\t\tif InstanceformTemplate.helpers.isOpinionField_from_string(field_formula)\n\t\t\tif field_formula\n\n#\t\t\t\tfoo1 = field_formula.split(\",\")\n\t\t\t\tfoo1 = field_formula.split(\";\")\n\n#\t\t\t\tif top_keywords\n#\t\t\t\t\tfoo1 = field_formula.split(\";\")\n\n\t\t\t\tfoo1.forEach (foo)->\n\t\t\t\t\tjson_formula = {}\n\n\t\t\t\t\ttry\n\t\t\t\t\t\tjson_formula = eval(\"(\" + foo + \")\")\n\t\t\t\t\tcatch\n\t\t\t\t\t\tjson_formula = {}\n\n\t\t\t\t\tif json_formula?.yijianlan\n\t\t\t\t\t\tsf = {}\n\n\t\t\t\t\t\tsf.stepName = json_formula.yijianlan.step\n\n\t\t\t\t\t\tsf.image_sign = json_formula.yijianlan.image_sign || false\n\n\t\t\t\t\t\tsf.only_cc_opinion = json_formula.yijianlan.only_cc || false\n\n\t\t\t\t\t\tsf.default_description = json_formula.yijianlan.default\n\n\t\t\t\t\t\tsf.only_handler = json_formula.yijianlan.only_handler\n\n\t\t\t\t\t\tsf.top_keywords = json_formula.yijianlan.top_keywords || top_keywords\n\n\t\t\t\t\t\topinionFields.push(sf);\n\n\t\t\t\t\telse if(field_formula?.indexOf(\"{traces.\") > -1 || field_formula?.indexOf(\"{signature.traces.\") > -1)\n\n\t\t\t\t\t\tsf = {only_cc_opinion: false, image_sign: false, top_keywords: top_keywords}\n\n\t\t\t\t\t\tif foo.indexOf(\"{signature.\") > -1\n\t\t\t\t\t\t\tsf.image_sign = true\n\t\t\t\t\t\t\tfoo = foo.replace(\"{signature.\",\"\");\n\n\t\t\t\t\t\ts1 = foo.replace(\"{\",\"\").replace(\"}\",\"\")\n\t\t\t\t\t\tif s1.split(\".\").length > 1\n\t\t\t\t\t\t\tsf.stepName = s1.split(\".\")[1]\n\t\t\t\t\t\t\tif opinionFields.filterProperty(\"stepName\",sf.stepName).length > 0\n\t\t\t\t\t\t\t\topinionFields.findPropertyByPK(\"stepName\", sf.stepName)?.only_cc_opinion = true\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tif s1.split(\".\").length > 2\n\t\t\t\t\t\t\t\t\tif s1.split(\".\")[2]?.toLocaleLowerCase() == 'cc'\n\t\t\t\t\t\t\t\t\t\tsf.only_cc_opinion = true\n\t\t\t\t\t\topinionFields.push(sf);\n\n\t\treturn opinionFields\n\n\tshowCCOpinion: (field)->\n\t\tif field.formula?.indexOf(\"{traces.\") > -1 || field.formula?.indexOf(\"{signature.traces.\") > -1\n\t\t\ts1 = field.formula.replace(\"{signature.\",\"\").replace(\"{\",\"\").replace(\"}\",\"\")\n\t\t\tif s1.split(\".\").length > 2\n\t\t\t\tif s1.split(\".\")[2]?.toLocaleLowerCase() == 'cc'\n\t\t\t\t\treturn true\n\t\treturn false\n\n\tmarkDownToHtml: (markDownString)->\n\t\tif markDownString\n\t\t\t# renderer = new Markdown.Renderer();\n\t\t\t# renderer.link = ( href, title, text ) ->\n\t\t\t# \treturn \"<a target='_blank' href='#{href}' title='#{title}'>#{text}</a>\"\n\t\t\tif Meteor.isServer\n\t\t\t\tmarked = Npm.require('marked')\n\t\t\treturn Spacebars.SafeString(marked.parse(markDownString))\n\n\tf_label: (that)->\n\t\treturn that.name || that.code\n\nif Meteor.isServer\n\tInstanceformTemplate.helpers.steedos_form = ->\n\t\treturn this.form_version\n\n\tInstanceformTemplate.helpers.isSection = (code)->\n\t\tform_version = this.form_version\n\t\treturn form_version.fields.findPropertyByPK(\"code\", code).type == 'section'\n\n\tInstanceformTemplate.helpers.doc_values = ->\n\t\tinstance = this.instance;\n\t\treturn instance.values;\n\n\tInstanceformTemplate.helpers.applicantContext = ->\n\t\tinstance = this.instance;\n\t\tdata = {\n\t\t\tname: 'ins_applicant',\n\t\t\tatts: {name: 'ins_applicant', id: 'ins_applicant', class: 'selectUser form-control ins_applicant'},\n\t\t\tvalue: instance.applicant_name\n\t\t}\n\n\tInstanceformTemplate.helpers.instance = ->\n\t\treturn this.instance\n\n\tInstanceformTemplate.helpers.fields = ->\n\t\tform_version = this.form_version\n\t\tif form_version\n\t\t\treturn new SimpleSchema(WorkflowManager_format.getAutoformSchema(form_version));\n\n\tInstanceformTemplate.helpers.form_types = ->\n\t\treturn \"disabled\"\n\n\tTemplate.registerHelper \"afFieldLabelText\", (op)->\n\t\tform_version = Template.instance().view.template.steedosData.form_version\n\t\tInstanceReadOnlyTemplate.getLabel form_version.fields, op?.hash?.name\n\n\tInstanceformTemplate.helpers._t = (key)->\n\t\tlocale = this.locale\n\n\t\treturn TAPi18n.__(key, {}, locale)\n\n\tInstanceformTemplate.helpers.ins_attach_download_url = (_id, absolute)->\n\t\tif absolute\n\t\t\treturn Meteor.absoluteUrl(\"/api/files/instances/#{_id}?download=true\");\n\t\telse\n\t\t\treturn \"/api/files/instances/#{_id}?download=true\";\n\n\tInstanceformTemplate.helpers.options = (field)->\n\t\toptions = field?.options?.split(\"\\n\")\n\t\trev = []\n\t\toptions?.forEach (item)->\n\t\t\trev.push({label: item, value: item})\n\n\t\treturn rev\n\n\tInstanceformTemplate.helpers.getPermissions = (code)->\n\t\tif !Template.instance().view.template.steedosData.startStepEditableFields?.includes(code)\n\t\t\treturn \"readonly disabled\"\n\t\treturn \"\"\n\nInstanceformTemplate.events =\n\t'change .form-control,.checkbox input,.af-radio-group input,.af-checkbox-group input': (event)->\n\t\tInstanceManager.instanceformChangeEvent(event)\n\n\t'typeahead:change .form-control': (event) ->\n\t\tInstanceManager.instanceformChangeEvent(event)\n\n\t'click .cfTextarea a': (event)->\n\t\tevent.preventDefault();\n\t\tSteedos.openWindow(event.target.href);\n\n\nInstanceformTemplate.onCreated = ()->\n\tinstance = WorkflowManager.getInstance();\n\tif !instance\n\t\treturn;\n\n\ttemplate = TemplateManager.getTemplate(instance);\n\n\ttry\n\t\tcompiled = SpacebarsCompiler.compile(template, {isBody: true});\n\tcatch e\n\t\tconsole.log \"Instance Template Error\", e\n\t\tcompiled = SpacebarsCompiler.compile(\"\", {isBody: true});\n\n\n\trenderFunction = eval(compiled);\n\n\tinstanceView = new Blaze.View(\"custom_instance_template\", renderFunction);\n\n\tinstanceCustomTemplate = new Blaze.Template(instanceView.name, renderFunction);\n\n\tTemplate.instance_custom_template = instanceCustomTemplate\n\n\tTemplate.instance_custom_template.helpers InstanceformTemplate.helpers\n\n\n\n\nInstanceformTemplate.onRendered = ()->\n\t# t = this;\n\n\t#t.subscribe \"instance_data\", Session.get(\"instanceId\"), ->\n\t#    Tracker.afterFlush ->\n\tinstance = WorkflowManager.getInstance();\n\tif !instance\n\t\treturn;\n\n\t#$(\"#ins_applicant\").select2().val(instance.applicant).trigger('change');\n\t#$(\"#ins_applicant\").val(instance.applicant);\n\tInstanceManager.setInstanceFormApplicant(instance.applicant, instance.applicant_name)\n\n\n\tApproveManager.error = {nextSteps: '', nextStepUsers: ''};\n\n\t# instance fromç»‘å®šäº‹ä»¶\n\tif Session.get(\"box\") == 'inbox' || Session.get(\"box\") == 'draft'\n\t\tInstanceEvent.initEvents(instance.flow);\n\n\tif !ApproveManager.isReadOnly()\n\n\t\tcurrentApprove = InstanceManager.getCurrentApprove();\n\n\n\t\tinstanceNumberFields = $(\"[data-formula]\", $(\"#instanceform\"))\n\n\t\tinstanceNumberFields.each ()->\n\t\t\tschemaKey = this.dataset.schemaKey\n\t\t\telement = $(this)\n\t\t\tif !$(this).val() && schemaKey && Session.get(\"instanceId\")\n\t\t\t\tMeteor.call 'getInstanceValues', Session.get(\"instanceId\"), (error, result)->\n\t\t\t\t\tif error\n\t\t\t\t\t\ttoastr.error(error.reason)\n\n\t\t\t\t\tif !result[schemaKey]\n\t\t\t\t\t\tkey = element.data(\"formula\")?.replace(\"auto_number(\", \"\").replace(\")\", \"\")\n\n\t\t\t\t\t\tkey = key.replace(/\\\"/g, \"\").replace(/\\'/g, \"\")\n\n\t\t\t\t\t\tif key.indexOf(\"{\") > -1\n\t\t\t\t\t\t\tkey = key.replace(\"{\",\"\").replace(\"}\",\"\")\n\t\t\t\t\t\t\tkey = key.trim()\n\t\t\t\t\t\t\tkey = AutoForm.getFieldValue(key, 'instanceform')\n\t\t\t\t\t\tInstanceNumberRules.instanceNumberBuilder element, key\n\t\t\t\t\telse\n\t\t\t\t\t\telement?.val(result[schemaKey]).trigger(\"change\")\n\n\t\tjudge = currentApprove.judge\n\t\tcurrentStep = InstanceManager.getCurrentStep();\n\t\tform_version = WorkflowManager.getInstanceFormVersion();\n\n\t\tunless form_version\n\t\t\treturn\n\n\t\tunless form_version.fields\n\t\t\treturn\n\n\t\tformula_fields = Form_formula.getFormulaFieldVariable(\"Form_formula.field_values\", form_version.fields);\n\t\tinsertDoc = AutoForm.getFormValues(\"instanceform\", undefined, undefined, false)\n\t\tForm_formula.run(\"\", \"\", formula_fields, insertDoc, form_version.fields);\n\t\t#åœ¨æ­¤å¤„åˆå§‹åŒ–session ä¸­çš„ form_values å˜é‡ï¼Œç”¨äºŽè§¦å‘ä¸‹ä¸€æ­¥æ­¥éª¤è®¡ç®—\n\t\tSession.set(\"instance_form_values\", {instanceId: instance._id, values: insertDoc});\n\n\n\n","var marked;\n\nmarked = require(\"marked\");\n\nInstanceformTemplate.helpers = {\n  applicantContext: function() {\n    var data, steedos_instance;\n    steedos_instance = WorkflowManager.getInstance();\n    data = {\n      name: 'ins_applicant',\n      atts: {\n        name: 'ins_applicant',\n        id: 'ins_applicant',\n        \"class\": 'selectUser form-control ins_applicant'\n      },\n      value: steedos_instance.applicant_name\n    };\n    if (!steedos_instance || steedos_instance.state !== \"draft\") {\n      data.atts.disabled = true;\n    }\n    return data;\n  },\n  instanceId: function() {\n    return 'instanceform';\n  },\n  form_types: function() {\n    if (ApproveManager.isReadOnly()) {\n      return 'disabled';\n    } else {\n      return 'method';\n    }\n  },\n  steedos_form: function() {\n    var form_version;\n    form_version = WorkflowManager.getInstanceFormVersion();\n    if (form_version) {\n      return form_version;\n    }\n  },\n  innersubformContext: function(obj) {\n    var doc_values;\n    doc_values = WorkflowManager_format.getAutoformSchemaValues();\n    obj[\"tableValues\"] = doc_values ? doc_values[obj.code] : [];\n    obj[\"formId\"] = \"instanceform\";\n    return obj;\n  },\n  instance: function() {\n    var steedos_instance;\n    Session.get(\"change_date\");\n    if (Session.get(\"instanceId\")) {\n      steedos_instance = WorkflowManager.getInstance();\n      return steedos_instance;\n    }\n  },\n  empty: function(val) {\n    if (val) {\n      return false;\n    } else {\n      return true;\n    }\n  },\n  unempty: function(val) {\n    if (val) {\n      return true;\n    } else {\n      return false;\n    }\n  },\n  equals: function(a, b) {\n    return a === b;\n  },\n  unequals: function(a, b) {\n    return !(a === b);\n  },\n  includes: function(a, b) {\n    return b.split(',').includes(a);\n  },\n  include: function(a, b) {\n    return b.split(',').includes(a);\n  },\n  fields: function() {\n    var form_version;\n    form_version = WorkflowManager.getInstanceFormVersion();\n    if (form_version) {\n      return new SimpleSchema(WorkflowManager_format.getAutoformSchema(form_version));\n    }\n  },\n  formatDate: function(date, options) {\n    if (!date) {\n      return \"\";\n    }\n    if (options && typeof options === 'string') {\n      options = JSON.parse(options);\n    }\n    if (!options.format) {\n      options = {\n        format: \"YYYY-MM-DD HH:mm\"\n      };\n    }\n    return moment(date).format(options.format);\n  },\n  traces: function() {\n    var flow, instance, locale, ref, ref1, ref2, ref3, steedosData, steps, traces;\n    if (Meteor.isServer) {\n      steedosData = (ref = Template.instance()) != null ? (ref1 = ref.view) != null ? (ref2 = ref1.template) != null ? ref2.steedosData : void 0 : void 0 : void 0;\n      instance = steedosData != null ? steedosData.instance : void 0;\n      flow = InstanceReadOnlyTemplate.getFlowVersion(instance);\n      locale = steedosData != null ? steedosData.locale : void 0;\n      if (locale.toLocaleLowerCase() === 'zh-cn') {\n        locale = \"zh-CN\";\n      }\n    } else {\n      instance = WorkflowManager.getInstance();\n      flow = WorkflowManager.getInstanceFlowVersion();\n      locale = Session.get(\"TAPi18n::loaded_lang\");\n    }\n    if (!instance || !flow) {\n      return {};\n    }\n    steps = flow.steps;\n    traces = {};\n    if ((ref3 = instance.traces) != null) {\n      ref3.forEach(function(trace) {\n        var approves, ref4, step;\n        step = steps.findPropertyByPK(\"_id\", trace.step);\n        approves = [];\n        if ((ref4 = trace.approves) != null) {\n          ref4.forEach(function(approve) {\n            var judge_name;\n            if (trace.is_finished === true) {\n              if (approve.judge === 'approved') {\n                judge_name = TAPi18n.__(\"Instance State approved\", {}, locale);\n              } else if (approve.judge === 'rejected') {\n                judge_name = TAPi18n.__(\"Instance State rejected\", {}, locale);\n              } else if (approve.judge === 'terminated') {\n                judge_name = TAPi18n.__(\"Instance State terminated\", {}, locale);\n              } else if (approve.judge === 'reassigned') {\n                judge_name = TAPi18n.__(\"Instance State reassigned\", {}, locale);\n              } else if (approve.judge === 'relocated') {\n                judge_name = TAPi18n.__(\"Instance State relocated\", {}, locale);\n              } else if (approve.judge === '') {\n                judge_name = \"\";\n              } else {\n                judge_name = \"\";\n              }\n            } else {\n              judge_name = TAPi18n.__(\"Instance State pending\", {}, locale);\n            }\n            return approves.push({\n              _id: approve._id,\n              handler: approve.user,\n              handler_name: approve.handler_name,\n              handler_organization_name: approve.handler_organization_name,\n              handler_organization_fullname: approve.handler_organization_fullname,\n              finish_date: approve.finish_date,\n              judge: approve.judge,\n              judge_name: judge_name,\n              description: approve.description,\n              is_finished: approve.is_finished,\n              type: approve.type,\n              opinion_fields_code: approve.opinion_fields_code,\n              sign_field_code: approve.sign_field_code,\n              is_read: approve.is_read,\n              sign_show: approve.sign_show\n            });\n          });\n        }\n        if (step) {\n          if (step.name in traces) {\n            return traces[step.name] = traces[step.name].concat(approves);\n          } else {\n            return traces[step.name] = approves;\n          }\n        }\n      });\n    }\n    return traces;\n  },\n  doc_values: function() {\n    return WorkflowManager_format.getAutoformSchemaValues();\n  },\n  instance_box_style: function() {\n    var box, ins, judge;\n    box = Session.get(\"box\");\n    if (box === \"inbox\" || box === \"draft\") {\n      judge = Session.get(\"judge\");\n      if (judge) {\n        if (judge === \"approved\") {\n          return \"box-success\";\n        } else if (judge === \"rejected\") {\n          return \"box-danger\";\n        }\n      }\n    }\n    ins = WorkflowManager.getInstance();\n    if (ins && ins.final_decision) {\n      if (ins.final_decision === \"approved\") {\n        return \"box-success\";\n      } else if (ins.final_decision === \"rejected\") {\n        return \"box-danger\";\n      }\n    }\n  },\n  table_fields: function(instance) {\n    var fields, form_version;\n    if (Meteor.isClient) {\n      form_version = WorkflowManager.getInstanceFormVersion();\n    } else {\n      form_version = WorkflowManager.getFormVersion(instance.form, instance.form_version);\n    }\n    if (form_version) {\n      fields = _.clone(form_version.fields);\n      fields.forEach(function(field, index) {\n        var after_field, before_field, pre_fields, pre_wide_fields, td_colspan, tr_end, tr_start;\n        field.tr_start = \"\";\n        field.tr_end = \"\";\n        td_colspan = 1;\n        if ((typeof CoreForm !== \"undefined\" && CoreForm !== null ? CoreForm.pageTitleFieldName : void 0) === field.code) {\n          field.is_wide = true;\n        }\n        if (field.formula && field.type !== 'odata') {\n          field.permission = \"readonly\";\n        }\n        if (Steedos.isMobile()) {\n          if (field.type === 'section' || field.type === 'table') {\n            field.td_colspan = 4;\n          } else {\n            field.td_colspan = 3;\n          }\n          if (index !== 0) {\n            field.tr_start = \"<tr>\";\n            return field.tr_end = \"</tr>\";\n          }\n        } else {\n          pre_fields = fields.slice(0, index);\n          pre_wide_fields = pre_fields.filterProperty(\"is_wide\", true);\n          tr_start = \"\";\n          tr_end = \"\";\n          before_field = null;\n          after_field = null;\n          if (index > 0) {\n            before_field = fields[index - 1];\n          }\n          if (index < fields.length - 1) {\n            after_field = fields[index + 1];\n          }\n          if (field.type === 'section' || field.type === 'table') {\n            td_colspan = 4;\n          } else if (field.is_wide) {\n            td_colspan = 3;\n          } else {\n            if (before_field && after_field && before_field.is_wide && after_field.is_wide) {\n              field.is_wide = true;\n              td_colspan = 3;\n            }\n            if ((pre_fields.length + pre_wide_fields.length) % 2 === 0 && after_field && after_field.is_wide) {\n              field.is_wide = true;\n              td_colspan = 3;\n            }\n            if ((pre_fields.length + pre_wide_fields.length) % 2 === 0 && after_field === null) {\n              field.is_wide = true;\n              td_colspan = 3;\n            }\n          }\n          field.td_colspan = td_colspan;\n          if (index === 0) {\n            tr_start = \"<tr>\";\n          } else {\n            if ((pre_fields.length + pre_wide_fields.length) % 2 === 0 || field.is_wide) {\n              if (field.type === 'table') {\n                tr_start = \"<tr class = \\\"tr-child-table\\\">\";\n              } else {\n                tr_start = \"<tr>\";\n              }\n            }\n          }\n          field.tr_start = tr_start;\n          if (index + 1 === fields.length || field.type === 'section' || field.type === 'table' || field.is_wide) {\n            tr_end = \"</tr>\";\n          }\n          if ((pre_fields.length + pre_wide_fields.length) % 2 !== 0) {\n            tr_end = \"</tr>\";\n          }\n          return field.tr_end = tr_end;\n        }\n      });\n      return fields;\n    }\n  },\n  sort_approve: function(approves, order) {\n    if (!approves) {\n      return [];\n    }\n    if (!approves instanceof Array) {\n      return [];\n    } else {\n      if (order === 'desc') {\n        approves.sort(function(p1, p2) {\n          var _p1, _p2;\n          _p1 = 0;\n          _p2 = 0;\n          if (p1.finish_date) {\n            _p1 = p1.finish_date.getTime();\n          }\n          if (p2.finish_date) {\n            _p2 = p2.finish_date.getTime();\n          }\n          return _p2 - _p1;\n        });\n      } else {\n        approves.sort(function(p1, p2) {\n          var _p1, _p2;\n          _p1 = 0;\n          _p2 = 0;\n          if (p1.finish_date) {\n            _p1 = p1.finish_date.getTime();\n          }\n          if (p2.finish_date) {\n            _p2 = p2.finish_date.getTime();\n          }\n          return _p1 - _p2;\n        });\n      }\n    }\n    return approves;\n  },\n  _t: function(key) {\n    return TAPi18n.__(key);\n  },\n  getField: function(code) {\n    var form_version;\n    form_version = Template.instance().view.template.steedosData.form_version;\n    if (form_version) {\n      return form_version.fields.findPropertyByPK(\"code\", code);\n    }\n  },\n  getValue: function(code) {\n    var form_version, instance, locale, utcOffset, values;\n    instance = Template.instance().view.template.steedosData.instance;\n    form_version = Template.instance().view.template.steedosData.form_version;\n    locale = Template.instance().view.template.steedosData.locale;\n    utcOffset = Template.instance().view.template.steedosData.utcOffset;\n    values = instance.values || {};\n    if (Meteor.isClient) {\n      values = WorkflowManager_format.getAutoformSchemaValues();\n    }\n    return InstanceReadOnlyTemplate.getValue(values[code], form_version.fields.findPropertyByPK(\"code\", code), locale, utcOffset);\n  },\n  getLabel: function(code) {\n    var form_version;\n    form_version = Template.instance().view.template.steedosData.form_version;\n    return InstanceReadOnlyTemplate.getLabel(form_version.fields, code);\n  },\n  getCfClass: function(field) {\n    if ((field != null ? field.type : void 0) === \"input\" && (field != null ? field.is_textarea : void 0)) {\n      return \"cfTextarea\";\n    }\n  },\n  getTableThead: function(field) {\n    return SteedosTable.getThead(field, false);\n  },\n  getTableBody: function(field) {\n    var instance, tableValue, values;\n    if (Meteor.isServer) {\n      instance = Template.instance().view.template.steedosData.instance;\n      values = instance.values || {};\n    } else {\n      values = WorkflowManager_format.getAutoformSchemaValues();\n    }\n    tableValue = values[field.code];\n    return SteedosTable.getTbody(field.sfields.getProperty(\"code\"), field, tableValue, false);\n  },\n  showLabel: function(field) {\n    var templateData;\n    templateData = Template.instance().data;\n    if (templateData.label === false) {\n      return false;\n    }\n    return true;\n  },\n  isOpinionField: function(field) {\n    return InstanceformTemplate.helpers.isOpinionField_from_string(field.formula);\n  },\n  isOpinionField_from_string: function(field_formula) {\n    return InstanceSignText.isOpinionField_from_string(field_formula);\n  },\n  includesOpinionField: function(form, form_version) {\n    var field_formulas, fields, ref;\n    field_formulas = new Array();\n    fields = ((ref = db.form_versions.findOne({\n      _id: form_version,\n      form: form\n    })) != null ? ref.fields : void 0) || [];\n    fields.forEach(function(f) {\n      var ref1;\n      if (f.type === 'table') {\n        return console.log('ignore opinion field in table');\n      } else if (f.type === 'section') {\n        return f != null ? (ref1 = f.fields) != null ? ref1.forEach(function(f1) {\n          return field_formulas.push(f1.formula);\n        }) : void 0 : void 0;\n      } else {\n        return field_formulas.push(f.formula);\n      }\n    });\n    return _.some(field_formulas, function(field_formula) {\n      return InstanceformTemplate.helpers.isOpinionField_from_string(field_formula);\n    });\n  },\n  getOpinionFieldStepsName: function(field_formula, top_keywords) {\n    var foo1, opinionFields;\n    opinionFields = new Array();\n    if (InstanceformTemplate.helpers.isOpinionField_from_string(field_formula)) {\n      if (field_formula) {\n        foo1 = field_formula.split(\";\");\n        foo1.forEach(function(foo) {\n          var json_formula, ref, ref1, s1, sf;\n          json_formula = {};\n          try {\n            json_formula = eval(\"(\" + foo + \")\");\n          } catch (error1) {\n            json_formula = {};\n          }\n          if (json_formula != null ? json_formula.yijianlan : void 0) {\n            sf = {};\n            sf.stepName = json_formula.yijianlan.step;\n            sf.image_sign = json_formula.yijianlan.image_sign || false;\n            sf.only_cc_opinion = json_formula.yijianlan.only_cc || false;\n            sf.default_description = json_formula.yijianlan[\"default\"];\n            sf.only_handler = json_formula.yijianlan.only_handler;\n            sf.top_keywords = json_formula.yijianlan.top_keywords || top_keywords;\n            return opinionFields.push(sf);\n          } else if ((field_formula != null ? field_formula.indexOf(\"{traces.\") : void 0) > -1 || (field_formula != null ? field_formula.indexOf(\"{signature.traces.\") : void 0) > -1) {\n            sf = {\n              only_cc_opinion: false,\n              image_sign: false,\n              top_keywords: top_keywords\n            };\n            if (foo.indexOf(\"{signature.\") > -1) {\n              sf.image_sign = true;\n              foo = foo.replace(\"{signature.\", \"\");\n            }\n            s1 = foo.replace(\"{\", \"\").replace(\"}\", \"\");\n            if (s1.split(\".\").length > 1) {\n              sf.stepName = s1.split(\".\")[1];\n              if (opinionFields.filterProperty(\"stepName\", sf.stepName).length > 0) {\n                if ((ref = opinionFields.findPropertyByPK(\"stepName\", sf.stepName)) != null) {\n                  ref.only_cc_opinion = true;\n                }\n              } else {\n                if (s1.split(\".\").length > 2) {\n                  if (((ref1 = s1.split(\".\")[2]) != null ? ref1.toLocaleLowerCase() : void 0) === 'cc') {\n                    sf.only_cc_opinion = true;\n                  }\n                }\n              }\n            }\n            return opinionFields.push(sf);\n          }\n        });\n      }\n    }\n    return opinionFields;\n  },\n  showCCOpinion: function(field) {\n    var ref, ref1, ref2, s1;\n    if (((ref = field.formula) != null ? ref.indexOf(\"{traces.\") : void 0) > -1 || ((ref1 = field.formula) != null ? ref1.indexOf(\"{signature.traces.\") : void 0) > -1) {\n      s1 = field.formula.replace(\"{signature.\", \"\").replace(\"{\", \"\").replace(\"}\", \"\");\n      if (s1.split(\".\").length > 2) {\n        if (((ref2 = s1.split(\".\")[2]) != null ? ref2.toLocaleLowerCase() : void 0) === 'cc') {\n          return true;\n        }\n      }\n    }\n    return false;\n  },\n  markDownToHtml: function(markDownString) {\n    if (markDownString) {\n      if (Meteor.isServer) {\n        marked = Npm.require('marked');\n      }\n      return Spacebars.SafeString(marked.parse(markDownString));\n    }\n  },\n  f_label: function(that) {\n    return that.name || that.code;\n  }\n};\n\nif (Meteor.isServer) {\n  InstanceformTemplate.helpers.steedos_form = function() {\n    return this.form_version;\n  };\n  InstanceformTemplate.helpers.isSection = function(code) {\n    var form_version;\n    form_version = this.form_version;\n    return form_version.fields.findPropertyByPK(\"code\", code).type === 'section';\n  };\n  InstanceformTemplate.helpers.doc_values = function() {\n    var instance;\n    instance = this.instance;\n    return instance.values;\n  };\n  InstanceformTemplate.helpers.applicantContext = function() {\n    var data, instance;\n    instance = this.instance;\n    return data = {\n      name: 'ins_applicant',\n      atts: {\n        name: 'ins_applicant',\n        id: 'ins_applicant',\n        \"class\": 'selectUser form-control ins_applicant'\n      },\n      value: instance.applicant_name\n    };\n  };\n  InstanceformTemplate.helpers.instance = function() {\n    return this.instance;\n  };\n  InstanceformTemplate.helpers.fields = function() {\n    var form_version;\n    form_version = this.form_version;\n    if (form_version) {\n      return new SimpleSchema(WorkflowManager_format.getAutoformSchema(form_version));\n    }\n  };\n  InstanceformTemplate.helpers.form_types = function() {\n    return \"disabled\";\n  };\n  Template.registerHelper(\"afFieldLabelText\", function(op) {\n    var form_version, ref;\n    form_version = Template.instance().view.template.steedosData.form_version;\n    return InstanceReadOnlyTemplate.getLabel(form_version.fields, op != null ? (ref = op.hash) != null ? ref.name : void 0 : void 0);\n  });\n  InstanceformTemplate.helpers._t = function(key) {\n    var locale;\n    locale = this.locale;\n    return TAPi18n.__(key, {}, locale);\n  };\n  InstanceformTemplate.helpers.ins_attach_download_url = function(_id, absolute) {\n    if (absolute) {\n      return Meteor.absoluteUrl(\"/api/files/instances/\" + _id + \"?download=true\");\n    } else {\n      return \"/api/files/instances/\" + _id + \"?download=true\";\n    }\n  };\n  InstanceformTemplate.helpers.options = function(field) {\n    var options, ref, rev;\n    options = field != null ? (ref = field.options) != null ? ref.split(\"\\n\") : void 0 : void 0;\n    rev = [];\n    if (options != null) {\n      options.forEach(function(item) {\n        return rev.push({\n          label: item,\n          value: item\n        });\n      });\n    }\n    return rev;\n  };\n  InstanceformTemplate.helpers.getPermissions = function(code) {\n    var ref;\n    if (!((ref = Template.instance().view.template.steedosData.startStepEditableFields) != null ? ref.includes(code) : void 0)) {\n      return \"readonly disabled\";\n    }\n    return \"\";\n  };\n}\n\nInstanceformTemplate.events = {\n  'change .form-control,.checkbox input,.af-radio-group input,.af-checkbox-group input': function(event) {\n    return InstanceManager.instanceformChangeEvent(event);\n  },\n  'typeahead:change .form-control': function(event) {\n    return InstanceManager.instanceformChangeEvent(event);\n  },\n  'click .cfTextarea a': function(event) {\n    event.preventDefault();\n    return Steedos.openWindow(event.target.href);\n  }\n};\n\nInstanceformTemplate.onCreated = function() {\n  var compiled, e, instance, instanceCustomTemplate, instanceView, renderFunction, template;\n  instance = WorkflowManager.getInstance();\n  if (!instance) {\n    return;\n  }\n  template = TemplateManager.getTemplate(instance);\n  try {\n    compiled = SpacebarsCompiler.compile(template, {\n      isBody: true\n    });\n  } catch (error1) {\n    e = error1;\n    console.log(\"Instance Template Error\", e);\n    compiled = SpacebarsCompiler.compile(\"\", {\n      isBody: true\n    });\n  }\n  renderFunction = eval(compiled);\n  instanceView = new Blaze.View(\"custom_instance_template\", renderFunction);\n  instanceCustomTemplate = new Blaze.Template(instanceView.name, renderFunction);\n  Template.instance_custom_template = instanceCustomTemplate;\n  return Template.instance_custom_template.helpers(InstanceformTemplate.helpers);\n};\n\nInstanceformTemplate.onRendered = function() {\n  var currentApprove, currentStep, form_version, formula_fields, insertDoc, instance, instanceNumberFields, judge;\n  instance = WorkflowManager.getInstance();\n  if (!instance) {\n    return;\n  }\n  InstanceManager.setInstanceFormApplicant(instance.applicant, instance.applicant_name);\n  ApproveManager.error = {\n    nextSteps: '',\n    nextStepUsers: ''\n  };\n  if (Session.get(\"box\") === 'inbox' || Session.get(\"box\") === 'draft') {\n    InstanceEvent.initEvents(instance.flow);\n  }\n  if (!ApproveManager.isReadOnly()) {\n    currentApprove = InstanceManager.getCurrentApprove();\n    instanceNumberFields = $(\"[data-formula]\", $(\"#instanceform\"));\n    instanceNumberFields.each(function() {\n      var element, schemaKey;\n      schemaKey = this.dataset.schemaKey;\n      element = $(this);\n      if (!$(this).val() && schemaKey && Session.get(\"instanceId\")) {\n        return Meteor.call('getInstanceValues', Session.get(\"instanceId\"), function(error, result) {\n          var key, ref;\n          if (error) {\n            toastr.error(error.reason);\n          }\n          if (!result[schemaKey]) {\n            key = (ref = element.data(\"formula\")) != null ? ref.replace(\"auto_number(\", \"\").replace(\")\", \"\") : void 0;\n            key = key.replace(/\\\"/g, \"\").replace(/\\'/g, \"\");\n            if (key.indexOf(\"{\") > -1) {\n              key = key.replace(\"{\", \"\").replace(\"}\", \"\");\n              key = key.trim();\n              key = AutoForm.getFieldValue(key, 'instanceform');\n            }\n            return InstanceNumberRules.instanceNumberBuilder(element, key);\n          } else {\n            return element != null ? element.val(result[schemaKey]).trigger(\"change\") : void 0;\n          }\n        });\n      }\n    });\n    judge = currentApprove.judge;\n    currentStep = InstanceManager.getCurrentStep();\n    form_version = WorkflowManager.getInstanceFormVersion();\n    if (!form_version) {\n      return;\n    }\n    if (!form_version.fields) {\n      return;\n    }\n    formula_fields = Form_formula.getFormulaFieldVariable(\"Form_formula.field_values\", form_version.fields);\n    insertDoc = AutoForm.getFormValues(\"instanceform\", void 0, void 0, false);\n    Form_formula.run(\"\", \"\", formula_fields, insertDoc, form_version.fields);\n    return Session.set(\"instance_form_values\", {\n      instanceId: instance._id,\n      values: insertDoc\n    });\n  }\n};\n","InstanceAttachmentTemplate.helpers = {\n\n\tshowMainTitle: function() {\n\t\treturn Template.instance().workflowMainAttachTitle.get();\n\t},\n\tisClient: function() {\n\t\treturn Meteor.isClient\n\t},\n\tenabled_add_main_attachment: function() {\n\t\tvar ins = WorkflowManager.getInstance();\n\t\tif (!ins)\n\t\t\treturn false\n\n\t\tif (Session && Session.get(\"instancePrint\"))\n\t\t\treturn false\n\n\t\tif (Session.get(\"box\") != \"draft\" && Session.get(\"box\") != \"inbox\") {\n\t\t\treturn false\n\t\t}\n\n\t\t// å·²ç»ç»“æŸçš„å•å­ä¸èƒ½æ”¹é™„ä»¶\n\t\tif (ins.state == \"completed\") {\n\t\t\treturn false\n\t\t}\n\n\t\tvar current_step = InstanceManager.getCurrentStep();\n\n\t\tif (!current_step)\n\t\t\treturn false;\n\n\t\t// ccçš„å•å­ï¼Œåªæœ‰åœ¨å½“å‰æ­¥éª¤æ‰èƒ½ä¿®æ”¹é™„ä»¶\n\t\tvar approve = InstanceManager.getCurrentApprove();\n\t\tif (approve && approve.type == \"cc\") {\n\t\t\tvar currentTrace = InstanceManager.getCurrentTrace();\n\t\t\tif(currentTrace && currentTrace._id != approve.trace){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t// åˆ†å‘çš„æ­£æ–‡æˆ–è€…é™„ä»¶ä¸æ˜¾ç¤ºè½¬ä¸ºpdfæŒ‰é’®\n\t\t// å¦‚æžœæœ‰æ­£æ–‡æƒé™åˆ™ä¸ºæ­£æ–‡ï¼Œå¦åˆ™åˆ†å‘ä¸ºé™„ä»¶\n\t\t// åˆ†å‘çš„é™„ä»¶ä¸å…è®¸ä¿®æ”¹ åˆ é™¤ æ–°å¢žç‰ˆæœ¬\n\t\tvar main_attach_count = cfs.instances.find({\n\t\t\t'metadata.instance': ins._id,\n\t\t\t'metadata.current': true,\n\t\t\t'metadata.main': true\n\t\t}).count();\n\n\t\tvar distribute_main_attach_count = 0;\n\n\t\tif (ins.distribute_from_instance) {\n\t\t\tvar start_step = InstanceManager.getStartStep();\n\t\t\tif (start_step.can_edit_main_attach) {\n\t\t\t\tvar distribute_main_attach_count = cfs.instances.find({\n\t\t\t\t\t'metadata.instance': ins.distribute_from_instance,\n\t\t\t\t\t'metadata.current': true,\n\t\t\t\t\t'metadata.main': true\n\t\t\t\t}).count();\n\t\t\t}\n\t\t}\n\n\t\tif (current_step.can_edit_main_attach == true && main_attach_count < 1 && distribute_main_attach_count < 1) {\n\t\t\treturn true\n\t\t}\n\n\t\t// æ­£æ–‡æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ª\n\t\tif (main_attach_count >= 1 || distribute_main_attach_count >= 1) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// å¼€å§‹èŠ‚ç‚¹å¹¶ä¸”è®¾ç½®äº†å¯ä»¥ä¸Šä¼ æ­£æ–‡æ‰æ˜¾ç¤ºä¸Šä¼ æ­£æ–‡çš„æŒ‰é’®\n\t\tvar current_step = InstanceManager.getCurrentStep();\n\t\tif (current_step && current_step.step_type == \"start\" && current_step.can_edit_main_attach == true)\n\t\t\treturn true\n\n\t\treturn false\n\t},\n\n\tenabled_edit_normal_attachment: function() {\n\t\tvar ins = WorkflowManager.getInstance();\n\t\tif (!ins)\n\t\t\treturn false\n\n\t\tif (Session && Session.get(\"instancePrint\"))\n\t\t\treturn false\n\n\t\tvar flow = WorkflowManager.getFlow(ins.flow);\n\t\tif (!flow)\n\t\t\treturn false\n\n\n\t\t// åˆ†å‘åŽçš„ é™„ä»¶ï¼Œä¸å¯ä»¥ç¼–è¾‘/åˆ é™¤ï¼Œä¹Ÿä¸è®©ä¸Šä¼ æ–°çš„é™„ä»¶, æµç¨‹åˆ—è¡¨ï¼šæ·»åŠ å±žæ€§ â€˜è¢«åˆ†å‘åŽæ˜¯å¦å…è®¸ä¸Šä¼ é™„ä»¶â€™ #1837\n\t\tif (ins.distribute_from_instance && !flow.upload_after_being_distributed)\n\t\t\treturn false\n\n\t\tif (Session.get(\"box\") != \"draft\" && Session.get(\"box\") != \"inbox\") {\n\t\t\treturn false\n\t\t}\n\n\t\t// å·²ç»ç»“æŸçš„å•å­ä¸èƒ½æ”¹é™„ä»¶\n\t\tif (ins.state == \"completed\") {\n\t\t\treturn false\n\t\t}\n\n\t\t// ccçš„å•å­ï¼Œåªæœ‰åœ¨å½“å‰æ­¥éª¤æ‰èƒ½ä¿®æ”¹é™„ä»¶\n\t\tvar approve = InstanceManager.getCurrentApprove();\n\t\tif (approve && approve.type == \"cc\") {\n\t\t\tvar currentTrace = InstanceManager.getCurrentTrace();\n\t\t\tif(currentTrace && currentTrace._id != approve.trace){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (InstanceManager.isCC(ins)) {\n\t\t\tvar step = InstanceManager.getCCStep();\n\t\t\tif (step && (step.can_edit_normal_attach == true || step.can_edit_normal_attach == undefined))\n\t\t\t\treturn true\n\t\t} else {\n\t\t\tvar current_step = InstanceManager.getCurrentStep();\n\t\t\tif (current_step && (current_step.can_edit_normal_attach == true || current_step.can_edit_normal_attach == undefined))\n\t\t\t\treturn true\n\t\t}\n\n\t\treturn false\n\t},\n\n\tmain_attachment: function() {\n\t\tvar ins = WorkflowManager.getInstance();\n\t\tif (!ins)\n\t\t\treturn false\n\n\t\tvar start_step = InstanceManager.getStartStep();\n\n\t\t// å¦‚æžœæ˜¯è¢«åˆ†å‘çš„ç”³è¯·å•å¹¶ä¸”æœ‰ä¿®æ”¹æ­£æ–‡çš„æƒé™ï¼Œåˆ™ä¼˜å…ˆæ˜¾ç¤ºåŽŸç”³è¯·å•æ–‡ä»¶\n\t\tvar main_attach = null;\n\t\tif (ins.distribute_from_instance && start_step.can_edit_main_attach == true) {\n\t\t\tmain_attach = cfs.instances.findOne({\n\t\t\t\t'metadata.instance': ins.distribute_from_instance,\n\t\t\t\t'metadata.current': true,\n\t\t\t\t'metadata.main': true\n\t\t\t});\n\t\t}\n\n\t\tif (!main_attach) {\n\t\t\tmain_attach = cfs.instances.findOne({\n\t\t\t\t'metadata.instance': ins._id,\n\t\t\t\t'metadata.current': true,\n\t\t\t\t'metadata.main': true\n\t\t\t});\n\t\t}\n\n\t\treturn main_attach;\n\t},\n\n\tnormal_attachments: function() {\n\t\tvar ins = WorkflowManager.getInstance();\n\t\tif (!ins)\n\t\t\treturn false\n\n\t\tvar selector = {\n\t\t\t'metadata.current': true,\n\t\t\t'metadata.main': {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t};\n\n\t\tvar atts = new Array();\n\n\t\tif (ins.distribute_from_instance) {\n\t\t\t// å¦‚æžœæ˜¯è¢«åˆ†å‘çš„ç”³è¯·å•ï¼Œåˆ™æ˜¾ç¤ºåŽŸç”³è¯·å•æ–‡ä»¶, å¦‚æžœé€‰æ‹©äº†å°†åŽŸè¡¨å•å­˜å‚¨ä¸ºé™„ä»¶ä¹Ÿè¦æ˜¾ç¤º, åŒæ—¶ä¹Ÿè¦æ˜¾ç¤ºæ–°ä¸Šä¼ çš„é™„ä»¶\n\t\t\tvar dfis = _.clone(ins.distribute_from_instances) || [];\n\t\t\tdfis.push(ins._id);\n\t\t\tselector['metadata.instance'] = {\n\t\t\t\t$in: dfis\n\t\t\t};\n\n\n\t\t\tselector[\"$or\"] = [{\n\t\t\t\t\"metadata.instance\": ins._id\n\t\t\t}, {\n\t\t\t\t\"metadata.instance\": {\n\t\t\t\t\t$in: ins.distribute_from_instances\n\t\t\t\t},\n\t\t\t\t\"metadata.is_private\": {\n\t\t\t\t\t$ne: true\n\t\t\t\t}\n\t\t\t}]\n\n\t\t\t// å¦‚æžœåŽŸç”³è¯·å•æœ‰æ­£æ–‡ä½†æ˜¯åˆ†å‘åŽæ²¡æœ‰æ­£æ–‡æƒé™ï¼Œåˆ™åŽŸç”³è¯·å•æ­£æ–‡æ˜¾ç¤ºåœ¨é™„ä»¶æ \n\t\t\tvar start_step = InstanceManager.getStartStep();\n\t\t\tif (start_step && start_step.can_edit_main_attach != true) {\n\t\t\t\tvar distribute_main = cfs.instances.findOne({\n\t\t\t\t\t'metadata.instance': {\n\t\t\t\t\t\t$in: ins.distribute_from_instances\n\t\t\t\t\t},\n\t\t\t\t\t'metadata.current': true,\n\t\t\t\t\t'metadata.main': true,\n\t\t\t\t});\n\t\t\t\tif (distribute_main) {\n\t\t\t\t\tvar firstVersionMain = cfs.instances.findOne(distribute_main.metadata.parent);\n\t\t\t\t\tdistribute_main.attachmentUploadedAt = firstVersionMain ? firstVersionMain.uploadedAt : distribute_main.uploadedAt;\n\t\t\t\t\tatts.push(distribute_main);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tselector['metadata.instance'] = ins._id;\n\t\t}\n\n\t\tcfs.instances.find(selector).forEach(function(c) {\n\t\t\tvar firstVersion = cfs.instances.findOne(c.metadata.parent);\n\t\t\tc.attachmentUploadedAt = firstVersion ? firstVersion.uploadedAt : c.uploadedAt;\n\t\t\tatts.push(c);\n\t\t})\n\n\t\treturn _.sortBy(atts, 'attachmentUploadedAt');\n\t},\n\n\tshowAttachments: function() {\n\t\tvar ins = WorkflowManager.getInstance();\n\t\tif (!ins)\n\t\t\treturn false;\n\n\t\t// å¦‚æžœæ˜¯è¢«åˆ†å‘çš„ç”³è¯·å•ï¼Œåˆ™æ˜¾ç¤ºåŽŸç”³è¯·å•æ–‡ä»¶ å’Œåˆ†å‘åŽç”³è¯·å•æ–‡ä»¶\n\t\tvar instanceIds = _.clone(ins.distribute_from_instances) || [];\n\t\tinstanceIds.push(ins._id);\n\t\tvar attachments_count = cfs.instances.find({\n\t\t\t'metadata.instance': {\n\t\t\t\t$in: instanceIds\n\t\t\t},\n\t\t\t'metadata.current': true\n\t\t}).count();\n\n\t\tif (Session && Session.get(\"instancePrint\") && attachments_count < 1)\n\t\t\treturn false\n\n\t\tif (Session.get(\"box\") == \"draft\" || Session.get(\"box\") == \"inbox\" || attachments_count > 0)\n\t\t\treturn true;\n\t\telse\n\t\t\treturn false;\n\t},\n\n\t_t: function(key) {\n\t\treturn TAPi18n.__(key)\n\t},\n\n\t_: function(key) {\n\t\tvar locale;\n\t\tif (Meteor.isClient) {\n\t\t\treturn TAPi18n.__(key);\n\t\t} else {\n\t\t\tlocale = Template.instance().view.template.steedosData.locale;\n\t\t\treturn TAPi18n.__(key, {}, locale);\n\t\t}\n\t},\n\n\tflow_files: function() {\n\t\tvar ins = WorkflowManager.getInstance();\n\t\tif (!ins)\n\t\t\treturn false;\n\t\treturn cfs.files.find({ 'metadata.space': ins.space, 'metadata.object_name': 'flows', 'metadata.record_id': ins.flow });\n\t},\n\n\tisDraftAndFlowfilesExist: function() {\n\t\tvar ins = WorkflowManager.getInstance();\n\t\tif (!ins)\n\t\t\treturn false;\n\t\treturn (Session.get('box') == 'draft') && !!cfs.files.find({ 'metadata.space': ins.space, 'metadata.object_name': 'flows', 'metadata.record_id': ins.flow }).count();\n\t}\n\n\n}\n\nif (Meteor.isServer) {\n\tInstanceAttachmentTemplate.helpers._t = function(key) {\n\t\tlocale = Template.instance().view.template.steedosData.locale\n\t\treturn TAPi18n.__(key, {}, locale)\n\t}\n\tInstanceAttachmentTemplate.helpers.enabled_add_main_attachment = function() {\n\t\treturn false\n\t};\n\tInstanceAttachmentTemplate.helpers.enabled_edit_normal_attachment = function() {\n\t\treturn false\n\t};\n\n\tInstanceAttachmentTemplate.helpers.main_attachment = function() {\n\t\tvar instance = Template.instance().view.template.steedosData.instance;\n\t\tvar instanceIds = _.compact([instance.distribute_from_instance, instance._id]);\n\t\tvar attachment = cfs.instances.findOne({\n\t\t\t'metadata.instance': {\n\t\t\t\t$in: instanceIds\n\t\t\t},\n\t\t\t'metadata.current': true,\n\t\t\t'metadata.main': true\n\t\t});\n\n\t\treturn attachment;\n\t};\n\n\tInstanceAttachmentTemplate.helpers.normal_attachments = function() {\n\t\tvar steedosData = Template.instance().view.template.steedosData\n\t\tvar instance = steedosData.instance;\n\t\tvar instanceIds = _.clone(instance.distribute_from_instances) || [];\n\t\tinstanceIds.push(instance._id);\n\t\tvar attachments = cfs.instances.find({\n\t\t\t'metadata.instance': {\n\t\t\t\t$in: instanceIds\n\t\t\t},\n\t\t\t'metadata.current': true,\n\t\t\t'metadata.main': {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\t$or: [{\n\t\t\t\t'metadata.is_private': {\n\t\t\t\t\t$ne: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t'metadata.is_private': true,\n\t\t\t\t\"metadata.owner\": steedosData.sessionUserId || steedosData.userId || '-1' // é˜²æ­¢æ•°æ®å¼‚å¸¸æ—¶,æ˜¾ç¤ºäº†ç§æœ‰é™„ä»¶\n\t\t\t}]\n\t\t}).fetch();\n\n\t\treturn attachments;\n\t};\n\n\tInstanceAttachmentTemplate.helpers.showAttachments = function() {\n\t\tvar instance = Template.instance().view.template.steedosData.instance;\n\t\tvar instanceIds = _.clone(instance.distribute_from_instances) || [];\n\t\tinstanceIds.push(instance._id);\n\n\t\tvar attachments = cfs.instances.find({\n\t\t\t'metadata.instance': {\n\t\t\t\t$in: instanceIds\n\t\t\t},\n\t\t\t'metadata.current': true\n\t\t}).fetch();\n\n\t\tif (attachments && attachments.length > 0) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tInstanceAttachmentTemplate.helpers.showMainTitle = function() {\n\t\tvar instance = Template.instance().view.template.steedosData.instance;\n\t\tvar instanceIds = _.compact([instance.distribute_from_instance, instance._id]);\n\t\tvar main_attach_count = cfs.instances.find({\n\t\t\t'metadata.instance': {\n\t\t\t\t$in: instanceIds\n\t\t\t},\n\t\t\t'metadata.current': true,\n\t\t\t'metadata.main': true\n\t\t}).count();\n\n\t\treturn main_attach_count > 0\n\t}\n}\n","marked = require(\"marked\")\nInstanceSignText.helpers =\n\tshow: (stepName)->\n\t\tif Meteor.isClient\n\t\t\tif Session.get('instancePrint')\n\t\t\t\treturn false\n\t\t\tif InstanceManager.isInbox()\n\t\t\t\tmyApprove = InstanceManager.getCurrentApprove()\n\t\t\t\tif myApprove\n\t\t\t\t\tinstance = WorkflowManager.getInstance();\n\t\t\t\t\tmyTrace = instance?.traces?.findPropertyByPK(\"_id\", myApprove.trace)\n\t\t\t\t\treturn myTrace?.name == stepName\n\t\treturn false\n\n\tdefaultDescription: ()->\n#\t\treturn Template.instance().data.default_description || TAPi18n.__(\"instance_default_opinion\")\n\t\treturn Template.instance().data.default_description\n\n\ttraces: ()->\n\t\tInstanceformTemplate.helpers.traces()\n\n\ttrace: (stepName, only_cc_opinion, image_sign, top_keywords)->\n\t\tinstance = InstanceformTemplate.helpers.instance()\n\n\t\tis_completed = instance?.state == \"completed\"\n\n\t\tcompleted_date = if is_completed then _.last(instance.traces)?.finish_date?.getTime() else 0\n\n\t\tif is_completed && instance.finish_date\n\t\t\tcompleted_date = instance.finish_date?.getTime()\n\n\t\ttraces = InstanceformTemplate.helpers.traces()\n\n\t\tapproves = _.clone(traces[stepName])\n\n\t\tapprove_sort = (approves, top_keywords)->\n\n#å¯¹ApprovesæŽ’åºï¼Œ æŒ‰ç…§æäº¤æ—¶é—´æŽ’å€’åºï¼Œå¦‚æžœæ²¡æœ‰æäº¤åˆ™æ˜¾ç¤ºåœ¨æœ€ä¸Šè¾¹\n\t\t\tapproves_sorted = _.sortBy approves, (approve)->\n\t\t\t\treturn -(approve.finish_date || new Date()).getTime()\n\n\t\t\t#é€šè¿‡å…³é”®å­—æŽ’åº\n\t\t\tif top_keywords\n\t\t\t\ttop_approves = new Array()\n\n\t\t\t\ttop_keywords.split(\",\").forEach (key) ->\n\t\t\t\t\ttop_approves = _.union top_approves, _.filter(approves_sorted, (approve)->\n\t\t\t\t\t\treturn approve?.handler_name?.indexOf(key) > -1\n\t\t\t\t\t)\n\t\t\t\t# å¯¹ç½®é¡¶æ„è§æŒ‰ç…§å¤„ç†äº‹ä»¶æŽ’å€’åº\n\t\t\t\ttop_approves = _.sortBy top_approves, (top_approve)->\n\t\t\t\t\treturn -(top_approve.finish_date || new Date()).getTime()\n\n\t\t\t\tapproves_sorted = _.union top_approves, approves_sorted\n\t\t\treturn approves_sorted || []\n\n\t\tapproves = _.filter approves, (a)->\n\t\t\treturn a.type isnt \"forward\" and a.type isnt \"distribute\" and a.type isnt \"terminated\"\n\n\t\tif only_cc_opinion\n\t\t\tapproves = approves?.filterProperty(\"type\", \"cc\")\n\n\t\tapproves_sorted = approve_sort(approves, top_keywords)\n\n\t\tapprovesGroup = _.groupBy(approves, \"handler\");\n\n\t\thasNext = (approve, approvesGroup) ->\n\t\t\thandlerApproves = approvesGroup[approve.handler]\n\t\t\treturn _.indexOf(handlerApproves, approve) + 1 < handlerApproves.length\n\n\t\thaveDescriptionApprove = (approve, approvesGroup) ->\n\t\t\thandlerApproves = approvesGroup[approve.handler]\n\n\t\t\tdescriptionApproves = _.filter handlerApproves, (a)->\n\t\t\t\tif a.description\n\t\t\t\t\treturn true\n\t\t\t\treturn false\n\n\t\t\tif descriptionApproves.length == 0\n\t\t\t\treturn false\n\n\t\t\treturn true\n\n\n\t\tapproves_sorted.forEach (approve) ->\n#\t\t\tæœ‰è¾“å…¥æ„è§ æˆ– æœ€æ–°ä¸€æ¡å¹¶ä¸”ç”¨æˆ·æ²¡æœ‰è¾“å…¥è¿‡æ„è§\n#\t\t\tif !approve.is_finished || approve.description || (!hasNext(approve, approvesGroup) && !haveDescriptionApprove(approve, approvesGroup))\n#\t\t\tif !hasNext(approve, approvesGroup)\n\t\t\tif approve.sign_show != false && (approve.description || (!approve.description && !hasNext(approve, approvesGroup) && !approve.is_finished) || Meteor.settings.public.workflow?.showBlankApproveDescription)\n\t\t\t\tif approve.judge isnt 'terminated'\n\t\t\t\t\tapprove._display = true\n\n\t\tapproves_sorted = _.filter approves_sorted, (a) ->\n\t\t\tif is_completed\n\t\t\t\treturn a._display == true && a.is_finished && a.finish_date?.getTime() <= completed_date\n\t\t\telse\n\t\t\t\treturn a._display == true\n\t\treturn approves_sorted\n\n\tinclude: (a, b) ->\n\t\treturn InstanceformTemplate.helpers.include(a, b)\n\n\tunempty: (val)->\n\t\treturn InstanceformTemplate.helpers.unempty(val) || Meteor.settings.public.workflow?.showBlankApproveDescription\n\n\tformatDate: (date, options)->\n\t\tif !options\n\t\t\toptions = {\"format\": \"YYYY-MM-DD\"}\n\n\t\treturn InstanceformTemplate.helpers.formatDate(date, options)\n\n\tisMyApprove: (approve, only_cc_opinion) ->\n\t\tif Meteor.isClient\n\t\t\tif Session.get(\"box\") != 'inbox'\n\t\t\t\treturn false;\n\t\t\tins = WorkflowManager.getInstance();\n\n\t\t\tcurrentApprove = InstanceManager.getCurrentApprove()\n\n\t\t\tif !approve?._id\n\t\t\t\tapprove = currentApprove\n\n\t\t\tif approve._id == currentApprove?._id && currentApprove?.type == 'cc' && Template.instance().data.name\n\t\t\t\tif _.indexOf(currentApprove?.opinion_fields_code, Template.instance().data.name) > -1\n\t\t\t\t\treturn true\n\t\t\t\telse\n\t\t\t\t\treturn false\n\n\t\t\tif !(currentApprove?.type == 'cc') && only_cc_opinion\n\t\t\t\treturn false\n\n\t\t\tif currentApprove && approve._id == currentApprove._id\n\t\t\t\treturn true\n\t\treturn false\n\n\tmyApproveDescription: (approveId)->\n\t\tif Meteor.isClient\n\t\t\tif Session.get(\"box\") == 'inbox'\n\t\t\t\tmyApprove = Template.instance()?.myApprove?.get()\n\t\t\t\tif myApprove && myApprove.id == approveId\n\t\t\t\t\tif !myApprove.sign_field_code || myApprove.sign_field_code == Template.instance()?.data?.name\n\t\t\t\t\t\tif !Session.get(\"instance_my_approve_description\")\n\t\t\t\t\t\t\treturn myApprove?.description || \"\"\n\t\t\t\t\t\treturn Session.get(\"instance_my_approve_description\")\n\n\tnow: ()->\n\t\treturn new Date();\n\n\tisReadOnly: ()->\n\t\tif Meteor.isClient\n\t\t\treturn ApproveManager.isReadOnly()\n\t\treturn false\n\n\tisOpinionOfField: (approve)->\n\t\tif approve.type == \"cc\" && Template.instance().data.name\n\t\t\tif Template.instance().data.name == approve.sign_field_code\n\t\t\t\treturn true\n\t\t\telse\n\t\t\t\treturn false\n\t\telse\n\t\t\treturn true;\n\n\tmarkDownToHtml: (markDownString)->\n\t\tif markDownString\n\t\t\t# renderer = new Markdown.Renderer();\n\t\t\t# renderer.link = (href, title, text) ->\n\t\t\t# \treturn \"<a target='_blank' href='#{href}' title='#{title}'>#{text}</a>\"\n\t\t\tif Meteor.isServer\n\t\t\t\tmarked = Npm.require('marked')\n\t\t\treturn Spacebars.SafeString(marked.parse(markDownString))\n\n\tsteps: (field_formula, step, only_cc_opinion, image_sign)->\n\t\tsteps = []\n\t\tif !step\n\t\t\tif !field_formula\n\t\t\t\tfield_formula = WorkflowManager.getInstanceFormVersion()?.fields?.findPropertyByPK(\"code\", this.name).formula\n\t\t\tsteps = InstanceformTemplate.helpers.getOpinionFieldStepsName(field_formula, Template.instance()?.data.top_keywords)\n\t\telse\n\t\t\tsteps = [{stepName: step, only_cc_opinion: only_cc_opinion, image_sign: image_sign}]\n\t\treturn steps\n\n\timageSignData: (handler) ->\n\t\treturn {user: handler}\n\n\tshowSignImage: (handler, image_sign, judge) ->\n\t\tif ['returned', 'terminated', 'retrieved'].includes(judge)\n\t\t\treturn false\n\t\tspaceUserSign = ImageSign.helpers.spaceUserSign(handler)\n\n\t\tif spaceUserSign?.sign && image_sign\n\t\t\treturn true\n\t\telse\n\t\t\treturn false\n\n\tgetLastSignApprove: ()->\n\t\tins = WorkflowManager.getInstance();\n\n\t\treturn _.last(TracesManager.getHandlerSignShowApproves ins, Meteor.userId())\n\n\n\tlastMyApproveDescription: ()->\n\t\ttraces = InstanceformTemplate.helpers.traces()\n\t\tcurrentStep = InstanceManager.getCurrentStep();\n\t\tapproves = _.clone(traces[currentStep.name])\n\n\t\tapproves = approves.filterProperty(\"handler\", Meteor.userId())\n\n\t\tif approves.length > 1\n\t\t\treturn approves[approves.length - 2]?.description\n\n\t\treturn \"\";\n\n\tshowApprove: (approve)->\n\t\tif !approve.sign_field_code || approve.sign_field_code == Template.instance()?.data?.name\n\t\t\tif approve?.is_read\n\t\t\t\tif approve.is_finished\n\t\t\t\t\treturn [\"approved\", \"rejected\", \"submitted\", \"readed\"].includes(approve.judge)\n\t\treturn false;\n\n\tjudge_description: (judge)->\n\t\treturn t(judge + \"_description\")\n\n\tis_approved: (judge)->\n\t\treturn \"approved\" == judge\n\n\tis_rejected: (judge)->\n\t\treturn \"rejected\" == judge\n\n\tis_readed: (judge)->\n\t\treturn [\"approved\", \"rejected\", \"submitted\", \"readed\"].includes(judge)\n\n\taddClass: ()->\n\t\tname = Template.instance()?.data?.name\n\t\tsetTimeout () ->\n\t\t\ttry\n\t\t\t\telement = $(\".automatic.opinion-field-\" + name)\n\t\t\t\tif element.length > 0\n\t\t\t\t\tif element?.is(\"td\")\n\t\t\t\t\t\telement.addClass('field-editable')\n\t\t\t\t\telse\n\t\t\t\t\t\t$(\".instance-sign\", element).addClass('field-editable')\n\t\t\tcatch e\n\t\t\t\tconsole.log e\n\t\t, 1\n\t\treturn ''\n\nif Meteor.isServer\n\tInstanceSignText.helpers.defaultDescription = ->\n\t\tlocale = Template.instance().view.template.steedosData.locale\n\t\treturn Template.instance().data.default_description || TAPi18n.__(\"instance_default_opinion\", {}, locale)","var marked;\n\nmarked = require(\"marked\");\n\nInstanceSignText.helpers = {\n  show: function(stepName) {\n    var instance, myApprove, myTrace, ref;\n    if (Meteor.isClient) {\n      if (Session.get('instancePrint')) {\n        return false;\n      }\n      if (InstanceManager.isInbox()) {\n        myApprove = InstanceManager.getCurrentApprove();\n        if (myApprove) {\n          instance = WorkflowManager.getInstance();\n          myTrace = instance != null ? (ref = instance.traces) != null ? ref.findPropertyByPK(\"_id\", myApprove.trace) : void 0 : void 0;\n          return (myTrace != null ? myTrace.name : void 0) === stepName;\n        }\n      }\n    }\n    return false;\n  },\n  defaultDescription: function() {\n    return Template.instance().data.default_description;\n  },\n  traces: function() {\n    return InstanceformTemplate.helpers.traces();\n  },\n  trace: function(stepName, only_cc_opinion, image_sign, top_keywords) {\n    var approve_sort, approves, approvesGroup, approves_sorted, completed_date, hasNext, haveDescriptionApprove, instance, is_completed, ref, ref1, ref2, traces;\n    instance = InstanceformTemplate.helpers.instance();\n    is_completed = (instance != null ? instance.state : void 0) === \"completed\";\n    completed_date = is_completed ? (ref = _.last(instance.traces)) != null ? (ref1 = ref.finish_date) != null ? ref1.getTime() : void 0 : void 0 : 0;\n    if (is_completed && instance.finish_date) {\n      completed_date = (ref2 = instance.finish_date) != null ? ref2.getTime() : void 0;\n    }\n    traces = InstanceformTemplate.helpers.traces();\n    approves = _.clone(traces[stepName]);\n    approve_sort = function(approves, top_keywords) {\n      var approves_sorted, top_approves;\n      approves_sorted = _.sortBy(approves, function(approve) {\n        return -(approve.finish_date || new Date()).getTime();\n      });\n      if (top_keywords) {\n        top_approves = new Array();\n        top_keywords.split(\",\").forEach(function(key) {\n          return top_approves = _.union(top_approves, _.filter(approves_sorted, function(approve) {\n            var ref3;\n            return (approve != null ? (ref3 = approve.handler_name) != null ? ref3.indexOf(key) : void 0 : void 0) > -1;\n          }));\n        });\n        top_approves = _.sortBy(top_approves, function(top_approve) {\n          return -(top_approve.finish_date || new Date()).getTime();\n        });\n        approves_sorted = _.union(top_approves, approves_sorted);\n      }\n      return approves_sorted || [];\n    };\n    approves = _.filter(approves, function(a) {\n      return a.type !== \"forward\" && a.type !== \"distribute\" && a.type !== \"terminated\";\n    });\n    if (only_cc_opinion) {\n      approves = approves != null ? approves.filterProperty(\"type\", \"cc\") : void 0;\n    }\n    approves_sorted = approve_sort(approves, top_keywords);\n    approvesGroup = _.groupBy(approves, \"handler\");\n    hasNext = function(approve, approvesGroup) {\n      var handlerApproves;\n      handlerApproves = approvesGroup[approve.handler];\n      return _.indexOf(handlerApproves, approve) + 1 < handlerApproves.length;\n    };\n    haveDescriptionApprove = function(approve, approvesGroup) {\n      var descriptionApproves, handlerApproves;\n      handlerApproves = approvesGroup[approve.handler];\n      descriptionApproves = _.filter(handlerApproves, function(a) {\n        if (a.description) {\n          return true;\n        }\n        return false;\n      });\n      if (descriptionApproves.length === 0) {\n        return false;\n      }\n      return true;\n    };\n    approves_sorted.forEach(function(approve) {\n      var ref3;\n      if (approve.sign_show !== false && (approve.description || (!approve.description && !hasNext(approve, approvesGroup) && !approve.is_finished) || ((ref3 = Meteor.settings[\"public\"].workflow) != null ? ref3.showBlankApproveDescription : void 0))) {\n        if (approve.judge !== 'terminated') {\n          return approve._display = true;\n        }\n      }\n    });\n    approves_sorted = _.filter(approves_sorted, function(a) {\n      var ref3;\n      if (is_completed) {\n        return a._display === true && a.is_finished && ((ref3 = a.finish_date) != null ? ref3.getTime() : void 0) <= completed_date;\n      } else {\n        return a._display === true;\n      }\n    });\n    return approves_sorted;\n  },\n  include: function(a, b) {\n    return InstanceformTemplate.helpers.include(a, b);\n  },\n  unempty: function(val) {\n    var ref;\n    return InstanceformTemplate.helpers.unempty(val) || ((ref = Meteor.settings[\"public\"].workflow) != null ? ref.showBlankApproveDescription : void 0);\n  },\n  formatDate: function(date, options) {\n    if (!options) {\n      options = {\n        \"format\": \"YYYY-MM-DD\"\n      };\n    }\n    return InstanceformTemplate.helpers.formatDate(date, options);\n  },\n  isMyApprove: function(approve, only_cc_opinion) {\n    var currentApprove, ins;\n    if (Meteor.isClient) {\n      if (Session.get(\"box\") !== 'inbox') {\n        return false;\n      }\n      ins = WorkflowManager.getInstance();\n      currentApprove = InstanceManager.getCurrentApprove();\n      if (!(approve != null ? approve._id : void 0)) {\n        approve = currentApprove;\n      }\n      if (approve._id === (currentApprove != null ? currentApprove._id : void 0) && (currentApprove != null ? currentApprove.type : void 0) === 'cc' && Template.instance().data.name) {\n        if (_.indexOf(currentApprove != null ? currentApprove.opinion_fields_code : void 0, Template.instance().data.name) > -1) {\n          return true;\n        } else {\n          return false;\n        }\n      }\n      if (!((currentApprove != null ? currentApprove.type : void 0) === 'cc') && only_cc_opinion) {\n        return false;\n      }\n      if (currentApprove && approve._id === currentApprove._id) {\n        return true;\n      }\n    }\n    return false;\n  },\n  myApproveDescription: function(approveId) {\n    var myApprove, ref, ref1, ref2, ref3;\n    if (Meteor.isClient) {\n      if (Session.get(\"box\") === 'inbox') {\n        myApprove = (ref = Template.instance()) != null ? (ref1 = ref.myApprove) != null ? ref1.get() : void 0 : void 0;\n        if (myApprove && myApprove.id === approveId) {\n          if (!myApprove.sign_field_code || myApprove.sign_field_code === ((ref2 = Template.instance()) != null ? (ref3 = ref2.data) != null ? ref3.name : void 0 : void 0)) {\n            if (!Session.get(\"instance_my_approve_description\")) {\n              return (myApprove != null ? myApprove.description : void 0) || \"\";\n            }\n            return Session.get(\"instance_my_approve_description\");\n          }\n        }\n      }\n    }\n  },\n  now: function() {\n    return new Date();\n  },\n  isReadOnly: function() {\n    if (Meteor.isClient) {\n      return ApproveManager.isReadOnly();\n    }\n    return false;\n  },\n  isOpinionOfField: function(approve) {\n    if (approve.type === \"cc\" && Template.instance().data.name) {\n      if (Template.instance().data.name === approve.sign_field_code) {\n        return true;\n      } else {\n        return false;\n      }\n    } else {\n      return true;\n    }\n  },\n  markDownToHtml: function(markDownString) {\n    if (markDownString) {\n      if (Meteor.isServer) {\n        marked = Npm.require('marked');\n      }\n      return Spacebars.SafeString(marked.parse(markDownString));\n    }\n  },\n  steps: function(field_formula, step, only_cc_opinion, image_sign) {\n    var ref, ref1, ref2, steps;\n    steps = [];\n    if (!step) {\n      if (!field_formula) {\n        field_formula = (ref = WorkflowManager.getInstanceFormVersion()) != null ? (ref1 = ref.fields) != null ? ref1.findPropertyByPK(\"code\", this.name).formula : void 0 : void 0;\n      }\n      steps = InstanceformTemplate.helpers.getOpinionFieldStepsName(field_formula, (ref2 = Template.instance()) != null ? ref2.data.top_keywords : void 0);\n    } else {\n      steps = [\n        {\n          stepName: step,\n          only_cc_opinion: only_cc_opinion,\n          image_sign: image_sign\n        }\n      ];\n    }\n    return steps;\n  },\n  imageSignData: function(handler) {\n    return {\n      user: handler\n    };\n  },\n  showSignImage: function(handler, image_sign, judge) {\n    var spaceUserSign;\n    if (['returned', 'terminated', 'retrieved'].includes(judge)) {\n      return false;\n    }\n    spaceUserSign = ImageSign.helpers.spaceUserSign(handler);\n    if ((spaceUserSign != null ? spaceUserSign.sign : void 0) && image_sign) {\n      return true;\n    } else {\n      return false;\n    }\n  },\n  getLastSignApprove: function() {\n    var ins;\n    ins = WorkflowManager.getInstance();\n    return _.last(TracesManager.getHandlerSignShowApproves(ins, Meteor.userId()));\n  },\n  lastMyApproveDescription: function() {\n    var approves, currentStep, ref, traces;\n    traces = InstanceformTemplate.helpers.traces();\n    currentStep = InstanceManager.getCurrentStep();\n    approves = _.clone(traces[currentStep.name]);\n    approves = approves.filterProperty(\"handler\", Meteor.userId());\n    if (approves.length > 1) {\n      return (ref = approves[approves.length - 2]) != null ? ref.description : void 0;\n    }\n    return \"\";\n  },\n  showApprove: function(approve) {\n    var ref, ref1;\n    if (!approve.sign_field_code || approve.sign_field_code === ((ref = Template.instance()) != null ? (ref1 = ref.data) != null ? ref1.name : void 0 : void 0)) {\n      if (approve != null ? approve.is_read : void 0) {\n        if (approve.is_finished) {\n          return [\"approved\", \"rejected\", \"submitted\", \"readed\"].includes(approve.judge);\n        }\n      }\n    }\n    return false;\n  },\n  judge_description: function(judge) {\n    return t(judge + \"_description\");\n  },\n  is_approved: function(judge) {\n    return \"approved\" === judge;\n  },\n  is_rejected: function(judge) {\n    return \"rejected\" === judge;\n  },\n  is_readed: function(judge) {\n    return [\"approved\", \"rejected\", \"submitted\", \"readed\"].includes(judge);\n  },\n  addClass: function() {\n    var name, ref, ref1;\n    name = (ref = Template.instance()) != null ? (ref1 = ref.data) != null ? ref1.name : void 0 : void 0;\n    setTimeout(function() {\n      var e, element;\n      try {\n        element = $(\".automatic.opinion-field-\" + name);\n        if (element.length > 0) {\n          if (element != null ? element.is(\"td\") : void 0) {\n            return element.addClass('field-editable');\n          } else {\n            return $(\".instance-sign\", element).addClass('field-editable');\n          }\n        }\n      } catch (error) {\n        e = error;\n        return console.log(e);\n      }\n    }, 1);\n    return '';\n  }\n};\n\nif (Meteor.isServer) {\n  InstanceSignText.helpers.defaultDescription = function() {\n    var locale;\n    locale = Template.instance().view.template.steedosData.locale;\n    return Template.instance().data.default_description || TAPi18n.__(\"instance_default_opinion\", {}, locale);\n  };\n}\n","marked = require(\"marked\")\nTracesTemplate.helpers =\n\ttraceShowSignImage: ()->\n\t\treturn Meteor.settings.public.workflow.traceShowSignImage != false && Meteor.settings.public.workflow.traceShowSignImage != 'false'\n\tequals: (a, b) ->\n\t\ta == b\n\tempty: (a) ->\n\t\tif a\n\t\t\ta.toString().trim().length < 1\n\t\telse\n\t\t\ttrue\n\tunempty: (a) ->\n\t\tif a\n\t\t\ta.toString().trim().length > 0\n\t\telse\n\t\t\tfalse\n\n\tappend: (a, b) ->\n\t\ta + b\n\n\tdateFormat: (date) ->\n\t\t\tif Steedos.isMobile() && date?.getFullYear() == (new Date).getFullYear()\n\t\t\t\treturn moment(date).format('MM-DD HH:mm');\n\t\t\telse\n\t\t\t\treturn moment(date).format('YYYY-MM-DD HH:mm');\n\n\tgetStepName: (stepId) ->\n\t\tstep = WorkflowManager.getInstanceStep(stepId)\n\t\tif step\n\t\t\treturn step.name\n\t\tnull\n\tshowDeleteButton: (approved) ->\n\t\tif approved and approved.type == 'cc' and approved.from_user == Meteor.userId() and approved.is_finished != true and !Session.get(\"instancePrint\")\n\t\t\treturn true\n\t\tfalse\n\tisShowModificationButton: (approved) ->\n\t\tapprove_admins = Meteor.settings?.public?.workflow?.approve_admins\n\t\tif approve_admins?.length\n\t\t\tisShow = approve_admins?.contains Meteor.userId()\n\t\tunless isShow\n\t\t\treturn false\n\t\treturn approved.handler == Meteor.userId()\n\tisEditing: () ->\n\t\t return Template.instance().is_editing?.get()\n\tisShowDescription: (approved)->\n\t\t# debugger\n\t\tif TracesTemplate.helpers.isShowModificationButton approved\n\t\t\treturn true\n\t\treturn approved.description?.toString().trim().length > 0\n\tisCC: (approved) ->\n\t\tif approved and approved.type == 'cc'\n\t\t\treturn true\n\t\tfalse\n\tgetApproveStatusIcon: (approveJudge, autoSubmitted) ->\n\t\tif autoSubmitted == true\n\t\t\treturn 'ion ion-android-alarm-clock'\n\t\t#å·²ç»“æŸçš„æ˜¾ç¤ºä¸ºæ ¸å‡†/é©³å›ž/å–æ¶ˆç”³è¯·ï¼Œå¹¶æ˜¾ç¤ºå¤„ç†çŠ¶æ€å›¾æ ‡\n\t\tapproveStatusIcon = undefined\n\t\tswitch approveJudge\n\t\t\twhen 'approved'\n\t\t\t\t# å·²æ ¸å‡†\n\t\t\t\tapproveStatusIcon = 'ion ion-checkmark-round'\n\t\t\twhen 'rejected'\n\t\t\t\t# å·²é©³å›ž\n\t\t\t\tapproveStatusIcon = 'ion ion-close-round'\n\t\t\twhen 'terminated'\n\t\t\t\t# å·²å–æ¶ˆ\n\t\t\t\tapproveStatusIcon = 'fa fa-ban'\n\t\t\twhen 'reassigned'\n\t\t\t\t# è½¬ç­¾æ ¸\n\t\t\t\tapproveStatusIcon = 'ion ion-android-contact'\n\t\t\twhen 'relocated'\n\t\t\t\t# é‡å®šä½\n\t\t\t\tapproveStatusIcon = 'ion ion-arrow-shrink'\n\t\t\twhen 'retrieved'\n\t\t\t\t# å·²å–å›ž\n\t\t\t\tapproveStatusIcon = 'fa fa-undo'\n\t\t\telse\n\t\t\t\tapproveStatusIcon = ''\n\t\t\t\tbreak\n\t\tapproveStatusIcon\n\tgetApproveStatusText: (approveJudge, autoSubmitted) ->\n\t\tif Meteor.isServer\n\t\t\tlocale = Template.instance().view.template.steedosData.locale\n\t\t\tif locale.toLocaleLowerCase() == 'zh-cn'\n\t\t\t\tlocale = \"zh-CN\"\n\t\telse\n\t\t\tlocale = Session.get(\"TAPi18n::loaded_lang\")\n\t\t#å·²ç»“æŸçš„æ˜¾ç¤ºä¸ºæ ¸å‡†/é©³å›ž/å–æ¶ˆç”³è¯·ï¼Œå¹¶æ˜¾ç¤ºå¤„ç†çŠ¶æ€å›¾æ ‡\n\t\tif autoSubmitted == true\n\t\t\treturn TAPi18n.__('instance_approve_timeout_auto_submitted', {}, locale)\n\t\tapproveStatusText = undefined\n\t\tswitch approveJudge\n\t\t\twhen 'approved'\n\t\t\t\t# å·²æ ¸å‡†\n\t\t\t\tapproveStatusText = TAPi18n.__('Instance State approved', {}, locale)\n\t\t\twhen 'rejected'\n\t\t\t\t# å·²é©³å›ž\n\t\t\t\tapproveStatusText = TAPi18n.__('Instance State rejected', {}, locale)\n\t\t\twhen 'terminated'\n\t\t\t\t# å·²å–æ¶ˆ\n\t\t\t\tapproveStatusText = TAPi18n.__('Instance State terminated', {}, locale)\n\t\t\twhen 'reassigned'\n\t\t\t\t# è½¬ç­¾æ ¸\n\t\t\t\tapproveStatusText = TAPi18n.__('Instance State reassigned', {}, locale)\n\t\t\twhen 'relocated'\n\t\t\t\t# é‡å®šä½\n\t\t\t\tapproveStatusText = TAPi18n.__('Instance State relocated', {}, locale)\n\t\t\twhen 'retrieved'\n\t\t\t\t# å·²å–å›ž\n\t\t\t\tapproveStatusText = TAPi18n.__('Instance State retrieved', {}, locale)\n\t\t\twhen 'returned'\n\t\t\t\t# å·²é€€å›ž\n\t\t\t\tapproveStatusText = TAPi18n.__('Instance State returned', {}, locale)\n\t\t\twhen 'readed'\n\t\t\t\t# å·²é˜…\n\t\t\t\tapproveStatusText = TAPi18n.__('Instance State readed', {}, locale)\n\t\t\telse\n\t\t\t\tapproveStatusText = ''\n\t\t\t\tbreak\n\t\tapproveStatusText\n\t\n\tgetApproveJudgeClass: (approveJudge, autoSubmitted) ->\n\t\tif autoSubmitted == true\n\t\t\treturn 'autoSubmitted'\n\t\treturn approveJudge\n\n\t_t: (key)->\n\t\treturn TAPi18n.__(key)\n\n\tmyApproveDescription: (approveId)->\n\t\tif Meteor.isClient\n\t\t\tif Session.get(\"box\") == 'inbox'\n\t\t\t\tmyApprove = Template.instance()?.myApprove?.get()\n\t\t\t\tif myApprove && myApprove.id == approveId\n\t\t\t\t\tif !Session.get(\"instance_my_approve_description\")\n\t\t\t\t\t\treturn myApprove?.description || \"\"\n\t\t\t\t\treturn Session.get(\"instance_my_approve_description\")\n\tisForward: (approved) ->\n\t\tif approved and approved.type == 'forward'\n\t\t\treturn true\n\t\tfalse\n\tshowForwardDeleteButton: (approve) ->\n\t\tif db.instances.find(approve.forward_instance).count() is 0\n\t\t\treturn false\n\t\tif approve and approve.type == 'forward' and approve.from_user == Meteor.userId() and !Session.get(\"instancePrint\") and approve.judge isnt 'terminated'\n\t\t\treturn true\n\t\tfalse\n\tmarkDownToHtml: (markDownString)->\n\t\tif markDownString\n\t\t\t# renderer = new Markdown.Renderer();\n\t\t\t# renderer.link = ( href, title, text ) ->\n\t\t\t# \treturn \"<a target='_blank' href='#{href}' title='#{title}'>#{text}</a>\"\n\t\t\tif Meteor.isServer\n\t\t\t\tmarked = Npm.require('marked')\n\t\t\treturn Spacebars.SafeString(marked.parse(markDownString))\n\tisDistribute: (approve) ->\n\t\tif approve and approve.type == 'distribute'\n\t\t\treturn true\n\t\tfalse\n\tshowDistributeDeleteButton: (approve) ->\n\t\tif db.instances.find(approve.forward_instance).count() is 0\n\t\t\treturn false\n\n\t\tif approve and approve.type == 'distribute' and !Session.get(\"instancePrint\") and approve.judge isnt 'terminated'\n\t\t\t# æµç¨‹ç®¡ç†å‘˜å’Œç³»ç»Ÿç®¡ç†å‘˜ï¼Œå¯ä»¥æ‰§è¡Œä»»ä½•æƒ…å†µä¸‹çš„æ–‡ä»¶å–æ¶ˆåˆ†å‘\n\t\t\tins = db.instances.findOne({_id: approve.instance}, {fields: {flow: 1, space: 1}})\n\t\t\tif ins and ins.flow and ins.space\n\t\t\t\tif WorkflowManager.hasFlowAdminPermission(ins.flow, ins.space, Meteor.userId())\n\t\t\t\t\treturn true\n\n\t\t\tif approve.from_user == Meteor.userId()\n\t\t\t\treturn true\n\n\t\tfalse\n\n\tfinishDateSchema: () ->\n\t\tif Steedos.isAndroidOrIOS()\n\t\t\treturn new SimpleSchema({\n\t\t\t\tfinish_date: {\n\t\t\t\t\tautoform: {\n\t\t\t\t\t\ttype: \"datetime-local\"\n\t\t\t\t\t},\n\t\t\t\t\toptional: false,\n\t\t\t\t\ttype: Date\n\t\t\t\t}\n\t\t\t})\n\t\telse\n\t\t\treturn new SimpleSchema({\n\t\t\t\tfinish_date: {\n\t\t\t\t\tautoform: {\n\t\t\t\t\t\ttype: \"bootstrap-datetimepicker\"\n\t\t\t\t\t\treadonly: true\n\t\t\t\t\t\tdateTimePickerOptions:{\n\t\t\t\t\t\t\tformat: \"YYYY-MM-DD HH:mm\",\n\t\t\t\t\t\t\tignoreReadonly:true,\n\t\t\t\t\t\t\tlocale: Session.get(\"TAPi18n::loaded_lang\"),\n\t\t\t\t\t\t\twidgetPositioning:{\n\t\t\t\t\t\t\t\thorizontal: 'right'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\toptional: false,\n\t\t\t\t\ttype: Date\n\t\t\t\t}\n\t\t\t})\n\n\tfinishDateValues: () ->\n\t\treturn {\n\t\t\tfinish_date:this.finish_date\n\t\t};\n\n\t###\n    \tæ­¤å‡½æ•°ç”¨äºŽæŽ§åˆ¶æ˜¯å¦æ˜¾ç¤ºtraces view\n    \ttrue: æ˜¾ç¤ºtraces view,ç­¾æ ¸åŽ†ç¨‹æŒ‰é’®ç‚¹å‡»åŽæ˜¯ç›´æŽ¥å®šä½åˆ°traces view\n    \tfalse: ä¸æ˜¾ç¤ºtraces viewï¼Œç­¾æ ¸åŽ†ç¨‹æŒ‰é’®ç‚¹å‡»åŽ,ä»¥Modal æ–¹å¼æ˜¾ç¤ºtraces view\n\t###\n\tshowTracesView: (form, form_version)->\n#\t\treturn !(InstanceManager.isTableStyle(form) && InstanceformTemplate.helpers.includesOpinionField(form, form_version))\n\n\t\tshow_modal_traces_list = db.space_settings.findOne({space: Session.get(\"spaceId\"), key: \"show_modal_traces_list\"})?.values || false\n\n\t\treturn !show_modal_traces_list\n\n\tgetInstanceStateText: (instance_id)->\n\t\tif Meteor.isServer\n\t\t\tlocale = Template.instance().view.template.steedosData.locale\n\t\t\tif locale.toLocaleLowerCase() == 'zh-cn'\n\t\t\t\tlocale = \"zh-CN\"\n\t\telse\n\t\t\tlocale = Session.get(\"TAPi18n::loaded_lang\")\n\n\t\tins = db.instances.findOne({_id: instance_id}, {fields: {state: 1, is_read: 1}})\n\t\tif not ins\n\t\t\treturn TAPi18n.__('instance_deleted', {}, locale)\n\n\t\ttext = ''\n\t\tif ins.state is 'completed'\n\t\t\ttext = TAPi18n.__('completed', {}, locale)\n\t\telse if ins.state is 'pending'\n\t\t\ttext = TAPi18n.__('pending', {}, locale)\n\t\telse if ins.state is 'draft'\n\t\t\tif ins.is_read\n\t\t\t\ttext = TAPi18n.__('instance_approve_read', {}, locale)\n\t\t\telse\n\t\t\t\ttext = TAPi18n.__('instance_approve_not_yet_handled', {}, locale)\n\n\t\treturn text\n\n\tgetInstanceStateColor: (instance_id)->\n\t\tins = db.instances.findOne({_id: instance_id}, {fields: {state: 1, is_read: 1}})\n\t\tif not ins\n\t\t\treturn \"\"\n\n\t\tcla = ''\n\t\tif ins.state is 'draft'\n\t\t\tif ins.is_read\n\t\t\t\tcla = 'blue'\n\t\t\telse\n\t\t\t\tcla = 'red'\n\t\treturn cla\n\n\tfirstTrace: (index)->\n\t\treturn index is 0\n\n\tlast_distribute_from: (instance_id)->\n\t\tins = db.instances.findOne({_id: instance_id, distribute_from_instance: {$exists: true}},{fields:{created: 1, created_by: 1}})\n\t\tif ins\n\t\t\tdis_info = {}\n\t\t\tuser = {}\n\t\t\tif Meteor.isClient\n\t\t\t\tuser = UUflow_api.getNameForUser(ins.created_by)\n\t\t\telse if Meteor.isServer\n\t\t\t\tuser = db.users.findOne({_id: ins.created_by}, {fields: {name: 1}})\n\n\t\t\tif user.name\n\t\t\t\tdis_info.from_user = user._id\n\t\t\t\tdis_info.from_user_name = user.name\n\t\t\t\tdis_info.created = ins.created\n\n\t\t\tif not _.isEmpty(dis_info)\n\t\t\t\treturn dis_info\n\t\treturn\n\n\tisCCOrDistributeOrForwardTerminated: (approve)->\n\t\tif (approve.type is 'cc' or approve.type is 'distribute' or approve.type is 'forward') and approve.judge is 'terminated'\n\t\t\treturn true\n\t\treturn false\n\n\tjudgeTerminated: (judge)->\n\t\treturn judge is 'terminated'\n\n\tinstanceExists: (instance_id)->\n\t\treturn !!db.instances.find(instance_id).count()\n\n\tagentDescription: (userName)->\n\t\tif Meteor.isServer\n\t\t\tlocale = Template.instance().view.template.steedosData.locale\n\t\t\tif locale.toLocaleLowerCase() == 'zh-cn'\n\t\t\t\tlocale = \"zh-CN\"\n\t\telse\n\t\t\tlocale = Session.get(\"TAPi18n::loaded_lang\")\n\n\t\treturn TAPi18n.__('process_delegation_rules_description', {userName: userName}, locale)\n\t\n\ttraceName: (instance_id, traceId)->\n\t\treturn _.find(db.instances.findOne(instance_id, {fields: {traces: 1}})?.traces, (trace)->\n\t\t\t\t\treturn trace._id ==  traceId\n\t\t)?.name\n\n\tobjectUrl: (object_name, record_id, app_id)->\n\t\treturn Creator.getObjectUrl(object_name, record_id, app_id)\n\n\thandlerDoc: (handlerId)->\n\t\tusers_can_read_cc_handler_detail_info = Meteor.settings.public?.workflow?.users_can_read_cc_handler_detail_info\n\t\tif !users_can_read_cc_handler_detail_info or !users_can_read_cc_handler_detail_info.includes(Meteor.userId())\n\t\t\treturn\n\t\tif Meteor.isClient\n\t\t\treturn UUflow_api.getContactInfoForUser(handlerId, Session.get('spaceId'))\n\t\telse if Meteor.isServer\n\t\t\treturn db.users.findOne(handlerId)\n\nif Meteor.isServer\n\tTracesTemplate.helpers.dateFormat = (date)->\n\t\tif date\n\t\t\tutcOffset = Template.instance().view.template.steedosData.utcOffset\n\t\t\treturn InstanceReadOnlyTemplate.formatDate(date, utcOffset);\n\n\tTracesTemplate.helpers._t = (key)->\n\t\tlocale = Template.instance().view.template.steedosData.locale\n\t\treturn TAPi18n.__(key, {}, locale)\n\n\tTracesTemplate.helpers.showDeleteButton = (approved) ->\n\t\treturn false;\n\nTracesTemplate.events =\n\t'click .cc-approve-remove': (event, template) ->\n\t\tevent.stopPropagation()\n\t\tif event.currentTarget.dataset.calling * 1 != 1\n\t\t\tevent.currentTarget.dataset.calling = 1\n\t\t\t$(\"i\",event.currentTarget).addClass(\"fa-spin\")\n\t\t\tinstanceId = Session.get('instanceId')\n\t\t\tapproveId = event.target.dataset.approve\n\t\t\t# CALL åˆ é™¤approveå‡½æ•°ã€‚\n\t\t\t$(\"body\").addClass(\"loading\")\n\t\t\tMeteor.call 'cc_remove', instanceId, approveId, (err, result) ->\n\t\t\t\t$(\"body\").removeClass(\"loading\")\n\t\t\t\tif err\n\t\t\t\t\ttoastr.error err\n\t\t\t\t\tevent.currentTarget.dataset.calling = 0\n\t\t\t\t\t$(\"i\",event.currentTarget).removeClass(\"fa-spin\")\n\t\t\t\tif result == true\n\t\t\t\t\ttoastr.success(TAPi18n.__(\"remove_cc_approve\"));\n\t\t\t\t\tif $(\".instance-trace-detail-modal\").length\n\t\t\t\t\t\tModal.hide \"instance_trace_detail_modal\"\n\t\t\t\treturn\n\t\t\treturn\n\n\t'click .instance-trace-detail-modal .btn-cc-approve-remove': (event, template) ->\n\t\tinstanceId = Session.get('instanceId')\n\t\tapproveId = event.target.dataset.approve\n\t\t# # CALL åˆ é™¤approveå‡½æ•°ã€‚\n\t\t# $(\"body\").addClass(\"loading\")\n\t\t# Meteor.call 'cc_remove', instanceId, approveId, (err, result) ->\n\t\t# \t$(\"body\").removeClass(\"loading\")\n\t\t# \tif err\n\t\t# \t\ttoastr.error err\n\t\t# \tif result == true\n\t\t# \t\ttoastr.success(TAPi18n.__(\"remove_cc_approve\"));\n\t\t# \t\tModal.hide \"instance_trace_detail_modal\"\n\t\t# \treturn\n\t\t# return\n\t\tModal.allowMultiple = true\n\t\tModal.show 'cancel_cc_modal'\n\n\t'click .approve-item,.approve-description': (event, template) ->\n\t\t# PCä¸Šé“¾æŽ¥å…è®¸ç›´æŽ¥ç‚¹å¼€ï¼Œä¸å†æ‰“å¼€ç­¾æ‰¹åŽ†ç¨‹è¯¦ç»†\n\t\tunless $(event.target).closest(\"a.btn-link\").length\n\t\t\tModal.show \"instance_trace_detail_modal\", this\n\n\t'taphold .approve-item,.approve-description': (event, template) ->\n\t\t# æ‰‹æœºä¸Šé•¿æŒ‰æ‰“å¼€ç­¾æ‰¹åŽ†ç¨‹è¯¦ç»†ï¼Œå¦‚æžœæ˜¯é“¾æŽ¥é•¿æŒ‰æ‰“å¼€åŽä¸€æ”¾æ‰‹çª—å£å°±åˆå…³æŽ‰äº†ï¼Œæ‰€ä»¥ä¸è®©é“¾æŽ¥æ‰“å¼€ç­¾æ‰¹åŽ†ç¨‹è¯¦ç»†\n\t\tunless $(event.target).closest(\"a.btn-link\").length\n\t\t\tModal.show \"instance_trace_detail_modal\", this\n\n\t'click .approve-item a.btn-link,.approve-description a.btn-link,.approve-item-distribute a.btn-link': (event, template) ->\n\t\t# æ‰‹æœºä¸Šç‚¹å‡»é“¾æŽ¥ï¼Œå¼¹å‡ºæ–°çª—å£ï¼Œä¸æ”¯æŒï¼Œå› ä¸ºandroidä¸Šä¼šå¼¹å‡ºç™»å½•ç•Œé¢\n\t\tif Steedos.isMobile()\n\t\t\tuserId = event.target.dataset?.target_user_id\n\t\t\tCreator.openSafeObjectUrl('users', userId)\n\n\t'tapend .approve-item,.approve-description': (event, template) ->\n\t\t# ä¸Šè¿°é•¿æŒ‰æ‰“å¼€approveè¯¦ç»†çª—å£çš„äº‹ä»¶tapholdä¼šè§¦å‘æ‰“å¼€çª—å£åŽçš„touchendäº‹ä»¶ï¼Œé€ æˆé•¿æŒ‰æ‰“å¼€çª—å£åŽä¸€æ”¾æ‰‹çª—å£å°±åˆå…³æŽ‰äº†\n\t\t# è¿™é‡Œåªèƒ½é€šè¿‡é˜»æ­¢tapendäº‹ä»¶(ä¸å¯ä»¥ç”¨touchendäº‹ä»¶ï¼Œå› ä¸ºä¼šå½±å“tapholdåŠŸèƒ½ï¼Œé€ æˆæ²¡æœ‰é•¿æŒ‰æ•ˆæžœæ—¶ä¹Ÿä¼šè§¦å‘tapholdäº‹ä»¶)å†’æ³¡æ¥é¿å…é—®é¢˜ã€‚\n\t\t# é“¾æŽ¥å…è®¸ç›´æŽ¥ç‚¹å¼€\n\t\tunless $(event.target).closest(\"a.btn-link\").length\n\t\t\tevent.stopPropagation()\n\t\t\tevent.preventDefault()\n\t\t\treturn false\n\n\t'click .instance-trace-detail-modal .btn-forward-approve-remove': (event, template) ->\n\t\tinstanceId = Session.get('instanceId')\n\t\tapproveId = event.target.dataset.approve\n\t\ttraceId = event.target.dataset.trace\n\t\t# CALL åˆ é™¤approveå‡½æ•°ã€‚\n\t\t$(\"body\").addClass(\"loading\")\n\t\tMeteor.call 'forward_remove', instanceId, traceId, approveId, (err, result) ->\n\t\t\t$(\"body\").removeClass(\"loading\")\n\t\t\tif err\n\t\t\t\ttoastr.error TAPi18n.__(err.reason)\n\t\t\tif result == true\n\t\t\t\ttoastr.success(TAPi18n.__(\"instance_approve_forward_remove_success\"));\n\t\t\t\tModal.hide \"instance_trace_detail_modal\"\n\t\t\treturn\n\t\treturn\n\n\t'click .instance-trace-detail-modal .btn-forward-instance-look': (event, template) ->\n\t\tforward_space = event.target.dataset.forwardspace\n\t\tforward_instance = event.target.dataset.forwardinstance\n\t\tSteedos.openWindow(Steedos.absoluteUrl(\"workflow/space/\" + forward_space + \"/view/readonly/\" + forward_instance))\n\n\t'click .btn-modification'\t: (event, template) ->\n\t\ttemplate.is_editing.set(!template.is_editing.get());\n\t\tunless Steedos.isAndroidOrIOS()\n\t\t\tTracker.afterFlush ->\n\t\t\t\t# æ˜¾ç¤ºæ—¥å¿—çš„æ—¶å€™æŠŠæ»šåŠ¨æ¡å¾€ä¸‹ç§»ç‚¹ï¼Œè®©æ—¥æœŸæŽ§ä»¶æ˜¾ç¤ºå‡ºä¸€éƒ¨åˆ†ï¼Œä»¥é¿å…ç”¨æˆ·çœ‹ä¸åˆ°æ—¥æœŸæŽ§ä»¶\n\t\t\t\t$(\"#instance_trace_detail_modal #finish_input\").on \"dp.show\", () ->\n\t\t\t\t\t$(\".modal-body\").scrollTop(100)\n\n\t'click .btn-cancelBut' : (event, template) ->\n\n\t\ttemplate.is_editing.set(!template.is_editing.get());\n\n\t'click .btn-saveBut' : (event, template) ->\n\t\t# template.is_editing.set(!template.is_editing.get())\n\n\t\tinstanceId = Session.get('instanceId')\n\t\tapproveId = event.target.dataset.approve\n\t\ttraceId = event.target.dataset.trace\n\t\topinion_input = $('#opinion_input').val()\n\t\tfinish_input = AutoForm.getFieldValue(\"finish_date\", \"finishDateAutoForm\")\n\n\t\t$(\"body\").addClass(\"loading\")\n\t\tMeteor.call 'change_approve_info', instanceId, traceId, approveId, opinion_input, finish_input, (err, result)->\n\t\t\t$(\"body\").removeClass(\"loading\")\n\t\t\tif err\n\t\t\t\ttoastr.error TAPi18n.__(err.reason)\n\t\t\tif result == true\n\t\t\t\ttoastr.success(t(\"instance_approve_modal_modificationsave\"))\n\t\t\t\tModal.hide \"instance_trace_detail_modal\"\n\t\t\treturn\n\n\t'click .instance-trace-detail-modal .btn-distribute-approve-remove': (event, template) ->\n\t\tModal.allowMultiple = true\n\t\tModal.show 'cancel_distribute_modal'\n","var marked;\n\nmarked = require(\"marked\");\n\nTracesTemplate.helpers = {\n  traceShowSignImage: function() {\n    return Meteor.settings[\"public\"].workflow.traceShowSignImage !== false && Meteor.settings[\"public\"].workflow.traceShowSignImage !== 'false';\n  },\n  equals: function(a, b) {\n    return a === b;\n  },\n  empty: function(a) {\n    if (a) {\n      return a.toString().trim().length < 1;\n    } else {\n      return true;\n    }\n  },\n  unempty: function(a) {\n    if (a) {\n      return a.toString().trim().length > 0;\n    } else {\n      return false;\n    }\n  },\n  append: function(a, b) {\n    return a + b;\n  },\n  dateFormat: function(date) {\n    if (Steedos.isMobile() && (date != null ? date.getFullYear() : void 0) === (new Date).getFullYear()) {\n      return moment(date).format('MM-DD HH:mm');\n    } else {\n      return moment(date).format('YYYY-MM-DD HH:mm');\n    }\n  },\n  getStepName: function(stepId) {\n    var step;\n    step = WorkflowManager.getInstanceStep(stepId);\n    if (step) {\n      return step.name;\n    }\n    return null;\n  },\n  showDeleteButton: function(approved) {\n    if (approved && approved.type === 'cc' && approved.from_user === Meteor.userId() && approved.is_finished !== true && !Session.get(\"instancePrint\")) {\n      return true;\n    }\n    return false;\n  },\n  isShowModificationButton: function(approved) {\n    var approve_admins, isShow, ref, ref1, ref2;\n    approve_admins = (ref = Meteor.settings) != null ? (ref1 = ref[\"public\"]) != null ? (ref2 = ref1.workflow) != null ? ref2.approve_admins : void 0 : void 0 : void 0;\n    if (approve_admins != null ? approve_admins.length : void 0) {\n      isShow = approve_admins != null ? approve_admins.contains(Meteor.userId()) : void 0;\n    }\n    if (!isShow) {\n      return false;\n    }\n    return approved.handler === Meteor.userId();\n  },\n  isEditing: function() {\n    var ref;\n    return (ref = Template.instance().is_editing) != null ? ref.get() : void 0;\n  },\n  isShowDescription: function(approved) {\n    var ref;\n    if (TracesTemplate.helpers.isShowModificationButton(approved)) {\n      return true;\n    }\n    return ((ref = approved.description) != null ? ref.toString().trim().length : void 0) > 0;\n  },\n  isCC: function(approved) {\n    if (approved && approved.type === 'cc') {\n      return true;\n    }\n    return false;\n  },\n  getApproveStatusIcon: function(approveJudge, autoSubmitted) {\n    var approveStatusIcon;\n    if (autoSubmitted === true) {\n      return 'ion ion-android-alarm-clock';\n    }\n    approveStatusIcon = void 0;\n    switch (approveJudge) {\n      case 'approved':\n        approveStatusIcon = 'ion ion-checkmark-round';\n        break;\n      case 'rejected':\n        approveStatusIcon = 'ion ion-close-round';\n        break;\n      case 'terminated':\n        approveStatusIcon = 'fa fa-ban';\n        break;\n      case 'reassigned':\n        approveStatusIcon = 'ion ion-android-contact';\n        break;\n      case 'relocated':\n        approveStatusIcon = 'ion ion-arrow-shrink';\n        break;\n      case 'retrieved':\n        approveStatusIcon = 'fa fa-undo';\n        break;\n      default:\n        approveStatusIcon = '';\n        break;\n    }\n    return approveStatusIcon;\n  },\n  getApproveStatusText: function(approveJudge, autoSubmitted) {\n    var approveStatusText, locale;\n    if (Meteor.isServer) {\n      locale = Template.instance().view.template.steedosData.locale;\n      if (locale.toLocaleLowerCase() === 'zh-cn') {\n        locale = \"zh-CN\";\n      }\n    } else {\n      locale = Session.get(\"TAPi18n::loaded_lang\");\n    }\n    if (autoSubmitted === true) {\n      return TAPi18n.__('instance_approve_timeout_auto_submitted', {}, locale);\n    }\n    approveStatusText = void 0;\n    switch (approveJudge) {\n      case 'approved':\n        approveStatusText = TAPi18n.__('Instance State approved', {}, locale);\n        break;\n      case 'rejected':\n        approveStatusText = TAPi18n.__('Instance State rejected', {}, locale);\n        break;\n      case 'terminated':\n        approveStatusText = TAPi18n.__('Instance State terminated', {}, locale);\n        break;\n      case 'reassigned':\n        approveStatusText = TAPi18n.__('Instance State reassigned', {}, locale);\n        break;\n      case 'relocated':\n        approveStatusText = TAPi18n.__('Instance State relocated', {}, locale);\n        break;\n      case 'retrieved':\n        approveStatusText = TAPi18n.__('Instance State retrieved', {}, locale);\n        break;\n      case 'returned':\n        approveStatusText = TAPi18n.__('Instance State returned', {}, locale);\n        break;\n      case 'readed':\n        approveStatusText = TAPi18n.__('Instance State readed', {}, locale);\n        break;\n      default:\n        approveStatusText = '';\n        break;\n    }\n    return approveStatusText;\n  },\n  getApproveJudgeClass: function(approveJudge, autoSubmitted) {\n    if (autoSubmitted === true) {\n      return 'autoSubmitted';\n    }\n    return approveJudge;\n  },\n  _t: function(key) {\n    return TAPi18n.__(key);\n  },\n  myApproveDescription: function(approveId) {\n    var myApprove, ref, ref1;\n    if (Meteor.isClient) {\n      if (Session.get(\"box\") === 'inbox') {\n        myApprove = (ref = Template.instance()) != null ? (ref1 = ref.myApprove) != null ? ref1.get() : void 0 : void 0;\n        if (myApprove && myApprove.id === approveId) {\n          if (!Session.get(\"instance_my_approve_description\")) {\n            return (myApprove != null ? myApprove.description : void 0) || \"\";\n          }\n          return Session.get(\"instance_my_approve_description\");\n        }\n      }\n    }\n  },\n  isForward: function(approved) {\n    if (approved && approved.type === 'forward') {\n      return true;\n    }\n    return false;\n  },\n  showForwardDeleteButton: function(approve) {\n    if (db.instances.find(approve.forward_instance).count() === 0) {\n      return false;\n    }\n    if (approve && approve.type === 'forward' && approve.from_user === Meteor.userId() && !Session.get(\"instancePrint\") && approve.judge !== 'terminated') {\n      return true;\n    }\n    return false;\n  },\n  markDownToHtml: function(markDownString) {\n    if (markDownString) {\n      if (Meteor.isServer) {\n        marked = Npm.require('marked');\n      }\n      return Spacebars.SafeString(marked.parse(markDownString));\n    }\n  },\n  isDistribute: function(approve) {\n    if (approve && approve.type === 'distribute') {\n      return true;\n    }\n    return false;\n  },\n  showDistributeDeleteButton: function(approve) {\n    var ins;\n    if (db.instances.find(approve.forward_instance).count() === 0) {\n      return false;\n    }\n    if (approve && approve.type === 'distribute' && !Session.get(\"instancePrint\") && approve.judge !== 'terminated') {\n      ins = db.instances.findOne({\n        _id: approve.instance\n      }, {\n        fields: {\n          flow: 1,\n          space: 1\n        }\n      });\n      if (ins && ins.flow && ins.space) {\n        if (WorkflowManager.hasFlowAdminPermission(ins.flow, ins.space, Meteor.userId())) {\n          return true;\n        }\n      }\n      if (approve.from_user === Meteor.userId()) {\n        return true;\n      }\n    }\n    return false;\n  },\n  finishDateSchema: function() {\n    if (Steedos.isAndroidOrIOS()) {\n      return new SimpleSchema({\n        finish_date: {\n          autoform: {\n            type: \"datetime-local\"\n          },\n          optional: false,\n          type: Date\n        }\n      });\n    } else {\n      return new SimpleSchema({\n        finish_date: {\n          autoform: {\n            type: \"bootstrap-datetimepicker\",\n            readonly: true,\n            dateTimePickerOptions: {\n              format: \"YYYY-MM-DD HH:mm\",\n              ignoreReadonly: true,\n              locale: Session.get(\"TAPi18n::loaded_lang\"),\n              widgetPositioning: {\n                horizontal: 'right'\n              }\n            }\n          },\n          optional: false,\n          type: Date\n        }\n      });\n    }\n  },\n  finishDateValues: function() {\n    return {\n      finish_date: this.finish_date\n    };\n  },\n\n  /*\n     \tæ­¤å‡½æ•°ç”¨äºŽæŽ§åˆ¶æ˜¯å¦æ˜¾ç¤ºtraces view\n     \ttrue: æ˜¾ç¤ºtraces view,ç­¾æ ¸åŽ†ç¨‹æŒ‰é’®ç‚¹å‡»åŽæ˜¯ç›´æŽ¥å®šä½åˆ°traces view\n     \tfalse: ä¸æ˜¾ç¤ºtraces viewï¼Œç­¾æ ¸åŽ†ç¨‹æŒ‰é’®ç‚¹å‡»åŽ,ä»¥Modal æ–¹å¼æ˜¾ç¤ºtraces view\n   */\n  showTracesView: function(form, form_version) {\n    var ref, show_modal_traces_list;\n    show_modal_traces_list = ((ref = db.space_settings.findOne({\n      space: Session.get(\"spaceId\"),\n      key: \"show_modal_traces_list\"\n    })) != null ? ref.values : void 0) || false;\n    return !show_modal_traces_list;\n  },\n  getInstanceStateText: function(instance_id) {\n    var ins, locale, text;\n    if (Meteor.isServer) {\n      locale = Template.instance().view.template.steedosData.locale;\n      if (locale.toLocaleLowerCase() === 'zh-cn') {\n        locale = \"zh-CN\";\n      }\n    } else {\n      locale = Session.get(\"TAPi18n::loaded_lang\");\n    }\n    ins = db.instances.findOne({\n      _id: instance_id\n    }, {\n      fields: {\n        state: 1,\n        is_read: 1\n      }\n    });\n    if (!ins) {\n      return TAPi18n.__('instance_deleted', {}, locale);\n    }\n    text = '';\n    if (ins.state === 'completed') {\n      text = TAPi18n.__('completed', {}, locale);\n    } else if (ins.state === 'pending') {\n      text = TAPi18n.__('pending', {}, locale);\n    } else if (ins.state === 'draft') {\n      if (ins.is_read) {\n        text = TAPi18n.__('instance_approve_read', {}, locale);\n      } else {\n        text = TAPi18n.__('instance_approve_not_yet_handled', {}, locale);\n      }\n    }\n    return text;\n  },\n  getInstanceStateColor: function(instance_id) {\n    var cla, ins;\n    ins = db.instances.findOne({\n      _id: instance_id\n    }, {\n      fields: {\n        state: 1,\n        is_read: 1\n      }\n    });\n    if (!ins) {\n      return \"\";\n    }\n    cla = '';\n    if (ins.state === 'draft') {\n      if (ins.is_read) {\n        cla = 'blue';\n      } else {\n        cla = 'red';\n      }\n    }\n    return cla;\n  },\n  firstTrace: function(index) {\n    return index === 0;\n  },\n  last_distribute_from: function(instance_id) {\n    var dis_info, ins, user;\n    ins = db.instances.findOne({\n      _id: instance_id,\n      distribute_from_instance: {\n        $exists: true\n      }\n    }, {\n      fields: {\n        created: 1,\n        created_by: 1\n      }\n    });\n    if (ins) {\n      dis_info = {};\n      user = {};\n      if (Meteor.isClient) {\n        user = UUflow_api.getNameForUser(ins.created_by);\n      } else if (Meteor.isServer) {\n        user = db.users.findOne({\n          _id: ins.created_by\n        }, {\n          fields: {\n            name: 1\n          }\n        });\n      }\n      if (user.name) {\n        dis_info.from_user = user._id;\n        dis_info.from_user_name = user.name;\n        dis_info.created = ins.created;\n      }\n      if (!_.isEmpty(dis_info)) {\n        return dis_info;\n      }\n    }\n  },\n  isCCOrDistributeOrForwardTerminated: function(approve) {\n    if ((approve.type === 'cc' || approve.type === 'distribute' || approve.type === 'forward') && approve.judge === 'terminated') {\n      return true;\n    }\n    return false;\n  },\n  judgeTerminated: function(judge) {\n    return judge === 'terminated';\n  },\n  instanceExists: function(instance_id) {\n    return !!db.instances.find(instance_id).count();\n  },\n  agentDescription: function(userName) {\n    var locale;\n    if (Meteor.isServer) {\n      locale = Template.instance().view.template.steedosData.locale;\n      if (locale.toLocaleLowerCase() === 'zh-cn') {\n        locale = \"zh-CN\";\n      }\n    } else {\n      locale = Session.get(\"TAPi18n::loaded_lang\");\n    }\n    return TAPi18n.__('process_delegation_rules_description', {\n      userName: userName\n    }, locale);\n  },\n  traceName: function(instance_id, traceId) {\n    var ref, ref1;\n    return (ref = _.find((ref1 = db.instances.findOne(instance_id, {\n      fields: {\n        traces: 1\n      }\n    })) != null ? ref1.traces : void 0, function(trace) {\n      return trace._id === traceId;\n    })) != null ? ref.name : void 0;\n  },\n  objectUrl: function(object_name, record_id, app_id) {\n    return Creator.getObjectUrl(object_name, record_id, app_id);\n  },\n  handlerDoc: function(handlerId) {\n    var ref, ref1, users_can_read_cc_handler_detail_info;\n    users_can_read_cc_handler_detail_info = (ref = Meteor.settings[\"public\"]) != null ? (ref1 = ref.workflow) != null ? ref1.users_can_read_cc_handler_detail_info : void 0 : void 0;\n    if (!users_can_read_cc_handler_detail_info || !users_can_read_cc_handler_detail_info.includes(Meteor.userId())) {\n      return;\n    }\n    if (Meteor.isClient) {\n      return UUflow_api.getContactInfoForUser(handlerId, Session.get('spaceId'));\n    } else if (Meteor.isServer) {\n      return db.users.findOne(handlerId);\n    }\n  }\n};\n\nif (Meteor.isServer) {\n  TracesTemplate.helpers.dateFormat = function(date) {\n    var utcOffset;\n    if (date) {\n      utcOffset = Template.instance().view.template.steedosData.utcOffset;\n      return InstanceReadOnlyTemplate.formatDate(date, utcOffset);\n    }\n  };\n  TracesTemplate.helpers._t = function(key) {\n    var locale;\n    locale = Template.instance().view.template.steedosData.locale;\n    return TAPi18n.__(key, {}, locale);\n  };\n  TracesTemplate.helpers.showDeleteButton = function(approved) {\n    return false;\n  };\n}\n\nTracesTemplate.events = {\n  'click .cc-approve-remove': function(event, template) {\n    var approveId, instanceId;\n    event.stopPropagation();\n    if (event.currentTarget.dataset.calling * 1 !== 1) {\n      event.currentTarget.dataset.calling = 1;\n      $(\"i\", event.currentTarget).addClass(\"fa-spin\");\n      instanceId = Session.get('instanceId');\n      approveId = event.target.dataset.approve;\n      $(\"body\").addClass(\"loading\");\n      Meteor.call('cc_remove', instanceId, approveId, function(err, result) {\n        $(\"body\").removeClass(\"loading\");\n        if (err) {\n          toastr.error(err);\n          event.currentTarget.dataset.calling = 0;\n          $(\"i\", event.currentTarget).removeClass(\"fa-spin\");\n        }\n        if (result === true) {\n          toastr.success(TAPi18n.__(\"remove_cc_approve\"));\n          if ($(\".instance-trace-detail-modal\").length) {\n            Modal.hide(\"instance_trace_detail_modal\");\n          }\n        }\n      });\n    }\n  },\n  'click .instance-trace-detail-modal .btn-cc-approve-remove': function(event, template) {\n    var approveId, instanceId;\n    instanceId = Session.get('instanceId');\n    approveId = event.target.dataset.approve;\n    Modal.allowMultiple = true;\n    return Modal.show('cancel_cc_modal');\n  },\n  'click .approve-item,.approve-description': function(event, template) {\n    if (!$(event.target).closest(\"a.btn-link\").length) {\n      return Modal.show(\"instance_trace_detail_modal\", this);\n    }\n  },\n  'taphold .approve-item,.approve-description': function(event, template) {\n    if (!$(event.target).closest(\"a.btn-link\").length) {\n      return Modal.show(\"instance_trace_detail_modal\", this);\n    }\n  },\n  'click .approve-item a.btn-link,.approve-description a.btn-link,.approve-item-distribute a.btn-link': function(event, template) {\n    var ref, userId;\n    if (Steedos.isMobile()) {\n      userId = (ref = event.target.dataset) != null ? ref.target_user_id : void 0;\n      return Creator.openSafeObjectUrl('users', userId);\n    }\n  },\n  'tapend .approve-item,.approve-description': function(event, template) {\n    if (!$(event.target).closest(\"a.btn-link\").length) {\n      event.stopPropagation();\n      event.preventDefault();\n      return false;\n    }\n  },\n  'click .instance-trace-detail-modal .btn-forward-approve-remove': function(event, template) {\n    var approveId, instanceId, traceId;\n    instanceId = Session.get('instanceId');\n    approveId = event.target.dataset.approve;\n    traceId = event.target.dataset.trace;\n    $(\"body\").addClass(\"loading\");\n    Meteor.call('forward_remove', instanceId, traceId, approveId, function(err, result) {\n      $(\"body\").removeClass(\"loading\");\n      if (err) {\n        toastr.error(TAPi18n.__(err.reason));\n      }\n      if (result === true) {\n        toastr.success(TAPi18n.__(\"instance_approve_forward_remove_success\"));\n        Modal.hide(\"instance_trace_detail_modal\");\n      }\n    });\n  },\n  'click .instance-trace-detail-modal .btn-forward-instance-look': function(event, template) {\n    var forward_instance, forward_space;\n    forward_space = event.target.dataset.forwardspace;\n    forward_instance = event.target.dataset.forwardinstance;\n    return Steedos.openWindow(Steedos.absoluteUrl(\"workflow/space/\" + forward_space + \"/view/readonly/\" + forward_instance));\n  },\n  'click .btn-modification': function(event, template) {\n    template.is_editing.set(!template.is_editing.get());\n    if (!Steedos.isAndroidOrIOS()) {\n      return Tracker.afterFlush(function() {\n        return $(\"#instance_trace_detail_modal #finish_input\").on(\"dp.show\", function() {\n          return $(\".modal-body\").scrollTop(100);\n        });\n      });\n    }\n  },\n  'click .btn-cancelBut': function(event, template) {\n    return template.is_editing.set(!template.is_editing.get());\n  },\n  'click .btn-saveBut': function(event, template) {\n    var approveId, finish_input, instanceId, opinion_input, traceId;\n    instanceId = Session.get('instanceId');\n    approveId = event.target.dataset.approve;\n    traceId = event.target.dataset.trace;\n    opinion_input = $('#opinion_input').val();\n    finish_input = AutoForm.getFieldValue(\"finish_date\", \"finishDateAutoForm\");\n    $(\"body\").addClass(\"loading\");\n    return Meteor.call('change_approve_info', instanceId, traceId, approveId, opinion_input, finish_input, function(err, result) {\n      $(\"body\").removeClass(\"loading\");\n      if (err) {\n        toastr.error(TAPi18n.__(err.reason));\n      }\n      if (result === true) {\n        toastr.success(t(\"instance_approve_modal_modificationsave\"));\n        Modal.hide(\"instance_trace_detail_modal\");\n      }\n    });\n  },\n  'click .instance-trace-detail-modal .btn-distribute-approve-remove': function(event, template) {\n    Modal.allowMultiple = true;\n    return Modal.show('cancel_distribute_modal');\n  }\n};\n","RelatedInstances.helpers =\n\tshowRelatedInstaces: ->\n\t\tif Meteor.isClient\n\t\t\tins = WorkflowManager.getInstance();\n\t\telse\n\t\t\tins = this.instance\n\t\tif ins?.related_instances && _.isArray(ins?.related_instances)\n\t\t\tif db.instances.find({_id: {$in: ins.related_instances}}, {fields: {space: 1, name: 1}}).count() > 0\n\t\t\t\treturn true\n\t\t\treturn false\n\t\telse\n\t\t\treturn false\n\n\trelated_instaces: ->\n\t\tif Meteor.isClient\n\t\t\tins = WorkflowManager.getInstance();\n\t\telse\n\t\t\tins = this.instance\n\t\tif ins?.related_instances && _.isArray(ins?.related_instances)\n\t\t\treturn db.instances.find({_id: {$in: ins.related_instances}}, {fields: {space: 1, name: 1}}).fetch()\n\n\trelated_instace_url: (ins) ->\n\n\t\tif Meteor.isClient && (Steedos.isMobile() || Steedos.isCordova())\n\t\t\treturn ''\n\n\t\tabsolute = false\n\n\t\tif Meteor.isServer\n\t\t\tabsolute = this.absolute\n\t\tif absolute\n\t\t\treturn Meteor.absoluteUrl(\"workflow/space/\"+ins.space+\"/view/readonly/\" + ins._id + '?hide_traces=0')\n\t\telse\n\t\t\treturn Steedos.absoluteUrl(\"workflow/space/\"+ins.space+\"/view/readonly/\" + ins._id + '?hide_traces=0')\n\n\t_t: (key)->\n\t\tif Meteor.isClient\n\t\t\treturn TAPi18n.__(key)\n\t\telse\n\t\t\tlocale = Template.instance().view.template.steedosData.locale\n\t\t\treturn TAPi18n.__(key, {}, locale)\n\n\tshow_delete: ()->\n\t\tif !Meteor.isClient\n\t\t\treturn false\n\t\telse\n\t\t\tif Session.get(\"box\") == \"draft\" || Session.get(\"box\") == 'inbox'\n\t\t\t\tcurrent_step = InstanceManager.getCurrentStep()\n\t\t\t\tif current_step\n\t\t\t\t\tif (current_step.can_edit_main_attach || current_step.can_edit_normal_attach == true || current_step.can_edit_normal_attach == undefined)\n\t\t\t\t\t\treturn true","RelatedInstances.helpers = {\n  showRelatedInstaces: function() {\n    var ins;\n    if (Meteor.isClient) {\n      ins = WorkflowManager.getInstance();\n    } else {\n      ins = this.instance;\n    }\n    if ((ins != null ? ins.related_instances : void 0) && _.isArray(ins != null ? ins.related_instances : void 0)) {\n      if (db.instances.find({\n        _id: {\n          $in: ins.related_instances\n        }\n      }, {\n        fields: {\n          space: 1,\n          name: 1\n        }\n      }).count() > 0) {\n        return true;\n      }\n      return false;\n    } else {\n      return false;\n    }\n  },\n  related_instaces: function() {\n    var ins;\n    if (Meteor.isClient) {\n      ins = WorkflowManager.getInstance();\n    } else {\n      ins = this.instance;\n    }\n    if ((ins != null ? ins.related_instances : void 0) && _.isArray(ins != null ? ins.related_instances : void 0)) {\n      return db.instances.find({\n        _id: {\n          $in: ins.related_instances\n        }\n      }, {\n        fields: {\n          space: 1,\n          name: 1\n        }\n      }).fetch();\n    }\n  },\n  related_instace_url: function(ins) {\n    var absolute;\n    if (Meteor.isClient && (Steedos.isMobile() || Steedos.isCordova())) {\n      return '';\n    }\n    absolute = false;\n    if (Meteor.isServer) {\n      absolute = this.absolute;\n    }\n    if (absolute) {\n      return Meteor.absoluteUrl(\"workflow/space/\" + ins.space + \"/view/readonly/\" + ins._id + '?hide_traces=0');\n    } else {\n      return Steedos.absoluteUrl(\"workflow/space/\" + ins.space + \"/view/readonly/\" + ins._id + '?hide_traces=0');\n    }\n  },\n  _t: function(key) {\n    var locale;\n    if (Meteor.isClient) {\n      return TAPi18n.__(key);\n    } else {\n      locale = Template.instance().view.template.steedosData.locale;\n      return TAPi18n.__(key, {}, locale);\n    }\n  },\n  show_delete: function() {\n    var current_step;\n    if (!Meteor.isClient) {\n      return false;\n    } else {\n      if (Session.get(\"box\") === \"draft\" || Session.get(\"box\") === 'inbox') {\n        current_step = InstanceManager.getCurrentStep();\n        if (current_step) {\n          if (current_step.can_edit_main_attach || current_step.can_edit_normal_attach === true || current_step.can_edit_normal_attach === void 0) {\n            return true;\n          }\n        }\n      }\n    }\n  }\n};\n","RelatedRecords.helpers =\n\tshowRelatedRecords: ()->\n\t\tif Meteor.isClient\n\t\t\tins = WorkflowManager.getInstance();\n\t\telse\n\t\t\tins = this.instance\n\t\tif !ins\n\t\t\treturn false\n\t\treturn !_.isEmpty(ins.record_ids)\n\trelatedRecordUrl: ()->\n\t\tif Meteor.isClient && (Steedos.isMobile() || Steedos.isCordova())\n\t\t\treturn ''\n\n\t\tabsolute = false\n\t\t\n\t\tif Meteor.isServer\n\t\t\tins = this.instance\n\t\t\tabsolute = this.absolute\n\t\telse\n\t\t\tins = WorkflowManager.getInstance();\n\t\n\t\tobjcetName = ins.record_ids[0].o\n\t\tid = ins.record_ids[0].ids[0]\n\n\t\tif absolute\n\t\t\treturn Meteor.absoluteUrl(\"app/-/#{objcetName}/view/#{id}\")\n\t\telse\n\t\t\treturn Steedos.absoluteUrl(\"app/-/#{objcetName}/view/#{id}\")","RelatedRecords.helpers = {\n  showRelatedRecords: function() {\n    var ins;\n    if (Meteor.isClient) {\n      ins = WorkflowManager.getInstance();\n    } else {\n      ins = this.instance;\n    }\n    if (!ins) {\n      return false;\n    }\n    return !_.isEmpty(ins.record_ids);\n  },\n  relatedRecordUrl: function() {\n    var absolute, id, ins, objcetName;\n    if (Meteor.isClient && (Steedos.isMobile() || Steedos.isCordova())) {\n      return '';\n    }\n    absolute = false;\n    if (Meteor.isServer) {\n      ins = this.instance;\n      absolute = this.absolute;\n    } else {\n      ins = WorkflowManager.getInstance();\n    }\n    objcetName = ins.record_ids[0].o;\n    id = ins.record_ids[0].ids[0];\n    if (absolute) {\n      return Meteor.absoluteUrl(\"app/-/\" + objcetName + \"/view/\" + id);\n    } else {\n      return Steedos.absoluteUrl(\"app/-/\" + objcetName + \"/view/\" + id);\n    }\n  }\n};\n","/*\n * @Author: sunhaolin@hotoa.com\n * @Date: 2021-05-24 12:32:56\n * @LastEditors: sunhaolin@hotoa.com\n * @LastEditTime: 2022-12-24 15:29:22\n * @Description: \n */\n// JsonRoutes.add(\"post\", \"/api/workflow/getSpaceUsers\", function (req, res, next) {\n//   var\n//     userIds = req.body.userIds,\n//     spaceId = req.query.spaceId,\n//     spaceUsers = []\n//   ;\n\n//   if (!userIds || !spaceId) {\n//     JsonRoutes.sendResult(res, {\n//       code: 200,\n//       data: {\n//         'errors': 'ç¼ºå°‘å‚æ•°'\n//       }\n//     });\n//   }\n\n//   spaceUsers = WorkflowManager.getUsers(spaceId, userIds);\n\n//   JsonRoutes.sendResult(res, {\n//     code: 200,\n//     data: {\n//       'spaceUsers': spaceUsers\n//     }\n//   });\n// })\n\n\n  \n  ","/*\n * @Author: sunhaolin@hotoa.com\n * @Date: 2021-05-24 12:32:56\n * @LastEditors: sunhaolin@hotoa.com\n * @LastEditTime: 2022-12-24 15:23:14\n * @Description: \n */\n// JsonRoutes.add(\"post\", \"/api/workflow/getFormulaUserObjects\", function (req, res, next) {\n//   var\n//     userIds = req.body.userIds,\n//     spaceId = req.query.spaceId,\n//     spaceUsers = []\n//   ;\n\n//   if (!userIds || !spaceId) {\n//     JsonRoutes.sendResult(res, {\n//       code: 200,\n//       data: {\n//         'errors': 'ç¼ºå°‘å‚æ•°'\n//       }\n//     });\n//   }\n\n//   var users = WorkflowManager.getFormulaUserObject(spaceId, userIds);\n\n//   JsonRoutes.sendResult(res, {\n//     code: 200,\n//     data: {\n//       'spaceUsers': users\n//     }\n//   });\n// })\n\n\n  \n  ","/*\n * @Author: sunhaolin@hotoa.com\n * @Date: 2021-05-24 12:32:56\n * @LastEditors: sunhaolin@hotoa.com\n * @LastEditTime: 2022-12-24 15:38:54\n * @Description: \n */\n// JsonRoutes.add(\"post\", \"/api/workflow/init_formula_values\", function(req, res, next) {\n// \tvar\n// \t\tfields = req.body.fields,\n// \t\tautoFormDoc = req.body.autoFormDoc,\n// \t\tapprover = req.body.approver,\n// \t\tapplicant = req.body.applicant,\n\n// \t\tspaceId = req.query.spaceId,\n\n// \t\tspaceUsers = [];\n\n// \tif (!fields || !spaceId || !autoFormDoc || !approver || !applicant) {\n// \t\tJsonRoutes.sendResult(res, {\n// \t\t\tcode: 200,\n// \t\t\tdata: {\n// \t\t\t\t'errors': 'ç¼ºå°‘å‚æ•°'\n// \t\t\t}\n// \t\t});\n// \t\treturn;\n// \t}\n\n// \tformula_values = Form_formula.init_formula_values(fields, autoFormDoc, approver, applicant, spaceId);\n\n// \tJsonRoutes.sendResult(res, {\n// \t\tcode: 200,\n// \t\tdata: {\n// \t\t\t'formula_values': formula_values\n// \t\t}\n// \t});\n// })\n","// JsonRoutes.add('post', '/api/workflow/forward', function (req, res, next) {\n// \ttry {\n// \t\tvar current_user_info = uuflowManager.check_authorization(req);\n// \t\tvar current_user_id = current_user_info._id;\n\n// \t\tvar hashData = req.body;\n// \t\tvar instance_id = hashData.instance_id;\n// \t\tvar space_id = hashData.space_id;\n// \t\tvar flow_id = hashData.flow_id;\n// \t\tvar hasSaveInstanceToAttachment = hashData.hasSaveInstanceToAttachment;\n// \t\tvar description = hashData.description;\n// \t\tvar isForwardAttachments = hashData.isForwardAttachments;\n// \t\tvar selectedUsers = hashData.selectedUsers;\n// \t\tvar action_type = hashData.action_type;\n// \t\tvar related = hashData.related;\n// \t\tvar from_approve_id = hashData.from_approve_id;\n\n// \t\tcheck(instance_id, String);\n// \t\tcheck(space_id, String);\n// \t\tcheck(flow_id, String);\n// \t\tcheck(hasSaveInstanceToAttachment, Boolean);\n// \t\tcheck(description, String);\n// \t\tcheck(isForwardAttachments, Boolean);\n// \t\tcheck(selectedUsers, Array);\n// \t\tcheck(action_type, Match.OneOf('forward', 'distribute'));\n\n// \t\tif (action_type == \"distribute\")\n// \t\t\tcheck(from_approve_id, String);\n\n// \t\tvar ins = db.instances.findOne(instance_id);\n// \t\tvar old_space_id = ins.space;\n\n// \t\tvar flow = db.flows.findOne(flow_id);\n\n// \t\tvar space = db.spaces.findOne(space_id);\n\n// \t\tif (!ins || !flow || !space) {\n// \t\t\tthrow new Meteor.Error('params error!', 'record not exists!');\n// \t\t}\n\n// \t\tvar forward_users = new Array;\n// \t\tif (_.isEmpty(selectedUsers)) {\n// \t\t\tforward_users = [current_user_id];\n// \t\t} else {\n// \t\t\tforward_users = selectedUsers;\n// \t\t}\n\n// \t\t// æ ¡éªŒåˆ†å‘å¯¹è±¡æ˜¯å¦æœ‰åˆ†å‘æµç¨‹çš„æäº¤æƒé™\n// \t\tvar no_permission_user_ids = new Array();\n// \t\t_.each(forward_users, function (uid) {\n// \t\t\tvar permissions = permissionManager.getFlowPermissions(flow_id, uid);\n// \t\t\tif (!permissions.includes(\"add\")) {\n// \t\t\t\t// throw new Meteor.Error('error!', \"è¯¥ç”³è¯·äººæ²¡æœ‰æäº¤æ­¤ç”³è¯·å•çš„æƒé™ã€‚\")\n// \t\t\t\tno_permission_user_ids.push(uid);\n// \t\t\t}\n// \t\t})\n// \t\tif (!_.isEmpty(no_permission_user_ids)) {\n// \t\t\tvar no_permission_users_name = new Array();\n// \t\t\tdb.users.find({\n// \t\t\t\t_id: {\n// \t\t\t\t\t$in: no_permission_user_ids\n// \t\t\t\t}\n// \t\t\t}, {\n// \t\t\t\tfields: {\n// \t\t\t\t\tname: 1\n// \t\t\t\t}\n// \t\t\t}).forEach(function (u) {\n// \t\t\t\tno_permission_users_name.push(u.name);\n// \t\t\t});\n// \t\t\tthrow new Meteor.Error('no_permission', \"è¯¥æäº¤äººæ²¡æœ‰æäº¤æ­¤ç”³è¯·å•çš„æƒé™ã€‚\", no_permission_users_name.join(','))\n// \t\t}\n\n// \t\tvar new_ins_ids = new Array;\n\n// \t\tvar current_trace = null;\n// \t\tif (action_type == \"distribute\") {\n// \t\t\t_.each(ins.traces, function (t) {\n// \t\t\t\tif (!current_trace) {\n// \t\t\t\t\t_.each(t.approves, function (a) {\n// \t\t\t\t\t\tif (!current_trace) {\n// \t\t\t\t\t\t\tif (a._id == from_approve_id)\n// \t\t\t\t\t\t\t\tcurrent_trace = t;\n// \t\t\t\t\t\t}\n// \t\t\t\t\t})\n// \t\t\t\t}\n// \t\t\t})\n// \t\t} else {\n// \t\t\tcurrent_trace = _.last(ins.traces);\n// \t\t}\n// \t\tvar current_trace_id = current_trace._id;\n// \t\tvar forward_approves = [];\n// \t\tvar from_user_name = db.users.findOne(current_user_id, {\n// \t\t\tfields: {\n// \t\t\t\tname: 1\n// \t\t\t}\n// \t\t}).name\n// \t\tvar set_obj = new Object;\n\n// \t\t// è®¡ç®—values\n// \t\tvar old_values = ins.values,\n// \t\t\tnew_values = {};\n// \t\tvar form = db.forms.findOne(flow.form);\n// \t\tvar fields = form.current.fields || [];\n\n// \t\tvar old_form = db.forms.findOne(ins.form);\n// \t\tvar old_form_version = ins.form_version,\n// \t\t\told_fields = [],\n// \t\t\tcommon_fields = [];\n\n// \t\tvar select_to_input_fields = [];\n\n// \t\tif (old_form.current._id == old_form_version) {\n// \t\t\told_fields = old_form.current.fields;\n// \t\t} else {\n// \t\t\tif (old_form.historys) {\n// \t\t\t\told_form.historys.forEach(function (h) {\n// \t\t\t\t\tif (h._id == old_form_version)\n// \t\t\t\t\t\told_fields = h.fields;\n// \t\t\t\t})\n// \t\t\t}\n// \t\t}\n\n// \t\tfields.forEach(function (field) {\n// \t\t\tvar exists_field = _.find(old_fields, function (f) {\n// \t\t\t\treturn f.type == field.type && f.code == field.code;\n// \t\t\t})\n// \t\t\tif (exists_field)\n// \t\t\t\tcommon_fields.push(field);\n// \t\t\tvar select_input_field = _.find(old_fields, function (f) {\n// \t\t\t\treturn f.type == 'select' && field.type == 'input' && f.code == field.code;\n// \t\t\t})\n// \t\t\tif (select_input_field)\n// \t\t\t\tselect_to_input_fields.push(select_input_field);\n// \t\t})\n\n// \t\tselect_to_input_fields.forEach(function (field) {\n// \t\t\tif (old_values[field.code]) {\n// \t\t\t\tnew_values[field.code] = old_values[field.code];\n// \t\t\t}\n// \t\t})\n\n// \t\tcommon_fields.forEach(function (field) {\n// \t\t\tif (field.type == 'section') {\n// \t\t\t\tif (field.fields) {\n// \t\t\t\t\tfield.fields.forEach(function (f) {\n// \t\t\t\t\t\t// è·¨å·¥ä½œåŒºè½¬å‘ä¸å¤åˆ¶é€‰äººé€‰ç»„\n// \t\t\t\t\t\tif (['group', 'user'].includes(f.type) && old_space_id != space_id) {\n// \t\t\t\t\t\t\treturn;\n// \t\t\t\t\t\t}\n// \t\t\t\t\t\tvar key = f.code;\n// \t\t\t\t\t\tvar old_v = old_values[key];\n// \t\t\t\t\t\tif (old_v) {\n// \t\t\t\t\t\t\tvar fieldOptions = f.options && f.options.split && f.options.split(\"\\n\").map(function(n){\n// \t\t\t\t\t\t\t\tvar itemSplits = n.split(\":\");\n// \t\t\t\t\t\t\t\treturn {\n// \t\t\t\t\t\t\t\t\tlabel: itemSplits[0],\n// \t\t\t\t\t\t\t\t\tvalue: itemSplits[1] || n\n// \t\t\t\t\t\t\t\t}\n// \t\t\t\t\t\t\t});\n// \t\t\t\t\t\t\t// æ ¡éªŒ å•é€‰ï¼Œå¤šé€‰ï¼Œä¸‹æ‹‰æ¡† å­—æ®µå€¼æ˜¯å¦åœ¨æ–°è¡¨å•å¯¹åº”å­—æ®µçš„å¯é€‰å€¼èŒƒå›´å†…\n// \t\t\t\t\t\t\tif (f.type == 'select' || f.type == 'radio') {\n// \t\t\t\t\t\t\t\tvar selectedOption = fieldOptions.find(function(item) {\n// \t\t\t\t\t\t\t\t\treturn item.value === old_v;\n// \t\t\t\t\t\t\t\t});\n// \t\t\t\t\t\t\t\tif(!selectedOption){\n// \t\t\t\t\t\t\t\t\treturn;\n// \t\t\t\t\t\t\t\t}\n// \t\t\t\t\t\t\t}\n\n// \t\t\t\t\t\t\tif (f.type == 'multiSelect') {\n// \t\t\t\t\t\t\t\tvar old_multiSelected = old_v.split(',');\n// \t\t\t\t\t\t\t\tvar new_multiSelected = _.intersection(fieldOptions.map(function(n){ return n.value; }), old_multiSelected);\n// \t\t\t\t\t\t\t\told_v = new_multiSelected.join(',');\n// \t\t\t\t\t\t\t}\n\n// \t\t\t\t\t\t\tnew_values[key] = old_v;\n// \t\t\t\t\t\t}\n// \t\t\t\t\t})\n// \t\t\t\t}\n// \t\t\t} else if (field.type == 'table') {\n// \t\t\t\tif (!_.isEmpty(old_values[field.code])) {\n// \t\t\t\t\tnew_values[field.code] = new Array;\n// \t\t\t\t\told_values[field.code].forEach(function (old_table_row_values) {\n// \t\t\t\t\t\tvar new_table_row_values = {};\n\n// \t\t\t\t\t\tif (!_.isEmpty(field.fields)) {\n// \t\t\t\t\t\t\tfield.fields.forEach(function (f) {\n// \t\t\t\t\t\t\t\t// è·¨å·¥ä½œåŒºè½¬å‘ä¸å¤åˆ¶é€‰äººé€‰ç»„\n// \t\t\t\t\t\t\t\tif (['group', 'user'].includes(f.type) && old_space_id != space_id) {\n// \t\t\t\t\t\t\t\t\treturn;\n// \t\t\t\t\t\t\t\t}\n// \t\t\t\t\t\t\t\tvar key = f.code;\n// \t\t\t\t\t\t\t\tvar old_v = old_table_row_values[key];\n// \t\t\t\t\t\t\t\tif (old_v) {\n// \t\t\t\t\t\t\t\t\tvar fieldOptions = f.options && f.options.split && f.options.split(\"\\n\").map(function(n){\n// \t\t\t\t\t\t\t\t\t\tvar itemSplits = n.split(\":\");\n// \t\t\t\t\t\t\t\t\t\treturn {\n// \t\t\t\t\t\t\t\t\t\t\tlabel: itemSplits[0],\n// \t\t\t\t\t\t\t\t\t\t\tvalue: itemSplits[1] || n\n// \t\t\t\t\t\t\t\t\t\t}\n// \t\t\t\t\t\t\t\t\t});\n// \t\t\t\t\t\t\t\t\t// æ ¡éªŒ å•é€‰ï¼Œå¤šé€‰ï¼Œä¸‹æ‹‰æ¡† å­—æ®µå€¼æ˜¯å¦åœ¨æ–°è¡¨å•å¯¹åº”å­—æ®µçš„å¯é€‰å€¼èŒƒå›´å†…\n// \t\t\t\t\t\t\t\t\tif (f.type == 'select' || f.type == 'radio') {\n// \t\t\t\t\t\t\t\t\t\tvar selectedOption = fieldOptions.find(function(item) {\n// \t\t\t\t\t\t\t\t\t\t\treturn item.value === old_v;\n// \t\t\t\t\t\t\t\t\t\t});\n// \t\t\t\t\t\t\t\t\t\tif(!selectedOption){\n// \t\t\t\t\t\t\t\t\t\t\treturn;\n// \t\t\t\t\t\t\t\t\t\t}\n// \t\t\t\t\t\t\t\t\t}\n\n// \t\t\t\t\t\t\t\t\tif (f.type == 'multiSelect') {\n// \t\t\t\t\t\t\t\t\t\tvar old_multiSelected = old_v.split(',');\n// \t\t\t\t\t\t\t\t\t\tvar new_multiSelected = _.intersection(fieldOptions.map(function(n){ return n.value; }), old_multiSelected);\n// \t\t\t\t\t\t\t\t\t\told_v = new_multiSelected.join(',');\n// \t\t\t\t\t\t\t\t\t}\n\n// \t\t\t\t\t\t\t\t\tnew_table_row_values[key] = old_v;\n// \t\t\t\t\t\t\t\t}\n// \t\t\t\t\t\t\t})\n// \t\t\t\t\t\t}\n\n// \t\t\t\t\t\tif (old_table_row_values._id) {\n// \t\t\t\t\t\t\tnew_table_row_values._id = new Mongo.ObjectID()._str;\n// \t\t\t\t\t\t}\n\n// \t\t\t\t\t\tif (!_.isEmpty(new_table_row_values)) {\n// \t\t\t\t\t\t\tnew_values[field.code].push(new_table_row_values);\n// \t\t\t\t\t\t}\n// \t\t\t\t\t})\n// \t\t\t\t}\n// \t\t\t} else {\n// \t\t\t\t// è·¨å·¥ä½œåŒºè½¬å‘ä¸å¤åˆ¶é€‰äººé€‰ç»„\n// \t\t\t\tif (['group', 'user'].includes(field.type) && old_space_id != space_id) {\n// \t\t\t\t\treturn;\n// \t\t\t\t}\n// \t\t\t\tvar key = field.code;\n// \t\t\t\tvar old_v = old_values[key];\n// \t\t\t\tif (old_v) {\n// \t\t\t\t\t// æ ¡éªŒ å•é€‰ï¼Œå¤šé€‰ï¼Œä¸‹æ‹‰æ¡† å­—æ®µå€¼æ˜¯å¦åœ¨æ–°è¡¨å•å¯¹åº”å­—æ®µçš„å¯é€‰å€¼èŒƒå›´å†…\n// \t\t\t\t\tvar fieldOptions = field.options && field.options.split && field.options.split(\"\\n\").map(function(n){\n// \t\t\t\t\t\tvar itemSplits = n.split(\":\");\n// \t\t\t\t\t\treturn {\n// \t\t\t\t\t\t\tlabel: itemSplits[0],\n// \t\t\t\t\t\t\tvalue: itemSplits[1] || n\n// \t\t\t\t\t\t}\n// \t\t\t\t\t});\n// \t\t\t\t\tif (field.type == 'select' || field.type == 'radio') {\n// \t\t\t\t\t\tvar selectedOption = fieldOptions.find(function(item) {\n// \t\t\t\t\t\t\treturn item.value === old_v;\n// \t\t\t\t\t\t});\n// \t\t\t\t\t\tif(!selectedOption){\n// \t\t\t\t\t\t\treturn;\n// \t\t\t\t\t\t}\n// \t\t\t\t\t}\n\n// \t\t\t\t\tif (field.type == 'multiSelect') {\n// \t\t\t\t\t\tvar old_multiSelected = old_v.split(',');\n// \t\t\t\t\t\tvar new_multiSelected = _.intersection(fieldOptions.map(function(n){ return n.value; }), old_multiSelected);\n// \t\t\t\t\t\told_v = new_multiSelected.join(',');\n// \t\t\t\t\t}\n\n// \t\t\t\t\tnew_values[key] = old_v;\n// \t\t\t\t}\n// \t\t\t}\n\n// \t\t})\n\n// \t\t//å¦‚æžœæ˜¯åˆ†å‘ï¼Œåˆ™valueä¸­çš„record_needã€FONDSIDä¸éœ€è¦åˆ†å‘åˆ°æ–°ç”³è¯·å•ä¸­\n// \t\tif (action_type === 'distribute') {\n// \t\t\tdelete new_values.record_need;\n// \t\t\tdelete new_values.FONDSID;\n// \t\t}\n\n// \t\t// è®¡ç®—ç”³è¯·å•æ ‡é¢˜\n// \t\tvar instance_name = \"\";\n// \t\tvar name_forumla = form.current.name_forumla;\n// \t\tif (name_forumla) {\n// \t\t\ttry {\n// \t\t\t\tvar iscript = name_forumla.replace(/\\{/g, \"(new_values['\").replace(/\\}/g, \"'] || '')\");\n// \t\t\t\tvar rev = eval(iscript);\n// \t\t\t\tinstance_name = rev || flow.name;\n// \t\t\t} catch (error) {\n// \t\t\t\tthrow new Meteor.Error('caculate_instance_name', \"è®¡ç®—ç”³è¯·å•æ ‡é¢˜å‡ºé”™è¯·æ£€æŸ¥è¡¨å•æ ‡é¢˜è„šæœ¬ã€‚\");\n// \t\t\t}\n// \t\t} else {\n// \t\t\tinstance_name = flow.name;\n// \t\t}\n\n// \t\t// instanceä¸­è®°å½•å½“å‰æ­¥éª¤åç§° #1314\n// \t\tvar start_step = _.find(flow.current.steps, function (step) {\n// \t\t\treturn step.step_type == 'start';\n// \t\t})\n\n// \t\t// æµç¨‹è½¬å‘åŠŸèƒ½ä¿®æ”¹ä¸ºï¼Œå¼€å§‹èŠ‚ç‚¹æœ‰ç¼–è¾‘æƒé™çš„å­—æ®µçš„å€¼è¿›è¡Œå¤åˆ¶ï¼Œæ— ç¼–è¾‘æƒé™çš„å­—æ®µå€¼ä¸è¿›è¡Œå¤åˆ¶ #3748\n// \t\tif (action_type === 'forward') {\n// \t\t\tnew_values = uuflowManager.getApproveValues(new_values, start_step.permissions, flow.form, flow.current.form_version);\n// \t\t}\n\n// \t\t// æ–°å»ºç”³è¯·å•æ—¶ï¼Œinstancesè®°å½•æµç¨‹åç§°ã€æµç¨‹åˆ†ç±»åç§° #1313\n// \t\tvar category_name = \"\";\n// \t\tif (form.category) {\n// \t\t\tvar category = uuflowManager.getCategory(form.category);\n// \t\t\tif (category)\n// \t\t\t\tcategory_name = category.name;\n// \t\t}\n\n// \t\t_.each(forward_users, function (user_id) {\n\n// \t\t\tvar user_info = db.users.findOne(user_id);\n\n// \t\t\tvar space_user = db.space_users.findOne({\n// \t\t\t\tspace: space_id,\n// \t\t\t\tuser: user_id\n// \t\t\t}, {\n// \t\t\t\tfields: {\n// \t\t\t\t\torganization: 1\n// \t\t\t\t}\n// \t\t\t});\n// \t\t\tvar space_user_org_info = db.organizations.findOne({\n// \t\t\t\t_id: space_user.organization\n// \t\t\t}, {\n// \t\t\t\tfields: {\n// \t\t\t\t\tname: 1,\n// \t\t\t\t\tfullname: 1\n// \t\t\t\t}\n// \t\t\t});\n\n// \t\t\tvar now = new Date();\n// \t\t\tvar ins_obj = {};\n\n// \t\t\tvar agent = uuflowManager.getAgent(space_id, user_id);\n// \t\t\tvar handler_id = user_id;\n// \t\t\tvar handler_info = user_info;\n// \t\t\tvar handler_space_user = space_user;\n// \t\t\tvar handler_org_info = space_user_org_info;\n// \t\t\tif (agent) {\n// \t\t\t\thandler_id = agent;\n// \t\t\t\thandler_info = db.users.findOne(agent);\n// \t\t\t\thandler_space_user = uuflowManager.getSpaceUser(space_id, agent);\n// \t\t\t\thandler_org_info = uuflowManager.getSpaceUserOrgInfo(handler_space_user);\n// \t\t\t}\n// \t\t\tins_obj._id = db.instances._makeNewID();\n// \t\t\tins_obj.space = space_id;\n// \t\t\tins_obj.flow = flow_id;\n// \t\t\tins_obj.flow_version = flow.current._id;\n// \t\t\tins_obj.form = flow.form;\n// \t\t\tins_obj.form_version = flow.current.form_version;\n// \t\t\tins_obj.name = instance_name;\n// \t\t\tins_obj.submitter = handler_id;\n// \t\t\tins_obj.submitter_name = handler_info.name;\n// \t\t\tins_obj.applicant = user_id;\n// \t\t\tins_obj.applicant_name = user_info.name;\n// \t\t\tins_obj.applicant_organization = space_user.organization;\n// \t\t\tins_obj.applicant_organization_name = space_user_org_info.name;\n// \t\t\tins_obj.applicant_organization_fullname = space_user_org_info.fullname;\n// \t\t\tins_obj.state = \"draft\";\n// \t\t\tins_obj.code = \"\";\n// \t\t\tins_obj.is_archived = false;\n// \t\t\tins_obj.is_deleted = false;\n// \t\t\tins_obj.created = now;\n// \t\t\tins_obj.created_by = current_user_id;\n// \t\t\tins_obj.modified = now;\n// \t\t\tins_obj.modified_by = current_user_id;\n// \t\t\tins_obj.inbox_users = [handler_id];\n// \t\t\tins_obj.values = new_values;\n// \t\t\tif (action_type == 'distribute') {\n// \t\t\t\t// è§£å†³å¤šæ¬¡åˆ†å‘çœ‹ä¸åˆ°æ­£æ–‡ã€é™„ä»¶é—®é¢˜\n// \t\t\t\tif (ins.distribute_from_instance) {\n// \t\t\t\t\tins_obj.distribute_from_instance = ins.distribute_from_instance;\n// \t\t\t\t} else {\n// \t\t\t\t\tins_obj.distribute_from_instance = instance_id;\n// \t\t\t\t}\n// \t\t\t\tins_obj.distribute_from_instances = _.clone(ins.distribute_from_instances) || [];\n// \t\t\t\tins_obj.distribute_from_instances.push(instance_id);\n\n// \t\t\t\tif (related) {\n// \t\t\t\t\tins_obj.related_instances = [instance_id]\n// \t\t\t\t}\n\n// \t\t\t} else if (action_type == 'forward') {\n// \t\t\t\tins_obj.forward_from_instance = instance_id\n// \t\t\t}\n\n// \t\t\t// æ–°å»ºTrace\n// \t\t\tvar trace_obj = {};\n// \t\t\ttrace_obj._id = new Mongo.ObjectID()._str;\n// \t\t\ttrace_obj.instance = ins_obj._id;\n// \t\t\ttrace_obj.is_finished = false;\n\n// \t\t\t// å½“å‰æœ€æ–°ç‰ˆflowä¸­å¼€å§‹èŠ‚ç‚¹çš„step_id\n// \t\t\tvar step_id, step_name, can_edit_main_attach, can_edit_normal_attach;\n// \t\t\tflow.current.steps.forEach(function (step) {\n// \t\t\t\tif (step.step_type == \"start\") {\n// \t\t\t\t\tstep_id = step._id;\n// \t\t\t\t\tstep_name = step.name;\n// \t\t\t\t\tcan_edit_main_attach = step.can_edit_main_attach;\n// \t\t\t\t\tcan_edit_normal_attach = step.can_edit_normal_attach;\n// \t\t\t\t}\n// \t\t\t})\n// \t\t\ttrace_obj.step = step_id;\n// \t\t\ttrace_obj.start_date = now;\n// \t\t\ttrace_obj.name = step_name;\n\n// \t\t\t// æ–°å»ºApprove\n// \t\t\tvar appr_obj = {};\n// \t\t\tappr_obj._id = new Mongo.ObjectID()._str;\n// \t\t\tappr_obj.instance = ins_obj._id;\n// \t\t\tappr_obj.trace = trace_obj._id;\n// \t\t\tappr_obj.is_finished = false;\n// \t\t\tappr_obj.user = user_id;\n// \t\t\tappr_obj.user_name = user_info.name;\n// \t\t\tappr_obj.handler = handler_id;\n// \t\t\tappr_obj.handler_name = handler_info.name;\n// \t\t\tappr_obj.handler_organization = handler_space_user.organization;\n// \t\t\tappr_obj.handler_organization_name = handler_org_info.name;\n// \t\t\tappr_obj.handler_organization_fullname = handler_org_info.fullname;\n// \t\t\tappr_obj.type = \"draft\";\n// \t\t\tappr_obj.start_date = now;\n// \t\t\tappr_obj.read_date = now;\n// \t\t\tappr_obj.is_read = false;\n// \t\t\tappr_obj.is_error = false;\n\n// \t\t\tappr_obj.values = new_values;\n\n// \t\t\tif (agent) {\n// \t\t\t\tappr_obj.agent = agent;\n// \t\t\t}\n\n// \t\t\ttrace_obj.approves = [appr_obj];\n// \t\t\tins_obj.traces = [trace_obj];\n\n// \t\t\tif (flow.auto_remind == true)\n// \t\t\t\tins_obj.auto_remind = true;\n\n// \t\t\tins_obj.current_step_name = start_step.name;\n\n// \t\t\tins_obj.flow_name = flow.name;\n// \t\t\tif (category_name) {\n// \t\t\t\tins_obj.category_name = category.name;\n// \t\t\t\tins_obj.category = category._id;\n// \t\t\t}\n\n// \t\t\tnew_ins_id = db.instances.insert(ins_obj);\n\n// \t\t\t// å¤åˆ¶é™„ä»¶\n// \t\t\tvar collection = cfs.instances;\n\n// \t\t\t//å°†åŽŸè¡¨å•å†…å®¹å­˜å‚¨ä¸ºç¬¬ä¸€ä¸ªé™„ä»¶\n// \t\t\tif (hasSaveInstanceToAttachment) {\n// \t\t\t\t// try {\n\n// \t\t\t\tinstanceHtml = InstanceReadOnlyTemplate.getInstanceHtml(user_info, space_id, ins, {\n// \t\t\t\t\tabsolute: true,\n// \t\t\t\t\tshowTrace: true\n// \t\t\t\t})\n// \t\t\t\tvar instanceFile = new FS.File();\n// \t\t\t\tinstanceFile.attachData(Buffer.from(instanceHtml, \"utf-8\"), {\n// \t\t\t\t\ttype: \"text/html\"\n// \t\t\t\t}, function (error) {\n// \t\t\t\t\tif (error) {\n// \t\t\t\t\t\tthrow new Meteor.Error(error.error, error.reason);\n// \t\t\t\t\t}\n\n// \t\t\t\t\tinstanceFile.name(ins.name + \".html\");\n// \t\t\t\t\tinstanceFile.size(instanceHtml.length);\n\n// \t\t\t\t\tvar metadata = {\n// \t\t\t\t\t\towner: user_id,\n// \t\t\t\t\t\towner_name: user_info.name,\n// \t\t\t\t\t\tspace: space_id,\n// \t\t\t\t\t\tinstance: new_ins_id,\n// \t\t\t\t\t\tapprove: appr_obj._id,\n// \t\t\t\t\t\tcurrent: true\n// \t\t\t\t\t};\n// \t\t\t\t\tinstanceFile.metadata = metadata;\n// \t\t\t\t\tvar fileObj = collection.insert(instanceFile);\n// \t\t\t\t\tfileObj.update({\n// \t\t\t\t\t\t$set: {\n// \t\t\t\t\t\t\t'metadata.parent': fileObj._id\n// \t\t\t\t\t\t}\n// \t\t\t\t\t})\n// \t\t\t\t})\n\n// \t\t\t\t// } catch (e) {\n// \t\t\t\t//     console.error(e);\n// \t\t\t\t// }\n// \t\t\t}\n\n// \t\t\tif (isForwardAttachments && action_type == 'forward') {\n// \t\t\t\tvar files = collection.find({\n// \t\t\t\t\t'metadata.instance': instance_id,\n// \t\t\t\t\t'metadata.current': true\n// \t\t\t\t});\n// \t\t\t\tfiles.forEach(function (f) {\n// \t\t\t\t\t// åˆ¤æ–­æ–°çš„æµç¨‹å¼€å§‹èŠ‚ç‚¹æ˜¯å¦æœ‰ç¼–è¾‘æ­£æ–‡å’Œç¼–è¾‘é™„ä»¶æƒé™\n// \t\t\t\t\tif (f.metadata.main == true) {\n// \t\t\t\t\t\tif (can_edit_main_attach != true && can_edit_normal_attach != true)\n// \t\t\t\t\t\t\treturn;\n// \t\t\t\t\t} else {\n// \t\t\t\t\t\tif (can_edit_normal_attach != true)\n// \t\t\t\t\t\t\treturn;\n// \t\t\t\t\t}\n\n// \t\t\t\t\tvar newFile = new FS.File();\n// \t\t\t\t\tnewFile.attachData(f.createReadStream('instances'), {\n// \t\t\t\t\t\ttype: f.original.type\n// \t\t\t\t\t}, function (err) {\n// \t\t\t\t\t\tif (err) {\n// \t\t\t\t\t\t\tthrow new Meteor.Error(err.error, err.reason);\n// \t\t\t\t\t\t}\n// \t\t\t\t\t\tnewFile.name(f.name());\n// \t\t\t\t\t\tnewFile.size(f.size());\n// \t\t\t\t\t\tvar metadata = {\n// \t\t\t\t\t\t\towner: user_id,\n// \t\t\t\t\t\t\towner_name: user_info.name,\n// \t\t\t\t\t\t\tspace: space_id,\n// \t\t\t\t\t\t\tinstance: new_ins_id,\n// \t\t\t\t\t\t\tapprove: appr_obj._id,\n// \t\t\t\t\t\t\tcurrent: true\n// \t\t\t\t\t\t};\n// \t\t\t\t\t\tif (f.metadata.main == true && can_edit_main_attach == true) {\n// \t\t\t\t\t\t\tmetadata.main = true;\n// \t\t\t\t\t\t}\n// \t\t\t\t\t\tnewFile.metadata = metadata;\n// \t\t\t\t\t\tvar fileObj = collection.insert(newFile);\n// \t\t\t\t\t\tfileObj.update({\n// \t\t\t\t\t\t\t$set: {\n// \t\t\t\t\t\t\t\t'metadata.parent': fileObj._id\n// \t\t\t\t\t\t\t}\n// \t\t\t\t\t\t})\n// \t\t\t\t\t})\n\n// \t\t\t\t})\n// \t\t\t}\n\n// \t\t\tif (action_type === 'distribute') {\n// \t\t\t\t// ç»™å½“å‰çš„ç”³è¯·å•å¢žåŠ åˆ†å‘è®°å½•\n// \t\t\t\tvar appr = {\n// \t\t\t\t\t'_id': new Mongo.ObjectID()._str,\n// \t\t\t\t\t'instance': instance_id,\n// \t\t\t\t\t'trace': current_trace_id,\n// \t\t\t\t\t'is_finished': true,\n// \t\t\t\t\t'user': user_id,\n// \t\t\t\t\t'user_name': user_info.name,\n// \t\t\t\t\t'handler': user_id,\n// \t\t\t\t\t'handler_name': user_info.name,\n// \t\t\t\t\t'handler_organization': space_user.organization,\n// \t\t\t\t\t'handler_organization_name': space_user_org_info.name,\n// \t\t\t\t\t'handler_organization_fullname': space_user_org_info.fullname,\n// \t\t\t\t\t'type': action_type,\n// \t\t\t\t\t'start_date': new Date(),\n// \t\t\t\t\t'finish_date': new Date(),\n// \t\t\t\t\t'is_read': false,\n// \t\t\t\t\t'judge': 'submitted',\n// \t\t\t\t\t'from_user': current_user_id,\n// \t\t\t\t\t'from_user_name': from_user_name,\n// \t\t\t\t\t'forward_space': space_id,\n// \t\t\t\t\t'forward_instance': new_ins_id,\n// \t\t\t\t\t'description': description,\n// \t\t\t\t\t'from_approve_id': from_approve_id\n// \t\t\t\t};\n\n// \t\t\t\tforward_approves.push(appr);\n// \t\t\t}\n\n// \t\t\tnew_ins_ids.push(new_ins_id);\n// \t\t\tpushManager.send_message_to_specifyUser(\"current_user\", user_id);\n// \t\t})\n\n// \t\tif (!_.isEmpty(forward_approves)) {\n// \t\t\tset_obj.modified = new Date();\n// \t\t\tset_obj.modified_by = current_user_id;\n// \t\t\tvar r = db.instances.update({\n// \t\t\t\t_id: instance_id,\n// \t\t\t\t\"traces._id\": current_trace_id\n// \t\t\t}, {\n// \t\t\t\t$set: set_obj,\n// \t\t\t\t$addToSet: {\n// \t\t\t\t\t'traces.$.approves': {\n// \t\t\t\t\t\t$each: forward_approves\n// \t\t\t\t\t}\n// \t\t\t\t}\n// \t\t\t});\n// \t\t}\n\n\n// \t\tif (r) {\n// \t\t\t_.each(current_trace.approves, function (a, idx) {\n// \t\t\t\tif (a._id == from_approve_id) {\n// \t\t\t\t\tvar update_read = {};\n// \t\t\t\t\tupdate_read[\"traces.$.approves.\" + idx + \".read_date\"] = new Date();\n// \t\t\t\t\tdb.instances.update({\n// \t\t\t\t\t\t_id: instance_id,\n// \t\t\t\t\t\t\"traces._id\": current_trace_id\n// \t\t\t\t\t}, {\n// \t\t\t\t\t\t$set: update_read\n// \t\t\t\t\t});\n// \t\t\t\t}\n// \t\t\t})\n\n// \t\t}\n\n// \t\tJsonRoutes.sendResult(res, {\n// \t\t\tcode: 200,\n// \t\t\tdata: { new_ins_ids: new_ins_ids }\n// \t\t})\n// \t} catch (e) {\n// \t\tconsole.error(e.stack)\n// \t\tJsonRoutes.sendResult(res, {\n// \t\t\tcode: 200,\n// \t\t\tdata: {\n// \t\t\t\terrors: [e]\n// \t\t\t}\n// \t\t})\n// \t}\n\n// })","if process.env.CREATOR_NODE_ENV == 'development'\n    JsonRoutes.add 'post', '/test/webhook', (req, res, next) ->\n        try\n\n            hashData = req.body\n            console.log 'action: ', hashData.action\n            console.log 'from_user: ', hashData.from_user\n            console.log 'to_users: ', hashData.to_users\n\n\n            JsonRoutes.sendResult res,\n                    code: 200\n                    data: {}\n        catch e\n            console.error e.stack\n            JsonRoutes.sendResult res,\n                code: 200\n                data: { errors: [{errorMessage: e.message}] }","if (process.env.CREATOR_NODE_ENV === 'development') {\n  JsonRoutes.add('post', '/test/webhook', function(req, res, next) {\n    var e, hashData;\n    try {\n      hashData = req.body;\n      console.log('action: ', hashData.action);\n      console.log('from_user: ', hashData.from_user);\n      console.log('to_users: ', hashData.to_users);\n      return JsonRoutes.sendResult(res, {\n        code: 200,\n        data: {}\n      });\n    } catch (error) {\n      e = error;\n      console.error(e.stack);\n      return JsonRoutes.sendResult(res, {\n        code: 200,\n        data: {\n          errors: [\n            {\n              errorMessage: e.message\n            }\n          ]\n        }\n      });\n    }\n  });\n}\n","{ workflowMethods } = require('@steedos/workflow')\nMeteor.methods\n\tset_instance_step_approve: (ins_id, step_approve, stepsApprovesOptions)->\n\t\treturn workflowMethods.set_instance_step_approve.apply(this, arguments)\n\tset_instance_skip_steps: (ins_id, stepId, action)->\n\t\treturn workflowMethods.set_instance_skip_steps.apply(this, arguments)","/*\n * @Author: sunhaolin@hotoa.com\n * @Date: 2021-05-24 12:32:56\n * @LastEditors: sunhaolin@hotoa.com\n * @LastEditTime: 2022-12-22 15:18:59\n * @Description: \n */\nconst { workflowMethods } = require('@steedos/workflow')\nMeteor.methods({\n\n\tget_instance_data: function (instance_id, formCached, flowCached) {\n\t\treturn workflowMethods.get_instance_data.apply(this, arguments)\n\t}\n\n});\n","const { workflowMethods } = require('@steedos/workflow')\nMeteor.methods({\n\n\tdraft_save_instance: function (ins) {\n\t\treturn workflowMethods.draft_save_instance.apply(this, arguments)\n\t},\n\n\tinbox_save_instance: function (approve) {\n\t\treturn workflowMethods.inbox_save_instance.apply(this, arguments)\n\t}\n\n})","/*\n * @Author: sunhaolin@hotoa.com\n * @Date: 2023-01-13 17:35:13\n * @LastEditors: sunhaolin@hotoa.com\n * @LastEditTime: 2023-03-11 10:51:29\n * @Description: \n */\nconst { workflowMethods } = require('@steedos/workflow')\nMeteor.methods({\n\tcc_do: function (approve, cc_user_ids, description) {\n\t\treturn workflowMethods.cc_do.apply(this, arguments)\n\t},\n\n\tcc_read: function (approve) {\n\t\treturn workflowMethods.cc_read.apply(this, arguments)\n\t},\n\n\tcc_submit: function (ins_id, description, myApprove, ccHasEditPermission) {\n\t\treturn workflowMethods.cc_submit.apply(this, arguments)\n\t},\n\n\tcc_remove: function (instanceId, approveId) {\n\t\treturn workflowMethods.cc_remove.apply(this, arguments)\n\t},\n\n\tbatch_cancel_cc: function (instance_id, approve_ids) {\n\t\treturn workflowMethods.batch_cancel_cc.apply(this, arguments)\n\t},\n\n\tcc_save: function (ins_id, description, myApprove, ccHasEditPermission) {\n\t\treturn workflowMethods.cc_save.apply(this, arguments)\n\t}\n})","/*\n * @Author: sunhaolin@hotoa.com\n * @Date: 2021-05-24 12:32:56\n * @LastEditors: sunhaolin@hotoa.com\n * @LastEditTime: 2022-12-22 15:18:38\n * @Description: \n */\nconst { workflowMethods } = require('@steedos/workflow')\nMeteor.methods({\n\t// æ”¹ä¸ºé€šè¿‡apiè°ƒç”¨\n\tforward_instance: function (instance_id, space_id, flow_id, hasSaveInstanceToAttachment, description, isForwardAttachments, selectedUsers, action_type, related, from_approve_id) {\n\t\tif (!this.userId)\n\t\t\tthrow new Meteor.Error('not-authorized');\n\n\t\treturn;\n\t},\n\n\n\tforward_remove: function (instance_id, trace_id, approve_id) {\n\t\treturn workflowMethods.forward_remove.apply(this, arguments)\n\t},\n\n\tcancelDistribute: function (instance_id, approve_ids) {\n\t\treturn workflowMethods.cancelDistribute.apply(this, arguments)\n\t}\n\n\n})","/*\n * @Author: sunhaolin@hotoa.com\n * @Date: 2021-05-24 12:32:56\n * @LastEditors: sunhaolin@hotoa.com\n * @LastEditTime: 2022-12-22 15:17:54\n * @Description: \n */\nconst { workflowMethods } = require('@steedos/workflow')\nMeteor.methods({\n    cfs_instances_remove: function (file_id) {\n        return workflowMethods.cfs_instances_remove.apply(this, arguments)\n    },\n\n    cfs_instances_set_current: function (file_id) {\n        return workflowMethods.cfs_instances_set_current.apply(this, arguments)\n    },\n\n    cfs_instances_lock: function (file_id, user_id, user_name) {\n        return workflowMethods.cfs_instances_lock.apply(this, arguments)\n    },\n\n    cfs_instances_unlock: function (file_id) {\n        return workflowMethods.cfs_instances_unlock.apply(this, arguments)\n    },\n\n    download_space_instance_attachments_to_disk: function (spaceId, cfsRecordIds) {\n        return workflowMethods.download_space_instance_attachments_to_disk.apply(this, arguments)\n    }\n})","{ workflowMethods } = require('@steedos/workflow')\nMeteor.methods\n\tset_approve_have_read: (instanceId, traceId, approveId) ->\n\t\treturn workflowMethods.set_approve_have_read.apply(this, arguments)\n\n\tchange_approve_info: (instanceId, traceId, approveId, description, finish_date) ->\n\t\treturn workflowMethods.change_approve_info.apply(this, arguments)\n\n\tupdate_approve_sign: (instanceId, traceId, approveId, sign_field_code, description, sign_type, lastSignApprove)->\n\t\treturn workflowMethods.update_approve_sign.apply(this, arguments)\n\n\n\tupdate_sign_show: (objs, myApprove_id) ->\n\t\treturn workflowMethods.update_sign_show.apply(this, arguments)\n","{ workflowMethods } = require('@steedos/workflow')\nMeteor.methods\n\tinstance_return: (approve, reason)->\n\t\treturn workflowMethods.instance_return.apply(this, arguments)","{ workflowMethods } = require('@steedos/workflow')\nMeteor.methods\n\tinstance_remind: (remind_users, remind_count, remind_deadline, instance_id, action_types, trace_id)->\n\t\treturn workflowMethods.instance_remind.apply(this, arguments)\n","{ workflowMethods } = require('@steedos/workflow')\nMeteor.methods\n\tnext_step_users_not_found: (deal_type, step_name, params) ->\n\t\treturn workflowMethods.next_step_users_not_found.apply(this, arguments)\n","{ workflowMethods } = require('@steedos/workflow')\n_eval = require('eval')\n\nMeteor.methods\n\tinstanceNumberBuilder: (spaceId, name)->\n\t\treturn workflowMethods.instanceNumberBuilder.apply(this, arguments)\n","{ workflowMethods } = require('@steedos/workflow')\nMeteor.methods\n\tcheck_main_attach: (ins_id, name)->\n\t\treturn workflowMethods.check_main_attach.apply(this, arguments)\n","{ workflowMethods } = require('@steedos/workflow')\nMeteor.methods\n\tremove_related: (ins_id, re_ins_id)->\n\t\treturn workflowMethods.remove_related.apply(this, arguments)\n\n\tupdate_instance_related: (ins_id, related_instances)->\n\t\treturn workflowMethods.update_instance_related.apply(this, arguments)\n","{ workflowMethods } = require('@steedos/workflow')\nMeteor.methods\n\tupdateFlowPosition: (data) ->\n\t\treturn workflowMethods.updateFlowPosition.apply(this, arguments)\n\n\tupdateFlowRole: (data) ->\n\t\treturn workflowMethods.updateFlowRole.apply(this, arguments)","{ workflowMethods } = require('@steedos/workflow')\nMeteor.methods\n\tstart_flow: (space, flowId, start) ->\n\n\t\treturn workflowMethods.start_flow.apply(this, arguments)\n\n","{ workflowMethods } = require('@steedos/workflow')\nMeteor.methods\n\tget_instance_traces: (ins_id)->\n\t\treturn workflowMethods.get_instance_traces.apply(this, arguments)","{ workflowMethods } = require('@steedos/workflow')\nMeteor.methods\n\t'get_batch_instances': (space, categoryId, flowIds)->\n\t\treturn workflowMethods.get_batch_instances.apply(this, arguments)\n\n\t'get_batch_instances_count': (space, categoryId, flowIds)->\n\t\treturn workflowMethods.get_batch_instances_count.apply(this, arguments)\n\n\t'get_my_approves': (instanceIds)->\n\t\treturn workflowMethods.get_my_approves.apply(this, arguments)\n\n\n\n\n\n\n\n\n\n\n\n","{ workflowMethods } = require('@steedos/workflow')\nMeteor.methods\n\tchange_flow_state: (flows) ->\n\t\treturn workflowMethods.change_flow_state.apply(this, arguments)\n\n\n\n\n","{ workflowMethods } = require('@steedos/workflow')\nMeteor.methods\n\n\thide_instance: (insId, is_hidden) ->\n\t\treturn workflowMethods.hide_instance.apply(this, arguments)\n","{ workflowMethods } = require('@steedos/workflow')\nMeteor.methods\n\tgetInstanceValues: (insId)->\n\t\treturn workflowMethods.getInstanceValues.apply(this, arguments)","Cookies = require(\"cookies\")\n\ngetInstanceReadOnly = (req, res, next, options) ->\n\n\tuser = Steedos.getAPILoginUser(req, res)\n\n\tif req?.query?.access_token\n\t\tuserId = Steedos.getUserIdFromAccessToken(req.query.access_token)\n\t\tif userId\n\t\t\tuser = Meteor.users.findOne({_id: userId})\n\n\tspaceId = req.params.space\n\n\tinstanceId = req.params.instance_id\n\n\tinstance = db.instances.findOne({_id: instanceId});\n\n\tspace = db.spaces.findOne({_id: spaceId});\n\n\thide_traces = req.query?.hide_traces\n\n\tif !options\n\t\toptions = {showTrace: true}\n\telse\n\t\toptions.showTrace = true\n\n\tif hide_traces is \"1\"\n\t\tif options\n\t\t\toptions.showTrace = false\n\t\telse\n\t\t\toptions = {showTrace: false}\n\n\tif !options.showAttachments\n\t\toptions.showAttachments = true\n\n\tif !space\n\t\tJsonRoutes.sendResult res,\n\t\t\tcode: 401,\n\t\t\tdata:\n\t\t\t\t\"error\": \"Validate Request -- Missing space\",\n\t\t\t\t\"success\": false\n\t\treturn;\n\n\tif  !instance\n\t\tJsonRoutes.sendResult res,\n\t\t\tcode: 401,\n\t\t\tdata:\n\t\t\t\t\"error\": \"Validate Request -- Missing instance\",\n\t\t\t\t\"success\": false\n\t\treturn;\n\n\tif !user\n\t\tJsonRoutes.sendResult res,\n\t\t\tcode: 401,\n\t\t\tdata:\n\t\t\t\t\"error\": \"Validate Request -- Missing X-Auth-Token,X-User-Id\",\n\t\t\t\t\"success\": false\n\t\treturn;\n\n\tif instance.space != spaceId\n\t\tJsonRoutes.sendResult res,\n\t\t\tcode: 401,\n\t\t\tdata:\n\t\t\t\t\"error\": \"Validate Request -- Missing space or instance\",\n\t\t\t\t\"success\": false\n\t\treturn;\n\n\n\n\tspaceUserCount = db.space_users.find({ user: user._id, space: spaceId }).count()\n\n\tif spaceUserCount is 0\n\t\tif !space\n\t\t\tJsonRoutes.sendResult res,\n\t\t\t\tcode: 401,\n\t\t\t\tdata:\n\t\t\t\t\t\"error\": \"Validate Request -- Missing sapceUser\",\n\t\t\t\t\t\"success\": false\n\t\t\treturn;\n\n\t#æ ¡éªŒuseræ˜¯å¦å¯¹instanceæœ‰æŸ¥çœ‹æƒé™\n\t_hasPermission = WorkflowManager.hasInstancePermissions(user, instance)\n\n\tif !_hasPermission  && instance.distribute_from_instance\n\t\t_parent_instances = _.union([instance.distribute_from_instance], instance.distribute_from_instances || [])\n\n\t\t_hasPermission = _.find _parent_instances, (_parent_id)->\n\t\t\t_parent_ins = db.instances.findOne({_id:_parent_id}, {fields: {traces: 0}})\n\n\t\t\treturn WorkflowManager.hasInstancePermissions(user, _parent_ins)\n\n\tif !_hasPermission\n\t\t_locale = Steedos.locale(user._id, true)\n\t\terror = TAPi18n.__(\"instance_permissions_error\", {}, _locale)\n\t\tres.charset = \"utf-8\"\n\t\tJsonRoutes.sendResult res,\n\t\t\tcode: 401,\n\t\t\tdata:\n\t\t\t\t\"error\": error,\n\t\t\t\t\"success\": false\n\t\treturn;\n\n\thtml = InstanceReadOnlyTemplate.getInstanceHtml(user, space, instance, options)\n\tdataBuf = new Buffer(html);\n\tres.setHeader('Content-type', 'text/html; charset=utf-8');\n\tres.setHeader('content-length', dataBuf.length)\n\tres.setHeader('content-range', \"bytes 0-#{dataBuf.length - 1}/#{dataBuf.length}\")\n\tres.statusCode = 200\n\tres.end(html)\n\nJsonRoutes.add \"get\", \"/workflow/space/:space/view/readonly/:instance_id\", getInstanceReadOnly\n\nJsonRoutes.add \"get\", \"/workflow/space/:space/view/readonly/:instance_id/:instance_name\", (req, res, next)->\n\tres.setHeader('Content-type', 'application/x-msdownload');\n\tres.setHeader('Content-Disposition', 'attachment;filename='+encodeURI(req.params.instance_name));\n\tres.setHeader('Transfer-Encoding', '')\n\n\toptions = {absolute: true}\n\n\treturn getInstanceReadOnly(req, res, next, options)\n###\n\tèŽ·å–ç”³è¯·å•åˆ—è¡¨ï¼š\n    final_decisionï¼šå®¡æ‰¹ç»“æžœ\n    state: ç”³è¯·å•çŠ¶æ€\n###\nJsonRoutes.add \"get\", \"/api/workflow/instances\", (req, res, next) ->\n\n\tif !Steedos.APIAuthenticationCheck(req, res)\n\t\treturn ;\n\n\tuser_id = req.userId\n\n\tspaceId = req.headers[\"x-space-id\"]\n\n\tif not spaceId\n\t\tJsonRoutes.sendResult res,\n\t\t\tcode: 401,\n\t\t\tdata:\n\t\t\t\t\"error\": \"Validate Request -- Missing X-Space-Id\",\n\t\t\t\t\"success\": false\n\t\treturn;\n\n\tflowId = req.query?.flowId\n\n\tif !flowId\n\t\tJsonRoutes.sendResult res,\n\t\t\tcode: 400,\n\t\t\tdata:\n\t\t\t\t\"error\": \"Validate Request -- Missing flowId\",\n\t\t\t\t\"success\": false\n\t\treturn;\n\n\tquery = {}\n\n\tret_sync_token = new Date().getTime()\n\n\tflowIds = flowId.split(\",\")\n\n\n\tflows = db.flows.find({_id: {$in: flowIds}}).fetch()\n\n\ti = 0\n\twhile i < flows.length\n\t\tf = flows[i]\n\t\tspaceUser = db.space_users.findOne({space: f.space, user: user_id})\n\t\tif !spaceUser\n\t\t\tJsonRoutes.sendResult res,\n\t\t\t\tcode: 401,\n\t\t\t\tdata:\n\t\t\t\t\t\"error\": \"Validate Request -- No permission, flow is #{f._id}\",\n\t\t\t\t\t\"success\": false\n\t\t\treturn;\n\t\telse\n\n\t#\tæ˜¯å¦å·¥ä½œåŒºç®¡ç†å‘˜\n\t\tif !Steedos.isSpaceAdmin(spaceId, user_id)\n\t\t\tspaceUserOrganizations = db.organizations.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: spaceUser.organizations\n\t\t\t\t}\n\t\t\t}).fetch();\n\n\t\t\tif !WorkflowManager.canMonitor(f, spaceUser, spaceUserOrganizations) && !WorkflowManager.canAdmin(f, spaceUser, spaceUserOrganizations)\n\t\t\t\tJsonRoutes.sendResult res,\n\t\t\t\t\tcode: 401,\n\t\t\t\t\tdata:\n\t\t\t\t\t\t\"error\": \"Validate Request -- No permission, flow is #{f._id}\",\n\t\t\t\t\t\t\"success\": false\n\t\t\t\treturn;\n\t\ti++\n\n\n\tquery.flow = {$in: flowIds}\n\n\tquery.space = spaceId\n\n\tif req.query?.sync_token\n\t\tsync_token = new Date(Number(req.query.sync_token))\n\t\tquery.modified = {$gt: sync_token}\n\n\tif req.query?.final_decision\n\t\tquery.final_decision = {$in : req.query.final_decision.split(\",\")}\n\telse\n\t\tquery.final_decision = {$nin: [\"terminated\", \"rejected\"]}\n\n\tif req.query?.state\n\t\tquery.state = {$in: req.query.state.split(\",\")}\n\telse\n\t\tquery.state = \"completed\"\n\n#\tæœ€å¤šè¿”å›ž500æ¡æ•°æ®\n\tinstances = db.instances.find(query, {fields: {inbox_uers: 0, cc_users: 0, outbox_users: 0, traces: 0, attachments: 0}, skip: 0, limit: 500}).fetch()\n\tinstances.forEach (instance)->\n\n\t\tattachments = cfs.instances.find({'metadata.instance': instance._id,'metadata.current': true, \"metadata.is_private\": {$ne: true}}, {fields: {copies: 0}}).fetch()\n\n\t\tinstance.attachments = attachments\n\n\n\tJsonRoutes.sendResult res,\n\t\t\tcode: 200,\n\t\t\tdata:\n\t\t\t\t\"status\": \"success\",\n\t\t\t\t\"sync_token\": ret_sync_token\n\t\t\t\t\"data\": instances\n\treturn;\n","var Cookies, getInstanceReadOnly;\n\nCookies = require(\"cookies\");\n\ngetInstanceReadOnly = function(req, res, next, options) {\n  var _hasPermission, _locale, _parent_instances, dataBuf, error, hide_traces, html, instance, instanceId, ref, ref1, space, spaceId, spaceUserCount, user, userId;\n  user = Steedos.getAPILoginUser(req, res);\n  if (req != null ? (ref = req.query) != null ? ref.access_token : void 0 : void 0) {\n    userId = Steedos.getUserIdFromAccessToken(req.query.access_token);\n    if (userId) {\n      user = Meteor.users.findOne({\n        _id: userId\n      });\n    }\n  }\n  spaceId = req.params.space;\n  instanceId = req.params.instance_id;\n  instance = db.instances.findOne({\n    _id: instanceId\n  });\n  space = db.spaces.findOne({\n    _id: spaceId\n  });\n  hide_traces = (ref1 = req.query) != null ? ref1.hide_traces : void 0;\n  if (!options) {\n    options = {\n      showTrace: true\n    };\n  } else {\n    options.showTrace = true;\n  }\n  if (hide_traces === \"1\") {\n    if (options) {\n      options.showTrace = false;\n    } else {\n      options = {\n        showTrace: false\n      };\n    }\n  }\n  if (!options.showAttachments) {\n    options.showAttachments = true;\n  }\n  if (!space) {\n    JsonRoutes.sendResult(res, {\n      code: 401,\n      data: {\n        \"error\": \"Validate Request -- Missing space\",\n        \"success\": false\n      }\n    });\n    return;\n  }\n  if (!instance) {\n    JsonRoutes.sendResult(res, {\n      code: 401,\n      data: {\n        \"error\": \"Validate Request -- Missing instance\",\n        \"success\": false\n      }\n    });\n    return;\n  }\n  if (!user) {\n    JsonRoutes.sendResult(res, {\n      code: 401,\n      data: {\n        \"error\": \"Validate Request -- Missing X-Auth-Token,X-User-Id\",\n        \"success\": false\n      }\n    });\n    return;\n  }\n  if (instance.space !== spaceId) {\n    JsonRoutes.sendResult(res, {\n      code: 401,\n      data: {\n        \"error\": \"Validate Request -- Missing space or instance\",\n        \"success\": false\n      }\n    });\n    return;\n  }\n  spaceUserCount = db.space_users.find({\n    user: user._id,\n    space: spaceId\n  }).count();\n  if (spaceUserCount === 0) {\n    if (!space) {\n      JsonRoutes.sendResult(res, {\n        code: 401,\n        data: {\n          \"error\": \"Validate Request -- Missing sapceUser\",\n          \"success\": false\n        }\n      });\n      return;\n    }\n  }\n  _hasPermission = WorkflowManager.hasInstancePermissions(user, instance);\n  if (!_hasPermission && instance.distribute_from_instance) {\n    _parent_instances = _.union([instance.distribute_from_instance], instance.distribute_from_instances || []);\n    _hasPermission = _.find(_parent_instances, function(_parent_id) {\n      var _parent_ins;\n      _parent_ins = db.instances.findOne({\n        _id: _parent_id\n      }, {\n        fields: {\n          traces: 0\n        }\n      });\n      return WorkflowManager.hasInstancePermissions(user, _parent_ins);\n    });\n  }\n  if (!_hasPermission) {\n    _locale = Steedos.locale(user._id, true);\n    error = TAPi18n.__(\"instance_permissions_error\", {}, _locale);\n    res.charset = \"utf-8\";\n    JsonRoutes.sendResult(res, {\n      code: 401,\n      data: {\n        \"error\": error,\n        \"success\": false\n      }\n    });\n    return;\n  }\n  html = InstanceReadOnlyTemplate.getInstanceHtml(user, space, instance, options);\n  dataBuf = new Buffer(html);\n  res.setHeader('Content-type', 'text/html; charset=utf-8');\n  res.setHeader('content-length', dataBuf.length);\n  res.setHeader('content-range', \"bytes 0-\" + (dataBuf.length - 1) + \"/\" + dataBuf.length);\n  res.statusCode = 200;\n  return res.end(html);\n};\n\nJsonRoutes.add(\"get\", \"/workflow/space/:space/view/readonly/:instance_id\", getInstanceReadOnly);\n\nJsonRoutes.add(\"get\", \"/workflow/space/:space/view/readonly/:instance_id/:instance_name\", function(req, res, next) {\n  var options;\n  res.setHeader('Content-type', 'application/x-msdownload');\n  res.setHeader('Content-Disposition', 'attachment;filename=' + encodeURI(req.params.instance_name));\n  res.setHeader('Transfer-Encoding', '');\n  options = {\n    absolute: true\n  };\n  return getInstanceReadOnly(req, res, next, options);\n});\n\n\n/*\n\tèŽ·å–ç”³è¯·å•åˆ—è¡¨ï¼š\n    final_decisionï¼šå®¡æ‰¹ç»“æžœ\n    state: ç”³è¯·å•çŠ¶æ€\n */\n\nJsonRoutes.add(\"get\", \"/api/workflow/instances\", function(req, res, next) {\n  var f, flowId, flowIds, flows, i, instances, query, ref, ref1, ref2, ref3, ret_sync_token, spaceId, spaceUser, spaceUserOrganizations, sync_token, user_id;\n  if (!Steedos.APIAuthenticationCheck(req, res)) {\n    return;\n  }\n  user_id = req.userId;\n  spaceId = req.headers[\"x-space-id\"];\n  if (!spaceId) {\n    JsonRoutes.sendResult(res, {\n      code: 401,\n      data: {\n        \"error\": \"Validate Request -- Missing X-Space-Id\",\n        \"success\": false\n      }\n    });\n    return;\n  }\n  flowId = (ref = req.query) != null ? ref.flowId : void 0;\n  if (!flowId) {\n    JsonRoutes.sendResult(res, {\n      code: 400,\n      data: {\n        \"error\": \"Validate Request -- Missing flowId\",\n        \"success\": false\n      }\n    });\n    return;\n  }\n  query = {};\n  ret_sync_token = new Date().getTime();\n  flowIds = flowId.split(\",\");\n  flows = db.flows.find({\n    _id: {\n      $in: flowIds\n    }\n  }).fetch();\n  i = 0;\n  while (i < flows.length) {\n    f = flows[i];\n    spaceUser = db.space_users.findOne({\n      space: f.space,\n      user: user_id\n    });\n    if (!spaceUser) {\n      JsonRoutes.sendResult(res, {\n        code: 401,\n        data: {\n          \"error\": \"Validate Request -- No permission, flow is \" + f._id,\n          \"success\": false\n        }\n      });\n      return;\n    } else {\n\n    }\n    if (!Steedos.isSpaceAdmin(spaceId, user_id)) {\n      spaceUserOrganizations = db.organizations.find({\n        _id: {\n          $in: spaceUser.organizations\n        }\n      }).fetch();\n      if (!WorkflowManager.canMonitor(f, spaceUser, spaceUserOrganizations) && !WorkflowManager.canAdmin(f, spaceUser, spaceUserOrganizations)) {\n        JsonRoutes.sendResult(res, {\n          code: 401,\n          data: {\n            \"error\": \"Validate Request -- No permission, flow is \" + f._id,\n            \"success\": false\n          }\n        });\n        return;\n      }\n    }\n    i++;\n  }\n  query.flow = {\n    $in: flowIds\n  };\n  query.space = spaceId;\n  if ((ref1 = req.query) != null ? ref1.sync_token : void 0) {\n    sync_token = new Date(Number(req.query.sync_token));\n    query.modified = {\n      $gt: sync_token\n    };\n  }\n  if ((ref2 = req.query) != null ? ref2.final_decision : void 0) {\n    query.final_decision = {\n      $in: req.query.final_decision.split(\",\")\n    };\n  } else {\n    query.final_decision = {\n      $nin: [\"terminated\", \"rejected\"]\n    };\n  }\n  if ((ref3 = req.query) != null ? ref3.state : void 0) {\n    query.state = {\n      $in: req.query.state.split(\",\")\n    };\n  } else {\n    query.state = \"completed\";\n  }\n  instances = db.instances.find(query, {\n    fields: {\n      inbox_uers: 0,\n      cc_users: 0,\n      outbox_users: 0,\n      traces: 0,\n      attachments: 0\n    },\n    skip: 0,\n    limit: 500\n  }).fetch();\n  instances.forEach(function(instance) {\n    var attachments;\n    attachments = cfs.instances.find({\n      'metadata.instance': instance._id,\n      'metadata.current': true,\n      \"metadata.is_private\": {\n        $ne: true\n      }\n    }, {\n      fields: {\n        copies: 0\n      }\n    }).fetch();\n    return instance.attachments = attachments;\n  });\n  JsonRoutes.sendResult(res, {\n    code: 200,\n    data: {\n      \"status\": \"success\",\n      \"sync_token\": ret_sync_token,\n      \"data\": instances\n    }\n  });\n});\n","\nJsonRoutes.add \"get\", \"/steedos-css\", (req, res, next)->\n\tres.setHeader('Content-type', 'text/css');\n\tallCss = WebApp.getRefreshableAssets()\n\n\tallCssLink = \"\"\n\n\tallCss.forEach (css) ->\n\t\tif __meteor_runtime_config__.ROOT_URL_PATH_PREFIX\n\t\t\trootUrl = __meteor_runtime_config__.ROOT_URL\n\t\t\tif rootUrl.endsWith(\"/\")\n\t\t\t\tcssHref = rootUrl.replace(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX + \"/\", \"\") + css.url\n\t\t\telse\n\t\t\t\tcssHref = rootUrl.replace(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX, \"\") + css.url\n\t\telse\n\t\t\tcssHref = Meteor.absoluteUrl(css.url)\n\t\tallCssLink += \"@import url(#{cssHref});\"\n\n\tres.statusCode = 200\n\tres.end(allCssLink)","JsonRoutes.add(\"get\", \"/steedos-css\", function(req, res, next) {\n  var allCss, allCssLink;\n  res.setHeader('Content-type', 'text/css');\n  allCss = WebApp.getRefreshableAssets();\n  allCssLink = \"\";\n  allCss.forEach(function(css) {\n    var cssHref, rootUrl;\n    if (__meteor_runtime_config__.ROOT_URL_PATH_PREFIX) {\n      rootUrl = __meteor_runtime_config__.ROOT_URL;\n      if (rootUrl.endsWith(\"/\")) {\n        cssHref = rootUrl.replace(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX + \"/\", \"\") + css.url;\n      } else {\n        cssHref = rootUrl.replace(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX, \"\") + css.url;\n      }\n    } else {\n      cssHref = Meteor.absoluteUrl(css.url);\n    }\n    return allCssLink += \"@import url(\" + cssHref + \");\";\n  });\n  res.statusCode = 200;\n  return res.end(allCssLink);\n});\n","JsonRoutes.add \"get\", \"/api/workflow/space/:space/view/draft/:flow\", (req, res, next) ->\n\tif !Steedos.APIAuthenticationCheck(req, res)\n\t\treturn\n\n\tuser_id = req.userId\n\n\tuser = db.users.findOne({ _id: user_id })\n\n\tspaceId = req.params.space\n\n\tflowId = req.params.flow\n\n\tspace = db.spaces.findOne({ _id: spaceId })\n\n\tflow = db.flows.findOne({ _id: flowId }, { fields: { name: 1, 'current._id': 1, form: 1 } })\n\n\tform = db.forms.findOne({ _id: flow.form }, { fields: { 'current._id': 1 } })\n\n\toptions = {\n\t\tshowTrace: false,\n\t\tshowAttachments: false,\n\t\ttemplateName: \"default\",\n\t\teditable: true,\n\t\twidth: \"100%\",\n\t\tinstance_style: \"instance-default\",\n\t\tplugins: \"\"\"\n\n\t\t\t<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\" />\n\t\t\t<meta name=\"format-detection\" content=\"telephone=no\">\n\t\t\t<meta http-equiv=\"x-rim-auto-match\" content=\"none\">\n\t\t\t<title>#{flow.name}</title>\n\t\t\t<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />\n\t\t\t<meta name=\"viewport\" content=\"width=device-width\" />\n\n\t\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css\">\n\n\t\t\t<script src=\"/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js\" type=\"text/javascript\"></script>\n\n\t\t\t<script src=\"/plugins/bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js\" type=\"text/javascript\" charset=\"UTF-8\"></script>\n\n\t\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/plugins/toastr/toastr.min.css\">\n\t\t\t<script src=\"/plugins/toastr/toastr.min.js\" type=\"text/javascript\"></script>\n\t\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/js/workflow_client.css\">\n\t\t\t<script src=\"/js/workflow_client.js\" type=\"text/javascript\"></script>\n\t\t\"\"\"\n\t}\n\n\tinstance = {\n\t\tflow: flow._id,\n\t\tflow_version: flow.current._id,\n\t\tform: form._id,\n\t\tform_version: form.current._id,\n\t\tvalues: {},\n\t\tname: flow.name,\n\t\tspace: spaceId\n\t}\n\n\thtml = InstanceReadOnlyTemplate.getInstanceHtml(user, space, instance, options)\n\n\tdataBuf = new Buffer(html)\n\n\tres.setHeader('content-length', dataBuf.length)\n\n\tres.setHeader('content-range', \"bytes 0-#{dataBuf.length - 1}/#{dataBuf.length}\")\n\n\tres.statusCode = 200\n\n\tres.end(html)\n","JsonRoutes.add(\"get\", \"/api/workflow/space/:space/view/draft/:flow\", function(req, res, next) {\n  var dataBuf, flow, flowId, form, html, instance, options, space, spaceId, user, user_id;\n  if (!Steedos.APIAuthenticationCheck(req, res)) {\n    return;\n  }\n  user_id = req.userId;\n  user = db.users.findOne({\n    _id: user_id\n  });\n  spaceId = req.params.space;\n  flowId = req.params.flow;\n  space = db.spaces.findOne({\n    _id: spaceId\n  });\n  flow = db.flows.findOne({\n    _id: flowId\n  }, {\n    fields: {\n      name: 1,\n      'current._id': 1,\n      form: 1\n    }\n  });\n  form = db.forms.findOne({\n    _id: flow.form\n  }, {\n    fields: {\n      'current._id': 1\n    }\n  });\n  options = {\n    showTrace: false,\n    showAttachments: false,\n    templateName: \"default\",\n    editable: true,\n    width: \"100%\",\n    instance_style: \"instance-default\",\n    plugins: \"\\n<meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=edge,chrome=1\\\" />\\n<meta name=\\\"format-detection\\\" content=\\\"telephone=no\\\">\\n<meta http-equiv=\\\"x-rim-auto-match\\\" content=\\\"none\\\">\\n<title>\" + flow.name + \"</title>\\n<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />\\n<meta name=\\\"viewport\\\" content=\\\"width=device-width\\\" />\\n\\n<link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css\\\">\\n\\n<script src=\\\"/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js\\\" type=\\\"text/javascript\\\"></script>\\n\\n<script src=\\\"/plugins/bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js\\\" type=\\\"text/javascript\\\" charset=\\\"UTF-8\\\"></script>\\n\\n<link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"/plugins/toastr/toastr.min.css\\\">\\n<script src=\\\"/plugins/toastr/toastr.min.js\\\" type=\\\"text/javascript\\\"></script>\\n<link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"/js/workflow_client.css\\\">\\n<script src=\\\"/js/workflow_client.js\\\" type=\\\"text/javascript\\\"></script>\"\n  };\n  instance = {\n    flow: flow._id,\n    flow_version: flow.current._id,\n    form: form._id,\n    form_version: form.current._id,\n    values: {},\n    name: flow.name,\n    space: spaceId\n  };\n  html = InstanceReadOnlyTemplate.getInstanceHtml(user, space, instance, options);\n  dataBuf = new Buffer(html);\n  res.setHeader('content-length', dataBuf.length);\n  res.setHeader('content-range', \"bytes 0-\" + (dataBuf.length - 1) + \"/\" + dataBuf.length);\n  res.statusCode = 200;\n  return res.end(html);\n});\n","Array.prototype.filterProperty = function(h, l){\n    var g = [];\n    this.forEach(function(t){\n        var m = t? t[h]:null;\n        var d = false;\n        if(m instanceof Array){\n            d = m.includes(l);\n        }else{\n            d = (l === undefined)? false:m==l;\n        }\n        if(d){\n            g.push(t);\n        }\n    });\n    return g;\n};\n\nArray.prototype.getProperty = function(k){\n    var v = new Array();\n    this.forEach(function(t){\n        var m = t? t[k]:null;\n        v.push(m);\n    });\n    return v;\n}\n\nArray.prototype.getEach = function(code){\n    var rev = [];\n    for(var i = 0 ; i < this.length ; i++){\n        rev.push(this[i][code]);\n    }\n    return rev;\n};\n\nArray.prototype.uniq = function(){\n    var a = [];\n    this.forEach(function(b){ \n        if(a.indexOf(b) < 0)\n            {a[a.length] = b}\n    });\n    return a;\n};\n\nForm_formula = {};\n\n\nForm_formula.mixin = function(dest, src){\n    for(var key in src){\n        dest[key] = src[key];\n    }\n    return dest;\n};\n\n\nForm_formula.handerUserObject = function(u){\n\n    if(u instanceof Array){\n        var user = {};\n\n        user.name = u.getProperty(\"name\")\n        user.organization = {};\n        user.organization.name = u.getProperty(\"organization\").getProperty(\"name\");\n        user.organization.fullname = u.getProperty(\"organization\").getProperty(\"fullname\");\n\n        user.hr = u.getProperty(\"hr\")\n\n        user.sort_no = u.getProperty(\"sort_no\")\n\n\t\tuser.mobile = u.getProperty(\"mobile\")\n\n\t\tuser.work_phone = u.getProperty(\"work_phone\")\n\n\t\tuser.position = u.getProperty(\"position\")\n\n        var userRoles = u.getProperty(\"roles\");\n        var roles = new Array();\n        userRoles.forEach(function(i){\n            roles = roles.concat(i);\n        }); \n        roles.uniq();\n        user.roles = roles;\n        return user;\n    }else{\n        return u;\n    }\n}\n\nForm_formula.handerOrgObject = function(o){\n\n    if(o instanceof Array){\n        var org = {};\n\t\torg.id = o.getProperty(\"_id\");\n        org.name = o.getProperty(\"name\");\n        org.fullname = o.getProperty(\"fullname\");\n\n        return org;\n    }else{\n        return o;\n    }\n}\n\n\n\n/**\n    * èŽ·å¾—å…¬å¼éœ€è¦ç”¨åˆ°çš„åˆå§‹å€¼\n    * è¾“å…¥ï¼šfields, values, applicant\n    * è¾“å‡ºï¼š__values\n**/\nForm_formula.init_formula_values = function(fields, autoFormDoc, approver, applicant, spaceId){\n    var __values = {};\n    //ç”³è¯·å•ä¸­å¡«çš„å€¼å¤„ç†\n    if(fields && fields.length && autoFormDoc) {\n        //debugger;\n        fields.forEach(function(field){\n            var type = field.type;\n            if(type) {\n                if(type === 'table') {\n                    /*\n                    * å°†è¡¨æ ¼å­—æ®µçš„å€¼è¿›è¡Œè½¬æ¢åŽä¼ å…¥__valuesä¸­\n                    * valuesä¸­è¡¨æ ¼çš„å€¼æ ¼å¼ä¸º\n                    * [{\"a\":1,\"b\":4},{\"a\":2,\"b\":5},{\"a\":3,\"b\":6}]\n                    * __valueséœ€è¦è½¬åŒ–ä¸ºä¸‹é¢æ ¼å¼ä¸”å’Œä¸»è¡¨çš„å€¼ä¸€æ ·æ”¾åˆ°ç¬¬ä¸€å±‚\n                    * {\"a\":[1,2,3],\"b\":[4,5,6]}\n                    **/\n                    var tableFields = field.sfields,\n                        tableValues = autoFormDoc[field.code],\n                        formulaTableValues = [],\n                        __tableValues = {};\n                    //æŒ‰å…¬å¼çš„æ ¼å¼è½¬æ¢å€¼ä¸º__tableValues\n                    if(tableFields && tableFields.length && tableValues && tableValues instanceof Array) {\n                        tableValues.forEach(function(tableValue){\n                            formulaTableValues.push(Form_formula.init_formula_values(tableFields, tableValue));\n                        }, this);\n                        //æŒ‰ä¸»è¡¨çš„æ ¼å¼è½¬æ¢__tableValuesåŠ åˆ°\n                        tableFields.forEach(function(tablefield){\n                            __tableValues[tablefield.code] = formulaTableValues.getEach(tablefield.code);\n                        });\n                        __values = Form_formula.mixin(__values, __tableValues);\n                    }\n                } else if (type == 'user'){\n                    __values[field.code] = Form_formula.handerUserObject(WorkflowManager.getFormulaUserObjects(spaceId, autoFormDoc[field.code]));\n\n                } else if (type == 'group'){\n                    __values[field.code] = Form_formula.handerOrgObject(WorkflowManager.getFormulaOrgObjects(autoFormDoc[field.code]));\n\n                } else if (type == 'odata'){\n\t\t\t\t\t__values[field.code] = autoFormDoc[field.code] || {}\n\n\t\t\t\t} else {\n                    //æ­¤å¤„ä¼ spaceIdç»™é€‰äººæŽ§ä»¶çš„æ—§æ•°æ®è®¡ç®—roleså’Œorganization\n                    __values[field.code] = autoFormDoc[field.code];\n                }\n            }\n        }, this);\n    }\n    //å½“å‰å¤„ç†äºº\n    __values[\"approver\"] = WorkflowManager.getFormulaUserObject(spaceId, approver);\n    //ç”³è¯·äºº\n    __values[\"applicant\"] = WorkflowManager.getFormulaUserObject(spaceId, applicant);\n\n    return __values;\n};\n\n","Meteor.publish 'categories', (spaceId) ->\n\tcheck spaceId, String\n\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless spaceId\n\t\treturn this.ready()\n\n\n\treturn db.categories.find({ space: spaceId }, { fields: { name: 1, space: 1, sort_no: 1, app: 1 } })","Meteor.publish('categories', function(spaceId) {\n  check(spaceId, String);\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!spaceId) {\n    return this.ready();\n  }\n  return db.categories.find({\n    space: spaceId\n  }, {\n    fields: {\n      name: 1,\n      space: 1,\n      sort_no: 1,\n      app: 1\n    }\n  });\n});\n","\nMeteor.publish 'cfs_instances', (instanceIds)->\n\tcheck(instanceIds, Array)\n\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless instanceIds\n\t\t\treturn this.ready()\n\n\treturn cfs.instances.find({'metadata.instance': {$in: instanceIds} , $or: [{'metadata.is_private': {$ne: true}},{'metadata.is_private': true, \"metadata.owner\": this.userId}]})\n","Meteor.publish('cfs_instances', function(instanceIds) {\n  check(instanceIds, Array);\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!instanceIds) {\n    return this.ready();\n  }\n  return cfs.instances.find({\n    'metadata.instance': {\n      $in: instanceIds\n    },\n    $or: [\n      {\n        'metadata.is_private': {\n          $ne: true\n        }\n      }, {\n        'metadata.is_private': true,\n        \"metadata.owner\": this.userId\n      }\n    ]\n  });\n});\n","\n\nMeteor.publish 'flow_positions', (spaceId)->\n\t\n\tunless this.userId\n\t\treturn this.ready()\n\t\n\tunless spaceId\n\t\treturn this.ready()\n\n\treturn db.flow_positions.find({space: spaceId}, {fields: {role:1, users: 1, org: 1}});\n","Meteor.publish('flow_positions', function(spaceId) {\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!spaceId) {\n    return this.ready();\n  }\n  return db.flow_positions.find({\n    space: spaceId\n  }, {\n    fields: {\n      role: 1,\n      users: 1,\n      org: 1\n    }\n  });\n});\n","Meteor.publishComposite 'flow_positions_tabular', (tableName, ids, fields)->\n\tcheck(tableName, String);\n\tcheck(ids, Array);\n\tcheck(fields, Match.Optional(Object));\n\n\tunless this.userId\n\t\treturn this.ready()\n\n\tthis.unblock()\n\n\tfind: ->\n\t\tthis.unblock()\n\t\tdb.flow_positions.find {_id: {$in: ids}}, fields: fields\n\n\tchildren: [\n\t\t{\n\t\t\tfind: (position) ->\n\t\t\t\t@unblock()\n\t\t\t\t# Publish the related flow_roles\n\t\t\t\tdb.flow_roles.find { _id: position.role }, fields: name: 1\n\t\t}\n\t\t{\n\t\t\tfind: (position) ->\n\t\t\t\t@unblock()\n\t\t\t\t# Publish the related organizations\n\t\t\t\tdb.organizations.find { _id: position.org }, fields: fullname: 1\n\t\t}\n\t\t{\n\t\t\tfind: (position) ->\n\t\t\t\t@unblock()\n\t\t\t\t# Publish the related user\n\t\t\t\tdb.space_users.find {\n\t\t\t\t\tspace: position.space\n\t\t\t\t\tuser: $in: position.users\n\t\t\t\t}, fields:\n\t\t\t\t\tspace: 1\n\t\t\t\t\tuser: 1\n\t\t\t\t\tname: 1\n\t\t}\n\t]","Meteor.publishComposite('flow_positions_tabular', function(tableName, ids, fields) {\n  check(tableName, String);\n  check(ids, Array);\n  check(fields, Match.Optional(Object));\n  if (!this.userId) {\n    return this.ready();\n  }\n  this.unblock();\n  return {\n    find: function() {\n      this.unblock();\n      return db.flow_positions.find({\n        _id: {\n          $in: ids\n        }\n      }, {\n        fields: fields\n      });\n    },\n    children: [\n      {\n        find: function(position) {\n          this.unblock();\n          return db.flow_roles.find({\n            _id: position.role\n          }, {\n            fields: {\n              name: 1\n            }\n          });\n        }\n      }, {\n        find: function(position) {\n          this.unblock();\n          return db.organizations.find({\n            _id: position.org\n          }, {\n            fields: {\n              fullname: 1\n            }\n          });\n        }\n      }, {\n        find: function(position) {\n          this.unblock();\n          return db.space_users.find({\n            space: position.space,\n            user: {\n              $in: position.users\n            }\n          }, {\n            fields: {\n              space: 1,\n              user: 1,\n              name: 1\n            }\n          });\n        }\n      }\n    ]\n  };\n});\n","\n\n\tMeteor.publish 'flow_roles', (spaceId)->\n\t\t\n\t\tunless this.userId\n\t\t\treturn this.ready()\n\t\t\n\t\tunless spaceId\n\t\t\treturn this.ready()\n\n\n\t\treturn db.flow_roles.find({space: spaceId}, {fields: {name:1}});\n","Meteor.publish('flow_roles', function(spaceId) {\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!spaceId) {\n    return this.ready();\n  }\n  return db.flow_roles.find({\n    space: spaceId\n  }, {\n    fields: {\n      name: 1\n    }\n  });\n});\n","Meteor.publish 'flows', (spaceId)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless spaceId\n\t\treturn this.ready()\n\n\t# ç¬¬ä¸€æ¬¡è®¢é˜…æ—¶åˆå§‹åŒ–å·¥ä½œåŒº\n\tif db.flows.find({space: spaceId}).count() == 0\n\t\tdb.spaces.createTemplateFormAndFlow(spaceId)\n\n\treturn db.flows.find({space: spaceId}, {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tform: 1,\n\t\t\tstate: 1,\n\t\t\tperms: 1,\n\t\t\tspace: 1,\n\t\t\tcompany_id: 1,\n\t\t\tsort_no: 1,\n\t\t\tdistribute_optional_users: 1,\n\t\t\tdistribute_to_self: 1,\n\t\t\tenable_amisform: 1\n\t\t}\n\t})\n\nMeteor.publish 'instance_flow', (spaceId, flowId)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless spaceId\n\t\treturn this.ready()\n\n\tunless flowId\n\t\treturn this.ready()\n\n\treturn db.flows.find({_id: flowId, space: spaceId}, {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tform: 1,\n\t\t\tstate: 1,\n\t\t\tperms: 1,\n\t\t\tspace: 1,\n\t\t\tcompany_id: 1,\n\t\t\tsort_no: 1,\n\t\t\tdistribute_optional_users: 1,\n\t\t\tdistribute_to_self: 1,\n\t\t\tenable_amisform: 1\n\t\t}\n\t})\n\n\nMeteor.publish 'flow_version', (spaceId, flowId, versionId) ->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless spaceId\n\t\treturn this.ready()\n\n\tunless flowId\n\t\treturn this.ready()\n\n\tunless versionId\n\t\treturn this.ready()\n\n\n\tself = this;\n\n\tgetFlowVersion = (id , versionId)->\n\t\tflow = db.flows.findOne({_id : id});\n\t\tif flow\n\t\t\tflow_version = flow.current\n\t\t\tflow_version.latest = true\n\n\t\t\tif flow_version._id != versionId\n\t\t\t\tflow_version = flow.historys.findPropertyByPK(\"_id\", versionId)\n\t\t\t\tflow_version.latest = false\n\n\t\t\treturn flow_version\n\thandle = db.flows.find({_id: flowId}, {fields: {_id: 1, \"current.modified\": 1}}).observeChanges {\n\t\tchanged: (id)->\n\t\t\tself.changed(\"flow_versions\", versionId, getFlowVersion(id, versionId));\n\t}\n\n\n\tself.added(\"flow_versions\", versionId, getFlowVersion(flowId, versionId));\n\tself.ready();\n\tself.onStop ()->\n\t\thandle.stop()\n\nMeteor.publish 'distribute_optional_flows', (flow_ids)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless flow_ids\n\t\treturn this.ready()\n\n\treturn db.flows.find({_id: {$in: flow_ids}}, {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tform: 1,\n\t\t\tstate: 1,\n\t\t\tperms: 1,\n\t\t\tspace: 1,\n\t\t\tdistribute_optional_users: 1,\n\t\t\tdistribute_to_self: 1,\n\t\t\tdistribute_end_notification: 1,\n\t\t\tcompany_id: 1,\n\t\t\tenable_amisform: 1\n\t\t}\n\t})\n\nMeteor.publish 'flow', (spaceId, flowId)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless spaceId\n\t\treturn this.ready()\n\n\tunless flowId\n\t\treturn this.ready()\n\n\n\treturn db.flows.find({_id: flowId, space: spaceId}, {\n\t\tfields: {\n\t\t\tprint_template: 1,\n\t\t\tinstance_template: 1,\n\t\t\tevents: 1,\n\t\t\tdistribute_optional_users: 1,\n\t\t\tdistribute_to_self: 1,\n\t\t\tupload_after_being_distributed: 1,\n\t\t\tdistribute_end_notification: 1,\n\t\t\tcompany_id: 1,\n\t\t\tallow_select_step: 1,\n\t\t\tenable_amisform: 1\n\t\t}\n\t})\nMeteor.publish 'flow_files', (spaceId, flowId)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless spaceId\n\t\treturn this.ready()\n\n\tunless flowId\n\t\treturn this.ready()\n\n\treturn cfs.files.find({ 'metadata.space': spaceId, 'metadata.object_name': 'flows', 'metadata.record_id': flowId })\n\nMeteor.publishComposite 'flows_tabular', (tableName, ids, fields)->\n\tcheck(tableName, String);\n\tcheck(ids, Array);\n\tcheck(fields, Match.Optional(Object));\n\n\tunless this.userId\n\t\treturn this.ready()\n\n\tthis.unblock()\n\n\tfind: ->\n\t\tthis.unblock()\n\t\tdb.flows.find {_id: {$in: ids}}, fields: fields\n\n\tchildren: [\n\t\t{\n\t\t\tfind: (flow) ->\n\t\t\t\t@unblock()\n\t\t\t\t# Publish the related user\n\t\t\t\tdb.space_users.find {\n\t\t\t\t\tspace: flow.space,\n\t\t\t\t\tuser: flow.current.modified_by\n\t\t\t\t}, fields:\n\t\t\t\t\tspace: 1\n\t\t\t\t\tuser: 1\n\t\t\t\t\tname: 1\n\t\t},\n\t\t{\n\t\t\tfind: (flow) ->\n\t\t\t\t@unblock()\n\t\t\t\t# Publish the related user\n\t\t\t\tdb.forms.find {\n\t\t\t\t\tspace: flow.space,\n\t\t\t\t\t_id: flow.form\n\t\t\t\t}, fields:\n\t\t\t\t\tspace: 1\n\t\t\t\t\t_id: 1\n\t\t\t\t\tname: 1,\n\t\t\t\t\tcategory: 1\n\t\t},\n\t\t{\n\t\t\tfind: (flow) ->\n\t\t\t\t@unblock()\n\t\t\t\t# Publish the related user\n\t\t\t\tdb.categories.find {\n\t\t\t\t\tspace: flow.space\n\t\t\t\t}, fields:\n\t\t\t\t\tspace: 1\n\t\t\t\t\t_id: 1\n\t\t\t\t\tname: 1\n\t\t}\n\t]","Meteor.publish('flows', function(spaceId) {\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!spaceId) {\n    return this.ready();\n  }\n  if (db.flows.find({\n    space: spaceId\n  }).count() === 0) {\n    db.spaces.createTemplateFormAndFlow(spaceId);\n  }\n  return db.flows.find({\n    space: spaceId\n  }, {\n    fields: {\n      name: 1,\n      form: 1,\n      state: 1,\n      perms: 1,\n      space: 1,\n      company_id: 1,\n      sort_no: 1,\n      distribute_optional_users: 1,\n      distribute_to_self: 1,\n      enable_amisform: 1\n    }\n  });\n});\n\nMeteor.publish('instance_flow', function(spaceId, flowId) {\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!spaceId) {\n    return this.ready();\n  }\n  if (!flowId) {\n    return this.ready();\n  }\n  return db.flows.find({\n    _id: flowId,\n    space: spaceId\n  }, {\n    fields: {\n      name: 1,\n      form: 1,\n      state: 1,\n      perms: 1,\n      space: 1,\n      company_id: 1,\n      sort_no: 1,\n      distribute_optional_users: 1,\n      distribute_to_self: 1,\n      enable_amisform: 1\n    }\n  });\n});\n\nMeteor.publish('flow_version', function(spaceId, flowId, versionId) {\n  var getFlowVersion, handle, self;\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!spaceId) {\n    return this.ready();\n  }\n  if (!flowId) {\n    return this.ready();\n  }\n  if (!versionId) {\n    return this.ready();\n  }\n  self = this;\n  getFlowVersion = function(id, versionId) {\n    var flow, flow_version;\n    flow = db.flows.findOne({\n      _id: id\n    });\n    if (flow) {\n      flow_version = flow.current;\n      flow_version.latest = true;\n      if (flow_version._id !== versionId) {\n        flow_version = flow.historys.findPropertyByPK(\"_id\", versionId);\n        flow_version.latest = false;\n      }\n      return flow_version;\n    }\n  };\n  handle = db.flows.find({\n    _id: flowId\n  }, {\n    fields: {\n      _id: 1,\n      \"current.modified\": 1\n    }\n  }).observeChanges({\n    changed: function(id) {\n      return self.changed(\"flow_versions\", versionId, getFlowVersion(id, versionId));\n    }\n  });\n  self.added(\"flow_versions\", versionId, getFlowVersion(flowId, versionId));\n  self.ready();\n  return self.onStop(function() {\n    return handle.stop();\n  });\n});\n\nMeteor.publish('distribute_optional_flows', function(flow_ids) {\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!flow_ids) {\n    return this.ready();\n  }\n  return db.flows.find({\n    _id: {\n      $in: flow_ids\n    }\n  }, {\n    fields: {\n      name: 1,\n      form: 1,\n      state: 1,\n      perms: 1,\n      space: 1,\n      distribute_optional_users: 1,\n      distribute_to_self: 1,\n      distribute_end_notification: 1,\n      company_id: 1,\n      enable_amisform: 1\n    }\n  });\n});\n\nMeteor.publish('flow', function(spaceId, flowId) {\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!spaceId) {\n    return this.ready();\n  }\n  if (!flowId) {\n    return this.ready();\n  }\n  return db.flows.find({\n    _id: flowId,\n    space: spaceId\n  }, {\n    fields: {\n      print_template: 1,\n      instance_template: 1,\n      events: 1,\n      distribute_optional_users: 1,\n      distribute_to_self: 1,\n      upload_after_being_distributed: 1,\n      distribute_end_notification: 1,\n      company_id: 1,\n      allow_select_step: 1,\n      enable_amisform: 1\n    }\n  });\n});\n\nMeteor.publish('flow_files', function(spaceId, flowId) {\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!spaceId) {\n    return this.ready();\n  }\n  if (!flowId) {\n    return this.ready();\n  }\n  return cfs.files.find({\n    'metadata.space': spaceId,\n    'metadata.object_name': 'flows',\n    'metadata.record_id': flowId\n  });\n});\n\nMeteor.publishComposite('flows_tabular', function(tableName, ids, fields) {\n  check(tableName, String);\n  check(ids, Array);\n  check(fields, Match.Optional(Object));\n  if (!this.userId) {\n    return this.ready();\n  }\n  this.unblock();\n  return {\n    find: function() {\n      this.unblock();\n      return db.flows.find({\n        _id: {\n          $in: ids\n        }\n      }, {\n        fields: fields\n      });\n    },\n    children: [\n      {\n        find: function(flow) {\n          this.unblock();\n          return db.space_users.find({\n            space: flow.space,\n            user: flow.current.modified_by\n          }, {\n            fields: {\n              space: 1,\n              user: 1,\n              name: 1\n            }\n          });\n        }\n      }, {\n        find: function(flow) {\n          this.unblock();\n          return db.forms.find({\n            space: flow.space,\n            _id: flow.form\n          }, {\n            fields: {\n              space: 1,\n              _id: 1,\n              name: 1,\n              category: 1\n            }\n          });\n        }\n      }, {\n        find: function(flow) {\n          this.unblock();\n          return db.categories.find({\n            space: flow.space\n          }, {\n            fields: {\n              space: 1,\n              _id: 1,\n              name: 1\n            }\n          });\n        }\n      }\n    ]\n  };\n});\n","Meteor.publish 'forms', (spaceId)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless spaceId\n\t\treturn this.ready()\n\n\n\treturn db.forms.find({space: spaceId}, {fields: {name: 1, category: 1, state: 1, description: 1, instance_style: 1, amis_schema: 1}})\n\nMeteor.publish 'instance_form', (spaceId, formId)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless spaceId\n\t\treturn this.ready()\n\n\n\treturn db.forms.find({_id: formId, space: spaceId}, {fields: {name: 1, category: 1, state: 1, description: 1, instance_style: 1, amis_schema: 1}})\n\n\nMeteor.publish 'form_version', (spaceId, formId, versionId) ->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless spaceId\n\t\treturn this.ready()\n\n\tunless formId\n\t\treturn this.ready()\n\n\tunless versionId\n\t\treturn this.ready()\n\n\n\tself = this;\n\n\tgetFormVersion = (id , versionId)->\n\t\tform = db.forms.findOne({_id : id});\n\t\tif !form\n\t\t\treturn {}\n\t\tform_version = form.current\n\t\tform_version.latest = true\n\t\tif form_version._id != versionId\n\t\t\tform_version = form.historys.findPropertyByPK(\"_id\", versionId)\n\t\t\tform_version.latest = false\n\t\treturn form_version\n\n\thandle = db.forms.find({_id: formId}, {fields: {_id: 1, \"current.modified\": 1}}).observeChanges {\n\t\tchanged: (id)->\n\t\t\tself.changed(\"form_versions\", versionId, getFormVersion(id, versionId));\n\t}\n\n\tself.added(\"form_versions\", versionId, getFormVersion(formId, versionId));\n\tself.ready();\n\tself.onStop ()->\n\t\thandle.stop()","Meteor.publish('forms', function(spaceId) {\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!spaceId) {\n    return this.ready();\n  }\n  return db.forms.find({\n    space: spaceId\n  }, {\n    fields: {\n      name: 1,\n      category: 1,\n      state: 1,\n      description: 1,\n      instance_style: 1,\n      amis_schema: 1\n    }\n  });\n});\n\nMeteor.publish('instance_form', function(spaceId, formId) {\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!spaceId) {\n    return this.ready();\n  }\n  return db.forms.find({\n    _id: formId,\n    space: spaceId\n  }, {\n    fields: {\n      name: 1,\n      category: 1,\n      state: 1,\n      description: 1,\n      instance_style: 1,\n      amis_schema: 1\n    }\n  });\n});\n\nMeteor.publish('form_version', function(spaceId, formId, versionId) {\n  var getFormVersion, handle, self;\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!spaceId) {\n    return this.ready();\n  }\n  if (!formId) {\n    return this.ready();\n  }\n  if (!versionId) {\n    return this.ready();\n  }\n  self = this;\n  getFormVersion = function(id, versionId) {\n    var form, form_version;\n    form = db.forms.findOne({\n      _id: id\n    });\n    if (!form) {\n      return {};\n    }\n    form_version = form.current;\n    form_version.latest = true;\n    if (form_version._id !== versionId) {\n      form_version = form.historys.findPropertyByPK(\"_id\", versionId);\n      form_version.latest = false;\n    }\n    return form_version;\n  };\n  handle = db.forms.find({\n    _id: formId\n  }, {\n    fields: {\n      _id: 1,\n      \"current.modified\": 1\n    }\n  }).observeChanges({\n    changed: function(id) {\n      return self.changed(\"form_versions\", versionId, getFormVersion(id, versionId));\n    }\n  });\n  self.added(\"form_versions\", versionId, getFormVersion(formId, versionId));\n  self.ready();\n  return self.onStop(function() {\n    return handle.stop();\n  });\n});\n","Meteor.publish 'instance_data', (instanceId, box)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless (instanceId && db.instances.find({_id: instanceId}).count())\n\t\treturn this.ready()\n\n\tself = this;\n\n\tminiApproveFields = ['_id', 'is_finished', 'user', 'handler', 'handler_name', 'type', 'start_date', 'description',\n\t\t'is_read', 'judge', 'finish_date', 'from_user_name', 'from_user', 'cc_description', 'auto_submitted']\n\n\ttriggerChangeFields = ['form_version', 'flow_version', 'related_instances', '_my_approve_read_dates', 'values', 'change_time']\n\n\ttriggerChangeFieldsValues = {}\n\n\tinstance_fields_0 = {\n\t\t\"record_synced\": 0,\n\n#\t\t\"traces.approves.handler_organization_fullname\": 0,\n\t\t\"traces.approves.handler_organization_name\": 0,\n\t\t\"traces.approves.handler_organization\": 0,\n\t\t\"traces.approves.cost_time\": 0,\n#\t\t\"traces.approves.read_date\": 0,\n\t\t\"traces.approves.is_error\": 0,\n\t\t# \"traces.approves.user_name\": 0,\n\t\t\"traces.approves.deadline\": 0,\n\t\t\"traces.approves.remind_date\": 0,\n\t\t\"traces.approves.reminded_count\": 0,\n\t\t\"traces.approves.modified_by\": 0,\n\t\t\"traces.approves.modified\": 0,\n\t\t\"traces.approves.geolocation\": 0,\n\t\t\"traces.approves.cc_users\": 0,\n\t\t\"traces.approves.from_approve_id\": 0,\n\t\t\"traces.approves.values_history\": 0\n\t}\n\n\tgetMyapproveModified = (traces)->\n\t\tmyApproveModifieds = new Array()\n\n\t\ttraces?.forEach (trace)->\n\t\t\ttrace?.approves?.forEach (approve)->\n\t\t\t\tif (approve.user == self.userId || approve.handler == self.userId)\n\t\t\t\t# && !approve.is_finished\n#\t\t\t\t\tconsole.log(\"approve\", approve._id, approve.read_date)\n\n\t\t\t\t\tmyApproveModifieds.push(approve.read_date)\n\n\t\treturn myApproveModifieds\n\n\n\tgetMiniInstance = (_instanceId)->\n\t\tinstance = db.instances.findOne({_id: _instanceId}, {fields: instance_fields_0})\n\n\t\tif instance\n\n\t\t\ttriggerChangeFields.forEach (key)->\n\t\t\t\tif key == '_my_approve_read_dates'\n\t\t\t\t\ttriggerChangeFieldsValues[key] = getMyapproveModified(instance.traces)\n\t\t\t\telse\n\t\t\t\t\ttriggerChangeFieldsValues[key] = instance[key]\n\n#\t\t\thasOpinionField = InstanceSignText.includesOpinionField(instance.form, instance.form_version)\n\n\t\t\tshow_modal_traces_list = db.space_settings.findOne({ space: instance.space, key: \"show_modal_traces_list\" }, { fields: { values: 1 } })?.values || false\n\n\t\t\tif show_modal_traces_list\n\n\t\t\t\ttraces = new Array();\n\n\t\t\t\tinstance?.traces?.forEach (trace)->\n\t\t\t\t\t_trace = _.clone(trace)\n\n\t\t\t\t\tapproves = new Array()\n\n\t\t\t\t\ttrace?.approves?.forEach (approve)->\n\t\t\t\t\t\tif approve.type != 'cc' || approve.user == self.userId || approve.handler == self.userId || (!_.isEmpty(approve.sign_field_code))\n\t\t\t\t\t\t\tapproves.push(approve)\n\n\t\t\t\t\t_trace.approves = approves\n\n\t\t\t\t\ttraces.push(_trace)\n\n\t\t\t\tinstance.traces = traces;\n\n\t\treturn instance\n\n\n\tneedChange = (changeFields)->\n\t\tif changeFields\n\n\t\t\t_change = false\n\n\t\t\t_rev = _.find triggerChangeFields, (key)->\n\t\t\t\t_key = key\n\n\t\t\t\tif key == '_my_approve_read_dates'\n\t\t\t\t\t_key = 'traces'\n\n\t\t\t\tif _.has(changeFields, _key)\n\n\t\t\t\t\tif key == '_my_approve_read_dates'\n\n\t\t\t\t\t\t_my_approve_modifieds = getMyapproveModified(changeFields.traces)\n\n#\t\t\t\t\t\tconsole.log(triggerChangeFieldsValues[key], _my_approve_modifieds)\n\n\t\t\t\t\t\treturn !_.isEqual(triggerChangeFieldsValues[key], _my_approve_modifieds)\n\t\t\t\t\telse\n\t\t\t\t\t\treturn !_.isEqual(triggerChangeFieldsValues[key], changeFields[key])\n\n\t\t\tif _rev\n\t\t\t\t_change = true\n\n#\t\t\tconsole.log(_rev, _change)\n\n\t\t\treturn _change\n\n\t\treturn true\n\t#æ­¤å¤„ä¸èƒ½æ·»åŠ fieldsé™åˆ¶ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ•°æ®ä¸å®žæ—¶\n\thandle = db.instances.find({_id: instanceId}).observeChanges {\n\t\tchanged: (id, fields)->\n\t\t\tif(box != 'inbox' || needChange(fields))\n\t\t\t\tself.changed(\"instances\", id, getMiniInstance(id));\n\t\tremoved: (id)->\n\t\t\tself.removed(\"instances\", id);\n\t}\n\n\tinstance = getMiniInstance(instanceId)\n\n\tself.added(\"instances\", instance?._id, instance);\n\n\tself.ready();\n\n\tself.onStop ()->\n\t\thandle.stop()\n\n\nMeteor.publish 'instance_traces', (instanceId)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless instanceId\n\t\treturn this.ready()\n\n\tself = this\n\n\tgetInstanceTraces = (_insId)->\n\t\treturn db.instances.findOne({_id: _insId}, {fields: {_id: 1, traces: 1}})\n\n\n\thandle =  db.instances.find({_id: instanceId}).observeChanges {\n\t\tchanged: (id)->\n\t\t\tself.changed(\"instance_traces\", instanceId, getInstanceTraces(instanceId));\n\t}\n\n\tself.added(\"instance_traces\", instanceId, getInstanceTraces(instanceId));\n\n\tself.ready();\n\tself.onStop ()->\n\t\thandle.stop()","Meteor.publish('instance_data', function(instanceId, box) {\n  var getMiniInstance, getMyapproveModified, handle, instance, instance_fields_0, miniApproveFields, needChange, self, triggerChangeFields, triggerChangeFieldsValues;\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!(instanceId && db.instances.find({\n    _id: instanceId\n  }).count())) {\n    return this.ready();\n  }\n  self = this;\n  miniApproveFields = ['_id', 'is_finished', 'user', 'handler', 'handler_name', 'type', 'start_date', 'description', 'is_read', 'judge', 'finish_date', 'from_user_name', 'from_user', 'cc_description', 'auto_submitted'];\n  triggerChangeFields = ['form_version', 'flow_version', 'related_instances', '_my_approve_read_dates', 'values', 'change_time'];\n  triggerChangeFieldsValues = {};\n  instance_fields_0 = {\n    \"record_synced\": 0,\n    \"traces.approves.handler_organization_name\": 0,\n    \"traces.approves.handler_organization\": 0,\n    \"traces.approves.cost_time\": 0,\n    \"traces.approves.is_error\": 0,\n    \"traces.approves.deadline\": 0,\n    \"traces.approves.remind_date\": 0,\n    \"traces.approves.reminded_count\": 0,\n    \"traces.approves.modified_by\": 0,\n    \"traces.approves.modified\": 0,\n    \"traces.approves.geolocation\": 0,\n    \"traces.approves.cc_users\": 0,\n    \"traces.approves.from_approve_id\": 0,\n    \"traces.approves.values_history\": 0\n  };\n  getMyapproveModified = function(traces) {\n    var myApproveModifieds;\n    myApproveModifieds = new Array();\n    if (traces != null) {\n      traces.forEach(function(trace) {\n        var ref;\n        return trace != null ? (ref = trace.approves) != null ? ref.forEach(function(approve) {\n          if (approve.user === self.userId || approve.handler === self.userId) {\n            return myApproveModifieds.push(approve.read_date);\n          }\n        }) : void 0 : void 0;\n      });\n    }\n    return myApproveModifieds;\n  };\n  getMiniInstance = function(_instanceId) {\n    var instance, ref, ref1, show_modal_traces_list, traces;\n    instance = db.instances.findOne({\n      _id: _instanceId\n    }, {\n      fields: instance_fields_0\n    });\n    if (instance) {\n      triggerChangeFields.forEach(function(key) {\n        if (key === '_my_approve_read_dates') {\n          return triggerChangeFieldsValues[key] = getMyapproveModified(instance.traces);\n        } else {\n          return triggerChangeFieldsValues[key] = instance[key];\n        }\n      });\n      show_modal_traces_list = ((ref = db.space_settings.findOne({\n        space: instance.space,\n        key: \"show_modal_traces_list\"\n      }, {\n        fields: {\n          values: 1\n        }\n      })) != null ? ref.values : void 0) || false;\n      if (show_modal_traces_list) {\n        traces = new Array();\n        if (instance != null) {\n          if ((ref1 = instance.traces) != null) {\n            ref1.forEach(function(trace) {\n              var _trace, approves, ref2;\n              _trace = _.clone(trace);\n              approves = new Array();\n              if (trace != null) {\n                if ((ref2 = trace.approves) != null) {\n                  ref2.forEach(function(approve) {\n                    if (approve.type !== 'cc' || approve.user === self.userId || approve.handler === self.userId || (!_.isEmpty(approve.sign_field_code))) {\n                      return approves.push(approve);\n                    }\n                  });\n                }\n              }\n              _trace.approves = approves;\n              return traces.push(_trace);\n            });\n          }\n        }\n        instance.traces = traces;\n      }\n    }\n    return instance;\n  };\n  needChange = function(changeFields) {\n    var _change, _rev;\n    if (changeFields) {\n      _change = false;\n      _rev = _.find(triggerChangeFields, function(key) {\n        var _key, _my_approve_modifieds;\n        _key = key;\n        if (key === '_my_approve_read_dates') {\n          _key = 'traces';\n        }\n        if (_.has(changeFields, _key)) {\n          if (key === '_my_approve_read_dates') {\n            _my_approve_modifieds = getMyapproveModified(changeFields.traces);\n            return !_.isEqual(triggerChangeFieldsValues[key], _my_approve_modifieds);\n          } else {\n            return !_.isEqual(triggerChangeFieldsValues[key], changeFields[key]);\n          }\n        }\n      });\n      if (_rev) {\n        _change = true;\n      }\n      return _change;\n    }\n    return true;\n  };\n  handle = db.instances.find({\n    _id: instanceId\n  }).observeChanges({\n    changed: function(id, fields) {\n      if (box !== 'inbox' || needChange(fields)) {\n        return self.changed(\"instances\", id, getMiniInstance(id));\n      }\n    },\n    removed: function(id) {\n      return self.removed(\"instances\", id);\n    }\n  });\n  instance = getMiniInstance(instanceId);\n  self.added(\"instances\", instance != null ? instance._id : void 0, instance);\n  self.ready();\n  return self.onStop(function() {\n    return handle.stop();\n  });\n});\n\nMeteor.publish('instance_traces', function(instanceId) {\n  var getInstanceTraces, handle, self;\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!instanceId) {\n    return this.ready();\n  }\n  self = this;\n  getInstanceTraces = function(_insId) {\n    return db.instances.findOne({\n      _id: _insId\n    }, {\n      fields: {\n        _id: 1,\n        traces: 1\n      }\n    });\n  };\n  handle = db.instances.find({\n    _id: instanceId\n  }).observeChanges({\n    changed: function(id) {\n      return self.changed(\"instance_traces\", instanceId, getInstanceTraces(instanceId));\n    }\n  });\n  self.added(\"instance_traces\", instanceId, getInstanceTraces(instanceId));\n  self.ready();\n  return self.onStop(function() {\n    return handle.stop();\n  });\n});\n","\n\tMeteor.publish 'instances_list', (spaceId, box, flowId)->\n\n\t\tunless this.userId\n\t\t\treturn this.ready()\n\t\t\n\t\tunless spaceId\n\t\t\treturn this.ready()\n\n\t\tquery = {space: spaceId}\n\t\tif box == \"inbox\"\n\t\t\tquery.inbox_users = this.userId;\n\t\telse if box == \"outbox\"\n\t\t\tquery.outbox_users = this.userId;\n\t\telse if box == \"draft\"\n\t\t\tquery.submitter = this.userId;\n\t\t\tquery.state = \"draft\"\n\t\telse if box == \"pending\"\n\t\t\tquery.submitter = this.userId;\n\t\t\tquery.state = \"pending\"\n\t\telse if box == \"completed\"\n\t\t\tquery.submitter = this.userId;\n\t\t\tquery.state = \"completed\"\n\t\telse if box == \"monitor\"\n\t\t\tquery.flow = flowId;\n\t\t\tquery.state = {$in: [\"pending\",\"completed\"]};\n\t\telse\n\t\t\tquery.state = \"none\"\n\n\t\treturn db.instances.find(query, {fields: {name:1, created:1, form:1, flow: 1, space:1, modified:1, applicant: 1, is_archived:1, form_version: 1, flow_version: 1}})\n\n","Meteor.publish('instances_list', function(spaceId, box, flowId) {\n  var query;\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!spaceId) {\n    return this.ready();\n  }\n  query = {\n    space: spaceId\n  };\n  if (box === \"inbox\") {\n    query.inbox_users = this.userId;\n  } else if (box === \"outbox\") {\n    query.outbox_users = this.userId;\n  } else if (box === \"draft\") {\n    query.submitter = this.userId;\n    query.state = \"draft\";\n  } else if (box === \"pending\") {\n    query.submitter = this.userId;\n    query.state = \"pending\";\n  } else if (box === \"completed\") {\n    query.submitter = this.userId;\n    query.state = \"completed\";\n  } else if (box === \"monitor\") {\n    query.flow = flowId;\n    query.state = {\n      $in: [\"pending\", \"completed\"]\n    };\n  } else {\n    query.state = \"none\";\n  }\n  return db.instances.find(query, {\n    fields: {\n      name: 1,\n      created: 1,\n      form: 1,\n      flow: 1,\n      space: 1,\n      modified: 1,\n      applicant: 1,\n      is_archived: 1,\n      form_version: 1,\n      flow_version: 1\n    }\n  });\n});\n","lastFinishedApproveAggregate = (instanceid, userId, dataMap, callback)->\n\toperation = [{\n\t\t\"$match\": {\n\t\t\t\"_id\": instanceid\n\t\t}\n\t}, {\"$project\": {\"name\": 1, \"_approve\": \"$traces.approves\"}}, {\"$unwind\": \"$_approve\"}, {\"$unwind\": \"$_approve\"},\n\t\t{\"$match\": {\"_approve.is_finished\": true, $or:[{\"_approve.handler\": userId},{\"_approve.user\": userId}]}},\n\t\t{\"$group\": {\"_id\": \"$_id\", \"finish_date\": {\"$last\": \"$_approve.finish_date\"}}}\n\t]\n\n\tdb.instances.rawCollection().aggregate(operation).toArray (err, data)->\n\t\tif err\n\t\t\tthrow new Error(err)\n\n\t\tdata.forEach (doc) ->\n\t\t\tdataMap.push doc\n\n\t\tif callback && _.isFunction(callback)\n\t\t\tcallback()\n\t\treturn\n\nasyncLastFinishedApprove = Meteor.wrapAsync(lastFinishedApproveAggregate)\n\nMeteor.publish \"instance_tabular\", (tableName, ids, fields)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tcheck(tableName, String);\n\n\tcheck(ids, Array);\n\n\tcheck(fields, Match.Optional(Object))\n\n\tfields.cc_users = 1\n\n\tself = this;\n\n\tgetMyLastFinishedApprove = (userId, instanceId)->\n\t\tdata = []\n\t\tasyncLastFinishedApprove(instanceId, userId, data)\n\t\tif data.length > 0\n\t\t\treturn data[0]\n\n\n\tgetMyApprove = (userId, instanceId)->\n\t\tinstance = db.instances.findOne({_id: instanceId}, {fields: {traces: 1}})\n\t\tmyApprove = null\n\n\t\tif !instance\n\t\t\treturn\n\n\t\tif !instance.traces || instance.traces.length < 1\n\t\t\treturn\n\n\t\tnotFinishedTraces = instance.traces.filterProperty(\"is_finished\", false)\n\n\t\tif notFinishedTraces.length > 0\n\t\t\tapproves = notFinishedTraces[0].approves.filterProperty(\"is_finished\", false).filterProperty(\"handler\", userId);\n\n\t\t\tif approves.length > 0\n\t\t\t\tapprove = approves[0]\n\t\t\t\tmyApprove = {\n\t\t\t\t\tid: approve._id,\n\t\t\t\t\tinstance: approve.instance,\n\t\t\t\t\ttrace: approve.trace,\n\t\t\t\t\tis_read: approve.is_read,\n\t\t\t\t\tstart_date: approve.start_date\n\t\t\t\t\tagent: approve.agent\n\t\t\t\t\tuser_name: approve.user_name\n\t\t\t\t}\n\n\t\tif !myApprove\n\t\t\tis_read = false\n\t\t\tinstance.traces.forEach (trace) ->\n\t\t\t\ttrace?.approves?.forEach (approve) ->\n\t\t\t\t\tif approve.type == 'cc' and approve.user == userId and approve.is_finished == false\n\t\t\t\t\t\tif approve.is_read\n\t\t\t\t\t\t\tis_read = true\n\t\t\t\t\t\tmyApprove = {id: approve._id, is_read: is_read, start_date: approve.start_date, agent: approve.agent, user_name: approve.user_name}\n\n\t\treturn myApprove\n\n\tgetStepCurrentName = (instanceId) ->\n\t\tinstance = db.instances.findOne({_id: instanceId}, {fields: {\"traces.name\": 1, \"traces\": {$slice: -1}}})\n\t\tif instance\n\t\t\tstepCurrentName = instance.traces?[0]?.name\n\n\t\treturn stepCurrentName\n\n\thandle = db.instances.find({_id: {$in: ids}}, {fields: {traces: 0}}).observeChanges {\n\t\tchanged: (id)->\n\t\t\tinstance = db.instances.findOne({_id: id}, {fields: fields})\n\t\t\treturn if not instance\n\t\t\tmyApprove = getMyApprove(self.userId, id)\n\t\t\tmyLastFinishedApprove = getMyLastFinishedApprove(self.userId, id)\n\t\t\tif myApprove\n\t\t\t\tinstance.is_read = myApprove.is_read\n\t\t\t\tinstance.start_date = myApprove.start_date\n\t\t\t\tif myApprove.agent\n\t\t\t\t\tinstance.agent_user_name = myApprove.user_name\n\t\t\telse\n\t\t\t\tinstance.is_read = true\n\n\t\t\tif myLastFinishedApprove\n\t\t\t\tinstance.my_finish_date = myLastFinishedApprove.finish_date\n\n\t\t\tinstance.is_cc = instance.cc_users?.includes(self.userId) || false\n\t\t\tinstance.cc_count = instance.cc_users?.length || 0\n\t\t\tdelete instance.cc_users\n\t\t\ttry\n\t\t\t\tself.changed(\"instances\", id, instance);\n\t\t\tcatch error\n\t\t\t\tconsole.log('instance observeChanges error: ', error.message);\n\t\t\t\tconsole.log('self.userId: ', self.userId);\n\t\t\t\tconsole.log('tableName: ', tableName);\n\t\t\t\tconsole.log('ids: ', JSON.stringify(ids));\n\t\t\t\tconsole.log('myApprove: ', JSON.stringify(myApprove));\n\t\tremoved: (id)->\n\t\t\tself.removed(\"instances\", id);\n\t}\n\n\tids.forEach (id)->\n\t\tinstance = db.instances.findOne({_id: id}, {fields: fields})\n\t\treturn if not instance\n\t\tmyApprove = getMyApprove(self.userId, id)\n\t\tmyLastFinishedApprove = getMyLastFinishedApprove(self.userId, id)\n\t\tif myApprove\n\t\t\tinstance.is_read = myApprove.is_read\n\t\t\tinstance.start_date = myApprove.start_date\n\t\t\tif myApprove.agent\n\t\t\t\t\tinstance.agent_user_name = myApprove.user_name\n\t\telse\n\t\t\tinstance.is_read = true\n\n\t\tif myLastFinishedApprove\n\t\t\tinstance.my_finish_date = myLastFinishedApprove.finish_date\n\n\t\tinstance.is_cc = instance.cc_users?.includes(self.userId) || false\n\t\tinstance.cc_count = instance.cc_users?.length || 0\n\t\tdelete instance.cc_users\n\t\tself.added(\"instances\", id, instance);\n\n\tself.ready();\n\tself.onStop ()->\n\t\thandle.stop()\n\nMeteor.publish \"instance_tasks_tabular\", (tabularName, ids, fields)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tcheck(tabularName, String);\n\n\tcheck(ids, Array);\n\n\tcheck(fields, Match.Optional(Object))\n\n\t# console.log('tabularName: ', tabularName);\n\t# console.log('ids: ', JSON.stringify(ids));\n\t# console.log('fields: ', JSON.stringify(fields));\n\n\tdb.instance_tasks.find({\n\t\t_id: {\n\t\t\t$in: ids\n\t\t}\n\t}, {\n\t\tfields: fields\n\t})\n\nMeteor.publish \"instances_tabular\", (tabularName, ids, fields)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tcheck(tabularName, String);\n\n\tcheck(ids, Array);\n\n\tcheck(fields, Match.Optional(Object))\n\n\t# console.log('tabularName: ', tabularName);\n\t# console.log('ids: ', JSON.stringify(ids));\n\t# console.log('fields: ', JSON.stringify(fields));\n\n\tdb.instances.find({\n\t\t_id: {\n\t\t\t$in: ids\n\t\t}\n\t}, {\n\t\tfields: fields\n\t})","var asyncLastFinishedApprove, lastFinishedApproveAggregate;\n\nlastFinishedApproveAggregate = function(instanceid, userId, dataMap, callback) {\n  var operation;\n  operation = [\n    {\n      \"$match\": {\n        \"_id\": instanceid\n      }\n    }, {\n      \"$project\": {\n        \"name\": 1,\n        \"_approve\": \"$traces.approves\"\n      }\n    }, {\n      \"$unwind\": \"$_approve\"\n    }, {\n      \"$unwind\": \"$_approve\"\n    }, {\n      \"$match\": {\n        \"_approve.is_finished\": true,\n        $or: [\n          {\n            \"_approve.handler\": userId\n          }, {\n            \"_approve.user\": userId\n          }\n        ]\n      }\n    }, {\n      \"$group\": {\n        \"_id\": \"$_id\",\n        \"finish_date\": {\n          \"$last\": \"$_approve.finish_date\"\n        }\n      }\n    }\n  ];\n  return db.instances.rawCollection().aggregate(operation).toArray(function(err, data) {\n    if (err) {\n      throw new Error(err);\n    }\n    data.forEach(function(doc) {\n      return dataMap.push(doc);\n    });\n    if (callback && _.isFunction(callback)) {\n      callback();\n    }\n  });\n};\n\nasyncLastFinishedApprove = Meteor.wrapAsync(lastFinishedApproveAggregate);\n\nMeteor.publish(\"instance_tabular\", function(tableName, ids, fields) {\n  var getMyApprove, getMyLastFinishedApprove, getStepCurrentName, handle, self;\n  if (!this.userId) {\n    return this.ready();\n  }\n  check(tableName, String);\n  check(ids, Array);\n  check(fields, Match.Optional(Object));\n  fields.cc_users = 1;\n  self = this;\n  getMyLastFinishedApprove = function(userId, instanceId) {\n    var data;\n    data = [];\n    asyncLastFinishedApprove(instanceId, userId, data);\n    if (data.length > 0) {\n      return data[0];\n    }\n  };\n  getMyApprove = function(userId, instanceId) {\n    var approve, approves, instance, is_read, myApprove, notFinishedTraces;\n    instance = db.instances.findOne({\n      _id: instanceId\n    }, {\n      fields: {\n        traces: 1\n      }\n    });\n    myApprove = null;\n    if (!instance) {\n      return;\n    }\n    if (!instance.traces || instance.traces.length < 1) {\n      return;\n    }\n    notFinishedTraces = instance.traces.filterProperty(\"is_finished\", false);\n    if (notFinishedTraces.length > 0) {\n      approves = notFinishedTraces[0].approves.filterProperty(\"is_finished\", false).filterProperty(\"handler\", userId);\n      if (approves.length > 0) {\n        approve = approves[0];\n        myApprove = {\n          id: approve._id,\n          instance: approve.instance,\n          trace: approve.trace,\n          is_read: approve.is_read,\n          start_date: approve.start_date,\n          agent: approve.agent,\n          user_name: approve.user_name\n        };\n      }\n    }\n    if (!myApprove) {\n      is_read = false;\n      instance.traces.forEach(function(trace) {\n        var ref;\n        return trace != null ? (ref = trace.approves) != null ? ref.forEach(function(approve) {\n          if (approve.type === 'cc' && approve.user === userId && approve.is_finished === false) {\n            if (approve.is_read) {\n              is_read = true;\n            }\n            return myApprove = {\n              id: approve._id,\n              is_read: is_read,\n              start_date: approve.start_date,\n              agent: approve.agent,\n              user_name: approve.user_name\n            };\n          }\n        }) : void 0 : void 0;\n      });\n    }\n    return myApprove;\n  };\n  getStepCurrentName = function(instanceId) {\n    var instance, ref, ref1, stepCurrentName;\n    instance = db.instances.findOne({\n      _id: instanceId\n    }, {\n      fields: {\n        \"traces.name\": 1,\n        \"traces\": {\n          $slice: -1\n        }\n      }\n    });\n    if (instance) {\n      stepCurrentName = (ref = instance.traces) != null ? (ref1 = ref[0]) != null ? ref1.name : void 0 : void 0;\n    }\n    return stepCurrentName;\n  };\n  handle = db.instances.find({\n    _id: {\n      $in: ids\n    }\n  }, {\n    fields: {\n      traces: 0\n    }\n  }).observeChanges({\n    changed: function(id) {\n      var error, instance, myApprove, myLastFinishedApprove, ref, ref1;\n      instance = db.instances.findOne({\n        _id: id\n      }, {\n        fields: fields\n      });\n      if (!instance) {\n        return;\n      }\n      myApprove = getMyApprove(self.userId, id);\n      myLastFinishedApprove = getMyLastFinishedApprove(self.userId, id);\n      if (myApprove) {\n        instance.is_read = myApprove.is_read;\n        instance.start_date = myApprove.start_date;\n        if (myApprove.agent) {\n          instance.agent_user_name = myApprove.user_name;\n        }\n      } else {\n        instance.is_read = true;\n      }\n      if (myLastFinishedApprove) {\n        instance.my_finish_date = myLastFinishedApprove.finish_date;\n      }\n      instance.is_cc = ((ref = instance.cc_users) != null ? ref.includes(self.userId) : void 0) || false;\n      instance.cc_count = ((ref1 = instance.cc_users) != null ? ref1.length : void 0) || 0;\n      delete instance.cc_users;\n      try {\n        return self.changed(\"instances\", id, instance);\n      } catch (error1) {\n        error = error1;\n        console.log('instance observeChanges error: ', error.message);\n        console.log('self.userId: ', self.userId);\n        console.log('tableName: ', tableName);\n        console.log('ids: ', JSON.stringify(ids));\n        return console.log('myApprove: ', JSON.stringify(myApprove));\n      }\n    },\n    removed: function(id) {\n      return self.removed(\"instances\", id);\n    }\n  });\n  ids.forEach(function(id) {\n    var instance, myApprove, myLastFinishedApprove, ref, ref1;\n    instance = db.instances.findOne({\n      _id: id\n    }, {\n      fields: fields\n    });\n    if (!instance) {\n      return;\n    }\n    myApprove = getMyApprove(self.userId, id);\n    myLastFinishedApprove = getMyLastFinishedApprove(self.userId, id);\n    if (myApprove) {\n      instance.is_read = myApprove.is_read;\n      instance.start_date = myApprove.start_date;\n      if (myApprove.agent) {\n        instance.agent_user_name = myApprove.user_name;\n      }\n    } else {\n      instance.is_read = true;\n    }\n    if (myLastFinishedApprove) {\n      instance.my_finish_date = myLastFinishedApprove.finish_date;\n    }\n    instance.is_cc = ((ref = instance.cc_users) != null ? ref.includes(self.userId) : void 0) || false;\n    instance.cc_count = ((ref1 = instance.cc_users) != null ? ref1.length : void 0) || 0;\n    delete instance.cc_users;\n    return self.added(\"instances\", id, instance);\n  });\n  self.ready();\n  return self.onStop(function() {\n    return handle.stop();\n  });\n});\n\nMeteor.publish(\"instance_tasks_tabular\", function(tabularName, ids, fields) {\n  if (!this.userId) {\n    return this.ready();\n  }\n  check(tabularName, String);\n  check(ids, Array);\n  check(fields, Match.Optional(Object));\n  return db.instance_tasks.find({\n    _id: {\n      $in: ids\n    }\n  }, {\n    fields: fields\n  });\n});\n\nMeteor.publish(\"instances_tabular\", function(tabularName, ids, fields) {\n  if (!this.userId) {\n    return this.ready();\n  }\n  check(tabularName, String);\n  check(ids, Array);\n  check(fields, Match.Optional(Object));\n  return db.instances.find({\n    _id: {\n      $in: ids\n    }\n  }, {\n    fields: fields\n  });\n});\n","Meteor.publish 'instances_draft', (spaceId) ->\n\tcheck spaceId, String\n\n\tunless this.userId\n\t\treturn this.ready()\n\n\tuserId = this.userId\n\treturn db.instances.find({state:\"draft\",space:spaceId,submitter:userId,$or:[{inbox_users: {$exists:false}}, {inbox_users: []}]}, {fields: {_id: 1, state: 1, space: 1, submitter: 1, inbox_users: 1, modified: 1, name: 1}, sort:{modified: -1}})","Meteor.publish('instances_draft', function(spaceId) {\n  var userId;\n  check(spaceId, String);\n  if (!this.userId) {\n    return this.ready();\n  }\n  userId = this.userId;\n  return db.instances.find({\n    state: \"draft\",\n    space: spaceId,\n    submitter: userId,\n    $or: [\n      {\n        inbox_users: {\n          $exists: false\n        }\n      }, {\n        inbox_users: []\n      }\n    ]\n  }, {\n    fields: {\n      _id: 1,\n      state: 1,\n      space: 1,\n      submitter: 1,\n      inbox_users: 1,\n      modified: 1,\n      name: 1\n    },\n    sort: {\n      modified: -1\n    }\n  });\n});\n","Meteor.publish 'distributed_instances_state_by_ids', (instance_ids)->\n\tcheck(instance_ids, Array)\n\n\tunless this.userId\n\t\treturn this.ready()\n\t\n\tunless instance_ids\n\t\treturn this.ready()\n\n\tif _.isEmpty(instance_ids)\n\t\treturn this.ready()\n\n\tself = this\n\n\thandle = db.instances.find({_id: {$in: instance_ids}}, {fields: {state: 1, traces:{$slice: 1} } }).observeChanges {\n\t\tadded: (id, fields)->\n\t\t\tself.added('instances', id, {state: fields.state, is_read: fields.traces[0].approves[0].is_read})\n\n\t\tchanged: (id, fields)->\n\t\t\tif fields.state\n\t\t\t\tself.changed('instances', id, {state: fields.state})\n\t\t\tif fields.traces\n\t\t\t\tself.changed('instances', id, {is_read: fields.traces[0].approves[0].is_read})\n\t}\n\n\tthis.ready()\n\tthis.onStop ()->\n\t\thandle.stop()\n","Meteor.publish('distributed_instances_state_by_ids', function(instance_ids) {\n  var handle, self;\n  check(instance_ids, Array);\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!instance_ids) {\n    return this.ready();\n  }\n  if (_.isEmpty(instance_ids)) {\n    return this.ready();\n  }\n  self = this;\n  handle = db.instances.find({\n    _id: {\n      $in: instance_ids\n    }\n  }, {\n    fields: {\n      state: 1,\n      traces: {\n        $slice: 1\n      }\n    }\n  }).observeChanges({\n    added: function(id, fields) {\n      return self.added('instances', id, {\n        state: fields.state,\n        is_read: fields.traces[0].approves[0].is_read\n      });\n    },\n    changed: function(id, fields) {\n      if (fields.state) {\n        self.changed('instances', id, {\n          state: fields.state\n        });\n      }\n      if (fields.traces) {\n        return self.changed('instances', id, {\n          is_read: fields.traces[0].approves[0].is_read\n        });\n      }\n    }\n  });\n  this.ready();\n  return this.onStop(function() {\n    return handle.stop();\n  });\n});\n","Meteor.publish 'related_instaces', (instanceId, related_instances)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless instanceId\n\t\treturn this.ready()\n\n\trelated_instance_ids = db.instances.findOne(instanceId,{fields: {related_instances: 1}})?.related_instances\n\n\tif related_instance_ids && _.isArray(related_instance_ids)\n\t\treturn db.instances.find({_id: {$in : related_instance_ids}}, {fields: {_id: 1, name: 1, space: 1}})\n\telse\n\t\treturn this.ready()","Meteor.publish('related_instaces', function(instanceId, related_instances) {\n  var ref, related_instance_ids;\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!instanceId) {\n    return this.ready();\n  }\n  related_instance_ids = (ref = db.instances.findOne(instanceId, {\n    fields: {\n      related_instances: 1\n    }\n  })) != null ? ref.related_instances : void 0;\n  if (related_instance_ids && _.isArray(related_instance_ids)) {\n    return db.instances.find({\n      _id: {\n        $in: related_instance_ids\n      }\n    }, {\n      fields: {\n        _id: 1,\n        name: 1,\n        space: 1\n      }\n    });\n  } else {\n    return this.ready();\n  }\n});\n","if Meteor.isServer\n    Meteor.publish 'space_user_signs', (spaceId) ->\n        check spaceId, String\n\n        unless this.userId\n            return this.ready()\n\n        return db.space_user_signs.find({ space: spaceId }, {fields: {created_by: 0, created: 0, modified_by: 0}})\n","if (Meteor.isServer) {\n  Meteor.publish('space_user_signs', function(spaceId) {\n    check(spaceId, String);\n    if (!this.userId) {\n      return this.ready();\n    }\n    return db.space_user_signs.find({\n      space: spaceId\n    }, {\n      fields: {\n        created_by: 0,\n        created: 0,\n        modified_by: 0\n      }\n    });\n  });\n}\n","###\nMeteor.publishComposite \"user_inbox_instance\", ()->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tuserSpaceIds = db.space_users.find({\n\t\tuser: this.userId,\n\t\tuser_accepted: true\n\t}, {fields: {space: 1}}).fetch().getEach(\"space\");\n\tquery = {space: {$in: userSpaceIds}}\n\n\tquery.$or = [{inbox_users: this.userId}, {cc_users: this.userId}]\n\n\tfind: ->\n\t\tdb.instances.find(query, {\n\t\t\tfields: {\n\t\t\t\tspace: 1,\n\t\t\t\tapplicant_name: 1,\n\t\t\t\tflow: 1,\n\t\t\t\tinbox_users: 1,\n\t\t\t\tcc_users: 1,\n\t\t\t\tstate: 1,\n\t\t\t\tname: 1,\n\t\t\t\tmodified: 1,\n\t\t\t\tform: 1\n\t\t\t}, sort: {modified: -1}, skip: 0, limit: 200\n\t\t});\n\tchildren: [\n\t\t{\n\t\t\tfind: (instance, post)->\n\t\t\t\tdb.flows.find({_id: instance.flow}, {fields: {name: 1, space: 1}});\n\t\t}\n\t]\n###\n\n###\nMeteor.publish 'my_inbox_instances', (spaceId)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tself = this;\n\n\t#\tuserSpaceIds = db.space_users.find({\n\t#\t\tuser: this.userId,\n\t#\t\tuser_accepted: true\n\t#\t}, {fields: {space: 1}}).fetch().getEach(\"space\");\n\n\tquery = {space: spaceId}\n\n\tquery.$or = [{inbox_users: this.userId}, {cc_users: this.userId}]\n\n\tfields = {\n\t\tspace: 1,\n#\t\tapplicant_name: 1,\n\t\tflow: 1,\n\t\tinbox_users: 1,\n\t\tcc_users: 1,\n\t\tstate: 1,\n#\t\tname: 1,\n#\t\tmodified: 1,\n\t\tform: 1\n\t}\n\n\thandle = db.instances.find(query, {sort: {modified: -1}, skip: 0, limit: 500}).observeChanges {\n\t\tadded: (id)->\n\t\t\tinstance = db.instances.findOne({_id: id}, {fields: fields})\n\t\t\treturn if not instance\n\t\t\tinstance.is_cc = instance.cc_users?.includes(self.userId) || false\n\t\t\tdelete instance.cc_users\n\t\t\tself.added(\"instances\", id, instance)\n\t\tchanged: (id)->\n\t\t\tinstance = db.instances.findOne({_id: id}, {fields: fields})\n\t\t\treturn if not instance\n\t\t\tinstance.is_cc = instance.cc_users?.includes(self.userId) || false\n\t\t\tdelete instance.cc_users\n\t\t\tself.changed(\"instances\", id, instance);\n\t\tremoved: (id)->\n\t\t\tself.removed(\"instances\", id);\n\t}\n\n\tself.ready();\n\tself.onStop ()->\n\t\thandle.stop()\n###\n\n_get_flow_instances_aggregate = (spaceId, userId, _items, callback)->\n\tdb.instances.rawCollection().aggregate([\n\t\t{\n\t\t\t$match: {\n\t\t\t\tspace: spaceId,\n\t\t\t\t$or: [{inbox_users: userId}, {cc_users: userId}]\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t$group: {\n\t\t\t\t_id: {flow: \"$flow\", category: \"$category\"}, count: {$sum: 1}\n\t\t\t}\n\t\t}\n\t]).toArray (err, data)->\n\t\tif err\n\t\t\tthrow new Error(err)\n\n\t\tdata.forEach (doc) ->\n\t\t\t_items.push doc\n\n\t\tif callback && _.isFunction(callback)\n\t\t\tcallback()\n\t\treturn\n\n_async_get_flow_instances_aggregate = Meteor.wrapAsync(_get_flow_instances_aggregate)\n\nMeteor.publish 'my_inbox_flow_instances_count', (spaceId)->\n\n\tunless this.userId\n\t\treturn this.ready()\n\n\tself = this;\n\n\tquery = {space: spaceId}\n\n\tquery.$or = [{inbox_users: this.userId}, {cc_users: this.userId}]\n\n\tdata = []  #æ•°æ®æ ¼å¼ï¼š[{_id:flowId, count: å¾…åŠžæ•°é‡}, {_id:flowId2, count: å¾…åŠžæ•°é‡2}]\n\t_async_get_flow_instances_aggregate(spaceId, self.userId, data)\n\n\t_flowsData = []\n\n\t_.each data, (dataItem)->\n\t\t_flowsData.push({_id: dataItem._id.flow, category: dataItem._id.category, count: dataItem.count})\n\n\tself.added(\"flow_instances\", spaceId, {flows: _flowsData});\n\n\t_changeData = (doc, action)->\n\t\tflow_instance = _.find _flowsData, (f)->\n\t\t\treturn f._id == doc.flow\n\t\tif flow_instance\n\t\t\tif action == \"added\"\n\t\t\t\tflow_instance.count++\n\t\t\telse if action == \"removed\"\n\t\t\t\tflow_instance.count--\n\t\telse if action == \"added\"\n\t\t\t_flowsData.push {_id: doc.flow, category: doc.category, count: 1}\n\n\t\tself.changed(\"flow_instances\", spaceId, {flows: _flowsData});\n\n\t_init = true\n\thandle = db.instances.find(query, {fields: {_id: 1, inbox_users: 1, cc_users: 1, flow: 1, category: 1}}).observe {\n\t\tadded: (doc)->\n\t\t\tif !_init\n\t\t\t\t_changeData(doc, \"added\")\n\t\tremoved: (doc)->\n\t\t\tif !_init\n\t\t\t\t_changeData(doc, \"removed\")\n\t}\n\t_init = false\n\n\tself.ready();\n\tself.onStop ()->\n\t\thandle.stop()","\n/*\nMeteor.publishComposite \"user_inbox_instance\", ()->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tuserSpaceIds = db.space_users.find({\n\t\tuser: this.userId,\n\t\tuser_accepted: true\n\t}, {fields: {space: 1}}).fetch().getEach(\"space\");\n\tquery = {space: {$in: userSpaceIds}}\n\n\tquery.$or = [{inbox_users: this.userId}, {cc_users: this.userId}]\n\n\tfind: ->\n\t\tdb.instances.find(query, {\n\t\t\tfields: {\n\t\t\t\tspace: 1,\n\t\t\t\tapplicant_name: 1,\n\t\t\t\tflow: 1,\n\t\t\t\tinbox_users: 1,\n\t\t\t\tcc_users: 1,\n\t\t\t\tstate: 1,\n\t\t\t\tname: 1,\n\t\t\t\tmodified: 1,\n\t\t\t\tform: 1\n\t\t\t}, sort: {modified: -1}, skip: 0, limit: 200\n\t\t});\n\tchildren: [\n\t\t{\n\t\t\tfind: (instance, post)->\n\t\t\t\tdb.flows.find({_id: instance.flow}, {fields: {name: 1, space: 1}});\n\t\t}\n\t]\n */\n\n/*\nMeteor.publish 'my_inbox_instances', (spaceId)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tself = this;\n\n\t *\tuserSpaceIds = db.space_users.find({\n\t *\t\tuser: this.userId,\n\t *\t\tuser_accepted: true\n\t *\t}, {fields: {space: 1}}).fetch().getEach(\"space\");\n\n\tquery = {space: spaceId}\n\n\tquery.$or = [{inbox_users: this.userId}, {cc_users: this.userId}]\n\n\tfields = {\n\t\tspace: 1,\n *\t\tapplicant_name: 1,\n\t\tflow: 1,\n\t\tinbox_users: 1,\n\t\tcc_users: 1,\n\t\tstate: 1,\n *\t\tname: 1,\n *\t\tmodified: 1,\n\t\tform: 1\n\t}\n\n\thandle = db.instances.find(query, {sort: {modified: -1}, skip: 0, limit: 500}).observeChanges {\n\t\tadded: (id)->\n\t\t\tinstance = db.instances.findOne({_id: id}, {fields: fields})\n\t\t\treturn if not instance\n\t\t\tinstance.is_cc = instance.cc_users?.includes(self.userId) || false\n\t\t\tdelete instance.cc_users\n\t\t\tself.added(\"instances\", id, instance)\n\t\tchanged: (id)->\n\t\t\tinstance = db.instances.findOne({_id: id}, {fields: fields})\n\t\t\treturn if not instance\n\t\t\tinstance.is_cc = instance.cc_users?.includes(self.userId) || false\n\t\t\tdelete instance.cc_users\n\t\t\tself.changed(\"instances\", id, instance);\n\t\tremoved: (id)->\n\t\t\tself.removed(\"instances\", id);\n\t}\n\n\tself.ready();\n\tself.onStop ()->\n\t\thandle.stop()\n */\nvar _async_get_flow_instances_aggregate, _get_flow_instances_aggregate;\n\n_get_flow_instances_aggregate = function(spaceId, userId, _items, callback) {\n  return db.instances.rawCollection().aggregate([\n    {\n      $match: {\n        space: spaceId,\n        $or: [\n          {\n            inbox_users: userId\n          }, {\n            cc_users: userId\n          }\n        ]\n      }\n    }, {\n      $group: {\n        _id: {\n          flow: \"$flow\",\n          category: \"$category\"\n        },\n        count: {\n          $sum: 1\n        }\n      }\n    }\n  ]).toArray(function(err, data) {\n    if (err) {\n      throw new Error(err);\n    }\n    data.forEach(function(doc) {\n      return _items.push(doc);\n    });\n    if (callback && _.isFunction(callback)) {\n      callback();\n    }\n  });\n};\n\n_async_get_flow_instances_aggregate = Meteor.wrapAsync(_get_flow_instances_aggregate);\n\nMeteor.publish('my_inbox_flow_instances_count', function(spaceId) {\n  var _changeData, _flowsData, _init, data, handle, query, self;\n  if (!this.userId) {\n    return this.ready();\n  }\n  self = this;\n  query = {\n    space: spaceId\n  };\n  query.$or = [\n    {\n      inbox_users: this.userId\n    }, {\n      cc_users: this.userId\n    }\n  ];\n  data = [];\n  _async_get_flow_instances_aggregate(spaceId, self.userId, data);\n  _flowsData = [];\n  _.each(data, function(dataItem) {\n    return _flowsData.push({\n      _id: dataItem._id.flow,\n      category: dataItem._id.category,\n      count: dataItem.count\n    });\n  });\n  self.added(\"flow_instances\", spaceId, {\n    flows: _flowsData\n  });\n  _changeData = function(doc, action) {\n    var flow_instance;\n    flow_instance = _.find(_flowsData, function(f) {\n      return f._id === doc.flow;\n    });\n    if (flow_instance) {\n      if (action === \"added\") {\n        flow_instance.count++;\n      } else if (action === \"removed\") {\n        flow_instance.count--;\n      }\n    } else if (action === \"added\") {\n      _flowsData.push({\n        _id: doc.flow,\n        category: doc.category,\n        count: 1\n      });\n    }\n    return self.changed(\"flow_instances\", spaceId, {\n      flows: _flowsData\n    });\n  };\n  _init = true;\n  handle = db.instances.find(query, {\n    fields: {\n      _id: 1,\n      inbox_users: 1,\n      cc_users: 1,\n      flow: 1,\n      category: 1\n    }\n  }).observe({\n    added: function(doc) {\n      if (!_init) {\n        return _changeData(doc, \"added\");\n      }\n    },\n    removed: function(doc) {\n      if (!_init) {\n        return _changeData(doc, \"removed\");\n      }\n    }\n  });\n  _init = false;\n  self.ready();\n  return self.onStop(function() {\n    return handle.stop();\n  });\n});\n","\nMeteor.publish 'flow_main_attach_template', (spaceId, flowId)->\n\tcheck(spaceId, String)\n\tcheck(flowId, String)\n\n\tunless this.userId\n\t\treturn this.ready()\n\n\tunless spaceId && flowId\n\t\treturn this.ready()\n\n\treturn Creator.getCollection('cms_files').find({ space: spaceId, 'parent.o': 'flows', 'parent.ids': flowId,  name: 'æ­£æ–‡.docx' })\n","Meteor.publish('flow_main_attach_template', function(spaceId, flowId) {\n  check(spaceId, String);\n  check(flowId, String);\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!(spaceId && flowId)) {\n    return this.ready();\n  }\n  return Creator.getCollection('cms_files').find({\n    space: spaceId,\n    'parent.o': 'flows',\n    'parent.ids': flowId,\n    name: 'æ­£æ–‡.docx'\n  });\n});\n","workflowTemplate = {}\n\n#å¯ç”¨æ­¤è„šæœ¬ä»Žæ¨¡æ¿å·¥ä½œåŒºåšæ‰¹é‡å¯¼å‡ºï¼š\n#ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ç™»å½•åŽï¼Œè¿›å…¥FlowModulesï¼Œåœ¨æŽ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹è„šæœ¬å³å¯\n#db.forms.find({state:\"enabled\"}).forEach(function(form){window.open(Meteor.absoluteUrl(\"api/workflow/export/form?form=\"+form._id))})\nworkflowTemplate[\"en\"] =[]\n\n#å¯ç”¨æ­¤è„šæœ¬ä»Žæ¨¡æ¿å·¥ä½œåŒºåšæ‰¹é‡å¯¼å‡ºï¼š\n#ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ç™»å½•åŽï¼Œè¿›å…¥æ¨¡æ¿ä¸“åŒºï¼Œåœ¨æŽ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹è„šæœ¬å³å¯\n#db.forms.find({state:\"enabled\"}).forEach(function(form){window.open(Meteor.absoluteUrl(\"api/workflow/export/form?form=\"+form._id))})\nworkflowTemplate[\"zh-CN\"] =[]\n\nMeteor.startup ()->\n\tfs = require('fs')\n\tpath = require('path')\n\tmime = require('mime')\n\treadFileList = (pathDir, filesList)->\n\t\tfiles = fs.readdirSync(pathDir)\n\t\tfiles.forEach (name, index)->\n\t\t\tstat = fs.statSync(path.join(pathDir, name))\n\t\t\tif stat.isDirectory()\n\t\t\t\t# é€’å½’è¯»å–æ–‡ä»¶\n\t\t\t\treadFileList(path.join(pathDir, name), filesList)\n\t\t\telse\n\t\t\t\tobj = {}\n\t\t\t\tobj.path = pathDir\n\t\t\t\tobj.name = name\n\t\t\t\tfilesList.push(obj)\n\n\t#èŽ·å–zh-cnæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶\n\tfilesList_cn = []\n\tpath_cn = Meteor.settings.workflowTemplates?.path_cn\n\tif path_cn\n\t\tabsolute_path_cn = path.resolve(path_cn)\n\t\tconsole.log \"absolute_path_cn\", absolute_path_cn\n\t\tif fs.existsSync(absolute_path_cn)\n\t\t\treadFileList(absolute_path_cn, filesList_cn)\n\t\t\tfilesList_cn.forEach (file)->\n\t\t\t\ttry\n\t\t\t\t\tif mime.getType(file.name) is \"application/json\"\n\t\t\t\t\t\tdata = fs.readFileSync(path.join(file.path, file.name), 'utf8')\n\t\t\t\t\t\tworkflowTemplate[\"zh-CN\"].push(JSON.parse(data))\n\t\t\t\tcatch e\n\t\t\t\t\tconsole.error \"èŽ·å–zh-cnæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶\", path.join(file.path, file.name)\n\t\t\t\t\tconsole.error e.stack\n\n\t#èŽ·å–en-usæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶\n\tfilesList_us = []\n\tpath_us = Meteor.settings.workflowTemplates?.path_us\n\tif path_us\n\t\tabsolute_path_us = path.resolve(path_us)\n\t\tconsole.log \"absolute_path_us\", absolute_path_us\n\t\tif fs.existsSync(absolute_path_us)\n\t\t\treadFileList(absolute_path_us, filesList_us)\n\t\t\tfilesList_us.forEach (file)->\n\t\t\t\ttry\n\t\t\t\t\tif mime.getType(file.name) is \"application/json\"\n\t\t\t\t\t\tdata = fs.readFileSync(path.join(file.path, file.name), 'utf8')\n\t\t\t\t\t\tworkflowTemplate[\"en\"].push(JSON.parse(data))\n\t\t\t\tcatch e\n\t\t\t\t\tconsole.error \"èŽ·å–en-usæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶\", path.join(file.path, file.name)\n\t\t\t\t\tconsole.error e.stack\n\t\t\t\t\n\t\t\t\t\t\n\n\n","                     \n\nworkflowTemplate = {};\n\nworkflowTemplate[\"en\"] = [];\n\nworkflowTemplate[\"zh-CN\"] = [];\n\nMeteor.startup(function() {\n  var absolute_path_cn, absolute_path_us, filesList_cn, filesList_us, fs, mime, path, path_cn, path_us, readFileList, ref, ref1;\n  fs = require('fs');\n  path = require('path');\n  mime = require('mime');\n  readFileList = function(pathDir, filesList) {\n    var files;\n    files = fs.readdirSync(pathDir);\n    return files.forEach(function(name, index) {\n      var obj, stat;\n      stat = fs.statSync(path.join(pathDir, name));\n      if (stat.isDirectory()) {\n        return readFileList(path.join(pathDir, name), filesList);\n      } else {\n        obj = {};\n        obj.path = pathDir;\n        obj.name = name;\n        return filesList.push(obj);\n      }\n    });\n  };\n  filesList_cn = [];\n  path_cn = (ref = Meteor.settings.workflowTemplates) != null ? ref.path_cn : void 0;\n  if (path_cn) {\n    absolute_path_cn = path.resolve(path_cn);\n    console.log(\"absolute_path_cn\", absolute_path_cn);\n    if (fs.existsSync(absolute_path_cn)) {\n      readFileList(absolute_path_cn, filesList_cn);\n      filesList_cn.forEach(function(file) {\n        var data, e;\n        try {\n          if (mime.getType(file.name) === \"application/json\") {\n            data = fs.readFileSync(path.join(file.path, file.name), 'utf8');\n            return workflowTemplate[\"zh-CN\"].push(JSON.parse(data));\n          }\n        } catch (error) {\n          e = error;\n          console.error(\"èŽ·å–zh-cnæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶\", path.join(file.path, file.name));\n          return console.error(e.stack);\n        }\n      });\n    }\n  }\n  filesList_us = [];\n  path_us = (ref1 = Meteor.settings.workflowTemplates) != null ? ref1.path_us : void 0;\n  if (path_us) {\n    absolute_path_us = path.resolve(path_us);\n    console.log(\"absolute_path_us\", absolute_path_us);\n    if (fs.existsSync(absolute_path_us)) {\n      readFileList(absolute_path_us, filesList_us);\n      return filesList_us.forEach(function(file) {\n        var data, e;\n        try {\n          if (mime.getType(file.name) === \"application/json\") {\n            data = fs.readFileSync(path.join(file.path, file.name), 'utf8');\n            return workflowTemplate[\"en\"].push(JSON.parse(data));\n          }\n        } catch (error) {\n          e = error;\n          console.error(\"èŽ·å–en-usæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶\", path.join(file.path, file.name));\n          return console.error(e.stack);\n        }\n      });\n    }\n  }\n});\n","###\n*    *    *    *    *    *\nâ”¬    â”¬    â”¬    â”¬    â”¬    â”¬\nâ”‚    â”‚    â”‚    â”‚    â”‚    |\nâ”‚    â”‚    â”‚    â”‚    â”‚    â”” day of week (0 - 7) (0 or 7 is Sun)\nâ”‚    â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€ month (1 - 12)\nâ”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ day of month (1 - 31)\nâ”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ hour (0 - 23)\nâ”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ minute (0 - 59)\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ second (0 - 59, OPTIONAL)\n###\nMeteor.startup ->\n\tif Meteor.settings.cron?.auto_finish_process_delegation\n\t\tschedule = require('node-schedule')\n\t\t# å®šæ—¶æ‰§è¡ŒåŒæ­¥\n\t\trule = Meteor.settings.cron.auto_finish_process_delegation\n\t\tgo_next = true\n\t\tschedule.scheduleJob rule, Meteor.bindEnvironment ()->\n\t\t\ttry\n\t\t\t\tif !go_next\n\t\t\t\t\treturn\n\t\t\t\tgo_next = false\n\t\t\t\tconsole.time 'auto_finish_process_delegation'\n\n\t\t\t\tnow = new Date\n\n\t\t\t\t# å°†å§”æ‰˜è§„åˆ™è®¾ç½®ä¸ºä¸å¯ç”¨\n\t\t\t\tdb.process_delegation_rules.update({ enabled: true, end_time: { $lte: now } }, { $set: { enabled: false } }, { multi :true })\n\n\t\t\t\tconsole.timeEnd 'auto_finish_process_delegation'\n\t\t\t\tgo_next = true\n\n\t\t\tcatch e\n\t\t\t\tconsole.error \"AUTO AUTO_FINISH_PROCESS_DELEGATION ERROR: \"\n\t\t\t\tconsole.error e.stack\n\t\t\t\tgo_next = true\n\n\t\t, (e)->\n\t\t\tconsole.log 'Failed to bind environment: auto_finish_process_delegation.coffee'\n\t\t\tconsole.log e.stack\n","\n/*\n*    *    *    *    *    *\nâ”¬    â”¬    â”¬    â”¬    â”¬    â”¬\nâ”‚    â”‚    â”‚    â”‚    â”‚    |\nâ”‚    â”‚    â”‚    â”‚    â”‚    â”” day of week (0 - 7) (0 or 7 is Sun)\nâ”‚    â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€ month (1 - 12)\nâ”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ day of month (1 - 31)\nâ”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ hour (0 - 23)\nâ”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ minute (0 - 59)\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ second (0 - 59, OPTIONAL)\n */\nMeteor.startup(function() {\n  var go_next, ref, rule, schedule;\n  if ((ref = Meteor.settings.cron) != null ? ref.auto_finish_process_delegation : void 0) {\n    schedule = require('node-schedule');\n    rule = Meteor.settings.cron.auto_finish_process_delegation;\n    go_next = true;\n    return schedule.scheduleJob(rule, Meteor.bindEnvironment(function() {\n      var e, now;\n      try {\n        if (!go_next) {\n          return;\n        }\n        go_next = false;\n        console.time('auto_finish_process_delegation');\n        now = new Date;\n        db.process_delegation_rules.update({\n          enabled: true,\n          end_time: {\n            $lte: now\n          }\n        }, {\n          $set: {\n            enabled: false\n          }\n        }, {\n          multi: true\n        });\n        console.timeEnd('auto_finish_process_delegation');\n        return go_next = true;\n      } catch (error) {\n        e = error;\n        console.error(\"AUTO AUTO_FINISH_PROCESS_DELEGATION ERROR: \");\n        console.error(e.stack);\n        return go_next = true;\n      }\n    }, function(e) {\n      console.log('Failed to bind environment: auto_finish_process_delegation.coffee');\n      return console.log(e.stack);\n    }));\n  }\n});\n","###\n*    *    *    *    *    *\nâ”¬    â”¬    â”¬    â”¬    â”¬    â”¬\nâ”‚    â”‚    â”‚    â”‚    â”‚    |\nâ”‚    â”‚    â”‚    â”‚    â”‚    â”” day of week (0 - 7) (0 or 7 is Sun)\nâ”‚    â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€ month (1 - 12)\nâ”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ day of month (1 - 31)\nâ”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ hour (0 - 23)\nâ”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ minute (0 - 59)\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ second (0 - 59, OPTIONAL)\n###\nMeteor.startup ->\n\tif Meteor.settings.cron?.timeout_auto_submit\n\t\tschedule = require('node-schedule')\n\t\t# å®šæ—¶æ‰§è¡ŒåŒæ­¥\n\t\trule = Meteor.settings.cron.timeout_auto_submit\n\t\tgo_next = true\n\t\tschedule.scheduleJob rule, Meteor.bindEnvironment ()->\n\t\t\ttry\n\t\t\t\tif !go_next\n\t\t\t\t\treturn\n\t\t\t\tgo_next = false\n\t\t\t\tconsole.time 'timeout_auto_submit'\n\n\t\t\t\tuuflowManager.timeoutAutoSubmit()\n\n\t\t\t\tconsole.timeEnd 'timeout_auto_submit'\n\t\t\t\tgo_next = true\n\n\t\t\tcatch e\n\t\t\t\tconsole.error \"AUTO TIMEOUT_AUTO_SUBMIT ERROR: \"\n\t\t\t\tconsole.error e.stack\n\t\t\t\tgo_next = true\n\n\t\t, (e)->\n\t\t\tconsole.log 'Failed to bind environment: timeout_auto_submit.coffee'\n\t\t\tconsole.log e.stack\n\nMeteor.methods\n\ttimeout_auto_submit: (ins_id)->\n\t\tuuflowManager.timeoutAutoSubmit(ins_id)\n\t\treturn true\n\n\n","\n/*\n*    *    *    *    *    *\nâ”¬    â”¬    â”¬    â”¬    â”¬    â”¬\nâ”‚    â”‚    â”‚    â”‚    â”‚    |\nâ”‚    â”‚    â”‚    â”‚    â”‚    â”” day of week (0 - 7) (0 or 7 is Sun)\nâ”‚    â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€ month (1 - 12)\nâ”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ day of month (1 - 31)\nâ”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ hour (0 - 23)\nâ”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ minute (0 - 59)\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ second (0 - 59, OPTIONAL)\n */\nMeteor.startup(function() {\n  var go_next, ref, rule, schedule;\n  if ((ref = Meteor.settings.cron) != null ? ref.timeout_auto_submit : void 0) {\n    schedule = require('node-schedule');\n    rule = Meteor.settings.cron.timeout_auto_submit;\n    go_next = true;\n    return schedule.scheduleJob(rule, Meteor.bindEnvironment(function() {\n      var e;\n      try {\n        if (!go_next) {\n          return;\n        }\n        go_next = false;\n        console.time('timeout_auto_submit');\n        uuflowManager.timeoutAutoSubmit();\n        console.timeEnd('timeout_auto_submit');\n        return go_next = true;\n      } catch (error) {\n        e = error;\n        console.error(\"AUTO TIMEOUT_AUTO_SUBMIT ERROR: \");\n        console.error(e.stack);\n        return go_next = true;\n      }\n    }, function(e) {\n      console.log('Failed to bind environment: timeout_auto_submit.coffee');\n      return console.log(e.stack);\n    }));\n  }\n});\n\nMeteor.methods({\n  timeout_auto_submit: function(ins_id) {\n    uuflowManager.timeoutAutoSubmit(ins_id);\n    return true;\n  }\n});\n","Meteor.startup ()->\n\tTabularTables.related_instances_tabular = new Tabular.Table\n\t\tname: \"related_instances_tabular\"\n\t\tcollection: db.instances\n\t\tcolumns: [\n\t\t\t{\n\t\t\t\tdata: \"_id\",\n\t\t\t\ttitle: '<input type=\"checkbox\" name=\"reverse\" id=\"reverse\">',\n\t\t\t\torderable: false,\n\t\t\t\twidth: '1px',\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tinput = '<input type=\"checkbox\" class=\"related-instances-list-checkbox\" name=\"related_instances_ids\" id=\"related_instances_ids\" value=\"' + doc._id + '\"'\n\n\t\t\t\t\tif TabularTables.related_instances_tabular.related_instances?.includes(doc._id)\n\t\t\t\t\t\tinput += \" checked \"\n\n\t\t\t\t\tinput += \">\"\n\t\t\t\t\treturn input\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"name\",\n\t\t\t\torderable: false,\n\t\t\t\twidth: '45%',\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\thref = '';\n\t\t\t\t\tif Meteor.isClient && (Steedos.isMobile() || Steedos.isCordova())\n\t\t\t\t\t\thref = ''\n\n\t\t\t\t\tabsolute = false\n\n\t\t\t\t\tif Meteor.isServer\n\t\t\t\t\t\tabsolute = this.absolute\n\t\t\t\t\tif absolute\n\t\t\t\t\t\thref = Meteor.absoluteUrl(\"workflow/space/\"+doc.space+\"/view/readonly/\" + doc._id + '?hide_traces=0')\n\t\t\t\t\telse\n\t\t\t\t\t\thref = Steedos.absoluteUrl(\"workflow/space/\"+doc.space+\"/view/readonly/\" + doc._id + '?hide_traces=0')\n\t\t\t\t\treturn \"<a data-id='#{doc._id}' target='_blank' href='\"+href+\"'>\" + doc.name + \"</a>\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"applicant_name\",\n\t\t\t\ttitle: t(\"instances_applicant_name\"),\n\t\t\t\torderable: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"flow_name\",\n\t\t\t\ttitle: t(\"instances_flow\"),\n\t\t\t\torderable: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"current_step_name\",\n\t\t\t\ttitle: t(\"instances_flow\"),\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tif doc.state == \"completed\"\n\t\t\t\t\t\tjudge = doc.final_decision || \"approved\"\n\n\t\t\t\t\tstep_current_name = doc.current_step_name || ''\n\n\t\t\t\t\treturn \"\"\"\n\t\t\t\t\t\t\t<div class=\"step-current-state #{judge}\">#{step_current_name}</div>\n\t\t\t\t\t\t\"\"\"\n\t\t\t}\n\t\t]\n\n\t\tdom: \"tp\",\n\t\tlengthChange: false,\n\t\textraFields: [\"state\", \"final_decision\", \"space\", \"keywords\"],\n\t\tpageLength: 10,\n\t\tinfo: false,\n\t\tsearching: true,\n\t\tresponsive:\n\t\t\tdetails: false\n\t\tautoWidth: false,\n\t\tchangeSelector: (selector, userId) ->\n\t\t\tunless userId\n\t\t\t\treturn {_id: -1}\n\n\t\t\tspaceId = selector.space\n\t\t\tunless spaceId\n\t\t\t\tif selector?.$and?.length > 0\n\t\t\t\t\tspaceId = selector.$and.getProperty('space')[0]\n\t\t\tunless spaceId\n\t\t\t\treturn {_id: -1}\n\t\t\tspace = db.spaces.findOne(spaceId)\n\t\t\tif !space\n\t\t\t\tselector.state = \"none\"\n\t\t\tif !space.admins.includes(userId)\n\n\t\t\t\tflow_ids = []\n\t\t\t\tcurSpaceUser = db.space_users.findOne({\n\t\t\t\t\tspace: spaceId,\n\t\t\t\t\t'user': userId\n\t\t\t\t})\n\t\t\t\tif curSpaceUser\n\t\t\t\t\torganizations = db.organizations.find({\n\t\t\t\t\t\t_id: {\n\t\t\t\t\t\t\t$in: curSpaceUser.organizations\n\t\t\t\t\t\t}\n\t\t\t\t\t}).fetch()\n\t\t\t\t\tflows = db.flows.find({ space: spaceId })\n\t\t\t\t\tflows.forEach (fl)->\n\t\t\t\t\t\tif WorkflowManager.canMonitor(fl, curSpaceUser, organizations) || WorkflowManager.canAdmin(fl, curSpaceUser, organizations)\n\t\t\t\t\t\t\tflow_ids.push(fl._id)\n\n\t\t\t\tif selector?.$and?.length > 0\n\t\t\t\t\tselector.$and[0].$or = [{submitter: userId}, {applicant: userId}, {inbox_users: userId}, {outbox_users: userId},\n\t\t\t\t\t\t\t{cc_users: userId}, { flow: { $in: flow_ids } }]\n\t\t\t\telse\n\t\t\t\t\t_.extend selector, {\n\t\t\t\t\t\t$or: [{submitter: userId}, {applicant: userId}, {inbox_users: userId}, {outbox_users: userId},\n\t\t\t\t\t\t\t{cc_users: userId}, { flow: { $in: flow_ids } }]\n\t\t\t\t\t}\n\n\t\t\treturn selector","Meteor.startup(function() {\n  return TabularTables.related_instances_tabular = new Tabular.Table({\n    name: \"related_instances_tabular\",\n    collection: db.instances,\n    columns: [\n      {\n        data: \"_id\",\n        title: '<input type=\"checkbox\" name=\"reverse\" id=\"reverse\">',\n        orderable: false,\n        width: '1px',\n        render: function(val, type, doc) {\n          var input, ref;\n          input = '<input type=\"checkbox\" class=\"related-instances-list-checkbox\" name=\"related_instances_ids\" id=\"related_instances_ids\" value=\"' + doc._id + '\"';\n          if ((ref = TabularTables.related_instances_tabular.related_instances) != null ? ref.includes(doc._id) : void 0) {\n            input += \" checked \";\n          }\n          input += \">\";\n          return input;\n        }\n      }, {\n        data: \"name\",\n        orderable: false,\n        width: '45%',\n        render: function(val, type, doc) {\n          var absolute, href;\n          href = '';\n          if (Meteor.isClient && (Steedos.isMobile() || Steedos.isCordova())) {\n            href = '';\n          }\n          absolute = false;\n          if (Meteor.isServer) {\n            absolute = this.absolute;\n          }\n          if (absolute) {\n            href = Meteor.absoluteUrl(\"workflow/space/\" + doc.space + \"/view/readonly/\" + doc._id + '?hide_traces=0');\n          } else {\n            href = Steedos.absoluteUrl(\"workflow/space/\" + doc.space + \"/view/readonly/\" + doc._id + '?hide_traces=0');\n          }\n          return (\"<a data-id='\" + doc._id + \"' target='_blank' href='\") + href + \"'>\" + doc.name + \"</a>\";\n        }\n      }, {\n        data: \"applicant_name\",\n        title: t(\"instances_applicant_name\"),\n        orderable: false\n      }, {\n        data: \"flow_name\",\n        title: t(\"instances_flow\"),\n        orderable: false\n      }, {\n        data: \"current_step_name\",\n        title: t(\"instances_flow\"),\n        render: function(val, type, doc) {\n          var judge, step_current_name;\n          if (doc.state === \"completed\") {\n            judge = doc.final_decision || \"approved\";\n          }\n          step_current_name = doc.current_step_name || '';\n          return \"<div class=\\\"step-current-state \" + judge + \"\\\">\" + step_current_name + \"</div>\";\n        }\n      }\n    ],\n    dom: \"tp\",\n    lengthChange: false,\n    extraFields: [\"state\", \"final_decision\", \"space\", \"keywords\"],\n    pageLength: 10,\n    info: false,\n    searching: true,\n    responsive: {\n      details: false\n    },\n    autoWidth: false,\n    changeSelector: function(selector, userId) {\n      var curSpaceUser, flow_ids, flows, organizations, ref, ref1, space, spaceId;\n      if (!userId) {\n        return {\n          _id: -1\n        };\n      }\n      spaceId = selector.space;\n      if (!spaceId) {\n        if ((selector != null ? (ref = selector.$and) != null ? ref.length : void 0 : void 0) > 0) {\n          spaceId = selector.$and.getProperty('space')[0];\n        }\n      }\n      if (!spaceId) {\n        return {\n          _id: -1\n        };\n      }\n      space = db.spaces.findOne(spaceId);\n      if (!space) {\n        selector.state = \"none\";\n      }\n      if (!space.admins.includes(userId)) {\n        flow_ids = [];\n        curSpaceUser = db.space_users.findOne({\n          space: spaceId,\n          'user': userId\n        });\n        if (curSpaceUser) {\n          organizations = db.organizations.find({\n            _id: {\n              $in: curSpaceUser.organizations\n            }\n          }).fetch();\n          flows = db.flows.find({\n            space: spaceId\n          });\n          flows.forEach(function(fl) {\n            if (WorkflowManager.canMonitor(fl, curSpaceUser, organizations) || WorkflowManager.canAdmin(fl, curSpaceUser, organizations)) {\n              return flow_ids.push(fl._id);\n            }\n          });\n        }\n        if ((selector != null ? (ref1 = selector.$and) != null ? ref1.length : void 0 : void 0) > 0) {\n          selector.$and[0].$or = [\n            {\n              submitter: userId\n            }, {\n              applicant: userId\n            }, {\n              inbox_users: userId\n            }, {\n              outbox_users: userId\n            }, {\n              cc_users: userId\n            }, {\n              flow: {\n                $in: flow_ids\n              }\n            }\n          ];\n        } else {\n          _.extend(selector, {\n            $or: [\n              {\n                submitter: userId\n              }, {\n                applicant: userId\n              }, {\n                inbox_users: userId\n              }, {\n                outbox_users: userId\n              }, {\n                cc_users: userId\n              }, {\n                flow: {\n                  $in: flow_ids\n                }\n              }\n            ]\n          });\n        }\n      }\n      return selector;\n    }\n  });\n});\n","Steedos.subs[\"InstanceTabular\"] = new SubsManager()\n\n\n_handleListFields = (fields) ->\n\tins_fields = new Array();\n\n\tfields?.forEach (f)->\n\t\tif f.type == 'table'\n\t\t\tconsole.log 'ignore opinion field in table'\n\t\telse if f.type == 'section'\n\t\t\tf?.fields?.forEach (f1)->\n\t\t\t\tins_fields.push f1\n\t\telse\n\t\t\tins_fields.push f\n\n\treturn ins_fields\n\n\nupdateTabularTitle = ()->\n\n# å¦‚æžœcolumnsæœ‰åŠ å‡ï¼Œè¯·ä¿®æ”¹Template.instance_list._tableColumns å‡½æ•°\ninstancesListTableTabular = (flowId, fields)->\n\toptions = {\n\t\tname: \"instances\",\n\t\tcollection: db.instances,\n\t\tpub: \"instance_tabular\",\n\t\tonUnload: ()->\n\t\t\tMeteor.setTimeout(Template.instance_list._tableColumns, 150)\n\n\t\tdrawCallback: (settings)->\n\t\t\temptyTd = $(\".dataTables_empty\")\n\t\t\tif emptyTd.length\n\t\t\t\temptyTd[0].colSpan = \"6\"\n\t\t\tif !Steedos.isMobile() && !Steedos.isPad()\n\t\t\t\tMeteor.setTimeout(Template.instance_list._tableColumns, 150)\n\t\t\t\t$(\".instance-list\").scrollTop(0).ready ->\n\t\t\t\t\t$(\".instance-list\").perfectScrollbar(\"update\")\n\t\t\telse\n\t\t\t\t$(\".instance-list\").scrollTop(0)\n\n\t\t\ttitle = t \"pager_input_hint\"\n\t\t\tellipsisLink = settings.oInstance.parent().find('.paging_numbers .pagination .disabled a')\n\t\t\tellipsisLink.attr(\"title\", title).css(\"cursor\", \"pointer\").click ->\n\t\t\t\tif !$(this).find('input').length\n\t\t\t\t\tinput = $('<input class=\"paginate_input form-control input-sm\" type=\"text\" style=\"border: none; padding:0 2px;\"/>')\n\t\t\t\t\tif Steedos.isMobile()\n\t\t\t\t\t\tinput.css({\n\t\t\t\t\t\t\twidth:\"52px\"\n\t\t\t\t\t\t\theight: \"20px\"\n\t\t\t\t\t\t})\n\t\t\t\t\telse\n\t\t\t\t\t\tinput.css({\n\t\t\t\t\t\t\twidth:\"52px\"\n\t\t\t\t\t\t\theight: \"16px\"\n\t\t\t\t\t\t})\n\t\t\t\t\tinput.attr(\"title\", title).attr(\"placeholder\", title)\n\t\t\t\t\t$(this).empty().append input\n\t\t\t\t\tgoPage = (index)->\n\t\t\t\t\t\tif index > 0\n\t\t\t\t\t\t\tpages = Math.ceil(settings.fnRecordsDisplay() / settings._iDisplayLength)\n\t\t\t\t\t\t\tif index > pages\n\t\t\t\t\t\t\t\t# é¡µç è¶…å‡ºç´¢å¼•æ—¶è·³è½¬åˆ°æœ€åŽä¸€é¡µ\n\t\t\t\t\t\t\t\tindex = pages\n\t\t\t\t\t\t\tindex--\n\t\t\t\t\t\t\tsettings.oInstance.DataTable().page(index).draw('page')\n\t\t\t\t\tinput.blur (e)->\n\t\t\t\t\t\tcurrentPage = $(this).val()\n\t\t\t\t\t\tgoPage currentPage\n\t\t\t\t\t\t$(this).parent().html '...'\n\t\t\t\t\tinput.keydown (e)->\n\t\t\t\t\t\tif(e.keyCode.toString() == \"13\")\n\t\t\t\t\t\t\tcurrentPage = $(this).val()\n\t\t\t\t\t\t\tgoPage currentPage\n\n\t\tcreatedRow: (row, data, dataIndex) ->\n\t\t\tif Meteor.isClient\n\t\t\t\tif data._id == FlowRouter.current().params.instanceId\n\t\t\t\t\trow.setAttribute(\"class\", \"selected\")\n\t\tcolumns: [\n\t\t\t{\n\t\t\t\tdata: \"_id\",\n\t\t\t\torderable: false\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tmodifiedString = moment(doc.modified).format('YYYY-MM-DD');\n\n\t\t\t\t\tmodified = doc.modified\n\t\t\t\t\tif Session.get(\"box\") == 'inbox' && doc.state != 'draft'\n\t\t\t\t\t\tmodified = doc.start_date || doc.modified\n\n\t\t\t\t\tif Session.get(\"box\") == 'outbox' || Session.get(\"box\") == 'monitor'\n\t\t\t\t\t\tmodified = doc.submit_date || doc.submit_date\n\n\t\t\t\t\tmodifiedFromNow = Steedos.momentReactiveFromNow(modified);\n\t\t\t\t\tflow_name = doc.flow_name\n\t\t\t\t\tcc_view = \"\";\n\t\t\t\t\tstep_current_name_view = \"\";\n\t\t\t\t\t# å½“å‰ç”¨æˆ·åœ¨cc userä¸­ï¼Œä½†æ˜¯ä¸åœ¨inbox usersæ—¶æ‰æ˜¾ç¤º'ä¼ é˜…'æ–‡å­—\n\t\t\t\t\tif doc.is_cc && !doc.inbox_users?.includes(Meteor.userId()) && Session.get(\"box\") == 'inbox'\n\t\t\t\t\t\tcc_view = \"<label class='cc-label'>(\" + TAPi18n.__(\"instance_cc_title\") + \")</label> \"\n\t\t\t\t\t\tstep_current_name_view = \"<div class='flow-name'>#{flow_name}<span>(#{doc.current_step_name})</span></div>\"\n\t\t\t\t\telse\n\t\t\t\t\t\tif Session.get(\"box\") != 'draft' && doc.current_step_name\n\t\t\t\t\t\t\tstep_current_name_view = \"<div class='flow-name'>#{flow_name}<span>(#{doc.current_step_name})</span></div>\"\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tstep_current_name_view = \"<div class='flow-name'>#{flow_name}</div>\"\n\n\t\t\t\t\tagent_view = \"\";\n\t\t\t\t\tif doc.agent_user_name && Session.get(\"box\") == 'inbox'\n\t\t\t\t\t\tagent_view = \"<label class='cc-label'>(\" + TAPi18n.__('process_delegation_rules_description', {userName: doc.agent_user_name}) + \")</label>\"\n\n\t\t\t\t\tunread = ''\n\n\t\t\t\t\t# isFavoriteSelected = Favorites.isRecordSelected(\"instances\", doc._id)\n\t\t\t\t\t# if Favorites.isRecordSelected(\"instances\", doc._id)\n\t\t\t\t\t# \tunread = '<i class=\"ion ion-ios-star-outline instance-favorite-selected\"></i>'\n\t\t\t\t\t# else \n\t\t\t\t\tif Session.get(\"box\") == 'inbox' && doc.is_read == false\n\t\t\t\t\t\tunread = '<i class=\"ion ion-record unread\"></i>'\n\t\t\t\t\telse if Session.get(\"box\") == 'monitor' && doc.is_hidden == true\n\t\t\t\t\t\tunread = '<i class=\"fa fa-lock\"></i>'\n\n\t\t\t\t\tpriorityIcon = \"\"\n\t\t\t\t\tpriorityIconClass = \"\"\n\t\t\t\t\tpriorityValue = doc.values?.priority\n\t\t\t\t\tswitch priorityValue\n\t\t\t\t\t\twhen \"ç‰¹æ€¥\"\n\t\t\t\t\t\t\tpriorityIconClass = \"danger\"\n\t\t\t\t\t\twhen \"ç´§æ€¥\"\n\t\t\t\t\t\t\tpriorityIconClass = \"warning\"\n\t\t\t\t\t\twhen \"åŠžæ–‡\"\n\t\t\t\t\t\t\tpriorityIconClass = \"muted\"\n\t\t\t\t\tif priorityIconClass\n\t\t\t\t\t\tinstanceNamePriorityClass = \"color-priority color-priority-#{priorityIconClass}\"\n\n\t\t\t\t\treturn \"\"\"\n\t\t\t\t\t\t\t\t<div class='instance-read-bar'>#{unread}</div>\n\t\t\t\t\t\t\t\t<div class='instance-name #{instanceNamePriorityClass}'>#{doc.name}#{cc_view}#{agent_view}\n\t\t\t\t\t\t\t\t\t<span>#{doc.applicant_name}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class='instance-detail'>#{step_current_name_view}\n\t\t\t\t\t\t\t\t\t<span class='instance-modified' title='#{modifiedString}'>#{modifiedFromNow}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\"\"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"applicant_organization_name\",\n\t\t\t\ttitle: t(\"instances_applicant_organization_name\"),\n\t\t\t\tvisible: false,\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"name\",\n\t\t\t\ttitle: t(\"instances_name\"),\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tcc_view = \"\";\n\t\t\t\t\tstep_current_name_view = \"\";\n\t\t\t\t\t# å½“å‰ç”¨æˆ·åœ¨cc userä¸­ï¼Œä½†æ˜¯ä¸åœ¨inbox usersæ—¶æ‰æ˜¾ç¤º'ä¼ é˜…'æ–‡å­—\n\t\t\t\t\tif doc.is_cc && !doc.inbox_users?.includes(Meteor.userId()) && Session.get(\"box\") == 'inbox'\n\t\t\t\t\t\tcc_view = \"<label class='cc-label'>(\" + TAPi18n.__(\"instance_cc_title\") + \")</label> \"\n\n\t\t\t\t\tagent_view = \"\";\n\t\t\t\t\tif doc.agent_user_name\n\t\t\t\t\t\tagent_view = \"<label class='cc-label'>(\" + TAPi18n.__('process_delegation_rules_description', {userName: doc.agent_user_name}) + \")</label>\"\n\n\t\t\t\t\tunread = ''\n\n\t\t\t\t\tif Session.get(\"box\") == 'inbox' && doc.is_read == false\n\t\t\t\t\t\tunread = '<i class=\"ion ion-record unread\"></i>'\n\t\t\t\t\telse if Session.get(\"box\") == 'monitor' && doc.is_hidden == true\n\t\t\t\t\t\tunread = '<i class=\"fa fa-lock\"></i>'\n\n\t\t\t\t\tpriorityIconClass = \"\"\n\t\t\t\t\tpriorityValue = doc.values?.priority\n\t\t\t\t\tswitch priorityValue\n\t\t\t\t\t\twhen \"ç‰¹æ€¥\"\n\t\t\t\t\t\t\tpriorityIconClass = \"danger\"\n\t\t\t\t\t\twhen \"ç´§æ€¥\"\n\t\t\t\t\t\t\tpriorityIconClass = \"warning\"\n\t\t\t\t\t\twhen \"åŠžæ–‡\"\n\t\t\t\t\t\t\tpriorityIconClass = \"muted\"\n\t\t\t\t\tif priorityIconClass\n\t\t\t\t\t\tinstanceNamePriorityClass = \"color-priority color-priority-#{priorityIconClass}\"\n\t\t\t\t\treturn \"\"\"\n\t\t\t\t\t\t\t<div class='instance-read-bar'>#{unread}</div>\n\t\t\t\t\t\t\t<div class='instance-name #{instanceNamePriorityClass}'>#{doc.name}#{cc_view}#{agent_view}</div>\n\t\t\t\t\t\t\"\"\"\n\t\t\t\tvisible: false,\n\t\t\t\torderable: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"applicant_name\",\n\t\t\t\ttitle: t(\"instances_applicant_name\"),\n\t\t\t\tvisible: false,\n\t\t\t\torderable: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"submit_date\",\n\t\t\t\ttitle: t(\"instances_submit_date\"),\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tif doc.submit_date\n\t\t\t\t\t\treturn moment(doc.submit_date).format('YYYY-MM-DD HH:mm');\n\t\t\t\t,\n\t\t\t\tvisible: false,\n\t\t\t\torderable: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"flow_name\",\n\t\t\t\ttitle: t(\"instances_flow\"),\n\t\t\t\tvisible: false,\n\t\t\t\torderable: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"current_step_name\",\n\t\t\t\ttitle: t(\"instances_step_current_name\"),\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tif doc.state == \"completed\"\n\t\t\t\t\t\tjudge = doc.final_decision || \"approved\"\n\n\t\t\t\t\tstep_current_name = doc.current_step_name || ''\n\n\t\t\t\t\tcc_tag = ''\n\n\t\t\t\t\tif doc.cc_count > 0\n\t\t\t\t\t\tcc_tag = TAPi18n.__('cc_tag')\n\n\t\t\t\t\treturn \"\"\"\n\t\t\t\t\t\t<div class=\"step-current-state #{judge}\">#{step_current_name}#{cc_tag}</div>\n\t\t\t\t\t\"\"\"\n\t\t\t\tvisible: false,\n\t\t\t\torderable: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"modified\",\n\t\t\t\ttitle: t(\"instances_modified\"),\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\treturn moment(doc.modified).format('YYYY-MM-DD HH:mm');\n\t\t\t\t,\n\t\t\t\tvisible: false,\n\t\t\t\torderable: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"start_date\",\n\t\t\t\ttitle: t(\"instances_start_date\"),\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tif doc.start_date\n\t\t\t\t\t\treturn moment(doc.start_date).format('YYYY-MM-DD HH:mm');\n\t\t\t\t,\n\t\t\t\tvisible: false,\n\t\t\t\torderable: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"my_finish_date\",\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tif doc.my_finish_date\n\t\t\t\t\t\treturn moment(doc.my_finish_date).format('YYYY-MM-DD HH:mm');\n\t\t\t\t,\n\t\t\t\tvisible: false,\n\t\t\t\torderable: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"modified\",\n\t\t\t\tvisible: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"keywords\",\n\t\t\t\tvisible: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"is_archived\",\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tif doc?.values?.record_need && doc.values.record_need == \"true\"\n\t\t\t\t\t\tif doc?.is_archived\n\t\t\t\t\t\t\treturn t(\"YES\")\n\t\t\t\t\t\treturn t(\"NO\")\n\t\t\t\tvisible: false\n\t\t\t\torderable: false\n\t\t\t}\n\t\t],\n\t\tdom: do ->\n\t\t\t# æ‰‹æœºä¸Šä¸æ˜¾ç¤ºä¸€é¡µæ˜¾ç¤ºå¤šå°‘æ¡è®°å½•é€‰é¡¹\n\t\t\tif Steedos.isMobile()\n\t\t\t\t'tp'\n\t\t\telse\n\t\t\t\t'tpl'\n\t\torder: [[4, \"desc\"]],\n\t\textraFields: [\"form\", \"flow\", \"inbox_users\", \"state\", \"space\", \"applicant\", \"form_version\",\n\t\t\t\"flow_version\", \"is_cc\", \"cc_count\", \"is_read\", \"current_step_name\", \"values\", \"keywords\", \"final_decision\", \"flow_name\", \"is_hidden\", \"agent_user_name\"],\n\t\tlengthChange: true,\n\t\tlengthMenu: [10,15,20,25,50,100],\n\t\tpageLength: 10,\n\t\tinfo: false,\n\t\tsearching: true,\n\t\tresponsive:\n\t\t\tdetails: false\n\t\tautoWidth: false,\n\t\tchangeSelector: (selector, userId) ->\n\t\t\tunless userId\n\t\t\t\treturn {_id: -1}\n\t\t\tspace = selector.space\n\t\t\tunless space\n\t\t\t\tif selector?.$and?.length > 0\n\t\t\t\t\tspace = selector.$and.getProperty('space')[0]\n\t\t\tunless space\n\t\t\t\treturn {_id: -1}\n\t\t\tspace_user = db.space_users.findOne({user: userId, space: space}, {fields: {_id: 1}})\n\t\t\tunless space_user\n\t\t\t\treturn {_id: -1}\n\t\t\treturn selector\n\t\tpagingType: \"numbers\"\n\t\t\n\t\t# getSort: (selector, sort) -> \n\t\t# \tconsole.log('selector:',selector)\n\t\t# \tconsole.log('sort:',sort)\n\t\t# \tnewSort = []\n\t\t# \t_.each selector, (v, k) ->\n\t\t# \t\tnewSort.push([k, 1])\n\t\t# \tnewSort = newSort.concat(sort)\n\t\t# \tconsole.log('newSort:',newSort)\n\t\t# \treturn newSort\n\t}\n\n\tif flowId\n\t\tkey = \"instanceFlow\" + flowId\n\n\t\toptions.name = key\n\n\t\tTabularTables.instances.fields = fields\n\n\t\tins_fields = _handleListFields TabularTables.instances.fields\n\n\t\tins_fields.forEach (f)->\n\t\t\tif f.type != 'table' && f.is_list_display\n\t\t\t\toptions.columns.push\n\t\t\t\t\tdata: (f.name || f.code),\n\t\t\t\t\ttitle: t(f.name || f.code),\n\t\t\t\t\tvisible: false,\n\t\t\t\t\torderable: false\n\t\t\t\t\trender: (val, type, doc) ->\n\n\t\t\t\t\t\tvalues = doc.values || {}\n\n\t\t\t\t\t\tvalue = values[f.code]\n\n\t\t\t\t\t\tswitch f.type\n\t\t\t\t\t\t\twhen 'user'\n\t\t\t\t\t\t\t\tvalue = value?.name\n\t\t\t\t\t\t\twhen 'group'\n\t\t\t\t\t\t\t\tvalue = value?.fullname\n\t\t\t\t\t\t\twhen 'date'\n\t\t\t\t\t\t\t\tif value\n\t\t\t\t\t\t\t\t\tvalue = moment(value).format('YYYY-MM-DD')\n\t\t\t\t\t\t\twhen 'dateTime'\n\t\t\t\t\t\t\t\tif value\n\t\t\t\t\t\t\t\t\tvalue = moment(value).format('YYYY-MM-DD HH:mm')\n\t\t\t\t\t\t\twhen 'checkbox'\n\t\t\t\t\t\t\t\tif value == true || value == 'true'\n\t\t\t\t\t\t\t\t\tvalue = TAPi18n.__(\"form_field_checkbox_yes\");\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tvalue = TAPi18n.__(\"form_field_checkbox_no\");\n\t\t\t\t\t\t\twhen 'odata'\n\t\t\t\t\t\t\t\tif value\n\t\t\t\t\t\t\t\t\tif _.isArray(value)\n\t\t\t\t\t\t\t\t\t\tvalue = _.pluck(value, '@label').toString()\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\tvalue = value['@label']\n\n\t\t\t\t\t\treturn value\n\n\n\treturn options;\n\n\n# å¦‚æžœcolumnsæœ‰åŠ å‡ï¼Œè¯·ä¿®æ”¹Template.instance_list._tableColumns å‡½æ•°\ninstanceTasksListTableTabular = (flowId, fields)->\n\toptions = {\n\t\tname: \"instance_tasks\",\n\t\tcollection: db.instance_tasks,\n\t\tpub: \"instance_tasks_tabular\",\n\t\tonUnload: ()->\n\t\t\tMeteor.setTimeout(Template.instance_list._tableColumns, 150)\n\n\t\tdrawCallback: (settings)->\n\t\t\temptyTd = $(\".dataTables_empty\")\n\t\t\tif emptyTd.length\n\t\t\t\temptyTd[0].colSpan = \"6\"\n\t\t\tif !Steedos.isMobile() && !Steedos.isPad()\n\t\t\t\tMeteor.setTimeout(Template.instance_list._tableColumns, 150)\n\t\t\t\t$(\".instance-list\").scrollTop(0).ready ->\n\t\t\t\t\t$(\".instance-list\").perfectScrollbar(\"update\")\n\t\t\telse\n\t\t\t\t$(\".instance-list\").scrollTop(0)\n\n\t\t\ttitle = t \"pager_input_hint\"\n\t\t\tellipsisLink = settings.oInstance.parent().find('.paging_numbers .pagination .disabled a')\n\t\t\tellipsisLink.attr(\"title\", title).css(\"cursor\", \"pointer\").click ->\n\t\t\t\tif !$(this).find('input').length\n\t\t\t\t\tinput = $('<input class=\"paginate_input form-control input-sm\" type=\"text\" style=\"border: none; padding:0 2px;\"/>')\n\t\t\t\t\tif Steedos.isMobile()\n\t\t\t\t\t\tinput.css({\n\t\t\t\t\t\t\twidth:\"52px\"\n\t\t\t\t\t\t\theight: \"20px\"\n\t\t\t\t\t\t})\n\t\t\t\t\telse\n\t\t\t\t\t\tinput.css({\n\t\t\t\t\t\t\twidth:\"52px\"\n\t\t\t\t\t\t\theight: \"16px\"\n\t\t\t\t\t\t})\n\t\t\t\t\tinput.attr(\"title\", title).attr(\"placeholder\", title)\n\t\t\t\t\t$(this).empty().append input\n\t\t\t\t\tgoPage = (index)->\n\t\t\t\t\t\tif index > 0\n\t\t\t\t\t\t\tpages = Math.ceil(settings.fnRecordsDisplay() / settings._iDisplayLength)\n\t\t\t\t\t\t\tif index > pages\n\t\t\t\t\t\t\t\t# é¡µç è¶…å‡ºç´¢å¼•æ—¶è·³è½¬åˆ°æœ€åŽä¸€é¡µ\n\t\t\t\t\t\t\t\tindex = pages\n\t\t\t\t\t\t\tindex--\n\t\t\t\t\t\t\tsettings.oInstance.DataTable().page(index).draw('page')\n\t\t\t\t\tinput.blur (e)->\n\t\t\t\t\t\tcurrentPage = $(this).val()\n\t\t\t\t\t\tgoPage currentPage\n\t\t\t\t\t\t$(this).parent().html '...'\n\t\t\t\t\tinput.keydown (e)->\n\t\t\t\t\t\tif(e.keyCode.toString() == \"13\")\n\t\t\t\t\t\t\tcurrentPage = $(this).val()\n\t\t\t\t\t\t\tgoPage currentPage\n\n\t\tcreatedRow: (row, data, dataIndex) ->\n\t\t\tif Meteor.isClient\n\t\t\t\tif data.instance == FlowRouter.current().params.instanceId\n\t\t\t\t\trow.setAttribute(\"class\", \"selected\")\n\t\tcolumns: [\n\t\t\t{\n\t\t\t\tdata: \"_id\",\n\t\t\t\torderable: false\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tmodifiedString = moment(doc.modified).format('YYYY-MM-DD');\n\n\t\t\t\t\tmodified = doc.modified\n\t\t\t\t\tif Session.get(\"box\") == 'inbox' && doc.instance_state != 'draft'\n\t\t\t\t\t\tmodified = doc.start_date || doc.modified\n\n\t\t\t\t\tif Session.get(\"box\") == 'outbox'\n\t\t\t\t\t\tmodified = doc.submit_date || doc.modified\n\n\t\t\t\t\tmodifiedFromNow = Steedos.momentReactiveFromNow(modified);\n\t\t\t\t\tflow_name = doc.flow_name\n\t\t\t\t\tcc_view = \"\";\n\t\t\t\t\tstep_current_name_view = \"\";\n\t\t\t\t\t# å½“å‰ç”¨æˆ·åœ¨cc userä¸­ï¼Œä½†æ˜¯ä¸åœ¨inbox usersæ—¶æ‰æ˜¾ç¤º'ä¼ é˜…'æ–‡å­—\n\t\t\t\t\tif doc.type == 'cc' && Session.get(\"box\") == 'inbox'\n\t\t\t\t\t\tcc_view = \"<label class='cc-label'>(\" + TAPi18n.__(\"instance_cc_title\") + \")</label> \"\n\t\t\t\t\t\tstep_current_name_view = \"<div class='flow-name'>#{flow_name}<span>(#{doc.step_name})</span></div>\"\n\t\t\t\t\telse\n\t\t\t\t\t\tif doc.step_name\n\t\t\t\t\t\t\tstep_current_name_view = \"<div class='flow-name'>#{flow_name}<span>(#{doc.step_name})</span></div>\"\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tstep_current_name_view = \"<div class='flow-name'>#{flow_name}</div>\"\n\n\t\t\t\t\tagent_view = \"\";\n\t\t\t\t\tif doc.agent_user_name && Session.get(\"box\") == 'inbox'\n\t\t\t\t\t\tagent_view = \"<label class='cc-label'>(\" + TAPi18n.__('process_delegation_rules_description', {userName: doc.agent_user_name}) + \")</label>\"\n\n\t\t\t\t\tunread = ''\n\n\t\t\t\t\tif Session.get(\"box\") == 'inbox' && doc.is_read == false\n\t\t\t\t\t\tunread = '<i class=\"ion ion-record unread\"></i>'\n\t\t\t\t\telse if Session.get(\"box\") == 'monitor' && doc.is_hidden == true\n\t\t\t\t\t\tunread = '<i class=\"fa fa-lock\"></i>'\n\n\t\t\t\t\tpriorityIcon = \"\"\n\t\t\t\t\tpriorityIconClass = \"\"\n\t\t\t\t\tpriorityValue = doc.values?.priority\n\t\t\t\t\tswitch priorityValue\n\t\t\t\t\t\twhen \"ç‰¹æ€¥\"\n\t\t\t\t\t\t\tpriorityIconClass = \"danger\"\n\t\t\t\t\t\twhen \"ç´§æ€¥\"\n\t\t\t\t\t\t\tpriorityIconClass = \"warning\"\n\t\t\t\t\t\twhen \"åŠžæ–‡\"\n\t\t\t\t\t\t\tpriorityIconClass = \"muted\"\n\t\t\t\t\tif priorityIconClass\n\t\t\t\t\t\tinstanceNamePriorityClass = \"color-priority color-priority-#{priorityIconClass}\"\n\n\t\t\t\t\treturn \"\"\"\n\t\t\t\t\t\t\t\t<div class='instance-read-bar'>#{unread}</div>\n\t\t\t\t\t\t\t\t<div class='instance-name #{instanceNamePriorityClass}'>#{doc.instance_name}#{cc_view}#{agent_view}\n\t\t\t\t\t\t\t\t\t<span>#{doc.applicant_name}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class='instance-detail'>#{step_current_name_view}\n\t\t\t\t\t\t\t\t\t<span class='instance-modified' title='#{modifiedString}'>#{modifiedFromNow}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\"\"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"applicant_organization_name\",\n\t\t\t\ttitle: t(\"instances_applicant_organization_name\"),\n\t\t\t\tvisible: false,\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"instance_name\",\n\t\t\t\ttitle: t(\"instances_name\"),\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tcc_view = \"\";\n\t\t\t\t\tstep_current_name_view = \"\";\n\t\t\t\t\t# å½“å‰ç”¨æˆ·åœ¨cc userä¸­ï¼Œä½†æ˜¯ä¸åœ¨inbox usersæ—¶æ‰æ˜¾ç¤º'ä¼ é˜…'æ–‡å­—\n\t\t\t\t\tif doc.is_cc && !doc.inbox_users?.includes(Meteor.userId()) && Session.get(\"box\") == 'inbox'\n\t\t\t\t\t\tcc_view = \"<label class='cc-label'>(\" + TAPi18n.__(\"instance_cc_title\") + \")</label> \"\n\n\t\t\t\t\tagent_view = \"\";\n\t\t\t\t\tif doc.agent_user_name\n\t\t\t\t\t\tagent_view = \"<label class='cc-label'>(\" + TAPi18n.__('process_delegation_rules_description', {userName: doc.agent_user_name}) + \")</label>\"\n\n\t\t\t\t\tunread = ''\n\n\t\t\t\t\tif Session.get(\"box\") == 'inbox' && doc.is_read == false\n\t\t\t\t\t\tunread = '<i class=\"ion ion-record unread\"></i>'\n\t\t\t\t\telse if Session.get(\"box\") == 'monitor' && doc.is_hidden == true\n\t\t\t\t\t\tunread = '<i class=\"fa fa-lock\"></i>'\n\n\t\t\t\t\tpriorityIconClass = \"\"\n\t\t\t\t\tpriorityValue = doc.values?.priority\n\t\t\t\t\tswitch priorityValue\n\t\t\t\t\t\twhen \"ç‰¹æ€¥\"\n\t\t\t\t\t\t\tpriorityIconClass = \"danger\"\n\t\t\t\t\t\twhen \"ç´§æ€¥\"\n\t\t\t\t\t\t\tpriorityIconClass = \"warning\"\n\t\t\t\t\t\twhen \"åŠžæ–‡\"\n\t\t\t\t\t\t\tpriorityIconClass = \"muted\"\n\t\t\t\t\tif priorityIconClass\n\t\t\t\t\t\tinstanceNamePriorityClass = \"color-priority color-priority-#{priorityIconClass}\"\n\t\t\t\t\treturn \"\"\"\n\t\t\t\t\t\t\t<div class='instance-read-bar'>#{unread}</div>\n\t\t\t\t\t\t\t<div class='instance-name #{instanceNamePriorityClass}'>#{doc.instance_name}#{cc_view}#{agent_view}</div>\n\t\t\t\t\t\t\"\"\"\n\t\t\t\tvisible: false,\n\t\t\t\torderable: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"applicant_name\",\n\t\t\t\ttitle: t(\"instances_applicant_name\"),\n\t\t\t\tvisible: false,\n\t\t\t\torderable: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"submit_date\",\n\t\t\t\ttitle: t(\"instances_submit_date\"),\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tif doc.submit_date\n\t\t\t\t\t\treturn moment(doc.submit_date).format('YYYY-MM-DD HH:mm');\n\t\t\t\t,\n\t\t\t\tvisible: false,\n\t\t\t\torderable: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"flow_name\",\n\t\t\t\ttitle: t(\"instances_flow\"),\n\t\t\t\tvisible: false,\n\t\t\t\torderable: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"step_name\",\n\t\t\t\ttitle: t(\"instances_step_current_name\"),\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tif doc.instance_state == \"completed\"\n\t\t\t\t\t\tjudge = doc.judge || \"approved\"\n\n\t\t\t\t\tstep_current_name = doc.step_name || ''\n\n\t\t\t\t\tcc_tag = ''\n\n\t\t\t\t\tif doc.cc_count > 0\n\t\t\t\t\t\tcc_tag = TAPi18n.__('cc_tag')\n\n\t\t\t\t\treturn \"\"\"\n\t\t\t\t\t\t<div class=\"step-current-state #{judge}\">#{step_current_name}#{cc_tag}</div>\n\t\t\t\t\t\"\"\"\n\t\t\t\tvisible: false,\n\t\t\t\torderable: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"modified\",\n\t\t\t\ttitle: t(\"instances_modified\"),\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\treturn moment(doc.modified).format('YYYY-MM-DD HH:mm');\n\t\t\t\t,\n\t\t\t\tvisible: false,\n\t\t\t\torderable: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"start_date\",\n\t\t\t\ttitle: t(\"instances_start_date\"),\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tif doc.start_date\n\t\t\t\t\t\treturn moment(doc.start_date).format('YYYY-MM-DD HH:mm');\n\t\t\t\t,\n\t\t\t\tvisible: false,\n\t\t\t\torderable: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"finish_date\",\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tif doc.finish_date\n\t\t\t\t\t\treturn moment(doc.finish_date).format('YYYY-MM-DD HH:mm');\n\t\t\t\t,\n\t\t\t\tvisible: false,\n\t\t\t\torderable: true\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"modified\",\n\t\t\t\tvisible: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"keywords\",\n\t\t\t\tvisible: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tdata: \"is_archived\",\n\t\t\t\trender: (val, type, doc) ->\n\t\t\t\t\tif doc?.values?.record_need && doc.values.record_need == \"true\"\n\t\t\t\t\t\tif doc?.is_archived\n\t\t\t\t\t\t\treturn t(\"YES\")\n\t\t\t\t\t\treturn t(\"NO\")\n\t\t\t\tvisible: false\n\t\t\t\torderable: false\n\t\t\t}\n\t\t],\n\t\tdom: do ->\n\t\t\t# æ‰‹æœºä¸Šä¸æ˜¾ç¤ºä¸€é¡µæ˜¾ç¤ºå¤šå°‘æ¡è®°å½•é€‰é¡¹\n\t\t\tif Steedos.isMobile()\n\t\t\t\t'tp'\n\t\t\telse\n\t\t\t\t'tpl'\n\t\torder: [[4, \"desc\"]],\n\t\textraFields: [\"instance\", \"form\", \"flow\", \"inbox_users\", \"instance_state\", \"space\", \"applicant\", \"form_version\",\n\t\t\t\"flow_version\", \"type\", \"is_read\", \"step_name\", \"values\", \"keywords\", \"final_decision\", \"flow_name\", \"is_hidden\", \"agent_user_name\"],\n\t\tlengthChange: true,\n\t\tlengthMenu: [10,15,20,25,50,100],\n\t\tpageLength: 10,\n\t\tinfo: false,\n\t\tsearching: true,\n\t\tresponsive:\n\t\t\tdetails: false\n\t\tautoWidth: false,\n\t\tchangeSelector: (selector, userId) ->\n\t\t\tunless userId\n\t\t\t\treturn {_id: -1}\n\t\t\tspace = selector.space\n\t\t\tunless space\n\t\t\t\tif selector?.$and?.length > 0\n\t\t\t\t\tspace = selector.$and.getProperty('space')[0]\n\t\t\tunless space\n\t\t\t\treturn {_id: -1}\n\t\t\tspace_user = db.space_users.findOne({user: userId, space: space}, {fields: {_id: 1}})\n\t\t\tunless space_user\n\t\t\t\treturn {_id: -1}\n\t\t\treturn selector\n\t\tpagingType: \"numbers\"\n\n\t}\n\n\tif flowId\n\t\tkey = \"instanceFlow\" + flowId\n\n\t\toptions.name = key\n\n\t\tTabularTables.instance_tasks.fields = fields\n\n\t\tins_fields = _handleListFields TabularTables.instance_tasks.fields\n\n\t\tins_fields.forEach (f)->\n\t\t\tif f.type != 'table' && f.is_list_display\n\t\t\t\toptions.columns.push\n\t\t\t\t\tdata: (f.name || f.code),\n\t\t\t\t\ttitle: t(f.name || f.code),\n\t\t\t\t\tvisible: false,\n\t\t\t\t\torderable: false\n\t\t\t\t\trender: (val, type, doc) ->\n\n\t\t\t\t\t\tvalues = doc.values || {}\n\n\t\t\t\t\t\tvalue = values[f.code]\n\n\t\t\t\t\t\tswitch f.type\n\t\t\t\t\t\t\twhen 'user'\n\t\t\t\t\t\t\t\tvalue = value?.name\n\t\t\t\t\t\t\twhen 'group'\n\t\t\t\t\t\t\t\tvalue = value?.fullname\n\t\t\t\t\t\t\twhen 'date'\n\t\t\t\t\t\t\t\tif value\n\t\t\t\t\t\t\t\t\tvalue = moment(value).format('YYYY-MM-DD')\n\t\t\t\t\t\t\twhen 'dateTime'\n\t\t\t\t\t\t\t\tif value\n\t\t\t\t\t\t\t\t\tvalue = moment(value).format('YYYY-MM-DD HH:mm')\n\t\t\t\t\t\t\twhen 'checkbox'\n\t\t\t\t\t\t\t\tif value == true || value == 'true'\n\t\t\t\t\t\t\t\t\tvalue = TAPi18n.__(\"form_field_checkbox_yes\");\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tvalue = TAPi18n.__(\"form_field_checkbox_no\");\n\t\t\t\t\t\t\twhen 'odata'\n\t\t\t\t\t\t\t\tif value\n\t\t\t\t\t\t\t\t\tif _.isArray(value)\n\t\t\t\t\t\t\t\t\t\tvalue = _.pluck(value, '@label').toString()\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\tvalue = value['@label']\n\n\t\t\t\t\t\treturn value\n\n\n\treturn options;\n\n\nMeteor.startup ()->\n\tTabularTables.instances = new Tabular.Table instancesListTableTabular()\n\tTabularTables.instance_tasks = new Tabular.Table instanceTasksListTableTabular()\n\tTabularTables.inbox_instances = new Tabular.Table GetBoxInstancesTabularOptions(\"inbox\")\n\tTabularTables.outbox_instances = new Tabular.Table GetBoxInstancesTabularOptions(\"outbox\")\n\n\nGetBoxInstancesTabularOptions = (box, flowId, fields)->\n\tkey = \"instanceFlow\" + box + flowId\n\tif box == \"inbox\"\n\t\toptions = _get_inbox_instances_tabular_options(flowId, fields)\n\telse if box == \"outbox\"\n\t\toptions = _get_outbox_instances_tabular_options(flowId, fields)\n\telse\n\t\toptions = instancesListTableTabular(flowId, fields)\n\t\tif !flowId\n\t\t\toptions.name = \"inbox_instances\"\n\tif flowId\n\t\toptions.name = key\n\treturn options\n\n_get_inbox_instances_tabular_options = (flowId, fields)->\n\toptions = instanceTasksListTableTabular(flowId, fields)\n\n\tif !flowId\n\t\toptions.name = \"inbox_instances\"\n\n\toptions.order = [[8, \"desc\"]]\n\n\toptions.getSort = (selector, sort) -> \n\t\tconsole.log('inbox_instances:',sort)\n\t\treturn sort\n\n\treturn options\n\n_get_outbox_instances_tabular_options = (flowId, fields)->\n\toptions = instanceTasksListTableTabular(flowId, fields)\n\n\tif !flowId\n\t\toptions.name = \"outbox_instances\"\n\n\toptions.order = [[9, -1]]\n\n\toptions.getSort = (selector, sort) -> \n\t\tconsole.log('outbox_instances:',sort)\n\t\t# newSort = [ \n\t\t# \t['space', 1],\n\t\t# \t['handler', 1],\n\t\t# \t['is_finished', 1],\n\t\t# ]\n\t\t# newSort = newSort.concat(sort)\n\t\t# return newSort\n\t\treturn sort\n\n\treturn options\n\nif Meteor.isClient\n\tTabularTables.flowInstances = new ReactiveVar()\n\nMeteor.startup ()->\n\tTracker.autorun (c) ->\n\t\tif Meteor.isClient && !Steedos.isMobile()\n\t\t\tif Session.get(\"flowId\") && Session.get(\"box\") != 'draft'\n\t\t\t\tMeteor.call \"newInstancesListTabular\", Session.get(\"box\"), Session.get(\"flowId\"), (error, result) ->\n\t\t\t\t\tnewInstancesListTabular Session.get(\"box\"), Session.get(\"flowId\"), result\n\t\t\t\t\tTemplate.instance_list._changeOrder()\n\n\nnewInstancesListTabular = (box, flowId, fields)->\n\tif !fields\n\t\tflow = db.flows.findOne({_id: flowId}, {fields: {form: 1}})\n\t\tfields = db.forms.findOne({ _id: flow?.form }, { fields: { 'current.fields': 1 } })?.current?.fields\n\n\tfields = _handleListFields fields\n\n\tif fields?.filterProperty(\"is_list_display\", true)?.length > 0\n\t\tkey = \"instanceFlow\" + box + flowId\n\t\tif Meteor.isClient\n\t\t\tTabularTables.flowInstances.set(new Tabular.Table GetBoxInstancesTabularOptions(box, flowId, fields))\n\t\telse\n\t\t\tnew Tabular.Table GetBoxInstancesTabularOptions(box, flowId, fields)\n\t\tconsole.log \"new TabularTables \", key\n\nif Meteor.isServer\n\tMeteor.methods\n\t\tnewInstancesListTabular: (box, flowId)->\n\t\t\tnewInstancesListTabular(box, flowId)\n\n\t\t\tflow = db.flows.findOne({_id: flowId}, {fields: {form: 1}})\n\t\t\tfields = db.forms.findOne({ _id: flow?.form }, { fields: { 'current.fields': 1 } })?.current?.fields\n\t\t\treturn fields\n\n\n","var GetBoxInstancesTabularOptions, _get_inbox_instances_tabular_options, _get_outbox_instances_tabular_options, _handleListFields, instanceTasksListTableTabular, instancesListTableTabular, newInstancesListTabular, updateTabularTitle;\n\nSteedos.subs[\"InstanceTabular\"] = new SubsManager();\n\n_handleListFields = function(fields) {\n  var ins_fields;\n  ins_fields = new Array();\n  if (fields != null) {\n    fields.forEach(function(f) {\n      var ref;\n      if (f.type === 'table') {\n        return console.log('ignore opinion field in table');\n      } else if (f.type === 'section') {\n        return f != null ? (ref = f.fields) != null ? ref.forEach(function(f1) {\n          return ins_fields.push(f1);\n        }) : void 0 : void 0;\n      } else {\n        return ins_fields.push(f);\n      }\n    });\n  }\n  return ins_fields;\n};\n\nupdateTabularTitle = function() {};\n\ninstancesListTableTabular = function(flowId, fields) {\n  var ins_fields, key, options;\n  options = {\n    name: \"instances\",\n    collection: db.instances,\n    pub: \"instance_tabular\",\n    onUnload: function() {\n      return Meteor.setTimeout(Template.instance_list._tableColumns, 150);\n    },\n    drawCallback: function(settings) {\n      var ellipsisLink, emptyTd, title;\n      emptyTd = $(\".dataTables_empty\");\n      if (emptyTd.length) {\n        emptyTd[0].colSpan = \"6\";\n      }\n      if (!Steedos.isMobile() && !Steedos.isPad()) {\n        Meteor.setTimeout(Template.instance_list._tableColumns, 150);\n        $(\".instance-list\").scrollTop(0).ready(function() {\n          return $(\".instance-list\").perfectScrollbar(\"update\");\n        });\n      } else {\n        $(\".instance-list\").scrollTop(0);\n      }\n      title = t(\"pager_input_hint\");\n      ellipsisLink = settings.oInstance.parent().find('.paging_numbers .pagination .disabled a');\n      return ellipsisLink.attr(\"title\", title).css(\"cursor\", \"pointer\").click(function() {\n        var goPage, input;\n        if (!$(this).find('input').length) {\n          input = $('<input class=\"paginate_input form-control input-sm\" type=\"text\" style=\"border: none; padding:0 2px;\"/>');\n          if (Steedos.isMobile()) {\n            input.css({\n              width: \"52px\",\n              height: \"20px\"\n            });\n          } else {\n            input.css({\n              width: \"52px\",\n              height: \"16px\"\n            });\n          }\n          input.attr(\"title\", title).attr(\"placeholder\", title);\n          $(this).empty().append(input);\n          goPage = function(index) {\n            var pages;\n            if (index > 0) {\n              pages = Math.ceil(settings.fnRecordsDisplay() / settings._iDisplayLength);\n              if (index > pages) {\n                index = pages;\n              }\n              index--;\n              return settings.oInstance.DataTable().page(index).draw('page');\n            }\n          };\n          input.blur(function(e) {\n            var currentPage;\n            currentPage = $(this).val();\n            goPage(currentPage);\n            return $(this).parent().html('...');\n          });\n          return input.keydown(function(e) {\n            var currentPage;\n            if (e.keyCode.toString() === \"13\") {\n              currentPage = $(this).val();\n              return goPage(currentPage);\n            }\n          });\n        }\n      });\n    },\n    createdRow: function(row, data, dataIndex) {\n      if (Meteor.isClient) {\n        if (data._id === FlowRouter.current().params.instanceId) {\n          return row.setAttribute(\"class\", \"selected\");\n        }\n      }\n    },\n    columns: [\n      {\n        data: \"_id\",\n        orderable: false,\n        render: function(val, type, doc) {\n          var agent_view, cc_view, flow_name, instanceNamePriorityClass, modified, modifiedFromNow, modifiedString, priorityIcon, priorityIconClass, priorityValue, ref, ref1, step_current_name_view, unread;\n          modifiedString = moment(doc.modified).format('YYYY-MM-DD');\n          modified = doc.modified;\n          if (Session.get(\"box\") === 'inbox' && doc.state !== 'draft') {\n            modified = doc.start_date || doc.modified;\n          }\n          if (Session.get(\"box\") === 'outbox' || Session.get(\"box\") === 'monitor') {\n            modified = doc.submit_date || doc.submit_date;\n          }\n          modifiedFromNow = Steedos.momentReactiveFromNow(modified);\n          flow_name = doc.flow_name;\n          cc_view = \"\";\n          step_current_name_view = \"\";\n          if (doc.is_cc && !((ref = doc.inbox_users) != null ? ref.includes(Meteor.userId()) : void 0) && Session.get(\"box\") === 'inbox') {\n            cc_view = \"<label class='cc-label'>(\" + TAPi18n.__(\"instance_cc_title\") + \")</label> \";\n            step_current_name_view = \"<div class='flow-name'>\" + flow_name + \"<span>(\" + doc.current_step_name + \")</span></div>\";\n          } else {\n            if (Session.get(\"box\") !== 'draft' && doc.current_step_name) {\n              step_current_name_view = \"<div class='flow-name'>\" + flow_name + \"<span>(\" + doc.current_step_name + \")</span></div>\";\n            } else {\n              step_current_name_view = \"<div class='flow-name'>\" + flow_name + \"</div>\";\n            }\n          }\n          agent_view = \"\";\n          if (doc.agent_user_name && Session.get(\"box\") === 'inbox') {\n            agent_view = \"<label class='cc-label'>(\" + TAPi18n.__('process_delegation_rules_description', {\n              userName: doc.agent_user_name\n            }) + \")</label>\";\n          }\n          unread = '';\n          if (Session.get(\"box\") === 'inbox' && doc.is_read === false) {\n            unread = '<i class=\"ion ion-record unread\"></i>';\n          } else if (Session.get(\"box\") === 'monitor' && doc.is_hidden === true) {\n            unread = '<i class=\"fa fa-lock\"></i>';\n          }\n          priorityIcon = \"\";\n          priorityIconClass = \"\";\n          priorityValue = (ref1 = doc.values) != null ? ref1.priority : void 0;\n          switch (priorityValue) {\n            case \"ç‰¹æ€¥\":\n              priorityIconClass = \"danger\";\n              break;\n            case \"ç´§æ€¥\":\n              priorityIconClass = \"warning\";\n              break;\n            case \"åŠžæ–‡\":\n              priorityIconClass = \"muted\";\n          }\n          if (priorityIconClass) {\n            instanceNamePriorityClass = \"color-priority color-priority-\" + priorityIconClass;\n          }\n          return \"<div class='instance-read-bar'>\" + unread + \"</div>\\n<div class='instance-name \" + instanceNamePriorityClass + \"'>\" + doc.name + cc_view + agent_view + \"\\n\t<span>\" + doc.applicant_name + \"</span>\\n</div>\\n<div class='instance-detail'>\" + step_current_name_view + \"\\n\t<span class='instance-modified' title='\" + modifiedString + \"'>\" + modifiedFromNow + \"</span>\\n</div>\";\n        }\n      }, {\n        data: \"applicant_organization_name\",\n        title: t(\"instances_applicant_organization_name\"),\n        visible: false\n      }, {\n        data: \"name\",\n        title: t(\"instances_name\"),\n        render: function(val, type, doc) {\n          var agent_view, cc_view, instanceNamePriorityClass, priorityIconClass, priorityValue, ref, ref1, step_current_name_view, unread;\n          cc_view = \"\";\n          step_current_name_view = \"\";\n          if (doc.is_cc && !((ref = doc.inbox_users) != null ? ref.includes(Meteor.userId()) : void 0) && Session.get(\"box\") === 'inbox') {\n            cc_view = \"<label class='cc-label'>(\" + TAPi18n.__(\"instance_cc_title\") + \")</label> \";\n          }\n          agent_view = \"\";\n          if (doc.agent_user_name) {\n            agent_view = \"<label class='cc-label'>(\" + TAPi18n.__('process_delegation_rules_description', {\n              userName: doc.agent_user_name\n            }) + \")</label>\";\n          }\n          unread = '';\n          if (Session.get(\"box\") === 'inbox' && doc.is_read === false) {\n            unread = '<i class=\"ion ion-record unread\"></i>';\n          } else if (Session.get(\"box\") === 'monitor' && doc.is_hidden === true) {\n            unread = '<i class=\"fa fa-lock\"></i>';\n          }\n          priorityIconClass = \"\";\n          priorityValue = (ref1 = doc.values) != null ? ref1.priority : void 0;\n          switch (priorityValue) {\n            case \"ç‰¹æ€¥\":\n              priorityIconClass = \"danger\";\n              break;\n            case \"ç´§æ€¥\":\n              priorityIconClass = \"warning\";\n              break;\n            case \"åŠžæ–‡\":\n              priorityIconClass = \"muted\";\n          }\n          if (priorityIconClass) {\n            instanceNamePriorityClass = \"color-priority color-priority-\" + priorityIconClass;\n          }\n          return \"<div class='instance-read-bar'>\" + unread + \"</div>\\n<div class='instance-name \" + instanceNamePriorityClass + \"'>\" + doc.name + cc_view + agent_view + \"</div>\";\n        },\n        visible: false,\n        orderable: false\n      }, {\n        data: \"applicant_name\",\n        title: t(\"instances_applicant_name\"),\n        visible: false,\n        orderable: false\n      }, {\n        data: \"submit_date\",\n        title: t(\"instances_submit_date\"),\n        render: function(val, type, doc) {\n          if (doc.submit_date) {\n            return moment(doc.submit_date).format('YYYY-MM-DD HH:mm');\n          }\n        },\n        visible: false,\n        orderable: true\n      }, {\n        data: \"flow_name\",\n        title: t(\"instances_flow\"),\n        visible: false,\n        orderable: false\n      }, {\n        data: \"current_step_name\",\n        title: t(\"instances_step_current_name\"),\n        render: function(val, type, doc) {\n          var cc_tag, judge, step_current_name;\n          if (doc.state === \"completed\") {\n            judge = doc.final_decision || \"approved\";\n          }\n          step_current_name = doc.current_step_name || '';\n          cc_tag = '';\n          if (doc.cc_count > 0) {\n            cc_tag = TAPi18n.__('cc_tag');\n          }\n          return \"<div class=\\\"step-current-state \" + judge + \"\\\">\" + step_current_name + cc_tag + \"</div>\";\n        },\n        visible: false,\n        orderable: false\n      }, {\n        data: \"modified\",\n        title: t(\"instances_modified\"),\n        render: function(val, type, doc) {\n          return moment(doc.modified).format('YYYY-MM-DD HH:mm');\n        },\n        visible: false,\n        orderable: true\n      }, {\n        data: \"start_date\",\n        title: t(\"instances_start_date\"),\n        render: function(val, type, doc) {\n          if (doc.start_date) {\n            return moment(doc.start_date).format('YYYY-MM-DD HH:mm');\n          }\n        },\n        visible: false,\n        orderable: true\n      }, {\n        data: \"my_finish_date\",\n        render: function(val, type, doc) {\n          if (doc.my_finish_date) {\n            return moment(doc.my_finish_date).format('YYYY-MM-DD HH:mm');\n          }\n        },\n        visible: false,\n        orderable: true\n      }, {\n        data: \"modified\",\n        visible: false\n      }, {\n        data: \"keywords\",\n        visible: false\n      }, {\n        data: \"is_archived\",\n        render: function(val, type, doc) {\n          var ref;\n          if ((doc != null ? (ref = doc.values) != null ? ref.record_need : void 0 : void 0) && doc.values.record_need === \"true\") {\n            if (doc != null ? doc.is_archived : void 0) {\n              return t(\"YES\");\n            }\n            return t(\"NO\");\n          }\n        },\n        visible: false,\n        orderable: false\n      }\n    ],\n    dom: (function() {\n      if (Steedos.isMobile()) {\n        return 'tp';\n      } else {\n        return 'tpl';\n      }\n    })(),\n    order: [[4, \"desc\"]],\n    extraFields: [\"form\", \"flow\", \"inbox_users\", \"state\", \"space\", \"applicant\", \"form_version\", \"flow_version\", \"is_cc\", \"cc_count\", \"is_read\", \"current_step_name\", \"values\", \"keywords\", \"final_decision\", \"flow_name\", \"is_hidden\", \"agent_user_name\"],\n    lengthChange: true,\n    lengthMenu: [10, 15, 20, 25, 50, 100],\n    pageLength: 10,\n    info: false,\n    searching: true,\n    responsive: {\n      details: false\n    },\n    autoWidth: false,\n    changeSelector: function(selector, userId) {\n      var ref, space, space_user;\n      if (!userId) {\n        return {\n          _id: -1\n        };\n      }\n      space = selector.space;\n      if (!space) {\n        if ((selector != null ? (ref = selector.$and) != null ? ref.length : void 0 : void 0) > 0) {\n          space = selector.$and.getProperty('space')[0];\n        }\n      }\n      if (!space) {\n        return {\n          _id: -1\n        };\n      }\n      space_user = db.space_users.findOne({\n        user: userId,\n        space: space\n      }, {\n        fields: {\n          _id: 1\n        }\n      });\n      if (!space_user) {\n        return {\n          _id: -1\n        };\n      }\n      return selector;\n    },\n    pagingType: \"numbers\"\n  };\n  if (flowId) {\n    key = \"instanceFlow\" + flowId;\n    options.name = key;\n    TabularTables.instances.fields = fields;\n    ins_fields = _handleListFields(TabularTables.instances.fields);\n    ins_fields.forEach(function(f) {\n      if (f.type !== 'table' && f.is_list_display) {\n        return options.columns.push({\n          data: f.name || f.code,\n          title: t(f.name || f.code),\n          visible: false,\n          orderable: false,\n          render: function(val, type, doc) {\n            var value, values;\n            values = doc.values || {};\n            value = values[f.code];\n            switch (f.type) {\n              case 'user':\n                value = value != null ? value.name : void 0;\n                break;\n              case 'group':\n                value = value != null ? value.fullname : void 0;\n                break;\n              case 'date':\n                if (value) {\n                  value = moment(value).format('YYYY-MM-DD');\n                }\n                break;\n              case 'dateTime':\n                if (value) {\n                  value = moment(value).format('YYYY-MM-DD HH:mm');\n                }\n                break;\n              case 'checkbox':\n                if (value === true || value === 'true') {\n                  value = TAPi18n.__(\"form_field_checkbox_yes\");\n                } else {\n                  value = TAPi18n.__(\"form_field_checkbox_no\");\n                }\n                break;\n              case 'odata':\n                if (value) {\n                  if (_.isArray(value)) {\n                    value = _.pluck(value, '@label').toString();\n                  } else {\n                    value = value['@label'];\n                  }\n                }\n            }\n            return value;\n          }\n        });\n      }\n    });\n  }\n  return options;\n};\n\ninstanceTasksListTableTabular = function(flowId, fields) {\n  var ins_fields, key, options;\n  options = {\n    name: \"instance_tasks\",\n    collection: db.instance_tasks,\n    pub: \"instance_tasks_tabular\",\n    onUnload: function() {\n      return Meteor.setTimeout(Template.instance_list._tableColumns, 150);\n    },\n    drawCallback: function(settings) {\n      var ellipsisLink, emptyTd, title;\n      emptyTd = $(\".dataTables_empty\");\n      if (emptyTd.length) {\n        emptyTd[0].colSpan = \"6\";\n      }\n      if (!Steedos.isMobile() && !Steedos.isPad()) {\n        Meteor.setTimeout(Template.instance_list._tableColumns, 150);\n        $(\".instance-list\").scrollTop(0).ready(function() {\n          return $(\".instance-list\").perfectScrollbar(\"update\");\n        });\n      } else {\n        $(\".instance-list\").scrollTop(0);\n      }\n      title = t(\"pager_input_hint\");\n      ellipsisLink = settings.oInstance.parent().find('.paging_numbers .pagination .disabled a');\n      return ellipsisLink.attr(\"title\", title).css(\"cursor\", \"pointer\").click(function() {\n        var goPage, input;\n        if (!$(this).find('input').length) {\n          input = $('<input class=\"paginate_input form-control input-sm\" type=\"text\" style=\"border: none; padding:0 2px;\"/>');\n          if (Steedos.isMobile()) {\n            input.css({\n              width: \"52px\",\n              height: \"20px\"\n            });\n          } else {\n            input.css({\n              width: \"52px\",\n              height: \"16px\"\n            });\n          }\n          input.attr(\"title\", title).attr(\"placeholder\", title);\n          $(this).empty().append(input);\n          goPage = function(index) {\n            var pages;\n            if (index > 0) {\n              pages = Math.ceil(settings.fnRecordsDisplay() / settings._iDisplayLength);\n              if (index > pages) {\n                index = pages;\n              }\n              index--;\n              return settings.oInstance.DataTable().page(index).draw('page');\n            }\n          };\n          input.blur(function(e) {\n            var currentPage;\n            currentPage = $(this).val();\n            goPage(currentPage);\n            return $(this).parent().html('...');\n          });\n          return input.keydown(function(e) {\n            var currentPage;\n            if (e.keyCode.toString() === \"13\") {\n              currentPage = $(this).val();\n              return goPage(currentPage);\n            }\n          });\n        }\n      });\n    },\n    createdRow: function(row, data, dataIndex) {\n      if (Meteor.isClient) {\n        if (data.instance === FlowRouter.current().params.instanceId) {\n          return row.setAttribute(\"class\", \"selected\");\n        }\n      }\n    },\n    columns: [\n      {\n        data: \"_id\",\n        orderable: false,\n        render: function(val, type, doc) {\n          var agent_view, cc_view, flow_name, instanceNamePriorityClass, modified, modifiedFromNow, modifiedString, priorityIcon, priorityIconClass, priorityValue, ref, step_current_name_view, unread;\n          modifiedString = moment(doc.modified).format('YYYY-MM-DD');\n          modified = doc.modified;\n          if (Session.get(\"box\") === 'inbox' && doc.instance_state !== 'draft') {\n            modified = doc.start_date || doc.modified;\n          }\n          if (Session.get(\"box\") === 'outbox') {\n            modified = doc.submit_date || doc.modified;\n          }\n          modifiedFromNow = Steedos.momentReactiveFromNow(modified);\n          flow_name = doc.flow_name;\n          cc_view = \"\";\n          step_current_name_view = \"\";\n          if (doc.type === 'cc' && Session.get(\"box\") === 'inbox') {\n            cc_view = \"<label class='cc-label'>(\" + TAPi18n.__(\"instance_cc_title\") + \")</label> \";\n            step_current_name_view = \"<div class='flow-name'>\" + flow_name + \"<span>(\" + doc.step_name + \")</span></div>\";\n          } else {\n            if (doc.step_name) {\n              step_current_name_view = \"<div class='flow-name'>\" + flow_name + \"<span>(\" + doc.step_name + \")</span></div>\";\n            } else {\n              step_current_name_view = \"<div class='flow-name'>\" + flow_name + \"</div>\";\n            }\n          }\n          agent_view = \"\";\n          if (doc.agent_user_name && Session.get(\"box\") === 'inbox') {\n            agent_view = \"<label class='cc-label'>(\" + TAPi18n.__('process_delegation_rules_description', {\n              userName: doc.agent_user_name\n            }) + \")</label>\";\n          }\n          unread = '';\n          if (Session.get(\"box\") === 'inbox' && doc.is_read === false) {\n            unread = '<i class=\"ion ion-record unread\"></i>';\n          } else if (Session.get(\"box\") === 'monitor' && doc.is_hidden === true) {\n            unread = '<i class=\"fa fa-lock\"></i>';\n          }\n          priorityIcon = \"\";\n          priorityIconClass = \"\";\n          priorityValue = (ref = doc.values) != null ? ref.priority : void 0;\n          switch (priorityValue) {\n            case \"ç‰¹æ€¥\":\n              priorityIconClass = \"danger\";\n              break;\n            case \"ç´§æ€¥\":\n              priorityIconClass = \"warning\";\n              break;\n            case \"åŠžæ–‡\":\n              priorityIconClass = \"muted\";\n          }\n          if (priorityIconClass) {\n            instanceNamePriorityClass = \"color-priority color-priority-\" + priorityIconClass;\n          }\n          return \"<div class='instance-read-bar'>\" + unread + \"</div>\\n<div class='instance-name \" + instanceNamePriorityClass + \"'>\" + doc.instance_name + cc_view + agent_view + \"\\n\t<span>\" + doc.applicant_name + \"</span>\\n</div>\\n<div class='instance-detail'>\" + step_current_name_view + \"\\n\t<span class='instance-modified' title='\" + modifiedString + \"'>\" + modifiedFromNow + \"</span>\\n</div>\";\n        }\n      }, {\n        data: \"applicant_organization_name\",\n        title: t(\"instances_applicant_organization_name\"),\n        visible: false\n      }, {\n        data: \"instance_name\",\n        title: t(\"instances_name\"),\n        render: function(val, type, doc) {\n          var agent_view, cc_view, instanceNamePriorityClass, priorityIconClass, priorityValue, ref, ref1, step_current_name_view, unread;\n          cc_view = \"\";\n          step_current_name_view = \"\";\n          if (doc.is_cc && !((ref = doc.inbox_users) != null ? ref.includes(Meteor.userId()) : void 0) && Session.get(\"box\") === 'inbox') {\n            cc_view = \"<label class='cc-label'>(\" + TAPi18n.__(\"instance_cc_title\") + \")</label> \";\n          }\n          agent_view = \"\";\n          if (doc.agent_user_name) {\n            agent_view = \"<label class='cc-label'>(\" + TAPi18n.__('process_delegation_rules_description', {\n              userName: doc.agent_user_name\n            }) + \")</label>\";\n          }\n          unread = '';\n          if (Session.get(\"box\") === 'inbox' && doc.is_read === false) {\n            unread = '<i class=\"ion ion-record unread\"></i>';\n          } else if (Session.get(\"box\") === 'monitor' && doc.is_hidden === true) {\n            unread = '<i class=\"fa fa-lock\"></i>';\n          }\n          priorityIconClass = \"\";\n          priorityValue = (ref1 = doc.values) != null ? ref1.priority : void 0;\n          switch (priorityValue) {\n            case \"ç‰¹æ€¥\":\n              priorityIconClass = \"danger\";\n              break;\n            case \"ç´§æ€¥\":\n              priorityIconClass = \"warning\";\n              break;\n            case \"åŠžæ–‡\":\n              priorityIconClass = \"muted\";\n          }\n          if (priorityIconClass) {\n            instanceNamePriorityClass = \"color-priority color-priority-\" + priorityIconClass;\n          }\n          return \"<div class='instance-read-bar'>\" + unread + \"</div>\\n<div class='instance-name \" + instanceNamePriorityClass + \"'>\" + doc.instance_name + cc_view + agent_view + \"</div>\";\n        },\n        visible: false,\n        orderable: false\n      }, {\n        data: \"applicant_name\",\n        title: t(\"instances_applicant_name\"),\n        visible: false,\n        orderable: false\n      }, {\n        data: \"submit_date\",\n        title: t(\"instances_submit_date\"),\n        render: function(val, type, doc) {\n          if (doc.submit_date) {\n            return moment(doc.submit_date).format('YYYY-MM-DD HH:mm');\n          }\n        },\n        visible: false,\n        orderable: true\n      }, {\n        data: \"flow_name\",\n        title: t(\"instances_flow\"),\n        visible: false,\n        orderable: false\n      }, {\n        data: \"step_name\",\n        title: t(\"instances_step_current_name\"),\n        render: function(val, type, doc) {\n          var cc_tag, judge, step_current_name;\n          if (doc.instance_state === \"completed\") {\n            judge = doc.judge || \"approved\";\n          }\n          step_current_name = doc.step_name || '';\n          cc_tag = '';\n          if (doc.cc_count > 0) {\n            cc_tag = TAPi18n.__('cc_tag');\n          }\n          return \"<div class=\\\"step-current-state \" + judge + \"\\\">\" + step_current_name + cc_tag + \"</div>\";\n        },\n        visible: false,\n        orderable: false\n      }, {\n        data: \"modified\",\n        title: t(\"instances_modified\"),\n        render: function(val, type, doc) {\n          return moment(doc.modified).format('YYYY-MM-DD HH:mm');\n        },\n        visible: false,\n        orderable: true\n      }, {\n        data: \"start_date\",\n        title: t(\"instances_start_date\"),\n        render: function(val, type, doc) {\n          if (doc.start_date) {\n            return moment(doc.start_date).format('YYYY-MM-DD HH:mm');\n          }\n        },\n        visible: false,\n        orderable: true\n      }, {\n        data: \"finish_date\",\n        render: function(val, type, doc) {\n          if (doc.finish_date) {\n            return moment(doc.finish_date).format('YYYY-MM-DD HH:mm');\n          }\n        },\n        visible: false,\n        orderable: true\n      }, {\n        data: \"modified\",\n        visible: false\n      }, {\n        data: \"keywords\",\n        visible: false\n      }, {\n        data: \"is_archived\",\n        render: function(val, type, doc) {\n          var ref;\n          if ((doc != null ? (ref = doc.values) != null ? ref.record_need : void 0 : void 0) && doc.values.record_need === \"true\") {\n            if (doc != null ? doc.is_archived : void 0) {\n              return t(\"YES\");\n            }\n            return t(\"NO\");\n          }\n        },\n        visible: false,\n        orderable: false\n      }\n    ],\n    dom: (function() {\n      if (Steedos.isMobile()) {\n        return 'tp';\n      } else {\n        return 'tpl';\n      }\n    })(),\n    order: [[4, \"desc\"]],\n    extraFields: [\"instance\", \"form\", \"flow\", \"inbox_users\", \"instance_state\", \"space\", \"applicant\", \"form_version\", \"flow_version\", \"type\", \"is_read\", \"step_name\", \"values\", \"keywords\", \"final_decision\", \"flow_name\", \"is_hidden\", \"agent_user_name\"],\n    lengthChange: true,\n    lengthMenu: [10, 15, 20, 25, 50, 100],\n    pageLength: 10,\n    info: false,\n    searching: true,\n    responsive: {\n      details: false\n    },\n    autoWidth: false,\n    changeSelector: function(selector, userId) {\n      var ref, space, space_user;\n      if (!userId) {\n        return {\n          _id: -1\n        };\n      }\n      space = selector.space;\n      if (!space) {\n        if ((selector != null ? (ref = selector.$and) != null ? ref.length : void 0 : void 0) > 0) {\n          space = selector.$and.getProperty('space')[0];\n        }\n      }\n      if (!space) {\n        return {\n          _id: -1\n        };\n      }\n      space_user = db.space_users.findOne({\n        user: userId,\n        space: space\n      }, {\n        fields: {\n          _id: 1\n        }\n      });\n      if (!space_user) {\n        return {\n          _id: -1\n        };\n      }\n      return selector;\n    },\n    pagingType: \"numbers\"\n  };\n  if (flowId) {\n    key = \"instanceFlow\" + flowId;\n    options.name = key;\n    TabularTables.instance_tasks.fields = fields;\n    ins_fields = _handleListFields(TabularTables.instance_tasks.fields);\n    ins_fields.forEach(function(f) {\n      if (f.type !== 'table' && f.is_list_display) {\n        return options.columns.push({\n          data: f.name || f.code,\n          title: t(f.name || f.code),\n          visible: false,\n          orderable: false,\n          render: function(val, type, doc) {\n            var value, values;\n            values = doc.values || {};\n            value = values[f.code];\n            switch (f.type) {\n              case 'user':\n                value = value != null ? value.name : void 0;\n                break;\n              case 'group':\n                value = value != null ? value.fullname : void 0;\n                break;\n              case 'date':\n                if (value) {\n                  value = moment(value).format('YYYY-MM-DD');\n                }\n                break;\n              case 'dateTime':\n                if (value) {\n                  value = moment(value).format('YYYY-MM-DD HH:mm');\n                }\n                break;\n              case 'checkbox':\n                if (value === true || value === 'true') {\n                  value = TAPi18n.__(\"form_field_checkbox_yes\");\n                } else {\n                  value = TAPi18n.__(\"form_field_checkbox_no\");\n                }\n                break;\n              case 'odata':\n                if (value) {\n                  if (_.isArray(value)) {\n                    value = _.pluck(value, '@label').toString();\n                  } else {\n                    value = value['@label'];\n                  }\n                }\n            }\n            return value;\n          }\n        });\n      }\n    });\n  }\n  return options;\n};\n\nMeteor.startup(function() {\n  TabularTables.instances = new Tabular.Table(instancesListTableTabular());\n  TabularTables.instance_tasks = new Tabular.Table(instanceTasksListTableTabular());\n  TabularTables.inbox_instances = new Tabular.Table(GetBoxInstancesTabularOptions(\"inbox\"));\n  return TabularTables.outbox_instances = new Tabular.Table(GetBoxInstancesTabularOptions(\"outbox\"));\n});\n\nGetBoxInstancesTabularOptions = function(box, flowId, fields) {\n  var key, options;\n  key = \"instanceFlow\" + box + flowId;\n  if (box === \"inbox\") {\n    options = _get_inbox_instances_tabular_options(flowId, fields);\n  } else if (box === \"outbox\") {\n    options = _get_outbox_instances_tabular_options(flowId, fields);\n  } else {\n    options = instancesListTableTabular(flowId, fields);\n    if (!flowId) {\n      options.name = \"inbox_instances\";\n    }\n  }\n  if (flowId) {\n    options.name = key;\n  }\n  return options;\n};\n\n_get_inbox_instances_tabular_options = function(flowId, fields) {\n  var options;\n  options = instanceTasksListTableTabular(flowId, fields);\n  if (!flowId) {\n    options.name = \"inbox_instances\";\n  }\n  options.order = [[8, \"desc\"]];\n  options.getSort = function(selector, sort) {\n    console.log('inbox_instances:', sort);\n    return sort;\n  };\n  return options;\n};\n\n_get_outbox_instances_tabular_options = function(flowId, fields) {\n  var options;\n  options = instanceTasksListTableTabular(flowId, fields);\n  if (!flowId) {\n    options.name = \"outbox_instances\";\n  }\n  options.order = [[9, -1]];\n  options.getSort = function(selector, sort) {\n    console.log('outbox_instances:', sort);\n    return sort;\n  };\n  return options;\n};\n\nif (Meteor.isClient) {\n  TabularTables.flowInstances = new ReactiveVar();\n}\n\nMeteor.startup(function() {\n  return Tracker.autorun(function(c) {\n    if (Meteor.isClient && !Steedos.isMobile()) {\n      if (Session.get(\"flowId\") && Session.get(\"box\") !== 'draft') {\n        return Meteor.call(\"newInstancesListTabular\", Session.get(\"box\"), Session.get(\"flowId\"), function(error, result) {\n          newInstancesListTabular(Session.get(\"box\"), Session.get(\"flowId\"), result);\n          return Template.instance_list._changeOrder();\n        });\n      }\n    }\n  });\n});\n\nnewInstancesListTabular = function(box, flowId, fields) {\n  var flow, key, ref, ref1, ref2;\n  if (!fields) {\n    flow = db.flows.findOne({\n      _id: flowId\n    }, {\n      fields: {\n        form: 1\n      }\n    });\n    fields = (ref = db.forms.findOne({\n      _id: flow != null ? flow.form : void 0\n    }, {\n      fields: {\n        'current.fields': 1\n      }\n    })) != null ? (ref1 = ref.current) != null ? ref1.fields : void 0 : void 0;\n  }\n  fields = _handleListFields(fields);\n  if ((fields != null ? (ref2 = fields.filterProperty(\"is_list_display\", true)) != null ? ref2.length : void 0 : void 0) > 0) {\n    key = \"instanceFlow\" + box + flowId;\n    if (Meteor.isClient) {\n      TabularTables.flowInstances.set(new Tabular.Table(GetBoxInstancesTabularOptions(box, flowId, fields)));\n    } else {\n      new Tabular.Table(GetBoxInstancesTabularOptions(box, flowId, fields));\n    }\n    return console.log(\"new TabularTables \", key);\n  }\n};\n\nif (Meteor.isServer) {\n  Meteor.methods({\n    newInstancesListTabular: function(box, flowId) {\n      var fields, flow, ref, ref1;\n      newInstancesListTabular(box, flowId);\n      flow = db.flows.findOne({\n        _id: flowId\n      }, {\n        fields: {\n          form: 1\n        }\n      });\n      fields = (ref = db.forms.findOne({\n        _id: flow != null ? flow.form : void 0\n      }, {\n        fields: {\n          'current.fields': 1\n        }\n      })) != null ? (ref1 = ref.current) != null ? ref1.fields : void 0 : void 0;\n      return fields;\n    }\n  });\n}\n"]}