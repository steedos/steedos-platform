{"version":3,"sources":["meteor://ðŸ’»app/packages/steedos_objects/core.coffee","meteor://ðŸ’»app/core.coffee","meteor://ðŸ’»app/packages/steedos_objects/loadStandardObjects.coffee","meteor://ðŸ’»app/loadStandardObjects.coffee","meteor://ðŸ’»app/packages/steedos_objects/coreSupport.coffee","meteor://ðŸ’»app/coreSupport.coffee","meteor://ðŸ’»app/packages/steedos_objects/server/methods/object_options.coffee","meteor://ðŸ’»app/server/methods/object_options.coffee","meteor://ðŸ’»app/packages/steedos_objects/server/routes/api_workflow_view_instance.coffee","meteor://ðŸ’»app/server/routes/api_workflow_view_instance.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/listviews.coffee","meteor://ðŸ’»app/lib/listviews.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/add_simple_schema_validation_error.coffee","meteor://ðŸ’»app/lib/add_simple_schema_validation_error.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/field_simple_schema_validation_error.coffee","meteor://ðŸ’»app/lib/field_simple_schema_validation_error.coffee","meteor://ðŸ’»app/packages/steedos:objects/lib/eval.js","meteor://ðŸ’»app/packages/steedos_objects/lib/convert.coffee","meteor://ðŸ’»app/lib/convert.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/formular.coffee","meteor://ðŸ’»app/lib/formular.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/object.coffee","meteor://ðŸ’»app/lib/object.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/fields.coffee","meteor://ðŸ’»app/lib/fields.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/triggers.coffee","meteor://ðŸ’»app/lib/triggers.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/permission_sets.coffee","meteor://ðŸ’»app/lib/permission_sets.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/collections.coffee","meteor://ðŸ’»app/lib/collections.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/actions.coffee","meteor://ðŸ’»app/lib/actions.coffee"],"names":["db","Creator","Objects","Collections","Menus","Apps","Dashboards","Reports","subs","steedosSchema","e","steedosCore","require","Meteor","isDevelopment","startup","ex","init","error","console","log","Fiber","path","deps","app","Tracker","Dependency","object","_TEMPLATE","SimpleSchema","extendOptions","filtersFunction","Match","Optional","OneOf","Function","String","optionsFunction","createFunction","isServer","fiberLoadObjects","obj","object_name","loadObjects","run","name","list_views","space","getCollectionName","_","clone","convertObject","Object","initTriggers","initListViews","getObjectName","getObject","space_id","ref","ref1","isArray","isClient","depend","Session","get","objectsByName","getObjectById","object_id","findWhere","_id","removeObject","getCollection","spaceId","_collection_name","removeCollection","isSpaceAdmin","userId","findOne","fields","admins","indexOf","evaluateFormula","formular","context","options","isString","Formular","checkFormula","evaluateFilters","filters","selector","each","filter","action","value","length","isCommonSpace","getOrderlySetByIds","docs","ids","id_key","hit_first","values","getProperty","sortBy","doc","_index","sortingMethod","value1","value2","isValue1Empty","isValue2Empty","locale","key","Date","getTime","Steedos","toString","localeCompare","getObjectRelateds","_object","permissions","relatedList","relatedListMap","related_objects","isEmpty","objName","related_object","related_object_name","related_field","related_field_name","type","reference_to","foreign_key","sharing","enableObjName","getPermissions","enable_audit","modifyAllRecords","enable_files","push","splice","enable_tasks","enable_notes","enable_events","enable_instances","enable_approvals","getUserContext","isUnSafeMode","USER_CONTEXT","space_user_org","su","suFields","Error","mobile","position","email","company","organization","company_id","company_ids","user","fullname","getRelativeUrl","url","isFunction","isCordova","startsWith","test","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","getUserCompanyId","getUserCompanyIds","processPermissions","po","allowCreate","allowRead","allowEdit","allowDelete","viewAllRecords","viewCompanyRecords","modifyCompanyRecords","getTemplateSpaceId","settings","templateSpaceId","getCloudAdminSpaceId","cloudAdminSpaceId","isTemplateSpace","isCloudAdminSpace","process","env","STEEDOS_STORAGE_DIR","steedosStorageDir","resolve","join","__meteor_bootstrap__","serverDir","methods","collection","name_field_key","options_limit","query","query_options","records","results","searchTextQuery","selected","sort","params","NAME_FIELD_KEY","searchText","$regex","$or","$in","extend","$nin","filterQuery","limit","isObject","find","fetch","record","label","message","JSON","stringify","JsonRoutes","add","req","res","next","box","current_user_id","current_user_info","flowId","hashData","ins","insId","record_id","redirect_url","ref2","workflowUrl","x_auth_token","x_user_id","uuflowManager","check_authorization","body","check","instanceId","webservices","workflow","flow","inbox_users","includes","cc_users","outbox_users","state","submitter","applicant","permissionManager","getFlowPermissions","spaces","sendResult","code","data","update","$pull","errors","errorMessage","reason","getInitWidthPercent","columns","_schema","column_num","init_width_percent","getSchema","field_name","field","is_wide","pick","autoform","getFieldIsWide","getTabularOrder","list_view_id","setting","map","column","hidden","compact","order","index","default_extra_columns","extra_columns","getObjectDefaultColumns","getObjectDefaultExtraColumns","union","getObjectDefaultSort","TabularSelectedIds","convertListView","default_columens","list_view","list_view_name","oitem","has","include","filter_scope","parse","forEach","_value","getRelatedList","list","getRelatedObjects","related_object_item","related","tabular_order","without","transformSortToTabular","replace","is_file","getObjectFirstListView","first","getListViews","getListView","exac","listViews","getListViewIsRecent","listView","getObjectDefaultView","defaultView","isAllView","isRecentView","tabularColumns","tabular_sort","item","column_index","transformSortToDX","dx_sort","RegEx","RegExp","_regExMessages","_globalMessages","regEx","exp","msg","messages","evalInContext","js","eval","call","convertField","getOption","option","foo","split","allOptions","picklist","picklistOptions","getPicklist","getPickListOptions","reverse","enable","defaultValue","triggers","trigger","_todo","_todo_from_code","_todo_from_db","on","todo","actions","_visible","error1","actionsByName","visible","_options","_type","beforeOpenFunction","is_company_limited","max","min","_option","v","k","_regEx","_min","_max","Number","Boolean","_optionsFunction","_reference_to","_createFunction","_beforeOpenFunction","_filtersFunction","_defaultValue","_is_company_limited","_filters","isDate","pop","_is_date","form","val","PREFIX","_prependPrefixForFormula","prefix","fieldVariable","reg","rev","m","$1","formula_str","_CONTEXT","_VALUES","isBoolean","toastr","formatObjectName","_db","defaultColumns","defaultListViewId","disabled_list_views","ref3","schema","self","icon","description","is_view","is_enable","enable_search","enable_api","custom","enable_share","enable_tree","sidebar","open_window","filter_company","calendar","enable_chatter","enable_trash","enable_space_global","enable_follow","enable_workflow","in_development","idFieldName","database_name","is_name","primary","filterable","baseObject","item_name","copyItem","permission_set","admin","all","list_view_item","ReactiveVar","createCollection","_name","getObjectSchema","contains","attachSchema","_simpleSchema","getObjectODataRouterPrefix","bootstrapLoaded","fieldsArr","_ref_obj","autoform_type","fs","isUnLimited","multiple","rows","language","isMobile","isPad","afFieldInput","dateMobileOptions","outFormat","timezoneId","dxDateBoxOptions","displayFormat","height","dialogsInBody","toolbar","fontNames","showIcon","dependOn","depend_on","create","lookup_field","Modal","show","formId","operation","onSuccess","result","addItems","reference_sort","optionsSort","reference_limit","optionsLimit","omit","blackbox","objectSwitche","optionsMethod","optionsMethodParams","references","_reference","link","defaultIcon","firstOption","precision","scale","decimal","Array","editable","accept","system","Email","required","optional","unique","group","searchable","readonly","disabled","inlineHelpText","isProduction","sortable","getFieldDisplayValue","field_value","html","moment","format","checkFieldTypeSupportBetweenQuery","field_type","pushBetweenBuiltinOptionals","operations","builtinValues","getBetweenBuiltinValues","builtinItem","is_check_only","getBetweenTimeBuiltinValues","getBetweenBuiltinValueItem","getBetweenTimeBuiltinValueItem","getBetweenBuiltinOperation","betweenBuiltinValues","getQuarterStartMonth","month","getMonth","getLastQuarterFirstDay","year","getFullYear","getNextQuarterFirstDay","getMonthDays","days","endDate","millisecond","startDate","getLastMonthFirstDay","currentMonth","currentYear","endValue","firstDay","lastDay","lastMonday","lastMonthFinalDay","lastMonthFirstDay","lastQuarterEndDay","lastQuarterStartDay","lastSunday","last_120_days","last_30_days","last_60_days","last_7_days","last_90_days","minusDay","monday","nextMonday","nextMonthFinalDay","nextMonthFirstDay","nextQuarterEndDay","nextQuarterStartDay","nextSunday","nextYear","next_120_days","next_30_days","next_60_days","next_7_days","next_90_days","now","previousYear","startValue","strEndDay","strFirstDay","strLastDay","strMonday","strStartDay","strSunday","strToday","strTomorrow","strYestday","sunday","thisQuarterEndDay","thisQuarterStartDay","tomorrow","week","yestday","getDay","t","fv","setHours","getHours","getTimezoneOffset","getFieldDefaultOperation","getFieldOperation","optionals","equal","unequal","less_than","greater_than","less_or_equal","greater_or_equal","not_contain","starts_with","between","getObjectFieldsName","fieldsName","sort_no","cleanTrigger","initTrigger","_trigger_hooks","ref4","ref5","todoWrapper","apply","arguments","when","before","insert","remove","after","_hook","trigger_name","_trigger_hook","findOne_permission_object","find_permission_object","intersectionPlus","unionPermissionObjects","unionPlus","getObjectPermissions","getRecordPermissions","isOwner","object_fields_keys","record_company_id","record_company_ids","select","user_company_ids","parent","keys","intersection","getObjectRecord","owner","n","locked","getRecordRelatedListPermissions","currentObjectName","relatedListItem","currentRecord","isRelateObjectUneditable","masterAllow","masterRecordPerm","relatedObjectPermissions","uneditable_related_list","getRecordSafeRelatedList","getAllPermissions","_i","psets","psetsAdmin","psetsAdmin_pos","psetsCurrent","psetsCurrentNames","psetsCurrent_pos","psetsGuest","psetsGuest_pos","psetsMember","psetsMember_pos","psetsUser","psetsUser_pos","set_ids","spaceUser","objects","assigned_apps","users","permission_set_id","created","modified","created_by","modified_by","pluck","profile","getAssignedApps","bind","assigned_menus","getAssignedMenus","user_permission_sets","array","other","apps","psetBase","pset","uniq","aboutMenu","adminMenus","allMenus","currentPsetNames","menus","otherMenuApps","otherMenus","admin_menus","flatten","menu","psetsMenu","permission_sets","permission_objects","isNull","permission_set_ids","pos","ops","ops_key","currentPset","tempOps","repeatIndex","repeatPo","opsetAdmin","opsetGuest","opsetMember","opsetUser","posAdmin","posGuest","posMember","posUser","prof","guest","member","disabled_actions","unreadable_fields","uneditable_fields","unrelated_objects","creator_db_url","oplog_url","MONGO_URL_CREATOR","MONGO_OPLOG_URL_CREATOR","_CREATOR_DATASOURCE","_driver","MongoInternals","RemoteCollectionDriver","oplogUrl","collection_key","newCollection","SMSQueue","action_name","executeAction","item_element","moreArgs","todoArgs","odata","prototype","slice","concat","set","FormManager","getInitialValues","defer","$","click","href","getObjectUrl","window","open","record_title","call_back","text","swal","title","showCancelButton","confirmButtonText","cancelButtonText","appid","dxDataGridInstance","gridContainer","gridObjectNameClass","info","isOpenerRemove","success","opener","dxTreeList","dxDataGrid","refresh","Template","creator_grid","close","FlowRouter","go"],"mappings":"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","file":"/packages/steedos_objects.js","sourcesContent":["@db = {}\r\nif !Creator?\r\n\t@Creator = {}\r\nCreator.Objects = {}\r\nCreator.Collections = {}\r\nCreator.Menus = []\r\nCreator.Apps = {}\r\nCreator.Dashboards = {}\r\nCreator.Reports = {}\r\nCreator.subs = {}\r\nCreator.steedosSchema = {}","this.db = {};\n\nif (typeof Creator === \"undefined\" || Creator === null) {\n  this.Creator = {};\n}\n\nCreator.Objects = {};\n\nCreator.Collections = {};\n\nCreator.Menus = [];\n\nCreator.Apps = {};\n\nCreator.Dashboards = {};\n\nCreator.Reports = {};\n\nCreator.subs = {};\n\nCreator.steedosSchema = {};\n","try\r\n\tsteedosCore = require('@steedos/core')\r\n\tif Meteor.isDevelopment\r\n\t\tMeteor.startup ->\r\n\t\t\ttry\r\n\t\t\t\tsteedosCore.init()\r\n\t\t\tcatch ex\r\n\t\t\t\tconsole.log(ex)\r\ncatch e\r\n\tconsole.log(e)","var e, steedosCore;\n\ntry {\n  steedosCore = require('@steedos/core');\n  if (Meteor.isDevelopment) {\n    Meteor.startup(function() {\n      var ex;\n      try {\n        return steedosCore.init();\n      } catch (error) {\n        ex = error;\n        return console.log(ex);\n      }\n    });\n  }\n} catch (error) {\n  e = error;\n  console.log(e);\n}\n","Creator.deps = {\r\n\tapp: new Tracker.Dependency\r\n\tobject: new Tracker.Dependency\r\n};\r\n\r\nCreator._TEMPLATE = {\r\n\tApps: {},\r\n\tObjects: {}\r\n}\r\n\r\nMeteor.startup ->\r\n\tSimpleSchema.extendOptions({filtersFunction: Match.Optional(Match.OneOf(Function, String))})\r\n\tSimpleSchema.extendOptions({optionsFunction: Match.Optional(Match.OneOf(Function, String))})\r\n\tSimpleSchema.extendOptions({createFunction: Match.Optional(Match.OneOf(Function, String))})\r\n\r\n# Creator.fiberLoadObjects ä¾›steedos-clié¡¹ç›®ä½¿ç”¨\r\nif Meteor.isServer\r\n\tFiber = require('fibers')\r\n\tCreator.fiberLoadObjects = (obj, object_name)->\r\n\t\tFiber(()->\r\n\t\t\tCreator.loadObjects(obj, object_name)\r\n\t\t).run()\r\n\r\nCreator.loadObjects = (obj, object_name)->\r\n\tif !object_name\r\n\t\tobject_name = obj.name\r\n\r\n\tif !obj.list_views\r\n\t\tobj.list_views = {}\r\n\r\n\tif obj.space\r\n\t\tobject_name = Creator.getCollectionName(obj)\r\n\tif object_name == 'cfs_files_filerecord'\r\n\t\tobject_name = 'cfs.files.filerecord'\r\n\t\tobj = _.clone(obj)\r\n\t\tobj.name = object_name\r\n\t\tCreator.Objects[object_name] = obj\r\n\r\n\tCreator.convertObject(obj)\r\n\tnew Creator.Object(obj);\r\n\r\n\tCreator.initTriggers(object_name)\r\n\tCreator.initListViews(object_name)\r\n\treturn obj\r\n\r\nCreator.getObjectName = (object) ->\r\n\tif object.space\r\n\t\treturn \"c_#{object.space}_#{object.name}\"\r\n\treturn object.name\r\n\r\nCreator.getObject = (object_name, space_id)->\r\n\tif _.isArray(object_name)\r\n\t\treturn ;\r\n\tif Meteor.isClient\r\n\t\tCreator.deps?.object?.depend()\r\n\tif !object_name and Meteor.isClient\r\n\t\tobject_name = Session.get(\"object_name\")\r\n\r\n#\tif !space_id && object_name\r\n#\t\tif Meteor.isClient && !object_name.startsWith('c_')\r\n#\t\t\tspace_id = Session.get(\"spaceId\")\r\n\r\n\tif object_name\r\n#\t\tif space_id\r\n#\t\t\tobj = Creator.objectsByName[\"c_#{space_id}_#{object_name}\"]\r\n#\t\t\tif obj\r\n#\t\t\t\treturn obj\r\n#\r\n#\t\tobj = _.find Creator.objectsByName, (o)->\r\n#\t\t\t\treturn o._collection_name == object_name\r\n#\t\tif obj\r\n#\t\t\treturn obj\r\n\r\n\t\treturn Creator.objectsByName[object_name]\r\n\r\nCreator.getObjectById = (object_id)->\r\n\treturn _.findWhere(Creator.objectsByName, {_id: object_id})\r\n\r\nCreator.removeObject = (object_name)->\r\n\tconsole.log(\"removeObject\", object_name)\r\n\tdelete Creator.Objects[object_name]\r\n\tdelete Creator.objectsByName[object_name]\r\n\r\nCreator.getCollection = (object_name, spaceId)->\r\n\tif !object_name\r\n\t\tobject_name = Session.get(\"object_name\")\r\n\tif object_name\r\n\t\treturn Creator.Collections[Creator.getObject(object_name, spaceId)?._collection_name]\r\n\r\nCreator.removeCollection = (object_name)->\r\n\tdelete Creator.Collections[object_name]\r\n\r\nCreator.isSpaceAdmin = (spaceId, userId)->\r\n\tif Meteor.isClient\r\n\t\tif !spaceId\r\n\t\t\tspaceId = Session.get(\"spaceId\")\r\n\t\tif !userId\r\n\t\t\tuserId = Meteor.userId()\r\n\r\n\tspace = Creator.getObject(\"spaces\")?.db?.findOne(spaceId,{fields:{admins:1}})\r\n\tif space?.admins\r\n\t\treturn space.admins.indexOf(userId) >= 0\r\n\r\n\r\nCreator.evaluateFormula = (formular, context, options)->\r\n\r\n\tif !_.isString(formular)\r\n\t\treturn formular\r\n\r\n\tif Creator.Formular.checkFormula(formular)\r\n\t\treturn Creator.Formular.run(formular, context, options)\r\n\r\n\treturn formular\r\n\r\nCreator.evaluateFilters = (filters, context)->\r\n\tselector = {}\r\n\t_.each filters, (filter)->\r\n\t\tif filter?.length == 3\r\n\t\t\tname = filter[0]\r\n\t\t\taction = filter[1]\r\n\t\t\tvalue = Creator.evaluateFormula(filter[2], context)\r\n\t\t\tselector[name] = {}\r\n\t\t\tselector[name][action] = value\r\n\tconsole.log(\"evaluateFilters-->selector\", selector)\r\n\treturn selector\r\n\r\nCreator.isCommonSpace = (spaceId) ->\r\n\treturn spaceId == 'common'\r\n\r\n###\r\n\tdocsï¼šå¾…æŽ’åºçš„æ–‡æ¡£æ•°ç»„\r\n\tidsï¼š_idé›†åˆ\r\n\tid_key: é»˜è®¤ä¸º_id\r\n\treturn æŒ‰ç…§idsçš„é¡ºåºè¿”å›žæ–°çš„æ–‡æ¡£é›†åˆ\r\n###\r\nCreator.getOrderlySetByIds = (docs, ids, id_key, hit_first)->\r\n\r\n\tif !id_key\r\n\t\tid_key = \"_id\"\r\n\r\n\tif hit_first\r\n\r\n\t\t#ç”±äºŽä¸èƒ½ä½¿ç”¨_.findIndexå‡½æ•°ï¼Œå› æ­¤æ­¤å¤„å…ˆå°†å¯¹è±¡æ•°ç»„è½¬ä¸ºæ™®é€šæ•°ç»„ç±»åž‹ï¼Œåœ¨èŽ·å–å…¶index\r\n\t\tvalues = docs.getProperty(id_key)\r\n\r\n\t\treturn\t_.sortBy docs, (doc)->\r\n\t\t\t\t\t_index = ids.indexOf(doc[id_key])\r\n\t\t\t\t\tif _index > -1\r\n\t\t\t\t\t\treturn _index\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\treturn ids.length + _.indexOf(values, doc[id_key])\r\n\telse\r\n\t\treturn\t_.sortBy docs, (doc)->\r\n\t\t\treturn ids.indexOf(doc[id_key])\r\n\r\n###\r\n\tæŒ‰ç”¨æˆ·æ‰€å±žæœ¬åœ°åŒ–è¯­è¨€è¿›è¡ŒæŽ’åºï¼Œæ”¯æŒä¸­æ–‡ã€æ•°å€¼ã€æ—¥æœŸç­‰å­—æ®µæŽ’åº\r\n\tå¯¹äºŽObjectç±»åž‹ï¼Œå¦‚æžœæä¾›ä½œç”¨åŸŸä¸­keyå±žæ€§ï¼Œåˆ™å–å€¼ä¸ºvalue[key]è¿›è¡ŒæŽ’åºæ¯”è¾ƒï¼Œåä¹‹æ•´ä¸ªObject.toString()åŽæŽ’åºæ¯”è¾ƒ\r\n###\r\nCreator.sortingMethod = (value1, value2) ->\r\n\tif this.key\r\n\t\tvalue1 = value1[this.key]\r\n\t\tvalue2 = value2[this.key]\r\n\tif value1 instanceof Date\r\n\t\tvalue1 = value1.getTime()\r\n\tif value2 instanceof Date\r\n\t\tvalue2 = value2.getTime()\r\n\tif typeof value1 is \"number\" and typeof value2 is \"number\"\r\n\t\treturn value1 - value2\r\n\t# Handling null values\r\n\tisValue1Empty = value1 == null or value1 == undefined\r\n\tisValue2Empty = value2 == null or value2 == undefined\r\n\tif isValue1Empty and !isValue2Empty\r\n\t\treturn -1\r\n\tif isValue1Empty and isValue2Empty\r\n\t\treturn 0\r\n\tif !isValue1Empty and isValue2Empty\r\n\t\treturn 1\r\n\tlocale = Steedos.locale()\r\n\treturn value1.toString().localeCompare value2.toString(), locale\r\n\r\n\r\n# è¯¥å‡½æ•°åªåœ¨åˆå§‹åŒ–Objectæ—¶ï¼ŒæŠŠç›¸å…³å¯¹è±¡çš„è®¡ç®—ç»“æžœä¿å­˜åˆ°Objectçš„related_objectså±žæ€§ä¸­ï¼ŒåŽç»­å¯ä»¥ç›´æŽ¥ä»Žrelated_objectså±žæ€§ä¸­å–å¾—è®¡ç®—ç»“æžœè€Œä¸ç”¨å†æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ¥è®¡ç®—\r\nCreator.getObjectRelateds = (object_name)->\r\n\tif Meteor.isClient\r\n\t\tif !object_name\r\n\t\t\tobject_name = Session.get(\"object_name\")\r\n\r\n\trelated_objects = []\r\n\t# _object = Creator.getObject(object_name)\r\n\t# å› Creator.getObjectå‡½æ•°å†…éƒ¨è¦è°ƒç”¨è¯¥å‡½æ•°ï¼Œæ‰€ä»¥è¿™é‡Œä¸å¯ä»¥è°ƒç”¨Creator.getObjectå–å¯¹è±¡ï¼Œåªèƒ½è°ƒç”¨Creator.Objectsæ¥å–å¯¹è±¡\r\n\t_object = Creator.Objects[object_name]\r\n\tif !_object\r\n\t\treturn related_objects\r\n\t\r\n\trelatedList = _object.relatedList\r\n\tif Meteor.isClient && !_.isEmpty relatedList\r\n\t\trelatedListMap = {}\r\n\t\t_.each relatedList, (objName)->\r\n\t\t\trelatedListMap[objName] = {}\r\n\t\t_.each Creator.Objects, (related_object, related_object_name)->\r\n\t\t\t_.each related_object.fields, (related_field, related_field_name)->\r\n\t\t\t\tif (related_field.type == \"master_detail\" || related_field.type == \"lookup\") and related_field.reference_to and related_field.reference_to == object_name and relatedListMap[related_object_name]\r\n\t\t\t\t\trelatedListMap[related_object_name] = { object_name: related_object_name, foreign_key: related_field_name, sharing: related_field.sharing }\r\n\t\tif relatedListMap['cms_files']\r\n\t\t\trelatedListMap['cms_files'] = { object_name: \"cms_files\", foreign_key: \"parent\" }\r\n\t\tif relatedListMap['instances']\r\n\t\t\trelatedListMap['instances'] = { object_name: \"instances\", foreign_key: \"record_ids\" }\r\n\t\t_.each ['tasks', 'notes', 'events', 'approvals'], (enableObjName)->\r\n\t\t\tif relatedListMap[enableObjName]\r\n\t\t\t\trelatedListMap[enableObjName] = { object_name: enableObjName, foreign_key: \"related_to\" }\r\n\t\tif relatedListMap['audit_records']\r\n\t\t\t#record è¯¦ç»†ä¸‹çš„audit_recordsä»…modifyAllRecordsæƒé™å¯è§\r\n\t\t\tpermissions = Creator.getPermissions(object_name)\r\n\t\t\tif _object.enable_audit && permissions?.modifyAllRecords\r\n\t\t\t\trelatedListMap['audit_records'] = { object_name:\"audit_records\", foreign_key: \"related_to\" }\r\n\t\trelated_objects = _.values relatedListMap\r\n\t\treturn related_objects\r\n\r\n\tif _object.enable_files\r\n\t\trelated_objects.push {object_name:\"cms_files\", foreign_key: \"parent\"}\r\n\r\n\t_.each Creator.Objects, (related_object, related_object_name)->\r\n\t\t_.each related_object.fields, (related_field, related_field_name)->\r\n\t\t\tif (related_field.type == \"master_detail\" || (related_field.type == \"lookup\" && related_field.relatedList)) and related_field.reference_to and related_field.reference_to == object_name\r\n\t\t\t\tif related_object_name == \"object_fields\"\r\n\t\t\t\t\t#TODO å¾…ç›¸å…³åˆ—è¡¨æ”¯æŒæŽ’åºåŽï¼Œåˆ é™¤æ­¤åˆ¤æ–­\r\n\t\t\t\t\trelated_objects.splice(0, 0, {object_name:related_object_name, foreign_key: related_field_name})\r\n\t\t\t\telse\r\n\t\t\t\t\trelated_objects.push {object_name:related_object_name, foreign_key: related_field_name, sharing: related_field.sharing}\r\n\r\n\tif _object.enable_tasks\r\n\t\trelated_objects.push {object_name:\"tasks\", foreign_key: \"related_to\"}\r\n\tif _object.enable_notes\r\n\t\trelated_objects.push {object_name:\"notes\", foreign_key: \"related_to\"}\r\n\tif _object.enable_events\r\n\t\trelated_objects.push {object_name:\"events\", foreign_key: \"related_to\"}\r\n\tif _object.enable_instances\r\n\t\trelated_objects.push {object_name:\"instances\", foreign_key: \"record_ids\"}\r\n\tif _object.enable_approvals\r\n\t\trelated_objects.push {object_name:\"approvals\", foreign_key: \"related_to\"}\r\n\t#record è¯¦ç»†ä¸‹çš„audit_recordsä»…modifyAllRecordsæƒé™å¯è§\r\n\tif Meteor.isClient\r\n\t\tpermissions = Creator.getPermissions(object_name)\r\n\t\tif _object.enable_audit && permissions?.modifyAllRecords\r\n\t\t\trelated_objects.push {object_name:\"audit_records\", foreign_key: \"related_to\"}\r\n\r\n\treturn related_objects\r\n\r\nCreator.getUserContext = (userId, spaceId, isUnSafeMode)->\r\n\tif Meteor.isClient\r\n\t\treturn Creator.USER_CONTEXT\r\n\telse\r\n\t\tif !(userId and spaceId)\r\n\t\t\tthrow new Meteor.Error 500, \"the params userId and spaceId is required for the function Creator.getUserContext\"\r\n\t\t\treturn null\r\n\t\tsuFields = {name: 1, mobile: 1, position: 1, email: 1, company: 1, organization: 1, space: 1, company_id: 1, company_ids: 1}\r\n\t\t# check if user in the space\r\n\t\tsu = Creator.Collections[\"space_users\"].findOne({space: spaceId, user: userId}, {fields: suFields})\r\n\t\tif !su\r\n\t\t\tspaceId = null\r\n\r\n\t\t# if spaceId not exists, get the first one.\r\n\t\tif !spaceId\r\n\t\t\tif isUnSafeMode\r\n\t\t\t\tsu = Creator.Collections[\"space_users\"].findOne({user: userId}, {fields: suFields})\r\n\t\t\t\tif !su\r\n\t\t\t\t\treturn null\r\n\t\t\t\tspaceId = su.space\r\n\t\t\telse\r\n\t\t\t\treturn null\r\n\r\n\t\tUSER_CONTEXT = {}\r\n\t\tUSER_CONTEXT.userId = userId\r\n\t\tUSER_CONTEXT.spaceId = spaceId\r\n\t\tUSER_CONTEXT.user = {\r\n\t\t\t_id: userId\r\n\t\t\tname: su.name,\r\n\t\t\tmobile: su.mobile,\r\n\t\t\tposition: su.position,\r\n\t\t\temail: su.email\r\n\t\t\tcompany: su.company\r\n\t\t\tcompany_id: su.company_id\r\n\t\t\tcompany_ids: su.company_ids\r\n\t\t}\r\n\t\tspace_user_org = Creator.getCollection(\"organizations\")?.findOne(su.organization)\r\n\t\tif space_user_org\r\n\t\t\tUSER_CONTEXT.user.organization = {\r\n\t\t\t\t_id: space_user_org._id,\r\n\t\t\t\tname: space_user_org.name,\r\n\t\t\t\tfullname: space_user_org.fullname\r\n\t\t\t}\r\n\t\treturn USER_CONTEXT\r\n\r\nCreator.getRelativeUrl = (url)->\r\n\r\n\tif _.isFunction(Steedos.isCordova) && Steedos.isCordova() && (url?.startsWith(\"/assets\") || url?.startsWith(\"assets\") || url?.startsWith(\"/packages\"))\r\n\t\tif !/^\\//.test(url)\r\n\t\t\turl = \"/\" + url\r\n\t\treturn url\r\n\r\n\tif url\r\n\t\t# urlå¼€å¤´æ²¡æœ‰\"/\"ï¼Œéœ€è¦æ·»åŠ \"/\"\r\n\t\tif !/^\\//.test(url)\r\n\t\t\turl = \"/\" + url\r\n\t\treturn __meteor_runtime_config__.ROOT_URL_PATH_PREFIX + url\r\n\telse\r\n\t\treturn __meteor_runtime_config__.ROOT_URL_PATH_PREFIX\r\n\r\nCreator.getUserCompanyId = (userId, spaceId)->\r\n\tuserId = userId || Meteor.userId()\r\n\tif Meteor.isClient\r\n\t\tspaceId = spaceId || Session.get('spaceId')\r\n\telse\r\n\t\tif !spaceId\r\n\t\t\tthrow new Meteor.Error(400, 'miss spaceId')\r\n\tsu = Creator.getCollection('space_users').findOne({space: spaceId, user: userId}, {fields: {company_id:1}})\r\n\treturn su.company_id\r\n\r\nCreator.getUserCompanyIds = (userId, spaceId)->\r\n\tuserId = userId || Meteor.userId()\r\n\tif Meteor.isClient\r\n\t\tspaceId = spaceId || Session.get('spaceId')\r\n\telse\r\n\t\tif !spaceId\r\n\t\t\tthrow new Meteor.Error(400, 'miss spaceId')\r\n\tsu = Creator.getCollection('space_users').findOne({space: spaceId, user: userId}, {fields: {company_ids:1}})\r\n\treturn su?.company_ids\r\n\r\nCreator.processPermissions = (po)->\r\n\tif po.allowCreate\r\n\t\tpo.allowRead = true\r\n\tif po.allowEdit\r\n\t\tpo.allowRead = true\r\n\tif po.allowDelete\r\n\t\tpo.allowEdit = true\r\n\t\tpo.allowRead = true\r\n\tif po.viewAllRecords\r\n\t\tpo.allowRead = true\r\n\tif po.modifyAllRecords\r\n\t\tpo.allowRead = true\r\n\t\tpo.allowEdit = true\r\n\t\tpo.allowDelete = true\r\n\t\tpo.viewAllRecords = true\r\n\tif po.viewCompanyRecords\r\n\t\tpo.allowRead = true\r\n\tif po.modifyCompanyRecords\r\n\t\tpo.allowRead = true\r\n\t\tpo.allowEdit = true\r\n\t\tpo.allowDelete = true\r\n\t\tpo.viewCompanyRecords = true\r\n\treturn po\r\n\r\nCreator.getTemplateSpaceId = ()->\r\n\treturn Meteor.settings.public?.templateSpaceId\r\n\r\nCreator.getCloudAdminSpaceId = ()->\r\n\treturn Meteor.settings.public?.cloudAdminSpaceId\r\n\r\nCreator.isTemplateSpace = (spaceId)->\r\n\tif spaceId && Meteor.settings.public?.templateSpaceId == spaceId\r\n\t\treturn true\r\n\treturn false\r\n\r\nCreator.isCloudAdminSpace = (spaceId)->\r\n\tif spaceId && Meteor.settings.public?.cloudAdminSpaceId == spaceId\r\n\t\treturn true\r\n\treturn false\r\n\r\nif Meteor.isServer\r\n\tif process.env.STEEDOS_STORAGE_DIR\r\n\t\tCreator.steedosStorageDir = process.env.STEEDOS_STORAGE_DIR\r\n\telse\r\n\t\tpath = require('path')\r\n\t\tCreator.steedosStorageDir = path.resolve(path.join(__meteor_bootstrap__.serverDir, '../../../cfs'))\r\n","var Fiber, path;\n\nCreator.deps = {\n  app: new Tracker.Dependency,\n  object: new Tracker.Dependency\n};\n\nCreator._TEMPLATE = {\n  Apps: {},\n  Objects: {}\n};\n\nMeteor.startup(function() {\n  SimpleSchema.extendOptions({\n    filtersFunction: Match.Optional(Match.OneOf(Function, String))\n  });\n  SimpleSchema.extendOptions({\n    optionsFunction: Match.Optional(Match.OneOf(Function, String))\n  });\n  return SimpleSchema.extendOptions({\n    createFunction: Match.Optional(Match.OneOf(Function, String))\n  });\n});\n\nif (Meteor.isServer) {\n  Fiber = require('fibers');\n  Creator.fiberLoadObjects = function(obj, object_name) {\n    return Fiber(function() {\n      return Creator.loadObjects(obj, object_name);\n    }).run();\n  };\n}\n\nCreator.loadObjects = function(obj, object_name) {\n  if (!object_name) {\n    object_name = obj.name;\n  }\n  if (!obj.list_views) {\n    obj.list_views = {};\n  }\n  if (obj.space) {\n    object_name = Creator.getCollectionName(obj);\n  }\n  if (object_name === 'cfs_files_filerecord') {\n    object_name = 'cfs.files.filerecord';\n    obj = _.clone(obj);\n    obj.name = object_name;\n    Creator.Objects[object_name] = obj;\n  }\n  Creator.convertObject(obj);\n  new Creator.Object(obj);\n  Creator.initTriggers(object_name);\n  Creator.initListViews(object_name);\n  return obj;\n};\n\nCreator.getObjectName = function(object) {\n  if (object.space) {\n    return \"c_\" + object.space + \"_\" + object.name;\n  }\n  return object.name;\n};\n\nCreator.getObject = function(object_name, space_id) {\n  var ref, ref1;\n  if (_.isArray(object_name)) {\n    return;\n  }\n  if (Meteor.isClient) {\n    if ((ref = Creator.deps) != null) {\n      if ((ref1 = ref.object) != null) {\n        ref1.depend();\n      }\n    }\n  }\n  if (!object_name && Meteor.isClient) {\n    object_name = Session.get(\"object_name\");\n  }\n  if (object_name) {\n    return Creator.objectsByName[object_name];\n  }\n};\n\nCreator.getObjectById = function(object_id) {\n  return _.findWhere(Creator.objectsByName, {\n    _id: object_id\n  });\n};\n\nCreator.removeObject = function(object_name) {\n  console.log(\"removeObject\", object_name);\n  delete Creator.Objects[object_name];\n  return delete Creator.objectsByName[object_name];\n};\n\nCreator.getCollection = function(object_name, spaceId) {\n  var ref;\n  if (!object_name) {\n    object_name = Session.get(\"object_name\");\n  }\n  if (object_name) {\n    return Creator.Collections[(ref = Creator.getObject(object_name, spaceId)) != null ? ref._collection_name : void 0];\n  }\n};\n\nCreator.removeCollection = function(object_name) {\n  return delete Creator.Collections[object_name];\n};\n\nCreator.isSpaceAdmin = function(spaceId, userId) {\n  var ref, ref1, space;\n  if (Meteor.isClient) {\n    if (!spaceId) {\n      spaceId = Session.get(\"spaceId\");\n    }\n    if (!userId) {\n      userId = Meteor.userId();\n    }\n  }\n  space = (ref = Creator.getObject(\"spaces\")) != null ? (ref1 = ref.db) != null ? ref1.findOne(spaceId, {\n    fields: {\n      admins: 1\n    }\n  }) : void 0 : void 0;\n  if (space != null ? space.admins : void 0) {\n    return space.admins.indexOf(userId) >= 0;\n  }\n};\n\nCreator.evaluateFormula = function(formular, context, options) {\n  if (!_.isString(formular)) {\n    return formular;\n  }\n  if (Creator.Formular.checkFormula(formular)) {\n    return Creator.Formular.run(formular, context, options);\n  }\n  return formular;\n};\n\nCreator.evaluateFilters = function(filters, context) {\n  var selector;\n  selector = {};\n  _.each(filters, function(filter) {\n    var action, name, value;\n    if ((filter != null ? filter.length : void 0) === 3) {\n      name = filter[0];\n      action = filter[1];\n      value = Creator.evaluateFormula(filter[2], context);\n      selector[name] = {};\n      return selector[name][action] = value;\n    }\n  });\n  console.log(\"evaluateFilters-->selector\", selector);\n  return selector;\n};\n\nCreator.isCommonSpace = function(spaceId) {\n  return spaceId === 'common';\n};\n\n\n/*\n\tdocsï¼šå¾…æŽ’åºçš„æ–‡æ¡£æ•°ç»„\n\tidsï¼š_idé›†åˆ\n\tid_key: é»˜è®¤ä¸º_id\n\treturn æŒ‰ç…§idsçš„é¡ºåºè¿”å›žæ–°çš„æ–‡æ¡£é›†åˆ\n */\n\nCreator.getOrderlySetByIds = function(docs, ids, id_key, hit_first) {\n  var values;\n  if (!id_key) {\n    id_key = \"_id\";\n  }\n  if (hit_first) {\n    values = docs.getProperty(id_key);\n    return _.sortBy(docs, function(doc) {\n      var _index;\n      _index = ids.indexOf(doc[id_key]);\n      if (_index > -1) {\n        return _index;\n      } else {\n        return ids.length + _.indexOf(values, doc[id_key]);\n      }\n    });\n  } else {\n    return _.sortBy(docs, function(doc) {\n      return ids.indexOf(doc[id_key]);\n    });\n  }\n};\n\n\n/*\n\tæŒ‰ç”¨æˆ·æ‰€å±žæœ¬åœ°åŒ–è¯­è¨€è¿›è¡ŒæŽ’åºï¼Œæ”¯æŒä¸­æ–‡ã€æ•°å€¼ã€æ—¥æœŸç­‰å­—æ®µæŽ’åº\n\tå¯¹äºŽObjectç±»åž‹ï¼Œå¦‚æžœæä¾›ä½œç”¨åŸŸä¸­keyå±žæ€§ï¼Œåˆ™å–å€¼ä¸ºvalue[key]è¿›è¡ŒæŽ’åºæ¯”è¾ƒï¼Œåä¹‹æ•´ä¸ªObject.toString()åŽæŽ’åºæ¯”è¾ƒ\n */\n\nCreator.sortingMethod = function(value1, value2) {\n  var isValue1Empty, isValue2Empty, locale;\n  if (this.key) {\n    value1 = value1[this.key];\n    value2 = value2[this.key];\n  }\n  if (value1 instanceof Date) {\n    value1 = value1.getTime();\n  }\n  if (value2 instanceof Date) {\n    value2 = value2.getTime();\n  }\n  if (typeof value1 === \"number\" && typeof value2 === \"number\") {\n    return value1 - value2;\n  }\n  isValue1Empty = value1 === null || value1 === void 0;\n  isValue2Empty = value2 === null || value2 === void 0;\n  if (isValue1Empty && !isValue2Empty) {\n    return -1;\n  }\n  if (isValue1Empty && isValue2Empty) {\n    return 0;\n  }\n  if (!isValue1Empty && isValue2Empty) {\n    return 1;\n  }\n  locale = Steedos.locale();\n  return value1.toString().localeCompare(value2.toString(), locale);\n};\n\nCreator.getObjectRelateds = function(object_name) {\n  var _object, permissions, relatedList, relatedListMap, related_objects;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n  }\n  related_objects = [];\n  _object = Creator.Objects[object_name];\n  if (!_object) {\n    return related_objects;\n  }\n  relatedList = _object.relatedList;\n  if (Meteor.isClient && !_.isEmpty(relatedList)) {\n    relatedListMap = {};\n    _.each(relatedList, function(objName) {\n      return relatedListMap[objName] = {};\n    });\n    _.each(Creator.Objects, function(related_object, related_object_name) {\n      return _.each(related_object.fields, function(related_field, related_field_name) {\n        if ((related_field.type === \"master_detail\" || related_field.type === \"lookup\") && related_field.reference_to && related_field.reference_to === object_name && relatedListMap[related_object_name]) {\n          return relatedListMap[related_object_name] = {\n            object_name: related_object_name,\n            foreign_key: related_field_name,\n            sharing: related_field.sharing\n          };\n        }\n      });\n    });\n    if (relatedListMap['cms_files']) {\n      relatedListMap['cms_files'] = {\n        object_name: \"cms_files\",\n        foreign_key: \"parent\"\n      };\n    }\n    if (relatedListMap['instances']) {\n      relatedListMap['instances'] = {\n        object_name: \"instances\",\n        foreign_key: \"record_ids\"\n      };\n    }\n    _.each(['tasks', 'notes', 'events', 'approvals'], function(enableObjName) {\n      if (relatedListMap[enableObjName]) {\n        return relatedListMap[enableObjName] = {\n          object_name: enableObjName,\n          foreign_key: \"related_to\"\n        };\n      }\n    });\n    if (relatedListMap['audit_records']) {\n      permissions = Creator.getPermissions(object_name);\n      if (_object.enable_audit && (permissions != null ? permissions.modifyAllRecords : void 0)) {\n        relatedListMap['audit_records'] = {\n          object_name: \"audit_records\",\n          foreign_key: \"related_to\"\n        };\n      }\n    }\n    related_objects = _.values(relatedListMap);\n    return related_objects;\n  }\n  if (_object.enable_files) {\n    related_objects.push({\n      object_name: \"cms_files\",\n      foreign_key: \"parent\"\n    });\n  }\n  _.each(Creator.Objects, function(related_object, related_object_name) {\n    return _.each(related_object.fields, function(related_field, related_field_name) {\n      if ((related_field.type === \"master_detail\" || (related_field.type === \"lookup\" && related_field.relatedList)) && related_field.reference_to && related_field.reference_to === object_name) {\n        if (related_object_name === \"object_fields\") {\n          return related_objects.splice(0, 0, {\n            object_name: related_object_name,\n            foreign_key: related_field_name\n          });\n        } else {\n          return related_objects.push({\n            object_name: related_object_name,\n            foreign_key: related_field_name,\n            sharing: related_field.sharing\n          });\n        }\n      }\n    });\n  });\n  if (_object.enable_tasks) {\n    related_objects.push({\n      object_name: \"tasks\",\n      foreign_key: \"related_to\"\n    });\n  }\n  if (_object.enable_notes) {\n    related_objects.push({\n      object_name: \"notes\",\n      foreign_key: \"related_to\"\n    });\n  }\n  if (_object.enable_events) {\n    related_objects.push({\n      object_name: \"events\",\n      foreign_key: \"related_to\"\n    });\n  }\n  if (_object.enable_instances) {\n    related_objects.push({\n      object_name: \"instances\",\n      foreign_key: \"record_ids\"\n    });\n  }\n  if (_object.enable_approvals) {\n    related_objects.push({\n      object_name: \"approvals\",\n      foreign_key: \"related_to\"\n    });\n  }\n  if (Meteor.isClient) {\n    permissions = Creator.getPermissions(object_name);\n    if (_object.enable_audit && (permissions != null ? permissions.modifyAllRecords : void 0)) {\n      related_objects.push({\n        object_name: \"audit_records\",\n        foreign_key: \"related_to\"\n      });\n    }\n  }\n  return related_objects;\n};\n\nCreator.getUserContext = function(userId, spaceId, isUnSafeMode) {\n  var USER_CONTEXT, ref, space_user_org, su, suFields;\n  if (Meteor.isClient) {\n    return Creator.USER_CONTEXT;\n  } else {\n    if (!(userId && spaceId)) {\n      throw new Meteor.Error(500, \"the params userId and spaceId is required for the function Creator.getUserContext\");\n      return null;\n    }\n    suFields = {\n      name: 1,\n      mobile: 1,\n      position: 1,\n      email: 1,\n      company: 1,\n      organization: 1,\n      space: 1,\n      company_id: 1,\n      company_ids: 1\n    };\n    su = Creator.Collections[\"space_users\"].findOne({\n      space: spaceId,\n      user: userId\n    }, {\n      fields: suFields\n    });\n    if (!su) {\n      spaceId = null;\n    }\n    if (!spaceId) {\n      if (isUnSafeMode) {\n        su = Creator.Collections[\"space_users\"].findOne({\n          user: userId\n        }, {\n          fields: suFields\n        });\n        if (!su) {\n          return null;\n        }\n        spaceId = su.space;\n      } else {\n        return null;\n      }\n    }\n    USER_CONTEXT = {};\n    USER_CONTEXT.userId = userId;\n    USER_CONTEXT.spaceId = spaceId;\n    USER_CONTEXT.user = {\n      _id: userId,\n      name: su.name,\n      mobile: su.mobile,\n      position: su.position,\n      email: su.email,\n      company: su.company,\n      company_id: su.company_id,\n      company_ids: su.company_ids\n    };\n    space_user_org = (ref = Creator.getCollection(\"organizations\")) != null ? ref.findOne(su.organization) : void 0;\n    if (space_user_org) {\n      USER_CONTEXT.user.organization = {\n        _id: space_user_org._id,\n        name: space_user_org.name,\n        fullname: space_user_org.fullname\n      };\n    }\n    return USER_CONTEXT;\n  }\n};\n\nCreator.getRelativeUrl = function(url) {\n  if (_.isFunction(Steedos.isCordova) && Steedos.isCordova() && ((url != null ? url.startsWith(\"/assets\") : void 0) || (url != null ? url.startsWith(\"assets\") : void 0) || (url != null ? url.startsWith(\"/packages\") : void 0))) {\n    if (!/^\\//.test(url)) {\n      url = \"/\" + url;\n    }\n    return url;\n  }\n  if (url) {\n    if (!/^\\//.test(url)) {\n      url = \"/\" + url;\n    }\n    return __meteor_runtime_config__.ROOT_URL_PATH_PREFIX + url;\n  } else {\n    return __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n  }\n};\n\nCreator.getUserCompanyId = function(userId, spaceId) {\n  var su;\n  userId = userId || Meteor.userId();\n  if (Meteor.isClient) {\n    spaceId = spaceId || Session.get('spaceId');\n  } else {\n    if (!spaceId) {\n      throw new Meteor.Error(400, 'miss spaceId');\n    }\n  }\n  su = Creator.getCollection('space_users').findOne({\n    space: spaceId,\n    user: userId\n  }, {\n    fields: {\n      company_id: 1\n    }\n  });\n  return su.company_id;\n};\n\nCreator.getUserCompanyIds = function(userId, spaceId) {\n  var su;\n  userId = userId || Meteor.userId();\n  if (Meteor.isClient) {\n    spaceId = spaceId || Session.get('spaceId');\n  } else {\n    if (!spaceId) {\n      throw new Meteor.Error(400, 'miss spaceId');\n    }\n  }\n  su = Creator.getCollection('space_users').findOne({\n    space: spaceId,\n    user: userId\n  }, {\n    fields: {\n      company_ids: 1\n    }\n  });\n  return su != null ? su.company_ids : void 0;\n};\n\nCreator.processPermissions = function(po) {\n  if (po.allowCreate) {\n    po.allowRead = true;\n  }\n  if (po.allowEdit) {\n    po.allowRead = true;\n  }\n  if (po.allowDelete) {\n    po.allowEdit = true;\n    po.allowRead = true;\n  }\n  if (po.viewAllRecords) {\n    po.allowRead = true;\n  }\n  if (po.modifyAllRecords) {\n    po.allowRead = true;\n    po.allowEdit = true;\n    po.allowDelete = true;\n    po.viewAllRecords = true;\n  }\n  if (po.viewCompanyRecords) {\n    po.allowRead = true;\n  }\n  if (po.modifyCompanyRecords) {\n    po.allowRead = true;\n    po.allowEdit = true;\n    po.allowDelete = true;\n    po.viewCompanyRecords = true;\n  }\n  return po;\n};\n\nCreator.getTemplateSpaceId = function() {\n  var ref;\n  return (ref = Meteor.settings[\"public\"]) != null ? ref.templateSpaceId : void 0;\n};\n\nCreator.getCloudAdminSpaceId = function() {\n  var ref;\n  return (ref = Meteor.settings[\"public\"]) != null ? ref.cloudAdminSpaceId : void 0;\n};\n\nCreator.isTemplateSpace = function(spaceId) {\n  var ref;\n  if (spaceId && ((ref = Meteor.settings[\"public\"]) != null ? ref.templateSpaceId : void 0) === spaceId) {\n    return true;\n  }\n  return false;\n};\n\nCreator.isCloudAdminSpace = function(spaceId) {\n  var ref;\n  if (spaceId && ((ref = Meteor.settings[\"public\"]) != null ? ref.cloudAdminSpaceId : void 0) === spaceId) {\n    return true;\n  }\n  return false;\n};\n\nif (Meteor.isServer) {\n  if (process.env.STEEDOS_STORAGE_DIR) {\n    Creator.steedosStorageDir = process.env.STEEDOS_STORAGE_DIR;\n  } else {\n    path = require('path');\n    Creator.steedosStorageDir = path.resolve(path.join(__meteor_bootstrap__.serverDir, '../../../cfs'));\n  }\n}\n","Meteor.methods\r\n\t# ç”¨æˆ·èŽ·å–lookup ã€master_detailç±»åž‹å­—æ®µçš„é€‰é¡¹å€¼\r\n\t\"creator.object_options\": (options)->\r\n\t\tif options?.params?.reference_to\r\n\r\n\t\t\tobject = Creator.getObject(options.params.reference_to, options.params.space)\r\n\r\n\t\t\tname_field_key = object.NAME_FIELD_KEY\r\n\r\n\t\t\tquery = {}\r\n\t\t\tif options.params.space\r\n\t\t\t\tquery.space = options.params.space\r\n\r\n\t\t\t\tsort = options?.sort\r\n\r\n\t\t\t\tselected = options?.selected || []\r\n\r\n\t\t\t\toptions_limit = options?.options_limit || 10\r\n\r\n\t\t\t\tif options.searchText\r\n\t\t\t\t\tsearchTextQuery = {}\r\n\t\t\t\t\tsearchTextQuery[name_field_key] = {$regex: options.searchText}\r\n\r\n\t\t\t\tif options?.values?.length\r\n\t\t\t\t\tif options.searchText\r\n\t\t\t\t\t\tquery.$or = [{_id: {$in: options.values}}, searchTextQuery]\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tquery.$or = [{_id: {$in: options.values}}]\r\n\t\t\t\telse\r\n\t\t\t\t\tif options.searchText\r\n\t\t\t\t\t\t_.extend(query, searchTextQuery)\r\n\t\t\t\t\tquery._id = {$nin: selected}\r\n\r\n\t\t\t\tcollection = object.db\r\n\r\n\t\t\t\tif options.filterQuery\r\n\t\t\t\t\t_.extend query, options.filterQuery\r\n\r\n\t\t\t\tquery_options = {limit: options_limit}\r\n\r\n\t\t\t\tif sort && _.isObject(sort)\r\n\t\t\t\t\tquery_options.sort = sort\r\n\r\n\t\t\t\tif collection\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t\trecords = collection.find(query, query_options).fetch()\r\n\t\t\t\t\t\tresults = []\r\n\t\t\t\t\t\t_.each records, (record)->\r\n\t\t\t\t\t\t\tresults.push\r\n\t\t\t\t\t\t\t\tlabel: record[name_field_key]\r\n\t\t\t\t\t\t\t\tvalue: record._id\r\n\t\t\t\t\t\treturn results\r\n\t\t\t\t\tcatch e\r\n\t\t\t\t\t\tthrow new Meteor.Error 500, e.message + \"-->\" + JSON.stringify(options)\r\n\t\treturn [] ","Meteor.methods({\n  \"creator.object_options\": function(options) {\n    var collection, e, name_field_key, object, options_limit, query, query_options, records, ref, ref1, results, searchTextQuery, selected, sort;\n    if (options != null ? (ref = options.params) != null ? ref.reference_to : void 0 : void 0) {\n      object = Creator.getObject(options.params.reference_to, options.params.space);\n      name_field_key = object.NAME_FIELD_KEY;\n      query = {};\n      if (options.params.space) {\n        query.space = options.params.space;\n        sort = options != null ? options.sort : void 0;\n        selected = (options != null ? options.selected : void 0) || [];\n        options_limit = (options != null ? options.options_limit : void 0) || 10;\n        if (options.searchText) {\n          searchTextQuery = {};\n          searchTextQuery[name_field_key] = {\n            $regex: options.searchText\n          };\n        }\n        if (options != null ? (ref1 = options.values) != null ? ref1.length : void 0 : void 0) {\n          if (options.searchText) {\n            query.$or = [\n              {\n                _id: {\n                  $in: options.values\n                }\n              }, searchTextQuery\n            ];\n          } else {\n            query.$or = [\n              {\n                _id: {\n                  $in: options.values\n                }\n              }\n            ];\n          }\n        } else {\n          if (options.searchText) {\n            _.extend(query, searchTextQuery);\n          }\n          query._id = {\n            $nin: selected\n          };\n        }\n        collection = object.db;\n        if (options.filterQuery) {\n          _.extend(query, options.filterQuery);\n        }\n        query_options = {\n          limit: options_limit\n        };\n        if (sort && _.isObject(sort)) {\n          query_options.sort = sort;\n        }\n        if (collection) {\n          try {\n            records = collection.find(query, query_options).fetch();\n            results = [];\n            _.each(records, function(record) {\n              return results.push({\n                label: record[name_field_key],\n                value: record._id\n              });\n            });\n            return results;\n          } catch (error) {\n            e = error;\n            throw new Meteor.Error(500, e.message + \"-->\" + JSON.stringify(options));\n          }\n        }\n      }\n    }\n    return [];\n  }\n});\n","JsonRoutes.add 'post', '/api/workflow/view/:instanceId', (req, res, next) ->\r\n\ttry\r\n\t\tcurrent_user_info = uuflowManager.check_authorization(req)\r\n\t\tcurrent_user_id = current_user_info._id\r\n\r\n\t\thashData = req.body\r\n\t\tobject_name = hashData.object_name\r\n\t\trecord_id = hashData.record_id\r\n\t\tspace_id = hashData.space_id\r\n\r\n\t\tcheck object_name, String\r\n\t\tcheck record_id, String\r\n\t\tcheck space_id, String\r\n\r\n\t\tinsId = req.params.instanceId\r\n\t\tx_user_id = req.query['X-User-Id']\r\n\t\tx_auth_token = req.query['X-Auth-Token']\r\n\r\n\t\tredirect_url = \"/\"\r\n\t\tins = Creator.getCollection('instances').findOne(insId)\r\n\t\t# - æˆ‘çš„è‰ç¨¿å°±è·³è½¬è‡³è‰ç¨¿ç®±\r\n\t\t# - æˆ‘çš„å¾…å®¡æ ¸å°±è·³è½¬è‡³å¾…å®¡æ ¸\r\n\t\t# - ä¸æ˜¯æˆ‘çš„ç”³è¯·å•åˆ™è·³è½¬è‡³æ‰“å°é¡µé¢\r\n\t\t# - å¦‚ç”³è¯·å•ä¸å­˜åœ¨åˆ™æç¤ºç”¨æˆ·ç”³è¯·å•å·²åˆ é™¤ï¼Œå¹¶ä¸”æ›´æ–°recordçš„çŠ¶æ€ï¼Œä½¿ç”¨æˆ·å¯ä»¥é‡æ–°å‘èµ·å®¡æ‰¹\r\n\t\tif ins\r\n\t\t\tworkflowUrl = Meteor.settings.public.webservices.workflow.url\r\n\t\t\tbox = ''\r\n\t\t\tspaceId = ins.space\r\n\t\t\tflowId = ins.flow\r\n\r\n\t\t\tif (ins.inbox_users?.includes current_user_id) or (ins.cc_users?.includes current_user_id)\r\n\t\t\t\tbox = 'inbox'\r\n\t\t\telse if ins.outbox_users?.includes current_user_id\r\n\t\t\t\tbox = 'outbox'\r\n\t\t\telse if ins.state is 'draft' and ins.submitter is current_user_id\r\n\t\t\t\tbox = 'draft'\r\n\t\t\telse if ins.state is 'pending' and (ins.submitter is current_user_id or ins.applicant is current_user_id)\r\n\t\t\t\tbox = 'pending'\r\n\t\t\telse if ins.state is 'completed' and ins.submitter is current_user_id\r\n\t\t\t\tbox = 'completed'\r\n\t\t\telse\r\n\t\t\t\t# éªŒè¯login user_idå¯¹è¯¥æµç¨‹æœ‰ç®¡ç†ç”³è¯·å•çš„æƒé™\r\n\t\t\t\tpermissions = permissionManager.getFlowPermissions(flowId, current_user_id)\r\n\t\t\t\tspace = db.spaces.findOne(spaceId, { fields: { admins: 1 } })\r\n\t\t\t\tif permissions.includes(\"admin\") or space.admins.includes(current_user_id)\r\n\t\t\t\t\tbox = 'monitor'\r\n\r\n\t\t\tif box\r\n\t\t\t\tredirect_url = workflowUrl + \"workflow/space/#{spaceId}/#{box}/#{insId}?X-User-Id=#{x_user_id}&X-Auth-Token=#{x_auth_token}\"\r\n\t\t\telse\r\n\t\t\t\tredirect_url = workflowUrl + \"workflow/space/#{spaceId}/print/#{insId}?box=monitor&print_is_show_traces=1&print_is_show_attachments=1&X-User-Id=#{x_user_id}&X-Auth-Token=#{x_auth_token}\"\r\n\r\n\t\t\tJsonRoutes.sendResult res, {\r\n\t\t\t\tcode: 200\r\n\t\t\t\tdata: { redirect_url: redirect_url }\r\n\t\t\t}\r\n\t\t\treturn\r\n\t\telse\r\n\t\t\tcollection = Creator.getCollection(object_name, space_id)\r\n\t\t\tif collection\r\n\t\t\t\tcollection.update(record_id, {\r\n\t\t\t\t\t$pull: {\r\n\t\t\t\t\t\t\"instances\": {\r\n\t\t\t\t\t\t\t\"_id\": insId\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t\tthrow new Meteor.Error('error', 'ç”³è¯·å•å·²åˆ é™¤')\r\n\r\n\tcatch e\r\n\t\tJsonRoutes.sendResult res, {\r\n\t\t\tcode: 200\r\n\t\t\tdata: { errors: [{ errorMessage: e.reason || e.message }] }\r\n\t\t}\r\n\r\n","JsonRoutes.add('post', '/api/workflow/view/:instanceId', function(req, res, next) {\n  var box, collection, current_user_id, current_user_info, e, flowId, hashData, ins, insId, object_name, permissions, record_id, redirect_url, ref, ref1, ref2, space, spaceId, space_id, workflowUrl, x_auth_token, x_user_id;\n  try {\n    current_user_info = uuflowManager.check_authorization(req);\n    current_user_id = current_user_info._id;\n    hashData = req.body;\n    object_name = hashData.object_name;\n    record_id = hashData.record_id;\n    space_id = hashData.space_id;\n    check(object_name, String);\n    check(record_id, String);\n    check(space_id, String);\n    insId = req.params.instanceId;\n    x_user_id = req.query['X-User-Id'];\n    x_auth_token = req.query['X-Auth-Token'];\n    redirect_url = \"/\";\n    ins = Creator.getCollection('instances').findOne(insId);\n    if (ins) {\n      workflowUrl = Meteor.settings[\"public\"].webservices.workflow.url;\n      box = '';\n      spaceId = ins.space;\n      flowId = ins.flow;\n      if (((ref = ins.inbox_users) != null ? ref.includes(current_user_id) : void 0) || ((ref1 = ins.cc_users) != null ? ref1.includes(current_user_id) : void 0)) {\n        box = 'inbox';\n      } else if ((ref2 = ins.outbox_users) != null ? ref2.includes(current_user_id) : void 0) {\n        box = 'outbox';\n      } else if (ins.state === 'draft' && ins.submitter === current_user_id) {\n        box = 'draft';\n      } else if (ins.state === 'pending' && (ins.submitter === current_user_id || ins.applicant === current_user_id)) {\n        box = 'pending';\n      } else if (ins.state === 'completed' && ins.submitter === current_user_id) {\n        box = 'completed';\n      } else {\n        permissions = permissionManager.getFlowPermissions(flowId, current_user_id);\n        space = db.spaces.findOne(spaceId, {\n          fields: {\n            admins: 1\n          }\n        });\n        if (permissions.includes(\"admin\") || space.admins.includes(current_user_id)) {\n          box = 'monitor';\n        }\n      }\n      if (box) {\n        redirect_url = workflowUrl + (\"workflow/space/\" + spaceId + \"/\" + box + \"/\" + insId + \"?X-User-Id=\" + x_user_id + \"&X-Auth-Token=\" + x_auth_token);\n      } else {\n        redirect_url = workflowUrl + (\"workflow/space/\" + spaceId + \"/print/\" + insId + \"?box=monitor&print_is_show_traces=1&print_is_show_attachments=1&X-User-Id=\" + x_user_id + \"&X-Auth-Token=\" + x_auth_token);\n      }\n      JsonRoutes.sendResult(res, {\n        code: 200,\n        data: {\n          redirect_url: redirect_url\n        }\n      });\n    } else {\n      collection = Creator.getCollection(object_name, space_id);\n      if (collection) {\n        collection.update(record_id, {\n          $pull: {\n            \"instances\": {\n              \"_id\": insId\n            }\n          }\n        });\n        throw new Meteor.Error('error', 'ç”³è¯·å•å·²åˆ é™¤');\n      }\n    }\n  } catch (error) {\n    e = error;\n    return JsonRoutes.sendResult(res, {\n      code: 200,\n      data: {\n        errors: [\n          {\n            errorMessage: e.reason || e.message\n          }\n        ]\n      }\n    });\n  }\n});\n","Creator.getInitWidthPercent = (object_name, columns) ->\r\n\t_schema = Creator.getSchema(object_name)?._schema\r\n\tcolumn_num = 0\r\n\tif _schema\r\n\t\t_.each columns, (field_name) ->\r\n\t\t\tfield = _.pick(_schema, field_name)\r\n\t\t\tis_wide = field[field_name]?.autoform?.is_wide\r\n\t\t\tif is_wide\r\n\t\t\t\tcolumn_num += 2\r\n\t\t\telse\r\n\t\t\t\tcolumn_num += 1\r\n\r\n\t\tinit_width_percent = 100 / column_num\r\n\t\treturn init_width_percent\r\n\r\nCreator.getFieldIsWide = (object_name, field_name) ->\r\n\t_schema = Creator.getSchema(object_name)._schema\r\n\tif _schema\r\n\t\tfield = _.pick(_schema, field_name)\r\n\t\tis_wide = field[field_name]?.autoform?.is_wide\r\n\t\treturn is_wide\r\n\r\nCreator.getTabularOrder = (object_name, list_view_id, columns) ->\r\n\tsetting = Creator.Collections?.settings?.findOne({object_name: object_name, record_id: \"object_listviews\"})\r\n\tobj = Creator.getObject(object_name)\r\n\tcolumns = _.map columns, (column)->\r\n\t\tfield = obj.fields[column]\r\n\t\tif field?.type and !field.hidden\r\n\t\t\treturn column\r\n\t\telse\r\n\t\t\treturn undefined\r\n\tcolumns = _.compact columns\r\n\tif setting and setting.settings\r\n\t\tsort = setting.settings[list_view_id]?.sort || []\r\n\t\tsort = _.map sort, (order)->\r\n\t\t\tkey = order[0]\r\n\t\t\tindex = _.indexOf(columns, key)\r\n\t\t\torder[0] = index + 1\r\n\t\t\treturn order\r\n\t\treturn sort\r\n\treturn []\r\n\r\n\r\nCreator.initListViews = (object_name)->\r\n\tobject = Creator.getObject(object_name)\r\n\tcolumns = Creator.getObjectDefaultColumns(object_name) || [\"name\"]\r\n\textra_columns = [\"owner\"]\r\n\tdefault_extra_columns = Creator.getObjectDefaultExtraColumns(object_name) || [\"owner\"]\r\n\tif default_extra_columns\r\n\t\textra_columns = _.union extra_columns, default_extra_columns\r\n\r\n\torder = Creator.getObjectDefaultSort(object_name) || []\r\n\tif Meteor.isClient\r\n\t\tCreator.TabularSelectedIds?[object_name] = []\r\n\r\nCreator.convertListView = (default_columens, list_view, list_view_name)->\r\n\toitem = _.clone(list_view)\r\n\tif !_.has(oitem, \"name\")\r\n\t\toitem.name = list_view_name\r\n\tif !oitem.columns\r\n\t\tif default_columens\r\n\t\t\toitem.columns = default_columens\r\n\tif !oitem.columns\r\n\t\toitem.columns = [\"name\"]\r\n\r\n\tif Meteor.isClient\r\n\t\tif Creator.isCloudAdminSpace(Session.get(\"spaceId\")) && !_.include(oitem.columns, 'space')\r\n\t\t\toitem.columns.push('space')\r\n\r\n\r\n\tif !oitem.filter_scope\r\n\t\t# listviewè§†å›¾çš„filter_scopeé»˜è®¤å€¼æ”¹ä¸ºspace #131\r\n\t\toitem.filter_scope = \"space\"\r\n\r\n\tif !_.has(oitem, \"_id\")\r\n\t\toitem._id = list_view_name\r\n\telse\r\n\t\toitem.label = oitem.label || list_view.name\r\n\r\n\tif _.isString(oitem.options)\r\n\t\toitem.options = JSON.parse(oitem.options)\r\n\r\n\t_.forEach oitem.filters, (filter, _index)->\r\n\t\tif !_.isArray(filter) && _.isObject(filter)\r\n\t\t\tif Meteor.isServer\r\n\t\t\t\tif _.isFunction(filter?.value)\r\n\t\t\t\t\tfilter._value = filter.value.toString()\r\n\t\t\telse\r\n\t\t\t\tif _.isString(filter?._value)\r\n\t\t\t\t\tfilter.value = Creator.eval(\"(#{filter._value})\")\r\n\treturn oitem\r\n\r\n\r\nif Meteor.isClient\r\n\tCreator.getRelatedList = (object_name)->\r\n\t\tlist = []\r\n\t\trelated_objects = Creator.getRelatedObjects(object_name)\r\n\r\n\t\t_.each related_objects, (related_object_item) ->\r\n\t\t\trelated_object_name = related_object_item.object_name\r\n\t\t\trelated_field_name = related_object_item.foreign_key\r\n\t\t\tsharing = related_object_item.sharing\r\n\t\t\trelated_object = Creator.getObject(related_object_name)\r\n\t\t\tunless related_object\r\n\t\t\t\treturn\r\n\t\t\tcolumns = Creator.getObjectDefaultColumns(related_object_name) || [\"name\"]\r\n\t\t\tcolumns = _.without(columns, related_field_name)\r\n\r\n\t\t\torder = Creator.getObjectDefaultSort(related_object_name)\r\n\t\t\ttabular_order = Creator.transformSortToTabular(order, columns)\r\n\r\n\t\t\tif /\\w+\\.\\$\\.\\w+/g.test(related_field_name)\r\n\t\t\t\t# objectç±»åž‹å¸¦å­å±žæ€§çš„related_field_nameè¦åŽ»æŽ‰ä¸­é—´çš„ç¾Žå…ƒç¬¦å·ï¼Œå¦åˆ™æ˜¾ç¤ºä¸å‡ºå­—æ®µå€¼\r\n\t\t\t\trelated_field_name = related_field_name.replace(/\\$\\./,\"\")\r\n\t\t\trelated =\r\n\t\t\t\tobject_name: related_object_name\r\n\t\t\t\tcolumns: columns\r\n\t\t\t\trelated_field_name: related_field_name\r\n\t\t\t\tis_file: related_object_name == \"cms_files\"\r\n\t\t\t\tsharing: sharing\r\n\r\n\t\t\tlist.push related\r\n\r\n\t\treturn list\r\n\r\nCreator.getObjectFirstListView = (object_name)->\r\n\treturn _.first(Creator.getListViews(object_name))\r\n\r\n### \r\n\tå–å‡ºlist_view_idå¯¹åº”çš„è§†å›¾ï¼Œå¦‚æžœä¸å­˜åœ¨æˆ–è€…æ²¡æœ‰æƒé™ï¼Œå°±è¿”å›žç¬¬ä¸€ä¸ªè§†å›¾\r\n\texacä¸ºtrueæ—¶ï¼Œéœ€è¦å¼ºåˆ¶æŒ‰list_view_idç²¾ç¡®æŸ¥æ‰¾ï¼Œä¸é»˜è®¤è¿”å›žç¬¬ä¸€ä¸ªè§†å›¾\r\n###\r\nCreator.getListView = (object_name, list_view_id, exac)->\r\n\tif Meteor.isClient\r\n\t\tif !object_name\r\n\t\t\tobject_name = Session.get(\"object_name\")\r\n\t\tif !list_view_id\r\n\t\t\tlist_view_id = Session.get(\"list_view_id\")\r\n\tobject = Creator.getObject(object_name)\r\n\tif !object\r\n\t\treturn\r\n\tlistViews = Creator.getListViews(object_name)\r\n\tunless listViews?.length\r\n\t\treturn\r\n\tlist_view = _.findWhere(listViews,{\"_id\":list_view_id})\r\n\tunless list_view\r\n\t\t# å¦‚æžœä¸éœ€è¦å¼ºåˆ¶æŒ‰list_view_idç²¾ç¡®æŸ¥æ‰¾ï¼Œåˆ™é»˜è®¤è¿”å›žç¬¬ä¸€ä¸ªè§†å›¾ï¼Œåä¹‹è¿”å›žç©º\r\n\t\tif exac\r\n\t\t\treturn\r\n\t\telse\r\n\t\t\tlist_view = listViews[0]\r\n\treturn list_view\r\n\r\n#èŽ·å–list_view_idå¯¹åº”çš„è§†å›¾æ˜¯å¦æ˜¯æœ€è¿‘æŸ¥çœ‹è§†å›¾\r\nCreator.getListViewIsRecent = (object_name, list_view_id)->\r\n\tif Meteor.isClient\r\n\t\tif !object_name\r\n\t\t\tobject_name = Session.get(\"object_name\")\r\n\t\tif !list_view_id\r\n\t\t\tlist_view_id = Session.get(\"list_view_id\")\r\n\tif typeof(list_view_id) == \"string\"\r\n\t\tobject = Creator.getObject(object_name)\r\n\t\tif !object\r\n\t\t\treturn\r\n\t\tlistView = _.findWhere(object.list_views,{_id: list_view_id})\r\n\telse\r\n\t\tlistView = list_view_id\r\n\treturn listView?.name == \"recent\"\r\n\r\n\r\n###\r\n    èŽ·å–é»˜è®¤è§†å›¾\r\n###\r\nCreator.getObjectDefaultView = (object_name)->\r\n\tobject = Creator.getObject(object_name)\r\n\tif !object\r\n\t\tobject = Creator.Objects[object_name]\r\n\tif object?.list_views?.default\r\n\t\t#TODO æ­¤ä»£ç åªæ˜¯æš‚æ—¶å…¼å®¹ä»¥å‰codeä¸­å®šä¹‰çš„defaultè§†å›¾ï¼Œå¾…codeä¸­çš„defaultæ¸…ç†å®ŒæˆåŽï¼Œéœ€è¦åˆ é™¤æ­¤ä»£ç \r\n\t\tdefaultView = object.list_views.default\r\n\telse\r\n\t\t_.each object?.list_views, (list_view, key)->\r\n\t\t\tif list_view.name == \"all\" || key == \"all\"\r\n\t\t\t\tdefaultView = list_view\r\n\treturn defaultView;\r\n\r\n###\r\n    èŽ·å–å¯¹è±¡çš„åˆ—è¡¨é»˜è®¤æ˜¾ç¤ºå­—æ®µ\r\n###\r\nCreator.getObjectDefaultColumns = (object_name)->\r\n\tdefaultView = Creator.getObjectDefaultView(object_name)\r\n\treturn defaultView?.columns\r\n\r\n###\r\n\tèŽ·å–å¯¹è±¡çš„åˆ—è¡¨é»˜è®¤é¢å¤–åŠ è½½çš„å­—æ®µ\r\n###\r\nCreator.getObjectDefaultExtraColumns = (object_name)->\r\n\tdefaultView = Creator.getObjectDefaultView(object_name)\r\n\treturn defaultView?.extra_columns\r\n\r\n###\r\n\tèŽ·å–å¯¹è±¡çš„é»˜è®¤æŽ’åº\r\n###\r\nCreator.getObjectDefaultSort = (object_name)->\r\n\tdefaultView = Creator.getObjectDefaultView(object_name)\r\n\tif defaultView\r\n\t\tif defaultView.sort\r\n\t\t\treturn defaultView.sort\r\n\t\telse\r\n\t\t\treturn [[\"created\", \"desc\"]]\r\n\r\n\r\n###\r\n    åˆ¤æ–­æ˜¯å¦All view\r\n###\r\nCreator.isAllView = (list_view)->\r\n\treturn list_view?.name == \"all\"\r\n\r\n###\r\n    åˆ¤æ–­æ˜¯å¦æœ€è¿‘æŸ¥çœ‹ view\r\n###\r\nCreator.isRecentView = (list_view)->\r\n\treturn list_view?.name == \"recent\"\r\n\r\n###\r\n    å°†sortè½¬æ¢ä¸ºTabularæŽ§ä»¶æ‰€éœ€è¦çš„æ ¼å¼\r\n###\r\nCreator.transformSortToTabular = (sort, tabularColumns)->\r\n\ttabular_sort = []\r\n\t_.each sort, (item)->\r\n\t\tif _.isArray(item)\r\n\t\t\t# å…¼å®¹æ—§çš„æ•°æ®æ ¼å¼[[\"field_name\", \"order\"]]\r\n\t\t\tif item.length == 1\r\n\t\t\t\tcolumn_index = tabularColumns.indexOf(item[0])\r\n\t\t\t\tif column_index > -1\r\n\t\t\t\t\ttabular_sort.push [column_index, \"asc\"]\r\n\t\t\telse if item.length == 2\r\n\t\t\t\tcolumn_index = tabularColumns.indexOf(item[0])\r\n\t\t\t\tif column_index > -1\r\n\t\t\t\t\ttabular_sort.push [column_index, item[1]]\r\n\t\telse if _.isObject(item)\r\n\t\t\t#æ–°æ•°æ®æ ¼å¼ï¼š[{field_name: , order: }]\r\n\t\t\tfield_name = item.field_name\r\n\t\t\torder = item.order\r\n\t\t\tif field_name && order\r\n\t\t\t\tcolumn_index = tabularColumns.indexOf(field_name)\r\n\t\t\t\tif column_index > -1\r\n\t\t\t\t\ttabular_sort.push [column_index, order]\r\n\r\n\treturn tabular_sort\r\n\r\n###\r\n    å°†sortè½¬æ¢ä¸ºDevExpressæŽ§ä»¶æ‰€éœ€è¦çš„æ ¼å¼\r\n###\r\nCreator.transformSortToDX = (sort)->\r\n\tdx_sort = []\r\n\t_.each sort, (item)->\r\n\t\tif _.isArray(item)\r\n\t\t\t#å…¼å®¹æ—§æ ¼å¼ï¼š[[\"field_name\", \"order\"]]\r\n\t\t\tdx_sort.push(item)\r\n\t\telse if _.isObject(item)\r\n\t\t\t#æ–°æ•°æ®æ ¼å¼ï¼š[{field_name: , order: }]\r\n\t\t\tfield_name = item.field_name\r\n\t\t\torder = item.order\r\n\t\t\tif field_name && order\r\n\t\t\t\tdx_sort.push [field_name, order]\r\n\r\n\treturn dx_sort\r\n","Creator.getInitWidthPercent = function(object_name, columns) {\n  var _schema, column_num, init_width_percent, ref;\n  _schema = (ref = Creator.getSchema(object_name)) != null ? ref._schema : void 0;\n  column_num = 0;\n  if (_schema) {\n    _.each(columns, function(field_name) {\n      var field, is_wide, ref1, ref2;\n      field = _.pick(_schema, field_name);\n      is_wide = (ref1 = field[field_name]) != null ? (ref2 = ref1.autoform) != null ? ref2.is_wide : void 0 : void 0;\n      if (is_wide) {\n        return column_num += 2;\n      } else {\n        return column_num += 1;\n      }\n    });\n    init_width_percent = 100 / column_num;\n    return init_width_percent;\n  }\n};\n\nCreator.getFieldIsWide = function(object_name, field_name) {\n  var _schema, field, is_wide, ref, ref1;\n  _schema = Creator.getSchema(object_name)._schema;\n  if (_schema) {\n    field = _.pick(_schema, field_name);\n    is_wide = (ref = field[field_name]) != null ? (ref1 = ref.autoform) != null ? ref1.is_wide : void 0 : void 0;\n    return is_wide;\n  }\n};\n\nCreator.getTabularOrder = function(object_name, list_view_id, columns) {\n  var obj, ref, ref1, ref2, setting, sort;\n  setting = (ref = Creator.Collections) != null ? (ref1 = ref.settings) != null ? ref1.findOne({\n    object_name: object_name,\n    record_id: \"object_listviews\"\n  }) : void 0 : void 0;\n  obj = Creator.getObject(object_name);\n  columns = _.map(columns, function(column) {\n    var field;\n    field = obj.fields[column];\n    if ((field != null ? field.type : void 0) && !field.hidden) {\n      return column;\n    } else {\n      return void 0;\n    }\n  });\n  columns = _.compact(columns);\n  if (setting && setting.settings) {\n    sort = ((ref2 = setting.settings[list_view_id]) != null ? ref2.sort : void 0) || [];\n    sort = _.map(sort, function(order) {\n      var index, key;\n      key = order[0];\n      index = _.indexOf(columns, key);\n      order[0] = index + 1;\n      return order;\n    });\n    return sort;\n  }\n  return [];\n};\n\nCreator.initListViews = function(object_name) {\n  var columns, default_extra_columns, extra_columns, object, order, ref;\n  object = Creator.getObject(object_name);\n  columns = Creator.getObjectDefaultColumns(object_name) || [\"name\"];\n  extra_columns = [\"owner\"];\n  default_extra_columns = Creator.getObjectDefaultExtraColumns(object_name) || [\"owner\"];\n  if (default_extra_columns) {\n    extra_columns = _.union(extra_columns, default_extra_columns);\n  }\n  order = Creator.getObjectDefaultSort(object_name) || [];\n  if (Meteor.isClient) {\n    return (ref = Creator.TabularSelectedIds) != null ? ref[object_name] = [] : void 0;\n  }\n};\n\nCreator.convertListView = function(default_columens, list_view, list_view_name) {\n  var oitem;\n  oitem = _.clone(list_view);\n  if (!_.has(oitem, \"name\")) {\n    oitem.name = list_view_name;\n  }\n  if (!oitem.columns) {\n    if (default_columens) {\n      oitem.columns = default_columens;\n    }\n  }\n  if (!oitem.columns) {\n    oitem.columns = [\"name\"];\n  }\n  if (Meteor.isClient) {\n    if (Creator.isCloudAdminSpace(Session.get(\"spaceId\")) && !_.include(oitem.columns, 'space')) {\n      oitem.columns.push('space');\n    }\n  }\n  if (!oitem.filter_scope) {\n    oitem.filter_scope = \"space\";\n  }\n  if (!_.has(oitem, \"_id\")) {\n    oitem._id = list_view_name;\n  } else {\n    oitem.label = oitem.label || list_view.name;\n  }\n  if (_.isString(oitem.options)) {\n    oitem.options = JSON.parse(oitem.options);\n  }\n  _.forEach(oitem.filters, function(filter, _index) {\n    if (!_.isArray(filter) && _.isObject(filter)) {\n      if (Meteor.isServer) {\n        if (_.isFunction(filter != null ? filter.value : void 0)) {\n          return filter._value = filter.value.toString();\n        }\n      } else {\n        if (_.isString(filter != null ? filter._value : void 0)) {\n          return filter.value = Creator[\"eval\"](\"(\" + filter._value + \")\");\n        }\n      }\n    }\n  });\n  return oitem;\n};\n\nif (Meteor.isClient) {\n  Creator.getRelatedList = function(object_name) {\n    var list, related_objects;\n    list = [];\n    related_objects = Creator.getRelatedObjects(object_name);\n    _.each(related_objects, function(related_object_item) {\n      var columns, order, related, related_field_name, related_object, related_object_name, sharing, tabular_order;\n      related_object_name = related_object_item.object_name;\n      related_field_name = related_object_item.foreign_key;\n      sharing = related_object_item.sharing;\n      related_object = Creator.getObject(related_object_name);\n      if (!related_object) {\n        return;\n      }\n      columns = Creator.getObjectDefaultColumns(related_object_name) || [\"name\"];\n      columns = _.without(columns, related_field_name);\n      order = Creator.getObjectDefaultSort(related_object_name);\n      tabular_order = Creator.transformSortToTabular(order, columns);\n      if (/\\w+\\.\\$\\.\\w+/g.test(related_field_name)) {\n        related_field_name = related_field_name.replace(/\\$\\./, \"\");\n      }\n      related = {\n        object_name: related_object_name,\n        columns: columns,\n        related_field_name: related_field_name,\n        is_file: related_object_name === \"cms_files\",\n        sharing: sharing\n      };\n      return list.push(related);\n    });\n    return list;\n  };\n}\n\nCreator.getObjectFirstListView = function(object_name) {\n  return _.first(Creator.getListViews(object_name));\n};\n\n\n/* \n\tå–å‡ºlist_view_idå¯¹åº”çš„è§†å›¾ï¼Œå¦‚æžœä¸å­˜åœ¨æˆ–è€…æ²¡æœ‰æƒé™ï¼Œå°±è¿”å›žç¬¬ä¸€ä¸ªè§†å›¾\n\texacä¸ºtrueæ—¶ï¼Œéœ€è¦å¼ºåˆ¶æŒ‰list_view_idç²¾ç¡®æŸ¥æ‰¾ï¼Œä¸é»˜è®¤è¿”å›žç¬¬ä¸€ä¸ªè§†å›¾\n */\n\nCreator.getListView = function(object_name, list_view_id, exac) {\n  var listViews, list_view, object;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n    if (!list_view_id) {\n      list_view_id = Session.get(\"list_view_id\");\n    }\n  }\n  object = Creator.getObject(object_name);\n  if (!object) {\n    return;\n  }\n  listViews = Creator.getListViews(object_name);\n  if (!(listViews != null ? listViews.length : void 0)) {\n    return;\n  }\n  list_view = _.findWhere(listViews, {\n    \"_id\": list_view_id\n  });\n  if (!list_view) {\n    if (exac) {\n      return;\n    } else {\n      list_view = listViews[0];\n    }\n  }\n  return list_view;\n};\n\nCreator.getListViewIsRecent = function(object_name, list_view_id) {\n  var listView, object;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n    if (!list_view_id) {\n      list_view_id = Session.get(\"list_view_id\");\n    }\n  }\n  if (typeof list_view_id === \"string\") {\n    object = Creator.getObject(object_name);\n    if (!object) {\n      return;\n    }\n    listView = _.findWhere(object.list_views, {\n      _id: list_view_id\n    });\n  } else {\n    listView = list_view_id;\n  }\n  return (listView != null ? listView.name : void 0) === \"recent\";\n};\n\n\n/*\n    èŽ·å–é»˜è®¤è§†å›¾\n */\n\nCreator.getObjectDefaultView = function(object_name) {\n  var defaultView, object, ref;\n  object = Creator.getObject(object_name);\n  if (!object) {\n    object = Creator.Objects[object_name];\n  }\n  if (object != null ? (ref = object.list_views) != null ? ref[\"default\"] : void 0 : void 0) {\n    defaultView = object.list_views[\"default\"];\n  } else {\n    _.each(object != null ? object.list_views : void 0, function(list_view, key) {\n      if (list_view.name === \"all\" || key === \"all\") {\n        return defaultView = list_view;\n      }\n    });\n  }\n  return defaultView;\n};\n\n\n/*\n    èŽ·å–å¯¹è±¡çš„åˆ—è¡¨é»˜è®¤æ˜¾ç¤ºå­—æ®µ\n */\n\nCreator.getObjectDefaultColumns = function(object_name) {\n  var defaultView;\n  defaultView = Creator.getObjectDefaultView(object_name);\n  return defaultView != null ? defaultView.columns : void 0;\n};\n\n\n/*\n\tèŽ·å–å¯¹è±¡çš„åˆ—è¡¨é»˜è®¤é¢å¤–åŠ è½½çš„å­—æ®µ\n */\n\nCreator.getObjectDefaultExtraColumns = function(object_name) {\n  var defaultView;\n  defaultView = Creator.getObjectDefaultView(object_name);\n  return defaultView != null ? defaultView.extra_columns : void 0;\n};\n\n\n/*\n\tèŽ·å–å¯¹è±¡çš„é»˜è®¤æŽ’åº\n */\n\nCreator.getObjectDefaultSort = function(object_name) {\n  var defaultView;\n  defaultView = Creator.getObjectDefaultView(object_name);\n  if (defaultView) {\n    if (defaultView.sort) {\n      return defaultView.sort;\n    } else {\n      return [[\"created\", \"desc\"]];\n    }\n  }\n};\n\n\n/*\n    åˆ¤æ–­æ˜¯å¦All view\n */\n\nCreator.isAllView = function(list_view) {\n  return (list_view != null ? list_view.name : void 0) === \"all\";\n};\n\n\n/*\n    åˆ¤æ–­æ˜¯å¦æœ€è¿‘æŸ¥çœ‹ view\n */\n\nCreator.isRecentView = function(list_view) {\n  return (list_view != null ? list_view.name : void 0) === \"recent\";\n};\n\n\n/*\n    å°†sortè½¬æ¢ä¸ºTabularæŽ§ä»¶æ‰€éœ€è¦çš„æ ¼å¼\n */\n\nCreator.transformSortToTabular = function(sort, tabularColumns) {\n  var tabular_sort;\n  tabular_sort = [];\n  _.each(sort, function(item) {\n    var column_index, field_name, order;\n    if (_.isArray(item)) {\n      if (item.length === 1) {\n        column_index = tabularColumns.indexOf(item[0]);\n        if (column_index > -1) {\n          return tabular_sort.push([column_index, \"asc\"]);\n        }\n      } else if (item.length === 2) {\n        column_index = tabularColumns.indexOf(item[0]);\n        if (column_index > -1) {\n          return tabular_sort.push([column_index, item[1]]);\n        }\n      }\n    } else if (_.isObject(item)) {\n      field_name = item.field_name;\n      order = item.order;\n      if (field_name && order) {\n        column_index = tabularColumns.indexOf(field_name);\n        if (column_index > -1) {\n          return tabular_sort.push([column_index, order]);\n        }\n      }\n    }\n  });\n  return tabular_sort;\n};\n\n\n/*\n    å°†sortè½¬æ¢ä¸ºDevExpressæŽ§ä»¶æ‰€éœ€è¦çš„æ ¼å¼\n */\n\nCreator.transformSortToDX = function(sort) {\n  var dx_sort;\n  dx_sort = [];\n  _.each(sort, function(item) {\n    var field_name, order;\n    if (_.isArray(item)) {\n      return dx_sort.push(item);\n    } else if (_.isObject(item)) {\n      field_name = item.field_name;\n      order = item.order;\n      if (field_name && order) {\n        return dx_sort.push([field_name, order]);\n      }\n    }\n  });\n  return dx_sort;\n};\n","SimpleSchema.RegEx.code = new RegExp('^[a-zA-Z_][a-zA-Z0-9_]*$')\r\n\r\nif Meteor.isClient\r\n\tMeteor.startup ()->\r\n\t\t_regExMessages = SimpleSchema._globalMessages.regEx || []\r\n\t\t_regExMessages.push {exp: SimpleSchema.RegEx.code, msg: \"[label] åªèƒ½ä»¥å­—æ¯ã€_å¼€å¤´ï¼Œä¸”åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€_\"}\r\n\t\tSimpleSchema.messages({\r\n\t\t\tregEx: _regExMessages,\r\n\t\t})","SimpleSchema.RegEx.code = new RegExp('^[a-zA-Z_][a-zA-Z0-9_]*$');\n\nif (Meteor.isClient) {\n  Meteor.startup(function() {\n    var _regExMessages;\n    _regExMessages = SimpleSchema._globalMessages.regEx || [];\n    _regExMessages.push({\n      exp: SimpleSchema.RegEx.code,\n      msg: \"[label] åªèƒ½ä»¥å­—æ¯ã€_å¼€å¤´ï¼Œä¸”åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€_\"\n    });\n    return SimpleSchema.messages({\n      regEx: _regExMessages\n    });\n  });\n}\n","SimpleSchema.RegEx.field = new RegExp('^[a-zA-Z_]\\\\w*(\\\\.\\\\$\\\\.\\\\w+)?[a-zA-Z0-9]*$')\r\n\r\nif Meteor.isClient\r\n\tMeteor.startup ()->\r\n\t\t_regExMessages = SimpleSchema._globalMessages.regEx || []\r\n\t\t_regExMessages.push {exp: SimpleSchema.RegEx.field, msg: \"[label] åªèƒ½ä»¥å­—æ¯ã€_å¼€å¤´ï¼Œ.$.å‰åŽå¿…é¡»åŒ…å«å­—ç¬¦\"}\r\n\t\tSimpleSchema.messages({\r\n\t\t\tregEx: _regExMessages,\r\n\t\t})","SimpleSchema.RegEx.field = new RegExp('^[a-zA-Z_]\\\\w*(\\\\.\\\\$\\\\.\\\\w+)?[a-zA-Z0-9]*$');\n\nif (Meteor.isClient) {\n  Meteor.startup(function() {\n    var _regExMessages;\n    _regExMessages = SimpleSchema._globalMessages.regEx || [];\n    _regExMessages.push({\n      exp: SimpleSchema.RegEx.field,\n      msg: \"[label] åªèƒ½ä»¥å­—æ¯ã€_å¼€å¤´ï¼Œ.$.å‰åŽå¿…é¡»åŒ…å«å­—ç¬¦\"\n    });\n    return SimpleSchema.messages({\n      regEx: _regExMessages\n    });\n  });\n}\n","// å› ä¸ºmeteorç¼–è¯‘coffeescriptä¼šå¯¼è‡´evalå‡½æ•°æŠ¥é”™ï¼Œæ‰€ä»¥å•ç‹¬å†™åœ¨ä¸€ä¸ªjsæ–‡ä»¶ä¸­ã€‚\r\nCreator.evalInContext = function(js, context) {\r\n    //# Return the results of the in-line anonymous function we .call with the passed context\r\n    return function() { \r\n    \treturn eval(js); \r\n\t}.call(context);\r\n}\r\n\r\n\r\nCreator.eval = function(js){\r\n\ttry{\r\n\t\treturn eval(js)\r\n\t}catch (e){\r\n\t\tconsole.error(e, js);\r\n\t}\r\n};","\tgetOption = (option)->\r\n\t\tfoo = option.split(\":\")\r\n\t\tif foo.length > 1\r\n\t\t\treturn {label: foo[0], value: foo[1]}\r\n\t\telse\r\n\t\t\treturn {label: foo[0], value: foo[0]}\r\n\r\n\tconvertField = (object_name, field_name, field, spaceId)->\r\n\t\tif Meteor.isServer && spaceId && field.type == 'select'\r\n\t\t\tcode = field.picklist || \"#{object_name}.#{field_name}\";\r\n\t\t\tif code\r\n\t\t\t\tpicklist = Creator.getPicklist(code, spaceId);\r\n\t\t\t\tif picklist\r\n\t\t\t\t\toptions = [];\r\n\t\t\t\t\tallOptions = [];\r\n\t\t\t\t\tpicklistOptions = Creator.getPickListOptions(picklist)\r\n\t\t\t\t\tpicklistOptions = _.sortBy(picklistOptions, 'sort_no')?.reverse();\r\n\t\t\t\t\t_.each picklistOptions, (item)->\r\n\t\t\t\t\t\tlabel = item.name\r\n\t\t\t\t\t\tvalue = item.value || item.name\r\n\t\t\t\t\t\tallOptions.push({label: label, value: value, enable: item.enable})\r\n\t\t\t\t\t\tif item.enable\r\n\t\t\t\t\t\t\toptions.push({label: label, value: value})\r\n\t\t\t\t\t\tif item.default\r\n\t\t\t\t\t\t\tfield.defaultValue = value\r\n\t\t\t\t\tif options.length > 0\r\n\t\t\t\t\t\tfield.options = options\r\n\t\t\t\t\tif allOptions.length > 0\r\n\t\t\t\t\t\tfield.allOptions = allOptions\r\n\t\treturn field;\r\n\r\n\tCreator.convertObject = (object, spaceId)->\r\n\t\t_.forEach object.triggers, (trigger, key)->\r\n\r\n\t\t\tif (Meteor.isServer && trigger.on == \"server\") || (Meteor.isClient && trigger.on == \"client\")\r\n\t\t\t\t_todo_from_code = trigger?._todo\r\n\t\t\t\t_todo_from_db = trigger.todo\r\n\t\t\t\tif _todo_from_code && _.isString(_todo_from_code)\r\n\t\t\t\t\ttrigger.todo = Creator.eval(\"(#{_todo_from_code})\")\r\n\r\n\t\t\t\tif _todo_from_db && _.isString(_todo_from_db)\r\n\t\t\t\t\t#åªæœ‰updateæ—¶ï¼Œ fieldNames, modifier, options æ‰æœ‰å€¼\r\n\t\t\t\t\t#TODO æŽ§åˆ¶å¯ä½¿ç”¨çš„å˜é‡ï¼Œå°¤å…¶æ˜¯Collection\r\n\t\t\t\t\tif _todo_from_db.startsWith(\"function\")\r\n\t\t\t\t\t\ttrigger.todo = Creator.eval(\"(#{_todo_from_db})\")\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\ttrigger.todo = Creator.eval(\"(function(userId, doc, fieldNames, modifier, options){#{_todo_from_db}})\")\r\n\r\n\t\t\tif Meteor.isServer && trigger.on == \"client\"\r\n\t\t\t\t_todo = trigger.todo\r\n\t\t\t\tif _todo && _.isFunction(_todo)\r\n\t\t\t\t\ttrigger._todo = _todo.toString()\r\n\r\n\t\tif Meteor.isClient\r\n\t\t\t_.forEach object.actions, (action, key)->\r\n\t\t\t\t_todo_from_code = action?._todo\r\n\t\t\t\t_todo_from_db = action?.todo\r\n\t\t\t\tif _todo_from_code && _.isString(_todo_from_code)\r\n\t\t\t\t\t#TODO æŽ§åˆ¶å¯ä½¿ç”¨çš„å˜é‡\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t\taction.todo = Creator.eval(\"(#{_todo_from_code})\")\r\n\t\t\t\t\tcatch error\r\n\t\t\t\t\t\tconsole.error \"todo_from_code\", _todo_from_code\r\n\t\t\t\tif _todo_from_db && _.isString(_todo_from_db)\r\n\t\t\t\t\t#TODO æŽ§åˆ¶å¯ä½¿ç”¨çš„å˜é‡\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t\tif _todo_from_db.startsWith(\"function\")\r\n\t\t\t\t\t\t\taction.todo = Creator.eval(\"(#{_todo_from_db})\")\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tif _.isFunction(Creator.actionsByName[_todo_from_db])\r\n\t\t\t\t\t\t\t\taction.todo = _todo_from_db\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\taction.todo = Creator.eval(\"(function(){#{_todo_from_db}})\")\r\n\t\t\t\t\tcatch error\r\n\t\t\t\t\t\tconsole.error \"todo_from_db\", _todo_from_db, error\r\n\r\n\t\t\t\t_visible = action?._visible\r\n\t\t\t\tif _visible\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t\taction.visible = Creator.eval(\"(#{_visible})\")\r\n\t\t\t\t\tcatch error\r\n\t\t\t\t\t\tconsole.error \"action.visible to function error: \", error, _visible\r\n\t\telse\r\n\t\t\t_.forEach object.actions, (action, key)->\r\n\t\t\t\t_todo = action?.todo\r\n\t\t\t\tif _todo && _.isFunction(_todo)\r\n\t\t\t\t\t#TODO æŽ§åˆ¶å¯ä½¿ç”¨çš„å˜é‡\r\n\t\t\t\t\taction._todo = _todo.toString()\r\n\r\n\t\t\t\t_visible = action?.visible\r\n\r\n\t\t\t\tif _visible && _.isFunction(_visible)\r\n\t\t\t\t\taction._visible = _visible.toString()\r\n\r\n\t\t_.forEach object.fields, (field, key)->\r\n\r\n\t\t\tfield = convertField(object.name, key, field, spaceId);\r\n\r\n\t\t\tif field.options && _.isString(field.options)\r\n\t\t\t\ttry\r\n\t\t\t\t\t_options = []\r\n\t\t\t\t\t#æ”¯æŒ\\næˆ–è€…è‹±æ–‡é€—å·åˆ†å‰²,\r\n\t\t\t\t\t_.forEach field.options.split(\"\\n\"), (option)->\r\n\t\t\t\t\t\tif option.indexOf(\",\")\r\n\t\t\t\t\t\t\toptions = option.split(\",\")\r\n\t\t\t\t\t\t\t_.forEach options, (_option)->\r\n\t\t\t\t\t\t\t\t_options.push(getOption(_option))\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t_options.push(getOption(option))\r\n\t\t\t\t\tfield.options = _options\r\n\t\t\t\tcatch error\r\n\t\t\t\t\tconsole.error \"Creator.convertFieldsOptions\", field.options, error\r\n\r\n\t\t\telse if field.options && !_.isFunction(field.options) && !_.isArray(field.options) && _.isObject(field.options)\r\n\t\t\t\t_options = []\r\n\t\t\t\t_.each field.options, (v, k)->\r\n\t\t\t\t\t_options.push {label: v, value: k}\r\n\t\t\t\tfield.options = _options\r\n\r\n\t\t\tif Meteor.isServer\r\n\t\t\t\toptions = field.options\r\n\t\t\t\tif options && _.isFunction(options)\r\n\t\t\t\t\tfield._options = field.options.toString()\r\n\t\t\telse\r\n\t\t\t\toptions = field._options\r\n\t\t\t\tif options && _.isString(options)\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t\tfield.options = Creator.eval(\"(#{options})\")\r\n\t\t\t\t\tcatch error\r\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\r\n\r\n\t\t\tif Meteor.isServer\r\n\t\t\t\tregEx = field.regEx\r\n\t\t\t\tif regEx\r\n\t\t\t\t\tfield._regEx = field.regEx.toString()\r\n\t\t\telse\r\n\t\t\t\tregEx = field._regEx\r\n\t\t\t\tif regEx\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t\tfield.regEx = Creator.eval(\"(#{regEx})\")\r\n\t\t\t\t\tcatch error\r\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\r\n\r\n\t\t\tif Meteor.isServer\r\n\t\t\t\tmin = field.min\r\n\t\t\t\tif _.isFunction(min)\r\n\t\t\t\t\tfield._min = min.toString()\r\n\t\t\telse\r\n\t\t\t\tmin = field._min\r\n\t\t\t\tif _.isString(min)\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t\tfield.min = Creator.eval(\"(#{min})\")\r\n\t\t\t\t\tcatch error\r\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\r\n\r\n\t\t\tif Meteor.isServer\r\n\t\t\t\tmax = field.max\r\n\t\t\t\tif _.isFunction(max)\r\n\t\t\t\t\tfield._max = max.toString()\r\n\t\t\telse\r\n\t\t\t\tmax = field._max\r\n\t\t\t\tif _.isString(max)\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t\tfield.max = Creator.eval(\"(#{max})\")\r\n\t\t\t\t\tcatch error\r\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\r\n\r\n\t\t\tif Meteor.isServer\r\n\t\t\t\tif field.autoform\r\n\t\t\t\t\t_type = field.autoform.type\r\n\t\t\t\t\tif _type && _.isFunction(_type) && _type != Object && _type != String && _type != Number && _type != Boolean && !_.isArray(_type)\r\n\t\t\t\t\t\tfield.autoform._type = _type.toString()\r\n\t\t\telse\r\n\t\t\t\tif field.autoform\r\n\t\t\t\t\t_type = field.autoform._type\r\n\t\t\t\t\tif _type && _.isString(_type)\r\n\t\t\t\t\t\ttry\r\n\t\t\t\t\t\t\tfield.autoform.type = Creator.eval(\"(#{_type})\")\r\n\t\t\t\t\t\tcatch error\r\n\t\t\t\t\t\t\tconsole.error \"convert field -> type error\", field, error\r\n\r\n\t\t\tif Meteor.isServer\r\n\r\n\t\t\t\toptionsFunction = field.optionsFunction\r\n\t\t\t\treference_to = field.reference_to\r\n\t\t\t\tcreateFunction = field.createFunction\r\n\t\t\t\tbeforeOpenFunction = field.beforeOpenFunction\r\n\t\t\t\tfiltersFunction = field.filtersFunction\r\n\r\n\t\t\t\tif optionsFunction && _.isFunction(optionsFunction)\r\n\t\t\t\t\tfield._optionsFunction = optionsFunction.toString()\r\n\r\n\t\t\t\tif reference_to && _.isFunction(reference_to)\r\n\t\t\t\t\tfield._reference_to = reference_to.toString()\r\n\r\n\t\t\t\tif createFunction && _.isFunction(createFunction)\r\n\t\t\t\t\tfield._createFunction = createFunction.toString()\r\n\t\t\t\tif beforeOpenFunction && _.isFunction(beforeOpenFunction)\r\n\t\t\t\t\tfield._beforeOpenFunction = beforeOpenFunction.toString()\r\n\r\n\t\t\t\tif filtersFunction && _.isFunction(filtersFunction)\r\n\t\t\t\t\tfield._filtersFunction = filtersFunction.toString()\r\n\t\t\telse\r\n\r\n\t\t\t\toptionsFunction = field._optionsFunction || field.optionsFunction\r\n\t\t\t\treference_to = field._reference_to\r\n\t\t\t\tcreateFunction = field._createFunction\r\n\t\t\t\tbeforeOpenFunction = field._beforeOpenFunction\r\n\t\t\t\tfiltersFunction = field._filtersFunction\r\n\r\n\t\t\t\tif optionsFunction && _.isString(optionsFunction)\r\n\t\t\t\t\tfield.optionsFunction = Creator.eval(\"(#{optionsFunction})\")\r\n\r\n\t\t\t\tif reference_to && _.isString(reference_to)\r\n\t\t\t\t\tfield.reference_to = Creator.eval(\"(#{reference_to})\")\r\n\r\n\t\t\t\tif createFunction && _.isString(createFunction)\r\n\t\t\t\t\tfield.createFunction = Creator.eval(\"(#{createFunction})\")\r\n\r\n\t\t\t\tif beforeOpenFunction && _.isString(beforeOpenFunction)\r\n\t\t\t\t\tfield.beforeOpenFunction = Creator.eval(\"(#{beforeOpenFunction})\")\r\n\r\n\t\t\t\tif filtersFunction && _.isString(filtersFunction)\r\n\t\t\t\t\tfield.filtersFunction = Creator.eval(\"(#{filtersFunction})\")\r\n\r\n\t\t\tif Meteor.isServer\r\n\t\t\t\tdefaultValue = field.defaultValue\r\n\t\t\t\tif defaultValue && _.isFunction(defaultValue)\r\n\t\t\t\t\tfield._defaultValue = field.defaultValue.toString()\r\n\t\t\telse\r\n\t\t\t\tdefaultValue = field._defaultValue\r\n\r\n\t\t\t\tif !defaultValue && _.isString(field.defaultValue) && field.defaultValue.startsWith(\"function\")\r\n\t\t\t\t\tdefaultValue = field.defaultValue\r\n\r\n\t\t\t\tif defaultValue && _.isString(defaultValue)\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t\tfield.defaultValue = Creator.eval(\"(#{defaultValue})\")\r\n\t\t\t\t\tcatch error\r\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\r\n\t\t\t\r\n\t\t\tif Meteor.isServer\r\n\t\t\t\tis_company_limited = field.is_company_limited\r\n\t\t\t\tif is_company_limited && _.isFunction(is_company_limited)\r\n\t\t\t\t\tfield._is_company_limited = field.is_company_limited.toString()\r\n\t\t\telse\r\n\t\t\t\tis_company_limited = field._is_company_limited\r\n\t\t\t\tif is_company_limited && _.isString(is_company_limited)\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t\tfield.is_company_limited = Creator.eval(\"(#{is_company_limited})\")\r\n\t\t\t\t\tcatch error\r\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\r\n\r\n\t\t_.forEach object.list_views, (list_view, key) ->\r\n\t\t\t###\r\n\t\t\tè§†å›¾è¿‡è™‘å™¨éœ€è¦æ”¯æŒfunctionï¼ŒåŽå°è½¬æˆå­—ç¬¦ä¸²ï¼Œå‰å°evalæˆå‡½æ•°\r\n\t\t\tè®©è¿‡è™‘å™¨æ”¯æŒä¸¤ç§functionæ–¹å¼ï¼š\r\n\t\t\t1. æ•´ä¸ªfiltersä¸ºfunction:\r\n\t\t\tå¦‚ï¼š\r\n\t\t\tfilters: ()->\r\n\t\t\t\treturn [[[\"object_name\",\"=\",\"project_issues\"],'or',[\"object_name\",\"=\",\"tasks\"]]]\r\n\t\t\t2. filterså†…çš„filter.valueä¸ºfunction\r\n\t\t\tå¦‚ï¼š\r\n\t\t\tfilters: [[\"object_name\", \"=\", ()->\r\n\t\t\t\treturn \"project_issues\"\r\n\t\t\t]]\r\n\t\t\tæˆ–\r\n\t\t\tfilters: [{\r\n\t\t\t\t\"field\": \"object_name\"\r\n\t\t\t\t\"operation\": \"=\"\r\n\t\t\t\t\"value\": ()->\r\n\t\t\t\t\treturn \"project_issues\"\r\n\t\t\t}]\r\n\t\t\t###\r\n\t\t\tif _.isFunction(list_view.filters)\r\n\t\t\t\tif Meteor.isServer\r\n\t\t\t\t\tlist_view._filters = list_view.filters.toString()\r\n\t\t\telse if _.isString(list_view._filters)\r\n\t\t\t\tif Meteor.isClient\r\n\t\t\t\t\tlist_view.filters = Creator.eval(\"(#{list_view._filters})\")\r\n\t\t\telse\r\n\t\t\t\t_.forEach list_view.filters, (filter, _index)->\r\n\t\t\t\t\tif _.isArray(filter)\r\n\t\t\t\t\t\tif Meteor.isServer\r\n\t\t\t\t\t\t\tif filter.length == 3 and _.isFunction(filter[2])\r\n\t\t\t\t\t\t\t\tfilter[2] = filter[2].toString()\r\n\t\t\t\t\t\t\t\tfilter[3] = \"FUNCTION\"\r\n\t\t\t\t\t\t\telse if filter.length == 3 and _.isDate(filter[2])\r\n\t\t\t\t\t\t\t\t# å¦‚æžœæ˜¯Dateç±»åž‹ï¼Œåˆ™filter[2]å€¼åˆ°å‰ç«¯ä¼šè‡ªåŠ¨è½¬æˆå­—ç¬¦ä¸²ï¼Œæ ¼å¼ï¼š\"2018-03-29T03:43:21.787Z\"\r\n\t\t\t\t\t\t\t\t# åŒ…æ‹¬gridåˆ—è¡¨è¯·æ±‚çš„æŽ¥å£åœ¨å†…çš„æ‰€æœ‰ODataæŽ¥å£ï¼ŒDateç±»åž‹å­—æ®µéƒ½ä¼šä»¥ä¸Šè¿°æ ¼å¼è¿”å›ž\r\n\t\t\t\t\t\t\t\tfilter[3] = \"DATE\"\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tif filter.length == 4 and _.isString(filter[2]) and filter[3] == \"FUNCTION\"\r\n\t\t\t\t\t\t\t\tfilter[2] = Creator.eval(\"(#{filter[2]})\")\r\n\t\t\t\t\t\t\t\tfilter.pop()\r\n\t\t\t\t\t\t\tif filter.length == 4 and _.isString(filter[2]) and filter[3] == \"DATE\"\r\n\t\t\t\t\t\t\t\tfilter[2] = new Date(filter[2])\r\n\t\t\t\t\t\t\t\tfilter.pop()\r\n\t\t\t\t\telse if _.isObject(filter)\r\n\t\t\t\t\t\tif Meteor.isServer\r\n\t\t\t\t\t\t\tif _.isFunction(filter?.value)\r\n\t\t\t\t\t\t\t\tfilter._value = filter.value.toString()\r\n\t\t\t\t\t\t\telse if _.isDate(filter?.value)\r\n\t\t\t\t\t\t\t\tfilter._is_date = true\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tif _.isString(filter?._value)\r\n\t\t\t\t\t\t\t\tfilter.value = Creator.eval(\"(#{filter._value})\")\r\n\t\t\t\t\t\t\telse if filter._is_date == true\r\n\t\t\t\t\t\t\t\tfilter.value = new Date(filter.value)\r\n\r\n\t\tif Meteor.isServer\r\n\t\t\tif object.form && !_.isString(object.form)\r\n\t\t\t\tobject.form = JSON.stringify object.form, (key, val)->\r\n\t\t\t\t\tif _.isFunction(val)\r\n\t\t\t\t\t\treturn val + '';\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\treturn val;\r\n\t\telse if Meteor.isClient\r\n\t\t\tif object.form\r\n\t\t\t\tobject.form = JSON.parse object.form, (key, val)->\r\n\t\t\t\t\tif _.isString(val) && val.startsWith('function')\r\n\t\t\t\t\t\treturn Creator.eval(\"(#{val})\")\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\treturn val;\r\n\t\treturn object\r\n\r\n\r\n","var convertField, getOption;\n\ngetOption = function(option) {\n  var foo;\n  foo = option.split(\":\");\n  if (foo.length > 1) {\n    return {\n      label: foo[0],\n      value: foo[1]\n    };\n  } else {\n    return {\n      label: foo[0],\n      value: foo[0]\n    };\n  }\n};\n\nconvertField = function(object_name, field_name, field, spaceId) {\n  var allOptions, code, options, picklist, picklistOptions, ref;\n  if (Meteor.isServer && spaceId && field.type === 'select') {\n    code = field.picklist || (object_name + \".\" + field_name);\n    if (code) {\n      picklist = Creator.getPicklist(code, spaceId);\n      if (picklist) {\n        options = [];\n        allOptions = [];\n        picklistOptions = Creator.getPickListOptions(picklist);\n        picklistOptions = (ref = _.sortBy(picklistOptions, 'sort_no')) != null ? ref.reverse() : void 0;\n        _.each(picklistOptions, function(item) {\n          var label, value;\n          label = item.name;\n          value = item.value || item.name;\n          allOptions.push({\n            label: label,\n            value: value,\n            enable: item.enable\n          });\n          if (item.enable) {\n            options.push({\n              label: label,\n              value: value\n            });\n          }\n          if (item[\"default\"]) {\n            return field.defaultValue = value;\n          }\n        });\n        if (options.length > 0) {\n          field.options = options;\n        }\n        if (allOptions.length > 0) {\n          field.allOptions = allOptions;\n        }\n      }\n    }\n  }\n  return field;\n};\n\nCreator.convertObject = function(object, spaceId) {\n  _.forEach(object.triggers, function(trigger, key) {\n    var _todo, _todo_from_code, _todo_from_db;\n    if ((Meteor.isServer && trigger.on === \"server\") || (Meteor.isClient && trigger.on === \"client\")) {\n      _todo_from_code = trigger != null ? trigger._todo : void 0;\n      _todo_from_db = trigger.todo;\n      if (_todo_from_code && _.isString(_todo_from_code)) {\n        trigger.todo = Creator[\"eval\"](\"(\" + _todo_from_code + \")\");\n      }\n      if (_todo_from_db && _.isString(_todo_from_db)) {\n        if (_todo_from_db.startsWith(\"function\")) {\n          trigger.todo = Creator[\"eval\"](\"(\" + _todo_from_db + \")\");\n        } else {\n          trigger.todo = Creator[\"eval\"](\"(function(userId, doc, fieldNames, modifier, options){\" + _todo_from_db + \"})\");\n        }\n      }\n    }\n    if (Meteor.isServer && trigger.on === \"client\") {\n      _todo = trigger.todo;\n      if (_todo && _.isFunction(_todo)) {\n        return trigger._todo = _todo.toString();\n      }\n    }\n  });\n  if (Meteor.isClient) {\n    _.forEach(object.actions, function(action, key) {\n      var _todo_from_code, _todo_from_db, _visible, error;\n      _todo_from_code = action != null ? action._todo : void 0;\n      _todo_from_db = action != null ? action.todo : void 0;\n      if (_todo_from_code && _.isString(_todo_from_code)) {\n        try {\n          action.todo = Creator[\"eval\"](\"(\" + _todo_from_code + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"todo_from_code\", _todo_from_code);\n        }\n      }\n      if (_todo_from_db && _.isString(_todo_from_db)) {\n        try {\n          if (_todo_from_db.startsWith(\"function\")) {\n            action.todo = Creator[\"eval\"](\"(\" + _todo_from_db + \")\");\n          } else {\n            if (_.isFunction(Creator.actionsByName[_todo_from_db])) {\n              action.todo = _todo_from_db;\n            } else {\n              action.todo = Creator[\"eval\"](\"(function(){\" + _todo_from_db + \"})\");\n            }\n          }\n        } catch (error1) {\n          error = error1;\n          console.error(\"todo_from_db\", _todo_from_db, error);\n        }\n      }\n      _visible = action != null ? action._visible : void 0;\n      if (_visible) {\n        try {\n          return action.visible = Creator[\"eval\"](\"(\" + _visible + \")\");\n        } catch (error1) {\n          error = error1;\n          return console.error(\"action.visible to function error: \", error, _visible);\n        }\n      }\n    });\n  } else {\n    _.forEach(object.actions, function(action, key) {\n      var _todo, _visible;\n      _todo = action != null ? action.todo : void 0;\n      if (_todo && _.isFunction(_todo)) {\n        action._todo = _todo.toString();\n      }\n      _visible = action != null ? action.visible : void 0;\n      if (_visible && _.isFunction(_visible)) {\n        return action._visible = _visible.toString();\n      }\n    });\n  }\n  _.forEach(object.fields, function(field, key) {\n    var _options, _type, beforeOpenFunction, createFunction, defaultValue, error, filtersFunction, is_company_limited, max, min, options, optionsFunction, reference_to, regEx;\n    field = convertField(object.name, key, field, spaceId);\n    if (field.options && _.isString(field.options)) {\n      try {\n        _options = [];\n        _.forEach(field.options.split(\"\\n\"), function(option) {\n          var options;\n          if (option.indexOf(\",\")) {\n            options = option.split(\",\");\n            return _.forEach(options, function(_option) {\n              return _options.push(getOption(_option));\n            });\n          } else {\n            return _options.push(getOption(option));\n          }\n        });\n        field.options = _options;\n      } catch (error1) {\n        error = error1;\n        console.error(\"Creator.convertFieldsOptions\", field.options, error);\n      }\n    } else if (field.options && !_.isFunction(field.options) && !_.isArray(field.options) && _.isObject(field.options)) {\n      _options = [];\n      _.each(field.options, function(v, k) {\n        return _options.push({\n          label: v,\n          value: k\n        });\n      });\n      field.options = _options;\n    }\n    if (Meteor.isServer) {\n      options = field.options;\n      if (options && _.isFunction(options)) {\n        field._options = field.options.toString();\n      }\n    } else {\n      options = field._options;\n      if (options && _.isString(options)) {\n        try {\n          field.options = Creator[\"eval\"](\"(\" + options + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      regEx = field.regEx;\n      if (regEx) {\n        field._regEx = field.regEx.toString();\n      }\n    } else {\n      regEx = field._regEx;\n      if (regEx) {\n        try {\n          field.regEx = Creator[\"eval\"](\"(\" + regEx + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      min = field.min;\n      if (_.isFunction(min)) {\n        field._min = min.toString();\n      }\n    } else {\n      min = field._min;\n      if (_.isString(min)) {\n        try {\n          field.min = Creator[\"eval\"](\"(\" + min + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      max = field.max;\n      if (_.isFunction(max)) {\n        field._max = max.toString();\n      }\n    } else {\n      max = field._max;\n      if (_.isString(max)) {\n        try {\n          field.max = Creator[\"eval\"](\"(\" + max + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      if (field.autoform) {\n        _type = field.autoform.type;\n        if (_type && _.isFunction(_type) && _type !== Object && _type !== String && _type !== Number && _type !== Boolean && !_.isArray(_type)) {\n          field.autoform._type = _type.toString();\n        }\n      }\n    } else {\n      if (field.autoform) {\n        _type = field.autoform._type;\n        if (_type && _.isString(_type)) {\n          try {\n            field.autoform.type = Creator[\"eval\"](\"(\" + _type + \")\");\n          } catch (error1) {\n            error = error1;\n            console.error(\"convert field -> type error\", field, error);\n          }\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      optionsFunction = field.optionsFunction;\n      reference_to = field.reference_to;\n      createFunction = field.createFunction;\n      beforeOpenFunction = field.beforeOpenFunction;\n      filtersFunction = field.filtersFunction;\n      if (optionsFunction && _.isFunction(optionsFunction)) {\n        field._optionsFunction = optionsFunction.toString();\n      }\n      if (reference_to && _.isFunction(reference_to)) {\n        field._reference_to = reference_to.toString();\n      }\n      if (createFunction && _.isFunction(createFunction)) {\n        field._createFunction = createFunction.toString();\n      }\n      if (beforeOpenFunction && _.isFunction(beforeOpenFunction)) {\n        field._beforeOpenFunction = beforeOpenFunction.toString();\n      }\n      if (filtersFunction && _.isFunction(filtersFunction)) {\n        field._filtersFunction = filtersFunction.toString();\n      }\n    } else {\n      optionsFunction = field._optionsFunction || field.optionsFunction;\n      reference_to = field._reference_to;\n      createFunction = field._createFunction;\n      beforeOpenFunction = field._beforeOpenFunction;\n      filtersFunction = field._filtersFunction;\n      if (optionsFunction && _.isString(optionsFunction)) {\n        field.optionsFunction = Creator[\"eval\"](\"(\" + optionsFunction + \")\");\n      }\n      if (reference_to && _.isString(reference_to)) {\n        field.reference_to = Creator[\"eval\"](\"(\" + reference_to + \")\");\n      }\n      if (createFunction && _.isString(createFunction)) {\n        field.createFunction = Creator[\"eval\"](\"(\" + createFunction + \")\");\n      }\n      if (beforeOpenFunction && _.isString(beforeOpenFunction)) {\n        field.beforeOpenFunction = Creator[\"eval\"](\"(\" + beforeOpenFunction + \")\");\n      }\n      if (filtersFunction && _.isString(filtersFunction)) {\n        field.filtersFunction = Creator[\"eval\"](\"(\" + filtersFunction + \")\");\n      }\n    }\n    if (Meteor.isServer) {\n      defaultValue = field.defaultValue;\n      if (defaultValue && _.isFunction(defaultValue)) {\n        field._defaultValue = field.defaultValue.toString();\n      }\n    } else {\n      defaultValue = field._defaultValue;\n      if (!defaultValue && _.isString(field.defaultValue) && field.defaultValue.startsWith(\"function\")) {\n        defaultValue = field.defaultValue;\n      }\n      if (defaultValue && _.isString(defaultValue)) {\n        try {\n          field.defaultValue = Creator[\"eval\"](\"(\" + defaultValue + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      is_company_limited = field.is_company_limited;\n      if (is_company_limited && _.isFunction(is_company_limited)) {\n        return field._is_company_limited = field.is_company_limited.toString();\n      }\n    } else {\n      is_company_limited = field._is_company_limited;\n      if (is_company_limited && _.isString(is_company_limited)) {\n        try {\n          return field.is_company_limited = Creator[\"eval\"](\"(\" + is_company_limited + \")\");\n        } catch (error1) {\n          error = error1;\n          return console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n  });\n  _.forEach(object.list_views, function(list_view, key) {\n\n    /*\n    \t\t\tè§†å›¾è¿‡è™‘å™¨éœ€è¦æ”¯æŒfunctionï¼ŒåŽå°è½¬æˆå­—ç¬¦ä¸²ï¼Œå‰å°evalæˆå‡½æ•°\n    \t\t\tè®©è¿‡è™‘å™¨æ”¯æŒä¸¤ç§functionæ–¹å¼ï¼š\n    \t\t\t1. æ•´ä¸ªfiltersä¸ºfunction:\n    \t\t\tå¦‚ï¼š\n    \t\t\tfilters: ()->\n    \t\t\t\treturn [[[\"object_name\",\"=\",\"project_issues\"],'or',[\"object_name\",\"=\",\"tasks\"]]]\n    \t\t\t2. filterså†…çš„filter.valueä¸ºfunction\n    \t\t\tå¦‚ï¼š\n    \t\t\tfilters: [[\"object_name\", \"=\", ()->\n    \t\t\t\treturn \"project_issues\"\n    \t\t\t]]\n    \t\t\tæˆ–\n    \t\t\tfilters: [{\n    \t\t\t\t\"field\": \"object_name\"\n    \t\t\t\t\"operation\": \"=\"\n    \t\t\t\t\"value\": ()->\n    \t\t\t\t\treturn \"project_issues\"\n    \t\t\t}]\n     */\n    if (_.isFunction(list_view.filters)) {\n      if (Meteor.isServer) {\n        return list_view._filters = list_view.filters.toString();\n      }\n    } else if (_.isString(list_view._filters)) {\n      if (Meteor.isClient) {\n        return list_view.filters = Creator[\"eval\"](\"(\" + list_view._filters + \")\");\n      }\n    } else {\n      return _.forEach(list_view.filters, function(filter, _index) {\n        if (_.isArray(filter)) {\n          if (Meteor.isServer) {\n            if (filter.length === 3 && _.isFunction(filter[2])) {\n              filter[2] = filter[2].toString();\n              return filter[3] = \"FUNCTION\";\n            } else if (filter.length === 3 && _.isDate(filter[2])) {\n              return filter[3] = \"DATE\";\n            }\n          } else {\n            if (filter.length === 4 && _.isString(filter[2]) && filter[3] === \"FUNCTION\") {\n              filter[2] = Creator[\"eval\"](\"(\" + filter[2] + \")\");\n              filter.pop();\n            }\n            if (filter.length === 4 && _.isString(filter[2]) && filter[3] === \"DATE\") {\n              filter[2] = new Date(filter[2]);\n              return filter.pop();\n            }\n          }\n        } else if (_.isObject(filter)) {\n          if (Meteor.isServer) {\n            if (_.isFunction(filter != null ? filter.value : void 0)) {\n              return filter._value = filter.value.toString();\n            } else if (_.isDate(filter != null ? filter.value : void 0)) {\n              return filter._is_date = true;\n            }\n          } else {\n            if (_.isString(filter != null ? filter._value : void 0)) {\n              return filter.value = Creator[\"eval\"](\"(\" + filter._value + \")\");\n            } else if (filter._is_date === true) {\n              return filter.value = new Date(filter.value);\n            }\n          }\n        }\n      });\n    }\n  });\n  if (Meteor.isServer) {\n    if (object.form && !_.isString(object.form)) {\n      object.form = JSON.stringify(object.form, function(key, val) {\n        if (_.isFunction(val)) {\n          return val + '';\n        } else {\n          return val;\n        }\n      });\n    }\n  } else if (Meteor.isClient) {\n    if (object.form) {\n      object.form = JSON.parse(object.form, function(key, val) {\n        if (_.isString(val) && val.startsWith('function')) {\n          return Creator[\"eval\"](\"(\" + val + \")\");\n        } else {\n          return val;\n        }\n      });\n    }\n  }\n  return object;\n};\n","Creator.Formular = {}\r\n\r\nCreator.Formular.PREFIX = \"_VALUES\"\r\n\r\nCreator.Formular._prependPrefixForFormula = (prefix,fieldVariable)->\r\n\treg = /(\\{[^{}]*\\})/g;\r\n\r\n\trev = fieldVariable.replace reg, (m, $1)->\r\n\t\treturn prefix + $1.replace(/\\{\\s*/,\"[\\\"\").replace(/\\s*\\}/,\"\\\"]\").replace(/\\s*\\.\\s*/g,\"\\\"][\\\"\");\r\n\r\n\treturn rev\r\n\r\nCreator.Formular.checkFormula = (formula_str)->\r\n\tif _.isString(formula_str) && formula_str.indexOf(\"{\") > -1 && formula_str.indexOf(\"}\") > -1\r\n\t\treturn true\r\n\treturn false\r\n\r\nCreator.Formular.run = (formula_str, _CONTEXT, options)->\r\n\tif formula_str && _.isString(formula_str)\r\n\r\n\t\tif !_.isBoolean(options?.extend)\r\n\t\t\textend = true\r\n\r\n\t\t_VALUES = {}\r\n\t\t_VALUES = _.extend(_VALUES, _CONTEXT)\r\n\t\tif extend\r\n\t\t\t_VALUES = _.extend(_VALUES, Creator.getUserContext(options?.userId, options?.spaceId))\r\n\t\tformula_str = Creator.Formular._prependPrefixForFormula(\"this\", formula_str)\r\n\r\n\t\ttry\r\n\t\t\tdata = Creator.evalInContext(formula_str, _VALUES)   # æ­¤å¤„ä¸èƒ½ç”¨window.eval ï¼Œä¼šå¯¼è‡´å˜é‡ä½œç”¨åŸŸå¼‚å¸¸\r\n\t\t\treturn data\r\n\t\tcatch e\r\n\t\t\tconsole.error(\"Creator.Formular.run: #{formula_str}\", e)\r\n\t\t\tif Meteor.isClient\r\n\t\t\t\ttoastr?.error(\"å…¬å¼æ‰§è¡Œå‡ºé”™äº†ï¼Œè¯·æ£€æŸ¥å…¬å¼é…ç½®æ˜¯å¦æ­£ç¡®ï¼\")\r\n\t\t\tthrow new Meteor.Error 500, \"Creator.Formular.run: #{formula_str}#{e}\"\r\n\r\n\treturn formula_str\r\n","Creator.Formular = {};\n\nCreator.Formular.PREFIX = \"_VALUES\";\n\nCreator.Formular._prependPrefixForFormula = function(prefix, fieldVariable) {\n  var reg, rev;\n  reg = /(\\{[^{}]*\\})/g;\n  rev = fieldVariable.replace(reg, function(m, $1) {\n    return prefix + $1.replace(/\\{\\s*/, \"[\\\"\").replace(/\\s*\\}/, \"\\\"]\").replace(/\\s*\\.\\s*/g, \"\\\"][\\\"\");\n  });\n  return rev;\n};\n\nCreator.Formular.checkFormula = function(formula_str) {\n  if (_.isString(formula_str) && formula_str.indexOf(\"{\") > -1 && formula_str.indexOf(\"}\") > -1) {\n    return true;\n  }\n  return false;\n};\n\nCreator.Formular.run = function(formula_str, _CONTEXT, options) {\n  var _VALUES, data, e, extend;\n  if (formula_str && _.isString(formula_str)) {\n    if (!_.isBoolean(options != null ? options.extend : void 0)) {\n      extend = true;\n    }\n    _VALUES = {};\n    _VALUES = _.extend(_VALUES, _CONTEXT);\n    if (extend) {\n      _VALUES = _.extend(_VALUES, Creator.getUserContext(options != null ? options.userId : void 0, options != null ? options.spaceId : void 0));\n    }\n    formula_str = Creator.Formular._prependPrefixForFormula(\"this\", formula_str);\n    try {\n      data = Creator.evalInContext(formula_str, _VALUES);\n      return data;\n    } catch (error) {\n      e = error;\n      console.error(\"Creator.Formular.run: \" + formula_str, e);\n      if (Meteor.isClient) {\n        if (typeof toastr !== \"undefined\" && toastr !== null) {\n          toastr.error(\"å…¬å¼æ‰§è¡Œå‡ºé”™äº†ï¼Œè¯·æ£€æŸ¥å…¬å¼é…ç½®æ˜¯å¦æ­£ç¡®ï¼\");\n        }\n      }\n      throw new Meteor.Error(500, \"Creator.Formular.run: \" + formula_str + e);\n    }\n  }\n  return formula_str;\n};\n","clone = require('clone');\r\nCreator.objectsByName = {}   # æ­¤å¯¹è±¡åªèƒ½åœ¨ç¡®ä¿æ‰€æœ‰Objectåˆå§‹åŒ–å®ŒæˆåŽè°ƒç”¨ï¼Œ å¦åˆ™èŽ·å–åˆ°çš„objectä¸å…¨\r\n\r\nCreator.formatObjectName = (object_name)->\r\n\tif object_name.startsWith('cfs.files.')\r\n\t\tobject_name = object_name.replace(new RegExp('\\\\.', 'g'), '_')\r\n\treturn object_name\r\n\r\nCreator.Object = (options)->\r\n\tself = this\r\n\tif (!options.name)\r\n\t\tconsole.error(options)\r\n\t\tthrow new Error('Creator.Object options must specify name');\r\n\r\n\tself._id = options._id || options.name\r\n\tself.space = options.space\r\n\tself.name = options.name\r\n\tself.label = options.label\r\n\tself.icon = options.icon\r\n\tself.description = options.description\r\n\tself.is_view = options.is_view\r\n\tself.form = options.form\r\n\tif !_.isBoolean(options.is_enable)  || options.is_enable == true\r\n\t\tself.is_enable = true\r\n\telse\r\n\t\tself.is_enable = false\r\n\tself.enable_search = options.enable_search\r\n\tself.enable_files = options.enable_files\r\n\tself.enable_tasks = options.enable_tasks\r\n\tself.enable_notes = options.enable_notes\r\n\tself.enable_audit = options.enable_audit\r\n\tself.hidden = options.hidden\r\n\tself.enable_api = (options.enable_api == undefined) or options.enable_api\r\n\tself.custom = options.custom\r\n\tself.enable_share = options.enable_share\r\n\tself.enable_instances = options.enable_instances\r\n\tif Meteor.isClient\r\n\t\tif Creator.isCloudAdminSpace(Session.get(\"spaceId\"))\r\n\t\t\tself.enable_tree = false\r\n\t\telse\r\n\t\t\tself.enable_tree = options.enable_tree\r\n\t\t\tself.sidebar = _.clone(options.sidebar)\r\n\telse\r\n\t\tself.sidebar = _.clone(options.sidebar)\r\n\t\tself.enable_tree = options.enable_tree\r\n\tself.open_window = options.open_window\r\n\tself.filter_company = options.filter_company\r\n\tself.calendar = _.clone(options.calendar)\r\n\tself.enable_chatter = options.enable_chatter\r\n\tself.enable_trash = options.enable_trash\r\n\tself.enable_space_global = options.enable_space_global\r\n\tself.enable_approvals = options.enable_approvals\r\n\tself.enable_follow = options.enable_follow\r\n\tself.enable_workflow = options.enable_workflow\r\n\tif _.has(options, 'in_development')\r\n\t\tself.in_development = options.in_development\r\n\tself.idFieldName = '_id'\r\n\tif options.database_name\r\n\t\tself.database_name = options.database_name\r\n\tif (!options.fields)\r\n\t\tconsole.error(options)\r\n\t\tthrow new Error('Creator.Object options must specify name');\r\n\r\n\tself.fields = clone(options.fields)\r\n\r\n\t_.each self.fields, (field, field_name)->\r\n\t\tif field_name == 'name' || field.is_name\r\n\t\t\tself.NAME_FIELD_KEY = field_name\r\n\t\tif field.primary\r\n\t\t\tself.idFieldName = field_name\r\n\t\tif Meteor.isClient\r\n\t\t\tif Creator.isCloudAdminSpace(Session.get(\"spaceId\"))\r\n\t\t\t\tif field_name == 'space'\r\n\t\t\t\t\tfield.filterable = true\r\n\t\t\t\t\tfield.hidden = false\r\n\r\n\tif !options.database_name || options.database_name == 'meteor-mongo'\r\n\t\t_.each Creator.baseObject.fields, (field, field_name)->\r\n\t\t\tif !self.fields[field_name]\r\n\t\t\t\tself.fields[field_name] = {}\r\n\t\t\tself.fields[field_name] = _.extend(_.clone(field), self.fields[field_name])\r\n\r\n\tself.list_views = {}\r\n\tdefaultColumns = Creator.getObjectDefaultColumns(self.name)\r\n\t_.each options.list_views, (item, item_name)->\r\n\t\toitem = Creator.convertListView(defaultColumns, item, item_name)\r\n\t\tself.list_views[item_name] = oitem\r\n\r\n\tself.triggers = _.clone(Creator.baseObject.triggers)\r\n\t_.each options.triggers, (item, item_name)->\r\n\t\tif !self.triggers[item_name]\r\n\t\t\tself.triggers[item_name] = {}\r\n\t\tself.triggers[item_name].name = item_name\r\n\t\tself.triggers[item_name] = _.extend(_.clone(self.triggers[item_name]), item)\r\n\r\n\tself.actions = _.clone(Creator.baseObject.actions)\r\n\t_.each options.actions, (item, item_name)->\r\n\t\tif !self.actions[item_name]\r\n\t\t\tself.actions[item_name] = {}\r\n\t\tcopyItem = _.clone(self.actions[item_name])\r\n\t\tdelete self.actions[item_name] #å…ˆåˆ é™¤ç›¸å…³å±žæ€§å†é‡å»ºæ‰èƒ½ä¿è¯åŽç»­é‡å¤å®šä¹‰çš„å±žæ€§é¡ºåºç”Ÿæ•ˆ\r\n\t\tself.actions[item_name] = _.extend(copyItem, item)\r\n\r\n\t_.each self.actions, (item, item_name)->\r\n\t\titem.name = item_name\r\n\r\n\tself.related_objects = Creator.getObjectRelateds(self.name)\r\n\r\n\t# è®©æ‰€æœ‰objecté»˜è®¤æœ‰æ‰€æœ‰list_views/actions/related_objects/readable_fields/editable_fieldså®Œæ•´æƒé™ï¼Œè¯¥æƒé™å¯èƒ½è¢«æ•°æ®åº“ä¸­è®¾ç½®çš„admin/useræƒé™è¦†ç›–\r\n\tself.permission_set = _.clone(Creator.baseObject.permission_set)\r\n\t# defaultListViews = _.keys(self.list_views)\r\n\t# defaultActions = _.keys(self.actions)\r\n\t# defaultRelatedObjects = _.pluck(self.related_objects,\"object_name\")\r\n\t# defaultReadableFields = []\r\n\t# defaultEditableFields = []\r\n\t# _.each self.fields, (field, field_name)->\r\n\t# \tif !(field.hidden)    #231 omitå­—æ®µæ”¯æŒåœ¨éžç¼–è¾‘é¡µé¢æŸ¥çœ‹, å› æ­¤åˆ é™¤äº†æ­¤å¤„å¯¹omitçš„åˆ¤æ–­\r\n\t# \t\tdefaultReadableFields.push field_name\r\n\t# \t\tif !field.readonly\r\n\t# \t\t\tdefaultEditableFields.push field_name\r\n\r\n\t# _.each self.permission_set, (item, item_name)->\r\n\t# \tif item_name == \"none\"\r\n\t# \t\treturn\r\n\t# \tif self.list_views\r\n\t# \t\tself.permission_set[item_name].list_views = defaultListViews\r\n\t# \tif self.actions\r\n\t# \t\tself.permission_set[item_name].actions = defaultActions\r\n\t# \tif self.related_objects\r\n\t# \t\tself.permission_set[item_name].related_objects = defaultRelatedObjects\r\n\t# \tif self.fields\r\n\t# \t\tself.permission_set[item_name].readable_fields = defaultReadableFields\r\n\t# \t\tself.permission_set[item_name].editable_fields = defaultEditableFields\r\n\tunless options.permission_set\r\n\t\toptions.permission_set = {}\r\n\tif !(options.permission_set?.admin)\r\n\t\toptions.permission_set.admin = _.clone(self.permission_set[\"admin\"])\r\n\tif !(options.permission_set?.user)\r\n\t\toptions.permission_set.user = _.clone(self.permission_set[\"user\"])\r\n\t_.each options.permission_set, (item, item_name)->\r\n\t\tif !self.permission_set[item_name]\r\n\t\t\tself.permission_set[item_name] = {}\r\n\t\tself.permission_set[item_name] = _.extend(_.clone(self.permission_set[item_name]), item)\r\n\r\n\t# å‰ç«¯æ ¹æ®permissionsæ”¹å†™fieldç›¸å…³å±žæ€§ï¼ŒåŽç«¯åªè¦èµ°é»˜è®¤å±žæ€§å°±è¡Œï¼Œä¸éœ€è¦æ”¹å†™\r\n\tif Meteor.isClient\r\n\t\tpermissions = options.permissions\r\n\t\tdisabled_list_views = permissions?.disabled_list_views\r\n\t\tif disabled_list_views?.length\r\n\t\t\tdefaultListViewId = options.list_views?.all?._id\r\n\t\t\tif defaultListViewId\r\n\t\t\t\t# æŠŠè§†å›¾æƒé™é…ç½®ä¸­é»˜è®¤çš„allè§†å›¾idè½¬æ¢æˆallå…³é”®å­—\r\n\t\t\t\tpermissions.disabled_list_views = _.map disabled_list_views, (list_view_item) ->\r\n\t\t\t\t\treturn if defaultListViewId == list_view_item then \"all\" else list_view_item\r\n\t\tself.permissions = new ReactiveVar(permissions)\r\n#\t\t_.each self.fields, (field, field_name)->\r\n#\t\t\tif field\r\n#\t\t\t\tif _.indexOf(permissions?.unreadable_fields, field_name) < 0\r\n#\t\t\t\t\tif field.hidden\r\n#\t\t\t\t\t\treturn\r\n#\t\t\t\t\tif _.indexOf(permissions?.uneditable_fields, field_name) > -1\r\n#\t\t\t\t\t\tfield.readonly = true\r\n#\t\t\t\t\t\tfield.disabled = true\r\n#\t\t\t\t\t\t# å½“åªè¯»æ—¶ï¼Œå¦‚æžœä¸åŽ»æŽ‰å¿…å¡«å­—æ®µï¼Œautoformæ˜¯ä¼šæŠ¥é”™çš„\r\n#\t\t\t\t\t\tfield.required = false\r\n#\t\t\t\telse\r\n#\t\t\t\t\tfield.hidden = true\r\n\telse\r\n\t\tself.permissions = null\r\n\r\n\t_db = Creator.createCollection(options)\r\n\r\n\tCreator.Collections[_db._name] = _db\r\n\r\n\tself.db = _db\r\n\r\n\tself._collection_name = _db._name\r\n\r\n\tschema = Creator.getObjectSchema(self)\r\n\tself.schema = new SimpleSchema(schema)\r\n\tif self.name != \"users\" and self.name != \"cfs.files.filerecord\" && !self.is_view && !_.contains([\"flows\", \"forms\", \"instances\", \"organizations\"], self.name)\r\n\t\tif Meteor.isClient\r\n\t\t\t_db.attachSchema(self.schema, {replace: true})\r\n\t\telse\r\n\t\t\t_db.attachSchema(self.schema, {replace: true})\r\n\tif self.name == \"users\"\r\n\t\t_db._simpleSchema = self.schema\r\n\r\n\tif _.contains([\"flows\", \"forms\", \"instances\", \"organizations\"], self.name)\r\n\t\tif Meteor.isClient\r\n\t\t\t_db.attachSchema(self.schema, {replace: true})\r\n\r\n\tCreator.objectsByName[self._collection_name] = self\r\n\r\n\treturn self\r\n\r\n# Creator.Object.prototype.i18n = ()->\r\n# \t# set object label\r\n# \tself = this\r\n\r\n# \tkey = self.name\r\n# \tif t(key) == key\r\n# \t\tif !self.label\r\n# \t\t\tself.label = self.name\r\n# \telse\r\n# \t\tself.label = t(key)\r\n\r\n# \t# set field labels\r\n# \t_.each self.fields, (field, field_name)->\r\n# \t\tfkey = self.name + \"_\" + field_name\r\n# \t\tif t(fkey) == fkey\r\n# \t\t\tif !field.label\r\n# \t\t\t\tfield.label = field_name\r\n# \t\telse\r\n# \t\t\tfield.label = t(fkey)\r\n# \t\tself.schema?._schema?[field_name]?.label = field.label\r\n\r\n\r\n# \t# set listview labels\r\n# \t_.each self.list_views, (item, item_name)->\r\n# \t\ti18n_key = self.name + \"_listview_\" + item_name\r\n# \t\tif t(i18n_key) == i18n_key\r\n# \t\t\tif !item.label\r\n# \t\t\t\titem.label = item_name\r\n# \t\telse\r\n# \t\t\titem.label = t(i18n_key)\r\n\r\n\r\nCreator.getObjectODataRouterPrefix = (object)->\r\n\tif object\r\n\t\tif !object.database_name || object.database_name == 'meteor-mongo'\r\n\t\t\treturn \"/api/odata/v4\"\r\n\t\telse\r\n\t\t\treturn \"/api/odata/#{object.database_name}\"\r\n\r\n# if Meteor.isClient\r\n\r\n# \tMeteor.startup ->\r\n# \t\tTracker.autorun ->\r\n# \t\t\tif Session.get(\"steedos-locale\") && Creator.bootstrapLoaded?.get()\r\n# \t\t\t\t_.each Creator.objectsByName, (object, object_name)->\r\n# \t\t\t\t\tobject.i18n()\r\n\r\nMeteor.startup ->\r\n\tif !Creator.bootstrapLoaded && Creator.Objects\r\n\t\t_.each Creator.Objects, (object)->\r\n\t\t\tnew Creator.Object(object)\r\n\r\n","var clone;\n\nclone = require('clone');\n\nCreator.objectsByName = {};\n\nCreator.formatObjectName = function(object_name) {\n  if (object_name.startsWith('cfs.files.')) {\n    object_name = object_name.replace(new RegExp('\\\\.', 'g'), '_');\n  }\n  return object_name;\n};\n\nCreator.Object = function(options) {\n  var _db, defaultColumns, defaultListViewId, disabled_list_views, permissions, ref, ref1, ref2, ref3, schema, self;\n  self = this;\n  if (!options.name) {\n    console.error(options);\n    throw new Error('Creator.Object options must specify name');\n  }\n  self._id = options._id || options.name;\n  self.space = options.space;\n  self.name = options.name;\n  self.label = options.label;\n  self.icon = options.icon;\n  self.description = options.description;\n  self.is_view = options.is_view;\n  self.form = options.form;\n  if (!_.isBoolean(options.is_enable) || options.is_enable === true) {\n    self.is_enable = true;\n  } else {\n    self.is_enable = false;\n  }\n  self.enable_search = options.enable_search;\n  self.enable_files = options.enable_files;\n  self.enable_tasks = options.enable_tasks;\n  self.enable_notes = options.enable_notes;\n  self.enable_audit = options.enable_audit;\n  self.hidden = options.hidden;\n  self.enable_api = (options.enable_api === void 0) || options.enable_api;\n  self.custom = options.custom;\n  self.enable_share = options.enable_share;\n  self.enable_instances = options.enable_instances;\n  if (Meteor.isClient) {\n    if (Creator.isCloudAdminSpace(Session.get(\"spaceId\"))) {\n      self.enable_tree = false;\n    } else {\n      self.enable_tree = options.enable_tree;\n      self.sidebar = _.clone(options.sidebar);\n    }\n  } else {\n    self.sidebar = _.clone(options.sidebar);\n    self.enable_tree = options.enable_tree;\n  }\n  self.open_window = options.open_window;\n  self.filter_company = options.filter_company;\n  self.calendar = _.clone(options.calendar);\n  self.enable_chatter = options.enable_chatter;\n  self.enable_trash = options.enable_trash;\n  self.enable_space_global = options.enable_space_global;\n  self.enable_approvals = options.enable_approvals;\n  self.enable_follow = options.enable_follow;\n  self.enable_workflow = options.enable_workflow;\n  if (_.has(options, 'in_development')) {\n    self.in_development = options.in_development;\n  }\n  self.idFieldName = '_id';\n  if (options.database_name) {\n    self.database_name = options.database_name;\n  }\n  if (!options.fields) {\n    console.error(options);\n    throw new Error('Creator.Object options must specify name');\n  }\n  self.fields = clone(options.fields);\n  _.each(self.fields, function(field, field_name) {\n    if (field_name === 'name' || field.is_name) {\n      self.NAME_FIELD_KEY = field_name;\n    }\n    if (field.primary) {\n      self.idFieldName = field_name;\n    }\n    if (Meteor.isClient) {\n      if (Creator.isCloudAdminSpace(Session.get(\"spaceId\"))) {\n        if (field_name === 'space') {\n          field.filterable = true;\n          return field.hidden = false;\n        }\n      }\n    }\n  });\n  if (!options.database_name || options.database_name === 'meteor-mongo') {\n    _.each(Creator.baseObject.fields, function(field, field_name) {\n      if (!self.fields[field_name]) {\n        self.fields[field_name] = {};\n      }\n      return self.fields[field_name] = _.extend(_.clone(field), self.fields[field_name]);\n    });\n  }\n  self.list_views = {};\n  defaultColumns = Creator.getObjectDefaultColumns(self.name);\n  _.each(options.list_views, function(item, item_name) {\n    var oitem;\n    oitem = Creator.convertListView(defaultColumns, item, item_name);\n    return self.list_views[item_name] = oitem;\n  });\n  self.triggers = _.clone(Creator.baseObject.triggers);\n  _.each(options.triggers, function(item, item_name) {\n    if (!self.triggers[item_name]) {\n      self.triggers[item_name] = {};\n    }\n    self.triggers[item_name].name = item_name;\n    return self.triggers[item_name] = _.extend(_.clone(self.triggers[item_name]), item);\n  });\n  self.actions = _.clone(Creator.baseObject.actions);\n  _.each(options.actions, function(item, item_name) {\n    var copyItem;\n    if (!self.actions[item_name]) {\n      self.actions[item_name] = {};\n    }\n    copyItem = _.clone(self.actions[item_name]);\n    delete self.actions[item_name];\n    return self.actions[item_name] = _.extend(copyItem, item);\n  });\n  _.each(self.actions, function(item, item_name) {\n    return item.name = item_name;\n  });\n  self.related_objects = Creator.getObjectRelateds(self.name);\n  self.permission_set = _.clone(Creator.baseObject.permission_set);\n  if (!options.permission_set) {\n    options.permission_set = {};\n  }\n  if (!((ref = options.permission_set) != null ? ref.admin : void 0)) {\n    options.permission_set.admin = _.clone(self.permission_set[\"admin\"]);\n  }\n  if (!((ref1 = options.permission_set) != null ? ref1.user : void 0)) {\n    options.permission_set.user = _.clone(self.permission_set[\"user\"]);\n  }\n  _.each(options.permission_set, function(item, item_name) {\n    if (!self.permission_set[item_name]) {\n      self.permission_set[item_name] = {};\n    }\n    return self.permission_set[item_name] = _.extend(_.clone(self.permission_set[item_name]), item);\n  });\n  if (Meteor.isClient) {\n    permissions = options.permissions;\n    disabled_list_views = permissions != null ? permissions.disabled_list_views : void 0;\n    if (disabled_list_views != null ? disabled_list_views.length : void 0) {\n      defaultListViewId = (ref2 = options.list_views) != null ? (ref3 = ref2.all) != null ? ref3._id : void 0 : void 0;\n      if (defaultListViewId) {\n        permissions.disabled_list_views = _.map(disabled_list_views, function(list_view_item) {\n          if (defaultListViewId === list_view_item) {\n            return \"all\";\n          } else {\n            return list_view_item;\n          }\n        });\n      }\n    }\n    self.permissions = new ReactiveVar(permissions);\n  } else {\n    self.permissions = null;\n  }\n  _db = Creator.createCollection(options);\n  Creator.Collections[_db._name] = _db;\n  self.db = _db;\n  self._collection_name = _db._name;\n  schema = Creator.getObjectSchema(self);\n  self.schema = new SimpleSchema(schema);\n  if (self.name !== \"users\" && self.name !== \"cfs.files.filerecord\" && !self.is_view && !_.contains([\"flows\", \"forms\", \"instances\", \"organizations\"], self.name)) {\n    if (Meteor.isClient) {\n      _db.attachSchema(self.schema, {\n        replace: true\n      });\n    } else {\n      _db.attachSchema(self.schema, {\n        replace: true\n      });\n    }\n  }\n  if (self.name === \"users\") {\n    _db._simpleSchema = self.schema;\n  }\n  if (_.contains([\"flows\", \"forms\", \"instances\", \"organizations\"], self.name)) {\n    if (Meteor.isClient) {\n      _db.attachSchema(self.schema, {\n        replace: true\n      });\n    }\n  }\n  Creator.objectsByName[self._collection_name] = self;\n  return self;\n};\n\nCreator.getObjectODataRouterPrefix = function(object) {\n  if (object) {\n    if (!object.database_name || object.database_name === 'meteor-mongo') {\n      return \"/api/odata/v4\";\n    } else {\n      return \"/api/odata/\" + object.database_name;\n    }\n  }\n};\n\nMeteor.startup(function() {\n  if (!Creator.bootstrapLoaded && Creator.Objects) {\n    return _.each(Creator.Objects, function(object) {\n      return new Creator.Object(object);\n    });\n  }\n});\n","Creator.getObjectSchema = (obj) ->\r\n\tschema = {}\r\n\r\n\tfieldsArr = []\r\n\r\n\t_.each obj.fields , (field, field_name)->\r\n\t\tif !_.has(field, \"name\")\r\n\t\t\tfield.name = field_name\r\n\t\tfieldsArr.push field\r\n\r\n\t_.each _.sortBy(fieldsArr, \"sort_no\"), (field)->\r\n\r\n\t\tfield_name = field.name\r\n\r\n\t\tfs = {}\r\n\t\tif field.regEx\r\n\t\t\tfs.regEx = field.regEx\r\n\t\tfs.autoform = {}\r\n\t\tfs.autoform.multiple = field.multiple\r\n\t\tfs.autoform.reference_to = field.reference_to\r\n\r\n\t\tautoform_type = field.autoform?.type\r\n\r\n\t\tif field.type == \"text\" or field.type == \"phone\"\r\n\t\t\tfs.type = String\r\n\t\t\tif field.multiple\r\n\t\t\t\tfs.type = [String]\r\n\t\t\t\tfs.autoform.type = \"tags\"\r\n\t\telse if field.type == \"[text]\" or field.type == \"[phone]\"\r\n\t\t\tfs.type = [String]\r\n\t\t\tfs.autoform.type = \"tags\"\r\n\t\telse if field.type == 'code'\r\n\t\t\tfs.type = String\r\n\t\t\tfs.autoform.type = \"widearea\"\r\n\t\t\tfs.autoform.rows = field.rows || 12\r\n\t\t\tif field.language\r\n\t\t\t\tfs.autoform.language = field.language\r\n\t\telse if field.type == \"textarea\"\r\n\t\t\tfs.type = String\r\n\t\t\tfs.autoform.type = \"widearea\"\r\n\t\t\tfs.autoform.rows = field.rows || 2\r\n\t\telse if field.type == \"password\"\r\n\t\t\tfs.type = String\r\n\t\t\tfs.autoform.type = \"password\"\r\n\t\telse if field.type == \"date\"\r\n\t\t\tfs.type = Date\r\n\t\t\tif Meteor.isClient\r\n\t\t\t\tif Steedos.isMobile() || Steedos.isPad()\r\n\t\t\t\t\t# è¿™é‡Œç”¨afFieldInputè€Œä¸ç›´æŽ¥ç”¨autoformçš„åŽŸå› æ˜¯å½“å­—æ®µè¢«hiddençš„æ—¶å€™åŽ»æ‰§è¡ŒdxDateBoxOptionså‚æ•°ä¼šæŠ¥é”™\r\n\t\t\t\t\tfs.autoform.afFieldInput =\r\n\t\t\t\t\t\ttype: \"steedos-date-mobile\"\r\n\t\t\t\t\t\tdateMobileOptions:\r\n\t\t\t\t\t\t\ttype: \"date\"\r\n\t\t\t\telse\r\n\t\t\t\t\tfs.autoform.outFormat = 'yyyy-MM-dd';\r\n\t\t\t\t\t# è¿™é‡Œç”¨afFieldInputè€Œä¸ç›´æŽ¥ç”¨autoformçš„åŽŸå› æ˜¯å½“å­—æ®µè¢«hiddençš„æ—¶å€™åŽ»æ‰§è¡ŒdxDateBoxOptionså‚æ•°ä¼šæŠ¥é”™\r\n\t\t\t\t\tfs.autoform.afFieldInput =\r\n\t\t\t\t\t\ttype: \"dx-date-box\"\r\n\t\t\t\t\t\ttimezoneId: \"utc\"\r\n\t\t\t\t\t\tdxDateBoxOptions:\r\n\t\t\t\t\t\t\ttype: \"date\"\r\n\t\t\t\t\t\t\tdisplayFormat: \"yyyy-MM-dd\"\r\n\r\n\t\telse if field.type == \"datetime\"\r\n\t\t\tfs.type = Date\r\n\t\t\tif Meteor.isClient\r\n\t\t\t\tif Steedos.isMobile() || Steedos.isPad()\r\n\t\t\t\t\t# è¿™é‡Œç”¨afFieldInputè€Œä¸ç›´æŽ¥ç”¨autoformçš„åŽŸå› æ˜¯å½“å­—æ®µè¢«hiddençš„æ—¶å€™åŽ»æ‰§è¡ŒdxDateBoxOptionså‚æ•°ä¼šæŠ¥é”™\r\n\t\t\t\t\tfs.autoform.afFieldInput =\r\n\t\t\t\t\t\ttype: \"steedos-date-mobile\"\r\n\t\t\t\t\t\tdateMobileOptions:\r\n\t\t\t\t\t\t\ttype: \"datetime\"\r\n\t\t\t\telse\r\n\t\t\t\t\t# è¿™é‡Œç”¨afFieldInputè€Œä¸ç›´æŽ¥ç”¨autoformçš„åŽŸå› æ˜¯å½“å­—æ®µè¢«hiddençš„æ—¶å€™åŽ»æ‰§è¡ŒdxDateBoxOptionså‚æ•°ä¼šæŠ¥é”™\r\n\t\t\t\t\tfs.autoform.afFieldInput =\r\n\t\t\t\t\t\ttype: \"dx-date-box\"\r\n\t\t\t\t\t\tdxDateBoxOptions:\r\n\t\t\t\t\t\t\ttype: \"datetime\"\r\n\t\t\t\t\t\t\tdisplayFormat: \"yyyy-MM-dd HH:mm\"\r\n\t\telse if field.type == \"[Object]\"\r\n\t\t\tfs.type = [Object]\r\n\t\telse if field.type == \"html\"\r\n\t\t\tfs.type = String\r\n\t\t\tfs.autoform.afFieldInput =\r\n\t\t\t\ttype: \"summernote\"\r\n\t\t\t\tclass: 'editor'\r\n\t\t\t\tsettings:\r\n\t\t\t\t\theight: 200\r\n\t\t\t\t\tdialogsInBody: true\r\n\t\t\t\t\ttoolbar:  [\r\n\t\t\t\t\t\t['font1', ['style']],\r\n\t\t\t\t\t\t['font2', ['bold', 'underline', 'italic', 'clear']],\r\n\t\t\t\t\t\t['font3', ['fontname']],\r\n\t\t\t\t\t\t['color', ['color']],\r\n\t\t\t\t\t\t['para', ['ul', 'ol', 'paragraph']],\r\n\t\t\t\t\t\t['table', ['table']],\r\n\t\t\t\t\t\t['insert', ['link', 'picture']],\r\n\t\t\t\t\t\t['view', ['codeview']]\r\n\t\t\t\t\t]\r\n\t\t\t\t\tfontNames: ['Arial', 'Comic Sans MS', 'Courier New', 'Helvetica', 'Impact', 'å®‹ä½“','é»‘ä½“','å¾®è½¯é›…é»‘','ä»¿å®‹','æ¥·ä½“','éš¶ä¹¦','å¹¼åœ†']\r\n\r\n\t\telse if (field.type == \"lookup\" or field.type == \"master_detail\")\r\n\t\t\tfs.type = String\r\n\t\t\tfs.autoform.showIcon = field.showIcon\r\n\t\t\tif field.multiple\r\n\t\t\t\tfs.type = [String]\r\n\r\n\t\t\tif !field.hidden\r\n\r\n\t\t\t\tfs.autoform.filters = field.filters\r\n\r\n\t\t\t\tfs.autoform.dependOn = field.depend_on\r\n\r\n\t\t\t\tif field.beforeOpenFunction\r\n\t\t\t\t\tfs.beforeOpenFunction = field.beforeOpenFunction\r\n\r\n\t\t\t\tfs.filtersFunction = if field.filtersFunction then field.filtersFunction else Creator.evaluateFilters\r\n\r\n\t\t\t\tif field.optionsFunction\r\n\t\t\t\t\tfs.optionsFunction = field.optionsFunction\r\n\r\n\t\t\t\tif field.reference_to\r\n\r\n\t\t\t\t\tif Meteor.isClient\r\n\t\t\t\t\t\tif field.createFunction && _.isFunction(field.createFunction)\r\n\t\t\t\t\t\t\tfs.createFunction = field.createFunction\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tif _.isString(field.reference_to)\r\n\t\t\t\t\t\t\t\t_ref_obj = Creator.Objects[field.reference_to]\r\n\t\t\t\t\t\t\t\tif _ref_obj?.permissions?.allowCreate\r\n\t\t\t\t\t\t\t\t\tfs.autoform.create = true\r\n\t\t\t\t\t\t\t\t\tfs.createFunction = (lookup_field)->\r\n\t\t\t\t\t\t\t\t\t\tModal.show(\"CreatorObjectModal\", {\r\n\t\t\t\t\t\t\t\t\t\t\tcollection: \"Creator.Collections.#{Creator.getCollection(field.reference_to)._name}\",\r\n\t\t\t\t\t\t\t\t\t\t\tformId: \"new#{field.reference_to.replace('.','_')}\",\r\n\t\t\t\t\t\t\t\t\t\t\tobject_name: \"#{field.reference_to}\",\r\n\t\t\t\t\t\t\t\t\t\t\toperation: \"insert\",\r\n\t\t\t\t\t\t\t\t\t\t\tonSuccess: (operation, result)->\r\n\t\t\t\t\t\t\t\t\t\t\t\tobject = Creator.getObject(result.object_name)\r\n\t\t\t\t\t\t\t\t\t\t\t\tif result.object_name == \"objects\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlookup_field.addItems([{label: result.value.label, value: result.value.name, icon: result.value.icon}], result.value.name)\r\n\t\t\t\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlookup_field.addItems([{label: result.value[object.NAME_FIELD_KEY] || result.value.label || result.value.name, value: result._id}], result._id)\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tfs.autoform.create = false\r\n\r\n\t\t\t\t\tif _.isBoolean(field.create)\r\n\t\t\t\t\t\tfs.autoform.create = field.create\r\n\r\n\t\t\t\t\tif field.reference_sort\r\n\t\t\t\t\t\tfs.autoform.optionsSort = field.reference_sort\r\n\r\n\t\t\t\t\tif field.reference_limit\r\n\t\t\t\t\t\tfs.autoform.optionsLimit = field.reference_limit\r\n\r\n\t\t\t\t\tif field.reference_to == \"users\"\r\n\t\t\t\t\t\tfs.autoform.type = \"selectuser\"\r\n\t\t\t\t\t\tif !field.hidden && !field.omit\r\n\t\t\t\t\t\t\t# is_company_limitedè¡¨ç¤ºè¿‡æ»¤æ•°æ®æ—¶æ˜¯å¦åªæ˜¾ç¤ºæœ¬å•ä½ä¸‹çš„æ•°æ®\r\n\t\t\t\t\t\t\t# is_company_limitedå¯ä»¥è¢«æ”¹å†™è¦†ç›–æˆtrue/falseæˆ–å…¶ä»–function\r\n\t\t\t\t\t\t\tif field.is_company_limited == undefined\r\n\t\t\t\t\t\t\t\t# æœªå®šä¹‰is_company_limitedå±žæ€§æ—¶é»˜è®¤å¤„ç†é€»è¾‘ï¼š\r\n\t\t\t\t\t\t\t\t# å¯¹å½“å‰å¯¹è±¡æœ‰viewAllRecordsæƒé™åˆ™ä¸é™åˆ¶æ‰€å±žå•ä½åˆ—è¡¨æŸ¥çœ‹æƒé™ï¼Œå¦åˆ™åªæ˜¾ç¤ºå½“å‰æ‰€å±žå•ä½\r\n\t\t\t\t\t\t\t\t# æ³¨æ„ä¸æ˜¯reference_toå¯¹è±¡çš„viewAllRecordsæƒé™ï¼Œè€Œæ˜¯å½“å‰å¯¹è±¡çš„\r\n\t\t\t\t\t\t\t\tif Meteor.isClient\r\n\t\t\t\t\t\t\t\t\tpermissions = obj.permissions?.get()\r\n\t\t\t\t\t\t\t\t\tisUnLimited = permissions?.viewAllRecords\r\n\t\t\t\t\t\t\t\t\tif _.include([\"organizations\", \"users\", \"space_users\"], obj.name)\r\n\t\t\t\t\t\t\t\t\t\t# å¦‚æžœå­—æ®µæ‰€å±žå¯¹è±¡æ˜¯ç”¨æˆ·æˆ–ç»„ç»‡ï¼Œåˆ™æ˜¯å¦é™åˆ¶æ˜¾ç¤ºæ‰€å±žå•ä½éƒ¨é—¨ä¸ŽmodifyAllRecordsæƒé™å…³è”\r\n\t\t\t\t\t\t\t\t\t\tisUnLimited = permissions?.modifyAllRecords\r\n\t\t\t\t\t\t\t\t\tif isUnLimited\r\n\t\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = false\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = true\r\n\t\t\t\t\t\t\telse if _.isFunction field.is_company_limited\r\n\t\t\t\t\t\t\t\tif Meteor.isClient\r\n\t\t\t\t\t\t\t\t\t# ä¼ å…¥å½“å‰å¯¹è±¡çš„æƒé™ï¼Œåœ¨å‡½æ•°ä¸­æ ¹æ®æƒé™è®¡ç®—æ˜¯å¦è¦é™åˆ¶åªæŸ¥çœ‹æœ¬å•ä½\r\n\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited(obj.permissions)\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t# æœåŠ¡ç«¯ç”¨ä¸åˆ°is_company_limited\r\n\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = true\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited\r\n\t\t\t\t\telse if field.reference_to == \"organizations\"\r\n\t\t\t\t\t\tfs.autoform.type = \"selectorg\"\r\n\t\t\t\t\t\tif !field.hidden && !field.omit\r\n\t\t\t\t\t\t\t# is_company_limitedè¡¨ç¤ºè¿‡æ»¤æ•°æ®æ—¶æ˜¯å¦åªæ˜¾ç¤ºæœ¬å•ä½ä¸‹çš„æ•°æ®\r\n\t\t\t\t\t\t\t# is_company_limitedå¯ä»¥è¢«æ”¹å†™è¦†ç›–æˆtrue/falseæˆ–å…¶ä»–function\r\n\t\t\t\t\t\t\tif field.is_company_limited == undefined\r\n\t\t\t\t\t\t\t\t# æœªå®šä¹‰is_company_limitedå±žæ€§æ—¶é»˜è®¤å¤„ç†é€»è¾‘ï¼š\r\n\t\t\t\t\t\t\t\t# å¯¹å½“å‰å¯¹è±¡æœ‰viewAllRecordsæƒé™åˆ™ä¸é™åˆ¶æ‰€å±žå•ä½åˆ—è¡¨æŸ¥çœ‹æƒé™ï¼Œå¦åˆ™åªæ˜¾ç¤ºå½“å‰æ‰€å±žå•ä½\r\n\t\t\t\t\t\t\t\t# æ³¨æ„ä¸æ˜¯reference_toå¯¹è±¡çš„viewAllRecordsæƒé™ï¼Œè€Œæ˜¯å½“å‰å¯¹è±¡çš„\r\n\t\t\t\t\t\t\t\tif Meteor.isClient\r\n\t\t\t\t\t\t\t\t\tpermissions = obj.permissions?.get()\r\n\t\t\t\t\t\t\t\t\tisUnLimited = permissions?.viewAllRecords\r\n\t\t\t\t\t\t\t\t\tif _.include([\"organizations\", \"users\", \"space_users\"], obj.name)\r\n\t\t\t\t\t\t\t\t\t\t# å¦‚æžœå­—æ®µæ‰€å±žå¯¹è±¡æ˜¯ç”¨æˆ·æˆ–ç»„ç»‡ï¼Œåˆ™æ˜¯å¦é™åˆ¶æ˜¾ç¤ºæ‰€å±žå•ä½éƒ¨é—¨ä¸ŽmodifyAllRecordsæƒé™å…³è”\r\n\t\t\t\t\t\t\t\t\t\tisUnLimited = permissions?.modifyAllRecords\r\n\t\t\t\t\t\t\t\t\tif isUnLimited\r\n\t\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = false\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = true\r\n\t\t\t\t\t\t\telse if _.isFunction field.is_company_limited\r\n\t\t\t\t\t\t\t\tif Meteor.isClient\r\n\t\t\t\t\t\t\t\t\t# ä¼ å…¥å½“å‰å¯¹è±¡çš„æƒé™ï¼Œåœ¨å‡½æ•°ä¸­æ ¹æ®æƒé™è®¡ç®—æ˜¯å¦è¦é™åˆ¶åªæŸ¥çœ‹æœ¬å•ä½\r\n\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited(obj.permissions)\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t# æœåŠ¡ç«¯ç”¨ä¸åˆ°is_company_limited\r\n\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = true\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tif typeof(field.reference_to) == \"function\"\r\n\t\t\t\t\t\t\t_reference_to = field.reference_to()\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t_reference_to = field.reference_to\r\n\r\n\t\t\t\t\t\tif _.isArray(_reference_to)\r\n\t\t\t\t\t\t\tfs.type = Object\r\n\t\t\t\t\t\t\tfs.blackbox = true\r\n\t\t\t\t\t\t\tfs.autoform.objectSwitche = true\r\n\r\n\t\t\t\t\t\t\tschema[field_name + \".o\"] = {\r\n\t\t\t\t\t\t\t\ttype: String\r\n\t\t\t\t\t\t\t\tautoform: {omit: true}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tschema[field_name + \".ids\"] = {\r\n\t\t\t\t\t\t\t\ttype: [String]\r\n\t\t\t\t\t\t\t\tautoform: {omit: true}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t_reference_to = [_reference_to]\r\n\r\n\t\t\t\t\t\t_object = Creator.Objects[_reference_to[0]]\r\n\t\t\t\t\t\tif _object and _object.enable_tree\r\n\t\t\t\t\t\t\tfs.autoform.type = \"selectTree\"\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tfs.autoform.type = \"steedosLookups\"\r\n\t\t\t\t\t\t\tfs.autoform.optionsMethod = field.optionsMethod || \"creator.object_options\"\r\n\r\n\t\t\t\t\t\t\tif Meteor.isClient\r\n\t\t\t\t\t\t\t\tfs.autoform.optionsMethodParams = ()->\r\n\t\t\t\t\t\t\t\t\treturn {space: Session.get(\"spaceId\")}\r\n\t\t\t\t\t\t\t\tfs.autoform.references = []\r\n\t\t\t\t\t\t\t\t_reference_to.forEach (_reference)->\r\n\t\t\t\t\t\t\t\t\t_object = Creator.Objects[_reference]\r\n\t\t\t\t\t\t\t\t\tif _object\r\n\t\t\t\t\t\t\t\t\t\tfs.autoform.references.push {\r\n\t\t\t\t\t\t\t\t\t\t\tobject: _reference\r\n\t\t\t\t\t\t\t\t\t\t\tlabel: _object?.label\r\n\t\t\t\t\t\t\t\t\t\t\ticon: _object?.icon\r\n\t\t\t\t\t\t\t\t\t\t\tlink: ()->\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn \"/app/#{Session.get('app_id')}/#{_reference}/view/\"\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\t\tfs.autoform.references.push {\r\n\t\t\t\t\t\t\t\t\t\t\tobject: _reference\r\n\t\t\t\t\t\t\t\t\t\t\tlink: ()->\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn \"/app/#{Session.get('app_id')}/#{_reference}/view/\"\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\telse\r\n\t\t\t\t\tfs.autoform.type = \"steedosLookups\"\r\n\t\t\t\t\tfs.autoform.defaultIcon = field.defaultIcon\r\n\r\n\t\telse if field.type == \"select\"\r\n\t\t\tfs.type = String\r\n\t\t\tif field.multiple\r\n\t\t\t\tfs.type = [String]\r\n\t\t\t\tfs.autoform.type = \"steedosLookups\"\r\n\t\t\t\tfs.autoform.showIcon = false\r\n\t\t\t\tfs.autoform.options = field.options\r\n\t\t\telse\r\n\t\t\t\tfs.autoform.type = \"select\"\r\n\t\t\t\tfs.autoform.options = field.options\r\n\t\t\t\tfs.autoform.firstOption = \"\"\r\n\t\telse if field.type == \"currency\"\r\n\t\t\tfs.type = Number\r\n\t\t\tfs.autoform.type = \"steedosNumber\"\r\n\t\t\tfs.autoform.precision = field.precision || 18\r\n\t\t\tif field?.scale\r\n\t\t\t\tfs.autoform.scale = field.scale\r\n\t\t\t\tfs.decimal = true\r\n\t\t\telse if field?.scale != 0\r\n\t\t\t\tfs.autoform.scale = 2\r\n\t\t\t\tfs.decimal = true\r\n\t\telse if field.type == \"number\"\r\n\t\t\tfs.type = Number\r\n\t\t\tfs.autoform.type = \"steedosNumber\"\r\n\t\t\tfs.autoform.precision = field.precision || 18\r\n\t\t\tif field?.scale\r\n\t\t\t\tfs.autoform.scale = field.scale\r\n\t\t\t\tfs.decimal = true\r\n\t\telse if field.type == \"boolean\"\r\n\t\t\tfs.type = Boolean\r\n\t\t\tfs.autoform.type = \"steedos-boolean-checkbox\"\r\n\t\telse if field.type == \"reference\"\r\n\t\t\tfs.type = String\r\n\t\telse if field.type == \"checkbox\"\r\n\t\t\tfs.type = [String]\r\n\t\t\tfs.autoform.type = \"select-checkbox\"\r\n\t\t\tfs.autoform.options = field.options\r\n\t\telse if field.type == \"file\" and field.collection\r\n\t\t\tif field.multiple\r\n\t\t\t\tfs.type = [String]\r\n\t\t\t\tschema[field_name + \".$\"] =\r\n\t\t\t\t\tautoform:\r\n\t\t\t\t\t\ttype: 'fileUpload'\r\n\t\t\t\t\t\tcollection: field.collection\r\n\t\t\telse\r\n\t\t\t\tfs.type = String\r\n\t\t\t\tfs.autoform.type = 'fileUpload'\r\n\t\t\t\tfs.autoform.collection = field.collection\r\n\t\telse if field.type == \"filesize\"\r\n\t\t\tfs.type = Number\r\n\t\t\tfs.autoform.type = 'filesize'\r\n\t\telse if field.type == \"Object\" || field.type == \"object\"\r\n\t\t\tfs.type = Object\r\n\t\telse if field.type == \"grid\"\r\n\t\t\tfs.type = Array\r\n\t\t\tfs.autoform.editable = true\r\n\t\t\tfs.autoform.type = \"steedosGrid\"\r\n\r\n\t\t\tschema[field_name + \".$\"] =\r\n\t\t\t\ttype: Object\r\n\t\telse if field.type == \"image\"\r\n\t\t\tif field.multiple\r\n\t\t\t\tfs.type = [String]\r\n\t\t\t\tschema[field_name + \".$\"] =\r\n\t\t\t\t\tautoform:\r\n\t\t\t\t\t\ttype: 'fileUpload'\r\n\t\t\t\t\t\tcollection: 'images'\r\n\t\t\t\t\t\taccept: 'image/*'\r\n\t\t\telse\r\n\t\t\t\tfs.type = String\r\n\t\t\t\tfs.autoform.type = 'fileUpload'\r\n\t\t\t\tfs.autoform.collection = 'images'\r\n\t\t\t\tfs.autoform.accept = 'image/*'\r\n\t\telse if field.type == \"avatar\"\r\n\t\t\tif field.multiple\r\n\t\t\t\tfs.type = [String]\r\n\t\t\t\tschema[field_name + \".$\"] =\r\n\t\t\t\t\tautoform:\r\n\t\t\t\t\t\ttype: 'fileUpload'\r\n\t\t\t\t\t\tcollection: 'avatars'\r\n\t\t\t\t\t\taccept: 'image/*'\r\n\t\t\telse\r\n\t\t\t\tfs.type = String\r\n\t\t\t\tfs.autoform.type = 'fileUpload'\r\n\t\t\t\tfs.autoform.collection = 'avatars'\r\n\t\t\t\tfs.autoform.accept = 'image/*'\r\n\t\telse if field.type == \"audio\"\r\n\t\t\tif field.multiple\r\n\t\t\t\tfs.type = [String]\r\n\t\t\t\tschema[field_name + \".$\"] =\r\n\t\t\t\t\tautoform:\r\n\t\t\t\t\t\ttype: 'fileUpload'\r\n\t\t\t\t\t\tcollection: 'audios'\r\n\t\t\t\t\t\taccept: 'audio/*'\r\n\t\t\telse\r\n\t\t\t\tfs.type = String\r\n\t\t\t\tfs.autoform.type = 'fileUpload'\r\n\t\t\t\tfs.autoform.collection = 'audios'\r\n\t\t\t\tfs.autoform.accept = 'audio/*'\r\n\t\telse if field.type == \"video\"\r\n\t\t\tif field.multiple\r\n\t\t\t\tfs.type = [String]\r\n\t\t\t\tschema[field_name + \".$\"] =\r\n\t\t\t\t\tautoform:\r\n\t\t\t\t\t\ttype: 'fileUpload'\r\n\t\t\t\t\t\tcollection: 'videos'\r\n\t\t\t\t\t\taccept: 'video/*'\r\n\t\t\telse\r\n\t\t\t\tfs.type = String\r\n\t\t\t\tfs.autoform.type = 'fileUpload'\r\n\t\t\t\tfs.autoform.collection = 'videos'\r\n\t\t\t\tfs.autoform.accept = 'video/*'\r\n\t\telse if field.type == \"location\"\r\n\t\t\tfs.type = Object\r\n\t\t\tfs.autoform.type = \"location\"\r\n\t\t\tfs.autoform.system = field.system || \"wgs84\"\r\n\t\t\tfs.blackbox = true\r\n\t\telse if field.type == \"markdown\"\r\n\t\t\tfs.type = String\r\n\t\t\tfs.autoform.type = \"steedos-markdown\"\r\n\t\telse if field.type == 'url'\r\n\t\t\tfs.type = String\r\n\t\t\t# fs.regEx = SimpleSchema.RegEx.Url\r\n\t\t\tfs.autoform.type = 'steedosUrl'\r\n\t\telse if field.type == 'email'\r\n\t\t\tfs.type = String\r\n\t\t\tfs.regEx = SimpleSchema.RegEx.Email\r\n\t\t\tfs.autoform.type = 'steedosEmail'\r\n\t\telse if field.type == 'autonumber'\r\n\t\t\tfs.type = String\r\n\t\telse\r\n\t\t\tfs.type = field.type\r\n\r\n\t\tif field.label\r\n\t\t\tfs.label = field.label\r\n\r\n#\t\tif field.allowedValues\r\n#\t\t\tfs.allowedValues = field.allowedValues\r\n\r\n\t\tif !field.required\r\n\t\t\tfs.optional = true\r\n\r\n\t\t# [ç­¾çº¦å¯¹è±¡åŒæ—¶é…ç½®äº†company_idså¿…å¡«åŠuneditable_fieldsé€ æˆéƒ¨åˆ†ç”¨æˆ·æ–°å»ºç­¾çº¦å¯¹è±¡æ—¶æŠ¥é”™ #192](https://github.com/steedos/steedos-project-dzug/issues/192)\r\n\t\t# åŽå°å§‹ç»ˆè®¾ç½®requiredä¸ºfalse\r\n\t\tif !Meteor.isClient\r\n\t\t\tfs.optional = true\r\n\r\n\t\tif field.unique\r\n\t\t\tfs.unique = true\r\n\r\n\t\tif field.omit\r\n\t\t\tfs.autoform.omit = true\r\n\r\n\t\tif field.group\r\n\t\t\tfs.autoform.group = field.group\r\n\r\n\t\tif field.is_wide\r\n\t\t\tfs.autoform.is_wide = true\r\n\r\n\t\tif field.hidden\r\n\t\t\tfs.autoform.type = \"hidden\"\r\n\r\n\t\tif (field.type == \"select\") or (field.type == \"lookup\") or (field.type == \"master_detail\")\r\n\t\t\tif typeof(field.filterable) == 'undefined'\r\n\t\t\t\tfield.filterable = true\r\n\t\tif field.name == 'name' || field.is_name\r\n\t\t\tif typeof(field.searchable) == 'undefined'\r\n\t\t\t\tfield.searchable = true\r\n\r\n\t\tif autoform_type\r\n\t\t\tfs.autoform.type = autoform_type\r\n\r\n\t\tif field.defaultValue\r\n\t\t\tif Meteor.isClient and Creator.Formular.checkFormula(field.defaultValue)\r\n\t\t\t\tfs.autoform.defaultValue = ()->\r\n\t\t\t\t\treturn Creator.Formular.run(field.defaultValue, {userId: Meteor.userId(), spaceId: Session.get(\"spaceId\")})\r\n\t\t\telse\r\n\t\t\t\tfs.autoform.defaultValue = field.defaultValue\r\n\t\t\t\tif !_.isFunction(field.defaultValue)\r\n\t\t\t\t\tfs.defaultValue = field.defaultValue\r\n\r\n\t\tif field.readonly\r\n\t\t\tfs.autoform.readonly = true\r\n\r\n\t\tif field.disabled\r\n\t\t\tfs.autoform.disabled = true\r\n\r\n\t\tif field.inlineHelpText\r\n\t\t\tfs.autoform.inlineHelpText = field.inlineHelpText\r\n\r\n\t\tif field.blackbox\r\n\t\t\tfs.blackbox = true\r\n\r\n\t\tif _.has(field, 'min')\r\n\t\t\tfs.min = field.min\r\n\t\tif _.has(field, 'max')\r\n\t\t\tfs.max = field.max\r\n\r\n\t\t# åªæœ‰ç”Ÿäº§çŽ¯å¢ƒæ‰é‡å»ºç´¢å¼•\r\n\t\tif Meteor.isProduction\r\n\t\t\tif field.index\r\n\t\t\t\tfs.index = field.index\r\n\t\t\telse if field.sortable\r\n\t\t\t\tfs.index = true\r\n\r\n\t\tschema[field_name] = fs\r\n\r\n\treturn schema\r\n\r\n\r\nCreator.getFieldDisplayValue = (object_name, field_name, field_value)->\r\n\thtml = field_value\r\n\tobject = Creator.getObject(object_name)\r\n\tif !object\r\n\t\treturn \"\"\r\n\tfield = object.fields(field_name)\r\n\tif !field\r\n\t\treturn \"\"\r\n\r\n\tif field.type == \"datetime\"\r\n\t\thtml = moment(this.val).format('YYYY-MM-DD H:mm')\r\n\telse if field.type == \"date\"\r\n\t\thtml = moment(this.val).format('YYYY-MM-DD')\r\n\r\n\treturn html\r\n\r\nCreator.checkFieldTypeSupportBetweenQuery = (field_type)->\r\n\treturn [\"date\", \"datetime\", \"currency\", \"number\"].includes(field_type)\r\n\r\nCreator.pushBetweenBuiltinOptionals = (field_type, operations)->\r\n\tbuiltinValues = Creator.getBetweenBuiltinValues(field_type)\r\n\tif builtinValues\r\n\t\t_.forEach builtinValues, (builtinItem, key)->\r\n\t\t\toperations.push({label: builtinItem.label, value: key})\r\n\r\nCreator.getBetweenBuiltinValues = (field_type, is_check_only)->\r\n\t# è¿‡æ»¤å™¨å­—æ®µç±»åž‹å¯¹åº”çš„å†…ç½®é€‰é¡¹\r\n\tif [\"date\", \"datetime\"].includes(field_type)\r\n\t\treturn Creator.getBetweenTimeBuiltinValues(is_check_only, field_type)\r\n\r\nCreator.getBetweenBuiltinValueItem = (field_type, key)->\r\n\t# è¿‡æ»¤å™¨å­—æ®µç±»åž‹å¯¹åº”çš„å†…ç½®é€‰é¡¹\r\n\tif [\"date\", \"datetime\"].includes(field_type)\r\n\t\treturn Creator.getBetweenTimeBuiltinValueItem(field_type, key)\r\n\r\nCreator.getBetweenBuiltinOperation = (field_type, value)->\r\n\t# æ ¹æ®è¿‡æ»¤å™¨çš„è¿‡æ»¤å€¼ï¼ŒèŽ·å–å¯¹åº”çš„å†…ç½®è¿ç®—ç¬¦\r\n\t# æ¯”å¦‚valueä¸ºlast_yearï¼Œè¿”å›žbetween_time_last_year\r\n\tunless _.isString(value)\r\n\t\treturn\r\n\tbetweenBuiltinValues = Creator.getBetweenBuiltinValues(field_type)\r\n\tunless betweenBuiltinValues\r\n\t\treturn\r\n\tresult = null\r\n\t_.each betweenBuiltinValues, (item, operation)->\r\n\t\tif item.key == value\r\n\t\t\tresult = operation\r\n\treturn result\r\n\r\n# å¦‚æžœåªæ˜¯ä¸ºåˆ¤æ–­operationæ˜¯å¦å­˜åœ¨ï¼Œåˆ™æ²¡å¿…è¦è®¡ç®—valuesï¼Œä¼ å…¥is_check_onlyä¸ºtrueå³å¯\r\nCreator.getBetweenTimeBuiltinValues = (is_check_only, field_type)->\r\n\t# è¿‡æ»¤å™¨æ—¶é—´å­—æ®µç±»åž‹å¯¹åº”çš„å†…ç½®é€‰é¡¹\r\n\treturn {\r\n\t\t\"between_time_last_year\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_year\"),\r\n\t\t\"between_time_this_year\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_year\"),\r\n\t\t\"between_time_next_year\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_year\"),\r\n\t\t\"between_time_last_quarter\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_quarter\"),\r\n\t\t\"between_time_this_quarter\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_quarter\"),\r\n\t\t\"between_time_next_quarter\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_quarter\"),\r\n\t\t\"between_time_last_month\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_month\"),\r\n\t\t\"between_time_this_month\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_month\"),\r\n\t\t\"between_time_next_month\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_month\"),\r\n\t\t\"between_time_last_week\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_week\"),\r\n\t\t\"between_time_this_week\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_week\"),\r\n\t\t\"between_time_next_week\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_week\"),\r\n\t\t\"between_time_yestday\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"yestday\"),\r\n\t\t\"between_time_today\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"today\"),\r\n\t\t\"between_time_tomorrow\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"tomorrow\"),\r\n\t\t\"between_time_last_7_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_7_days\"),\r\n\t\t\"between_time_last_30_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_30_days\"),\r\n\t\t\"between_time_last_60_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_60_days\"),\r\n\t\t\"between_time_last_90_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_90_days\"),\r\n\t\t\"between_time_last_120_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_120_days\"),\r\n\t\t\"between_time_next_7_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_7_days\"),\r\n\t\t\"between_time_next_30_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_30_days\"),\r\n\t\t\"between_time_next_60_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_60_days\"),\r\n\t\t\"between_time_next_90_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_90_days\"),\r\n\t\t\"between_time_next_120_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_120_days\")\r\n\t}\r\n\r\nCreator.getQuarterStartMonth = (month)->\r\n\tif !month\r\n\t\tmonth = new Date().getMonth()\r\n\t\r\n\tif month < 3\r\n\t\treturn 0\r\n\telse if month < 6\r\n\t\treturn 3\r\n\telse if month < 9\r\n\t\treturn 6\r\n\t\r\n\treturn 9\r\n\r\n\r\nCreator.getLastQuarterFirstDay = (year,month)->\r\n\tif !year\r\n\t\tyear = new Date().getFullYear()\r\n\tif !month\r\n\t\tmonth = new Date().getMonth()\r\n\t\r\n\tif month < 3\r\n\t\tyear--\r\n\t\tmonth = 9\r\n\telse if month < 6\r\n\t\tmonth = 0\r\n\telse if month < 9\r\n\t\tmonth = 3\r\n\telse \r\n\t\tmonth = 6\r\n\t\r\n\treturn new Date(year, month, 1)\r\n\t\r\n\r\nCreator.getNextQuarterFirstDay = (year,month)->\r\n\tif !year\r\n\t\tyear = new Date().getFullYear()\r\n\tif !month\r\n\t\tmonth = new Date().getMonth()\r\n\t\r\n\tif month < 3\r\n\t\tmonth = 3\r\n\telse if month < 6\r\n\t\tmonth = 6\r\n\telse if month < 9\r\n\t\tmonth = 9\r\n\telse\r\n\t\tyear++\r\n\t\tmonth = 0\r\n\t\r\n\treturn new Date(year, month, 1)\r\n\r\nCreator.getMonthDays = (year,month)->\r\n\tif month == 11\r\n\t\treturn 31\r\n\t\r\n\tmillisecond = 1000 * 60 * 60 * 24\r\n\tstartDate = new Date(year, month, 1)\r\n\tendDate = new Date(year, month+1, 1)\r\n\tdays = (endDate-startDate)/millisecond\r\n\treturn days\r\n\r\nCreator.getLastMonthFirstDay = (year, month)->\r\n\tif !year\r\n\t\tyear = new Date().getFullYear()\r\n\tif !month\r\n\t\tmonth = new Date().getMonth()\r\n\t\r\n\t# æœˆä»½ä¸º0ä»£è¡¨æœ¬å¹´çš„ç¬¬ä¸€æœˆ\r\n\tif month == 0\r\n\t\tmonth = 11\r\n\t\tyear--\r\n\t\treturn new Date(year, month, 1)\r\n\t\r\n\t# å¦åˆ™,åªå‡åŽ»æœˆä»½\r\n\tmonth--;\r\n\treturn new Date(year, month, 1)\r\n\t\r\nCreator.getBetweenTimeBuiltinValueItem = (field_type, key)->\r\n\t# è¿‡æ»¤å™¨betweenè¿ç®—ç¬¦ï¼ŒçŽ°ç®—æ—¥æœŸ/æ—¥æœŸæ—¶é—´ç±»åž‹å­—æ®µçš„valueså€¼\r\n\tnow = new Date()\r\n\t# ä¸€å¤©çš„æ¯«ç§’æ•°\r\n\tmillisecond = 1000 * 60 * 60 * 24\r\n\tyestday = new Date(now.getTime() - millisecond)\r\n\ttomorrow = new Date(now.getTime() + millisecond)\r\n\t# ä¸€å‘¨ä¸­çš„æŸä¸€å¤©\r\n\tweek = now.getDay()\r\n\t# å‡åŽ»çš„å¤©æ•°\r\n\tminusDay = if week != 0 then week - 1 else 6\r\n\tmonday = new Date(now.getTime() - (minusDay * millisecond))\r\n\tsunday = new Date(monday.getTime() + (6 * millisecond))\r\n\t# ä¸Šå‘¨æ—¥\r\n\tlastSunday = new Date(monday.getTime() - millisecond)\r\n\t# ä¸Šå‘¨ä¸€\r\n\tlastMonday = new Date(lastSunday.getTime() - (millisecond * 6))\r\n\t# ä¸‹å‘¨ä¸€\r\n\tnextMonday = new Date(sunday.getTime() + millisecond)\r\n\t# ä¸‹å‘¨æ—¥\r\n\tnextSunday = new Date(nextMonday.getTime() + (millisecond * 6))\r\n\tcurrentYear = now.getFullYear()\r\n\tpreviousYear = currentYear - 1\r\n\tnextYear = currentYear + 1\r\n\t# å½“å‰æœˆä»½\r\n\tcurrentMonth = now.getMonth()\r\n\t# è®¡æ•°å¹´ã€æœˆ\r\n\tyear = now.getFullYear()\r\n\tmonth = now.getMonth()\r\n\t# æœ¬æœˆç¬¬ä¸€å¤©\r\n\tfirstDay = new Date(currentYear,currentMonth,1)\r\n\r\n\t# å½“ä¸º12æœˆçš„æ—¶å€™å¹´ä»½éœ€è¦åŠ 1\r\n\t# æœˆä»½éœ€è¦æ›´æ–°ä¸º0 ä¹Ÿå°±æ˜¯ä¸‹ä¸€å¹´çš„ç¬¬ä¸€ä¸ªæœˆ\r\n\tif currentMonth == 11\r\n\t\tyear++\r\n\t\tmonth++\r\n\telse\r\n\t\tmonth++\r\n\t\r\n\t# ä¸‹æœˆç¬¬ä¸€å¤©\r\n\tnextMonthFirstDay = new Date(year, month, 1)\r\n\t# ä¸‹æœˆæœ€åŽä¸€å¤©\r\n\tnextMonthFinalDay = new Date(year,month,Creator.getMonthDays(year,month))\r\n\t# æœ¬æœˆæœ€åŽä¸€å¤©\r\n\tlastDay = new Date(nextMonthFirstDay.getTime() - millisecond)\r\n\t# ä¸Šæœˆç¬¬ä¸€å¤©\r\n\tlastMonthFirstDay = Creator.getLastMonthFirstDay(currentYear,currentMonth)\r\n\t# ä¸Šæœˆæœ€åŽä¸€å¤©\r\n\tlastMonthFinalDay = new Date(firstDay.getTime() - millisecond)\r\n\t# æœ¬å­£åº¦å¼€å§‹æ—¥\r\n\tthisQuarterStartDay = new Date(currentYear,Creator.getQuarterStartMonth(currentMonth),1)\r\n\t# æœ¬å­£åº¦ç»“æŸæ—¥\r\n\tthisQuarterEndDay = new Date(currentYear,Creator.getQuarterStartMonth(currentMonth)+2,Creator.getMonthDays(currentYear,Creator.getQuarterStartMonth(currentMonth)+2))\r\n\t# ä¸Šå­£åº¦å¼€å§‹æ—¥\r\n\tlastQuarterStartDay = Creator.getLastQuarterFirstDay(currentYear,currentMonth)\r\n\t# ä¸Šå­£åº¦ç»“æŸæ—¥\r\n\tlastQuarterEndDay = new Date(lastQuarterStartDay.getFullYear(),lastQuarterStartDay.getMonth()+2,Creator.getMonthDays(lastQuarterStartDay.getFullYear(),lastQuarterStartDay.getMonth()+2))\r\n\t# ä¸‹å­£åº¦å¼€å§‹æ—¥\r\n\tnextQuarterStartDay = Creator.getNextQuarterFirstDay(currentYear,currentMonth)\r\n\t# ä¸‹å­£åº¦ç»“æŸæ—¥\r\n\tnextQuarterEndDay = new Date(nextQuarterStartDay.getFullYear(),nextQuarterStartDay.getMonth()+2,Creator.getMonthDays(nextQuarterStartDay.getFullYear(),nextQuarterStartDay.getMonth()+2))\r\n\t# è¿‡åŽ»7å¤© \r\n\tlast_7_days = new Date(now.getTime() - (6 * millisecond))\r\n\t# è¿‡åŽ»30å¤©\r\n\tlast_30_days = new Date(now.getTime() - (29 * millisecond))\r\n\t# è¿‡åŽ»60å¤©\r\n\tlast_60_days = new Date(now.getTime() - (59 * millisecond))\r\n\t# è¿‡åŽ»90å¤©\r\n\tlast_90_days = new Date(now.getTime() - (89 * millisecond))\r\n\t# è¿‡åŽ»120å¤©\r\n\tlast_120_days = new Date(now.getTime() - (119 * millisecond))\r\n\t# æœªæ¥7å¤© \r\n\tnext_7_days = new Date(now.getTime() + (6 * millisecond))\r\n\t# æœªæ¥30å¤©\r\n\tnext_30_days = new Date(now.getTime() + (29 * millisecond))\r\n\t# æœªæ¥60å¤©\r\n\tnext_60_days = new Date(now.getTime() + (59 * millisecond))\r\n\t# æœªæ¥90å¤©\r\n\tnext_90_days = new Date(now.getTime() + (89 * millisecond))\r\n\t# æœªæ¥120å¤©\r\n\tnext_120_days = new Date(now.getTime() + (119 * millisecond))\r\n\r\n\tswitch key\r\n\t\twhen \"last_year\"\r\n\t\t\t#åŽ»å¹´\r\n\t\t\tlabel = t(\"creator_filter_operation_between_last_year\")\r\n\t\t\tstartValue = new Date(\"#{previousYear}-01-01T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{previousYear}-12-31T23:59:59Z\")\r\n\t\twhen \"this_year\"\r\n\t\t\t#ä»Šå¹´\r\n\t\t\tlabel = t(\"creator_filter_operation_between_this_year\")\r\n\t\t\tstartValue = new Date(\"#{currentYear}-01-01T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{currentYear}-12-31T23:59:59Z\")\r\n\t\twhen \"next_year\"\r\n\t\t\t#æ˜Žå¹´\r\n\t\t\tlabel = t(\"creator_filter_operation_between_next_year\")\r\n\t\t\tstartValue = new Date(\"#{nextYear}-01-01T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{nextYear}-12-31T23:59:59Z\")\r\n\t\twhen \"last_quarter\"\r\n\t\t\t#ä¸Šå­£åº¦\r\n\t\t\tstrFirstDay = moment(lastQuarterStartDay).format(\"YYYY-MM-DD\")\r\n\t\t\tstrLastDay = moment(lastQuarterEndDay).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_last_quarter\")\r\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\r\n\t\twhen \"this_quarter\"\r\n\t\t\t#æœ¬å­£åº¦\r\n\t\t\tstrFirstDay = moment(thisQuarterStartDay).format(\"YYYY-MM-DD\")\r\n\t\t\tstrLastDay = moment(thisQuarterEndDay).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_this_quarter\")\r\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\r\n\t\twhen \"next_quarter\"\r\n\t\t\t#ä¸‹å­£åº¦\r\n\t\t\tstrFirstDay = moment(nextQuarterStartDay).format(\"YYYY-MM-DD\")\r\n\t\t\tstrLastDay = moment(nextQuarterEndDay).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_next_quarter\")\r\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\r\n\t\twhen \"last_month\"\r\n\t\t\t#ä¸Šæœˆ\r\n\t\t\tstrFirstDay = moment(lastMonthFirstDay).format(\"YYYY-MM-DD\")\r\n\t\t\tstrLastDay = moment(lastMonthFinalDay).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_last_month\")\r\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\r\n\t\twhen \"this_month\"\r\n\t\t\t#æœ¬æœˆ\r\n\t\t\tstrFirstDay = moment(firstDay).format(\"YYYY-MM-DD\")\r\n\t\t\tstrLastDay = moment(lastDay).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_this_month\")\r\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\r\n\t\twhen \"next_month\"\r\n\t\t\t#ä¸‹æœˆ\r\n\t\t\tstrFirstDay = moment(nextMonthFirstDay).format(\"YYYY-MM-DD\")\r\n\t\t\tstrLastDay = moment(nextMonthFinalDay).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_next_month\")\r\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\r\n\t\twhen \"last_week\"\r\n\t\t\t#ä¸Šå‘¨\r\n\t\t\tstrMonday = moment(lastMonday).format(\"YYYY-MM-DD\")\r\n\t\t\tstrSunday = moment(lastSunday).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_last_week\")\r\n\t\t\tstartValue = new Date(\"#{strMonday}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strSunday}T23:59:59Z\")\r\n\t\twhen \"this_week\"\r\n\t\t\t#æœ¬å‘¨\r\n\t\t\tstrMonday = moment(monday).format(\"YYYY-MM-DD\")\r\n\t\t\tstrSunday = moment(sunday).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_this_week\")\r\n\t\t\tstartValue = new Date(\"#{strMonday}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strSunday}T23:59:59Z\")\r\n\t\twhen \"next_week\"\r\n\t\t\t#ä¸‹å‘¨\r\n\t\t\tstrMonday = moment(nextMonday).format(\"YYYY-MM-DD\")\r\n\t\t\tstrSunday = moment(nextSunday).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_next_week\")\r\n\t\t\tstartValue = new Date(\"#{strMonday}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strSunday}T23:59:59Z\")\r\n\t\twhen \"yestday\"\r\n\t\t\t#æ˜¨å¤©\r\n\t\t\tstrYestday = moment(yestday).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_yestday\")\r\n\t\t\tstartValue = new Date(\"#{strYestday}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strYestday}T23:59:59Z\")\r\n\t\twhen \"today\"\r\n\t\t\t#ä»Šå¤©\r\n\t\t\tstrToday = moment(now).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_today\")\r\n\t\t\tstartValue = new Date(\"#{strToday}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strToday}T23:59:59Z\")\r\n\t\twhen \"tomorrow\"\r\n\t\t\t#æ˜Žå¤©\r\n\t\t\tstrTomorrow = moment(tomorrow).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_tomorrow\")\r\n\t\t\tstartValue = new Date(\"#{strTomorrow}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strTomorrow}T23:59:59Z\")\r\n\t\twhen \"last_7_days\"\r\n\t\t\t#è¿‡åŽ»7å¤©\r\n\t\t\tstrStartDay = moment(last_7_days).format(\"YYYY-MM-DD\") \r\n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_last_7_days\")\r\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\r\n\t\twhen \"last_30_days\"\r\n\t\t\t#è¿‡åŽ»30å¤©\r\n\t\t\tstrStartDay = moment(last_30_days).format(\"YYYY-MM-DD\")\r\n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_last_30_days\")\r\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\r\n\t\twhen \"last_60_days\"\r\n\t\t\t#è¿‡åŽ»60å¤©\r\n\t\t\tstrStartDay = moment(last_60_days).format(\"YYYY-MM-DD\")\r\n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_last_60_days\")\r\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\r\n\t\twhen \"last_90_days\"\r\n\t\t\t#è¿‡åŽ»90å¤©\r\n\t\t\tstrStartDay = moment(last_90_days).format(\"YYYY-MM-DD\")\r\n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_last_90_days\")\r\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\r\n\t\twhen \"last_120_days\"\r\n\t\t\t#è¿‡åŽ»120å¤©\r\n\t\t\tstrStartDay = moment(last_120_days).format(\"YYYY-MM-DD\")\r\n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_last_120_days\")\r\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\r\n\t\twhen \"next_7_days\"\r\n\t\t\t#æœªæ¥7å¤©\r\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\r\n\t\t\tstrEndDay = moment(next_7_days).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_next_7_days\")\r\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\r\n\t\twhen \"next_30_days\"\r\n\t\t\t#æœªæ¥30å¤©\r\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\r\n\t\t\tstrEndDay = moment(next_30_days).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_next_30_days\")\r\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\r\n\t\twhen \"next_60_days\"\r\n\t\t\t#æœªæ¥60å¤©\r\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\r\n\t\t\tstrEndDay = moment(next_60_days).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_next_60_days\")\r\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\r\n\t\twhen \"next_90_days\"\r\n\t\t\t#æœªæ¥90å¤©\r\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\r\n\t\t\tstrEndDay = moment(next_90_days).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_next_90_days\")\r\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\r\n\t\twhen \"next_120_days\"\r\n\t\t\t#æœªæ¥120å¤©\r\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\r\n\t\t\tstrEndDay = moment(next_120_days).format(\"YYYY-MM-DD\")\r\n\t\t\tlabel = t(\"creator_filter_operation_between_next_120_days\")\r\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\r\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\r\n\t\r\n\tvalues = [startValue, endValue]\r\n\tif field_type == \"datetime\"\r\n\t\t# æ—¶é—´ç±»åž‹å­—æ®µï¼Œå†…ç½®æ—¶é—´èŒƒå›´åº”è¯¥è€ƒè™‘åç§»æ—¶åŒºå€¼ï¼Œå¦åˆ™è¿‡æ»¤æ•°æ®å­˜åœ¨åå·®\r\n\t\t# éžå†…ç½®æ—¶é—´èŒƒå›´æ—¶ï¼Œç”¨æˆ·é€šè¿‡æ—¶é—´æŽ§ä»¶é€‰æ‹©çš„èŒƒå›´ï¼Œä¼šè‡ªåŠ¨å¤„ç†æ—¶åŒºåå·®æƒ…å†µ\r\n\t\t# æ—¥æœŸç±»åž‹å­—æ®µï¼Œæ•°æ®åº“æœ¬æ¥å°±å­˜çš„æ˜¯UTCçš„0ç‚¹ï¼Œä¸å­˜åœ¨åå·®\r\n\t\t_.forEach values, (fv)->\r\n\t\t\tif fv\r\n\t\t\t\tfv.setHours(fv.getHours() + fv.getTimezoneOffset() / 60 )\r\n\t\r\n\treturn {\r\n\t\tlabel: label\r\n\t\tkey: key\r\n\t\tvalues: values\r\n\t}\r\n\r\nCreator.getFieldDefaultOperation = (field_type)->\r\n\tif field_type && Creator.checkFieldTypeSupportBetweenQuery(field_type)\r\n\t\treturn 'between'\r\n\telse if [\"textarea\", \"text\", \"code\"].includes(field_type)\r\n\t\treturn 'contains'\r\n\telse\r\n\t\treturn \"=\"\r\n\r\nCreator.getFieldOperation = (field_type) ->\r\n\t# æ—¥æœŸç±»åž‹: date, datetime  æ”¯æŒæ“ä½œç¬¦: \"=\", \"<>\", \"<\", \">\", \"<=\", \">=\"\r\n\t# æ–‡æœ¬ç±»åž‹: text, textarea, html  æ”¯æŒæ“ä½œç¬¦: \"=\", \"<>\", \"contains\", \"notcontains\", \"startswith\"\r\n\t# é€‰æ‹©ç±»åž‹: lookup, master_detail, select æ”¯æŒæ“ä½œç¬¦: \"=\", \"<>\"\r\n\t# æ•°å€¼ç±»åž‹: currency, number  æ”¯æŒæ“ä½œç¬¦: \"=\", \"<>\", \"<\", \">\", \"<=\", \">=\"\r\n\t# å¸ƒå°”ç±»åž‹: boolean  æ”¯æŒæ“ä½œç¬¦: \"=\", \"<>\"\r\n\t# æ•°ç»„ç±»åž‹: checkbox, [text]  æ”¯æŒæ“ä½œç¬¦: \"=\", \"<>\"\r\n\r\n\toptionals = {\r\n\t\tequal: {label: t(\"creator_filter_operation_equal\"), value: \"=\"},\r\n\t\tunequal: {label: t(\"creator_filter_operation_unequal\"), value: \"<>\"},\r\n\t\tless_than: {label: t(\"creator_filter_operation_less_than\"), value: \"<\"},\r\n\t\tgreater_than: {label: t(\"creator_filter_operation_greater_than\"), value: \">\"},\r\n\t\tless_or_equal: {label: t(\"creator_filter_operation_less_or_equal\"), value: \"<=\"},\r\n\t\tgreater_or_equal: {label: t(\"creator_filter_operation_greater_or_equal\"), value: \">=\"},\r\n\t\tcontains: {label: t(\"creator_filter_operation_contains\"), value: \"contains\"},\r\n\t\tnot_contain: {label: t(\"creator_filter_operation_does_not_contain\"), value: \"notcontains\"},\r\n\t\tstarts_with: {label: t(\"creator_filter_operation_starts_with\"), value: \"startswith\"},\r\n\t\tbetween: {label: t(\"creator_filter_operation_between\"), value: \"between\"},\r\n\t}\r\n\r\n\tif field_type == undefined\r\n\t\treturn _.values(optionals)\r\n\r\n\toperations = []\r\n\r\n\tif Creator.checkFieldTypeSupportBetweenQuery(field_type)\r\n\t\toperations.push(optionals.between)\r\n\t\tCreator.pushBetweenBuiltinOptionals(field_type, operations)\r\n\telse if field_type == \"text\" or field_type == \"textarea\" or field_type == \"html\" or field_type == \"code\"\r\n#\t\toperations.push(optionals.equal, optionals.unequal, optionals.contains, optionals.not_contain, optionals.starts_with)\r\n\t\toperations.push(optionals.contains)\r\n\telse if field_type == \"lookup\" or field_type == \"master_detail\" or field_type == \"select\"\r\n\t\toperations.push(optionals.equal, optionals.unequal)\r\n\telse if field_type == \"currency\" or field_type == \"number\"\r\n\t\toperations.push(optionals.equal, optionals.unequal, optionals.less_than, optionals.greater_than, optionals.less_or_equal, optionals.greater_or_equal)\r\n\telse if field_type == \"boolean\"\r\n\t\toperations.push(optionals.equal, optionals.unequal)\r\n\telse if field_type == \"checkbox\"\r\n\t\toperations.push(optionals.equal, optionals.unequal)\r\n\telse if field_type == \"[text]\"\r\n\t\toperations.push(optionals.equal, optionals.unequal)\r\n\telse\r\n\t\toperations.push(optionals.equal, optionals.unequal)\r\n\r\n\treturn operations\r\n\r\n###\r\n    å…ˆæŒ‰ç…§æœ‰æŽ’åºå·çš„å°çš„åœ¨å‰ï¼Œå¤§çš„åœ¨åŽ\r\n    å†å°†æ²¡æœ‰æŽ’åºå·çš„æ˜¾ç¤ºåœ¨\r\n###\r\nCreator.getObjectFieldsName = (object_name)->\r\n\tfields = Creator.getObject(object_name)?.fields\r\n\tfieldsArr = []\r\n\r\n\t_.each fields, (field)->\r\n\t\tfieldsArr.push {name: field.name, sort_no: field.sort_no}\r\n\r\n\tfieldsName = []\r\n\t_.each _.sortBy(fieldsArr, \"sort_no\"), (field)->\r\n\t\tfieldsName.push(field.name)\r\n\treturn fieldsName\r\n","Creator.getObjectSchema = function(obj) {\n  var fieldsArr, schema;\n  schema = {};\n  fieldsArr = [];\n  _.each(obj.fields, function(field, field_name) {\n    if (!_.has(field, \"name\")) {\n      field.name = field_name;\n    }\n    return fieldsArr.push(field);\n  });\n  _.each(_.sortBy(fieldsArr, \"sort_no\"), function(field) {\n    var _object, _ref_obj, _reference_to, autoform_type, field_name, fs, isUnLimited, permissions, ref, ref1, ref2, ref3;\n    field_name = field.name;\n    fs = {};\n    if (field.regEx) {\n      fs.regEx = field.regEx;\n    }\n    fs.autoform = {};\n    fs.autoform.multiple = field.multiple;\n    fs.autoform.reference_to = field.reference_to;\n    autoform_type = (ref = field.autoform) != null ? ref.type : void 0;\n    if (field.type === \"text\" || field.type === \"phone\") {\n      fs.type = String;\n      if (field.multiple) {\n        fs.type = [String];\n        fs.autoform.type = \"tags\";\n      }\n    } else if (field.type === \"[text]\" || field.type === \"[phone]\") {\n      fs.type = [String];\n      fs.autoform.type = \"tags\";\n    } else if (field.type === 'code') {\n      fs.type = String;\n      fs.autoform.type = \"widearea\";\n      fs.autoform.rows = field.rows || 12;\n      if (field.language) {\n        fs.autoform.language = field.language;\n      }\n    } else if (field.type === \"textarea\") {\n      fs.type = String;\n      fs.autoform.type = \"widearea\";\n      fs.autoform.rows = field.rows || 2;\n    } else if (field.type === \"password\") {\n      fs.type = String;\n      fs.autoform.type = \"password\";\n    } else if (field.type === \"date\") {\n      fs.type = Date;\n      if (Meteor.isClient) {\n        if (Steedos.isMobile() || Steedos.isPad()) {\n          fs.autoform.afFieldInput = {\n            type: \"steedos-date-mobile\",\n            dateMobileOptions: {\n              type: \"date\"\n            }\n          };\n        } else {\n          fs.autoform.outFormat = 'yyyy-MM-dd';\n          fs.autoform.afFieldInput = {\n            type: \"dx-date-box\",\n            timezoneId: \"utc\",\n            dxDateBoxOptions: {\n              type: \"date\",\n              displayFormat: \"yyyy-MM-dd\"\n            }\n          };\n        }\n      }\n    } else if (field.type === \"datetime\") {\n      fs.type = Date;\n      if (Meteor.isClient) {\n        if (Steedos.isMobile() || Steedos.isPad()) {\n          fs.autoform.afFieldInput = {\n            type: \"steedos-date-mobile\",\n            dateMobileOptions: {\n              type: \"datetime\"\n            }\n          };\n        } else {\n          fs.autoform.afFieldInput = {\n            type: \"dx-date-box\",\n            dxDateBoxOptions: {\n              type: \"datetime\",\n              displayFormat: \"yyyy-MM-dd HH:mm\"\n            }\n          };\n        }\n      }\n    } else if (field.type === \"[Object]\") {\n      fs.type = [Object];\n    } else if (field.type === \"html\") {\n      fs.type = String;\n      fs.autoform.afFieldInput = {\n        type: \"summernote\",\n        \"class\": 'editor',\n        settings: {\n          height: 200,\n          dialogsInBody: true,\n          toolbar: [['font1', ['style']], ['font2', ['bold', 'underline', 'italic', 'clear']], ['font3', ['fontname']], ['color', ['color']], ['para', ['ul', 'ol', 'paragraph']], ['table', ['table']], ['insert', ['link', 'picture']], ['view', ['codeview']]],\n          fontNames: ['Arial', 'Comic Sans MS', 'Courier New', 'Helvetica', 'Impact', 'å®‹ä½“', 'é»‘ä½“', 'å¾®è½¯é›…é»‘', 'ä»¿å®‹', 'æ¥·ä½“', 'éš¶ä¹¦', 'å¹¼åœ†']\n        }\n      };\n    } else if (field.type === \"lookup\" || field.type === \"master_detail\") {\n      fs.type = String;\n      fs.autoform.showIcon = field.showIcon;\n      if (field.multiple) {\n        fs.type = [String];\n      }\n      if (!field.hidden) {\n        fs.autoform.filters = field.filters;\n        fs.autoform.dependOn = field.depend_on;\n        if (field.beforeOpenFunction) {\n          fs.beforeOpenFunction = field.beforeOpenFunction;\n        }\n        fs.filtersFunction = field.filtersFunction ? field.filtersFunction : Creator.evaluateFilters;\n        if (field.optionsFunction) {\n          fs.optionsFunction = field.optionsFunction;\n        }\n        if (field.reference_to) {\n          if (Meteor.isClient) {\n            if (field.createFunction && _.isFunction(field.createFunction)) {\n              fs.createFunction = field.createFunction;\n            } else {\n              if (_.isString(field.reference_to)) {\n                _ref_obj = Creator.Objects[field.reference_to];\n                if (_ref_obj != null ? (ref1 = _ref_obj.permissions) != null ? ref1.allowCreate : void 0 : void 0) {\n                  fs.autoform.create = true;\n                  fs.createFunction = function(lookup_field) {\n                    return Modal.show(\"CreatorObjectModal\", {\n                      collection: \"Creator.Collections.\" + (Creator.getCollection(field.reference_to)._name),\n                      formId: \"new\" + (field.reference_to.replace('.', '_')),\n                      object_name: \"\" + field.reference_to,\n                      operation: \"insert\",\n                      onSuccess: function(operation, result) {\n                        var object;\n                        object = Creator.getObject(result.object_name);\n                        if (result.object_name === \"objects\") {\n                          return lookup_field.addItems([\n                            {\n                              label: result.value.label,\n                              value: result.value.name,\n                              icon: result.value.icon\n                            }\n                          ], result.value.name);\n                        } else {\n                          return lookup_field.addItems([\n                            {\n                              label: result.value[object.NAME_FIELD_KEY] || result.value.label || result.value.name,\n                              value: result._id\n                            }\n                          ], result._id);\n                        }\n                      }\n                    });\n                  };\n                } else {\n                  fs.autoform.create = false;\n                }\n              }\n            }\n          }\n          if (_.isBoolean(field.create)) {\n            fs.autoform.create = field.create;\n          }\n          if (field.reference_sort) {\n            fs.autoform.optionsSort = field.reference_sort;\n          }\n          if (field.reference_limit) {\n            fs.autoform.optionsLimit = field.reference_limit;\n          }\n          if (field.reference_to === \"users\") {\n            fs.autoform.type = \"selectuser\";\n            if (!field.hidden && !field.omit) {\n              if (field.is_company_limited === void 0) {\n                if (Meteor.isClient) {\n                  permissions = (ref2 = obj.permissions) != null ? ref2.get() : void 0;\n                  isUnLimited = permissions != null ? permissions.viewAllRecords : void 0;\n                  if (_.include([\"organizations\", \"users\", \"space_users\"], obj.name)) {\n                    isUnLimited = permissions != null ? permissions.modifyAllRecords : void 0;\n                  }\n                  if (isUnLimited) {\n                    fs.autoform.is_company_limited = false;\n                  } else {\n                    fs.autoform.is_company_limited = true;\n                  }\n                }\n              } else if (_.isFunction(field.is_company_limited)) {\n                if (Meteor.isClient) {\n                  fs.autoform.is_company_limited = field.is_company_limited(obj.permissions);\n                } else {\n                  fs.autoform.is_company_limited = true;\n                }\n              } else {\n                fs.autoform.is_company_limited = field.is_company_limited;\n              }\n            } else {\n              fs.autoform.is_company_limited = field.is_company_limited;\n            }\n          } else if (field.reference_to === \"organizations\") {\n            fs.autoform.type = \"selectorg\";\n            if (!field.hidden && !field.omit) {\n              if (field.is_company_limited === void 0) {\n                if (Meteor.isClient) {\n                  permissions = (ref3 = obj.permissions) != null ? ref3.get() : void 0;\n                  isUnLimited = permissions != null ? permissions.viewAllRecords : void 0;\n                  if (_.include([\"organizations\", \"users\", \"space_users\"], obj.name)) {\n                    isUnLimited = permissions != null ? permissions.modifyAllRecords : void 0;\n                  }\n                  if (isUnLimited) {\n                    fs.autoform.is_company_limited = false;\n                  } else {\n                    fs.autoform.is_company_limited = true;\n                  }\n                }\n              } else if (_.isFunction(field.is_company_limited)) {\n                if (Meteor.isClient) {\n                  fs.autoform.is_company_limited = field.is_company_limited(obj.permissions);\n                } else {\n                  fs.autoform.is_company_limited = true;\n                }\n              } else {\n                fs.autoform.is_company_limited = field.is_company_limited;\n              }\n            } else {\n              fs.autoform.is_company_limited = field.is_company_limited;\n            }\n          } else {\n            if (typeof field.reference_to === \"function\") {\n              _reference_to = field.reference_to();\n            } else {\n              _reference_to = field.reference_to;\n            }\n            if (_.isArray(_reference_to)) {\n              fs.type = Object;\n              fs.blackbox = true;\n              fs.autoform.objectSwitche = true;\n              schema[field_name + \".o\"] = {\n                type: String,\n                autoform: {\n                  omit: true\n                }\n              };\n              schema[field_name + \".ids\"] = {\n                type: [String],\n                autoform: {\n                  omit: true\n                }\n              };\n            } else {\n              _reference_to = [_reference_to];\n            }\n            _object = Creator.Objects[_reference_to[0]];\n            if (_object && _object.enable_tree) {\n              fs.autoform.type = \"selectTree\";\n            } else {\n              fs.autoform.type = \"steedosLookups\";\n              fs.autoform.optionsMethod = field.optionsMethod || \"creator.object_options\";\n              if (Meteor.isClient) {\n                fs.autoform.optionsMethodParams = function() {\n                  return {\n                    space: Session.get(\"spaceId\")\n                  };\n                };\n                fs.autoform.references = [];\n                _reference_to.forEach(function(_reference) {\n                  _object = Creator.Objects[_reference];\n                  if (_object) {\n                    return fs.autoform.references.push({\n                      object: _reference,\n                      label: _object != null ? _object.label : void 0,\n                      icon: _object != null ? _object.icon : void 0,\n                      link: function() {\n                        return \"/app/\" + (Session.get('app_id')) + \"/\" + _reference + \"/view/\";\n                      }\n                    });\n                  } else {\n                    return fs.autoform.references.push({\n                      object: _reference,\n                      link: function() {\n                        return \"/app/\" + (Session.get('app_id')) + \"/\" + _reference + \"/view/\";\n                      }\n                    });\n                  }\n                });\n              }\n            }\n          }\n        } else {\n          fs.autoform.type = \"steedosLookups\";\n          fs.autoform.defaultIcon = field.defaultIcon;\n        }\n      }\n    } else if (field.type === \"select\") {\n      fs.type = String;\n      if (field.multiple) {\n        fs.type = [String];\n        fs.autoform.type = \"steedosLookups\";\n        fs.autoform.showIcon = false;\n        fs.autoform.options = field.options;\n      } else {\n        fs.autoform.type = \"select\";\n        fs.autoform.options = field.options;\n        fs.autoform.firstOption = \"\";\n      }\n    } else if (field.type === \"currency\") {\n      fs.type = Number;\n      fs.autoform.type = \"steedosNumber\";\n      fs.autoform.precision = field.precision || 18;\n      if (field != null ? field.scale : void 0) {\n        fs.autoform.scale = field.scale;\n        fs.decimal = true;\n      } else if ((field != null ? field.scale : void 0) !== 0) {\n        fs.autoform.scale = 2;\n        fs.decimal = true;\n      }\n    } else if (field.type === \"number\") {\n      fs.type = Number;\n      fs.autoform.type = \"steedosNumber\";\n      fs.autoform.precision = field.precision || 18;\n      if (field != null ? field.scale : void 0) {\n        fs.autoform.scale = field.scale;\n        fs.decimal = true;\n      }\n    } else if (field.type === \"boolean\") {\n      fs.type = Boolean;\n      fs.autoform.type = \"steedos-boolean-checkbox\";\n    } else if (field.type === \"reference\") {\n      fs.type = String;\n    } else if (field.type === \"checkbox\") {\n      fs.type = [String];\n      fs.autoform.type = \"select-checkbox\";\n      fs.autoform.options = field.options;\n    } else if (field.type === \"file\" && field.collection) {\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: field.collection\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = field.collection;\n      }\n    } else if (field.type === \"filesize\") {\n      fs.type = Number;\n      fs.autoform.type = 'filesize';\n    } else if (field.type === \"Object\" || field.type === \"object\") {\n      fs.type = Object;\n    } else if (field.type === \"grid\") {\n      fs.type = Array;\n      fs.autoform.editable = true;\n      fs.autoform.type = \"steedosGrid\";\n      schema[field_name + \".$\"] = {\n        type: Object\n      };\n    } else if (field.type === \"image\") {\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: 'images',\n            accept: 'image/*'\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = 'images';\n        fs.autoform.accept = 'image/*';\n      }\n    } else if (field.type === \"avatar\") {\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: 'avatars',\n            accept: 'image/*'\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = 'avatars';\n        fs.autoform.accept = 'image/*';\n      }\n    } else if (field.type === \"audio\") {\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: 'audios',\n            accept: 'audio/*'\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = 'audios';\n        fs.autoform.accept = 'audio/*';\n      }\n    } else if (field.type === \"video\") {\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: 'videos',\n            accept: 'video/*'\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = 'videos';\n        fs.autoform.accept = 'video/*';\n      }\n    } else if (field.type === \"location\") {\n      fs.type = Object;\n      fs.autoform.type = \"location\";\n      fs.autoform.system = field.system || \"wgs84\";\n      fs.blackbox = true;\n    } else if (field.type === \"markdown\") {\n      fs.type = String;\n      fs.autoform.type = \"steedos-markdown\";\n    } else if (field.type === 'url') {\n      fs.type = String;\n      fs.autoform.type = 'steedosUrl';\n    } else if (field.type === 'email') {\n      fs.type = String;\n      fs.regEx = SimpleSchema.RegEx.Email;\n      fs.autoform.type = 'steedosEmail';\n    } else if (field.type === 'autonumber') {\n      fs.type = String;\n    } else {\n      fs.type = field.type;\n    }\n    if (field.label) {\n      fs.label = field.label;\n    }\n    if (!field.required) {\n      fs.optional = true;\n    }\n    if (!Meteor.isClient) {\n      fs.optional = true;\n    }\n    if (field.unique) {\n      fs.unique = true;\n    }\n    if (field.omit) {\n      fs.autoform.omit = true;\n    }\n    if (field.group) {\n      fs.autoform.group = field.group;\n    }\n    if (field.is_wide) {\n      fs.autoform.is_wide = true;\n    }\n    if (field.hidden) {\n      fs.autoform.type = \"hidden\";\n    }\n    if ((field.type === \"select\") || (field.type === \"lookup\") || (field.type === \"master_detail\")) {\n      if (typeof field.filterable === 'undefined') {\n        field.filterable = true;\n      }\n    }\n    if (field.name === 'name' || field.is_name) {\n      if (typeof field.searchable === 'undefined') {\n        field.searchable = true;\n      }\n    }\n    if (autoform_type) {\n      fs.autoform.type = autoform_type;\n    }\n    if (field.defaultValue) {\n      if (Meteor.isClient && Creator.Formular.checkFormula(field.defaultValue)) {\n        fs.autoform.defaultValue = function() {\n          return Creator.Formular.run(field.defaultValue, {\n            userId: Meteor.userId(),\n            spaceId: Session.get(\"spaceId\")\n          });\n        };\n      } else {\n        fs.autoform.defaultValue = field.defaultValue;\n        if (!_.isFunction(field.defaultValue)) {\n          fs.defaultValue = field.defaultValue;\n        }\n      }\n    }\n    if (field.readonly) {\n      fs.autoform.readonly = true;\n    }\n    if (field.disabled) {\n      fs.autoform.disabled = true;\n    }\n    if (field.inlineHelpText) {\n      fs.autoform.inlineHelpText = field.inlineHelpText;\n    }\n    if (field.blackbox) {\n      fs.blackbox = true;\n    }\n    if (_.has(field, 'min')) {\n      fs.min = field.min;\n    }\n    if (_.has(field, 'max')) {\n      fs.max = field.max;\n    }\n    if (Meteor.isProduction) {\n      if (field.index) {\n        fs.index = field.index;\n      } else if (field.sortable) {\n        fs.index = true;\n      }\n    }\n    return schema[field_name] = fs;\n  });\n  return schema;\n};\n\nCreator.getFieldDisplayValue = function(object_name, field_name, field_value) {\n  var field, html, object;\n  html = field_value;\n  object = Creator.getObject(object_name);\n  if (!object) {\n    return \"\";\n  }\n  field = object.fields(field_name);\n  if (!field) {\n    return \"\";\n  }\n  if (field.type === \"datetime\") {\n    html = moment(this.val).format('YYYY-MM-DD H:mm');\n  } else if (field.type === \"date\") {\n    html = moment(this.val).format('YYYY-MM-DD');\n  }\n  return html;\n};\n\nCreator.checkFieldTypeSupportBetweenQuery = function(field_type) {\n  return [\"date\", \"datetime\", \"currency\", \"number\"].includes(field_type);\n};\n\nCreator.pushBetweenBuiltinOptionals = function(field_type, operations) {\n  var builtinValues;\n  builtinValues = Creator.getBetweenBuiltinValues(field_type);\n  if (builtinValues) {\n    return _.forEach(builtinValues, function(builtinItem, key) {\n      return operations.push({\n        label: builtinItem.label,\n        value: key\n      });\n    });\n  }\n};\n\nCreator.getBetweenBuiltinValues = function(field_type, is_check_only) {\n  if ([\"date\", \"datetime\"].includes(field_type)) {\n    return Creator.getBetweenTimeBuiltinValues(is_check_only, field_type);\n  }\n};\n\nCreator.getBetweenBuiltinValueItem = function(field_type, key) {\n  if ([\"date\", \"datetime\"].includes(field_type)) {\n    return Creator.getBetweenTimeBuiltinValueItem(field_type, key);\n  }\n};\n\nCreator.getBetweenBuiltinOperation = function(field_type, value) {\n  var betweenBuiltinValues, result;\n  if (!_.isString(value)) {\n    return;\n  }\n  betweenBuiltinValues = Creator.getBetweenBuiltinValues(field_type);\n  if (!betweenBuiltinValues) {\n    return;\n  }\n  result = null;\n  _.each(betweenBuiltinValues, function(item, operation) {\n    if (item.key === value) {\n      return result = operation;\n    }\n  });\n  return result;\n};\n\nCreator.getBetweenTimeBuiltinValues = function(is_check_only, field_type) {\n  return {\n    \"between_time_last_year\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_year\"),\n    \"between_time_this_year\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_year\"),\n    \"between_time_next_year\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_year\"),\n    \"between_time_last_quarter\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_quarter\"),\n    \"between_time_this_quarter\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_quarter\"),\n    \"between_time_next_quarter\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_quarter\"),\n    \"between_time_last_month\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_month\"),\n    \"between_time_this_month\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_month\"),\n    \"between_time_next_month\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_month\"),\n    \"between_time_last_week\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_week\"),\n    \"between_time_this_week\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_week\"),\n    \"between_time_next_week\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_week\"),\n    \"between_time_yestday\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"yestday\"),\n    \"between_time_today\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"today\"),\n    \"between_time_tomorrow\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"tomorrow\"),\n    \"between_time_last_7_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_7_days\"),\n    \"between_time_last_30_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_30_days\"),\n    \"between_time_last_60_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_60_days\"),\n    \"between_time_last_90_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_90_days\"),\n    \"between_time_last_120_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_120_days\"),\n    \"between_time_next_7_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_7_days\"),\n    \"between_time_next_30_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_30_days\"),\n    \"between_time_next_60_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_60_days\"),\n    \"between_time_next_90_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_90_days\"),\n    \"between_time_next_120_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_120_days\")\n  };\n};\n\nCreator.getQuarterStartMonth = function(month) {\n  if (!month) {\n    month = new Date().getMonth();\n  }\n  if (month < 3) {\n    return 0;\n  } else if (month < 6) {\n    return 3;\n  } else if (month < 9) {\n    return 6;\n  }\n  return 9;\n};\n\nCreator.getLastQuarterFirstDay = function(year, month) {\n  if (!year) {\n    year = new Date().getFullYear();\n  }\n  if (!month) {\n    month = new Date().getMonth();\n  }\n  if (month < 3) {\n    year--;\n    month = 9;\n  } else if (month < 6) {\n    month = 0;\n  } else if (month < 9) {\n    month = 3;\n  } else {\n    month = 6;\n  }\n  return new Date(year, month, 1);\n};\n\nCreator.getNextQuarterFirstDay = function(year, month) {\n  if (!year) {\n    year = new Date().getFullYear();\n  }\n  if (!month) {\n    month = new Date().getMonth();\n  }\n  if (month < 3) {\n    month = 3;\n  } else if (month < 6) {\n    month = 6;\n  } else if (month < 9) {\n    month = 9;\n  } else {\n    year++;\n    month = 0;\n  }\n  return new Date(year, month, 1);\n};\n\nCreator.getMonthDays = function(year, month) {\n  var days, endDate, millisecond, startDate;\n  if (month === 11) {\n    return 31;\n  }\n  millisecond = 1000 * 60 * 60 * 24;\n  startDate = new Date(year, month, 1);\n  endDate = new Date(year, month + 1, 1);\n  days = (endDate - startDate) / millisecond;\n  return days;\n};\n\nCreator.getLastMonthFirstDay = function(year, month) {\n  if (!year) {\n    year = new Date().getFullYear();\n  }\n  if (!month) {\n    month = new Date().getMonth();\n  }\n  if (month === 0) {\n    month = 11;\n    year--;\n    return new Date(year, month, 1);\n  }\n  month--;\n  return new Date(year, month, 1);\n};\n\nCreator.getBetweenTimeBuiltinValueItem = function(field_type, key) {\n  var currentMonth, currentYear, endValue, firstDay, label, lastDay, lastMonday, lastMonthFinalDay, lastMonthFirstDay, lastQuarterEndDay, lastQuarterStartDay, lastSunday, last_120_days, last_30_days, last_60_days, last_7_days, last_90_days, millisecond, minusDay, monday, month, nextMonday, nextMonthFinalDay, nextMonthFirstDay, nextQuarterEndDay, nextQuarterStartDay, nextSunday, nextYear, next_120_days, next_30_days, next_60_days, next_7_days, next_90_days, now, previousYear, startValue, strEndDay, strFirstDay, strLastDay, strMonday, strStartDay, strSunday, strToday, strTomorrow, strYestday, sunday, thisQuarterEndDay, thisQuarterStartDay, tomorrow, values, week, year, yestday;\n  now = new Date();\n  millisecond = 1000 * 60 * 60 * 24;\n  yestday = new Date(now.getTime() - millisecond);\n  tomorrow = new Date(now.getTime() + millisecond);\n  week = now.getDay();\n  minusDay = week !== 0 ? week - 1 : 6;\n  monday = new Date(now.getTime() - (minusDay * millisecond));\n  sunday = new Date(monday.getTime() + (6 * millisecond));\n  lastSunday = new Date(monday.getTime() - millisecond);\n  lastMonday = new Date(lastSunday.getTime() - (millisecond * 6));\n  nextMonday = new Date(sunday.getTime() + millisecond);\n  nextSunday = new Date(nextMonday.getTime() + (millisecond * 6));\n  currentYear = now.getFullYear();\n  previousYear = currentYear - 1;\n  nextYear = currentYear + 1;\n  currentMonth = now.getMonth();\n  year = now.getFullYear();\n  month = now.getMonth();\n  firstDay = new Date(currentYear, currentMonth, 1);\n  if (currentMonth === 11) {\n    year++;\n    month++;\n  } else {\n    month++;\n  }\n  nextMonthFirstDay = new Date(year, month, 1);\n  nextMonthFinalDay = new Date(year, month, Creator.getMonthDays(year, month));\n  lastDay = new Date(nextMonthFirstDay.getTime() - millisecond);\n  lastMonthFirstDay = Creator.getLastMonthFirstDay(currentYear, currentMonth);\n  lastMonthFinalDay = new Date(firstDay.getTime() - millisecond);\n  thisQuarterStartDay = new Date(currentYear, Creator.getQuarterStartMonth(currentMonth), 1);\n  thisQuarterEndDay = new Date(currentYear, Creator.getQuarterStartMonth(currentMonth) + 2, Creator.getMonthDays(currentYear, Creator.getQuarterStartMonth(currentMonth) + 2));\n  lastQuarterStartDay = Creator.getLastQuarterFirstDay(currentYear, currentMonth);\n  lastQuarterEndDay = new Date(lastQuarterStartDay.getFullYear(), lastQuarterStartDay.getMonth() + 2, Creator.getMonthDays(lastQuarterStartDay.getFullYear(), lastQuarterStartDay.getMonth() + 2));\n  nextQuarterStartDay = Creator.getNextQuarterFirstDay(currentYear, currentMonth);\n  nextQuarterEndDay = new Date(nextQuarterStartDay.getFullYear(), nextQuarterStartDay.getMonth() + 2, Creator.getMonthDays(nextQuarterStartDay.getFullYear(), nextQuarterStartDay.getMonth() + 2));\n  last_7_days = new Date(now.getTime() - (6 * millisecond));\n  last_30_days = new Date(now.getTime() - (29 * millisecond));\n  last_60_days = new Date(now.getTime() - (59 * millisecond));\n  last_90_days = new Date(now.getTime() - (89 * millisecond));\n  last_120_days = new Date(now.getTime() - (119 * millisecond));\n  next_7_days = new Date(now.getTime() + (6 * millisecond));\n  next_30_days = new Date(now.getTime() + (29 * millisecond));\n  next_60_days = new Date(now.getTime() + (59 * millisecond));\n  next_90_days = new Date(now.getTime() + (89 * millisecond));\n  next_120_days = new Date(now.getTime() + (119 * millisecond));\n  switch (key) {\n    case \"last_year\":\n      label = t(\"creator_filter_operation_between_last_year\");\n      startValue = new Date(previousYear + \"-01-01T00:00:00Z\");\n      endValue = new Date(previousYear + \"-12-31T23:59:59Z\");\n      break;\n    case \"this_year\":\n      label = t(\"creator_filter_operation_between_this_year\");\n      startValue = new Date(currentYear + \"-01-01T00:00:00Z\");\n      endValue = new Date(currentYear + \"-12-31T23:59:59Z\");\n      break;\n    case \"next_year\":\n      label = t(\"creator_filter_operation_between_next_year\");\n      startValue = new Date(nextYear + \"-01-01T00:00:00Z\");\n      endValue = new Date(nextYear + \"-12-31T23:59:59Z\");\n      break;\n    case \"last_quarter\":\n      strFirstDay = moment(lastQuarterStartDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(lastQuarterEndDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_quarter\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"this_quarter\":\n      strFirstDay = moment(thisQuarterStartDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(thisQuarterEndDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_this_quarter\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"next_quarter\":\n      strFirstDay = moment(nextQuarterStartDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(nextQuarterEndDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_quarter\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"last_month\":\n      strFirstDay = moment(lastMonthFirstDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(lastMonthFinalDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_month\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"this_month\":\n      strFirstDay = moment(firstDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(lastDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_this_month\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"next_month\":\n      strFirstDay = moment(nextMonthFirstDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(nextMonthFinalDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_month\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"last_week\":\n      strMonday = moment(lastMonday).format(\"YYYY-MM-DD\");\n      strSunday = moment(lastSunday).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_week\");\n      startValue = new Date(strMonday + \"T00:00:00Z\");\n      endValue = new Date(strSunday + \"T23:59:59Z\");\n      break;\n    case \"this_week\":\n      strMonday = moment(monday).format(\"YYYY-MM-DD\");\n      strSunday = moment(sunday).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_this_week\");\n      startValue = new Date(strMonday + \"T00:00:00Z\");\n      endValue = new Date(strSunday + \"T23:59:59Z\");\n      break;\n    case \"next_week\":\n      strMonday = moment(nextMonday).format(\"YYYY-MM-DD\");\n      strSunday = moment(nextSunday).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_week\");\n      startValue = new Date(strMonday + \"T00:00:00Z\");\n      endValue = new Date(strSunday + \"T23:59:59Z\");\n      break;\n    case \"yestday\":\n      strYestday = moment(yestday).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_yestday\");\n      startValue = new Date(strYestday + \"T00:00:00Z\");\n      endValue = new Date(strYestday + \"T23:59:59Z\");\n      break;\n    case \"today\":\n      strToday = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_today\");\n      startValue = new Date(strToday + \"T00:00:00Z\");\n      endValue = new Date(strToday + \"T23:59:59Z\");\n      break;\n    case \"tomorrow\":\n      strTomorrow = moment(tomorrow).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_tomorrow\");\n      startValue = new Date(strTomorrow + \"T00:00:00Z\");\n      endValue = new Date(strTomorrow + \"T23:59:59Z\");\n      break;\n    case \"last_7_days\":\n      strStartDay = moment(last_7_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_7_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"last_30_days\":\n      strStartDay = moment(last_30_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_30_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"last_60_days\":\n      strStartDay = moment(last_60_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_60_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"last_90_days\":\n      strStartDay = moment(last_90_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_90_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"last_120_days\":\n      strStartDay = moment(last_120_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_120_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_7_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_7_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_7_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_30_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_30_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_30_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_60_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_60_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_60_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_90_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_90_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_90_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_120_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_120_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_120_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n  }\n  values = [startValue, endValue];\n  if (field_type === \"datetime\") {\n    _.forEach(values, function(fv) {\n      if (fv) {\n        return fv.setHours(fv.getHours() + fv.getTimezoneOffset() / 60);\n      }\n    });\n  }\n  return {\n    label: label,\n    key: key,\n    values: values\n  };\n};\n\nCreator.getFieldDefaultOperation = function(field_type) {\n  if (field_type && Creator.checkFieldTypeSupportBetweenQuery(field_type)) {\n    return 'between';\n  } else if ([\"textarea\", \"text\", \"code\"].includes(field_type)) {\n    return 'contains';\n  } else {\n    return \"=\";\n  }\n};\n\nCreator.getFieldOperation = function(field_type) {\n  var operations, optionals;\n  optionals = {\n    equal: {\n      label: t(\"creator_filter_operation_equal\"),\n      value: \"=\"\n    },\n    unequal: {\n      label: t(\"creator_filter_operation_unequal\"),\n      value: \"<>\"\n    },\n    less_than: {\n      label: t(\"creator_filter_operation_less_than\"),\n      value: \"<\"\n    },\n    greater_than: {\n      label: t(\"creator_filter_operation_greater_than\"),\n      value: \">\"\n    },\n    less_or_equal: {\n      label: t(\"creator_filter_operation_less_or_equal\"),\n      value: \"<=\"\n    },\n    greater_or_equal: {\n      label: t(\"creator_filter_operation_greater_or_equal\"),\n      value: \">=\"\n    },\n    contains: {\n      label: t(\"creator_filter_operation_contains\"),\n      value: \"contains\"\n    },\n    not_contain: {\n      label: t(\"creator_filter_operation_does_not_contain\"),\n      value: \"notcontains\"\n    },\n    starts_with: {\n      label: t(\"creator_filter_operation_starts_with\"),\n      value: \"startswith\"\n    },\n    between: {\n      label: t(\"creator_filter_operation_between\"),\n      value: \"between\"\n    }\n  };\n  if (field_type === void 0) {\n    return _.values(optionals);\n  }\n  operations = [];\n  if (Creator.checkFieldTypeSupportBetweenQuery(field_type)) {\n    operations.push(optionals.between);\n    Creator.pushBetweenBuiltinOptionals(field_type, operations);\n  } else if (field_type === \"text\" || field_type === \"textarea\" || field_type === \"html\" || field_type === \"code\") {\n    operations.push(optionals.contains);\n  } else if (field_type === \"lookup\" || field_type === \"master_detail\" || field_type === \"select\") {\n    operations.push(optionals.equal, optionals.unequal);\n  } else if (field_type === \"currency\" || field_type === \"number\") {\n    operations.push(optionals.equal, optionals.unequal, optionals.less_than, optionals.greater_than, optionals.less_or_equal, optionals.greater_or_equal);\n  } else if (field_type === \"boolean\") {\n    operations.push(optionals.equal, optionals.unequal);\n  } else if (field_type === \"checkbox\") {\n    operations.push(optionals.equal, optionals.unequal);\n  } else if (field_type === \"[text]\") {\n    operations.push(optionals.equal, optionals.unequal);\n  } else {\n    operations.push(optionals.equal, optionals.unequal);\n  }\n  return operations;\n};\n\n\n/*\n    å…ˆæŒ‰ç…§æœ‰æŽ’åºå·çš„å°çš„åœ¨å‰ï¼Œå¤§çš„åœ¨åŽ\n    å†å°†æ²¡æœ‰æŽ’åºå·çš„æ˜¾ç¤ºåœ¨\n */\n\nCreator.getObjectFieldsName = function(object_name) {\n  var fields, fieldsArr, fieldsName, ref;\n  fields = (ref = Creator.getObject(object_name)) != null ? ref.fields : void 0;\n  fieldsArr = [];\n  _.each(fields, function(field) {\n    return fieldsArr.push({\n      name: field.name,\n      sort_no: field.sort_no\n    });\n  });\n  fieldsName = [];\n  _.each(_.sortBy(fieldsArr, \"sort_no\"), function(field) {\n    return fieldsName.push(field.name);\n  });\n  return fieldsName;\n};\n","Creator._trigger_hooks = {}\r\n\r\ninitTrigger = (object_name, trigger)->\r\n\ttry\r\n\t\tcollection = Creator.getCollection(object_name)\r\n\t\tif !trigger.todo\r\n\t\t\treturn\r\n\t\ttodoWrapper = ()->\r\n\t\t\t  this.object_name = object_name\r\n\t\t\t  return trigger.todo.apply(this, arguments)\r\n\t\tif trigger.when == \"before.insert\"\r\n\t\t\t  return collection?.before?.insert(todoWrapper)\r\n\t\t  else if trigger.when == \"before.update\"\r\n\t\t\t  return collection?.before?.update(todoWrapper)\r\n\t\t  else if trigger.when == \"before.remove\"\r\n\t\t\t  return collection?.before?.remove(todoWrapper)\r\n\t\t  else if trigger.when == \"after.insert\"\r\n\t\t\t  return collection?.after?.insert(todoWrapper)\r\n\t\t  else if trigger.when == \"after.update\"\r\n\t\t\t  return collection?.after?.update(todoWrapper)\r\n\t\t  else if trigger.when == \"after.remove\"\r\n\t\t\t  return collection?.after?.remove(todoWrapper)\r\n\tcatch error\r\n\t\tconsole.error('initTrigger error', error)\r\n\r\ncleanTrigger = (object_name)->\r\n\t###\r\n    \tç”±äºŽcollection-hooks package çš„removeå‡½æ•°æ˜¯ä½¿ç”¨ä¸‹æ ‡åˆ é™¤å¯¹è±¡çš„ï¼Œæ‰€ä»¥æ­¤å¤„åè½¬hooksé›†åˆåŽï¼Œå†åˆ é™¤\r\n    \tå› ä¸ºä¸€ä¸ªæ•°ç»„å…ƒç´ åˆ é™¤åŽï¼Œå…¶ä»–å…ƒç´ çš„ä¸‹æ ‡ä¼šå‘ç”Ÿå˜åŒ–\r\n\t###\r\n    #TODO ç”±äºŽcollection-hooks package çš„removeå‡½æ•°bug\r\n\tCreator._trigger_hooks[object_name]?.reverse().forEach (_hook)->\r\n\t\t_hook.remove()\r\n\r\nCreator.initTriggers = (object_name)->\r\n#\tconsole.log('Creator.initTriggers object_name', object_name)\r\n\tobj = Creator.getObject(object_name)\r\n\r\n\tcleanTrigger(object_name)\r\n\r\n\tCreator._trigger_hooks[object_name] = []\r\n\r\n\t_.each obj.triggers, (trigger, trigger_name)->\r\n\t\tif Meteor.isServer and trigger.on == \"server\" and trigger.todo and trigger.when\r\n\t\t\t_trigger_hook = initTrigger object_name, trigger\r\n\t\t\tif _trigger_hook\r\n\t\t\t\tCreator._trigger_hooks[object_name].push(_trigger_hook)\r\n\t\tif Meteor.isClient and trigger.on == \"client\" and trigger.todo and trigger.when\r\n\t\t\t_trigger_hook = initTrigger object_name, trigger\r\n\t\t\tCreator._trigger_hooks[object_name].push(_trigger_hook)","var cleanTrigger, initTrigger;\n\nCreator._trigger_hooks = {};\n\ninitTrigger = function(object_name, trigger) {\n  var collection, error, ref, ref1, ref2, ref3, ref4, ref5, todoWrapper;\n  try {\n    collection = Creator.getCollection(object_name);\n    if (!trigger.todo) {\n      return;\n    }\n    todoWrapper = function() {\n      this.object_name = object_name;\n      return trigger.todo.apply(this, arguments);\n    };\n    if (trigger.when === \"before.insert\") {\n      return collection != null ? (ref = collection.before) != null ? ref.insert(todoWrapper) : void 0 : void 0;\n    } else if (trigger.when === \"before.update\") {\n      return collection != null ? (ref1 = collection.before) != null ? ref1.update(todoWrapper) : void 0 : void 0;\n    } else if (trigger.when === \"before.remove\") {\n      return collection != null ? (ref2 = collection.before) != null ? ref2.remove(todoWrapper) : void 0 : void 0;\n    } else if (trigger.when === \"after.insert\") {\n      return collection != null ? (ref3 = collection.after) != null ? ref3.insert(todoWrapper) : void 0 : void 0;\n    } else if (trigger.when === \"after.update\") {\n      return collection != null ? (ref4 = collection.after) != null ? ref4.update(todoWrapper) : void 0 : void 0;\n    } else if (trigger.when === \"after.remove\") {\n      return collection != null ? (ref5 = collection.after) != null ? ref5.remove(todoWrapper) : void 0 : void 0;\n    }\n  } catch (error1) {\n    error = error1;\n    return console.error('initTrigger error', error);\n  }\n};\n\ncleanTrigger = function(object_name) {\n\n  /*\n     \tç”±äºŽcollection-hooks package çš„removeå‡½æ•°æ˜¯ä½¿ç”¨ä¸‹æ ‡åˆ é™¤å¯¹è±¡çš„ï¼Œæ‰€ä»¥æ­¤å¤„åè½¬hooksé›†åˆåŽï¼Œå†åˆ é™¤\n     \tå› ä¸ºä¸€ä¸ªæ•°ç»„å…ƒç´ åˆ é™¤åŽï¼Œå…¶ä»–å…ƒç´ çš„ä¸‹æ ‡ä¼šå‘ç”Ÿå˜åŒ–\n   */\n  var ref;\n  return (ref = Creator._trigger_hooks[object_name]) != null ? ref.reverse().forEach(function(_hook) {\n    return _hook.remove();\n  }) : void 0;\n};\n\nCreator.initTriggers = function(object_name) {\n  var obj;\n  obj = Creator.getObject(object_name);\n  cleanTrigger(object_name);\n  Creator._trigger_hooks[object_name] = [];\n  return _.each(obj.triggers, function(trigger, trigger_name) {\n    var _trigger_hook;\n    if (Meteor.isServer && trigger.on === \"server\" && trigger.todo && trigger.when) {\n      _trigger_hook = initTrigger(object_name, trigger);\n      if (_trigger_hook) {\n        Creator._trigger_hooks[object_name].push(_trigger_hook);\n      }\n    }\n    if (Meteor.isClient && trigger.on === \"client\" && trigger.todo && trigger.when) {\n      _trigger_hook = initTrigger(object_name, trigger);\n      return Creator._trigger_hooks[object_name].push(_trigger_hook);\n    }\n  });\n};\n","clone = require('clone')\r\n\r\nCreator.getPermissions = (object_name, spaceId, userId)->\r\n\tif Meteor.isClient\r\n\t\tif !object_name\r\n\t\t\tobject_name = Session.get(\"object_name\")\r\n\t\tobj = Creator.getObject(object_name)\r\n\t\tif !obj\r\n\t\t\treturn\r\n\t\treturn obj.permissions.get()\r\n\telse if Meteor.isServer\r\n\t\tCreator.getObjectPermissions(spaceId, userId, object_name)\r\n\r\nCreator.getRecordPermissions = (object_name, record, userId, spaceId)->\r\n\tif !object_name and Meteor.isClient\r\n\t\tobject_name = Session.get(\"object_name\")\r\n\r\n\tif !spaceId and Meteor.isClient\r\n\t\tspaceId = Session.get(\"spaceId\")\r\n\t\r\n\tif record and object_name == \"cms_files\" and Meteor.isClient\r\n\t\t# å¦‚æžœæ˜¯cms_filesé™„ä»¶ï¼Œåˆ™æƒé™å–å…¶çˆ¶è®°å½•æƒé™\r\n\t\tif object_name == Session.get('object_name')\r\n\t\t\t# å½“å‰å¤„äºŽcms_filesé™„ä»¶è¯¦ç»†ç•Œé¢\r\n\t\t\tobject_name = record.parent['reference_to._o'];\r\n\t\t\trecord_id = record.parent._id;\r\n\t\telse \r\n\t\t\t# å½“å‰å¤„äºŽcms_filesé™„ä»¶çš„çˆ¶è®°å½•ç•Œé¢\r\n\t\t\tobject_name = Session.get('object_name');\r\n\t\t\trecord_id = Session.get(\"record_id\");\r\n\t\tobject_fields_keys = _.keys(Creator.getObject(object_name, spaceId)?.fields or {}) || [];\r\n\t\tselect = _.intersection(object_fields_keys, ['owner', 'company_id', 'company_ids', 'locked']) || [];\r\n\t\tif select.length > 0\r\n\t\t\trecord = Creator.getObjectRecord(object_name, record_id, select.join(','));\r\n\t\telse\r\n\t\t\trecord = null;\r\n\r\n\tpermissions = _.clone(Creator.getPermissions(object_name, spaceId, userId))\r\n\r\n\tif record\r\n\t\tisOwner = record.owner == userId || record.owner?._id == userId\r\n\t\tif Meteor.isClient\r\n\t\t\tuser_company_ids = Steedos.getUserCompanyIds()\r\n\t\telse\r\n\t\t\tuser_company_ids = Creator.getUserCompanyIds(userId, spaceId)\r\n\t\trecord_company_id = record?.company_id\r\n\t\tif record_company_id and _.isObject(record_company_id) and record_company_id._id\r\n\t\t\t# å› record_company_idæ˜¯lookupç±»åž‹ï¼Œæœ‰å¯èƒ½dxæŽ§ä»¶ä¼šæŠŠå®ƒæ˜ å°„è½¬ä¸ºå¯¹åº”çš„objectï¼Œæ‰€ä»¥è¿™é‡Œå–å‡ºå…¶_idå€¼\r\n\t\t\trecord_company_id = record_company_id._id\r\n\t\trecord_company_ids = record?.company_ids\r\n\t\tif record_company_ids and record_company_ids.length and _.isObject(record_company_ids[0])\r\n\t\t\t# å› record_company_idsæ˜¯lookupç±»åž‹ï¼Œæœ‰å¯èƒ½dxæŽ§ä»¶ä¼šæŠŠå®ƒæ˜ å°„è½¬ä¸ºå¯¹åº”çš„[object]ï¼Œæ‰€ä»¥è¿™é‡Œå–å‡ºå…¶_idå€¼\r\n\t\t\trecord_company_ids = record_company_ids.map((n)-> n._id)\r\n\t\trecord_company_ids = _.union(record_company_ids, [record_company_id])\r\n\t\tif !permissions.modifyAllRecords and !isOwner and !permissions.modifyCompanyRecords\r\n\t\t\tpermissions.allowEdit = false\r\n\t\t\tpermissions.allowDelete = false\r\n\t\telse if !permissions.modifyAllRecords and permissions.modifyCompanyRecords\r\n\t\t\tif record_company_ids and record_company_ids.length\r\n\t\t\t\tif user_company_ids and user_company_ids.length\r\n\t\t\t\t\tif !_.intersection(user_company_ids, record_company_ids).length\r\n\t\t\t\t\t\t# è®°å½•çš„company_id/company_idså±žæ€§ä¸åœ¨å½“å‰ç”¨æˆ·user_company_idsèŒƒå›´å†…æ—¶ï¼Œè®¤ä¸ºæ— æƒä¿®æ”¹\r\n\t\t\t\t\t\tpermissions.allowEdit = false\r\n\t\t\t\t\t\tpermissions.allowDelete = false\r\n\t\t\t\telse\r\n\t\t\t\t\t# è®°å½•æœ‰company_id/company_idså±žæ€§ï¼Œä½†æ˜¯å½“å‰ç”¨æˆ·user_company_idsä¸ºç©ºæ—¶ï¼Œè®¤ä¸ºæ— æƒä¿®æ”¹\r\n\t\t\t\t\tpermissions.allowEdit = false\r\n\t\t\t\t\tpermissions.allowDelete = false\r\n\t\t\r\n\t\tif record.locked and !permissions.modifyAllRecords\r\n\t\t\tpermissions.allowEdit = false\r\n\t\t\tpermissions.allowDelete = false\r\n\r\n\t\tif !permissions.viewAllRecords and !isOwner and !permissions.viewCompanyRecords\r\n\t\t\tpermissions.allowRead = false\r\n\t\telse if !permissions.viewAllRecords and permissions.viewCompanyRecords\r\n\t\t\tif record_company_ids and record_company_ids.length\r\n\t\t\t\tif user_company_ids and user_company_ids.length\r\n\t\t\t\t\tif !_.intersection(user_company_ids, record_company_ids).length\r\n\t\t\t\t\t\t# è®°å½•çš„company_id/company_idså±žæ€§ä¸åœ¨å½“å‰ç”¨æˆ·user_company_idsèŒƒå›´å†…æ—¶ï¼Œè®¤ä¸ºæ— æƒæŸ¥çœ‹\r\n\t\t\t\t\t\tpermissions.allowRead = false\r\n\t\t\t\telse\r\n\t\t\t\t\t# è®°å½•æœ‰company_idå±žæ€§ï¼Œä½†æ˜¯å½“å‰ç”¨æˆ·user_company_idsä¸ºç©ºæ—¶ï¼Œè®¤ä¸ºæ— æƒæŸ¥çœ‹\r\n\t\t\t\t\tpermissions.allowRead = false\r\n\r\n\treturn permissions\r\n\r\n\r\n# currentObjectNameï¼šå½“å‰ä¸»å¯¹è±¡\r\n# relatedListItemï¼šCreator.getRelatedList(Session.get(\"object_name\"), Session.get(\"record_id\"))ä¸­å–related_object_nameå¯¹åº”çš„å€¼\r\n# currentRecordå½“å‰ä¸»å¯¹è±¡çš„è¯¦ç»†è®°å½•\r\nif Meteor.isClient\r\n\tCreator.getRecordRelatedListPermissions = (currentObjectName, relatedListItem, currentRecord, userId, spaceId)->\r\n\t\tif !currentObjectName and Meteor.isClient\r\n\t\t\tcurrentObjectName = Session.get(\"object_name\")\r\n\r\n\t\tif !relatedListItem\r\n\t\t\tconsole.error(\"relatedListItem must not be empty for the function Creator.getRecordRelatedListPermissions\");\r\n\t\t\treturn {}\r\n\r\n\t\tif !currentRecord and Meteor.isClient\r\n\t\t\tcurrentRecord = Creator.getObjectRecord()\r\n\r\n\t\tif !userId and Meteor.isClient\r\n\t\t\tuserId = Meteor.userId()\r\n\r\n\t\tif !spaceId and Meteor.isClient\r\n\t\t\tspaceId = Session.get(\"spaceId\")\r\n\r\n\t\tsharing = relatedListItem.sharing || 'masterWrite'\r\n\t\tmasterAllow = false\r\n\t\tmasterRecordPerm = Creator.getRecordPermissions(currentObjectName, currentRecord, userId, spaceId)\r\n\t\tif sharing == 'masterRead'\r\n\t\t\tmasterAllow = masterRecordPerm.allowRead\r\n\t\telse if sharing == 'masterWrite'\r\n\t\t\tmasterAllow = masterRecordPerm.allowEdit\r\n\r\n\t\tuneditable_related_list = Creator.getRecordSafeRelatedList(currentRecord, currentObjectName)\r\n\t\trelatedObjectPermissions = Creator.getPermissions(relatedListItem.object_name)\r\n\t\tisRelateObjectUneditable = uneditable_related_list.indexOf(relatedListItem.object_name) > -1\r\n\r\n\t\tresult = _.clone relatedObjectPermissions\r\n\t\tresult.allowCreate = masterAllow && relatedObjectPermissions.allowCreate && !isRelateObjectUneditable\r\n\t\tresult.allowEdit = masterAllow && relatedObjectPermissions.allowEdit && !isRelateObjectUneditable\r\n\t\treturn result\r\n\r\nif Meteor.isServer\r\n\r\n\tCreator.getAllPermissions = (spaceId, userId) ->\r\n\t\tpermissions =\r\n\t\t\tobjects: {}\r\n\t\t\tassigned_apps: []\r\n\t\t###\r\n\t\tæƒé™ç»„è¯´æ˜Ž:\r\n\t\tå†…ç½®æƒé™ç»„-admin,user,member,guest,workflow_admin,organization_admin\r\n\t\tè‡ªå®šä¹‰æƒé™ç»„-æ•°æ®åº“ä¸­æ–°å»ºçš„é™¤å†…ç½®æƒé™ç»„ä»¥å¤–çš„å…¶ä»–æƒé™ç»„\r\n\t\tç‰¹å®šç”¨æˆ·é›†åˆæƒé™ç»„ï¼ˆå³userså±žæ€§ä¸å¯é…ç½®ï¼‰-admin,user,member,guest\r\n\t\tå¯é…ç½®ç”¨æˆ·é›†åˆæƒé™ç»„ï¼ˆå³userså±žæ€§å¯é…ç½®ï¼‰-workflow_admin,organization_adminä»¥åŠè‡ªå®šä¹‰æƒé™ç»„\r\n\t\t###\r\n\t\tpsetsAdmin = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'admin'}, {fields:{_id:1, assigned_apps:1}}) || null\r\n\t\tpsetsUser = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'user'}, {fields:{_id:1, assigned_apps:1}}) || null\r\n\t\tpsetsMember = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'member'}, {fields:{_id:1, assigned_apps:1}}) || null\r\n\t\tpsetsGuest = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'guest'}, {fields:{_id:1, assigned_apps:1}}) || null\r\n\t\tpsetsCurrent = Creator.getCollection(\"permission_set\").find({users: userId, space: spaceId}, {fields:{_id:1, assigned_apps:1, name:1}}).fetch()\r\n\r\n\t\tpsetsAdmin_pos = null\r\n\t\tpsetsUser_pos = null\r\n\t\tpsetsMember_pos = null\r\n\t\tpsetsGuest_pos = null\r\n\t\tpsetsCurrent_pos = null\r\n\r\n\t\tif psetsAdmin?._id\r\n\t\t\tpsetsAdmin_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsAdmin._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\r\n\t\tif psetsUser?._id\r\n\t\t\tpsetsUser_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsUser._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\r\n\t\tif psetsMember?._id\r\n\t\t\tpsetsMember_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsMember._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\r\n\t\tif psetsGuest?._id\r\n\t\t\tpsetsGuest_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsGuest._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\r\n\t\tif psetsCurrent.length > 0\r\n\t\t\tset_ids = _.pluck psetsCurrent, \"_id\"\r\n\t\t\tpsetsCurrent_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: {$in: set_ids}}).fetch()\r\n\t\t\tpsetsCurrentNames = _.pluck psetsCurrent, \"name\"\r\n\t\tisSpaceAdmin = false\r\n\t\tspaceUser = null\r\n\t\tif userId\r\n\t\t\tisSpaceAdmin = Creator.isSpaceAdmin(spaceId, userId)\r\n\t\t\tspaceUser = Creator.getCollection(\"space_users\").findOne({ space: spaceId, user: userId }, { fields: { profile: 1 } })\r\n\r\n\t\tpsets = { \r\n\t\t\tpsetsAdmin, \r\n\t\t\tpsetsUser, \r\n\t\t\tpsetsCurrent, \r\n\t\t\tpsetsMember, \r\n\t\t\tpsetsGuest, \r\n\t\t\tisSpaceAdmin, \r\n\t\t\tspaceUser, \r\n\t\t\tpsetsAdmin_pos, \r\n\t\t\tpsetsUser_pos, \r\n\t\t\tpsetsMember_pos, \r\n\t\t\tpsetsGuest_pos, \r\n\t\t\tpsetsCurrent_pos\r\n\t\t}\r\n\t\tpermissions.assigned_apps = Creator.getAssignedApps.bind(psets)(spaceId, userId)\r\n\t\tpermissions.assigned_menus = Creator.getAssignedMenus.bind(psets)(spaceId, userId)\r\n\t\tpermissions.user_permission_sets = psetsCurrentNames\r\n\t\t_i = 0\r\n\t\t_.each Creator.objectsByName, (object, object_name)->\r\n\t\t\t_i++\r\n\t\t\tif !_.has(object, 'space') || !object.space || object.space == spaceId\r\n\t\t\t\tif !_.has(object, 'in_development') || object.in_development == '0' || (object.in_development != '0' && isSpaceAdmin)\r\n\t\t\t\t\tpermissions.objects[object_name] = Creator.convertObject(clone(Creator.Objects[object_name]), spaceId)\r\n\t\t\t\t\tpermissions.objects[object_name][\"permissions\"] = Creator.getObjectPermissions.bind(psets)(spaceId, userId, object_name)\r\n\t\treturn permissions\r\n\r\n\tunionPlus = (array, other) ->\r\n\t\tif !array and !other\r\n\t\t\treturn undefined\r\n\t\tif !array\r\n\t\t\tarray = []\r\n\t\tif !other\r\n\t\t\tother = []\r\n\t\treturn _.union(array, other)\r\n\r\n\tintersectionPlus = (array, other) ->\r\n\t\tif !array and !other\r\n\t\t\treturn undefined\r\n\t\tif !array\r\n\t\t\tarray = []\r\n\t\tif !other\r\n\t\t\tother = []\r\n\t\treturn _.intersection(array, other)\r\n\r\n\tCreator.getAssignedApps = (spaceId, userId)->\r\n\t\tpsetsAdmin = this.psetsAdmin || Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'admin'}, {fields:{_id:1, assigned_apps:1}})\r\n\t\tpsetsUser = this.psetsUser || Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'user'}, {fields:{_id:1, assigned_apps:1}})\r\n\t\t# psetsMember = this.psetsMember || Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'member'}, {fields:{_id:1, assigned_apps:1}})\r\n\t\t# psetsGuest = this.psetsGuest || Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'guest'}, {fields:{_id:1, assigned_apps:1}})\r\n\t\tpsets =  this.psetsCurrent || Creator.getCollection(\"permission_set\").find({users: userId, space: spaceId}, {fields:{_id:1, assigned_apps:1, name:1}}).fetch()\r\n\t\tisSpaceAdmin = if _.isBoolean(this.isSpaceAdmin) then this.isSpaceAdmin else Creator.isSpaceAdmin(spaceId, userId)\r\n\t\tapps = []\r\n\t\tif isSpaceAdmin\r\n\t\t\treturn []\r\n\t\telse\r\n\t\t\tpsetBase = psetsUser\r\n\t\t\tif psetBase?.assigned_apps?.length\r\n\t\t\t\tapps = _.union apps, psetBase.assigned_apps\r\n\t\t\telse\r\n\t\t\t\t# useræƒé™ç»„ä¸­çš„assigned_appsè¡¨ç¤ºæ‰€æœ‰ç”¨æˆ·å…·æœ‰çš„appsæƒé™ï¼Œä¸ºç©ºåˆ™è¡¨ç¤ºæœ‰æ‰€æœ‰appsæƒé™ï¼Œä¸éœ€è¦ä½œæƒé™åˆ¤æ–­äº†\r\n\t\t\t\treturn []\r\n\t\t\t_.each psets, (pset)->\r\n\t\t\t\tif !pset.assigned_apps\r\n\t\t\t\t\treturn\r\n\t\t\t\tif pset.name == \"admin\" ||  pset.name == \"user\"\r\n\t\t\t\t\t# è¿™é‡Œä¹‹æ‰€ä»¥è¦æŽ’é™¤admin/userï¼Œæ˜¯å› ä¸ºè¿™ä¸¤ä¸ªæƒé™ç»„æ˜¯æ‰€æœ‰æƒé™ç»„ä¸­userså±žæ€§æ— æ•ˆçš„æƒé™ç»„ï¼Œç‰¹æŒ‡å·¥ä½œåŒºç®¡ç†å‘˜å’Œæ‰€æœ‰ç”¨æˆ·\r\n\t\t\t\t\treturn\r\n\t\t\t\tapps = _.union apps, pset.assigned_apps\r\n\t\t\treturn _.without(_.uniq(apps),undefined,null)\r\n\r\n\tCreator.getAssignedMenus = (spaceId, userId)->\r\n\t\tpsets =  this.psetsCurrent || Creator.getCollection(\"permission_set\").find({users: userId, space: spaceId}, {fields:{_id:1, assigned_apps:1, name:1}}).fetch()\r\n\t\tisSpaceAdmin = if _.isBoolean(this.isSpaceAdmin) then this.isSpaceAdmin else Creator.isSpaceAdmin(spaceId, userId)\r\n\t\tadminMenus = Creator.Apps.admin?.admin_menus\r\n\t\t# å¦‚æžœæ²¡æœ‰adminèœå•è¯´æ˜Žä¸éœ€è¦ç›¸å…³åŠŸèƒ½ï¼Œç›´æŽ¥è¿”å›žç©º\r\n\t\tunless adminMenus\r\n\t\t\treturn []\r\n\t\taboutMenu = adminMenus.find (n) ->\r\n\t\t\tn._id == 'about'\r\n\t\tadminMenus = adminMenus.filter (n) ->\r\n\t\t\tn._id != 'about'\r\n\t\totherMenuApps = _.sortBy _.filter(_.values(Creator.Apps), (n) ->\r\n\t\t\treturn n.admin_menus and n._id != 'admin'\r\n\t\t), 'sort'\r\n\t\totherMenus = _.flatten(_.pluck(otherMenuApps, \"admin_menus\"))\r\n\t\t# èœå•æœ‰ä¸‰éƒ¨åˆ†ç»„æˆï¼Œè®¾ç½®APPèœå•ã€å…¶ä»–APPèœå•ä»¥åŠaboutèœå•\r\n\t\tallMenus = _.union(adminMenus, otherMenus, [aboutMenu])\r\n\t\tif isSpaceAdmin\r\n\t\t\t# å·¥ä½œåŒºç®¡ç†å‘˜æœ‰å…¨éƒ¨èœå•åŠŸèƒ½\r\n\t\t\tresult = allMenus\r\n\t\telse\r\n\t\t\tcurrentPsetNames = psets.map (n) ->\r\n\t\t\t\treturn n.name\r\n\t\t\tmenus = allMenus.filter (menu)->\r\n\t\t\t\tpsetsMenu = menu.permission_sets\r\n\t\t\t\t# å¦‚æžœæ™®é€šç”¨æˆ·æœ‰æƒé™ï¼Œåˆ™ç›´æŽ¥è¿”å›žtrue\r\n\t\t\t\tif psetsMenu && psetsMenu.indexOf(\"user\") > -1\r\n\t\t\t\t\treturn true\r\n\t\t\t\t# å¦åˆ™å–å½“å‰ç”¨æˆ·çš„æƒé™é›†ä¸Žmenuèœå•è¦æ±‚çš„æƒé™é›†å¯¹æ¯”ï¼Œå¦‚æžœäº¤é›†å¤§äºŽ1ä¸ªåˆ™è¿”å›žtrue\r\n\t\t\t\treturn _.intersection(currentPsetNames, psetsMenu).length\r\n\t\t\tresult = menus\r\n\t\t\r\n\t\treturn _.sortBy(result,\"sort\")\r\n\r\n\tfindOne_permission_object = (permission_objects, object_name, permission_set_id)->\r\n\r\n\t\tif _.isNull(permission_objects)\r\n\t\t\treturn null\r\n\t\tif _.isArray(permission_objects)\r\n\t\t\treturn _.find permission_objects, (po)->\r\n\t\t\t\t\treturn po.object_name == object_name\r\n\t\treturn Creator.getCollection(\"permission_objects\").findOne({object_name: object_name, permission_set_id: permission_set_id})\r\n\r\n\tfind_permission_object = (permission_objects, object_name, permission_set_ids)->\r\n\t\tif _.isNull(permission_objects)\r\n\t\t\treturn null\r\n\t\tif _.isArray(permission_objects)\r\n\t\t\treturn _.filter permission_objects, (po)->\r\n\t\t\t\treturn po.object_name == object_name\r\n\t\tCreator.getCollection(\"permission_objects\").find({object_name: object_name, permission_set_id: {$in: permission_set_ids}}).fetch()\r\n\r\n\tunionPermissionObjects = (pos, object, psets)->\r\n\t\t# æŠŠdbåŠymlä¸­çš„permission_objectsåˆå¹¶ï¼Œä¼˜å…ˆå–dbä¸­çš„\r\n\t\tresult = []\r\n\t\t_.each object.permission_set, (ops, ops_key)->\r\n\t\t\t# æŠŠymlä¸­é™¤äº†ç‰¹å®šç”¨æˆ·é›†åˆæƒé™ç»„\"admin\", \"user\", \"member\", \"guest\"å¤–çš„å…¶ä»–å¯¹è±¡æƒé™å…ˆå­˜å…¥result\r\n\t\t\t# if [\"admin\", \"user\", \"member\", \"guest\", \"workflow_admin\", \"organization_admin\"].indexOf(ops_key) < 0\r\n\t\t\tif [\"admin\", \"user\", \"member\", \"guest\"].indexOf(ops_key) < 0\r\n\t\t\t\tcurrentPset = psets.find (pset)-> return pset.name == ops_key\r\n\t\t\t\tif currentPset\r\n\t\t\t\t\ttempOps = _.clone(ops) || {}\r\n\t\t\t\t\ttempOps.permission_set_id = currentPset._id\r\n\t\t\t\t\ttempOps.object_name = object.object_name\r\n\t\t\t\t\tresult.push tempOps\r\n\t\tif result.length\r\n\t\t\tpos.forEach (po)->\r\n\t\t\t\trepeatIndex = 0\r\n\t\t\t\trepeatPo = result.find((item, index)-> repeatIndex = index;return item.permission_set_id == po.permission_set_id)\r\n\t\t\t\t# å¦‚æžœymlä¸­å·²ç»å­˜åœ¨poï¼Œåˆ™æ›¿æ¢ä¸ºæ•°æ®åº“ä¸­çš„poï¼Œåä¹‹åˆ™æŠŠæ•°æ®åº“ä¸­çš„poç›´æŽ¥ç´¯åŠ è¿›åŽ»\r\n\t\t\t\tif repeatPo\r\n\t\t\t\t\tresult[repeatIndex] = po\r\n\t\t\t\telse\r\n\t\t\t\t\tresult.push po\r\n\t\t\treturn result\r\n\t\telse\r\n\t\t\treturn pos\r\n\r\n\tCreator.getObjectPermissions = (spaceId, userId, object_name)->\r\n\t\tpermissions = {}\r\n\t\tobject = Creator.getObject(object_name, spaceId)\r\n\r\n\t\tif spaceId is 'guest' || object_name == \"users\"\r\n\t\t\tpermissions = _.clone(object.permission_set.guest) || {}\r\n\t\t\tCreator.processPermissions permissions\r\n\t\t\treturn permissions\r\n\t\tpsetsAdmin = if _.isNull(this.psetsAdmin) or this.psetsAdmin then this.psetsAdmin else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'admin'}, {fields:{_id:1}})\r\n\t\tpsetsUser = if _.isNull(this.psetsUser) or this.psetsUser then this.psetsUser else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'user'}, {fields:{_id:1}})\r\n\t\tpsetsMember = if _.isNull(this.psetsMember) or this.psetsMember then this.psetsMember else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'member'}, {fields:{_id:1}})\r\n\t\tpsetsGuest = if _.isNull(this.psetsGuest) or this.psetsGuest then this.psetsGuest else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'guest'}, {fields:{_id:1}})\r\n\t\tpsets = this.psetsCurrent || Creator.getCollection(\"permission_set\").find({users: userId, space: spaceId}, {fields:{_id:1, assigned_apps:1, name:1}}).fetch()\r\n\t\tisSpaceAdmin = if _.isBoolean(this.isSpaceAdmin) then this.isSpaceAdmin else Creator.isSpaceAdmin(spaceId, userId)\r\n\r\n\t\tpsetsAdmin_pos = this.psetsAdmin_pos\r\n\t\tpsetsUser_pos = this.psetsUser_pos\r\n\t\tpsetsMember_pos = this.psetsMember_pos\r\n\t\tpsetsGuest_pos = this.psetsGuest_pos\r\n\t\tpsetsCurrent_pos = this.psetsCurrent_pos\r\n\r\n\t\topsetAdmin = _.clone(object.permission_set.admin) || {}\r\n\t\topsetUser = _.clone(object.permission_set.user) || {}\r\n\t\topsetMember = _.clone(object.permission_set.member) || {}\r\n\t\topsetGuest = _.clone(object.permission_set.guest) || {}\r\n\r\n\t\t# sharedListViews = Creator.getCollection('object_listviews').find({space: spaceId, object_name: object_name, shared: true}, {fields:{_id:1}}).fetch()\r\n\t\t# sharedListViews = _.pluck(sharedListViews,\"_id\")\r\n\t\t# if sharedListViews.length\r\n\t\t# \tunless opsetAdmin.list_views\r\n\t\t# \t\topsetAdmin.list_views = []\r\n\t\t# \topsetAdmin.list_views = _.union opsetAdmin.list_views, sharedListViews\r\n\t\t# \tunless opsetUser.list_views\r\n\t\t# \t\topsetUser.list_views = []\r\n\t\t# \topsetUser.list_views = _.union opsetUser.list_views, sharedListViews\r\n\t\t# æ•°æ®åº“ä¸­å¦‚æžœé…ç½®äº†é»˜è®¤çš„admin/useræƒé™é›†è®¾ç½®ï¼Œåº”è¯¥è¦†ç›–ä»£ç ä¸­admin/userçš„æƒé™é›†è®¾ç½®\r\n\t\tif psetsAdmin\r\n\t\t\tposAdmin = findOne_permission_object(psetsAdmin_pos, object_name, psetsAdmin._id)\r\n\t\t\tif posAdmin\r\n\t\t\t\topsetAdmin.allowCreate = posAdmin.allowCreate\r\n\t\t\t\topsetAdmin.allowDelete = posAdmin.allowDelete\r\n\t\t\t\topsetAdmin.allowEdit = posAdmin.allowEdit\r\n\t\t\t\topsetAdmin.allowRead = posAdmin.allowRead\r\n\t\t\t\topsetAdmin.modifyAllRecords = posAdmin.modifyAllRecords\r\n\t\t\t\topsetAdmin.viewAllRecords = posAdmin.viewAllRecords\r\n\t\t\t\topsetAdmin.modifyCompanyRecords = posAdmin.modifyCompanyRecords\r\n\t\t\t\topsetAdmin.viewCompanyRecords = posAdmin.viewCompanyRecords\r\n\t\t\t\topsetAdmin.disabled_list_views = posAdmin.disabled_list_views\r\n\t\t\t\topsetAdmin.disabled_actions = posAdmin.disabled_actions\r\n\t\t\t\topsetAdmin.unreadable_fields = posAdmin.unreadable_fields\r\n\t\t\t\topsetAdmin.uneditable_fields = posAdmin.uneditable_fields\r\n\t\t\t\topsetAdmin.unrelated_objects = posAdmin.unrelated_objects\r\n\t\t\t\topsetAdmin.uneditable_related_list = posAdmin.uneditable_related_list\r\n\t\tif psetsUser\r\n\t\t\tposUser = findOne_permission_object(psetsUser_pos, object_name, psetsUser._id)\r\n\t\t\tif posUser\r\n\t\t\t\topsetUser.allowCreate = posUser.allowCreate\r\n\t\t\t\topsetUser.allowDelete = posUser.allowDelete\r\n\t\t\t\topsetUser.allowEdit = posUser.allowEdit\r\n\t\t\t\topsetUser.allowRead = posUser.allowRead\r\n\t\t\t\topsetUser.modifyAllRecords = posUser.modifyAllRecords\r\n\t\t\t\topsetUser.viewAllRecords = posUser.viewAllRecords\r\n\t\t\t\topsetUser.modifyCompanyRecords = posUser.modifyCompanyRecords\r\n\t\t\t\topsetUser.viewCompanyRecords = posUser.viewCompanyRecords\r\n\t\t\t\topsetUser.disabled_list_views = posUser.disabled_list_views\r\n\t\t\t\topsetUser.disabled_actions = posUser.disabled_actions\r\n\t\t\t\topsetUser.unreadable_fields = posUser.unreadable_fields\r\n\t\t\t\topsetUser.uneditable_fields = posUser.uneditable_fields\r\n\t\t\t\topsetUser.unrelated_objects = posUser.unrelated_objects\r\n\t\t\t\topsetUser.uneditable_related_list = posUser.uneditable_related_list\r\n\t\tif psetsMember\r\n\t\t\tposMember = findOne_permission_object(psetsMember_pos, object_name, psetsMember._id)\r\n\t\t\tif posMember\r\n\t\t\t\topsetMember.allowCreate = posMember.allowCreate\r\n\t\t\t\topsetMember.allowDelete = posMember.allowDelete\r\n\t\t\t\topsetMember.allowEdit = posMember.allowEdit\r\n\t\t\t\topsetMember.allowRead = posMember.allowRead\r\n\t\t\t\topsetMember.modifyAllRecords = posMember.modifyAllRecords\r\n\t\t\t\topsetMember.viewAllRecords = posMember.viewAllRecords\r\n\t\t\t\topsetMember.modifyCompanyRecords = posMember.modifyCompanyRecords\r\n\t\t\t\topsetMember.viewCompanyRecords = posMember.viewCompanyRecords\r\n\t\t\t\topsetMember.disabled_list_views = posMember.disabled_list_views\r\n\t\t\t\topsetMember.disabled_actions = posMember.disabled_actions\r\n\t\t\t\topsetMember.unreadable_fields = posMember.unreadable_fields\r\n\t\t\t\topsetMember.uneditable_fields = posMember.uneditable_fields\r\n\t\t\t\topsetMember.unrelated_objects = posMember.unrelated_objects\r\n\t\t\t\topsetMember.uneditable_related_list = posMember.uneditable_related_list\r\n\t\tif psetsGuest\r\n\t\t\tposGuest = findOne_permission_object(psetsGuest_pos, object_name, psetsGuest._id)\r\n\t\t\tif posGuest\r\n\t\t\t\topsetGuest.allowCreate = posGuest.allowCreate\r\n\t\t\t\topsetGuest.allowDelete = posGuest.allowDelete\r\n\t\t\t\topsetGuest.allowEdit = posGuest.allowEdit\r\n\t\t\t\topsetGuest.allowRead = posGuest.allowRead\r\n\t\t\t\topsetGuest.modifyAllRecords = posGuest.modifyAllRecords\r\n\t\t\t\topsetGuest.viewAllRecords = posGuest.viewAllRecords\r\n\t\t\t\topsetGuest.modifyCompanyRecords = posGuest.modifyCompanyRecords\r\n\t\t\t\topsetGuest.viewCompanyRecords = posGuest.viewCompanyRecords\r\n\t\t\t\topsetGuest.disabled_list_views = posGuest.disabled_list_views\r\n\t\t\t\topsetGuest.disabled_actions = posGuest.disabled_actions\r\n\t\t\t\topsetGuest.unreadable_fields = posGuest.unreadable_fields\r\n\t\t\t\topsetGuest.uneditable_fields = posGuest.uneditable_fields\r\n\t\t\t\topsetGuest.unrelated_objects = posGuest.unrelated_objects\r\n\t\t\t\topsetGuest.uneditable_related_list = posGuest.uneditable_related_list\r\n\r\n\t\tif !userId\r\n\t\t\tpermissions = opsetAdmin\r\n\t\telse\r\n\t\t\tif isSpaceAdmin\r\n\t\t\t\tpermissions = opsetAdmin\r\n\t\t\telse\r\n\t\t\t\tif spaceId is 'common'\r\n\t\t\t\t\tpermissions = opsetUser\r\n\t\t\t\telse\r\n\t\t\t\t\tspaceUser = if _.isNull(this.spaceUser) or this.spaceUser then this.spaceUser else Creator.getCollection(\"space_users\").findOne({ space: spaceId, user: userId }, { fields: { profile: 1 } })\r\n\t\t\t\t\tif spaceUser\r\n\t\t\t\t\t\tprof = spaceUser.profile\r\n\t\t\t\t\t\tif prof\r\n\t\t\t\t\t\t\tif prof is 'user'\r\n\t\t\t\t\t\t\t\tpermissions = opsetUser\r\n\t\t\t\t\t\t\telse if prof is 'member'\r\n\t\t\t\t\t\t\t\tpermissions = opsetMember\r\n\t\t\t\t\t\t\telse if prof is 'guest'\r\n\t\t\t\t\t\t\t\tpermissions = opsetGuest\r\n\t\t\t\t\t\telse # æ²¡æœ‰profileåˆ™è®¤ä¸ºæ˜¯useræƒé™\r\n\t\t\t\t\t\t\tpermissions = opsetUser\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tpermissions = opsetGuest\r\n\r\n\t\tif psets.length > 0\r\n\t\t\tset_ids = _.pluck psets, \"_id\"\r\n\t\t\tpos = find_permission_object(psetsCurrent_pos, object_name, set_ids)\r\n\t\t\tpos = unionPermissionObjects(pos, object, psets)\r\n\t\t\t_.each pos, (po)->\r\n\t\t\t\tif po.permission_set_id == psetsAdmin?._id or \r\n\t\t\t\tpo.permission_set_id == psetsUser?._id or \r\n\t\t\t\tpo.permission_set_id == psetsMember?._id or \r\n\t\t\t\tpo.permission_set_id == psetsGuest?._id\r\n\t\t\t\t\t# é»˜è®¤çš„admin/useræƒé™å€¼åªå®žè¡Œä¸Šé¢çš„é»˜è®¤å€¼è¦†ç›–ï¼Œä¸åšç®—æ³•åˆ¤æ–­\r\n\t\t\t\t\treturn\r\n\t\t\t\tif po.allowRead\r\n\t\t\t\t\tpermissions.allowRead = true\r\n\t\t\t\tif po.allowCreate\r\n\t\t\t\t\tpermissions.allowCreate = true\r\n\t\t\t\tif po.allowEdit\r\n\t\t\t\t\tpermissions.allowEdit = true\r\n\t\t\t\tif po.allowDelete\r\n\t\t\t\t\tpermissions.allowDelete = true\r\n\t\t\t\tif po.modifyAllRecords\r\n\t\t\t\t\tpermissions.modifyAllRecords = true\r\n\t\t\t\tif po.viewAllRecords\r\n\t\t\t\t\tpermissions.viewAllRecords = true\r\n\t\t\t\tif po.modifyCompanyRecords\r\n\t\t\t\t\tpermissions.modifyCompanyRecords = true\r\n\t\t\t\tif po.viewCompanyRecords\r\n\t\t\t\t\tpermissions.viewCompanyRecords = true\r\n\r\n\t\t\t\tpermissions.disabled_list_views = intersectionPlus(permissions.disabled_list_views, po.disabled_list_views)\r\n\t\t\t\tpermissions.disabled_actions = intersectionPlus(permissions.disabled_actions, po.disabled_actions)\r\n\t\t\t\tpermissions.unreadable_fields = intersectionPlus(permissions.unreadable_fields, po.unreadable_fields)\r\n\t\t\t\tpermissions.uneditable_fields = intersectionPlus(permissions.uneditable_fields, po.uneditable_fields)\r\n\t\t\t\tpermissions.unrelated_objects = intersectionPlus(permissions.unrelated_objects, po.unrelated_objects)\r\n\t\t\t\tpermissions.uneditable_related_list = intersectionPlus(permissions.uneditable_related_list, po.uneditable_related_list)\r\n\t\t\r\n\t\tif object.is_view\r\n\t\t\tpermissions.allowCreate = false\r\n\t\t\tpermissions.allowEdit = false\r\n\t\t\tpermissions.allowDelete = false\r\n\t\t\tpermissions.modifyAllRecords = false\r\n\t\t\tpermissions.modifyCompanyRecords = false\r\n\t\t\tpermissions.disabled_actions = []\r\n\t\tCreator.processPermissions permissions\r\n\r\n\t\tif object.permission_set.owner\r\n\t\t\tpermissions.owner = object.permission_set.owner\r\n\t\treturn permissions\r\n\r\n\r\n\t# Creator.initPermissions = (object_name) ->\r\n\r\n\t\t# # åº”è¯¥æŠŠè®¡ç®—å‡ºæ¥çš„\r\n\t\t# Creator.Collections[object_name].allow\r\n\t\t# \tinsert: (userId, doc) ->\r\n\t\t# \t\tif !userId\r\n\t\t# \t\t\treturn false\r\n\t\t# \t\tif !doc.space\r\n\t\t# \t\t\treturn false\r\n\t    \t# \t\tpermissions = Creator.getObjectPermissions(doc.space, userId, object_name)\r\n\t\t# \t\tif !permissions.allowCreate\r\n\t\t# \t\t\treturn false\r\n\r\n\t\t# \t\treturn true\r\n\t\t# \tupdate: (userId, doc) ->\r\n\t\t# \t\tif !userId\r\n\t\t# \t\t\treturn false\r\n\t\t# \t\tif !doc.space\r\n\t\t# \t\t\treturn false\r\n\t\t# \t\tpermissions = Creator.getObjectPermissions(doc.space, userId, object_name)\r\n\t\t# \t\tif !permissions.allowEdit\r\n\t\t# \t\t\treturn false\r\n\t\t# \t\treturn true\r\n\t\t# \tremove: (userId, doc) ->\r\n\t\t# \t\tif !userId\r\n\t\t# \t\t\treturn false\r\n\t\t# \t\tif !doc.space\r\n\t\t# \t\t\treturn false\r\n\t\t# \t\tpermissions = Creator.getObjectPermissions(doc.space, userId, object_name)\r\n\t\t# \t\tif !permissions.allowDelete\r\n\t\t# \t\t\treturn false\r\n\t\t# \t\treturn true\r\n\r\n\tMeteor.methods\r\n\t\t# Calculate Permissions on Server\r\n\t\t\"creator.object_permissions\": (spaceId)->\r\n\t\t\treturn Creator.getAllPermissions(spaceId, this.userId)\r\n","var clone, findOne_permission_object, find_permission_object, intersectionPlus, unionPermissionObjects, unionPlus;\n\nclone = require('clone');\n\nCreator.getPermissions = function(object_name, spaceId, userId) {\n  var obj;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n    obj = Creator.getObject(object_name);\n    if (!obj) {\n      return;\n    }\n    return obj.permissions.get();\n  } else if (Meteor.isServer) {\n    return Creator.getObjectPermissions(spaceId, userId, object_name);\n  }\n};\n\nCreator.getRecordPermissions = function(object_name, record, userId, spaceId) {\n  var isOwner, object_fields_keys, permissions, record_company_id, record_company_ids, record_id, ref, ref1, select, user_company_ids;\n  if (!object_name && Meteor.isClient) {\n    object_name = Session.get(\"object_name\");\n  }\n  if (!spaceId && Meteor.isClient) {\n    spaceId = Session.get(\"spaceId\");\n  }\n  if (record && object_name === \"cms_files\" && Meteor.isClient) {\n    if (object_name === Session.get('object_name')) {\n      object_name = record.parent['reference_to._o'];\n      record_id = record.parent._id;\n    } else {\n      object_name = Session.get('object_name');\n      record_id = Session.get(\"record_id\");\n    }\n    object_fields_keys = _.keys(((ref = Creator.getObject(object_name, spaceId)) != null ? ref.fields : void 0) || {}) || [];\n    select = _.intersection(object_fields_keys, ['owner', 'company_id', 'company_ids', 'locked']) || [];\n    if (select.length > 0) {\n      record = Creator.getObjectRecord(object_name, record_id, select.join(','));\n    } else {\n      record = null;\n    }\n  }\n  permissions = _.clone(Creator.getPermissions(object_name, spaceId, userId));\n  if (record) {\n    isOwner = record.owner === userId || ((ref1 = record.owner) != null ? ref1._id : void 0) === userId;\n    if (Meteor.isClient) {\n      user_company_ids = Steedos.getUserCompanyIds();\n    } else {\n      user_company_ids = Creator.getUserCompanyIds(userId, spaceId);\n    }\n    record_company_id = record != null ? record.company_id : void 0;\n    if (record_company_id && _.isObject(record_company_id) && record_company_id._id) {\n      record_company_id = record_company_id._id;\n    }\n    record_company_ids = record != null ? record.company_ids : void 0;\n    if (record_company_ids && record_company_ids.length && _.isObject(record_company_ids[0])) {\n      record_company_ids = record_company_ids.map(function(n) {\n        return n._id;\n      });\n    }\n    record_company_ids = _.union(record_company_ids, [record_company_id]);\n    if (!permissions.modifyAllRecords && !isOwner && !permissions.modifyCompanyRecords) {\n      permissions.allowEdit = false;\n      permissions.allowDelete = false;\n    } else if (!permissions.modifyAllRecords && permissions.modifyCompanyRecords) {\n      if (record_company_ids && record_company_ids.length) {\n        if (user_company_ids && user_company_ids.length) {\n          if (!_.intersection(user_company_ids, record_company_ids).length) {\n            permissions.allowEdit = false;\n            permissions.allowDelete = false;\n          }\n        } else {\n          permissions.allowEdit = false;\n          permissions.allowDelete = false;\n        }\n      }\n    }\n    if (record.locked && !permissions.modifyAllRecords) {\n      permissions.allowEdit = false;\n      permissions.allowDelete = false;\n    }\n    if (!permissions.viewAllRecords && !isOwner && !permissions.viewCompanyRecords) {\n      permissions.allowRead = false;\n    } else if (!permissions.viewAllRecords && permissions.viewCompanyRecords) {\n      if (record_company_ids && record_company_ids.length) {\n        if (user_company_ids && user_company_ids.length) {\n          if (!_.intersection(user_company_ids, record_company_ids).length) {\n            permissions.allowRead = false;\n          }\n        } else {\n          permissions.allowRead = false;\n        }\n      }\n    }\n  }\n  return permissions;\n};\n\nif (Meteor.isClient) {\n  Creator.getRecordRelatedListPermissions = function(currentObjectName, relatedListItem, currentRecord, userId, spaceId) {\n    var isRelateObjectUneditable, masterAllow, masterRecordPerm, relatedObjectPermissions, result, sharing, uneditable_related_list;\n    if (!currentObjectName && Meteor.isClient) {\n      currentObjectName = Session.get(\"object_name\");\n    }\n    if (!relatedListItem) {\n      console.error(\"relatedListItem must not be empty for the function Creator.getRecordRelatedListPermissions\");\n      return {};\n    }\n    if (!currentRecord && Meteor.isClient) {\n      currentRecord = Creator.getObjectRecord();\n    }\n    if (!userId && Meteor.isClient) {\n      userId = Meteor.userId();\n    }\n    if (!spaceId && Meteor.isClient) {\n      spaceId = Session.get(\"spaceId\");\n    }\n    sharing = relatedListItem.sharing || 'masterWrite';\n    masterAllow = false;\n    masterRecordPerm = Creator.getRecordPermissions(currentObjectName, currentRecord, userId, spaceId);\n    if (sharing === 'masterRead') {\n      masterAllow = masterRecordPerm.allowRead;\n    } else if (sharing === 'masterWrite') {\n      masterAllow = masterRecordPerm.allowEdit;\n    }\n    uneditable_related_list = Creator.getRecordSafeRelatedList(currentRecord, currentObjectName);\n    relatedObjectPermissions = Creator.getPermissions(relatedListItem.object_name);\n    isRelateObjectUneditable = uneditable_related_list.indexOf(relatedListItem.object_name) > -1;\n    result = _.clone(relatedObjectPermissions);\n    result.allowCreate = masterAllow && relatedObjectPermissions.allowCreate && !isRelateObjectUneditable;\n    result.allowEdit = masterAllow && relatedObjectPermissions.allowEdit && !isRelateObjectUneditable;\n    return result;\n  };\n}\n\nif (Meteor.isServer) {\n  Creator.getAllPermissions = function(spaceId, userId) {\n    var _i, isSpaceAdmin, permissions, psets, psetsAdmin, psetsAdmin_pos, psetsCurrent, psetsCurrentNames, psetsCurrent_pos, psetsGuest, psetsGuest_pos, psetsMember, psetsMember_pos, psetsUser, psetsUser_pos, set_ids, spaceUser;\n    permissions = {\n      objects: {},\n      assigned_apps: []\n    };\n\n    /*\n    \t\tæƒé™ç»„è¯´æ˜Ž:\n    \t\tå†…ç½®æƒé™ç»„-admin,user,member,guest,workflow_admin,organization_admin\n    \t\tè‡ªå®šä¹‰æƒé™ç»„-æ•°æ®åº“ä¸­æ–°å»ºçš„é™¤å†…ç½®æƒé™ç»„ä»¥å¤–çš„å…¶ä»–æƒé™ç»„\n    \t\tç‰¹å®šç”¨æˆ·é›†åˆæƒé™ç»„ï¼ˆå³userså±žæ€§ä¸å¯é…ç½®ï¼‰-admin,user,member,guest\n    \t\tå¯é…ç½®ç”¨æˆ·é›†åˆæƒé™ç»„ï¼ˆå³userså±žæ€§å¯é…ç½®ï¼‰-workflow_admin,organization_adminä»¥åŠè‡ªå®šä¹‰æƒé™ç»„\n     */\n    psetsAdmin = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'admin'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }) || null;\n    psetsUser = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'user'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }) || null;\n    psetsMember = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'member'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }) || null;\n    psetsGuest = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'guest'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }) || null;\n    psetsCurrent = Creator.getCollection(\"permission_set\").find({\n      users: userId,\n      space: spaceId\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1,\n        name: 1\n      }\n    }).fetch();\n    psetsAdmin_pos = null;\n    psetsUser_pos = null;\n    psetsMember_pos = null;\n    psetsGuest_pos = null;\n    psetsCurrent_pos = null;\n    if (psetsAdmin != null ? psetsAdmin._id : void 0) {\n      psetsAdmin_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsAdmin._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsUser != null ? psetsUser._id : void 0) {\n      psetsUser_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsUser._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsMember != null ? psetsMember._id : void 0) {\n      psetsMember_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsMember._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsGuest != null ? psetsGuest._id : void 0) {\n      psetsGuest_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsGuest._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsCurrent.length > 0) {\n      set_ids = _.pluck(psetsCurrent, \"_id\");\n      psetsCurrent_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: {\n          $in: set_ids\n        }\n      }).fetch();\n      psetsCurrentNames = _.pluck(psetsCurrent, \"name\");\n    }\n    isSpaceAdmin = false;\n    spaceUser = null;\n    if (userId) {\n      isSpaceAdmin = Creator.isSpaceAdmin(spaceId, userId);\n      spaceUser = Creator.getCollection(\"space_users\").findOne({\n        space: spaceId,\n        user: userId\n      }, {\n        fields: {\n          profile: 1\n        }\n      });\n    }\n    psets = {\n      psetsAdmin: psetsAdmin,\n      psetsUser: psetsUser,\n      psetsCurrent: psetsCurrent,\n      psetsMember: psetsMember,\n      psetsGuest: psetsGuest,\n      isSpaceAdmin: isSpaceAdmin,\n      spaceUser: spaceUser,\n      psetsAdmin_pos: psetsAdmin_pos,\n      psetsUser_pos: psetsUser_pos,\n      psetsMember_pos: psetsMember_pos,\n      psetsGuest_pos: psetsGuest_pos,\n      psetsCurrent_pos: psetsCurrent_pos\n    };\n    permissions.assigned_apps = Creator.getAssignedApps.bind(psets)(spaceId, userId);\n    permissions.assigned_menus = Creator.getAssignedMenus.bind(psets)(spaceId, userId);\n    permissions.user_permission_sets = psetsCurrentNames;\n    _i = 0;\n    _.each(Creator.objectsByName, function(object, object_name) {\n      _i++;\n      if (!_.has(object, 'space') || !object.space || object.space === spaceId) {\n        if (!_.has(object, 'in_development') || object.in_development === '0' || (object.in_development !== '0' && isSpaceAdmin)) {\n          permissions.objects[object_name] = Creator.convertObject(clone(Creator.Objects[object_name]), spaceId);\n          return permissions.objects[object_name][\"permissions\"] = Creator.getObjectPermissions.bind(psets)(spaceId, userId, object_name);\n        }\n      }\n    });\n    return permissions;\n  };\n  unionPlus = function(array, other) {\n    if (!array && !other) {\n      return void 0;\n    }\n    if (!array) {\n      array = [];\n    }\n    if (!other) {\n      other = [];\n    }\n    return _.union(array, other);\n  };\n  intersectionPlus = function(array, other) {\n    if (!array && !other) {\n      return void 0;\n    }\n    if (!array) {\n      array = [];\n    }\n    if (!other) {\n      other = [];\n    }\n    return _.intersection(array, other);\n  };\n  Creator.getAssignedApps = function(spaceId, userId) {\n    var apps, isSpaceAdmin, psetBase, psets, psetsAdmin, psetsUser, ref;\n    psetsAdmin = this.psetsAdmin || Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'admin'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    });\n    psetsUser = this.psetsUser || Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'user'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    });\n    psets = this.psetsCurrent || Creator.getCollection(\"permission_set\").find({\n      users: userId,\n      space: spaceId\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1,\n        name: 1\n      }\n    }).fetch();\n    isSpaceAdmin = _.isBoolean(this.isSpaceAdmin) ? this.isSpaceAdmin : Creator.isSpaceAdmin(spaceId, userId);\n    apps = [];\n    if (isSpaceAdmin) {\n      return [];\n    } else {\n      psetBase = psetsUser;\n      if (psetBase != null ? (ref = psetBase.assigned_apps) != null ? ref.length : void 0 : void 0) {\n        apps = _.union(apps, psetBase.assigned_apps);\n      } else {\n        return [];\n      }\n      _.each(psets, function(pset) {\n        if (!pset.assigned_apps) {\n          return;\n        }\n        if (pset.name === \"admin\" || pset.name === \"user\") {\n          return;\n        }\n        return apps = _.union(apps, pset.assigned_apps);\n      });\n      return _.without(_.uniq(apps), void 0, null);\n    }\n  };\n  Creator.getAssignedMenus = function(spaceId, userId) {\n    var aboutMenu, adminMenus, allMenus, currentPsetNames, isSpaceAdmin, menus, otherMenuApps, otherMenus, psets, ref, result;\n    psets = this.psetsCurrent || Creator.getCollection(\"permission_set\").find({\n      users: userId,\n      space: spaceId\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1,\n        name: 1\n      }\n    }).fetch();\n    isSpaceAdmin = _.isBoolean(this.isSpaceAdmin) ? this.isSpaceAdmin : Creator.isSpaceAdmin(spaceId, userId);\n    adminMenus = (ref = Creator.Apps.admin) != null ? ref.admin_menus : void 0;\n    if (!adminMenus) {\n      return [];\n    }\n    aboutMenu = adminMenus.find(function(n) {\n      return n._id === 'about';\n    });\n    adminMenus = adminMenus.filter(function(n) {\n      return n._id !== 'about';\n    });\n    otherMenuApps = _.sortBy(_.filter(_.values(Creator.Apps), function(n) {\n      return n.admin_menus && n._id !== 'admin';\n    }), 'sort');\n    otherMenus = _.flatten(_.pluck(otherMenuApps, \"admin_menus\"));\n    allMenus = _.union(adminMenus, otherMenus, [aboutMenu]);\n    if (isSpaceAdmin) {\n      result = allMenus;\n    } else {\n      currentPsetNames = psets.map(function(n) {\n        return n.name;\n      });\n      menus = allMenus.filter(function(menu) {\n        var psetsMenu;\n        psetsMenu = menu.permission_sets;\n        if (psetsMenu && psetsMenu.indexOf(\"user\") > -1) {\n          return true;\n        }\n        return _.intersection(currentPsetNames, psetsMenu).length;\n      });\n      result = menus;\n    }\n    return _.sortBy(result, \"sort\");\n  };\n  findOne_permission_object = function(permission_objects, object_name, permission_set_id) {\n    if (_.isNull(permission_objects)) {\n      return null;\n    }\n    if (_.isArray(permission_objects)) {\n      return _.find(permission_objects, function(po) {\n        return po.object_name === object_name;\n      });\n    }\n    return Creator.getCollection(\"permission_objects\").findOne({\n      object_name: object_name,\n      permission_set_id: permission_set_id\n    });\n  };\n  find_permission_object = function(permission_objects, object_name, permission_set_ids) {\n    if (_.isNull(permission_objects)) {\n      return null;\n    }\n    if (_.isArray(permission_objects)) {\n      return _.filter(permission_objects, function(po) {\n        return po.object_name === object_name;\n      });\n    }\n    return Creator.getCollection(\"permission_objects\").find({\n      object_name: object_name,\n      permission_set_id: {\n        $in: permission_set_ids\n      }\n    }).fetch();\n  };\n  unionPermissionObjects = function(pos, object, psets) {\n    var result;\n    result = [];\n    _.each(object.permission_set, function(ops, ops_key) {\n      var currentPset, tempOps;\n      if ([\"admin\", \"user\", \"member\", \"guest\"].indexOf(ops_key) < 0) {\n        currentPset = psets.find(function(pset) {\n          return pset.name === ops_key;\n        });\n        if (currentPset) {\n          tempOps = _.clone(ops) || {};\n          tempOps.permission_set_id = currentPset._id;\n          tempOps.object_name = object.object_name;\n          return result.push(tempOps);\n        }\n      }\n    });\n    if (result.length) {\n      pos.forEach(function(po) {\n        var repeatIndex, repeatPo;\n        repeatIndex = 0;\n        repeatPo = result.find(function(item, index) {\n          repeatIndex = index;\n          return item.permission_set_id === po.permission_set_id;\n        });\n        if (repeatPo) {\n          return result[repeatIndex] = po;\n        } else {\n          return result.push(po);\n        }\n      });\n      return result;\n    } else {\n      return pos;\n    }\n  };\n  Creator.getObjectPermissions = function(spaceId, userId, object_name) {\n    var isSpaceAdmin, object, opsetAdmin, opsetGuest, opsetMember, opsetUser, permissions, pos, posAdmin, posGuest, posMember, posUser, prof, psets, psetsAdmin, psetsAdmin_pos, psetsCurrent_pos, psetsGuest, psetsGuest_pos, psetsMember, psetsMember_pos, psetsUser, psetsUser_pos, set_ids, spaceUser;\n    permissions = {};\n    object = Creator.getObject(object_name, spaceId);\n    if (spaceId === 'guest' || object_name === \"users\") {\n      permissions = _.clone(object.permission_set.guest) || {};\n      Creator.processPermissions(permissions);\n      return permissions;\n    }\n    psetsAdmin = _.isNull(this.psetsAdmin) || this.psetsAdmin ? this.psetsAdmin : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'admin'\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    psetsUser = _.isNull(this.psetsUser) || this.psetsUser ? this.psetsUser : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'user'\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    psetsMember = _.isNull(this.psetsMember) || this.psetsMember ? this.psetsMember : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'member'\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    psetsGuest = _.isNull(this.psetsGuest) || this.psetsGuest ? this.psetsGuest : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'guest'\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    psets = this.psetsCurrent || Creator.getCollection(\"permission_set\").find({\n      users: userId,\n      space: spaceId\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1,\n        name: 1\n      }\n    }).fetch();\n    isSpaceAdmin = _.isBoolean(this.isSpaceAdmin) ? this.isSpaceAdmin : Creator.isSpaceAdmin(spaceId, userId);\n    psetsAdmin_pos = this.psetsAdmin_pos;\n    psetsUser_pos = this.psetsUser_pos;\n    psetsMember_pos = this.psetsMember_pos;\n    psetsGuest_pos = this.psetsGuest_pos;\n    psetsCurrent_pos = this.psetsCurrent_pos;\n    opsetAdmin = _.clone(object.permission_set.admin) || {};\n    opsetUser = _.clone(object.permission_set.user) || {};\n    opsetMember = _.clone(object.permission_set.member) || {};\n    opsetGuest = _.clone(object.permission_set.guest) || {};\n    if (psetsAdmin) {\n      posAdmin = findOne_permission_object(psetsAdmin_pos, object_name, psetsAdmin._id);\n      if (posAdmin) {\n        opsetAdmin.allowCreate = posAdmin.allowCreate;\n        opsetAdmin.allowDelete = posAdmin.allowDelete;\n        opsetAdmin.allowEdit = posAdmin.allowEdit;\n        opsetAdmin.allowRead = posAdmin.allowRead;\n        opsetAdmin.modifyAllRecords = posAdmin.modifyAllRecords;\n        opsetAdmin.viewAllRecords = posAdmin.viewAllRecords;\n        opsetAdmin.modifyCompanyRecords = posAdmin.modifyCompanyRecords;\n        opsetAdmin.viewCompanyRecords = posAdmin.viewCompanyRecords;\n        opsetAdmin.disabled_list_views = posAdmin.disabled_list_views;\n        opsetAdmin.disabled_actions = posAdmin.disabled_actions;\n        opsetAdmin.unreadable_fields = posAdmin.unreadable_fields;\n        opsetAdmin.uneditable_fields = posAdmin.uneditable_fields;\n        opsetAdmin.unrelated_objects = posAdmin.unrelated_objects;\n        opsetAdmin.uneditable_related_list = posAdmin.uneditable_related_list;\n      }\n    }\n    if (psetsUser) {\n      posUser = findOne_permission_object(psetsUser_pos, object_name, psetsUser._id);\n      if (posUser) {\n        opsetUser.allowCreate = posUser.allowCreate;\n        opsetUser.allowDelete = posUser.allowDelete;\n        opsetUser.allowEdit = posUser.allowEdit;\n        opsetUser.allowRead = posUser.allowRead;\n        opsetUser.modifyAllRecords = posUser.modifyAllRecords;\n        opsetUser.viewAllRecords = posUser.viewAllRecords;\n        opsetUser.modifyCompanyRecords = posUser.modifyCompanyRecords;\n        opsetUser.viewCompanyRecords = posUser.viewCompanyRecords;\n        opsetUser.disabled_list_views = posUser.disabled_list_views;\n        opsetUser.disabled_actions = posUser.disabled_actions;\n        opsetUser.unreadable_fields = posUser.unreadable_fields;\n        opsetUser.uneditable_fields = posUser.uneditable_fields;\n        opsetUser.unrelated_objects = posUser.unrelated_objects;\n        opsetUser.uneditable_related_list = posUser.uneditable_related_list;\n      }\n    }\n    if (psetsMember) {\n      posMember = findOne_permission_object(psetsMember_pos, object_name, psetsMember._id);\n      if (posMember) {\n        opsetMember.allowCreate = posMember.allowCreate;\n        opsetMember.allowDelete = posMember.allowDelete;\n        opsetMember.allowEdit = posMember.allowEdit;\n        opsetMember.allowRead = posMember.allowRead;\n        opsetMember.modifyAllRecords = posMember.modifyAllRecords;\n        opsetMember.viewAllRecords = posMember.viewAllRecords;\n        opsetMember.modifyCompanyRecords = posMember.modifyCompanyRecords;\n        opsetMember.viewCompanyRecords = posMember.viewCompanyRecords;\n        opsetMember.disabled_list_views = posMember.disabled_list_views;\n        opsetMember.disabled_actions = posMember.disabled_actions;\n        opsetMember.unreadable_fields = posMember.unreadable_fields;\n        opsetMember.uneditable_fields = posMember.uneditable_fields;\n        opsetMember.unrelated_objects = posMember.unrelated_objects;\n        opsetMember.uneditable_related_list = posMember.uneditable_related_list;\n      }\n    }\n    if (psetsGuest) {\n      posGuest = findOne_permission_object(psetsGuest_pos, object_name, psetsGuest._id);\n      if (posGuest) {\n        opsetGuest.allowCreate = posGuest.allowCreate;\n        opsetGuest.allowDelete = posGuest.allowDelete;\n        opsetGuest.allowEdit = posGuest.allowEdit;\n        opsetGuest.allowRead = posGuest.allowRead;\n        opsetGuest.modifyAllRecords = posGuest.modifyAllRecords;\n        opsetGuest.viewAllRecords = posGuest.viewAllRecords;\n        opsetGuest.modifyCompanyRecords = posGuest.modifyCompanyRecords;\n        opsetGuest.viewCompanyRecords = posGuest.viewCompanyRecords;\n        opsetGuest.disabled_list_views = posGuest.disabled_list_views;\n        opsetGuest.disabled_actions = posGuest.disabled_actions;\n        opsetGuest.unreadable_fields = posGuest.unreadable_fields;\n        opsetGuest.uneditable_fields = posGuest.uneditable_fields;\n        opsetGuest.unrelated_objects = posGuest.unrelated_objects;\n        opsetGuest.uneditable_related_list = posGuest.uneditable_related_list;\n      }\n    }\n    if (!userId) {\n      permissions = opsetAdmin;\n    } else {\n      if (isSpaceAdmin) {\n        permissions = opsetAdmin;\n      } else {\n        if (spaceId === 'common') {\n          permissions = opsetUser;\n        } else {\n          spaceUser = _.isNull(this.spaceUser) || this.spaceUser ? this.spaceUser : Creator.getCollection(\"space_users\").findOne({\n            space: spaceId,\n            user: userId\n          }, {\n            fields: {\n              profile: 1\n            }\n          });\n          if (spaceUser) {\n            prof = spaceUser.profile;\n            if (prof) {\n              if (prof === 'user') {\n                permissions = opsetUser;\n              } else if (prof === 'member') {\n                permissions = opsetMember;\n              } else if (prof === 'guest') {\n                permissions = opsetGuest;\n              }\n            } else {\n              permissions = opsetUser;\n            }\n          } else {\n            permissions = opsetGuest;\n          }\n        }\n      }\n    }\n    if (psets.length > 0) {\n      set_ids = _.pluck(psets, \"_id\");\n      pos = find_permission_object(psetsCurrent_pos, object_name, set_ids);\n      pos = unionPermissionObjects(pos, object, psets);\n      _.each(pos, function(po) {\n        if (po.permission_set_id === (psetsAdmin != null ? psetsAdmin._id : void 0) || po.permission_set_id === (psetsUser != null ? psetsUser._id : void 0) || po.permission_set_id === (psetsMember != null ? psetsMember._id : void 0) || po.permission_set_id === (psetsGuest != null ? psetsGuest._id : void 0)) {\n          return;\n        }\n        if (po.allowRead) {\n          permissions.allowRead = true;\n        }\n        if (po.allowCreate) {\n          permissions.allowCreate = true;\n        }\n        if (po.allowEdit) {\n          permissions.allowEdit = true;\n        }\n        if (po.allowDelete) {\n          permissions.allowDelete = true;\n        }\n        if (po.modifyAllRecords) {\n          permissions.modifyAllRecords = true;\n        }\n        if (po.viewAllRecords) {\n          permissions.viewAllRecords = true;\n        }\n        if (po.modifyCompanyRecords) {\n          permissions.modifyCompanyRecords = true;\n        }\n        if (po.viewCompanyRecords) {\n          permissions.viewCompanyRecords = true;\n        }\n        permissions.disabled_list_views = intersectionPlus(permissions.disabled_list_views, po.disabled_list_views);\n        permissions.disabled_actions = intersectionPlus(permissions.disabled_actions, po.disabled_actions);\n        permissions.unreadable_fields = intersectionPlus(permissions.unreadable_fields, po.unreadable_fields);\n        permissions.uneditable_fields = intersectionPlus(permissions.uneditable_fields, po.uneditable_fields);\n        permissions.unrelated_objects = intersectionPlus(permissions.unrelated_objects, po.unrelated_objects);\n        return permissions.uneditable_related_list = intersectionPlus(permissions.uneditable_related_list, po.uneditable_related_list);\n      });\n    }\n    if (object.is_view) {\n      permissions.allowCreate = false;\n      permissions.allowEdit = false;\n      permissions.allowDelete = false;\n      permissions.modifyAllRecords = false;\n      permissions.modifyCompanyRecords = false;\n      permissions.disabled_actions = [];\n    }\n    Creator.processPermissions(permissions);\n    if (object.permission_set.owner) {\n      permissions.owner = object.permission_set.owner;\n    }\n    return permissions;\n  };\n  Meteor.methods({\n    \"creator.object_permissions\": function(spaceId) {\n      return Creator.getAllPermissions(spaceId, this.userId);\n    }\n  });\n}\n","\r\nsteedosCore = require('@steedos/core')\r\n\r\nMeteor.startup ()->\r\n\tcreator_db_url = process.env.MONGO_URL_CREATOR\r\n\toplog_url = process.env.MONGO_OPLOG_URL_CREATOR\r\n\tif creator_db_url\r\n\t\tif !oplog_url\r\n\t\t\tthrow new Meteor.Error(500, \"Please configure environment variables: MONGO_OPLOG_URL_CREATOR\")\r\n\t\tCreator._CREATOR_DATASOURCE = {_driver: new MongoInternals.RemoteCollectionDriver(creator_db_url, {oplogUrl: oplog_url})}\r\n\r\nCreator.getCollectionName = (object)->\r\n#\tif object.table_name && object.table_name.endsWith(\"__c\")\r\n#\t\treturn object.table_name\r\n#\telse\r\n#\t\treturn object.name\r\n\treturn object.name\r\nCreator.createCollection = (object)->\r\n\tcollection_key = Creator.getCollectionName(object)\r\n\tif db[collection_key]\r\n\t\treturn db[collection_key]\r\n\telse if object.db\r\n\t\treturn object.db\r\n\r\n\tif Creator.Collections[collection_key]\r\n\t\treturn Creator.Collections[collection_key]\r\n\telse\r\n\t\tif object.custom\r\n\t\t\treturn steedosCore.newCollection(collection_key, Creator._CREATOR_DATASOURCE)\r\n\t\telse\r\n\t\t\tif collection_key == '_sms_queue' && SMSQueue?.collection\r\n\t\t\t\treturn SMSQueue.collection\r\n\t\t\treturn steedosCore.newCollection(collection_key)\r\n\r\n\r\n","var steedosCore;\n\nsteedosCore = require('@steedos/core');\n\nMeteor.startup(function() {\n  var creator_db_url, oplog_url;\n  creator_db_url = process.env.MONGO_URL_CREATOR;\n  oplog_url = process.env.MONGO_OPLOG_URL_CREATOR;\n  if (creator_db_url) {\n    if (!oplog_url) {\n      throw new Meteor.Error(500, \"Please configure environment variables: MONGO_OPLOG_URL_CREATOR\");\n    }\n    return Creator._CREATOR_DATASOURCE = {\n      _driver: new MongoInternals.RemoteCollectionDriver(creator_db_url, {\n        oplogUrl: oplog_url\n      })\n    };\n  }\n});\n\nCreator.getCollectionName = function(object) {\n  return object.name;\n};\n\nCreator.createCollection = function(object) {\n  var collection_key;\n  collection_key = Creator.getCollectionName(object);\n  if (db[collection_key]) {\n    return db[collection_key];\n  } else if (object.db) {\n    return object.db;\n  }\n  if (Creator.Collections[collection_key]) {\n    return Creator.Collections[collection_key];\n  } else {\n    if (object.custom) {\n      return steedosCore.newCollection(collection_key, Creator._CREATOR_DATASOURCE);\n    } else {\n      if (collection_key === '_sms_queue' && (typeof SMSQueue !== \"undefined\" && SMSQueue !== null ? SMSQueue.collection : void 0)) {\n        return SMSQueue.collection;\n      }\n      return steedosCore.newCollection(collection_key);\n    }\n  }\n};\n","Creator.actionsByName = {}\r\n\r\nif Meteor.isClient\r\n\r\n\t# å®šä¹‰å…¨å±€ actions å‡½æ•°\t\r\n\tCreator.actions = (actions)->\r\n\t\t_.each actions, (todo, action_name)->\r\n\t\t\tCreator.actionsByName[action_name] = todo \r\n\r\n\tCreator.executeAction = (object_name, action, record_id, item_element, list_view_id, record)->\r\n\t\tobj = Creator.getObject(object_name)\r\n\t\tif action?.todo\r\n\t\t\tif typeof action.todo == \"string\"\r\n\t\t\t\ttodo = Creator.actionsByName[action.todo]\r\n\t\t\telse if typeof action.todo == \"function\"\r\n\t\t\t\ttodo = action.todo\t\r\n\t\t\tif !record && object_name && record_id\r\n\t\t\t\trecord = Creator.odata.get(object_name, record_id)\r\n\t\t\tif todo\r\n\t\t\t\t# item_elementä¸ºç©ºæ—¶åº”è¯¥è®¾ç½®é»˜è®¤å€¼ï¼ˆå¯¹è±¡çš„nameå­—æ®µï¼‰ï¼Œå¦åˆ™moreArgsæ‹¿åˆ°çš„åŽç»­å‚æ•°ä½ç½®å°±ä¸å¯¹\r\n\t\t\t\titem_element = if item_element then item_element else \"\"\r\n\t\t\t\tmoreArgs = Array.prototype.slice.call(arguments, 3)\r\n\t\t\t\ttodoArgs = [object_name, record_id].concat(moreArgs)\r\n\t\t\t\ttodo.apply {\r\n\t\t\t\t\tobject_name: object_name\r\n\t\t\t\t\trecord_id: record_id\r\n\t\t\t\t\tobject: obj\r\n\t\t\t\t\taction: action\r\n\t\t\t\t\titem_element: item_element\r\n\t\t\t\t\trecord: record\r\n\t\t\t\t}, todoArgs\r\n\t\t\t\t\r\n\r\n\tCreator.actions \r\n\t\t# åœ¨æ­¤å®šä¹‰å…¨å±€ actions\r\n\t\t\"standard_query\": ()->\r\n\t\t\tModal.show(\"standard_query_modal\")\r\n\r\n\t\t\"standard_new\": (object_name, record_id, fields)->\r\n\t\t\tids = Creator.TabularSelectedIds[object_name]\r\n\t\t\tif ids?.length\r\n\t\t\t\t# åˆ—è¡¨æœ‰é€‰ä¸­é¡¹æ—¶ï¼Œå–ç¬¬ä¸€ä¸ªé€‰ä¸­é¡¹ï¼Œå¤åˆ¶å…¶å†…å®¹åˆ°æ–°å»ºçª—å£ä¸­\r\n\t\t\t\t# è¿™çš„ç¬¬ä¸€ä¸ªæŒ‡çš„æ˜¯ç¬¬ä¸€æ¬¡å‹¾é€‰çš„é€‰ä¸­é¡¹ï¼Œè€Œä¸æ˜¯åˆ—è¡¨ä¸­å·²å‹¾é€‰çš„ç¬¬ä¸€é¡¹\r\n\t\t\t\trecord_id = ids[0]\r\n\t\t\t\tdoc = Creator.odata.get(object_name, record_id)\r\n\t\t\t\tSession.set 'cmDoc', doc\r\n\t\t\t\t# â€œä¿å­˜å¹¶æ–°å»ºâ€æ“ä½œä¸­è‡ªåŠ¨æ‰“å¼€çš„æ–°çª—å£ä¸­éœ€è¦å†æ¬¡å¤åˆ¶æœ€æ–°çš„docå†…å®¹åˆ°æ–°çª—å£ä¸­\r\n\t\t\t\tSession.set 'cmShowAgainDuplicated', true\r\n\t\t\telse\r\n\t\t\t\tSession.set 'cmDoc', FormManager.getInitialValues(object_name)\r\n\t\t\tMeteor.defer ()->\r\n\t\t\t\t$(\".creator-add\").click()\r\n\t\t\treturn \r\n\t\t\t\r\n\t\t\"standard_open_view\": (object_name, record_id, fields)->\r\n\t\t\thref = Creator.getObjectUrl(object_name, record_id)\r\n\t\t\twindow.open(\r\n\t\t\t\thref,\r\n\t\t\t\t'_blank',\r\n\t\t\t\t'width=800, height=600, left=50, top= 50, toolbar=no, status=no, menubar=no, resizable=yes, scrollbars=yes'\r\n\t\t\t)\r\n\t\t\treturn false\r\n\r\n\t\t\"standard_open_view\": (object_name, record_id, fields)->\r\n\t\t\thref = Creator.getObjectUrl(object_name, record_id)\r\n\t\t\twindow.open(\r\n\t\t\t\thref,\r\n\t\t\t\t'_blank',\r\n\t\t\t\t'width=800, height=600, left=50, top= 50, toolbar=no, status=no, menubar=no, resizable=yes, scrollbars=yes'\r\n\t\t\t)\r\n\t\t\treturn false\r\n\r\n\t\t\"standard_edit\": (object_name, record_id, fields)->\r\n\t\t\tif record_id\r\n\t\t\t\tif Steedos.isMobile() && false\r\n#\t\t\t\t\trecord = Creator.getObjectRecord(object_name, record_id)\r\n#\t\t\t\t\tSession.set 'cmDoc', record\r\n#\t\t\t\t\tSession.set 'reload_dxlist', false\r\n\t\t\t\t\tSession.set 'action_object_name', object_name\r\n\t\t\t\t\tSession.set 'action_record_id', record_id\r\n\t\t\t\t\tif this.record\r\n\t\t\t\t\t\tSession.set 'cmDoc', this.record\r\n\t\t\t\t\tMeteor.defer ()->\r\n\t\t\t\t\t\t$(\".btn-edit-record\").click()\r\n\t\t\t\telse\r\n\t\t\t\t\tSession.set 'action_object_name', object_name\r\n\t\t\t\t\tSession.set 'action_record_id', record_id\r\n\t\t\t\t\tif this.record\r\n\t\t\t\t\t\tSession.set 'cmDoc', this.record\r\n\t\t\t\t\t\tMeteor.defer ()->\r\n\t\t\t\t\t\t\t$(\".btn.creator-edit\").click()\r\n\r\n\t\t\"standard_delete\": (object_name, record_id, record_title, list_view_id, record, call_back)->\r\n\t\t\tconsole.log(\"standard_delete\", object_name, record_id, record_title, list_view_id)\r\n\t\t\tobject = Creator.getObject(object_name)\r\n\r\n\t\t\tif(!_.isString(record_title) && record_title?.name)\r\n\t\t\t\trecord_title = record_title?.name\r\n\r\n\t\t\tif record_title\r\n\t\t\t\ttext = \"æ˜¯å¦ç¡®å®šè¦åˆ é™¤æ­¤#{object.label}\\\"#{record_title}\\\"\"\r\n\t\t\telse\r\n\t\t\t\ttext = \"æ˜¯å¦ç¡®å®šè¦åˆ é™¤æ­¤#{object.label}\"\r\n\t\t\tswal\r\n\t\t\t\ttitle: \"åˆ é™¤#{object.label}\"\r\n\t\t\t\ttext: \"<div class='delete-creator-warning'>#{text}ï¼Ÿ</div>\"\r\n\t\t\t\thtml: true\r\n\t\t\t\tshowCancelButton:true\r\n\t\t\t\tconfirmButtonText: t('Delete')\r\n\t\t\t\tcancelButtonText: t('Cancel')\r\n\t\t\t\t(option) ->\r\n\t\t\t\t\tif option\r\n\t\t\t\t\t\tCreator.odata.delete object_name, record_id, ()->\r\n\t\t\t\t\t\t\tif record_title\r\n\t\t\t\t\t\t\t\tinfo = object.label + \"\\\"#{record_title}\\\"\" + \"å·²åˆ é™¤\"\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tinfo = \"åˆ é™¤æˆåŠŸ\"\r\n\t\t\t\t\t\t\ttoastr.success info\r\n\t\t\t\t\t\t\t# æ–‡ä»¶ç‰ˆæœ¬ä¸º\"cfs.files.filerecord\"ï¼Œéœ€è¦æ›¿æ¢ä¸º\"cfs-files-filerecord\"\r\n\t\t\t\t\t\t\tgridObjectNameClass = object_name.replace(/\\./g,\"-\")\r\n\t\t\t\t\t\t\tgridContainer = $(\".gridContainer.#{gridObjectNameClass}\")\r\n\t\t\t\t\t\t\tunless gridContainer?.length\r\n\t\t\t\t\t\t\t\tif window.opener\r\n\t\t\t\t\t\t\t\t\tisOpenerRemove = true\r\n\t\t\t\t\t\t\t\t\tgridContainer = window.opener.$(\".gridContainer.#{gridObjectNameClass}\")\r\n\t\t\t\t\t\t\tif gridContainer?.length\r\n\t\t\t\t\t\t\t\tif object.enable_tree\r\n\t\t\t\t\t\t\t\t\tdxDataGridInstance = gridContainer.dxTreeList().dxTreeList('instance')\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tdxDataGridInstance = gridContainer.dxDataGrid().dxDataGrid('instance')\r\n\t\t\t\t\t\t\tif dxDataGridInstance\r\n\t\t\t\t\t\t\t\tif object.enable_tree\r\n\t\t\t\t\t\t\t\t\tdxDataGridInstance.refresh()\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tTemplate.creator_grid.refresh(dxDataGridInstance)\r\n\t\t\t\t\t\t\tif isOpenerRemove or !dxDataGridInstance\r\n\t\t\t\t\t\t\t\tif isOpenerRemove\r\n\t\t\t\t\t\t\t\t\twindow.close()\r\n\t\t\t\t\t\t\t\telse if record_id == Session.get(\"record_id\") and !Steedos.isMobile() and list_view_id != 'calendar' and object_name != \"cms_posts\"\r\n\t\t\t\t\t\t\t\t\tappid = Session.get(\"app_id\")\r\n\t\t\t\t\t\t\t\t\tunless list_view_id\r\n\t\t\t\t\t\t\t\t\t\tlist_view_id = Session.get(\"list_view_id\")\r\n\t\t\t\t\t\t\t\t\tunless list_view_id\r\n\t\t\t\t\t\t\t\t\t\tlist_view_id = \"all\"\r\n\t\t\t\t\t\t\t\t\tFlowRouter.go \"/app/#{appid}/#{object_name}/grid/#{list_view_id}\"\r\n\t\t\t\t\t\t\tif call_back and typeof call_back == \"function\"\r\n\t\t\t\t\t\t\t\tcall_back()\r\n","Creator.actionsByName = {};\n\nif (Meteor.isClient) {\n  Creator.actions = function(actions) {\n    return _.each(actions, function(todo, action_name) {\n      return Creator.actionsByName[action_name] = todo;\n    });\n  };\n  Creator.executeAction = function(object_name, action, record_id, item_element, list_view_id, record) {\n    var moreArgs, obj, todo, todoArgs;\n    obj = Creator.getObject(object_name);\n    if (action != null ? action.todo : void 0) {\n      if (typeof action.todo === \"string\") {\n        todo = Creator.actionsByName[action.todo];\n      } else if (typeof action.todo === \"function\") {\n        todo = action.todo;\n      }\n      if (!record && object_name && record_id) {\n        record = Creator.odata.get(object_name, record_id);\n      }\n      if (todo) {\n        item_element = item_element ? item_element : \"\";\n        moreArgs = Array.prototype.slice.call(arguments, 3);\n        todoArgs = [object_name, record_id].concat(moreArgs);\n        return todo.apply({\n          object_name: object_name,\n          record_id: record_id,\n          object: obj,\n          action: action,\n          item_element: item_element,\n          record: record\n        }, todoArgs);\n      }\n    }\n  };\n  Creator.actions({\n    \"standard_query\": function() {\n      return Modal.show(\"standard_query_modal\");\n    },\n    \"standard_new\": function(object_name, record_id, fields) {\n      var doc, ids;\n      ids = Creator.TabularSelectedIds[object_name];\n      if (ids != null ? ids.length : void 0) {\n        record_id = ids[0];\n        doc = Creator.odata.get(object_name, record_id);\n        Session.set('cmDoc', doc);\n        Session.set('cmShowAgainDuplicated', true);\n      } else {\n        Session.set('cmDoc', FormManager.getInitialValues(object_name));\n      }\n      Meteor.defer(function() {\n        return $(\".creator-add\").click();\n      });\n    },\n    \"standard_open_view\": function(object_name, record_id, fields) {\n      var href;\n      href = Creator.getObjectUrl(object_name, record_id);\n      window.open(href, '_blank', 'width=800, height=600, left=50, top= 50, toolbar=no, status=no, menubar=no, resizable=yes, scrollbars=yes');\n      return false;\n    },\n    \"standard_open_view\": function(object_name, record_id, fields) {\n      var href;\n      href = Creator.getObjectUrl(object_name, record_id);\n      window.open(href, '_blank', 'width=800, height=600, left=50, top= 50, toolbar=no, status=no, menubar=no, resizable=yes, scrollbars=yes');\n      return false;\n    },\n    \"standard_edit\": function(object_name, record_id, fields) {\n      if (record_id) {\n        if (Steedos.isMobile() && false) {\n          Session.set('action_object_name', object_name);\n          Session.set('action_record_id', record_id);\n          if (this.record) {\n            Session.set('cmDoc', this.record);\n          }\n          return Meteor.defer(function() {\n            return $(\".btn-edit-record\").click();\n          });\n        } else {\n          Session.set('action_object_name', object_name);\n          Session.set('action_record_id', record_id);\n          if (this.record) {\n            Session.set('cmDoc', this.record);\n            return Meteor.defer(function() {\n              return $(\".btn.creator-edit\").click();\n            });\n          }\n        }\n      }\n    },\n    \"standard_delete\": function(object_name, record_id, record_title, list_view_id, record, call_back) {\n      var object, text;\n      console.log(\"standard_delete\", object_name, record_id, record_title, list_view_id);\n      object = Creator.getObject(object_name);\n      if (!_.isString(record_title) && (record_title != null ? record_title.name : void 0)) {\n        record_title = record_title != null ? record_title.name : void 0;\n      }\n      if (record_title) {\n        text = \"æ˜¯å¦ç¡®å®šè¦åˆ é™¤æ­¤\" + object.label + \"\\\"\" + record_title + \"\\\"\";\n      } else {\n        text = \"æ˜¯å¦ç¡®å®šè¦åˆ é™¤æ­¤\" + object.label;\n      }\n      return swal({\n        title: \"åˆ é™¤\" + object.label,\n        text: \"<div class='delete-creator-warning'>\" + text + \"ï¼Ÿ</div>\",\n        html: true,\n        showCancelButton: true,\n        confirmButtonText: t('Delete'),\n        cancelButtonText: t('Cancel')\n      }, function(option) {\n        if (option) {\n          return Creator.odata[\"delete\"](object_name, record_id, function() {\n            var appid, dxDataGridInstance, gridContainer, gridObjectNameClass, info, isOpenerRemove;\n            if (record_title) {\n              info = object.label + (\"\\\"\" + record_title + \"\\\"\") + \"å·²åˆ é™¤\";\n            } else {\n              info = \"åˆ é™¤æˆåŠŸ\";\n            }\n            toastr.success(info);\n            gridObjectNameClass = object_name.replace(/\\./g, \"-\");\n            gridContainer = $(\".gridContainer.\" + gridObjectNameClass);\n            if (!(gridContainer != null ? gridContainer.length : void 0)) {\n              if (window.opener) {\n                isOpenerRemove = true;\n                gridContainer = window.opener.$(\".gridContainer.\" + gridObjectNameClass);\n              }\n            }\n            if (gridContainer != null ? gridContainer.length : void 0) {\n              if (object.enable_tree) {\n                dxDataGridInstance = gridContainer.dxTreeList().dxTreeList('instance');\n              } else {\n                dxDataGridInstance = gridContainer.dxDataGrid().dxDataGrid('instance');\n              }\n            }\n            if (dxDataGridInstance) {\n              if (object.enable_tree) {\n                dxDataGridInstance.refresh();\n              } else {\n                Template.creator_grid.refresh(dxDataGridInstance);\n              }\n            }\n            if (isOpenerRemove || !dxDataGridInstance) {\n              if (isOpenerRemove) {\n                window.close();\n              } else if (record_id === Session.get(\"record_id\") && !Steedos.isMobile() && list_view_id !== 'calendar' && object_name !== \"cms_posts\") {\n                appid = Session.get(\"app_id\");\n                if (!list_view_id) {\n                  list_view_id = Session.get(\"list_view_id\");\n                }\n                if (!list_view_id) {\n                  list_view_id = \"all\";\n                }\n                FlowRouter.go(\"/app/\" + appid + \"/\" + object_name + \"/grid/\" + list_view_id);\n              }\n            }\n            if (call_back && typeof call_back === \"function\") {\n              return call_back();\n            }\n          });\n        }\n      });\n    }\n  });\n}\n"]}