{"version":3,"sources":["meteor://ðŸ’»app/packages/steedos_objects/core.coffee","meteor://ðŸ’»app/core.coffee","meteor://ðŸ’»app/packages/steedos_objects/loadStandardObjects.coffee","meteor://ðŸ’»app/loadStandardObjects.coffee","meteor://ðŸ’»app/packages/steedos_objects/coreSupport.coffee","meteor://ðŸ’»app/coreSupport.coffee","meteor://ðŸ’»app/packages/steedos_objects/server/methods/object_options.coffee","meteor://ðŸ’»app/server/methods/object_options.coffee","meteor://ðŸ’»app/packages/steedos_objects/server/routes/api_workflow_view_instance.coffee","meteor://ðŸ’»app/server/routes/api_workflow_view_instance.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/listviews.coffee","meteor://ðŸ’»app/lib/listviews.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/add_simple_schema_validation_error.coffee","meteor://ðŸ’»app/lib/add_simple_schema_validation_error.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/field_simple_schema_validation_error.coffee","meteor://ðŸ’»app/lib/field_simple_schema_validation_error.coffee","meteor://ðŸ’»app/packages/steedos:objects/lib/eval.js","meteor://ðŸ’»app/packages/steedos_objects/lib/convert.coffee","meteor://ðŸ’»app/lib/convert.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/formular.coffee","meteor://ðŸ’»app/lib/formular.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/object.coffee","meteor://ðŸ’»app/lib/object.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/fields.coffee","meteor://ðŸ’»app/lib/fields.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/triggers.coffee","meteor://ðŸ’»app/lib/triggers.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/permission_sets.coffee","meteor://ðŸ’»app/lib/permission_sets.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/collections.coffee","meteor://ðŸ’»app/lib/collections.coffee","meteor://ðŸ’»app/packages/steedos_objects/lib/actions.coffee","meteor://ðŸ’»app/lib/actions.coffee"],"names":["db","Creator","Objects","Collections","Menus","Apps","Dashboards","Reports","subs","steedosSchema","APIService","MetadataService","config","e","moleculer","objectql","packageLoader","packageService","path","settings","steedosCore","process","env","CREATOR_NODE_ENV","require","getSteedosConfig","built_in_plugins","plugins","Meteor","startup","apiService","broker","ex","metadataService","pageService","projectService","standardObjectsDir","standardObjectsPackageLoaderService","steedosService","ServiceBroker","namespace","nodeID","metadata","transporter","TRANSPORTER","cacher","CACHER","logLevel","serializer","requestTimeout","maxCallLevel","heartbeatInterval","heartbeatTimeout","contextParamsCloning","tracking","enabled","shutdownTimeout","disableBalancer","registry","strategy","preferLocal","bulkhead","concurrency","maxQueueSize","validator","errorHandler","tracing","exporter","type","options","logger","colors","width","gaugeWidth","skipProcessEventRegistration","createService","name","mixins","port","started","setTimeout","emit","getSteedosSchema","StandardObjectsPath","packageInfo","wrapAsync","cb","start","then","_restartService","WebApp","connectHandlers","use","express","waitForServices","resolve","reject","init","error","console","Fiber","deps","app","Tracker","Dependency","object","_TEMPLATE","SimpleSchema","extendOptions","filtersFunction","Match","Optional","OneOf","Function","String","optionsFunction","createFunction","isServer","fiberLoadObjects","obj","object_name","loadObjects","run","list_views","space","getCollectionName","_","clone","convertObject","Object","initTriggers","initListViews","getObjectName","getObject","space_id","ref","ref1","isArray","isClient","depend","Session","get","objectsByName","getObjectById","object_id","findWhere","_id","removeObject","log","getCollection","spaceId","_collection_name","removeCollection","isSpaceAdmin","userId","findOne","fields","admins","indexOf","evaluateFormula","formular","context","isString","Formular","checkFormula","evaluateFilters","filters","selector","each","filter","action","value","length","isCommonSpace","getOrderlySetByIds","docs","ids","id_key","hit_first","values","getProperty","sortBy","doc","_index","sortingMethod","value1","value2","isValue1Empty","isValue2Empty","locale","key","Date","getTime","Steedos","toString","localeCompare","getObjectRelateds","_object","permissions","relatedList","relatedListMap","related_objects","isEmpty","objName","isObject","objectName","related_object","related_object_name","related_field","related_field_name","reference_to","foreign_key","write_requires_master_read","enableObjName","getPermissions","enable_audit","modifyAllRecords","enable_files","push","sfsFilesObject","splice","enable_tasks","enable_notes","enable_events","enable_instances","enable_approvals","enable_process","getUserContext","isUnSafeMode","USER_CONTEXT","space_user_org","su","suFields","Error","mobile","position","email","company","organization","company_id","company_ids","user","fullname","getRelativeUrl","url","isFunction","isCordova","startsWith","test","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","getUserCompanyId","getUserCompanyIds","processPermissions","po","allowCreate","allowRead","allowEdit","allowDelete","viewAllRecords","viewCompanyRecords","modifyCompanyRecords","allowReadFiles","viewAllFiles","allowCreateFiles","allowEditFiles","allowDeleteFiles","modifyAllFiles","getTemplateSpaceId","templateSpaceId","getCloudAdminSpaceId","cloudAdminSpaceId","isTemplateSpace","isCloudAdminSpace","steedosStorageDir","STEEDOS_STORAGE_DIR","methods","collection","name_field_key","options_limit","query","query_options","records","results","searchTextQuery","selected","sort","params","NAME_FIELD_KEY","searchText","$regex","$or","$in","extend","$nin","filterQuery","limit","find","fetch","record","label","message","JSON","stringify","JsonRoutes","add","req","res","next","box","current_user_id","current_user_info","flowId","hashData","ins","insId","record_id","redirect_url","ref2","ref3","ref4","workflowUrl","x_auth_token","x_user_id","uuflowManager","check_authorization","body","check","instanceId","flow","inbox_users","includes","cc_users","outbox_users","state","submitter","applicant","permissionManager","getFlowPermissions","spaces","webservices","workflow","sendResult","code","data","update","$unset","errors","errorMessage","reason","getInitWidthPercent","columns","_schema","column_num","init_width_percent","getSchema","field_name","field","is_wide","pick","autoform","getFieldIsWide","getTabularOrder","list_view_id","setting","map","column","hidden","compact","order","index","default_extra_columns","extra_columns","getObjectDefaultColumns","getObjectDefaultExtraColumns","union","getObjectDefaultSort","TabularSelectedIds","convertListView","default_view","list_view","list_view_name","default_columns","default_mobile_columns","oitem","mobile_columns","has","include","filter_scope","parse","forEach","_value","getRelatedList","layoutRelatedList","list","mapList","objectLayoutRelatedListObjects","relatedListNames","relatedListObjects","related_object_names","unrelated_objects","related_lists","item","reFieldName","reObjectName","related","related_field_fullname","split","field_names","is_file","customRelatedListObject","actions","buttons","visible_on","page_size","objOrName","getRelatedObjects","related_object_item","relatedObject","tabular_order","getObjectFirstListViewColumns","without","transformSortToTabular","replace","pluck","difference","v","isActive","allow_relatedList","getObjectFirstListView","first","getListViews","getListView","exac","listViews","getListViewIsRecent","listView","pickObjectMobileColumns","count","getField","isNameColumn","itemCount","maxCount","maxRows","nameColumn","nameKey","result","getObjectDefaultView","defaultView","use_mobile_columns","isAllView","isRecentView","tabularColumns","tabular_sort","column_index","transformSortToDX","dx_sort","RegEx","RegExp","_regExMessages","_globalMessages","regEx","exp","msg","messages","evalInContext","js","eval","call","convertField","getOption","option","foo","color","allOptions","picklist","picklistOptions","getPicklist","getPickListOptions","reverse","enable","defaultValue","triggers","trigger","_todo","_todo_from_code","_todo_from_db","on","todo","systemBaseFields","omit","required","readonly","getSystemBaseFields","_visible","error1","actionsByName","trim","isExpression","visible","record_permissions","globalData","assign","now","parseSingleExpression","_options","_type","beforeOpenFunction","is_company_limited","max","min","_option","k","_regEx","_min","_max","Number","Boolean","_optionsFunction","_reference_to","_createFunction","_beforeOpenFunction","_filtersFunction","_defaultValue","_is_company_limited","_filters","isDate","pop","_is_date","form","val","relatedObjInfo","PREFIX","_prependPrefixForFormula","prefix","fieldVariable","reg","rev","m","$1","formula_str","_CONTEXT","_VALUES","isBoolean","toastr","formatObjectName","_baseObject","_db","defaultListViewId","disabled_list_views","schema","self","baseObject","permission_set","icon","description","is_view","version","is_enable","allow_customActions","exclude_actions","enable_search","paging","enable_api","custom","enable_share","enable_tree","sidebar","open_window","filter_company","calendar","enable_chatter","enable_trash","enable_space_global","enable_follow","enable_workflow","enable_inline_edit","details","masters","lookup_details","in_development","idFieldName","database_name","is_name","primary","filterable","item_name","copyItem","admin","all","list_view_item","ReactiveVar","createCollection","_name","getObjectSchema","contains","attachSchema","_simpleSchema","getObjectODataRouterPrefix","bootstrapLoaded","getSelectOptions","fieldSchema","data_type","optionItem","fieldsArr","_ref_obj","autoform_type","collectionName","fs","fsType","isUnLimited","multiple","rows","language","isMobile","isPad","isiOS","afFieldInput","timezoneId","dxDateBoxOptions","displayFormat","pickerType","dateMobileOptions","outFormat","showIcon","dependOn","depend_on","create","lookup_field","Modal","show","formId","operation","onSuccess","addItems","reference_sort","optionsSort","reference_limit","optionsLimit","reference_to_field","referenceToField","blackbox","objectSwitche","optionsMethod","optionsMethodParams","references","_reference","link","defaultIcon","firstOption","decimal","precision","scale","disabled","Array","editable","accept","system","Email","isNumber","optional","unique","group","searchable","inlineHelpText","isProduction","sortable","getFieldDisplayValue","field_value","html","moment","format","checkFieldTypeSupportBetweenQuery","field_type","pushBetweenBuiltinOptionals","operations","builtinValues","getBetweenBuiltinValues","builtinItem","is_check_only","getBetweenTimeBuiltinValues","getBetweenBuiltinValueItem","getBetweenTimeBuiltinValueItem","getBetweenBuiltinOperation","betweenBuiltinValues","getQuarterStartMonth","month","getMonth","getLastQuarterFirstDay","year","getFullYear","getNextQuarterFirstDay","getMonthDays","days","endDate","millisecond","startDate","getLastMonthFirstDay","currentMonth","currentYear","endValue","firstDay","lastDay","lastMonday","lastMonthFinalDay","lastMonthFirstDay","lastQuarterEndDay","lastQuarterStartDay","lastSunday","last_120_days","last_30_days","last_60_days","last_7_days","last_90_days","minusDay","monday","nextMonday","nextMonthFinalDay","nextMonthFirstDay","nextQuarterEndDay","nextQuarterStartDay","nextSunday","nextYear","next_120_days","next_30_days","next_60_days","next_7_days","next_90_days","previousYear","startValue","strEndDay","strFirstDay","strLastDay","strMonday","strStartDay","strSunday","strToday","strTomorrow","strYestday","sunday","thisQuarterEndDay","thisQuarterStartDay","tomorrow","week","yestday","getDay","t","fv","setHours","getHours","getTimezoneOffset","getFieldDefaultOperation","getFieldOperation","optionals","equal","unequal","less_than","greater_than","less_or_equal","greater_or_equal","not_contain","starts_with","between","getObjectFieldsName","fieldsName","sort_no","cleanTrigger","initTrigger","_trigger_hooks","ref5","todoWrapper","apply","arguments","when","before","insert","remove","after","_hook","trigger_name","_trigger_hook","baseBooleanPermissionPropNames","extendPermissionProps","findOne_permission_object","find_permission_object","intersectionPlus","otherPermissionPropNames","overlayBaseBooleanPermissionProps","permissionPropNames","unionPermissionObjects","unionPlus","getObjectPermissions","getRecordPermissions","isOwner","masterObjectName","masterRecordPerm","record_company_id","record_company_ids","user_company_ids","owner","parent","n","intersection","locked","getRecordRelatedListPermissions","currentObjectName","relatedListItem","currentRecord","isRelateObjectUneditable","masterAllow","relatedObjectPermissions","uneditable_related_list","getObjectRecord","getRecordSafeRelatedList","getAllPermissions","_i","psets","psetsAdmin","psetsAdmin_pos","psetsCurrent","psetsCurrentNames","psetsCurrent_pos","psetsCustomer","psetsCustomer_pos","psetsGuest","psetsGuest_pos","psetsMember","psetsMember_pos","psetsSupplier","psetsSupplier_pos","psetsUser","psetsUser_pos","set_ids","spaceUser","objects","assigned_apps","profile","users","permission_set_id","created","modified","created_by","modified_by","getAssignedApps","bind","assigned_menus","getAssignedMenus","user_permission_sets","array","other","target","props","filesProNames","propNames","propName","apps","psetBase","userProfile","pset","uniq","aboutMenu","adminMenus","allMenus","currentPsetNames","menus","otherMenuApps","otherMenus","admin_menus","flatten","menu","psetsMenu","permission_sets","permission_objects","isNull","permission_set_ids","pos","ops","ops_key","currentPset","tempOps","repeatIndex","repeatPo","opsetAdmin","opsetCustomer","opsetGuest","opsetMember","opsetSupplier","opsetUser","posAdmin","posCustomer","posGuest","posMember","posSupplier","posUser","prof","guest","member","supplier","customer","disabled_actions","unreadable_fields","uneditable_fields","creator_db_url","oplog_url","MONGO_URL_CREATOR","MONGO_OPLOG_URL_CREATOR","_CREATOR_DATASOURCE","_driver","MongoInternals","RemoteCollectionDriver","oplogUrl","collection_key","newCollection","SMSQueue","_deleteRecord","action_name","executeAction","item_element","callback","moreArgs","todoArgs","ObjectGrid","getFilters","word_template","SteedosFilters","formatFiltersToODataQuery","absoluteUrl","window","open","odata","prototype","slice","concat","warning","record_title","call_back","call_back_error","previousDoc","FormManager","getPreviousDoc","info","success","runHook","relatedObjectStandardNew","collection_name","current_object_name","current_record_id","defaultDoc","initialValues","relateObject","set","getRelatedInitialValues","SteedosUI","showModal","stores","ComponentRegistry","components","ObjectForm","objectApiName","title","afterInsert","reloadRecord","FlowRouter","reload","iconPath","defer","$","click","gridName","isRelated","masterRecordId","relatedFieldName","selectedRows","gridRefs","current","api","getSelectedRows","gridRef","getInitialValues","Page","Form","StandardNew","render","href","getObjectUrl","redirect","StandardEdit","beforeHook","i18nTextKey","i18nTitleKey","nameField","selectedRecords","text","getTableSelectedRows","swal","showCancelButton","confirmButtonText","cancelButtonText","afterBatchesDelete","deleteCounter","_e","appid","dxDataGridInstance","gridContainer","gridObjectNameClass","isOpenerRemove","recordUrl","tempNavRemoved","opener","route","endsWith","refreshGrid","dxTreeList","dxDataGrid","refresh","Template","creator_grid","removeTempNavItem","close","go","addClass","removeClass","recordTitle"],"mappings":"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","file":"/packages/steedos_objects.js","sourcesContent":["@db = {}\nif !Creator?\n\t@Creator = {}\nCreator.Objects = {}\nCreator.Collections = {}\nCreator.Menus = []\nCreator.Apps = {}\nCreator.Dashboards = {}\nCreator.Reports = {}\nCreator.subs = {}\nCreator.steedosSchema = {}","this.db = {};\n\nif (typeof Creator === \"undefined\" || Creator === null) {\n  this.Creator = {};\n}\n\nCreator.Objects = {};\n\nCreator.Collections = {};\n\nCreator.Menus = [];\n\nCreator.Apps = {};\n\nCreator.Dashboards = {};\n\nCreator.Reports = {};\n\nCreator.subs = {};\n\nCreator.steedosSchema = {};\n","try\n\tif process.env.CREATOR_NODE_ENV == 'development'\n\t\tsteedosCore = require('@steedos/core')\n\t\tobjectql = require('@steedos/objectql')\n\t\tmoleculer = require(\"moleculer\");\n\t\tpackageLoader = require('@steedos/service-meteor-package-loader');\n\t\tAPIService = require('@steedos/service-api');\n\t\tMetadataService = require('@steedos/service-metadata-server');\n\t\tpackageService = require(\"@steedos/service-package-registry\");\n\t\tpath = require('path')\n\n\t\tconfig = objectql.getSteedosConfig();\n\t\tsettings = {\n\t\t\tbuilt_in_plugins: [\n\t\t\t\t\"@steedos/webapp-public\",\n\t\t\t\t\"@steedos/service-ui\",\n\t\t\t\t\"@steedos/service-cachers-manager\",\n\t\t\t\t\"@steedos/unpkg\",\n\t\t\t\t\"@steedos/workflow\",\n\t\t\t\t\"@steedos/accounts\",\n\t\t\t\t# \"@steedos/steedos-plugin-schema-builder\",\n\t\t\t\t\"@steedos/plugin-company\",\n\t\t\t\t# \"@steedos/plugin-jsreport\",\n\t\t\t\t# \"@steedos/word-template\",\n\t\t\t\t\"@steedos/metadata-api\",\n\t\t\t\t\"@steedos/data-import\",\n\t\t\t\t# \"@steedos/service-fields-indexs\",\n\t\t\t\t\"@steedos/service-accounts\",\n\t\t\t\t\"@steedos/service-charts\",\n\t\t\t\t# \"@steedos/service-pages\",\n\t\t\t\t\"@steedos/service-cloud-init\",\n\t\t\t\t\"@steedos/service-package-registry\",\n\t\t\t\t# \"@steedos/standard-process\",\n\t\t\t\t\"@steedos/webapp-accounts\",\n\t\t\t\t\"@steedos/service-workflow\",\n\t\t\t\t\"@steedos/service-plugin-amis\",\n\t\t\t\t\"@steedos/ee_unpkg-local\"\n\t\t\t],\n\t\t\tplugins: config.plugins\n\t\t}\n\t\tMeteor.startup ->\n\t\t\ttry\n\t\t\t\tbroker = new moleculer.ServiceBroker({\n\t\t\t\t\tnamespace: \"steedos\",\n\t\t\t\t\tnodeID: \"steedos-creator\",\n\t\t\t\t\tmetadata: {},\n\t\t\t\t\ttransporter: process.env.TRANSPORTER,\n\t\t\t\t\tcacher: process.env.CACHER,\n\t\t\t\t\tlogLevel: \"warn\",\n\t\t\t\t\tserializer: \"JSON\",\n\t\t\t\t\trequestTimeout: 60 * 1000,\n\t\t\t\t\tmaxCallLevel: 100,\n\n\t\t\t\t\theartbeatInterval: 10,\n\t\t\t\t\theartbeatTimeout: 30,\n\n\t\t\t\t\tcontextParamsCloning: false,\n\n\t\t\t\t\ttracking: {\n\t\t\t\t\t\tenabled: false,\n\t\t\t\t\t\tshutdownTimeout: 5000,\n\t\t\t\t\t},\n\n\t\t\t\t\tdisableBalancer: false,\n\n\t\t\t\t\tregistry: {\n\t\t\t\t\t\tstrategy: \"RoundRobin\",\n\t\t\t\t\t\tpreferLocal: true\n\t\t\t\t\t},\n\n\t\t\t\t\tbulkhead: {\n\t\t\t\t\t\tenabled: false,\n\t\t\t\t\t\tconcurrency: 10,\n\t\t\t\t\t\tmaxQueueSize: 100,\n\t\t\t\t\t},\n\t\t\t\t\tvalidator: true,\n\t\t\t\t\terrorHandler: null,\n\t\t\t\t\ttracing: {\n\t\t\t\t\t\tenabled: false,\n\t\t\t\t\t\texporter: {\n\t\t\t\t\t\t\ttype: \"Console\",\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tlogger: null,\n\t\t\t\t\t\t\t\tcolors: true,\n\t\t\t\t\t\t\t\twidth: 100,\n\t\t\t\t\t\t\t\tgaugeWidth: 40\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tskipProcessEventRegistration: true\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tprojectService = broker.createService({\n\t\t\t\t\tname: \"project-server\",\n\t\t\t\t\tnamespace: \"steedos\",\n\t\t\t\t\tmixins: [packageService],\n\t\t\t\t});\n\n\n\t\t\t\tmetadataService = broker.createService({\n\t\t\t\t\tname: 'metadata-server',\n\t\t\t\t\tmixins: [MetadataService],\n\t\t\t\t\tsettings: {\n\t\t\t\t\t} \n\t\t\t\t});\n\n\t\t\t\tapiService = broker.createService({\n\t\t\t\t\tname: \"api\",\n\t\t\t\t\tmixins: [APIService],\n\t\t\t\t\tsettings: {\n\t\t\t\t\t\tport: null\n\t\t\t\t\t} \n\t\t\t\t});\n\n\t\t\t\tpageService = broker.createService({\n\t\t\t\t\tname: \"@steedos/service-pages\",\n\t\t\t\t\tmixins: [require('@steedos/service-pages')],\n\t\t\t\t\tsettings: {\n\t\t\t\t\t\tport: null\n\t\t\t\t\t} \n\t\t\t\t});\n\n\t\t\t\tsteedosService = broker.createService({\n\t\t\t\t\tname: \"steedos-server\",\n\t\t\t\t\tmixins: [],\n\t\t\t\t\tsettings: {\n\t\t\t\t\t\tport: null\n\t\t\t\t\t},\n\t\t\t\t\tstarted: ()->\n\t\t\t\t\t\tsetTimeout ->\n\t\t\t\t\t\t\tbroker.emit 'steedos-server.started'\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t, 1000\n\t\t\t\t});\n\n\t\t\t\tobjectql.getSteedosSchema(broker);\n\t\t\t\tstandardObjectsDir = objectql.StandardObjectsPath;\n\t\t\t\tstandardObjectsPackageLoaderService = broker.createService({\n\t\t\t\t\tname: 'standard-objects',\n\t\t\t\t\tmixins: [packageLoader],\n\t\t\t\t\tsettings: { packageInfo: {\n\t\t\t\t\t\tpath: standardObjectsDir,\n\t\t\t\t\t} }\n\t\t\t\t});\n\n\t\t\t\tMeteor.wrapAsync((cb)->\n\t\t\t\t\tbroker.start().then(()->\n\t\t\t\t\t\tif !broker.started \n\t\t\t\t\t\t\tbroker._restartService(standardObjectsPackageLoaderService);\n\n\t\t\t\t\t\tWebApp.connectHandlers.use(\"/\", apiService.express());\n\t\t\t\t\t\t# steedosCore.init(settings).then ()->\n\t\t\t\t\t\t# \tcb();\n\n\t\t\t\t\t\tbroker.waitForServices(standardObjectsPackageLoaderService.name).then (resolve, reject) ->\n\t\t\t\t\t\t\tsteedosCore.init(settings).then ()->\n\t\t\t\t\t\t\t\tcb(reject, resolve)\n\t\t\t\t\t)\n\t\t\t\t)()\n\t\t\tcatch ex\n\t\t\t\tconsole.error(\"error:\",ex)\ncatch e\n\tconsole.error(\"error:\",e)","var APIService, MetadataService, config, e, moleculer, objectql, packageLoader, packageService, path, settings, steedosCore;\n\ntry {\n  if (process.env.CREATOR_NODE_ENV === 'development') {\n    steedosCore = require('@steedos/core');\n    objectql = require('@steedos/objectql');\n    moleculer = require(\"moleculer\");\n    packageLoader = require('@steedos/service-meteor-package-loader');\n    APIService = require('@steedos/service-api');\n    MetadataService = require('@steedos/service-metadata-server');\n    packageService = require(\"@steedos/service-package-registry\");\n    path = require('path');\n    config = objectql.getSteedosConfig();\n    settings = {\n      built_in_plugins: [\"@steedos/webapp-public\", \"@steedos/service-ui\", \"@steedos/service-cachers-manager\", \"@steedos/unpkg\", \"@steedos/workflow\", \"@steedos/accounts\", \"@steedos/plugin-company\", \"@steedos/metadata-api\", \"@steedos/data-import\", \"@steedos/service-accounts\", \"@steedos/service-charts\", \"@steedos/service-cloud-init\", \"@steedos/service-package-registry\", \"@steedos/webapp-accounts\", \"@steedos/service-workflow\", \"@steedos/service-plugin-amis\", \"@steedos/ee_unpkg-local\"],\n      plugins: config.plugins\n    };\n    Meteor.startup(function() {\n      var apiService, broker, ex, metadataService, pageService, projectService, standardObjectsDir, standardObjectsPackageLoaderService, steedosService;\n      try {\n        broker = new moleculer.ServiceBroker({\n          namespace: \"steedos\",\n          nodeID: \"steedos-creator\",\n          metadata: {},\n          transporter: process.env.TRANSPORTER,\n          cacher: process.env.CACHER,\n          logLevel: \"warn\",\n          serializer: \"JSON\",\n          requestTimeout: 60 * 1000,\n          maxCallLevel: 100,\n          heartbeatInterval: 10,\n          heartbeatTimeout: 30,\n          contextParamsCloning: false,\n          tracking: {\n            enabled: false,\n            shutdownTimeout: 5000\n          },\n          disableBalancer: false,\n          registry: {\n            strategy: \"RoundRobin\",\n            preferLocal: true\n          },\n          bulkhead: {\n            enabled: false,\n            concurrency: 10,\n            maxQueueSize: 100\n          },\n          validator: true,\n          errorHandler: null,\n          tracing: {\n            enabled: false,\n            exporter: {\n              type: \"Console\",\n              options: {\n                logger: null,\n                colors: true,\n                width: 100,\n                gaugeWidth: 40\n              }\n            }\n          },\n          skipProcessEventRegistration: true\n        });\n        projectService = broker.createService({\n          name: \"project-server\",\n          namespace: \"steedos\",\n          mixins: [packageService]\n        });\n        metadataService = broker.createService({\n          name: 'metadata-server',\n          mixins: [MetadataService],\n          settings: {}\n        });\n        apiService = broker.createService({\n          name: \"api\",\n          mixins: [APIService],\n          settings: {\n            port: null\n          }\n        });\n        pageService = broker.createService({\n          name: \"@steedos/service-pages\",\n          mixins: [require('@steedos/service-pages')],\n          settings: {\n            port: null\n          }\n        });\n        steedosService = broker.createService({\n          name: \"steedos-server\",\n          mixins: [],\n          settings: {\n            port: null\n          },\n          started: function() {\n            return setTimeout(function() {\n              broker.emit('steedos-server.started');\n            }, 1000);\n          }\n        });\n        objectql.getSteedosSchema(broker);\n        standardObjectsDir = objectql.StandardObjectsPath;\n        standardObjectsPackageLoaderService = broker.createService({\n          name: 'standard-objects',\n          mixins: [packageLoader],\n          settings: {\n            packageInfo: {\n              path: standardObjectsDir\n            }\n          }\n        });\n        return Meteor.wrapAsync(function(cb) {\n          return broker.start().then(function() {\n            if (!broker.started) {\n              broker._restartService(standardObjectsPackageLoaderService);\n            }\n            WebApp.connectHandlers.use(\"/\", apiService.express());\n            return broker.waitForServices(standardObjectsPackageLoaderService.name).then(function(resolve, reject) {\n              return steedosCore.init(settings).then(function() {\n                return cb(reject, resolve);\n              });\n            });\n          });\n        })();\n      } catch (error) {\n        ex = error;\n        return console.error(\"error:\", ex);\n      }\n    });\n  }\n} catch (error) {\n  e = error;\n  console.error(\"error:\", e);\n}\n","Creator.deps = {\n\tapp: new Tracker.Dependency\n\tobject: new Tracker.Dependency\n};\n\nCreator._TEMPLATE = {\n\tApps: {},\n\tObjects: {}\n}\n\nMeteor.startup ->\n\tSimpleSchema.extendOptions({filtersFunction: Match.Optional(Match.OneOf(Function, String))})\n\tSimpleSchema.extendOptions({optionsFunction: Match.Optional(Match.OneOf(Function, String))})\n\tSimpleSchema.extendOptions({createFunction: Match.Optional(Match.OneOf(Function, String))})\n\n# Creator.fiberLoadObjects ä¾›steedos-clié¡¹ç›®ä½¿ç”¨\nif Meteor.isServer\n\tFiber = require('fibers')\n\tCreator.fiberLoadObjects = (obj, object_name)->\n\t\tFiber(()->\n\t\t\tCreator.loadObjects(obj, object_name)\n\t\t).run()\n\nCreator.loadObjects = (obj, object_name)->\n\tif !object_name\n\t\tobject_name = obj.name\n\n\tif !obj.list_views\n\t\tobj.list_views = {}\n\n\tif obj.space\n\t\tobject_name = Creator.getCollectionName(obj)\n\tif object_name == 'cfs_files_filerecord'\n\t\tobject_name = 'cfs.files.filerecord'\n\t\tobj = _.clone(obj)\n\t\tobj.name = object_name\n\t\tCreator.Objects[object_name] = obj\n\n\tCreator.convertObject(obj)\n\tnew Creator.Object(obj);\n\n\tCreator.initTriggers(object_name)\n\tCreator.initListViews(object_name)\n\treturn obj\n\nCreator.getObjectName = (object) ->\n\tif object.space\n\t\treturn \"c_#{object.space}_#{object.name}\"\n\treturn object.name\n\nCreator.getObject = (object_name, space_id)->\n\tif _.isArray(object_name)\n\t\treturn ;\n\tif Meteor.isClient\n\t\tCreator.deps?.object?.depend()\n\tif !object_name and Meteor.isClient\n\t\tobject_name = Session.get(\"object_name\")\n\n#\tif !space_id && object_name\n#\t\tif Meteor.isClient && !object_name.startsWith('c_')\n#\t\t\tspace_id = Session.get(\"spaceId\")\n\n\tif object_name\n#\t\tif space_id\n#\t\t\tobj = Creator.objectsByName[\"c_#{space_id}_#{object_name}\"]\n#\t\t\tif obj\n#\t\t\t\treturn obj\n#\n#\t\tobj = _.find Creator.objectsByName, (o)->\n#\t\t\t\treturn o._collection_name == object_name\n#\t\tif obj\n#\t\t\treturn obj\n\n\t\treturn Creator.objectsByName[object_name]\n\nCreator.getObjectById = (object_id)->\n\treturn _.findWhere(Creator.objectsByName, {_id: object_id})\n\nCreator.removeObject = (object_name)->\n\tconsole.log(\"removeObject\", object_name)\n\tdelete Creator.Objects[object_name]\n\tdelete Creator.objectsByName[object_name]\n\nCreator.getCollection = (object_name, spaceId)->\n\tif !object_name\n\t\tobject_name = Session.get(\"object_name\")\n\tif object_name\n\t\treturn Creator.Collections[Creator.getObject(object_name, spaceId)?._collection_name || object_name]\n\nCreator.removeCollection = (object_name)->\n\tdelete Creator.Collections[object_name]\n\nCreator.isSpaceAdmin = (spaceId, userId)->\n\tif Meteor.isClient\n\t\tif !spaceId\n\t\t\tspaceId = Session.get(\"spaceId\")\n\t\tif !userId\n\t\t\tuserId = Meteor.userId()\n\n\tspace = Creator.getObject(\"spaces\")?.db?.findOne(spaceId,{fields:{admins:1}})\n\tif space?.admins\n\t\treturn space.admins.indexOf(userId) >= 0\n\n\nCreator.evaluateFormula = (formular, context, options)->\n\n\tif !_.isString(formular)\n\t\treturn formular\n\n\tif Creator.Formular.checkFormula(formular)\n\t\treturn Creator.Formular.run(formular, context, options)\n\n\treturn formular\n\nCreator.evaluateFilters = (filters, context)->\n\tselector = {}\n\t_.each filters, (filter)->\n\t\tif filter?.length == 3\n\t\t\tname = filter[0]\n\t\t\taction = filter[1]\n\t\t\tvalue = Creator.evaluateFormula(filter[2], context)\n\t\t\tselector[name] = {}\n\t\t\tselector[name][action] = value\n\t# console.log(\"evaluateFilters-->selector\", selector)\n\treturn selector\n\nCreator.isCommonSpace = (spaceId) ->\n\treturn spaceId == 'common'\n\n###\n\tdocsï¼šå¾…æŽ’åºçš„æ–‡æ¡£æ•°ç»„\n\tidsï¼š_idé›†åˆ\n\tid_key: é»˜è®¤ä¸º_id\n\treturn æŒ‰ç…§idsçš„é¡ºåºè¿”å›žæ–°çš„æ–‡æ¡£é›†åˆ\n###\nCreator.getOrderlySetByIds = (docs, ids, id_key, hit_first)->\n\n\tif !id_key\n\t\tid_key = \"_id\"\n\n\tif hit_first\n\n\t\t#ç”±äºŽä¸èƒ½ä½¿ç”¨_.findIndexå‡½æ•°ï¼Œå› æ­¤æ­¤å¤„å…ˆå°†å¯¹è±¡æ•°ç»„è½¬ä¸ºæ™®é€šæ•°ç»„ç±»åž‹ï¼Œåœ¨èŽ·å–å…¶index\n\t\tvalues = docs.getProperty(id_key)\n\n\t\treturn\t_.sortBy docs, (doc)->\n\t\t\t\t\t_index = ids.indexOf(doc[id_key])\n\t\t\t\t\tif _index > -1\n\t\t\t\t\t\treturn _index\n\t\t\t\t\telse\n\t\t\t\t\t\treturn ids.length + _.indexOf(values, doc[id_key])\n\telse\n\t\treturn\t_.sortBy docs, (doc)->\n\t\t\treturn ids.indexOf(doc[id_key])\n\n###\n\tæŒ‰ç”¨æˆ·æ‰€å±žæœ¬åœ°åŒ–è¯­è¨€è¿›è¡ŒæŽ’åºï¼Œæ”¯æŒä¸­æ–‡ã€æ•°å€¼ã€æ—¥æœŸç­‰å­—æ®µæŽ’åº\n\tå¯¹äºŽObjectç±»åž‹ï¼Œå¦‚æžœæä¾›ä½œç”¨åŸŸä¸­keyå±žæ€§ï¼Œåˆ™å–å€¼ä¸ºvalue[key]è¿›è¡ŒæŽ’åºæ¯”è¾ƒï¼Œåä¹‹æ•´ä¸ªObject.toString()åŽæŽ’åºæ¯”è¾ƒ\n###\nCreator.sortingMethod = (value1, value2) ->\n\tif this.key\n\t\tvalue1 = value1[this.key]\n\t\tvalue2 = value2[this.key]\n\tif value1 instanceof Date\n\t\tvalue1 = value1.getTime()\n\tif value2 instanceof Date\n\t\tvalue2 = value2.getTime()\n\tif typeof value1 is \"number\" and typeof value2 is \"number\"\n\t\treturn value1 - value2\n\t# Handling null values\n\tisValue1Empty = value1 == null or value1 == undefined\n\tisValue2Empty = value2 == null or value2 == undefined\n\tif isValue1Empty and !isValue2Empty\n\t\treturn -1\n\tif isValue1Empty and isValue2Empty\n\t\treturn 0\n\tif !isValue1Empty and isValue2Empty\n\t\treturn 1\n\tlocale = Steedos.locale()\n\treturn value1.toString().localeCompare value2.toString(), locale\n\n\n# è¯¥å‡½æ•°åªåœ¨åˆå§‹åŒ–Objectæ—¶ï¼ŒæŠŠç›¸å…³å¯¹è±¡çš„è®¡ç®—ç»“æžœä¿å­˜åˆ°Objectçš„related_objectså±žæ€§ä¸­ï¼ŒåŽç»­å¯ä»¥ç›´æŽ¥ä»Žrelated_objectså±žæ€§ä¸­å–å¾—è®¡ç®—ç»“æžœè€Œä¸ç”¨å†æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ¥è®¡ç®—\nCreator.getObjectRelateds = (object_name)->\n\tif Meteor.isClient\n\t\tif !object_name\n\t\t\tobject_name = Session.get(\"object_name\")\n\n\trelated_objects = []\n\t# _object = Creator.getObject(object_name)\n\t# å› Creator.getObjectå‡½æ•°å†…éƒ¨è¦è°ƒç”¨è¯¥å‡½æ•°ï¼Œæ‰€ä»¥è¿™é‡Œä¸å¯ä»¥è°ƒç”¨Creator.getObjectå–å¯¹è±¡ï¼Œåªèƒ½è°ƒç”¨Creator.Objectsæ¥å–å¯¹è±¡\n\t_object = Creator.Objects[object_name]\n\tif !_object\n\t\treturn related_objects\n\t\n\trelatedList = _object.relatedList\n\tif Meteor.isClient && !_.isEmpty relatedList\n\t\trelatedListMap = {}\n\t\t_.each relatedList, (objName)->\n\t\t\tif _.isObject objName\n\t\t\t\trelatedListMap[objName.objectName] = {}\n\t\t\telse\n\t\t\t\trelatedListMap[objName] = {}\n\t\t_.each Creator.Objects, (related_object, related_object_name)->\n\t\t\t_.each related_object.fields, (related_field, related_field_name)->\n\t\t\t\tif (related_field.type == \"master_detail\" || related_field.type == \"lookup\") and related_field.reference_to and related_field.reference_to == object_name and relatedListMap[related_object_name]\n\t\t\t\t\t# å½“related_object.fieldsä¸­æœ‰ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„å­—æ®µæŒ‡å‘object_nameè¡¨ç¤ºçš„å¯¹è±¡æ—¶ï¼Œä¼˜å…ˆå–ç¬¬ä¸€ä¸ªä½œä¸ºå¤–é”®å…³ç³»å­—æ®µï¼Œä½†æ˜¯related_fieldä¸ºä¸»å­è¡¨æ—¶å¼ºè¡Œè¦†ç›–ä¹‹å‰çš„relatedListMap[related_object_name]å€¼\n\t\t\t\t\tif _.isEmpty relatedListMap[related_object_name] || related_field.type == \"master_detail\"\n\t\t\t\t\t\trelatedListMap[related_object_name] = { object_name: related_object_name, foreign_key: related_field_name, write_requires_master_read: related_field.write_requires_master_read }\n\t\tif relatedListMap['cms_files']\n\t\t\trelatedListMap['cms_files'] = { object_name: \"cms_files\", foreign_key: \"parent\" }\n\t\tif relatedListMap['instances']\n\t\t\trelatedListMap['instances'] = { object_name: \"instances\", foreign_key: \"record_ids\" }\n\t\t_.each ['tasks', 'notes', 'events', 'approvals'], (enableObjName)->\n\t\t\tif relatedListMap[enableObjName]\n\t\t\t\trelatedListMap[enableObjName] = { object_name: enableObjName, foreign_key: \"related_to\" }\n\t\tif relatedListMap['audit_records']\n\t\t\t#record è¯¦ç»†ä¸‹çš„audit_recordsä»…modifyAllRecordsæƒé™å¯è§\n\t\t\tpermissions = Creator.getPermissions(object_name)\n\t\t\tif _object.enable_audit && permissions?.modifyAllRecords\n\t\t\t\trelatedListMap['audit_records'] = { object_name:\"audit_records\", foreign_key: \"related_to\" }\n\t\trelated_objects = _.values relatedListMap\n\t\treturn related_objects\n\n\tif _object.enable_files\n\t\trelated_objects.push {object_name:\"cms_files\", foreign_key: \"parent\"}\n\n\t_.each Creator.Objects, (related_object, related_object_name)->\n\t\tif related_object_name == \"cfs.files.filerecord\"\n\t\t\t# cfs.files.filerecordå¯¹è±¡åœ¨ç¬¬äºŒæ¬¡ç‚¹å‡»çš„æ—¶å€™related_objectè¿”å›žçš„æ˜¯app-builderä¸­çš„\"metadata.parent\"å­—æ®µè¢«åˆ é™¤äº†ï¼Œè®°åˆ°metadataå­—æ®µçš„sub_fieldsä¸­äº†ï¼Œæ‰€ä»¥è¦å•ç‹¬å¤„ç†ã€‚\n\t\t\tsfsFilesObject = Creator.getObject(\"cfs.files.filerecord\")\n\t\t\tsfsFilesObject && related_object = sfsFilesObject\n\t\t_.each related_object.fields, (related_field, related_field_name)->\n\t\t\tif (related_field.type == \"master_detail\" || (related_field.type == \"lookup\" && related_field.relatedList)) and related_field.reference_to and related_field.reference_to == object_name\n\t\t\t\tif related_object_name == \"object_fields\"\n\t\t\t\t\t#TODO å¾…ç›¸å…³åˆ—è¡¨æ”¯æŒæŽ’åºåŽï¼Œåˆ é™¤æ­¤åˆ¤æ–­\n\t\t\t\t\trelated_objects.splice(0, 0, {object_name:related_object_name, foreign_key: related_field_name})\n\t\t\t\telse\n\t\t\t\t\trelated_objects.push {object_name:related_object_name, foreign_key: related_field_name, write_requires_master_read: related_field.write_requires_master_read}\n\n\tif _object.enable_tasks\n\t\trelated_objects.push {object_name:\"tasks\", foreign_key: \"related_to\"}\n\tif _object.enable_notes\n\t\trelated_objects.push {object_name:\"notes\", foreign_key: \"related_to\"}\n\tif _object.enable_events\n\t\trelated_objects.push {object_name:\"events\", foreign_key: \"related_to\"}\n\tif _object.enable_instances\n\t\trelated_objects.push {object_name:\"instances\", foreign_key: \"record_ids\"}\n\tif _object.enable_approvals\n\t\trelated_objects.push {object_name:\"approvals\", foreign_key: \"related_to\"}\n\tif _object.enable_process\n\t\trelated_objects.push {object_name:\"process_instance_history\", foreign_key: \"target_object\"}\n\t#record è¯¦ç»†ä¸‹çš„audit_recordsä»…modifyAllRecordsæƒé™å¯è§\n\tif Meteor.isClient\n\t\tpermissions = Creator.getPermissions(object_name)\n\t\tif _object.enable_audit && permissions?.modifyAllRecords\n\t\t\trelated_objects.push {object_name:\"audit_records\", foreign_key: \"related_to\"}\n\n\treturn related_objects\n\nCreator.getUserContext = (userId, spaceId, isUnSafeMode)->\n\tif Meteor.isClient\n\t\treturn Creator.USER_CONTEXT\n\telse\n\t\tif !(userId and spaceId)\n\t\t\tthrow new Meteor.Error 500, \"the params userId and spaceId is required for the function Creator.getUserContext\"\n\t\t\treturn null\n\t\tsuFields = {name: 1, mobile: 1, position: 1, email: 1, company: 1, organization: 1, space: 1, company_id: 1, company_ids: 1}\n\t\t# check if user in the space\n\t\tsu = Creator.Collections[\"space_users\"].findOne({space: spaceId, user: userId}, {fields: suFields})\n\t\tif !su\n\t\t\tspaceId = null\n\n\t\t# if spaceId not exists, get the first one.\n\t\tif !spaceId\n\t\t\tif isUnSafeMode\n\t\t\t\tsu = Creator.Collections[\"space_users\"].findOne({user: userId}, {fields: suFields})\n\t\t\t\tif !su\n\t\t\t\t\treturn null\n\t\t\t\tspaceId = su.space\n\t\t\telse\n\t\t\t\treturn null\n\n\t\tUSER_CONTEXT = {}\n\t\tUSER_CONTEXT.userId = userId\n\t\tUSER_CONTEXT.spaceId = spaceId\n\t\tUSER_CONTEXT.user = {\n\t\t\t_id: userId\n\t\t\tname: su.name,\n\t\t\tmobile: su.mobile,\n\t\t\tposition: su.position,\n\t\t\temail: su.email\n\t\t\tcompany: su.company\n\t\t\tcompany_id: su.company_id\n\t\t\tcompany_ids: su.company_ids\n\t\t}\n\t\tspace_user_org = Creator.getCollection(\"organizations\")?.findOne(su.organization)\n\t\tif space_user_org\n\t\t\tUSER_CONTEXT.user.organization = {\n\t\t\t\t_id: space_user_org._id,\n\t\t\t\tname: space_user_org.name,\n\t\t\t\tfullname: space_user_org.fullname\n\t\t\t}\n\t\treturn USER_CONTEXT\n\nCreator.getRelativeUrl = (url)->\n\n\tif _.isFunction(Steedos.isCordova) && Steedos.isCordova() && (url?.startsWith(\"/assets\") || url?.startsWith(\"assets\") || url?.startsWith(\"/packages\"))\n\t\tif !/^\\//.test(url)\n\t\t\turl = \"/\" + url\n\t\treturn url\n\n\tif url\n\t\t# urlå¼€å¤´æ²¡æœ‰\"/\"ï¼Œéœ€è¦æ·»åŠ \"/\"\n\t\tif !/^\\//.test(url)\n\t\t\turl = \"/\" + url\n\t\treturn __meteor_runtime_config__.ROOT_URL_PATH_PREFIX + url\n\telse\n\t\treturn __meteor_runtime_config__.ROOT_URL_PATH_PREFIX\n\nCreator.getUserCompanyId = (userId, spaceId)->\n\tuserId = userId || Meteor.userId()\n\tif Meteor.isClient\n\t\tspaceId = spaceId || Session.get('spaceId')\n\telse\n\t\tif !spaceId\n\t\t\tthrow new Meteor.Error(400, 'miss spaceId')\n\tsu = Creator.getCollection('space_users').findOne({space: spaceId, user: userId}, {fields: {company_id:1}})\n\treturn su.company_id\n\nCreator.getUserCompanyIds = (userId, spaceId)->\n\tuserId = userId || Meteor.userId()\n\tif Meteor.isClient\n\t\tspaceId = spaceId || Session.get('spaceId')\n\telse\n\t\tif !spaceId\n\t\t\tthrow new Meteor.Error(400, 'miss spaceId')\n\tsu = Creator.getCollection('space_users').findOne({space: spaceId, user: userId}, {fields: {company_ids:1}})\n\treturn su?.company_ids\n\nCreator.processPermissions = (po)->\n\tif po.allowCreate\n\t\tpo.allowRead = true\n\tif po.allowEdit\n\t\tpo.allowRead = true\n\tif po.allowDelete\n\t\tpo.allowEdit = true\n\t\tpo.allowRead = true\n\tif po.viewAllRecords\n\t\tpo.allowRead = true\n\tif po.modifyAllRecords\n\t\tpo.allowRead = true\n\t\tpo.allowEdit = true\n\t\tpo.allowDelete = true\n\t\tpo.viewAllRecords = true\n\tif po.viewCompanyRecords\n\t\tpo.allowRead = true\n\tif po.modifyCompanyRecords\n\t\tpo.allowRead = true\n\t\tpo.allowEdit = true\n\t\tpo.allowDelete = true\n\t\tpo.viewCompanyRecords = true\n\t\t\n\t# å¦‚æžœé™„ä»¶ç›¸å…³æƒé™é…ç½®ä¸ºç©ºï¼Œåˆ™å…¼å®¹ä¹‹å‰æ²¡æœ‰é™„ä»¶æƒé™é…ç½®æ—¶çš„è§„åˆ™\n\tif po.allowRead\n\t\ttypeof po.allowReadFiles != \"boolean\" && po.allowReadFiles = true\n\t\ttypeof po.viewAllFiles != \"boolean\" && po.viewAllFiles = true\n\tif po.allowEdit\n\t\ttypeof po.allowCreateFiles != \"boolean\" && po.allowCreateFiles = true\n\t\ttypeof po.allowEditFiles != \"boolean\" && po.allowEditFiles = true\n\t\ttypeof po.allowDeleteFiles != \"boolean\" && po.allowDeleteFiles = true\n\tif po.modifyAllRecords\n\t\ttypeof po.modifyAllFiles != \"boolean\" && po.modifyAllFiles = true\n\n\tif po.allowCreateFiles\n\t\tpo.allowReadFiles = true\n\tif po.allowEditFiles\n\t\tpo.allowReadFiles = true\n\tif po.allowDeleteFiles\n\t\tpo.allowEditFiles = true\n\t\tpo.allowReadFiles = true\n\tif po.viewAllFiles\n\t\tpo.allowReadFiles = true\n\tif po.modifyAllFiles\n\t\tpo.allowReadFiles = true\n\t\tpo.allowEditFiles = true\n\t\tpo.allowDeleteFiles = true\n\t\tpo.viewAllFiles = true\n\n\treturn po\n\nCreator.getTemplateSpaceId = ()->\n\treturn Meteor.settings.public?.templateSpaceId\n\nCreator.getCloudAdminSpaceId = ()->\n\treturn Meteor.settings.public?.cloudAdminSpaceId\n\nCreator.isTemplateSpace = (spaceId)->\n\tif spaceId && Meteor.settings.public?.templateSpaceId == spaceId\n\t\treturn true\n\treturn false\n\nCreator.isCloudAdminSpace = (spaceId)->\n\tif spaceId && Meteor.settings.public?.cloudAdminSpaceId == spaceId\n\t\treturn true\n\treturn false\n\nif Meteor.isServer\n\tCreator.steedosStorageDir = process.env.STEEDOS_STORAGE_DIR\n\t","var Fiber;\n\nCreator.deps = {\n  app: new Tracker.Dependency,\n  object: new Tracker.Dependency\n};\n\nCreator._TEMPLATE = {\n  Apps: {},\n  Objects: {}\n};\n\nMeteor.startup(function() {\n  SimpleSchema.extendOptions({\n    filtersFunction: Match.Optional(Match.OneOf(Function, String))\n  });\n  SimpleSchema.extendOptions({\n    optionsFunction: Match.Optional(Match.OneOf(Function, String))\n  });\n  return SimpleSchema.extendOptions({\n    createFunction: Match.Optional(Match.OneOf(Function, String))\n  });\n});\n\nif (Meteor.isServer) {\n  Fiber = require('fibers');\n  Creator.fiberLoadObjects = function(obj, object_name) {\n    return Fiber(function() {\n      return Creator.loadObjects(obj, object_name);\n    }).run();\n  };\n}\n\nCreator.loadObjects = function(obj, object_name) {\n  if (!object_name) {\n    object_name = obj.name;\n  }\n  if (!obj.list_views) {\n    obj.list_views = {};\n  }\n  if (obj.space) {\n    object_name = Creator.getCollectionName(obj);\n  }\n  if (object_name === 'cfs_files_filerecord') {\n    object_name = 'cfs.files.filerecord';\n    obj = _.clone(obj);\n    obj.name = object_name;\n    Creator.Objects[object_name] = obj;\n  }\n  Creator.convertObject(obj);\n  new Creator.Object(obj);\n  Creator.initTriggers(object_name);\n  Creator.initListViews(object_name);\n  return obj;\n};\n\nCreator.getObjectName = function(object) {\n  if (object.space) {\n    return \"c_\" + object.space + \"_\" + object.name;\n  }\n  return object.name;\n};\n\nCreator.getObject = function(object_name, space_id) {\n  var ref, ref1;\n  if (_.isArray(object_name)) {\n    return;\n  }\n  if (Meteor.isClient) {\n    if ((ref = Creator.deps) != null) {\n      if ((ref1 = ref.object) != null) {\n        ref1.depend();\n      }\n    }\n  }\n  if (!object_name && Meteor.isClient) {\n    object_name = Session.get(\"object_name\");\n  }\n  if (object_name) {\n    return Creator.objectsByName[object_name];\n  }\n};\n\nCreator.getObjectById = function(object_id) {\n  return _.findWhere(Creator.objectsByName, {\n    _id: object_id\n  });\n};\n\nCreator.removeObject = function(object_name) {\n  console.log(\"removeObject\", object_name);\n  delete Creator.Objects[object_name];\n  return delete Creator.objectsByName[object_name];\n};\n\nCreator.getCollection = function(object_name, spaceId) {\n  var ref;\n  if (!object_name) {\n    object_name = Session.get(\"object_name\");\n  }\n  if (object_name) {\n    return Creator.Collections[((ref = Creator.getObject(object_name, spaceId)) != null ? ref._collection_name : void 0) || object_name];\n  }\n};\n\nCreator.removeCollection = function(object_name) {\n  return delete Creator.Collections[object_name];\n};\n\nCreator.isSpaceAdmin = function(spaceId, userId) {\n  var ref, ref1, space;\n  if (Meteor.isClient) {\n    if (!spaceId) {\n      spaceId = Session.get(\"spaceId\");\n    }\n    if (!userId) {\n      userId = Meteor.userId();\n    }\n  }\n  space = (ref = Creator.getObject(\"spaces\")) != null ? (ref1 = ref.db) != null ? ref1.findOne(spaceId, {\n    fields: {\n      admins: 1\n    }\n  }) : void 0 : void 0;\n  if (space != null ? space.admins : void 0) {\n    return space.admins.indexOf(userId) >= 0;\n  }\n};\n\nCreator.evaluateFormula = function(formular, context, options) {\n  if (!_.isString(formular)) {\n    return formular;\n  }\n  if (Creator.Formular.checkFormula(formular)) {\n    return Creator.Formular.run(formular, context, options);\n  }\n  return formular;\n};\n\nCreator.evaluateFilters = function(filters, context) {\n  var selector;\n  selector = {};\n  _.each(filters, function(filter) {\n    var action, name, value;\n    if ((filter != null ? filter.length : void 0) === 3) {\n      name = filter[0];\n      action = filter[1];\n      value = Creator.evaluateFormula(filter[2], context);\n      selector[name] = {};\n      return selector[name][action] = value;\n    }\n  });\n  return selector;\n};\n\nCreator.isCommonSpace = function(spaceId) {\n  return spaceId === 'common';\n};\n\n\n/*\n\tdocsï¼šå¾…æŽ’åºçš„æ–‡æ¡£æ•°ç»„\n\tidsï¼š_idé›†åˆ\n\tid_key: é»˜è®¤ä¸º_id\n\treturn æŒ‰ç…§idsçš„é¡ºåºè¿”å›žæ–°çš„æ–‡æ¡£é›†åˆ\n */\n\nCreator.getOrderlySetByIds = function(docs, ids, id_key, hit_first) {\n  var values;\n  if (!id_key) {\n    id_key = \"_id\";\n  }\n  if (hit_first) {\n    values = docs.getProperty(id_key);\n    return _.sortBy(docs, function(doc) {\n      var _index;\n      _index = ids.indexOf(doc[id_key]);\n      if (_index > -1) {\n        return _index;\n      } else {\n        return ids.length + _.indexOf(values, doc[id_key]);\n      }\n    });\n  } else {\n    return _.sortBy(docs, function(doc) {\n      return ids.indexOf(doc[id_key]);\n    });\n  }\n};\n\n\n/*\n\tæŒ‰ç”¨æˆ·æ‰€å±žæœ¬åœ°åŒ–è¯­è¨€è¿›è¡ŒæŽ’åºï¼Œæ”¯æŒä¸­æ–‡ã€æ•°å€¼ã€æ—¥æœŸç­‰å­—æ®µæŽ’åº\n\tå¯¹äºŽObjectç±»åž‹ï¼Œå¦‚æžœæä¾›ä½œç”¨åŸŸä¸­keyå±žæ€§ï¼Œåˆ™å–å€¼ä¸ºvalue[key]è¿›è¡ŒæŽ’åºæ¯”è¾ƒï¼Œåä¹‹æ•´ä¸ªObject.toString()åŽæŽ’åºæ¯”è¾ƒ\n */\n\nCreator.sortingMethod = function(value1, value2) {\n  var isValue1Empty, isValue2Empty, locale;\n  if (this.key) {\n    value1 = value1[this.key];\n    value2 = value2[this.key];\n  }\n  if (value1 instanceof Date) {\n    value1 = value1.getTime();\n  }\n  if (value2 instanceof Date) {\n    value2 = value2.getTime();\n  }\n  if (typeof value1 === \"number\" && typeof value2 === \"number\") {\n    return value1 - value2;\n  }\n  isValue1Empty = value1 === null || value1 === void 0;\n  isValue2Empty = value2 === null || value2 === void 0;\n  if (isValue1Empty && !isValue2Empty) {\n    return -1;\n  }\n  if (isValue1Empty && isValue2Empty) {\n    return 0;\n  }\n  if (!isValue1Empty && isValue2Empty) {\n    return 1;\n  }\n  locale = Steedos.locale();\n  return value1.toString().localeCompare(value2.toString(), locale);\n};\n\nCreator.getObjectRelateds = function(object_name) {\n  var _object, permissions, relatedList, relatedListMap, related_objects;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n  }\n  related_objects = [];\n  _object = Creator.Objects[object_name];\n  if (!_object) {\n    return related_objects;\n  }\n  relatedList = _object.relatedList;\n  if (Meteor.isClient && !_.isEmpty(relatedList)) {\n    relatedListMap = {};\n    _.each(relatedList, function(objName) {\n      if (_.isObject(objName)) {\n        return relatedListMap[objName.objectName] = {};\n      } else {\n        return relatedListMap[objName] = {};\n      }\n    });\n    _.each(Creator.Objects, function(related_object, related_object_name) {\n      return _.each(related_object.fields, function(related_field, related_field_name) {\n        if ((related_field.type === \"master_detail\" || related_field.type === \"lookup\") && related_field.reference_to && related_field.reference_to === object_name && relatedListMap[related_object_name]) {\n          if (_.isEmpty(relatedListMap[related_object_name] || related_field.type === \"master_detail\")) {\n            return relatedListMap[related_object_name] = {\n              object_name: related_object_name,\n              foreign_key: related_field_name,\n              write_requires_master_read: related_field.write_requires_master_read\n            };\n          }\n        }\n      });\n    });\n    if (relatedListMap['cms_files']) {\n      relatedListMap['cms_files'] = {\n        object_name: \"cms_files\",\n        foreign_key: \"parent\"\n      };\n    }\n    if (relatedListMap['instances']) {\n      relatedListMap['instances'] = {\n        object_name: \"instances\",\n        foreign_key: \"record_ids\"\n      };\n    }\n    _.each(['tasks', 'notes', 'events', 'approvals'], function(enableObjName) {\n      if (relatedListMap[enableObjName]) {\n        return relatedListMap[enableObjName] = {\n          object_name: enableObjName,\n          foreign_key: \"related_to\"\n        };\n      }\n    });\n    if (relatedListMap['audit_records']) {\n      permissions = Creator.getPermissions(object_name);\n      if (_object.enable_audit && (permissions != null ? permissions.modifyAllRecords : void 0)) {\n        relatedListMap['audit_records'] = {\n          object_name: \"audit_records\",\n          foreign_key: \"related_to\"\n        };\n      }\n    }\n    related_objects = _.values(relatedListMap);\n    return related_objects;\n  }\n  if (_object.enable_files) {\n    related_objects.push({\n      object_name: \"cms_files\",\n      foreign_key: \"parent\"\n    });\n  }\n  _.each(Creator.Objects, function(related_object, related_object_name) {\n    var sfsFilesObject;\n    if (related_object_name === \"cfs.files.filerecord\") {\n      sfsFilesObject = Creator.getObject(\"cfs.files.filerecord\");\n      sfsFilesObject && (related_object = sfsFilesObject);\n    }\n    return _.each(related_object.fields, function(related_field, related_field_name) {\n      if ((related_field.type === \"master_detail\" || (related_field.type === \"lookup\" && related_field.relatedList)) && related_field.reference_to && related_field.reference_to === object_name) {\n        if (related_object_name === \"object_fields\") {\n          return related_objects.splice(0, 0, {\n            object_name: related_object_name,\n            foreign_key: related_field_name\n          });\n        } else {\n          return related_objects.push({\n            object_name: related_object_name,\n            foreign_key: related_field_name,\n            write_requires_master_read: related_field.write_requires_master_read\n          });\n        }\n      }\n    });\n  });\n  if (_object.enable_tasks) {\n    related_objects.push({\n      object_name: \"tasks\",\n      foreign_key: \"related_to\"\n    });\n  }\n  if (_object.enable_notes) {\n    related_objects.push({\n      object_name: \"notes\",\n      foreign_key: \"related_to\"\n    });\n  }\n  if (_object.enable_events) {\n    related_objects.push({\n      object_name: \"events\",\n      foreign_key: \"related_to\"\n    });\n  }\n  if (_object.enable_instances) {\n    related_objects.push({\n      object_name: \"instances\",\n      foreign_key: \"record_ids\"\n    });\n  }\n  if (_object.enable_approvals) {\n    related_objects.push({\n      object_name: \"approvals\",\n      foreign_key: \"related_to\"\n    });\n  }\n  if (_object.enable_process) {\n    related_objects.push({\n      object_name: \"process_instance_history\",\n      foreign_key: \"target_object\"\n    });\n  }\n  if (Meteor.isClient) {\n    permissions = Creator.getPermissions(object_name);\n    if (_object.enable_audit && (permissions != null ? permissions.modifyAllRecords : void 0)) {\n      related_objects.push({\n        object_name: \"audit_records\",\n        foreign_key: \"related_to\"\n      });\n    }\n  }\n  return related_objects;\n};\n\nCreator.getUserContext = function(userId, spaceId, isUnSafeMode) {\n  var USER_CONTEXT, ref, space_user_org, su, suFields;\n  if (Meteor.isClient) {\n    return Creator.USER_CONTEXT;\n  } else {\n    if (!(userId && spaceId)) {\n      throw new Meteor.Error(500, \"the params userId and spaceId is required for the function Creator.getUserContext\");\n      return null;\n    }\n    suFields = {\n      name: 1,\n      mobile: 1,\n      position: 1,\n      email: 1,\n      company: 1,\n      organization: 1,\n      space: 1,\n      company_id: 1,\n      company_ids: 1\n    };\n    su = Creator.Collections[\"space_users\"].findOne({\n      space: spaceId,\n      user: userId\n    }, {\n      fields: suFields\n    });\n    if (!su) {\n      spaceId = null;\n    }\n    if (!spaceId) {\n      if (isUnSafeMode) {\n        su = Creator.Collections[\"space_users\"].findOne({\n          user: userId\n        }, {\n          fields: suFields\n        });\n        if (!su) {\n          return null;\n        }\n        spaceId = su.space;\n      } else {\n        return null;\n      }\n    }\n    USER_CONTEXT = {};\n    USER_CONTEXT.userId = userId;\n    USER_CONTEXT.spaceId = spaceId;\n    USER_CONTEXT.user = {\n      _id: userId,\n      name: su.name,\n      mobile: su.mobile,\n      position: su.position,\n      email: su.email,\n      company: su.company,\n      company_id: su.company_id,\n      company_ids: su.company_ids\n    };\n    space_user_org = (ref = Creator.getCollection(\"organizations\")) != null ? ref.findOne(su.organization) : void 0;\n    if (space_user_org) {\n      USER_CONTEXT.user.organization = {\n        _id: space_user_org._id,\n        name: space_user_org.name,\n        fullname: space_user_org.fullname\n      };\n    }\n    return USER_CONTEXT;\n  }\n};\n\nCreator.getRelativeUrl = function(url) {\n  if (_.isFunction(Steedos.isCordova) && Steedos.isCordova() && ((url != null ? url.startsWith(\"/assets\") : void 0) || (url != null ? url.startsWith(\"assets\") : void 0) || (url != null ? url.startsWith(\"/packages\") : void 0))) {\n    if (!/^\\//.test(url)) {\n      url = \"/\" + url;\n    }\n    return url;\n  }\n  if (url) {\n    if (!/^\\//.test(url)) {\n      url = \"/\" + url;\n    }\n    return __meteor_runtime_config__.ROOT_URL_PATH_PREFIX + url;\n  } else {\n    return __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n  }\n};\n\nCreator.getUserCompanyId = function(userId, spaceId) {\n  var su;\n  userId = userId || Meteor.userId();\n  if (Meteor.isClient) {\n    spaceId = spaceId || Session.get('spaceId');\n  } else {\n    if (!spaceId) {\n      throw new Meteor.Error(400, 'miss spaceId');\n    }\n  }\n  su = Creator.getCollection('space_users').findOne({\n    space: spaceId,\n    user: userId\n  }, {\n    fields: {\n      company_id: 1\n    }\n  });\n  return su.company_id;\n};\n\nCreator.getUserCompanyIds = function(userId, spaceId) {\n  var su;\n  userId = userId || Meteor.userId();\n  if (Meteor.isClient) {\n    spaceId = spaceId || Session.get('spaceId');\n  } else {\n    if (!spaceId) {\n      throw new Meteor.Error(400, 'miss spaceId');\n    }\n  }\n  su = Creator.getCollection('space_users').findOne({\n    space: spaceId,\n    user: userId\n  }, {\n    fields: {\n      company_ids: 1\n    }\n  });\n  return su != null ? su.company_ids : void 0;\n};\n\nCreator.processPermissions = function(po) {\n  if (po.allowCreate) {\n    po.allowRead = true;\n  }\n  if (po.allowEdit) {\n    po.allowRead = true;\n  }\n  if (po.allowDelete) {\n    po.allowEdit = true;\n    po.allowRead = true;\n  }\n  if (po.viewAllRecords) {\n    po.allowRead = true;\n  }\n  if (po.modifyAllRecords) {\n    po.allowRead = true;\n    po.allowEdit = true;\n    po.allowDelete = true;\n    po.viewAllRecords = true;\n  }\n  if (po.viewCompanyRecords) {\n    po.allowRead = true;\n  }\n  if (po.modifyCompanyRecords) {\n    po.allowRead = true;\n    po.allowEdit = true;\n    po.allowDelete = true;\n    po.viewCompanyRecords = true;\n  }\n  if (po.allowRead) {\n    typeof po.allowReadFiles !== \"boolean\" && (po.allowReadFiles = true);\n    typeof po.viewAllFiles !== \"boolean\" && (po.viewAllFiles = true);\n  }\n  if (po.allowEdit) {\n    typeof po.allowCreateFiles !== \"boolean\" && (po.allowCreateFiles = true);\n    typeof po.allowEditFiles !== \"boolean\" && (po.allowEditFiles = true);\n    typeof po.allowDeleteFiles !== \"boolean\" && (po.allowDeleteFiles = true);\n  }\n  if (po.modifyAllRecords) {\n    typeof po.modifyAllFiles !== \"boolean\" && (po.modifyAllFiles = true);\n  }\n  if (po.allowCreateFiles) {\n    po.allowReadFiles = true;\n  }\n  if (po.allowEditFiles) {\n    po.allowReadFiles = true;\n  }\n  if (po.allowDeleteFiles) {\n    po.allowEditFiles = true;\n    po.allowReadFiles = true;\n  }\n  if (po.viewAllFiles) {\n    po.allowReadFiles = true;\n  }\n  if (po.modifyAllFiles) {\n    po.allowReadFiles = true;\n    po.allowEditFiles = true;\n    po.allowDeleteFiles = true;\n    po.viewAllFiles = true;\n  }\n  return po;\n};\n\nCreator.getTemplateSpaceId = function() {\n  var ref;\n  return (ref = Meteor.settings[\"public\"]) != null ? ref.templateSpaceId : void 0;\n};\n\nCreator.getCloudAdminSpaceId = function() {\n  var ref;\n  return (ref = Meteor.settings[\"public\"]) != null ? ref.cloudAdminSpaceId : void 0;\n};\n\nCreator.isTemplateSpace = function(spaceId) {\n  var ref;\n  if (spaceId && ((ref = Meteor.settings[\"public\"]) != null ? ref.templateSpaceId : void 0) === spaceId) {\n    return true;\n  }\n  return false;\n};\n\nCreator.isCloudAdminSpace = function(spaceId) {\n  var ref;\n  if (spaceId && ((ref = Meteor.settings[\"public\"]) != null ? ref.cloudAdminSpaceId : void 0) === spaceId) {\n    return true;\n  }\n  return false;\n};\n\nif (Meteor.isServer) {\n  Creator.steedosStorageDir = process.env.STEEDOS_STORAGE_DIR;\n}\n","Meteor.methods\n\t# ç”¨æˆ·èŽ·å–lookup ã€master_detailç±»åž‹å­—æ®µçš„é€‰é¡¹å€¼\n\t\"creator.object_options\": (options)->\n\t\tif options?.params?.reference_to\n\n\t\t\tobject = Creator.getObject(options.params.reference_to, options.params.space)\n\n\t\t\tname_field_key = object.NAME_FIELD_KEY\n\n\t\t\tquery = {}\n\t\t\tif options.params.space\n\t\t\t\tquery.space = options.params.space\n\n\t\t\t\tsort = options?.sort\n\n\t\t\t\tselected = options?.selected || []\n\n\t\t\t\toptions_limit = options?.options_limit || 10\n\n\t\t\t\tif options.searchText\n\t\t\t\t\tsearchTextQuery = {}\n\t\t\t\t\tsearchTextQuery[name_field_key] = {$regex: options.searchText}\n\n\t\t\t\tif options?.values?.length\n\t\t\t\t\tif options.searchText\n\t\t\t\t\t\tquery.$or = [{_id: {$in: options.values}}, searchTextQuery]\n\t\t\t\t\telse\n\t\t\t\t\t\tquery.$or = [{_id: {$in: options.values}}]\n\t\t\t\telse\n\t\t\t\t\tif options.searchText\n\t\t\t\t\t\t_.extend(query, searchTextQuery)\n\t\t\t\t\tquery._id = {$nin: selected}\n\n\t\t\t\tcollection = object.db\n\n\t\t\t\tif options.filterQuery\n\t\t\t\t\t_.extend query, options.filterQuery\n\n\t\t\t\tquery_options = {limit: options_limit}\n\n\t\t\t\tif sort && _.isObject(sort)\n\t\t\t\t\tquery_options.sort = sort\n\n\t\t\t\tif collection\n\t\t\t\t\ttry\n\t\t\t\t\t\trecords = collection.find(query, query_options).fetch()\n\t\t\t\t\t\tresults = []\n\t\t\t\t\t\t_.each records, (record)->\n\t\t\t\t\t\t\tresults.push\n\t\t\t\t\t\t\t\tlabel: record[name_field_key]\n\t\t\t\t\t\t\t\tvalue: record._id\n\t\t\t\t\t\treturn results\n\t\t\t\t\tcatch e\n\t\t\t\t\t\tthrow new Meteor.Error 500, e.message + \"-->\" + JSON.stringify(options)\n\t\treturn [] ","Meteor.methods({\n  \"creator.object_options\": function(options) {\n    var collection, e, name_field_key, object, options_limit, query, query_options, records, ref, ref1, results, searchTextQuery, selected, sort;\n    if (options != null ? (ref = options.params) != null ? ref.reference_to : void 0 : void 0) {\n      object = Creator.getObject(options.params.reference_to, options.params.space);\n      name_field_key = object.NAME_FIELD_KEY;\n      query = {};\n      if (options.params.space) {\n        query.space = options.params.space;\n        sort = options != null ? options.sort : void 0;\n        selected = (options != null ? options.selected : void 0) || [];\n        options_limit = (options != null ? options.options_limit : void 0) || 10;\n        if (options.searchText) {\n          searchTextQuery = {};\n          searchTextQuery[name_field_key] = {\n            $regex: options.searchText\n          };\n        }\n        if (options != null ? (ref1 = options.values) != null ? ref1.length : void 0 : void 0) {\n          if (options.searchText) {\n            query.$or = [\n              {\n                _id: {\n                  $in: options.values\n                }\n              }, searchTextQuery\n            ];\n          } else {\n            query.$or = [\n              {\n                _id: {\n                  $in: options.values\n                }\n              }\n            ];\n          }\n        } else {\n          if (options.searchText) {\n            _.extend(query, searchTextQuery);\n          }\n          query._id = {\n            $nin: selected\n          };\n        }\n        collection = object.db;\n        if (options.filterQuery) {\n          _.extend(query, options.filterQuery);\n        }\n        query_options = {\n          limit: options_limit\n        };\n        if (sort && _.isObject(sort)) {\n          query_options.sort = sort;\n        }\n        if (collection) {\n          try {\n            records = collection.find(query, query_options).fetch();\n            results = [];\n            _.each(records, function(record) {\n              return results.push({\n                label: record[name_field_key],\n                value: record._id\n              });\n            });\n            return results;\n          } catch (error) {\n            e = error;\n            throw new Meteor.Error(500, e.message + \"-->\" + JSON.stringify(options));\n          }\n        }\n      }\n    }\n    return [];\n  }\n});\n","JsonRoutes.add 'post', '/api/workflow/view/:instanceId', (req, res, next) ->\n\ttry\n\t\tcurrent_user_info = uuflowManager.check_authorization(req)\n\t\tcurrent_user_id = current_user_info._id\n\n\t\thashData = req.body\n\t\tobject_name = hashData.object_name\n\t\trecord_id = hashData.record_id\n\t\tspace_id = hashData.space_id\n\n\t\tcheck object_name, String\n\t\tcheck record_id, String\n\t\tcheck space_id, String\n\n\t\tinsId = req.params.instanceId\n\t\tx_user_id = req.query['X-User-Id']\n\t\tx_auth_token = req.query['X-Auth-Token']\n\n\t\tredirect_url = \"/\"\n\t\tins = Creator.getCollection('instances').findOne(insId)\n\t\t# - æˆ‘çš„è‰ç¨¿å°±è·³è½¬è‡³è‰ç¨¿ç®±\n\t\t# - æˆ‘çš„å¾…å®¡æ ¸å°±è·³è½¬è‡³å¾…å®¡æ ¸\n\t\t# - ä¸æ˜¯æˆ‘çš„ç”³è¯·å•åˆ™è·³è½¬è‡³æ‰“å°é¡µé¢\n\t\t# - å¦‚ç”³è¯·å•ä¸å­˜åœ¨åˆ™æç¤ºç”¨æˆ·ç”³è¯·å•å·²åˆ é™¤ï¼Œå¹¶ä¸”æ›´æ–°recordçš„çŠ¶æ€ï¼Œä½¿ç”¨æˆ·å¯ä»¥é‡æ–°å‘èµ·å®¡æ‰¹\n\t\tif ins\n\t\t\tbox = ''\n\t\t\tspaceId = ins.space\n\t\t\tflowId = ins.flow\n\n\t\t\tif (ins.inbox_users?.includes current_user_id) or (ins.cc_users?.includes current_user_id)\n\t\t\t\tbox = 'inbox'\n\t\t\telse if ins.outbox_users?.includes current_user_id\n\t\t\t\tbox = 'outbox'\n\t\t\telse if ins.state is 'draft' and ins.submitter is current_user_id\n\t\t\t\tbox = 'draft'\n\t\t\telse if ins.state is 'pending' and (ins.submitter is current_user_id or ins.applicant is current_user_id)\n\t\t\t\tbox = 'pending'\n\t\t\telse if ins.state is 'completed' and ins.submitter is current_user_id\n\t\t\t\tbox = 'completed'\n\t\t\telse\n\t\t\t\t# éªŒè¯login user_idå¯¹è¯¥æµç¨‹æœ‰ç®¡ç†ã€è§‚å¯Ÿç”³è¯·å•çš„æƒé™\n\t\t\t\tpermissions = permissionManager.getFlowPermissions(flowId, current_user_id)\n\t\t\t\tspace = db.spaces.findOne(spaceId, { fields: { admins: 1 } })\n\t\t\t\tif permissions.includes(\"admin\") or permissions.includes(\"monitor\") or space.admins.includes(current_user_id)\n\t\t\t\t\tbox = 'monitor'\n\t\t\tworkflowUrl = Meteor.settings.public.webservices?.workflow?.url\n\t\t\tif box\n\t\t\t\tredirect_url = (workflowUrl || '') + \"workflow/space/#{spaceId}/#{box}/#{insId}?X-User-Id=#{x_user_id}&X-Auth-Token=#{x_auth_token}\"\n\t\t\telse\n\t\t\t\tredirect_url = (workflowUrl || '') + \"workflow/space/#{spaceId}/print/#{insId}?box=monitor&print_is_show_traces=1&print_is_show_attachments=1&X-User-Id=#{x_user_id}&X-Auth-Token=#{x_auth_token}\"\n\n\t\t\tJsonRoutes.sendResult res, {\n\t\t\t\tcode: 200\n\t\t\t\tdata: { redirect_url: redirect_url }\n\t\t\t}\n\t\t\treturn\n\t\telse\n\t\t\tcollection = Creator.getCollection(object_name, space_id)\n\t\t\tif collection\n\t\t\t\tcollection.update(record_id, {\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\t\"instances\": 1,\n\t\t\t\t\t\t\"instance_state\": 1,\n\t\t\t\t\t\t\"locked\": 1\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tthrow new Meteor.Error('error', 'ç”³è¯·å•å·²åˆ é™¤')\n\n\tcatch e\n\t\tJsonRoutes.sendResult res, {\n\t\t\tcode: 200\n\t\t\tdata: { errors: [{ errorMessage: e.reason || e.message }] }\n\t\t}\n\n","JsonRoutes.add('post', '/api/workflow/view/:instanceId', function(req, res, next) {\n  var box, collection, current_user_id, current_user_info, e, flowId, hashData, ins, insId, object_name, permissions, record_id, redirect_url, ref, ref1, ref2, ref3, ref4, space, spaceId, space_id, workflowUrl, x_auth_token, x_user_id;\n  try {\n    current_user_info = uuflowManager.check_authorization(req);\n    current_user_id = current_user_info._id;\n    hashData = req.body;\n    object_name = hashData.object_name;\n    record_id = hashData.record_id;\n    space_id = hashData.space_id;\n    check(object_name, String);\n    check(record_id, String);\n    check(space_id, String);\n    insId = req.params.instanceId;\n    x_user_id = req.query['X-User-Id'];\n    x_auth_token = req.query['X-Auth-Token'];\n    redirect_url = \"/\";\n    ins = Creator.getCollection('instances').findOne(insId);\n    if (ins) {\n      box = '';\n      spaceId = ins.space;\n      flowId = ins.flow;\n      if (((ref = ins.inbox_users) != null ? ref.includes(current_user_id) : void 0) || ((ref1 = ins.cc_users) != null ? ref1.includes(current_user_id) : void 0)) {\n        box = 'inbox';\n      } else if ((ref2 = ins.outbox_users) != null ? ref2.includes(current_user_id) : void 0) {\n        box = 'outbox';\n      } else if (ins.state === 'draft' && ins.submitter === current_user_id) {\n        box = 'draft';\n      } else if (ins.state === 'pending' && (ins.submitter === current_user_id || ins.applicant === current_user_id)) {\n        box = 'pending';\n      } else if (ins.state === 'completed' && ins.submitter === current_user_id) {\n        box = 'completed';\n      } else {\n        permissions = permissionManager.getFlowPermissions(flowId, current_user_id);\n        space = db.spaces.findOne(spaceId, {\n          fields: {\n            admins: 1\n          }\n        });\n        if (permissions.includes(\"admin\") || permissions.includes(\"monitor\") || space.admins.includes(current_user_id)) {\n          box = 'monitor';\n        }\n      }\n      workflowUrl = (ref3 = Meteor.settings[\"public\"].webservices) != null ? (ref4 = ref3.workflow) != null ? ref4.url : void 0 : void 0;\n      if (box) {\n        redirect_url = (workflowUrl || '') + (\"workflow/space/\" + spaceId + \"/\" + box + \"/\" + insId + \"?X-User-Id=\" + x_user_id + \"&X-Auth-Token=\" + x_auth_token);\n      } else {\n        redirect_url = (workflowUrl || '') + (\"workflow/space/\" + spaceId + \"/print/\" + insId + \"?box=monitor&print_is_show_traces=1&print_is_show_attachments=1&X-User-Id=\" + x_user_id + \"&X-Auth-Token=\" + x_auth_token);\n      }\n      JsonRoutes.sendResult(res, {\n        code: 200,\n        data: {\n          redirect_url: redirect_url\n        }\n      });\n    } else {\n      collection = Creator.getCollection(object_name, space_id);\n      if (collection) {\n        collection.update(record_id, {\n          $unset: {\n            \"instances\": 1,\n            \"instance_state\": 1,\n            \"locked\": 1\n          }\n        });\n        throw new Meteor.Error('error', 'ç”³è¯·å•å·²åˆ é™¤');\n      }\n    }\n  } catch (error) {\n    e = error;\n    return JsonRoutes.sendResult(res, {\n      code: 200,\n      data: {\n        errors: [\n          {\n            errorMessage: e.reason || e.message\n          }\n        ]\n      }\n    });\n  }\n});\n","Creator.getInitWidthPercent = (object_name, columns) ->\n\t_schema = Creator.getSchema(object_name)?._schema\n\tcolumn_num = 0\n\tif _schema\n\t\t_.each columns, (field_name) ->\n\t\t\tfield = _.pick(_schema, field_name)\n\t\t\tis_wide = field[field_name]?.autoform?.is_wide\n\t\t\tif is_wide\n\t\t\t\tcolumn_num += 2\n\t\t\telse\n\t\t\t\tcolumn_num += 1\n\n\t\tinit_width_percent = 100 / column_num\n\t\treturn init_width_percent\n\nCreator.getFieldIsWide = (object_name, field_name) ->\n\t_schema = Creator.getSchema(object_name)._schema\n\tif _schema\n\t\tfield = _.pick(_schema, field_name)\n\t\tis_wide = field[field_name]?.autoform?.is_wide\n\t\treturn is_wide\n\nCreator.getTabularOrder = (object_name, list_view_id, columns) ->\n\tsetting = Creator.Collections?.settings?.findOne({object_name: object_name, record_id: \"object_listviews\"})\n\tobj = Creator.getObject(object_name)\n\tcolumns = _.map columns, (column)->\n\t\tfield = obj.fields[column]\n\t\tif field?.type and !field.hidden\n\t\t\treturn column\n\t\telse\n\t\t\treturn undefined\n\tcolumns = _.compact columns\n\tif setting and setting.settings\n\t\tsort = setting.settings[list_view_id]?.sort || []\n\t\tsort = _.map sort, (order)->\n\t\t\tkey = order[0]\n\t\t\tindex = _.indexOf(columns, key)\n\t\t\torder[0] = index + 1\n\t\t\treturn order\n\t\treturn sort\n\treturn []\n\n\nCreator.initListViews = (object_name)->\n\tobject = Creator.getObject(object_name)\n\tcolumns = Creator.getObjectDefaultColumns(object_name) || [\"name\"]\n\textra_columns = [\"owner\"]\n\tdefault_extra_columns = Creator.getObjectDefaultExtraColumns(object_name) || [\"owner\"]\n\tif default_extra_columns\n\t\textra_columns = _.union extra_columns, default_extra_columns\n\n\torder = Creator.getObjectDefaultSort(object_name) || []\n\tif Meteor.isClient\n\t\tCreator.TabularSelectedIds?[object_name] = []\n\nCreator.convertListView = (default_view, list_view, list_view_name)->\n\tdefault_columns = default_view?.columns\n\tdefault_mobile_columns = default_view?.mobile_columns\n\tunless list_view\n\t\treturn\n\toitem = _.clone(list_view)\n\tif !_.has(oitem, \"name\")\n\t\toitem.name = list_view_name\n\tif !oitem.columns\n\t\tif default_columns\n\t\t\toitem.columns = default_columns\n\tif !oitem.columns\n\t\toitem.columns = [\"name\"]\n\tif !oitem.mobile_columns\n\t\tif default_mobile_columns\n\t\t\toitem.mobile_columns = default_mobile_columns\n\n\tif Meteor.isClient\n\t\tif Creator.isCloudAdminSpace(Session.get(\"spaceId\")) && !_.include(oitem.columns, 'space')\n\t\t\toitem.columns.push('space')\n\n\n\tif !oitem.filter_scope\n\t\t# listviewè§†å›¾çš„filter_scopeé»˜è®¤å€¼æ”¹ä¸ºspace #131\n\t\toitem.filter_scope = \"space\"\n\n\tif !_.has(oitem, \"_id\")\n\t\toitem._id = list_view_name\n\telse\n\t\toitem.label = oitem.label || list_view.name\n\n\tif _.isString(oitem.options)\n\t\toitem.options = JSON.parse(oitem.options)\n\n\t_.forEach oitem.filters, (filter, _index)->\n\t\tif !_.isArray(filter) && _.isObject(filter)\n\t\t\tif Meteor.isServer\n\t\t\t\tif _.isFunction(filter?.value)\n\t\t\t\t\tfilter._value = filter.value.toString()\n\t\t\telse\n\t\t\t\tif _.isString(filter?._value)\n\t\t\t\t\tfilter.value = Creator.eval(\"(#{filter._value})\")\n\treturn oitem\n\n\nif Meteor.isClient\n\tCreator.getRelatedList = (object_name)->\n\t\tunless object_name\n\t\t\treturn\n\t\trelatedListObjects = {}\n\t\trelatedListNames = []\n\t\tobjectLayoutRelatedListObjects = [];\n\t\t_object = Creator.getObject(object_name)\n\t\tif _object\n\t\t\tlayoutRelatedList = _object.related_lists;\n\t\t\t# layoutRelatedList æ˜¯æ•°ç»„å°±è¡¨ç¤ºé…ç½®è¿‡é¡µé¢å¸ƒå±€ï¼Œå°±å¯ç”¨é¡µé¢å¸ƒå±€çš„ç›¸å…³å­è¡¨ã€‚\n\t\t\tif _.isArray layoutRelatedList\n\t\t\t\t_.each layoutRelatedList, (item)->\n\t\t\t\t\treObjectName = item.related_field_fullname.split('.')[0]\n\t\t\t\t\treFieldName = item.related_field_fullname.split('.')[1]\n\t\t\t\t\twrite_requires_master_read = Creator.getObject(reObjectName)?.fields[reFieldName]?.write_requires_master_read\n\t\t\t\t\trelated =\n\t\t\t\t\t\tobject_name: reObjectName\n\t\t\t\t\t\tcolumns: item.field_names\n\t\t\t\t\t\tmobile_columns: item.field_names\n\t\t\t\t\t\tis_file: reObjectName == \"cms_files\"\n\t\t\t\t\t\tfiltersFunction: item.filters\n\t\t\t\t\t\tsort: item.sort\n\t\t\t\t\t\trelated_field_name: reFieldName\n\t\t\t\t\t\tcustomRelatedListObject: true\n\t\t\t\t\t\twrite_requires_master_read: write_requires_master_read\n\t\t\t\t\t\tlabel: item.label\n\t\t\t\t\t\tactions: item.buttons\n\t\t\t\t\t\tvisible_on: item.visible_on\n\t\t\t\t\t\tpage_size: item.page_size\n\t\t\t\t\tobjectLayoutRelatedListObjects.push(related)\n\t\t\t\treturn objectLayoutRelatedListObjects;\n\t\t\trelatedList = _object.relatedList\n\t\t\tif !_.isEmpty relatedList\n\t\t\t\t_.each relatedList, (objOrName)->\n\t\t\t\t\tif _.isObject objOrName\n\t\t\t\t\t\trelated =\n\t\t\t\t\t\t\tobject_name: objOrName.objectName\n\t\t\t\t\t\t\tcolumns: objOrName.columns\n\t\t\t\t\t\t\tmobile_columns: objOrName.mobile_columns\n\t\t\t\t\t\t\tis_file: objOrName.objectName == \"cms_files\"\n\t\t\t\t\t\t\tfiltersFunction: objOrName.filters\n\t\t\t\t\t\t\tsort: objOrName.sort\n\t\t\t\t\t\t\trelated_field_name: ''\n\t\t\t\t\t\t\tcustomRelatedListObject: true\n\t\t\t\t\t\t\tlabel: objOrName.label\n\t\t\t\t\t\t\tactions: objOrName.actions\n\t\t\t\t\t\t\tpage_size: objOrName.page_size\n\t\t\t\t\t\trelatedListObjects[objOrName.objectName] = related\n\t\t\t\t\t\trelatedListNames.push objOrName.objectName\n\t\t\t\t\telse if _.isString objOrName\n\t\t\t\t\t\trelatedListNames.push objOrName\n\n\t\tmapList = {}\n\t\trelated_objects = Creator.getRelatedObjects(object_name)\n\t\t_.each related_objects, (related_object_item) ->\n\t\t\tif !related_object_item?.object_name\n\t\t\t\treturn\n\t\t\trelated_object_name = related_object_item.object_name\n\t\t\trelated_field_name = related_object_item.foreign_key\n\t\t\twrite_requires_master_read = related_object_item.write_requires_master_read\n\t\t\trelated_object = Creator.getObject(related_object_name)\n\t\t\tunless related_object\n\t\t\t\treturn\n\t\t\tcolumns = Creator.getObjectFirstListViewColumns(related_object_name) || [\"name\"]\n\t\t\tcolumns = _.without(columns, related_field_name)\n\t\t\tmobile_columns = Creator.getObjectFirstListViewColumns(related_object_name, true) || [\"name\"]\n\t\t\tmobile_columns = _.without(mobile_columns, related_field_name)\n\n\t\t\torder = Creator.getObjectDefaultSort(related_object_name)\n\t\t\ttabular_order = Creator.transformSortToTabular(order, columns)\n\n\t\t\tif /\\w+\\.\\$\\.\\w+/g.test(related_field_name)\n\t\t\t\t# objectç±»åž‹å¸¦å­å±žæ€§çš„related_field_nameè¦åŽ»æŽ‰ä¸­é—´çš„ç¾Žå…ƒç¬¦å·ï¼Œå¦åˆ™æ˜¾ç¤ºä¸å‡ºå­—æ®µå€¼\n\t\t\t\trelated_field_name = related_field_name.replace(/\\$\\./,\"\")\n\t\t\trelated =\n\t\t\t\tobject_name: related_object_name\n\t\t\t\tcolumns: columns\n\t\t\t\tmobile_columns: mobile_columns\n\t\t\t\trelated_field_name: related_field_name\n\t\t\t\tis_file: related_object_name == \"cms_files\"\n\t\t\t\twrite_requires_master_read: write_requires_master_read\n\n\t\t\trelatedObject = relatedListObjects[related_object_name]\n\t\t\tif relatedObject\n\t\t\t\tif relatedObject.columns\n\t\t\t\t\trelated.columns = relatedObject.columns\n\t\t\t\tif relatedObject.mobile_columns\n\t\t\t\t\trelated.mobile_columns = relatedObject.mobile_columns\n\t\t\t\tif relatedObject.sort\n\t\t\t\t\trelated.sort = relatedObject.sort\n\t\t\t\tif relatedObject.filtersFunction\n\t\t\t\t\trelated.filtersFunction = relatedObject.filtersFunction\n\t\t\t\tif relatedObject.customRelatedListObject\n\t\t\t\t\trelated.customRelatedListObject = relatedObject.customRelatedListObject\n\t\t\t\tif relatedObject.label\n\t\t\t\t\trelated.label = relatedObject.label\n\t\t\t\tif relatedObject.page_size\n\t\t\t\t\trelated.page_size = relatedObject.page_size\n\t\t\t\tdelete relatedListObjects[related_object_name]\n\n\t\t\tmapList[related.object_name] = related\n\n\n\t\tspaceId = Session.get(\"spaceId\")\n\t\tuserId = Meteor.userId()\n\t\trelated_object_names = _.pluck(_.values(relatedListObjects), \"object_name\")\n\t\tpermissions = Creator.getPermissions(object_name, spaceId, userId)\n\t\tunrelated_objects = permissions.unrelated_objects\n\t\trelated_object_names = _.difference related_object_names, unrelated_objects\n\t\t_.each relatedListObjects, (v, related_object_name) ->\n\t\t\tisActive = related_object_names.indexOf(related_object_name) > -1\n\t\t\tallowRead = Creator.getPermissions(related_object_name, spaceId, userId)?.allowRead\n\t\t\tif isActive && allowRead\n\t\t\t\tmapList[related_object_name] = v\n\n\t\tlist = []\n\t\tif _.isEmpty relatedListNames\n\t\t\tlist =  _.values mapList\n\t\telse\n\t\t\t_.each relatedListNames, (objectName) ->\n\t\t\t\tif mapList[objectName]\n\t\t\t\t\tlist.push mapList[objectName]\n\n\t\tif _.has(_object, 'allow_relatedList')\n\t\t\tlist = _.filter list, (item)->\n\t\t\t\treturn _.include(_object.allow_relatedList, item.object_name)\n\n\t\treturn list\n\nCreator.getObjectFirstListView = (object_name)->\n\treturn _.first(Creator.getListViews(object_name))\n\n### \n\tå–å‡ºlist_view_idå¯¹åº”çš„è§†å›¾ï¼Œå¦‚æžœä¸å­˜åœ¨æˆ–è€…æ²¡æœ‰æƒé™ï¼Œå°±è¿”å›žç¬¬ä¸€ä¸ªè§†å›¾\n\texacä¸ºtrueæ—¶ï¼Œéœ€è¦å¼ºåˆ¶æŒ‰list_view_idç²¾ç¡®æŸ¥æ‰¾ï¼Œä¸é»˜è®¤è¿”å›žç¬¬ä¸€ä¸ªè§†å›¾\n###\nCreator.getListView = (object_name, list_view_id, exac)->\n\tif Meteor.isClient\n\t\tif !object_name\n\t\t\tobject_name = Session.get(\"object_name\")\n\t\tif !list_view_id\n\t\t\tlist_view_id = Session.get(\"list_view_id\")\n\tobject = Creator.getObject(object_name)\n\tif !object\n\t\treturn\n\tlistViews = Creator.getListViews(object_name)\n\tunless listViews?.length\n\t\treturn\n\tlist_view = _.find(listViews, (item)-> return item._id == list_view_id || item.name == list_view_id)\n\tunless list_view\n\t\t# å¦‚æžœä¸éœ€è¦å¼ºåˆ¶æŒ‰list_view_idç²¾ç¡®æŸ¥æ‰¾ï¼Œåˆ™é»˜è®¤è¿”å›žç¬¬ä¸€ä¸ªè§†å›¾ï¼Œåä¹‹è¿”å›žç©º\n\t\tif exac\n\t\t\treturn\n\t\telse\n\t\t\tlist_view = listViews[0]\n\treturn list_view\n\n#èŽ·å–list_view_idå¯¹åº”çš„è§†å›¾æ˜¯å¦æ˜¯æœ€è¿‘æŸ¥çœ‹è§†å›¾\nCreator.getListViewIsRecent = (object_name, list_view_id)->\n\tif Meteor.isClient\n\t\tif !object_name\n\t\t\tobject_name = Session.get(\"object_name\")\n\t\tif !list_view_id\n\t\t\tlist_view_id = Session.get(\"list_view_id\")\n\tif typeof(list_view_id) == \"string\"\n\t\tobject = Creator.getObject(object_name)\n\t\tif !object\n\t\t\treturn\n\t\tlistView = _.findWhere(object.list_views,{_id: list_view_id})\n\telse\n\t\tlistView = list_view_id\n\treturn listView?.name == \"recent\"\n\n\n###\n    ä»Žcolumnså‚æ•°ä¸­è¿‡æ»¤å‡ºç”¨äºŽæ‰‹æœºç«¯æ˜¾ç¤ºçš„columns\n\tè§„åˆ™ï¼š\n\t1.ä¼˜å…ˆæŠŠcolumnsä¸­çš„nameå­—æ®µæŽ’åœ¨ç¬¬ä¸€ä¸ª\n\t2.æœ€å¤šåªè¿”å›ž4ä¸ªå­—æ®µ\n\t3.è€ƒè™‘å®½å­—æ®µå ç”¨æ•´è¡Œè§„åˆ™æ¡ä»¶ä¸‹ï¼Œæœ€å¤šåªè¿”å›žä¸¤è¡Œ\n###\nCreator.pickObjectMobileColumns = (object_name, columns)->\n\tresult = []\n\tmaxRows = 2 \n\tmaxCount = maxRows * 2\n\tcount = 0\n\tobject = Creator.getObject(object_name)\n\tfields = object.fields\n\tunless object\n\t\treturn columns\n\tnameKey = object.NAME_FIELD_KEY\n\tisNameColumn = (item)->\n\t\tif _.isObject(item)\n\t\t\treturn item.field == nameKey\n\t\telse\n\t\t\treturn item == nameKey\n\tgetField = (item)->\n\t\tif _.isObject(item)\n\t\t\treturn fields[item.field]\n\t\telse\n\t\t\treturn fields[item]\n\tif nameKey\n\t\tnameColumn = columns.find (item)->\n\t\t\treturn isNameColumn(item)\n\tif nameColumn\n\t\tfield = getField(nameColumn)\n\t\titemCount = if field.is_wide then 2 else 1\n\t\tcount += itemCount\n\t\tresult.push nameColumn\n\tcolumns.forEach (item)->\n\t\tfield = getField(item)\n\t\tunless field\n\t\t\treturn\n\t\titemCount = if field.is_wide then 2 else 1\n\t\tif count < maxCount and result.length < maxCount and !isNameColumn(item)\n\t\t\tcount += itemCount\n\t\t\tif count <= maxCount\n\t\t\t\tresult.push item\n\t\n\treturn result\n\n###\n    èŽ·å–é»˜è®¤è§†å›¾\n###\nCreator.getObjectDefaultView = (object_name)->\n\tobject = Creator.getObject(object_name)\n\tif !object\n\t\tobject = Creator.Objects[object_name]\n\tif object?.list_views?.default\n\t\t#TODO æ­¤ä»£ç åªæ˜¯æš‚æ—¶å…¼å®¹ä»¥å‰codeä¸­å®šä¹‰çš„defaultè§†å›¾ï¼Œå¾…codeä¸­çš„defaultæ¸…ç†å®ŒæˆåŽï¼Œéœ€è¦åˆ é™¤æ­¤ä»£ç \n\t\tdefaultView = object.list_views.default\n\telse\n\t\t_.each object?.list_views, (list_view, key)->\n\t\t\tif list_view.name == \"all\" || key == \"all\"\n\t\t\t\tdefaultView = list_view\n\treturn defaultView;\n\n###\n    èŽ·å–å¯¹è±¡çš„åˆ—è¡¨é»˜è®¤æ˜¾ç¤ºå­—æ®µ\n###\nCreator.getObjectDefaultColumns = (object_name, use_mobile_columns)->\n\tdefaultView = Creator.getObjectDefaultView(object_name)\n\tcolumns = defaultView?.columns\n\tif use_mobile_columns\n\t\tif defaultView?.mobile_columns\n\t\t\tcolumns = defaultView.mobile_columns\n\t\telse if columns\n\t\t\tcolumns = Creator.pickObjectMobileColumns(object_name, columns)\n\treturn columns\n\n###\n    èŽ·å–å¯¹è±¡çš„åˆ—è¡¨ç¬¬ä¸€ä¸ªè§†å›¾æ˜¾ç¤ºçš„å­—æ®µ\n###\nCreator.getObjectFirstListViewColumns = (object_name, use_mobile_columns)->\n\tdefaultView = Creator.getObjectFirstListView(object_name)\n\tcolumns = defaultView?.columns\n\tif use_mobile_columns\n\t\tif defaultView?.mobile_columns\n\t\t\tcolumns = defaultView.mobile_columns\n\t\telse if columns\n\t\t\tcolumns = Creator.pickObjectMobileColumns(object_name, columns)\n\treturn columns\n\n###\n\tèŽ·å–å¯¹è±¡çš„åˆ—è¡¨é»˜è®¤é¢å¤–åŠ è½½çš„å­—æ®µ\n###\nCreator.getObjectDefaultExtraColumns = (object_name)->\n\tdefaultView = Creator.getObjectDefaultView(object_name)\n\treturn defaultView?.extra_columns\n\n###\n\tèŽ·å–å¯¹è±¡çš„é»˜è®¤æŽ’åº\n###\nCreator.getObjectDefaultSort = (object_name)->\n\tdefaultView = Creator.getObjectDefaultView(object_name)\n\tif defaultView\n\t\tif defaultView.sort\n\t\t\treturn defaultView.sort\n\t\telse\n\t\t\treturn [[\"created\", \"desc\"]]\n\n\n###\n    åˆ¤æ–­æ˜¯å¦All view\n###\nCreator.isAllView = (list_view)->\n\treturn list_view?.name == \"all\"\n\n###\n    åˆ¤æ–­æ˜¯å¦æœ€è¿‘æŸ¥çœ‹ view\n###\nCreator.isRecentView = (list_view)->\n\treturn list_view?.name == \"recent\"\n\n###\n    å°†sortè½¬æ¢ä¸ºTabularæŽ§ä»¶æ‰€éœ€è¦çš„æ ¼å¼\n###\nCreator.transformSortToTabular = (sort, tabularColumns)->\n\ttabular_sort = []\n\t_.each sort, (item)->\n\t\tif _.isArray(item)\n\t\t\t# å…¼å®¹æ—§çš„æ•°æ®æ ¼å¼[[\"field_name\", \"order\"]]\n\t\t\tif item.length == 1\n\t\t\t\tcolumn_index = tabularColumns.indexOf(item[0])\n\t\t\t\tif column_index > -1\n\t\t\t\t\ttabular_sort.push [column_index, \"asc\"]\n\t\t\telse if item.length == 2\n\t\t\t\tcolumn_index = tabularColumns.indexOf(item[0])\n\t\t\t\tif column_index > -1\n\t\t\t\t\ttabular_sort.push [column_index, item[1]]\n\t\telse if _.isObject(item)\n\t\t\t#æ–°æ•°æ®æ ¼å¼ï¼š[{field_name: , order: }]\n\t\t\tfield_name = item.field_name\n\t\t\torder = item.order\n\t\t\tif field_name && order\n\t\t\t\tcolumn_index = tabularColumns.indexOf(field_name)\n\t\t\t\tif column_index > -1\n\t\t\t\t\ttabular_sort.push [column_index, order]\n\n\treturn tabular_sort\n\n###\n    å°†sortè½¬æ¢ä¸ºDevExpressæŽ§ä»¶æ‰€éœ€è¦çš„æ ¼å¼\n###\nCreator.transformSortToDX = (sort)->\n\tdx_sort = []\n\t_.each sort, (item)->\n\t\tif _.isArray(item)\n\t\t\t#å…¼å®¹æ—§æ ¼å¼ï¼š[[\"field_name\", \"order\"]]\n\t\t\tdx_sort.push(item)\n\t\telse if _.isObject(item)\n\t\t\t#æ–°æ•°æ®æ ¼å¼ï¼š[{field_name: , order: }]\n\t\t\tfield_name = item.field_name\n\t\t\torder = item.order\n\t\t\tif field_name && order\n\t\t\t\tdx_sort.push [field_name, order]\n\n\treturn dx_sort\n","Creator.getInitWidthPercent = function(object_name, columns) {\n  var _schema, column_num, init_width_percent, ref;\n  _schema = (ref = Creator.getSchema(object_name)) != null ? ref._schema : void 0;\n  column_num = 0;\n  if (_schema) {\n    _.each(columns, function(field_name) {\n      var field, is_wide, ref1, ref2;\n      field = _.pick(_schema, field_name);\n      is_wide = (ref1 = field[field_name]) != null ? (ref2 = ref1.autoform) != null ? ref2.is_wide : void 0 : void 0;\n      if (is_wide) {\n        return column_num += 2;\n      } else {\n        return column_num += 1;\n      }\n    });\n    init_width_percent = 100 / column_num;\n    return init_width_percent;\n  }\n};\n\nCreator.getFieldIsWide = function(object_name, field_name) {\n  var _schema, field, is_wide, ref, ref1;\n  _schema = Creator.getSchema(object_name)._schema;\n  if (_schema) {\n    field = _.pick(_schema, field_name);\n    is_wide = (ref = field[field_name]) != null ? (ref1 = ref.autoform) != null ? ref1.is_wide : void 0 : void 0;\n    return is_wide;\n  }\n};\n\nCreator.getTabularOrder = function(object_name, list_view_id, columns) {\n  var obj, ref, ref1, ref2, setting, sort;\n  setting = (ref = Creator.Collections) != null ? (ref1 = ref.settings) != null ? ref1.findOne({\n    object_name: object_name,\n    record_id: \"object_listviews\"\n  }) : void 0 : void 0;\n  obj = Creator.getObject(object_name);\n  columns = _.map(columns, function(column) {\n    var field;\n    field = obj.fields[column];\n    if ((field != null ? field.type : void 0) && !field.hidden) {\n      return column;\n    } else {\n      return void 0;\n    }\n  });\n  columns = _.compact(columns);\n  if (setting && setting.settings) {\n    sort = ((ref2 = setting.settings[list_view_id]) != null ? ref2.sort : void 0) || [];\n    sort = _.map(sort, function(order) {\n      var index, key;\n      key = order[0];\n      index = _.indexOf(columns, key);\n      order[0] = index + 1;\n      return order;\n    });\n    return sort;\n  }\n  return [];\n};\n\nCreator.initListViews = function(object_name) {\n  var columns, default_extra_columns, extra_columns, object, order, ref;\n  object = Creator.getObject(object_name);\n  columns = Creator.getObjectDefaultColumns(object_name) || [\"name\"];\n  extra_columns = [\"owner\"];\n  default_extra_columns = Creator.getObjectDefaultExtraColumns(object_name) || [\"owner\"];\n  if (default_extra_columns) {\n    extra_columns = _.union(extra_columns, default_extra_columns);\n  }\n  order = Creator.getObjectDefaultSort(object_name) || [];\n  if (Meteor.isClient) {\n    return (ref = Creator.TabularSelectedIds) != null ? ref[object_name] = [] : void 0;\n  }\n};\n\nCreator.convertListView = function(default_view, list_view, list_view_name) {\n  var default_columns, default_mobile_columns, oitem;\n  default_columns = default_view != null ? default_view.columns : void 0;\n  default_mobile_columns = default_view != null ? default_view.mobile_columns : void 0;\n  if (!list_view) {\n    return;\n  }\n  oitem = _.clone(list_view);\n  if (!_.has(oitem, \"name\")) {\n    oitem.name = list_view_name;\n  }\n  if (!oitem.columns) {\n    if (default_columns) {\n      oitem.columns = default_columns;\n    }\n  }\n  if (!oitem.columns) {\n    oitem.columns = [\"name\"];\n  }\n  if (!oitem.mobile_columns) {\n    if (default_mobile_columns) {\n      oitem.mobile_columns = default_mobile_columns;\n    }\n  }\n  if (Meteor.isClient) {\n    if (Creator.isCloudAdminSpace(Session.get(\"spaceId\")) && !_.include(oitem.columns, 'space')) {\n      oitem.columns.push('space');\n    }\n  }\n  if (!oitem.filter_scope) {\n    oitem.filter_scope = \"space\";\n  }\n  if (!_.has(oitem, \"_id\")) {\n    oitem._id = list_view_name;\n  } else {\n    oitem.label = oitem.label || list_view.name;\n  }\n  if (_.isString(oitem.options)) {\n    oitem.options = JSON.parse(oitem.options);\n  }\n  _.forEach(oitem.filters, function(filter, _index) {\n    if (!_.isArray(filter) && _.isObject(filter)) {\n      if (Meteor.isServer) {\n        if (_.isFunction(filter != null ? filter.value : void 0)) {\n          return filter._value = filter.value.toString();\n        }\n      } else {\n        if (_.isString(filter != null ? filter._value : void 0)) {\n          return filter.value = Creator[\"eval\"](\"(\" + filter._value + \")\");\n        }\n      }\n    }\n  });\n  return oitem;\n};\n\nif (Meteor.isClient) {\n  Creator.getRelatedList = function(object_name) {\n    var _object, layoutRelatedList, list, mapList, objectLayoutRelatedListObjects, permissions, relatedList, relatedListNames, relatedListObjects, related_object_names, related_objects, spaceId, unrelated_objects, userId;\n    if (!object_name) {\n      return;\n    }\n    relatedListObjects = {};\n    relatedListNames = [];\n    objectLayoutRelatedListObjects = [];\n    _object = Creator.getObject(object_name);\n    if (_object) {\n      layoutRelatedList = _object.related_lists;\n      if (_.isArray(layoutRelatedList)) {\n        _.each(layoutRelatedList, function(item) {\n          var reFieldName, reObjectName, ref, ref1, related, write_requires_master_read;\n          reObjectName = item.related_field_fullname.split('.')[0];\n          reFieldName = item.related_field_fullname.split('.')[1];\n          write_requires_master_read = (ref = Creator.getObject(reObjectName)) != null ? (ref1 = ref.fields[reFieldName]) != null ? ref1.write_requires_master_read : void 0 : void 0;\n          related = {\n            object_name: reObjectName,\n            columns: item.field_names,\n            mobile_columns: item.field_names,\n            is_file: reObjectName === \"cms_files\",\n            filtersFunction: item.filters,\n            sort: item.sort,\n            related_field_name: reFieldName,\n            customRelatedListObject: true,\n            write_requires_master_read: write_requires_master_read,\n            label: item.label,\n            actions: item.buttons,\n            visible_on: item.visible_on,\n            page_size: item.page_size\n          };\n          return objectLayoutRelatedListObjects.push(related);\n        });\n        return objectLayoutRelatedListObjects;\n      }\n      relatedList = _object.relatedList;\n      if (!_.isEmpty(relatedList)) {\n        _.each(relatedList, function(objOrName) {\n          var related;\n          if (_.isObject(objOrName)) {\n            related = {\n              object_name: objOrName.objectName,\n              columns: objOrName.columns,\n              mobile_columns: objOrName.mobile_columns,\n              is_file: objOrName.objectName === \"cms_files\",\n              filtersFunction: objOrName.filters,\n              sort: objOrName.sort,\n              related_field_name: '',\n              customRelatedListObject: true,\n              label: objOrName.label,\n              actions: objOrName.actions,\n              page_size: objOrName.page_size\n            };\n            relatedListObjects[objOrName.objectName] = related;\n            return relatedListNames.push(objOrName.objectName);\n          } else if (_.isString(objOrName)) {\n            return relatedListNames.push(objOrName);\n          }\n        });\n      }\n    }\n    mapList = {};\n    related_objects = Creator.getRelatedObjects(object_name);\n    _.each(related_objects, function(related_object_item) {\n      var columns, mobile_columns, order, related, relatedObject, related_field_name, related_object, related_object_name, tabular_order, write_requires_master_read;\n      if (!(related_object_item != null ? related_object_item.object_name : void 0)) {\n        return;\n      }\n      related_object_name = related_object_item.object_name;\n      related_field_name = related_object_item.foreign_key;\n      write_requires_master_read = related_object_item.write_requires_master_read;\n      related_object = Creator.getObject(related_object_name);\n      if (!related_object) {\n        return;\n      }\n      columns = Creator.getObjectFirstListViewColumns(related_object_name) || [\"name\"];\n      columns = _.without(columns, related_field_name);\n      mobile_columns = Creator.getObjectFirstListViewColumns(related_object_name, true) || [\"name\"];\n      mobile_columns = _.without(mobile_columns, related_field_name);\n      order = Creator.getObjectDefaultSort(related_object_name);\n      tabular_order = Creator.transformSortToTabular(order, columns);\n      if (/\\w+\\.\\$\\.\\w+/g.test(related_field_name)) {\n        related_field_name = related_field_name.replace(/\\$\\./, \"\");\n      }\n      related = {\n        object_name: related_object_name,\n        columns: columns,\n        mobile_columns: mobile_columns,\n        related_field_name: related_field_name,\n        is_file: related_object_name === \"cms_files\",\n        write_requires_master_read: write_requires_master_read\n      };\n      relatedObject = relatedListObjects[related_object_name];\n      if (relatedObject) {\n        if (relatedObject.columns) {\n          related.columns = relatedObject.columns;\n        }\n        if (relatedObject.mobile_columns) {\n          related.mobile_columns = relatedObject.mobile_columns;\n        }\n        if (relatedObject.sort) {\n          related.sort = relatedObject.sort;\n        }\n        if (relatedObject.filtersFunction) {\n          related.filtersFunction = relatedObject.filtersFunction;\n        }\n        if (relatedObject.customRelatedListObject) {\n          related.customRelatedListObject = relatedObject.customRelatedListObject;\n        }\n        if (relatedObject.label) {\n          related.label = relatedObject.label;\n        }\n        if (relatedObject.page_size) {\n          related.page_size = relatedObject.page_size;\n        }\n        delete relatedListObjects[related_object_name];\n      }\n      return mapList[related.object_name] = related;\n    });\n    spaceId = Session.get(\"spaceId\");\n    userId = Meteor.userId();\n    related_object_names = _.pluck(_.values(relatedListObjects), \"object_name\");\n    permissions = Creator.getPermissions(object_name, spaceId, userId);\n    unrelated_objects = permissions.unrelated_objects;\n    related_object_names = _.difference(related_object_names, unrelated_objects);\n    _.each(relatedListObjects, function(v, related_object_name) {\n      var allowRead, isActive, ref;\n      isActive = related_object_names.indexOf(related_object_name) > -1;\n      allowRead = (ref = Creator.getPermissions(related_object_name, spaceId, userId)) != null ? ref.allowRead : void 0;\n      if (isActive && allowRead) {\n        return mapList[related_object_name] = v;\n      }\n    });\n    list = [];\n    if (_.isEmpty(relatedListNames)) {\n      list = _.values(mapList);\n    } else {\n      _.each(relatedListNames, function(objectName) {\n        if (mapList[objectName]) {\n          return list.push(mapList[objectName]);\n        }\n      });\n    }\n    if (_.has(_object, 'allow_relatedList')) {\n      list = _.filter(list, function(item) {\n        return _.include(_object.allow_relatedList, item.object_name);\n      });\n    }\n    return list;\n  };\n}\n\nCreator.getObjectFirstListView = function(object_name) {\n  return _.first(Creator.getListViews(object_name));\n};\n\n\n/* \n\tå–å‡ºlist_view_idå¯¹åº”çš„è§†å›¾ï¼Œå¦‚æžœä¸å­˜åœ¨æˆ–è€…æ²¡æœ‰æƒé™ï¼Œå°±è¿”å›žç¬¬ä¸€ä¸ªè§†å›¾\n\texacä¸ºtrueæ—¶ï¼Œéœ€è¦å¼ºåˆ¶æŒ‰list_view_idç²¾ç¡®æŸ¥æ‰¾ï¼Œä¸é»˜è®¤è¿”å›žç¬¬ä¸€ä¸ªè§†å›¾\n */\n\nCreator.getListView = function(object_name, list_view_id, exac) {\n  var listViews, list_view, object;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n    if (!list_view_id) {\n      list_view_id = Session.get(\"list_view_id\");\n    }\n  }\n  object = Creator.getObject(object_name);\n  if (!object) {\n    return;\n  }\n  listViews = Creator.getListViews(object_name);\n  if (!(listViews != null ? listViews.length : void 0)) {\n    return;\n  }\n  list_view = _.find(listViews, function(item) {\n    return item._id === list_view_id || item.name === list_view_id;\n  });\n  if (!list_view) {\n    if (exac) {\n      return;\n    } else {\n      list_view = listViews[0];\n    }\n  }\n  return list_view;\n};\n\nCreator.getListViewIsRecent = function(object_name, list_view_id) {\n  var listView, object;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n    if (!list_view_id) {\n      list_view_id = Session.get(\"list_view_id\");\n    }\n  }\n  if (typeof list_view_id === \"string\") {\n    object = Creator.getObject(object_name);\n    if (!object) {\n      return;\n    }\n    listView = _.findWhere(object.list_views, {\n      _id: list_view_id\n    });\n  } else {\n    listView = list_view_id;\n  }\n  return (listView != null ? listView.name : void 0) === \"recent\";\n};\n\n\n/*\n    ä»Žcolumnså‚æ•°ä¸­è¿‡æ»¤å‡ºç”¨äºŽæ‰‹æœºç«¯æ˜¾ç¤ºçš„columns\n\tè§„åˆ™ï¼š\n\t1.ä¼˜å…ˆæŠŠcolumnsä¸­çš„nameå­—æ®µæŽ’åœ¨ç¬¬ä¸€ä¸ª\n\t2.æœ€å¤šåªè¿”å›ž4ä¸ªå­—æ®µ\n\t3.è€ƒè™‘å®½å­—æ®µå ç”¨æ•´è¡Œè§„åˆ™æ¡ä»¶ä¸‹ï¼Œæœ€å¤šåªè¿”å›žä¸¤è¡Œ\n */\n\nCreator.pickObjectMobileColumns = function(object_name, columns) {\n  var count, field, fields, getField, isNameColumn, itemCount, maxCount, maxRows, nameColumn, nameKey, object, result;\n  result = [];\n  maxRows = 2;\n  maxCount = maxRows * 2;\n  count = 0;\n  object = Creator.getObject(object_name);\n  fields = object.fields;\n  if (!object) {\n    return columns;\n  }\n  nameKey = object.NAME_FIELD_KEY;\n  isNameColumn = function(item) {\n    if (_.isObject(item)) {\n      return item.field === nameKey;\n    } else {\n      return item === nameKey;\n    }\n  };\n  getField = function(item) {\n    if (_.isObject(item)) {\n      return fields[item.field];\n    } else {\n      return fields[item];\n    }\n  };\n  if (nameKey) {\n    nameColumn = columns.find(function(item) {\n      return isNameColumn(item);\n    });\n  }\n  if (nameColumn) {\n    field = getField(nameColumn);\n    itemCount = field.is_wide ? 2 : 1;\n    count += itemCount;\n    result.push(nameColumn);\n  }\n  columns.forEach(function(item) {\n    field = getField(item);\n    if (!field) {\n      return;\n    }\n    itemCount = field.is_wide ? 2 : 1;\n    if (count < maxCount && result.length < maxCount && !isNameColumn(item)) {\n      count += itemCount;\n      if (count <= maxCount) {\n        return result.push(item);\n      }\n    }\n  });\n  return result;\n};\n\n\n/*\n    èŽ·å–é»˜è®¤è§†å›¾\n */\n\nCreator.getObjectDefaultView = function(object_name) {\n  var defaultView, object, ref;\n  object = Creator.getObject(object_name);\n  if (!object) {\n    object = Creator.Objects[object_name];\n  }\n  if (object != null ? (ref = object.list_views) != null ? ref[\"default\"] : void 0 : void 0) {\n    defaultView = object.list_views[\"default\"];\n  } else {\n    _.each(object != null ? object.list_views : void 0, function(list_view, key) {\n      if (list_view.name === \"all\" || key === \"all\") {\n        return defaultView = list_view;\n      }\n    });\n  }\n  return defaultView;\n};\n\n\n/*\n    èŽ·å–å¯¹è±¡çš„åˆ—è¡¨é»˜è®¤æ˜¾ç¤ºå­—æ®µ\n */\n\nCreator.getObjectDefaultColumns = function(object_name, use_mobile_columns) {\n  var columns, defaultView;\n  defaultView = Creator.getObjectDefaultView(object_name);\n  columns = defaultView != null ? defaultView.columns : void 0;\n  if (use_mobile_columns) {\n    if (defaultView != null ? defaultView.mobile_columns : void 0) {\n      columns = defaultView.mobile_columns;\n    } else if (columns) {\n      columns = Creator.pickObjectMobileColumns(object_name, columns);\n    }\n  }\n  return columns;\n};\n\n\n/*\n    èŽ·å–å¯¹è±¡çš„åˆ—è¡¨ç¬¬ä¸€ä¸ªè§†å›¾æ˜¾ç¤ºçš„å­—æ®µ\n */\n\nCreator.getObjectFirstListViewColumns = function(object_name, use_mobile_columns) {\n  var columns, defaultView;\n  defaultView = Creator.getObjectFirstListView(object_name);\n  columns = defaultView != null ? defaultView.columns : void 0;\n  if (use_mobile_columns) {\n    if (defaultView != null ? defaultView.mobile_columns : void 0) {\n      columns = defaultView.mobile_columns;\n    } else if (columns) {\n      columns = Creator.pickObjectMobileColumns(object_name, columns);\n    }\n  }\n  return columns;\n};\n\n\n/*\n\tèŽ·å–å¯¹è±¡çš„åˆ—è¡¨é»˜è®¤é¢å¤–åŠ è½½çš„å­—æ®µ\n */\n\nCreator.getObjectDefaultExtraColumns = function(object_name) {\n  var defaultView;\n  defaultView = Creator.getObjectDefaultView(object_name);\n  return defaultView != null ? defaultView.extra_columns : void 0;\n};\n\n\n/*\n\tèŽ·å–å¯¹è±¡çš„é»˜è®¤æŽ’åº\n */\n\nCreator.getObjectDefaultSort = function(object_name) {\n  var defaultView;\n  defaultView = Creator.getObjectDefaultView(object_name);\n  if (defaultView) {\n    if (defaultView.sort) {\n      return defaultView.sort;\n    } else {\n      return [[\"created\", \"desc\"]];\n    }\n  }\n};\n\n\n/*\n    åˆ¤æ–­æ˜¯å¦All view\n */\n\nCreator.isAllView = function(list_view) {\n  return (list_view != null ? list_view.name : void 0) === \"all\";\n};\n\n\n/*\n    åˆ¤æ–­æ˜¯å¦æœ€è¿‘æŸ¥çœ‹ view\n */\n\nCreator.isRecentView = function(list_view) {\n  return (list_view != null ? list_view.name : void 0) === \"recent\";\n};\n\n\n/*\n    å°†sortè½¬æ¢ä¸ºTabularæŽ§ä»¶æ‰€éœ€è¦çš„æ ¼å¼\n */\n\nCreator.transformSortToTabular = function(sort, tabularColumns) {\n  var tabular_sort;\n  tabular_sort = [];\n  _.each(sort, function(item) {\n    var column_index, field_name, order;\n    if (_.isArray(item)) {\n      if (item.length === 1) {\n        column_index = tabularColumns.indexOf(item[0]);\n        if (column_index > -1) {\n          return tabular_sort.push([column_index, \"asc\"]);\n        }\n      } else if (item.length === 2) {\n        column_index = tabularColumns.indexOf(item[0]);\n        if (column_index > -1) {\n          return tabular_sort.push([column_index, item[1]]);\n        }\n      }\n    } else if (_.isObject(item)) {\n      field_name = item.field_name;\n      order = item.order;\n      if (field_name && order) {\n        column_index = tabularColumns.indexOf(field_name);\n        if (column_index > -1) {\n          return tabular_sort.push([column_index, order]);\n        }\n      }\n    }\n  });\n  return tabular_sort;\n};\n\n\n/*\n    å°†sortè½¬æ¢ä¸ºDevExpressæŽ§ä»¶æ‰€éœ€è¦çš„æ ¼å¼\n */\n\nCreator.transformSortToDX = function(sort) {\n  var dx_sort;\n  dx_sort = [];\n  _.each(sort, function(item) {\n    var field_name, order;\n    if (_.isArray(item)) {\n      return dx_sort.push(item);\n    } else if (_.isObject(item)) {\n      field_name = item.field_name;\n      order = item.order;\n      if (field_name && order) {\n        return dx_sort.push([field_name, order]);\n      }\n    }\n  });\n  return dx_sort;\n};\n","SimpleSchema.RegEx.code = new RegExp('^[a-zA-Z_][a-zA-Z0-9_]*$')\n\nif Meteor.isClient\n\tMeteor.startup ()->\n\t\t_regExMessages = SimpleSchema._globalMessages.regEx || []\n\t\t_regExMessages.push {exp: SimpleSchema.RegEx.code, msg: \"[label] åªèƒ½ä»¥å­—æ¯ã€_å¼€å¤´ï¼Œä¸”åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€_\"}\n\t\tSimpleSchema.messages({\n\t\t\tregEx: _regExMessages,\n\t\t})","SimpleSchema.RegEx.code = new RegExp('^[a-zA-Z_][a-zA-Z0-9_]*$');\n\nif (Meteor.isClient) {\n  Meteor.startup(function() {\n    var _regExMessages;\n    _regExMessages = SimpleSchema._globalMessages.regEx || [];\n    _regExMessages.push({\n      exp: SimpleSchema.RegEx.code,\n      msg: \"[label] åªèƒ½ä»¥å­—æ¯ã€_å¼€å¤´ï¼Œä¸”åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€_\"\n    });\n    return SimpleSchema.messages({\n      regEx: _regExMessages\n    });\n  });\n}\n","SimpleSchema.RegEx.field = new RegExp('^[a-zA-Z_]\\\\w*(\\\\.\\\\$\\\\.\\\\w+)?[a-zA-Z0-9]*$')\n\nif Meteor.isClient\n\tMeteor.startup ()->\n\t\t_regExMessages = SimpleSchema._globalMessages.regEx || []\n\t\t_regExMessages.push {exp: SimpleSchema.RegEx.field, msg: \"[label] åªèƒ½ä»¥å­—æ¯ã€_å¼€å¤´ï¼Œ.$.å‰åŽå¿…é¡»åŒ…å«å­—ç¬¦\"}\n\t\tSimpleSchema.messages({\n\t\t\tregEx: _regExMessages,\n\t\t})","SimpleSchema.RegEx.field = new RegExp('^[a-zA-Z_]\\\\w*(\\\\.\\\\$\\\\.\\\\w+)?[a-zA-Z0-9]*$');\n\nif (Meteor.isClient) {\n  Meteor.startup(function() {\n    var _regExMessages;\n    _regExMessages = SimpleSchema._globalMessages.regEx || [];\n    _regExMessages.push({\n      exp: SimpleSchema.RegEx.field,\n      msg: \"[label] åªèƒ½ä»¥å­—æ¯ã€_å¼€å¤´ï¼Œ.$.å‰åŽå¿…é¡»åŒ…å«å­—ç¬¦\"\n    });\n    return SimpleSchema.messages({\n      regEx: _regExMessages\n    });\n  });\n}\n","// å› ä¸ºmeteorç¼–è¯‘coffeescriptä¼šå¯¼è‡´evalå‡½æ•°æŠ¥é”™ï¼Œæ‰€ä»¥å•ç‹¬å†™åœ¨ä¸€ä¸ªjsæ–‡ä»¶ä¸­ã€‚\nCreator.evalInContext = function(js, context) {\n    //# Return the results of the in-line anonymous function we .call with the passed context\n    return function() { \n    \treturn eval(js); \n\t}.call(context);\n}\n\n\nCreator.eval = function(js){\n\ttry{\n\t\treturn eval(js)\n\t}catch (e){\n\t\tconsole.error(e, js);\n\t}\n};","\tgetOption = (option)->\n\t\tfoo = option.split(\":\")\n\t\tif foo.length > 2\n\t\t\treturn {label: foo[0], value: foo[1], color: foo[2]}\n\t\telse if foo.length > 1\n\t\t\treturn {label: foo[0], value: foo[1]}\n\t\telse\n\t\t\treturn {label: foo[0], value: foo[0]}\n\n\tconvertField = (object_name, field_name, field, spaceId)->\n\t\tif Meteor.isServer && spaceId && field.type == 'select'\n\t\t\tcode = field.picklist || \"#{object_name}.#{field_name}\";\n\t\t\tif code\n\t\t\t\tpicklist = Creator.getPicklist(code, spaceId);\n\t\t\t\tif picklist\n\t\t\t\t\toptions = [];\n\t\t\t\t\tallOptions = [];\n\t\t\t\t\tpicklistOptions = Creator.getPickListOptions(picklist)\n\t\t\t\t\tpicklistOptions = _.sortBy(picklistOptions, 'sort_no')?.reverse();\n\t\t\t\t\t_.each picklistOptions, (item)->\n\t\t\t\t\t\tlabel = item.name\n\t\t\t\t\t\tvalue = item.value || item.name\n\t\t\t\t\t\tallOptions.push({label: label, value: value, enable: item.enable, color: item.color})\n\t\t\t\t\t\tif item.enable\n\t\t\t\t\t\t\toptions.push({label: label, value: value, color: item.color})\n\t\t\t\t\t\tif item.default\n\t\t\t\t\t\t\tfield.defaultValue = value\n\t\t\t\t\tif options.length > 0\n\t\t\t\t\t\tfield.options = options\n\t\t\t\t\tif allOptions.length > 0\n\t\t\t\t\t\tfield.allOptions = allOptions\n\t\treturn field;\n\n\tCreator.convertObject = (object, spaceId)->\n\t\tif !object\n\t\t\treturn\n\t\t_.forEach object.triggers, (trigger, key)->\n\n\t\t\tif (Meteor.isServer && trigger.on == \"server\") || (Meteor.isClient && trigger.on == \"client\")\n\t\t\t\t_todo_from_code = trigger?._todo\n\t\t\t\t_todo_from_db = trigger.todo\n\t\t\t\tif _todo_from_code && _.isString(_todo_from_code)\n\t\t\t\t\ttrigger.todo = Creator.eval(\"(#{_todo_from_code})\")\n\n\t\t\t\tif _todo_from_db && _.isString(_todo_from_db)\n\t\t\t\t\t#åªæœ‰updateæ—¶ï¼Œ fieldNames, modifier, options æ‰æœ‰å€¼\n\t\t\t\t\t#TODO æŽ§åˆ¶å¯ä½¿ç”¨çš„å˜é‡ï¼Œå°¤å…¶æ˜¯Collection\n\t\t\t\t\tif _todo_from_db.startsWith(\"function\")\n\t\t\t\t\t\ttrigger.todo = Creator.eval(\"(#{_todo_from_db})\")\n\t\t\t\t\telse\n\t\t\t\t\t\ttrigger.todo = Creator.eval(\"(function(userId, doc, fieldNames, modifier, options){#{_todo_from_db}})\")\n\n\t\t\tif Meteor.isServer && trigger.on == \"client\"\n\t\t\t\t_todo = trigger.todo\n\t\t\t\tif _todo && _.isFunction(_todo)\n\t\t\t\t\ttrigger._todo = _todo.toString()\n\n\t\tif Meteor.isClient\n\t\t\t_.forEach object.fields, (field, key)->\n\n\t\t\t\tif field.omit\n\t\t\t\t\t# omitå­—æ®µå®Œå…¨éšè—ä¸æ˜¾ç¤º\n\t\t\t\t\tfield.hidden = true\n\n\t\t\t\tif field.required && field.readonly\n\t\t\t\t\t# é€šç”¨å¿…å¡«å­—æ®µ #2952ï¼Œå¿…å¡«å­—æ®µè®¾ç½®ä¸ºéžåªè¯»\n\t\t\t\t\tfield.readonly = false\n\n\t\t\t\tsystemBaseFields = Creator.getSystemBaseFields()\n\t\t\t\tif systemBaseFields.indexOf(key) > -1\n\t\t\t\t\t# å¼ºåˆ¶åˆ›å»ºäººåˆ›å»ºæ—¶é—´ç­‰å­—æ®µä¸ºåªè¯»\n\t\t\t\t\tfield.readonly = true\n\n\t\t\t_.forEach object.actions, (action, key)->\n\t\t\t\t_todo_from_code = action?._todo\n\t\t\t\t_todo_from_db = action?.todo\n\t\t\t\tif _todo_from_code && _.isString(_todo_from_code)\n\t\t\t\t\t#TODO æŽ§åˆ¶å¯ä½¿ç”¨çš„å˜é‡\n\t\t\t\t\ttry\n\t\t\t\t\t\taction.todo = Creator.eval(\"(#{_todo_from_code})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"todo_from_code\", _todo_from_code\n\t\t\t\tif _todo_from_db && _.isString(_todo_from_db)\n\t\t\t\t\t#TODO æŽ§åˆ¶å¯ä½¿ç”¨çš„å˜é‡\n\t\t\t\t\ttry\n\t\t\t\t\t\tif _todo_from_db.startsWith(\"function\")\n\t\t\t\t\t\t\taction.todo = Creator.eval(\"(#{_todo_from_db})\")\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tif _.isFunction(Creator.actionsByName[_todo_from_db])\n\t\t\t\t\t\t\t\taction.todo = _todo_from_db\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\taction.todo = Creator.eval(\"(function(){#{_todo_from_db}})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"todo_from_db\", _todo_from_db, error\n\n\t\t\t\t_visible = action?._visible\n\t\t\t\tif _visible\n\t\t\t\t\ttry\n\t\t\t\t\t\tif _.isString(_visible)\n\t\t\t\t\t\t\t_visible = _visible.trim()\n\t\t\t\t\t\tif Steedos.isExpression(_visible)\n\t\t\t\t\t\t\t# æ”¯æŒé¡µé¢å¸ƒå±€ä¸­å†™visible_onå‡½æ•°è¡¨è¾¾å¼ï¼Œé¡µé¢å¸ƒå±€æŒ‰é’®çš„æ˜¾ç¤ºæ¡ä»¶ä¸ç”Ÿæ•ˆ #3340\n\t\t\t\t\t\t\taction.visible = (object_name, record_id, record_permissions, record) ->\n\t\t\t\t\t\t\t\tglobalData = Object.assign({}, Creator.USER_CONTEXT, {now: new Date()})\n\t\t\t\t\t\t\t\treturn Steedos.parseSingleExpression(_visible, record, \"#\", globalData)\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\taction.visible = Creator.eval(\"(#{_visible})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"action.visible to function error: \", error, _visible\n\t\telse\n\t\t\t_.forEach object.actions, (action, key)->\n\t\t\t\t_todo = action?.todo\n\t\t\t\tif _todo && _.isFunction(_todo)\n\t\t\t\t\t#TODO æŽ§åˆ¶å¯ä½¿ç”¨çš„å˜é‡\n\t\t\t\t\taction._todo = _todo.toString()\n\n\t\t\t\t_visible = action?.visible\n\n\t\t\t\tif _visible && _.isFunction(_visible)\n\t\t\t\t\taction._visible = _visible.toString()\n\n\t\t_.forEach object.fields, (field, key)->\n\n\t\t\tfield = convertField(object.name, key, field, spaceId);\n\n\t\t\tif field.options && _.isString(field.options)\n\t\t\t\ttry\n\t\t\t\t\t_options = []\n\t\t\t\t\t#æ”¯æŒ\\næˆ–è€…è‹±æ–‡é€—å·åˆ†å‰²,\n\t\t\t\t\t_.forEach field.options.split(\"\\n\"), (option)->\n\t\t\t\t\t\tif option.indexOf(\",\")\n\t\t\t\t\t\t\toptions = option.split(\",\")\n\t\t\t\t\t\t\t_.forEach options, (_option)->\n\t\t\t\t\t\t\t\t_options.push(getOption(_option))\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\t_options.push(getOption(option))\n\t\t\t\t\tfield.options = _options\n\t\t\t\tcatch error\n\t\t\t\t\tconsole.error \"Creator.convertFieldsOptions\", field.options, error\n\n\t\t\telse if field.options && _.isArray(field.options)\n\t\t\t\ttry\n\t\t\t\t\t_options = []\n\t\t\t\t\t#æ”¯æŒæ•°ç»„ä¸­ç›´æŽ¥å®šä¹‰æ¯ä¸ªé€‰é¡¹çš„ç®€ç‰ˆæ ¼å¼å­—ç¬¦ä¸²\n\t\t\t\t\t_.forEach field.options, (option)->\n\t\t\t\t\t\tif _.isString(option)\n\t\t\t\t\t\t\t_options.push(getOption(option))\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\t_options.push(option)\n\t\t\t\t\tfield.options = _options\n\t\t\t\tcatch error\n\t\t\t\t\tconsole.error \"Creator.convertFieldsOptions\", field.options, error\n\n\t\t\telse if field.options && !_.isFunction(field.options) && !_.isArray(field.options) && _.isObject(field.options)\n\t\t\t\t_options = []\n\t\t\t\t_.each field.options, (v, k)->\n\t\t\t\t\t_options.push {label: v, value: k}\n\t\t\t\tfield.options = _options\n\n\t\t\tif Meteor.isServer\n\t\t\t\toptions = field.options\n\t\t\t\tif options && _.isFunction(options)\n\t\t\t\t\tfield._options = field.options.toString()\n\t\t\telse\n\t\t\t\toptions = field._options\n\t\t\t\tif options && _.isString(options)\n\t\t\t\t\ttry\n\t\t\t\t\t\tfield.options = Creator.eval(\"(#{options})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\n\n\t\t\tif Meteor.isServer\n\t\t\t\tregEx = field.regEx\n\t\t\t\tif regEx\n\t\t\t\t\tfield._regEx = field.regEx.toString()\n\t\t\telse\n\t\t\t\tregEx = field._regEx\n\t\t\t\tif regEx\n\t\t\t\t\ttry\n\t\t\t\t\t\tfield.regEx = Creator.eval(\"(#{regEx})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\n\n\t\t\tif Meteor.isServer\n\t\t\t\tmin = field.min\n\t\t\t\tif _.isFunction(min)\n\t\t\t\t\tfield._min = min.toString()\n\t\t\telse\n\t\t\t\tmin = field._min\n\t\t\t\tif _.isString(min)\n\t\t\t\t\ttry\n\t\t\t\t\t\tfield.min = Creator.eval(\"(#{min})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\n\n\t\t\tif Meteor.isServer\n\t\t\t\tmax = field.max\n\t\t\t\tif _.isFunction(max)\n\t\t\t\t\tfield._max = max.toString()\n\t\t\telse\n\t\t\t\tmax = field._max\n\t\t\t\tif _.isString(max)\n\t\t\t\t\ttry\n\t\t\t\t\t\tfield.max = Creator.eval(\"(#{max})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\n\n\t\t\tif Meteor.isServer\n\t\t\t\tif field.autoform\n\t\t\t\t\t_type = field.autoform.type\n\t\t\t\t\tif _type && _.isFunction(_type) && _type != Object && _type != String && _type != Number && _type != Boolean && !_.isArray(_type)\n\t\t\t\t\t\tfield.autoform._type = _type.toString()\n\t\t\telse\n\t\t\t\tif field.autoform\n\t\t\t\t\t_type = field.autoform._type\n\t\t\t\t\tif _type && _.isString(_type)\n\t\t\t\t\t\ttry\n\t\t\t\t\t\t\tfield.autoform.type = Creator.eval(\"(#{_type})\")\n\t\t\t\t\t\tcatch error\n\t\t\t\t\t\t\tconsole.error \"convert field -> type error\", field, error\n\n\t\t\tif Meteor.isServer\n\n\t\t\t\toptionsFunction = field.optionsFunction\n\t\t\t\treference_to = field.reference_to\n\t\t\t\tcreateFunction = field.createFunction\n\t\t\t\tbeforeOpenFunction = field.beforeOpenFunction\n\t\t\t\tfiltersFunction = field.filtersFunction\n\n\t\t\t\tif optionsFunction && _.isFunction(optionsFunction)\n\t\t\t\t\tfield._optionsFunction = optionsFunction.toString()\n\n\t\t\t\tif reference_to && _.isFunction(reference_to)\n\t\t\t\t\tfield._reference_to = reference_to.toString()\n\n\t\t\t\tif createFunction && _.isFunction(createFunction)\n\t\t\t\t\tfield._createFunction = createFunction.toString()\n\t\t\t\tif beforeOpenFunction && _.isFunction(beforeOpenFunction)\n\t\t\t\t\tfield._beforeOpenFunction = beforeOpenFunction.toString()\n\n\t\t\t\tif filtersFunction && _.isFunction(filtersFunction)\n\t\t\t\t\tfield._filtersFunction = filtersFunction.toString()\n\t\t\telse\n\n\t\t\t\toptionsFunction = field._optionsFunction || field.optionsFunction\n\t\t\t\treference_to = field._reference_to\n\t\t\t\tcreateFunction = field._createFunction\n\t\t\t\tbeforeOpenFunction = field._beforeOpenFunction\n\t\t\t\tfiltersFunction = field._filtersFunction || field.filtersFunction\n\n\t\t\t\tif optionsFunction && _.isString(optionsFunction)\n\t\t\t\t\tfield.optionsFunction = Creator.eval(\"(#{optionsFunction})\")\n\n\t\t\t\tif reference_to && _.isString(reference_to)\n\t\t\t\t\tfield.reference_to = Creator.eval(\"(#{reference_to})\")\n\n\t\t\t\tif createFunction && _.isString(createFunction)\n\t\t\t\t\tfield.createFunction = Creator.eval(\"(#{createFunction})\")\n\n\t\t\t\tif beforeOpenFunction && _.isString(beforeOpenFunction)\n\t\t\t\t\tfield.beforeOpenFunction = Creator.eval(\"(#{beforeOpenFunction})\")\n\n\t\t\t\tif filtersFunction && _.isString(filtersFunction)\n\t\t\t\t\tfield.filtersFunction = Creator.eval(\"(#{filtersFunction})\")\n\n\t\t\tif Meteor.isServer\n\t\t\t\tdefaultValue = field.defaultValue\n\t\t\t\tif defaultValue && _.isFunction(defaultValue)\n\t\t\t\t\tfield._defaultValue = field.defaultValue.toString()\n\t\t\telse\n\t\t\t\tdefaultValue = field._defaultValue\n\n\t\t\t\tif !defaultValue && _.isString(field.defaultValue) && field.defaultValue.startsWith(\"function\")\n\t\t\t\t\tdefaultValue = field.defaultValue\n\n\t\t\t\tif defaultValue && _.isString(defaultValue)\n\t\t\t\t\ttry\n\t\t\t\t\t\tfield.defaultValue = Creator.eval(\"(#{defaultValue})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\n\t\t\t\n\t\t\tif Meteor.isServer\n\t\t\t\tis_company_limited = field.is_company_limited\n\t\t\t\tif is_company_limited && _.isFunction(is_company_limited)\n\t\t\t\t\tfield._is_company_limited = field.is_company_limited.toString()\n\t\t\telse\n\t\t\t\tis_company_limited = field._is_company_limited\n\t\t\t\tif is_company_limited && _.isString(is_company_limited)\n\t\t\t\t\ttry\n\t\t\t\t\t\tfield.is_company_limited = Creator.eval(\"(#{is_company_limited})\")\n\t\t\t\t\tcatch error\n\t\t\t\t\t\tconsole.error \"convert error #{object.name} -> #{field.name}\", error\n\n\t\t_.forEach object.list_views, (list_view, key) ->\n\t\t\t###\n\t\t\tè§†å›¾è¿‡è™‘å™¨éœ€è¦æ”¯æŒfunctionï¼ŒåŽå°è½¬æˆå­—ç¬¦ä¸²ï¼Œå‰å°evalæˆå‡½æ•°\n\t\t\tè®©è¿‡è™‘å™¨æ”¯æŒä¸¤ç§functionæ–¹å¼ï¼š\n\t\t\t1. æ•´ä¸ªfiltersä¸ºfunction:\n\t\t\tå¦‚ï¼š\n\t\t\tfilters: ()->\n\t\t\t\treturn [[[\"object_name\",\"=\",\"project_issues\"],'or',[\"object_name\",\"=\",\"tasks\"]]]\n\t\t\t2. filterså†…çš„filter.valueä¸ºfunction\n\t\t\tå¦‚ï¼š\n\t\t\tfilters: [[\"object_name\", \"=\", ()->\n\t\t\t\treturn \"project_issues\"\n\t\t\t]]\n\t\t\tæˆ–\n\t\t\tfilters: [{\n\t\t\t\t\"field\": \"object_name\"\n\t\t\t\t\"operation\": \"=\"\n\t\t\t\t\"value\": ()->\n\t\t\t\t\treturn \"project_issues\"\n\t\t\t}]\n\t\t\t###\n\t\t\tif _.isFunction(list_view.filters)\n\t\t\t\tif Meteor.isServer\n\t\t\t\t\tlist_view._filters = list_view.filters.toString()\n\t\t\telse if _.isString(list_view._filters)\n\t\t\t\tif Meteor.isClient\n\t\t\t\t\tlist_view.filters = Creator.eval(\"(#{list_view._filters})\")\n\t\t\telse\n\t\t\t\t_.forEach list_view.filters, (filter, _index)->\n\t\t\t\t\tif _.isArray(filter)\n\t\t\t\t\t\tif Meteor.isServer\n\t\t\t\t\t\t\tif filter.length == 3 and _.isFunction(filter[2])\n\t\t\t\t\t\t\t\tfilter[2] = filter[2].toString()\n\t\t\t\t\t\t\t\tfilter[3] = \"FUNCTION\"\n\t\t\t\t\t\t\telse if filter.length == 3 and _.isDate(filter[2])\n\t\t\t\t\t\t\t\t# å¦‚æžœæ˜¯Dateç±»åž‹ï¼Œåˆ™filter[2]å€¼åˆ°å‰ç«¯ä¼šè‡ªåŠ¨è½¬æˆå­—ç¬¦ä¸²ï¼Œæ ¼å¼ï¼š\"2018-03-29T03:43:21.787Z\"\n\t\t\t\t\t\t\t\t# åŒ…æ‹¬gridåˆ—è¡¨è¯·æ±‚çš„æŽ¥å£åœ¨å†…çš„æ‰€æœ‰ODataæŽ¥å£ï¼ŒDateç±»åž‹å­—æ®µéƒ½ä¼šä»¥ä¸Šè¿°æ ¼å¼è¿”å›ž\n\t\t\t\t\t\t\t\tfilter[3] = \"DATE\"\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tif filter.length == 4 and _.isString(filter[2]) and filter[3] == \"FUNCTION\"\n\t\t\t\t\t\t\t\tfilter[2] = Creator.eval(\"(#{filter[2]})\")\n\t\t\t\t\t\t\t\tfilter.pop()\n\t\t\t\t\t\t\tif filter.length == 4 and _.isString(filter[2]) and filter[3] == \"DATE\"\n\t\t\t\t\t\t\t\tfilter[2] = new Date(filter[2])\n\t\t\t\t\t\t\t\tfilter.pop()\n\t\t\t\t\telse if _.isObject(filter)\n\t\t\t\t\t\tif Meteor.isServer\n\t\t\t\t\t\t\tif _.isFunction(filter?.value)\n\t\t\t\t\t\t\t\tfilter._value = filter.value.toString()\n\t\t\t\t\t\t\telse if _.isDate(filter?.value)\n\t\t\t\t\t\t\t\tfilter._is_date = true\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tif _.isString(filter?._value)\n\t\t\t\t\t\t\t\tfilter.value = Creator.eval(\"(#{filter._value})\")\n\t\t\t\t\t\t\telse if filter._is_date == true\n\t\t\t\t\t\t\t\tfilter.value = new Date(filter.value)\n\n\t\tif Meteor.isServer\n\t\t\tif object.form && !_.isString(object.form)\n\t\t\t\tobject.form = JSON.stringify object.form, (key, val)->\n\t\t\t\t\tif _.isFunction(val)\n\t\t\t\t\t\treturn val + '';\n\t\t\t\t\telse\n\t\t\t\t\t\treturn val;\n\t\telse if Meteor.isClient\n\t\t\tif object.form\n\t\t\t\tobject.form = JSON.parse object.form, (key, val)->\n\t\t\t\t\tif _.isString(val) && val.startsWith('function')\n\t\t\t\t\t\treturn Creator.eval(\"(#{val})\")\n\t\t\t\t\telse\n\t\t\t\t\t\treturn val;\n\n\t\tif Meteor.isClient\n\t\t\t_.forEach object.related_lists, (relatedObjInfo)->\n\t\t\t\tif _.isObject(relatedObjInfo)\n\t\t\t\t\t_.forEach relatedObjInfo, (val, key)->\n\t\t\t\t\t\tif key == 'filters' && _.isString(val)\n\t\t\t\t\t\t\ttry\n\t\t\t\t\t\t\t\trelatedObjInfo[key] = Creator.eval(\"(#{val})\")\n\t\t\t\t\t\t\tcatch error\n\t\t\t\t\t\t\t\tconsole.error \"filters_code\", val\n\t\telse\n\t\t\t_.forEach object.related_lists, (relatedObjInfo)->\n\t\t\t\tif _.isObject(relatedObjInfo)\n\t\t\t\t\t_.forEach relatedObjInfo, (val, key)->\n\t\t\t\t\t\tif key == 'filters' && _.isFunction(val)\n\t\t\t\t\t\t\trelatedObjInfo[key] = val.toString()\n\n\t\tif Meteor.isClient\n\t\t\t_.forEach object.relatedList, (relatedObjInfo)->\n\t\t\t\tif _.isObject(relatedObjInfo)\n\t\t\t\t\t_.forEach relatedObjInfo, (val, key)->\n\t\t\t\t\t\tif key == 'filters' && _.isString(val)\n\t\t\t\t\t\t\ttry\n\t\t\t\t\t\t\t\trelatedObjInfo[key] = Creator.eval(\"(#{val})\")\n\t\t\t\t\t\t\tcatch error\n\t\t\t\t\t\t\t\tconsole.error \"filters_code\", val\n\t\telse\n\t\t\t_.forEach object.relatedList, (relatedObjInfo)->\n\t\t\t\tif _.isObject(relatedObjInfo)\n\t\t\t\t\t_.forEach relatedObjInfo, (val, key)->\n\t\t\t\t\t\tif key == 'filters' && _.isFunction(val)\n\t\t\t\t\t\t\trelatedObjInfo[key] = val.toString()\n\n\t\treturn object\n\n\n","var convertField, getOption;\n\ngetOption = function(option) {\n  var foo;\n  foo = option.split(\":\");\n  if (foo.length > 2) {\n    return {\n      label: foo[0],\n      value: foo[1],\n      color: foo[2]\n    };\n  } else if (foo.length > 1) {\n    return {\n      label: foo[0],\n      value: foo[1]\n    };\n  } else {\n    return {\n      label: foo[0],\n      value: foo[0]\n    };\n  }\n};\n\nconvertField = function(object_name, field_name, field, spaceId) {\n  var allOptions, code, options, picklist, picklistOptions, ref;\n  if (Meteor.isServer && spaceId && field.type === 'select') {\n    code = field.picklist || (object_name + \".\" + field_name);\n    if (code) {\n      picklist = Creator.getPicklist(code, spaceId);\n      if (picklist) {\n        options = [];\n        allOptions = [];\n        picklistOptions = Creator.getPickListOptions(picklist);\n        picklistOptions = (ref = _.sortBy(picklistOptions, 'sort_no')) != null ? ref.reverse() : void 0;\n        _.each(picklistOptions, function(item) {\n          var label, value;\n          label = item.name;\n          value = item.value || item.name;\n          allOptions.push({\n            label: label,\n            value: value,\n            enable: item.enable,\n            color: item.color\n          });\n          if (item.enable) {\n            options.push({\n              label: label,\n              value: value,\n              color: item.color\n            });\n          }\n          if (item[\"default\"]) {\n            return field.defaultValue = value;\n          }\n        });\n        if (options.length > 0) {\n          field.options = options;\n        }\n        if (allOptions.length > 0) {\n          field.allOptions = allOptions;\n        }\n      }\n    }\n  }\n  return field;\n};\n\nCreator.convertObject = function(object, spaceId) {\n  if (!object) {\n    return;\n  }\n  _.forEach(object.triggers, function(trigger, key) {\n    var _todo, _todo_from_code, _todo_from_db;\n    if ((Meteor.isServer && trigger.on === \"server\") || (Meteor.isClient && trigger.on === \"client\")) {\n      _todo_from_code = trigger != null ? trigger._todo : void 0;\n      _todo_from_db = trigger.todo;\n      if (_todo_from_code && _.isString(_todo_from_code)) {\n        trigger.todo = Creator[\"eval\"](\"(\" + _todo_from_code + \")\");\n      }\n      if (_todo_from_db && _.isString(_todo_from_db)) {\n        if (_todo_from_db.startsWith(\"function\")) {\n          trigger.todo = Creator[\"eval\"](\"(\" + _todo_from_db + \")\");\n        } else {\n          trigger.todo = Creator[\"eval\"](\"(function(userId, doc, fieldNames, modifier, options){\" + _todo_from_db + \"})\");\n        }\n      }\n    }\n    if (Meteor.isServer && trigger.on === \"client\") {\n      _todo = trigger.todo;\n      if (_todo && _.isFunction(_todo)) {\n        return trigger._todo = _todo.toString();\n      }\n    }\n  });\n  if (Meteor.isClient) {\n    _.forEach(object.fields, function(field, key) {\n      var systemBaseFields;\n      if (field.omit) {\n        field.hidden = true;\n      }\n      if (field.required && field.readonly) {\n        field.readonly = false;\n      }\n      systemBaseFields = Creator.getSystemBaseFields();\n      if (systemBaseFields.indexOf(key) > -1) {\n        return field.readonly = true;\n      }\n    });\n    _.forEach(object.actions, function(action, key) {\n      var _todo_from_code, _todo_from_db, _visible, error;\n      _todo_from_code = action != null ? action._todo : void 0;\n      _todo_from_db = action != null ? action.todo : void 0;\n      if (_todo_from_code && _.isString(_todo_from_code)) {\n        try {\n          action.todo = Creator[\"eval\"](\"(\" + _todo_from_code + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"todo_from_code\", _todo_from_code);\n        }\n      }\n      if (_todo_from_db && _.isString(_todo_from_db)) {\n        try {\n          if (_todo_from_db.startsWith(\"function\")) {\n            action.todo = Creator[\"eval\"](\"(\" + _todo_from_db + \")\");\n          } else {\n            if (_.isFunction(Creator.actionsByName[_todo_from_db])) {\n              action.todo = _todo_from_db;\n            } else {\n              action.todo = Creator[\"eval\"](\"(function(){\" + _todo_from_db + \"})\");\n            }\n          }\n        } catch (error1) {\n          error = error1;\n          console.error(\"todo_from_db\", _todo_from_db, error);\n        }\n      }\n      _visible = action != null ? action._visible : void 0;\n      if (_visible) {\n        try {\n          if (_.isString(_visible)) {\n            _visible = _visible.trim();\n          }\n          if (Steedos.isExpression(_visible)) {\n            return action.visible = function(object_name, record_id, record_permissions, record) {\n              var globalData;\n              globalData = Object.assign({}, Creator.USER_CONTEXT, {\n                now: new Date()\n              });\n              return Steedos.parseSingleExpression(_visible, record, \"#\", globalData);\n            };\n          } else {\n            return action.visible = Creator[\"eval\"](\"(\" + _visible + \")\");\n          }\n        } catch (error1) {\n          error = error1;\n          return console.error(\"action.visible to function error: \", error, _visible);\n        }\n      }\n    });\n  } else {\n    _.forEach(object.actions, function(action, key) {\n      var _todo, _visible;\n      _todo = action != null ? action.todo : void 0;\n      if (_todo && _.isFunction(_todo)) {\n        action._todo = _todo.toString();\n      }\n      _visible = action != null ? action.visible : void 0;\n      if (_visible && _.isFunction(_visible)) {\n        return action._visible = _visible.toString();\n      }\n    });\n  }\n  _.forEach(object.fields, function(field, key) {\n    var _options, _type, beforeOpenFunction, createFunction, defaultValue, error, filtersFunction, is_company_limited, max, min, options, optionsFunction, reference_to, regEx;\n    field = convertField(object.name, key, field, spaceId);\n    if (field.options && _.isString(field.options)) {\n      try {\n        _options = [];\n        _.forEach(field.options.split(\"\\n\"), function(option) {\n          var options;\n          if (option.indexOf(\",\")) {\n            options = option.split(\",\");\n            return _.forEach(options, function(_option) {\n              return _options.push(getOption(_option));\n            });\n          } else {\n            return _options.push(getOption(option));\n          }\n        });\n        field.options = _options;\n      } catch (error1) {\n        error = error1;\n        console.error(\"Creator.convertFieldsOptions\", field.options, error);\n      }\n    } else if (field.options && _.isArray(field.options)) {\n      try {\n        _options = [];\n        _.forEach(field.options, function(option) {\n          if (_.isString(option)) {\n            return _options.push(getOption(option));\n          } else {\n            return _options.push(option);\n          }\n        });\n        field.options = _options;\n      } catch (error1) {\n        error = error1;\n        console.error(\"Creator.convertFieldsOptions\", field.options, error);\n      }\n    } else if (field.options && !_.isFunction(field.options) && !_.isArray(field.options) && _.isObject(field.options)) {\n      _options = [];\n      _.each(field.options, function(v, k) {\n        return _options.push({\n          label: v,\n          value: k\n        });\n      });\n      field.options = _options;\n    }\n    if (Meteor.isServer) {\n      options = field.options;\n      if (options && _.isFunction(options)) {\n        field._options = field.options.toString();\n      }\n    } else {\n      options = field._options;\n      if (options && _.isString(options)) {\n        try {\n          field.options = Creator[\"eval\"](\"(\" + options + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      regEx = field.regEx;\n      if (regEx) {\n        field._regEx = field.regEx.toString();\n      }\n    } else {\n      regEx = field._regEx;\n      if (regEx) {\n        try {\n          field.regEx = Creator[\"eval\"](\"(\" + regEx + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      min = field.min;\n      if (_.isFunction(min)) {\n        field._min = min.toString();\n      }\n    } else {\n      min = field._min;\n      if (_.isString(min)) {\n        try {\n          field.min = Creator[\"eval\"](\"(\" + min + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      max = field.max;\n      if (_.isFunction(max)) {\n        field._max = max.toString();\n      }\n    } else {\n      max = field._max;\n      if (_.isString(max)) {\n        try {\n          field.max = Creator[\"eval\"](\"(\" + max + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      if (field.autoform) {\n        _type = field.autoform.type;\n        if (_type && _.isFunction(_type) && _type !== Object && _type !== String && _type !== Number && _type !== Boolean && !_.isArray(_type)) {\n          field.autoform._type = _type.toString();\n        }\n      }\n    } else {\n      if (field.autoform) {\n        _type = field.autoform._type;\n        if (_type && _.isString(_type)) {\n          try {\n            field.autoform.type = Creator[\"eval\"](\"(\" + _type + \")\");\n          } catch (error1) {\n            error = error1;\n            console.error(\"convert field -> type error\", field, error);\n          }\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      optionsFunction = field.optionsFunction;\n      reference_to = field.reference_to;\n      createFunction = field.createFunction;\n      beforeOpenFunction = field.beforeOpenFunction;\n      filtersFunction = field.filtersFunction;\n      if (optionsFunction && _.isFunction(optionsFunction)) {\n        field._optionsFunction = optionsFunction.toString();\n      }\n      if (reference_to && _.isFunction(reference_to)) {\n        field._reference_to = reference_to.toString();\n      }\n      if (createFunction && _.isFunction(createFunction)) {\n        field._createFunction = createFunction.toString();\n      }\n      if (beforeOpenFunction && _.isFunction(beforeOpenFunction)) {\n        field._beforeOpenFunction = beforeOpenFunction.toString();\n      }\n      if (filtersFunction && _.isFunction(filtersFunction)) {\n        field._filtersFunction = filtersFunction.toString();\n      }\n    } else {\n      optionsFunction = field._optionsFunction || field.optionsFunction;\n      reference_to = field._reference_to;\n      createFunction = field._createFunction;\n      beforeOpenFunction = field._beforeOpenFunction;\n      filtersFunction = field._filtersFunction || field.filtersFunction;\n      if (optionsFunction && _.isString(optionsFunction)) {\n        field.optionsFunction = Creator[\"eval\"](\"(\" + optionsFunction + \")\");\n      }\n      if (reference_to && _.isString(reference_to)) {\n        field.reference_to = Creator[\"eval\"](\"(\" + reference_to + \")\");\n      }\n      if (createFunction && _.isString(createFunction)) {\n        field.createFunction = Creator[\"eval\"](\"(\" + createFunction + \")\");\n      }\n      if (beforeOpenFunction && _.isString(beforeOpenFunction)) {\n        field.beforeOpenFunction = Creator[\"eval\"](\"(\" + beforeOpenFunction + \")\");\n      }\n      if (filtersFunction && _.isString(filtersFunction)) {\n        field.filtersFunction = Creator[\"eval\"](\"(\" + filtersFunction + \")\");\n      }\n    }\n    if (Meteor.isServer) {\n      defaultValue = field.defaultValue;\n      if (defaultValue && _.isFunction(defaultValue)) {\n        field._defaultValue = field.defaultValue.toString();\n      }\n    } else {\n      defaultValue = field._defaultValue;\n      if (!defaultValue && _.isString(field.defaultValue) && field.defaultValue.startsWith(\"function\")) {\n        defaultValue = field.defaultValue;\n      }\n      if (defaultValue && _.isString(defaultValue)) {\n        try {\n          field.defaultValue = Creator[\"eval\"](\"(\" + defaultValue + \")\");\n        } catch (error1) {\n          error = error1;\n          console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n    if (Meteor.isServer) {\n      is_company_limited = field.is_company_limited;\n      if (is_company_limited && _.isFunction(is_company_limited)) {\n        return field._is_company_limited = field.is_company_limited.toString();\n      }\n    } else {\n      is_company_limited = field._is_company_limited;\n      if (is_company_limited && _.isString(is_company_limited)) {\n        try {\n          return field.is_company_limited = Creator[\"eval\"](\"(\" + is_company_limited + \")\");\n        } catch (error1) {\n          error = error1;\n          return console.error(\"convert error \" + object.name + \" -> \" + field.name, error);\n        }\n      }\n    }\n  });\n  _.forEach(object.list_views, function(list_view, key) {\n\n    /*\n    \t\t\tè§†å›¾è¿‡è™‘å™¨éœ€è¦æ”¯æŒfunctionï¼ŒåŽå°è½¬æˆå­—ç¬¦ä¸²ï¼Œå‰å°evalæˆå‡½æ•°\n    \t\t\tè®©è¿‡è™‘å™¨æ”¯æŒä¸¤ç§functionæ–¹å¼ï¼š\n    \t\t\t1. æ•´ä¸ªfiltersä¸ºfunction:\n    \t\t\tå¦‚ï¼š\n    \t\t\tfilters: ()->\n    \t\t\t\treturn [[[\"object_name\",\"=\",\"project_issues\"],'or',[\"object_name\",\"=\",\"tasks\"]]]\n    \t\t\t2. filterså†…çš„filter.valueä¸ºfunction\n    \t\t\tå¦‚ï¼š\n    \t\t\tfilters: [[\"object_name\", \"=\", ()->\n    \t\t\t\treturn \"project_issues\"\n    \t\t\t]]\n    \t\t\tæˆ–\n    \t\t\tfilters: [{\n    \t\t\t\t\"field\": \"object_name\"\n    \t\t\t\t\"operation\": \"=\"\n    \t\t\t\t\"value\": ()->\n    \t\t\t\t\treturn \"project_issues\"\n    \t\t\t}]\n     */\n    if (_.isFunction(list_view.filters)) {\n      if (Meteor.isServer) {\n        return list_view._filters = list_view.filters.toString();\n      }\n    } else if (_.isString(list_view._filters)) {\n      if (Meteor.isClient) {\n        return list_view.filters = Creator[\"eval\"](\"(\" + list_view._filters + \")\");\n      }\n    } else {\n      return _.forEach(list_view.filters, function(filter, _index) {\n        if (_.isArray(filter)) {\n          if (Meteor.isServer) {\n            if (filter.length === 3 && _.isFunction(filter[2])) {\n              filter[2] = filter[2].toString();\n              return filter[3] = \"FUNCTION\";\n            } else if (filter.length === 3 && _.isDate(filter[2])) {\n              return filter[3] = \"DATE\";\n            }\n          } else {\n            if (filter.length === 4 && _.isString(filter[2]) && filter[3] === \"FUNCTION\") {\n              filter[2] = Creator[\"eval\"](\"(\" + filter[2] + \")\");\n              filter.pop();\n            }\n            if (filter.length === 4 && _.isString(filter[2]) && filter[3] === \"DATE\") {\n              filter[2] = new Date(filter[2]);\n              return filter.pop();\n            }\n          }\n        } else if (_.isObject(filter)) {\n          if (Meteor.isServer) {\n            if (_.isFunction(filter != null ? filter.value : void 0)) {\n              return filter._value = filter.value.toString();\n            } else if (_.isDate(filter != null ? filter.value : void 0)) {\n              return filter._is_date = true;\n            }\n          } else {\n            if (_.isString(filter != null ? filter._value : void 0)) {\n              return filter.value = Creator[\"eval\"](\"(\" + filter._value + \")\");\n            } else if (filter._is_date === true) {\n              return filter.value = new Date(filter.value);\n            }\n          }\n        }\n      });\n    }\n  });\n  if (Meteor.isServer) {\n    if (object.form && !_.isString(object.form)) {\n      object.form = JSON.stringify(object.form, function(key, val) {\n        if (_.isFunction(val)) {\n          return val + '';\n        } else {\n          return val;\n        }\n      });\n    }\n  } else if (Meteor.isClient) {\n    if (object.form) {\n      object.form = JSON.parse(object.form, function(key, val) {\n        if (_.isString(val) && val.startsWith('function')) {\n          return Creator[\"eval\"](\"(\" + val + \")\");\n        } else {\n          return val;\n        }\n      });\n    }\n  }\n  if (Meteor.isClient) {\n    _.forEach(object.related_lists, function(relatedObjInfo) {\n      if (_.isObject(relatedObjInfo)) {\n        return _.forEach(relatedObjInfo, function(val, key) {\n          var error;\n          if (key === 'filters' && _.isString(val)) {\n            try {\n              return relatedObjInfo[key] = Creator[\"eval\"](\"(\" + val + \")\");\n            } catch (error1) {\n              error = error1;\n              return console.error(\"filters_code\", val);\n            }\n          }\n        });\n      }\n    });\n  } else {\n    _.forEach(object.related_lists, function(relatedObjInfo) {\n      if (_.isObject(relatedObjInfo)) {\n        return _.forEach(relatedObjInfo, function(val, key) {\n          if (key === 'filters' && _.isFunction(val)) {\n            return relatedObjInfo[key] = val.toString();\n          }\n        });\n      }\n    });\n  }\n  if (Meteor.isClient) {\n    _.forEach(object.relatedList, function(relatedObjInfo) {\n      if (_.isObject(relatedObjInfo)) {\n        return _.forEach(relatedObjInfo, function(val, key) {\n          var error;\n          if (key === 'filters' && _.isString(val)) {\n            try {\n              return relatedObjInfo[key] = Creator[\"eval\"](\"(\" + val + \")\");\n            } catch (error1) {\n              error = error1;\n              return console.error(\"filters_code\", val);\n            }\n          }\n        });\n      }\n    });\n  } else {\n    _.forEach(object.relatedList, function(relatedObjInfo) {\n      if (_.isObject(relatedObjInfo)) {\n        return _.forEach(relatedObjInfo, function(val, key) {\n          if (key === 'filters' && _.isFunction(val)) {\n            return relatedObjInfo[key] = val.toString();\n          }\n        });\n      }\n    });\n  }\n  return object;\n};\n","Creator.Formular = {}\n\nCreator.Formular.PREFIX = \"_VALUES\"\n\nCreator.Formular._prependPrefixForFormula = (prefix,fieldVariable)->\n\treg = /(\\{[^{}]*\\})/g;\n\n\trev = fieldVariable.replace reg, (m, $1)->\n\t\treturn prefix + $1.replace(/\\{\\s*/,\"[\\\"\").replace(/\\s*\\}/,\"\\\"]\").replace(/\\s*\\.\\s*/g,\"\\\"][\\\"\");\n\n\treturn rev\n\nCreator.Formular.checkFormula = (formula_str)->\n\tif _.isString(formula_str) && formula_str.indexOf(\"{\") > -1 && formula_str.indexOf(\"}\") > -1\n\t\treturn true\n\treturn false\n\nCreator.Formular.run = (formula_str, _CONTEXT, options)->\n\tif formula_str && _.isString(formula_str)\n\n\t\tif !_.isBoolean(options?.extend)\n\t\t\textend = true\n\n\t\t_VALUES = {}\n\t\t_VALUES = _.extend(_VALUES, _CONTEXT)\n\t\tif extend\n\t\t\t_VALUES = _.extend(_VALUES, Creator.getUserContext(options?.userId, options?.spaceId))\n\t\tformula_str = Creator.Formular._prependPrefixForFormula(\"this\", formula_str)\n\n\t\ttry\n\t\t\tdata = Creator.evalInContext(formula_str, _VALUES)   # æ­¤å¤„ä¸èƒ½ç”¨window.eval ï¼Œä¼šå¯¼è‡´å˜é‡ä½œç”¨åŸŸå¼‚å¸¸\n\t\t\treturn data\n\t\tcatch e\n\t\t\tconsole.error(\"Creator.Formular.run: #{formula_str}\", e)\n\t\t\tif Meteor.isClient\n\t\t\t\ttoastr?.error(\"å…¬å¼æ‰§è¡Œå‡ºé”™äº†ï¼Œè¯·æ£€æŸ¥å…¬å¼é…ç½®æ˜¯å¦æ­£ç¡®ï¼\")\n\t\t\tthrow new Meteor.Error 500, \"Creator.Formular.run: #{formula_str}#{e}\"\n\n\treturn formula_str\n","Creator.Formular = {};\n\nCreator.Formular.PREFIX = \"_VALUES\";\n\nCreator.Formular._prependPrefixForFormula = function(prefix, fieldVariable) {\n  var reg, rev;\n  reg = /(\\{[^{}]*\\})/g;\n  rev = fieldVariable.replace(reg, function(m, $1) {\n    return prefix + $1.replace(/\\{\\s*/, \"[\\\"\").replace(/\\s*\\}/, \"\\\"]\").replace(/\\s*\\.\\s*/g, \"\\\"][\\\"\");\n  });\n  return rev;\n};\n\nCreator.Formular.checkFormula = function(formula_str) {\n  if (_.isString(formula_str) && formula_str.indexOf(\"{\") > -1 && formula_str.indexOf(\"}\") > -1) {\n    return true;\n  }\n  return false;\n};\n\nCreator.Formular.run = function(formula_str, _CONTEXT, options) {\n  var _VALUES, data, e, extend;\n  if (formula_str && _.isString(formula_str)) {\n    if (!_.isBoolean(options != null ? options.extend : void 0)) {\n      extend = true;\n    }\n    _VALUES = {};\n    _VALUES = _.extend(_VALUES, _CONTEXT);\n    if (extend) {\n      _VALUES = _.extend(_VALUES, Creator.getUserContext(options != null ? options.userId : void 0, options != null ? options.spaceId : void 0));\n    }\n    formula_str = Creator.Formular._prependPrefixForFormula(\"this\", formula_str);\n    try {\n      data = Creator.evalInContext(formula_str, _VALUES);\n      return data;\n    } catch (error) {\n      e = error;\n      console.error(\"Creator.Formular.run: \" + formula_str, e);\n      if (Meteor.isClient) {\n        if (typeof toastr !== \"undefined\" && toastr !== null) {\n          toastr.error(\"å…¬å¼æ‰§è¡Œå‡ºé”™äº†ï¼Œè¯·æ£€æŸ¥å…¬å¼é…ç½®æ˜¯å¦æ­£ç¡®ï¼\");\n        }\n      }\n      throw new Meteor.Error(500, \"Creator.Formular.run: \" + formula_str + e);\n    }\n  }\n  return formula_str;\n};\n","clone = require('clone');\nCreator.objectsByName = {}   # æ­¤å¯¹è±¡åªèƒ½åœ¨ç¡®ä¿æ‰€æœ‰Objectåˆå§‹åŒ–å®ŒæˆåŽè°ƒç”¨ï¼Œ å¦åˆ™èŽ·å–åˆ°çš„objectä¸å…¨\n\nCreator.formatObjectName = (object_name)->\n\tif object_name.startsWith('cfs.files.')\n\t\tobject_name = object_name.replace(new RegExp('\\\\.', 'g'), '_')\n\treturn object_name\n\nCreator.Object = (options)->\n\t_baseObject = Creator.baseObject\n\tif Meteor.isClient\n\t\t_baseObject = {actions: Creator.baseObject.actions , fields: {}, triggers: {}, permission_set: {}}\n\tself = this\n\tif (!options.name)\n\t\tconsole.error(options)\n\t\tthrow new Error('Creator.Object options must specify name');\n\n\tself._id = options._id || options.name\n\tself.space = options.space\n\tself.name = options.name\n\tself.label = options.label\n\tself.icon = options.icon\n\tself.description = options.description\n\tself.is_view = options.is_view\n\tself.form = options.form\n\tself.relatedList = options.relatedList\n\tself.related_lists = options.related_lists\n\tself.version = options.version || 1.0\n\tif !_.isBoolean(options.is_enable)  || options.is_enable == true\n\t\tself.is_enable = true\n\telse\n\t\tself.is_enable = false\n\tif Meteor.isClient\n\t\tif _.has(options, 'allow_customActions')\n\t\t\tself.allow_customActions = options.allow_customActions\n\t\tif _.has(options, 'exclude_actions')\n\t\t\tself.exclude_actions = options.exclude_actions\n\t\tif _.has(options, 'allow_relatedList')\n\t\t\tself.allow_relatedList = options.allow_relatedList\n\tself.enable_search = options.enable_search\n\tself.enable_files = options.enable_files\n\tself.enable_tasks = options.enable_tasks\n\tself.enable_notes = options.enable_notes\n\tself.enable_audit = options.enable_audit\n\tself.enable_events = options.enable_events\n\tif options.paging\n\t\tself.paging = options.paging\n\tself.hidden = options.hidden\n\tself.enable_api = (options.enable_api == undefined) or options.enable_api\n\tself.custom = options.custom\n\tself.enable_share = options.enable_share\n\tself.enable_instances = options.enable_instances\n\tself.enable_process = options.enable_process\n\tif Meteor.isClient\n\t\tif Creator.isCloudAdminSpace(Session.get(\"spaceId\"))\n\t\t\tself.enable_tree = false\n\t\telse\n\t\t\tself.enable_tree = options.enable_tree\n\t\t\tself.sidebar = _.clone(options.sidebar)\n\telse\n\t\tself.sidebar = _.clone(options.sidebar)\n\t\tself.enable_tree = options.enable_tree\n\tself.open_window = options.open_window\n\tself.filter_company = options.filter_company\n\tself.calendar = _.clone(options.calendar)\n\tself.enable_chatter = options.enable_chatter\n\tself.enable_trash = options.enable_trash\n\tself.enable_space_global = options.enable_space_global\n\tself.enable_approvals = options.enable_approvals\n\tself.enable_follow = options.enable_follow\n\tself.enable_workflow = options.enable_workflow\n\tself.enable_inline_edit = options.enable_inline_edit\n\tself.details = options.details\n\tself.masters = options.masters\n\tself.lookup_details = options.lookup_details\n\tif _.has(options, 'in_development')\n\t\tself.in_development = options.in_development\n\tself.idFieldName = '_id'\n\tif options.database_name\n\t\tself.database_name = options.database_name\n\tif (!options.fields)\n\t\tconsole.error(options)\n\t\tthrow new Error('Creator.Object options must specify fields');\n\n\tself.fields = clone(options.fields)\n\n\t_.each self.fields, (field, field_name)->\n\t\tif field.is_name\n\t\t\tself.NAME_FIELD_KEY = field_name\n\t\telse if field_name == 'name' && !self.NAME_FIELD_KEY\n\t\t\tself.NAME_FIELD_KEY = field_name\n\t\tif field.primary\n\t\t\tself.idFieldName = field_name\n\t\tif Meteor.isClient\n\t\t\tif Creator.isCloudAdminSpace(Session.get(\"spaceId\"))\n\t\t\t\tif field_name == 'space'\n\t\t\t\t\tfield.filterable = true\n\t\t\t\t\tfield.hidden = false\n\n\tif !options.database_name || options.database_name == 'meteor-mongo'\n\t\t_.each _baseObject.fields, (field, field_name)->\n\t\t\tif !self.fields[field_name]\n\t\t\t\tself.fields[field_name] = {}\n\t\t\tself.fields[field_name] = _.extend(_.clone(field), self.fields[field_name])\n\n\t_.each self.fields, (field, field_name)->\n\t\tif field.type == 'autonumber'\n\t\t\tfield.readonly = true\n\t\telse if field.type == 'formula'\n\t\t\tfield.readonly = true\n\t\telse if field.type == 'summary'\n\t\t\tfield.readonly = true\n\n\tself.list_views = {}\n\tdefaultView = Creator.getObjectDefaultView(self.name)\n\t_.each options.list_views, (item, item_name)->\n\t\toitem = Creator.convertListView(defaultView, item, item_name)\n\t\tself.list_views[item_name] = oitem\n\n\tself.triggers = _.clone(_baseObject.triggers)\n\t_.each options.triggers, (item, item_name)->\n\t\tif !self.triggers[item_name]\n\t\t\tself.triggers[item_name] = {}\n\t\tself.triggers[item_name].name = item_name\n\t\tself.triggers[item_name] = _.extend(_.clone(self.triggers[item_name]), item)\n\n\tself.actions = _.clone(_baseObject.actions)\n\t_.each options.actions, (item, item_name)->\n\t\tif !self.actions[item_name]\n\t\t\tself.actions[item_name] = {}\n\t\tcopyItem = _.clone(self.actions[item_name])\n\t\tdelete self.actions[item_name] #å…ˆåˆ é™¤ç›¸å…³å±žæ€§å†é‡å»ºæ‰èƒ½ä¿è¯åŽç»­é‡å¤å®šä¹‰çš„å±žæ€§é¡ºåºç”Ÿæ•ˆ\n\t\tself.actions[item_name] = _.extend(copyItem, item)\n\n\t_.each self.actions, (item, item_name)->\n\t\titem.name = item_name\n\n\tself.related_objects = Creator.getObjectRelateds(self.name)\n\n\t# è®©æ‰€æœ‰objecté»˜è®¤æœ‰æ‰€æœ‰list_views/actions/related_objects/readable_fields/editable_fieldså®Œæ•´æƒé™ï¼Œè¯¥æƒé™å¯èƒ½è¢«æ•°æ®åº“ä¸­è®¾ç½®çš„admin/useræƒé™è¦†ç›–\n\tself.permission_set = _.clone(_baseObject.permission_set)\n\t# defaultListViews = _.keys(self.list_views)\n\t# defaultActions = _.keys(self.actions)\n\t# defaultRelatedObjects = _.pluck(self.related_objects,\"object_name\")\n\t# defaultReadableFields = []\n\t# defaultEditableFields = []\n\t# _.each self.fields, (field, field_name)->\n\t# \tif !(field.hidden)    #231 omitå­—æ®µæ”¯æŒåœ¨éžç¼–è¾‘é¡µé¢æŸ¥çœ‹, å› æ­¤åˆ é™¤äº†æ­¤å¤„å¯¹omitçš„åˆ¤æ–­\n\t# \t\tdefaultReadableFields.push field_name\n\t# \t\tif !field.readonly\n\t# \t\t\tdefaultEditableFields.push field_name\n\n\t# _.each self.permission_set, (item, item_name)->\n\t# \tif item_name == \"none\"\n\t# \t\treturn\n\t# \tif self.list_views\n\t# \t\tself.permission_set[item_name].list_views = defaultListViews\n\t# \tif self.actions\n\t# \t\tself.permission_set[item_name].actions = defaultActions\n\t# \tif self.related_objects\n\t# \t\tself.permission_set[item_name].related_objects = defaultRelatedObjects\n\t# \tif self.fields\n\t# \t\tself.permission_set[item_name].readable_fields = defaultReadableFields\n\t# \t\tself.permission_set[item_name].editable_fields = defaultEditableFields\n\tunless options.permission_set\n\t\toptions.permission_set = {}\n\tif !(options.permission_set?.admin)\n\t\toptions.permission_set.admin = _.clone(self.permission_set[\"admin\"])\n\tif !(options.permission_set?.user)\n\t\toptions.permission_set.user = _.clone(self.permission_set[\"user\"])\n\t_.each options.permission_set, (item, item_name)->\n\t\tif !self.permission_set[item_name]\n\t\t\tself.permission_set[item_name] = {}\n\t\tself.permission_set[item_name] = _.extend(_.clone(self.permission_set[item_name]), item)\n\n\t# å‰ç«¯æ ¹æ®permissionsæ”¹å†™fieldç›¸å…³å±žæ€§ï¼ŒåŽç«¯åªè¦èµ°é»˜è®¤å±žæ€§å°±è¡Œï¼Œä¸éœ€è¦æ”¹å†™\n\tif Meteor.isClient\n\t\tpermissions = options.permissions\n\t\tdisabled_list_views = permissions?.disabled_list_views\n\t\tif disabled_list_views?.length\n\t\t\tdefaultListViewId = options.list_views?.all?._id\n\t\t\tif defaultListViewId\n\t\t\t\t# æŠŠè§†å›¾æƒé™é…ç½®ä¸­é»˜è®¤çš„allè§†å›¾idè½¬æ¢æˆallå…³é”®å­—\n\t\t\t\tpermissions.disabled_list_views = _.map disabled_list_views, (list_view_item) ->\n\t\t\t\t\treturn if defaultListViewId == list_view_item then \"all\" else list_view_item\n\t\tself.permissions = new ReactiveVar(permissions)\n#\t\t_.each self.fields, (field, field_name)->\n#\t\t\tif field\n#\t\t\t\tif _.indexOf(permissions?.unreadable_fields, field_name) < 0\n#\t\t\t\t\tif field.hidden\n#\t\t\t\t\t\treturn\n#\t\t\t\t\tif _.indexOf(permissions?.uneditable_fields, field_name) > -1\n#\t\t\t\t\t\tfield.readonly = true\n#\t\t\t\t\t\tfield.disabled = true\n#\t\t\t\t\t\t# å½“åªè¯»æ—¶ï¼Œå¦‚æžœä¸åŽ»æŽ‰å¿…å¡«å­—æ®µï¼Œautoformæ˜¯ä¼šæŠ¥é”™çš„\n#\t\t\t\t\t\tfield.required = false\n#\t\t\t\telse\n#\t\t\t\t\tfield.hidden = true\n\telse\n\t\tself.permissions = null\n\n\t_db = Creator.createCollection(options)\n\n\tCreator.Collections[_db._name] = _db\n\n\tself.db = _db\n\n\tself._collection_name = _db._name\n\n\tschema = Creator.getObjectSchema(self)\n\tself.schema = new SimpleSchema(schema)\n\tif self.name != \"users\" and self.name != \"cfs.files.filerecord\" && !self.is_view && !_.contains([\"flows\", \"forms\", \"instances\", \"organizations\", \"action_field_updates\", \"object_listviews\"], self.name)\n\t\tif Meteor.isClient\n\t\t\t_db.attachSchema(self.schema, {replace: true})\n\t\telse\n\t\t\t_db.attachSchema(self.schema, {replace: true})\n\tif self.name == \"users\"\n\t\t_db._simpleSchema = self.schema\n\n\tif _.contains([\"flows\", \"forms\", \"instances\", \"organizations\"], self.name)\n\t\tif Meteor.isClient\n\t\t\t_db.attachSchema(self.schema, {replace: true})\n\n\tCreator.objectsByName[self._collection_name] = self\n\n\treturn self\n\n# Creator.Object.prototype.i18n = ()->\n# \t# set object label\n# \tself = this\n\n# \tkey = self.name\n# \tif t(key) == key\n# \t\tif !self.label\n# \t\t\tself.label = self.name\n# \telse\n# \t\tself.label = t(key)\n\n# \t# set field labels\n# \t_.each self.fields, (field, field_name)->\n# \t\tfkey = self.name + \"_\" + field_name\n# \t\tif t(fkey) == fkey\n# \t\t\tif !field.label\n# \t\t\t\tfield.label = field_name\n# \t\telse\n# \t\t\tfield.label = t(fkey)\n# \t\tself.schema?._schema?[field_name]?.label = field.label\n\n\n# \t# set listview labels\n# \t_.each self.list_views, (item, item_name)->\n# \t\ti18n_key = self.name + \"_listview_\" + item_name\n# \t\tif t(i18n_key) == i18n_key\n# \t\t\tif !item.label\n# \t\t\t\titem.label = item_name\n# \t\telse\n# \t\t\titem.label = t(i18n_key)\n\n\nCreator.getObjectODataRouterPrefix = (object)->\n\treturn \"/api/odata/v4\"\n\t# if object\n\t# \tif !object.database_name || object.database_name == 'meteor-mongo'\n\t# \t\treturn \"/api/odata/v4\"\n\t# \telse\n\t# \t\treturn \"/api/odata/#{object.database_name}\"\n\n# if Meteor.isClient\n\n# \tMeteor.startup ->\n# \t\tTracker.autorun ->\n# \t\t\tif Session.get(\"steedos-locale\") && Creator.bootstrapLoaded?.get()\n# \t\t\t\t_.each Creator.objectsByName, (object, object_name)->\n# \t\t\t\t\tobject.i18n()\n\nMeteor.startup ->\n\tif !Creator.bootstrapLoaded && Creator.Objects\n\t\t_.each Creator.Objects, (object)->\n\t\t\tnew Creator.Object(object)\n\n","var clone;\n\nclone = require('clone');\n\nCreator.objectsByName = {};\n\nCreator.formatObjectName = function(object_name) {\n  if (object_name.startsWith('cfs.files.')) {\n    object_name = object_name.replace(new RegExp('\\\\.', 'g'), '_');\n  }\n  return object_name;\n};\n\nCreator.Object = function(options) {\n  var _baseObject, _db, defaultListViewId, defaultView, disabled_list_views, permissions, ref, ref1, ref2, ref3, schema, self;\n  _baseObject = Creator.baseObject;\n  if (Meteor.isClient) {\n    _baseObject = {\n      actions: Creator.baseObject.actions,\n      fields: {},\n      triggers: {},\n      permission_set: {}\n    };\n  }\n  self = this;\n  if (!options.name) {\n    console.error(options);\n    throw new Error('Creator.Object options must specify name');\n  }\n  self._id = options._id || options.name;\n  self.space = options.space;\n  self.name = options.name;\n  self.label = options.label;\n  self.icon = options.icon;\n  self.description = options.description;\n  self.is_view = options.is_view;\n  self.form = options.form;\n  self.relatedList = options.relatedList;\n  self.related_lists = options.related_lists;\n  self.version = options.version || 1.0;\n  if (!_.isBoolean(options.is_enable) || options.is_enable === true) {\n    self.is_enable = true;\n  } else {\n    self.is_enable = false;\n  }\n  if (Meteor.isClient) {\n    if (_.has(options, 'allow_customActions')) {\n      self.allow_customActions = options.allow_customActions;\n    }\n    if (_.has(options, 'exclude_actions')) {\n      self.exclude_actions = options.exclude_actions;\n    }\n    if (_.has(options, 'allow_relatedList')) {\n      self.allow_relatedList = options.allow_relatedList;\n    }\n  }\n  self.enable_search = options.enable_search;\n  self.enable_files = options.enable_files;\n  self.enable_tasks = options.enable_tasks;\n  self.enable_notes = options.enable_notes;\n  self.enable_audit = options.enable_audit;\n  self.enable_events = options.enable_events;\n  if (options.paging) {\n    self.paging = options.paging;\n  }\n  self.hidden = options.hidden;\n  self.enable_api = (options.enable_api === void 0) || options.enable_api;\n  self.custom = options.custom;\n  self.enable_share = options.enable_share;\n  self.enable_instances = options.enable_instances;\n  self.enable_process = options.enable_process;\n  if (Meteor.isClient) {\n    if (Creator.isCloudAdminSpace(Session.get(\"spaceId\"))) {\n      self.enable_tree = false;\n    } else {\n      self.enable_tree = options.enable_tree;\n      self.sidebar = _.clone(options.sidebar);\n    }\n  } else {\n    self.sidebar = _.clone(options.sidebar);\n    self.enable_tree = options.enable_tree;\n  }\n  self.open_window = options.open_window;\n  self.filter_company = options.filter_company;\n  self.calendar = _.clone(options.calendar);\n  self.enable_chatter = options.enable_chatter;\n  self.enable_trash = options.enable_trash;\n  self.enable_space_global = options.enable_space_global;\n  self.enable_approvals = options.enable_approvals;\n  self.enable_follow = options.enable_follow;\n  self.enable_workflow = options.enable_workflow;\n  self.enable_inline_edit = options.enable_inline_edit;\n  self.details = options.details;\n  self.masters = options.masters;\n  self.lookup_details = options.lookup_details;\n  if (_.has(options, 'in_development')) {\n    self.in_development = options.in_development;\n  }\n  self.idFieldName = '_id';\n  if (options.database_name) {\n    self.database_name = options.database_name;\n  }\n  if (!options.fields) {\n    console.error(options);\n    throw new Error('Creator.Object options must specify fields');\n  }\n  self.fields = clone(options.fields);\n  _.each(self.fields, function(field, field_name) {\n    if (field.is_name) {\n      self.NAME_FIELD_KEY = field_name;\n    } else if (field_name === 'name' && !self.NAME_FIELD_KEY) {\n      self.NAME_FIELD_KEY = field_name;\n    }\n    if (field.primary) {\n      self.idFieldName = field_name;\n    }\n    if (Meteor.isClient) {\n      if (Creator.isCloudAdminSpace(Session.get(\"spaceId\"))) {\n        if (field_name === 'space') {\n          field.filterable = true;\n          return field.hidden = false;\n        }\n      }\n    }\n  });\n  if (!options.database_name || options.database_name === 'meteor-mongo') {\n    _.each(_baseObject.fields, function(field, field_name) {\n      if (!self.fields[field_name]) {\n        self.fields[field_name] = {};\n      }\n      return self.fields[field_name] = _.extend(_.clone(field), self.fields[field_name]);\n    });\n  }\n  _.each(self.fields, function(field, field_name) {\n    if (field.type === 'autonumber') {\n      return field.readonly = true;\n    } else if (field.type === 'formula') {\n      return field.readonly = true;\n    } else if (field.type === 'summary') {\n      return field.readonly = true;\n    }\n  });\n  self.list_views = {};\n  defaultView = Creator.getObjectDefaultView(self.name);\n  _.each(options.list_views, function(item, item_name) {\n    var oitem;\n    oitem = Creator.convertListView(defaultView, item, item_name);\n    return self.list_views[item_name] = oitem;\n  });\n  self.triggers = _.clone(_baseObject.triggers);\n  _.each(options.triggers, function(item, item_name) {\n    if (!self.triggers[item_name]) {\n      self.triggers[item_name] = {};\n    }\n    self.triggers[item_name].name = item_name;\n    return self.triggers[item_name] = _.extend(_.clone(self.triggers[item_name]), item);\n  });\n  self.actions = _.clone(_baseObject.actions);\n  _.each(options.actions, function(item, item_name) {\n    var copyItem;\n    if (!self.actions[item_name]) {\n      self.actions[item_name] = {};\n    }\n    copyItem = _.clone(self.actions[item_name]);\n    delete self.actions[item_name];\n    return self.actions[item_name] = _.extend(copyItem, item);\n  });\n  _.each(self.actions, function(item, item_name) {\n    return item.name = item_name;\n  });\n  self.related_objects = Creator.getObjectRelateds(self.name);\n  self.permission_set = _.clone(_baseObject.permission_set);\n  if (!options.permission_set) {\n    options.permission_set = {};\n  }\n  if (!((ref = options.permission_set) != null ? ref.admin : void 0)) {\n    options.permission_set.admin = _.clone(self.permission_set[\"admin\"]);\n  }\n  if (!((ref1 = options.permission_set) != null ? ref1.user : void 0)) {\n    options.permission_set.user = _.clone(self.permission_set[\"user\"]);\n  }\n  _.each(options.permission_set, function(item, item_name) {\n    if (!self.permission_set[item_name]) {\n      self.permission_set[item_name] = {};\n    }\n    return self.permission_set[item_name] = _.extend(_.clone(self.permission_set[item_name]), item);\n  });\n  if (Meteor.isClient) {\n    permissions = options.permissions;\n    disabled_list_views = permissions != null ? permissions.disabled_list_views : void 0;\n    if (disabled_list_views != null ? disabled_list_views.length : void 0) {\n      defaultListViewId = (ref2 = options.list_views) != null ? (ref3 = ref2.all) != null ? ref3._id : void 0 : void 0;\n      if (defaultListViewId) {\n        permissions.disabled_list_views = _.map(disabled_list_views, function(list_view_item) {\n          if (defaultListViewId === list_view_item) {\n            return \"all\";\n          } else {\n            return list_view_item;\n          }\n        });\n      }\n    }\n    self.permissions = new ReactiveVar(permissions);\n  } else {\n    self.permissions = null;\n  }\n  _db = Creator.createCollection(options);\n  Creator.Collections[_db._name] = _db;\n  self.db = _db;\n  self._collection_name = _db._name;\n  schema = Creator.getObjectSchema(self);\n  self.schema = new SimpleSchema(schema);\n  if (self.name !== \"users\" && self.name !== \"cfs.files.filerecord\" && !self.is_view && !_.contains([\"flows\", \"forms\", \"instances\", \"organizations\", \"action_field_updates\", \"object_listviews\"], self.name)) {\n    if (Meteor.isClient) {\n      _db.attachSchema(self.schema, {\n        replace: true\n      });\n    } else {\n      _db.attachSchema(self.schema, {\n        replace: true\n      });\n    }\n  }\n  if (self.name === \"users\") {\n    _db._simpleSchema = self.schema;\n  }\n  if (_.contains([\"flows\", \"forms\", \"instances\", \"organizations\"], self.name)) {\n    if (Meteor.isClient) {\n      _db.attachSchema(self.schema, {\n        replace: true\n      });\n    }\n  }\n  Creator.objectsByName[self._collection_name] = self;\n  return self;\n};\n\nCreator.getObjectODataRouterPrefix = function(object) {\n  return \"/api/odata/v4\";\n};\n\nMeteor.startup(function() {\n  if (!Creator.bootstrapLoaded && Creator.Objects) {\n    return _.each(Creator.Objects, function(object) {\n      return new Creator.Object(object);\n    });\n  }\n});\n","Creator.getSelectOptions = (fieldSchema) ->\n\toptions = fieldSchema.options\n\tunless options\n\t\treturn\n\tdata_type = fieldSchema.data_type\n\tif !_.isFunction(options) and data_type and data_type != 'text'\n\t\t# é›¶ä»£ç ç•Œé¢é…ç½®optionsé€‰é¡¹å€¼åªæ”¯æŒå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å½“data_typeä¸ºæ•°å€¼æˆ–booleanæ—¶ï¼Œåªèƒ½å¼ºè¡ŒæŠŠé€‰é¡¹å€¼å…ˆè½¬æ¢ä¸ºå¯¹åº”çš„ç±»åž‹\n\t\toptions.forEach (optionItem) ->\n\t\t\tif typeof optionItem.value != 'string'\n\t\t\t\treturn\n\t\t\tif [\n\t\t\t\t'number'\n\t\t\t\t'currency'\n\t\t\t\t'percent'\n\t\t\t].indexOf(data_type) > -1\n\t\t\t\toptionItem.value = Number(optionItem.value)\n\t\t\telse if data_type == 'boolean'\n\t\t\t\t# åªæœ‰ä¸ºtrueæ‰ä¸ºçœŸ\n\t\t\t\toptionItem.value = optionItem.value == 'true'\n\treturn options\n\nCreator.getObjectSchema = (obj) ->\n\tunless obj\n\t\treturn\n\tschema = {}\n\n\tfieldsArr = []\n\n\t_.each obj.fields , (field, field_name)->\n\t\tif !_.has(field, \"name\")\n\t\t\tfield.name = field_name\n\t\tfieldsArr.push field\n\n\t_.each _.sortBy(fieldsArr, \"sort_no\"), (field)->\n\n\t\tfield_name = field.name\n\n\t\tfs = {}\n\t\tif field.regEx\n\t\t\tfs.regEx = field.regEx\n\t\tfs.autoform = {}\n\t\tfs.autoform.multiple = field.multiple\n\t\tfs.autoform.reference_to = field.reference_to\n\n\t\tautoform_type = field.autoform?.type\n\n\t\tif field.type == \"text\" or field.type == \"phone\"\n\t\t\tfs.type = String\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\t\t\t\tfs.autoform.type = \"tags\"\n\t\telse if field.type == \"[text]\" or field.type == \"[phone]\"\n\t\t\tfs.type = [String]\n\t\t\tfs.autoform.type = \"tags\"\n\t\telse if field.type == 'code'\n\t\t\tfs.type = String\n\t\t\tfs.autoform.type = \"widearea\"\n\t\t\tfs.autoform.rows = field.rows || 12\n\t\t\tif field.language\n\t\t\t\tfs.autoform.language = field.language\n\t\telse if field.type == \"textarea\"\n\t\t\tfs.type = String\n\t\t\tfs.autoform.type = \"widearea\"\n\t\t\tfs.autoform.rows = field.rows || 2\n\t\telse if field.type == \"password\"\n\t\t\tfs.type = String\n\t\t\tfs.autoform.type = \"password\"\n\t\telse if field.type == \"date\"\n\t\t\tfs.type = Date\n\t\t\tif Meteor.isClient\n\t\t\t\tif Steedos.isMobile() || Steedos.isPad()\n\t\t\t\t\tif Steedos.isiOS()\n\t\t\t\t\t\t# Fix ios 14, æ‰‹æœºå®¢æˆ·ç«¯å¾…å®¡æ ¸æ–‡ä»¶æ—¥æœŸæŽ§ä»¶æ˜¾ç¤ºæ•…éšœ #991ï¼Œiosç»Ÿä¸€ç”¨PCç«¯ä¸€æ ·çš„jsæŽ§ä»¶\n\t\t\t\t\t\tfs.autoform.afFieldInput =\n\t\t\t\t\t\t\ttype: \"dx-date-box\"\n\t\t\t\t\t\t\ttimezoneId: \"utc\"\n\t\t\t\t\t\t\tdxDateBoxOptions:\n\t\t\t\t\t\t\t\ttype: \"date\"\n\t\t\t\t\t\t\t\tdisplayFormat: \"yyyy-MM-dd\"\n\t\t\t\t\t\t\t\tpickerType: \"rollers\"\n\t\t\t\t\telse\n\t\t\t\t\t\t# è¿™é‡Œç”¨afFieldInputè€Œä¸ç›´æŽ¥ç”¨autoformçš„åŽŸå› æ˜¯å½“å­—æ®µè¢«hiddençš„æ—¶å€™åŽ»æ‰§è¡ŒdxDateBoxOptionså‚æ•°ä¼šæŠ¥é”™\n\t\t\t\t\t\tfs.autoform.afFieldInput =\n\t\t\t\t\t\t\ttype: \"steedos-date-mobile\"\n\t\t\t\t\t\t\tdateMobileOptions:\n\t\t\t\t\t\t\t\ttype: \"date\"\n\t\t\t\telse\n\t\t\t\t\tfs.autoform.outFormat = 'yyyy-MM-dd';\n\t\t\t\t\t# è¿™é‡Œç”¨afFieldInputè€Œä¸ç›´æŽ¥ç”¨autoformçš„åŽŸå› æ˜¯å½“å­—æ®µè¢«hiddençš„æ—¶å€™åŽ»æ‰§è¡ŒdxDateBoxOptionså‚æ•°ä¼šæŠ¥é”™\n\t\t\t\t\tfs.autoform.afFieldInput =\n\t\t\t\t\t\ttype: \"dx-date-box\"\n\t\t\t\t\t\ttimezoneId: \"utc\"\n\t\t\t\t\t\tdxDateBoxOptions:\n\t\t\t\t\t\t\ttype: \"date\"\n\t\t\t\t\t\t\tdisplayFormat: \"yyyy-MM-dd\"\n\t\telse if field.type == \"time\"\n\t\t\tfs.type = Date\n\t\t\tif Meteor.isClient\n\t\t\t\t# è¿™é‡Œç”¨afFieldInputè€Œä¸ç›´æŽ¥ç”¨autoformçš„åŽŸå› æ˜¯å½“å­—æ®µè¢«hiddençš„æ—¶å€™åŽ»æ‰§è¡ŒdxDateBoxOptionså‚æ•°ä¼šæŠ¥é”™\n\t\t\t\tfs.autoform.afFieldInput =\n\t\t\t\t\ttype: \"dx-date-box\"\n\t\t\t\t\ttimezoneId: \"utc\"\n\t\t\t\t\tdxDateBoxOptions:\n\t\t\t\t\t\ttype: \"time\"\n\t\t\t\t\t\tdisplayFormat: \"HH:mm\"\n\t\telse if field.type == \"datetime\"\n\t\t\tfs.type = Date\n\t\t\tif Meteor.isClient\n\t\t\t\tif Steedos.isMobile() || Steedos.isPad()\n\t\t\t\t\tif Steedos.isiOS()\n\t\t\t\t\t\t# Fix ios 14, æ‰‹æœºå®¢æˆ·ç«¯å¾…å®¡æ ¸æ–‡ä»¶æ—¥æœŸæŽ§ä»¶æ˜¾ç¤ºæ•…éšœ #991ï¼Œiosç»Ÿä¸€ç”¨PCç«¯ä¸€æ ·çš„jsæŽ§ä»¶\n\t\t\t\t\t\tfs.autoform.afFieldInput =\n\t\t\t\t\t\t\ttype: \"dx-date-box\"\n\t\t\t\t\t\t\tdxDateBoxOptions:\n\t\t\t\t\t\t\t\ttype: \"datetime\"\n\t\t\t\t\t\t\t\tdisplayFormat: \"yyyy-MM-dd HH:mm\"\n\t\t\t\t\t\t\t\tpickerType: \"rollers\"\n\t\t\t\t\telse\n\t\t\t\t\t\t# è¿™é‡Œç”¨afFieldInputè€Œä¸ç›´æŽ¥ç”¨autoformçš„åŽŸå› æ˜¯å½“å­—æ®µè¢«hiddençš„æ—¶å€™åŽ»æ‰§è¡ŒdxDateBoxOptionså‚æ•°ä¼šæŠ¥é”™\n\t\t\t\t\t\tfs.autoform.afFieldInput =\n\t\t\t\t\t\t\ttype: \"steedos-date-mobile\"\n\t\t\t\t\t\t\tdateMobileOptions:\n\t\t\t\t\t\t\t\ttype: \"datetime\"\n\t\t\t\telse\n\t\t\t\t\t# è¿™é‡Œç”¨afFieldInputè€Œä¸ç›´æŽ¥ç”¨autoformçš„åŽŸå› æ˜¯å½“å­—æ®µè¢«hiddençš„æ—¶å€™åŽ»æ‰§è¡ŒdxDateBoxOptionså‚æ•°ä¼šæŠ¥é”™\n\t\t\t\t\tfs.autoform.afFieldInput =\n\t\t\t\t\t\ttype: \"dx-date-box\"\n\t\t\t\t\t\tdxDateBoxOptions:\n\t\t\t\t\t\t\ttype: \"datetime\"\n\t\t\t\t\t\t\tdisplayFormat: \"yyyy-MM-dd HH:mm\"\n\t\telse if field.type == \"[Object]\"\n\t\t\tfs.type = [Object]\n\t\telse if field.type == \"html\"\n\t\t\tfs.type = String\n\t\t\tif Meteor.isClient\n\t\t\t\tfs.autoform.type = 'steedosHtml';\n\t\t\t# if Meteor.isClient\n\t\t\t# \tlocale = Steedos.locale()\n\t\t\t# \tif locale == \"zh-cn\" || locale == \"zh-CN\"\n\t\t\t# \t\tlocale = \"zh-CN\"\n\t\t\t# \telse\n\t\t\t# \t\tlocale = \"en-US\"\n\t\t\t# \tfs.autoform.afFieldInput =\n\t\t\t# \t\ttype: \"summernote\"\n\t\t\t# \t\tclass: 'summernote-editor'\n\t\t\t# \t\tsettings:\n\t\t\t# \t\t\theight: 200\n\t\t\t# \t\t\tdialogsInBody: true\n\t\t\t# \t\t\ttoolbar:  [\n\t\t\t# \t\t\t\t['font1', ['style']],\n\t\t\t# \t\t\t\t['font2', ['bold', 'underline', 'italic', 'clear']],\n\t\t\t# \t\t\t\t['font3', ['fontname']],\n\t\t\t# \t\t\t\t['color', ['color']],\n\t\t\t# \t\t\t\t['para', ['ul', 'ol', 'paragraph']],\n\t\t\t# \t\t\t\t['table', ['table']],\n\t\t\t# \t\t\t\t['insert', ['link', 'picture']],\n\t\t\t# \t\t\t\t['view', ['codeview']]\n\t\t\t# \t\t\t]\n\t\t\t# \t\t\tfontNames: ['Arial', 'Comic Sans MS', 'Courier New', 'Helvetica', 'Impact', 'å®‹ä½“','é»‘ä½“','å¾®è½¯é›…é»‘','ä»¿å®‹','æ¥·ä½“','éš¶ä¹¦','å¹¼åœ†']\n\t\t\t# \t\t\tlang: locale\n\n\t\telse if (field.type == \"lookup\" or field.type == \"master_detail\")\n\t\t\tfs.type = String\n\t\t\tfs.autoform.showIcon = field.showIcon\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\n\t\t\tif !field.hidden\n\n\t\t\t\tfs.autoform.filters = field.filters\n\n\t\t\t\tfs.autoform.dependOn = field.depend_on\n\n\t\t\t\tif field.beforeOpenFunction\n\t\t\t\t\tfs.beforeOpenFunction = field.beforeOpenFunction\n\n\t\t\t\tfs.filtersFunction = if field.filtersFunction then field.filtersFunction else Creator.evaluateFilters\n\n\t\t\t\tif field.optionsFunction\n\t\t\t\t\tfs.optionsFunction = field.optionsFunction\n\n\t\t\t\tif field.reference_to\n\n\t\t\t\t\tif Meteor.isClient\n\t\t\t\t\t\tif field.createFunction && _.isFunction(field.createFunction)\n\t\t\t\t\t\t\tfs.createFunction = field.createFunction\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tif _.isString(field.reference_to)\n\t\t\t\t\t\t\t\t_ref_obj = Creator.Objects[field.reference_to]\n\t\t\t\t\t\t\t\tif _ref_obj?.permissions?.allowCreate\n\t\t\t\t\t\t\t\t\tfs.autoform.create = true\n\t\t\t\t\t\t\t\t\tfs.createFunction = (lookup_field)->\n\t\t\t\t\t\t\t\t\t\tModal.show(\"CreatorObjectModal\", {\n\t\t\t\t\t\t\t\t\t\t\tcollection: \"Creator.Collections.#{Creator.getCollection(field.reference_to)._name}\",\n\t\t\t\t\t\t\t\t\t\t\tformId: \"new#{field.reference_to.replace('.','_')}\",\n\t\t\t\t\t\t\t\t\t\t\tobject_name: \"#{field.reference_to}\",\n\t\t\t\t\t\t\t\t\t\t\toperation: \"insert\",\n\t\t\t\t\t\t\t\t\t\t\tonSuccess: (operation, result)->\n\t\t\t\t\t\t\t\t\t\t\t\tobject = Creator.getObject(result.object_name)\n\t\t\t\t\t\t\t\t\t\t\t\tif result.object_name == \"objects\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tlookup_field.addItems([{label: result.value.label, value: result.value.name, icon: result.value.icon}], result.value.name)\n\t\t\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\t\t\tlookup_field.addItems([{label: result.value[object.NAME_FIELD_KEY] || result.value.label || result.value.name, value: result._id}], result._id)\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tfs.autoform.create = false\n\n\t\t\t\t\tif _.isBoolean(field.create)\n\t\t\t\t\t\tfs.autoform.create = field.create\n\n\t\t\t\t\tif field.reference_sort\n\t\t\t\t\t\tfs.autoform.optionsSort = field.reference_sort\n\n\t\t\t\t\tif field.reference_limit\n\t\t\t\t\t\tfs.autoform.optionsLimit = field.reference_limit\n\t\t\t\t\tif field.reference_to_field\n\t\t\t\t\t\tfs.autoform.referenceToField = field.reference_to_field\n\n\t\t\t\t\tif field.reference_to == \"users\"\n\t\t\t\t\t\tfs.autoform.type = \"selectuser\"\n\t\t\t\t\t\tif !field.hidden && !field.omit\n\t\t\t\t\t\t\t# is_company_limitedè¡¨ç¤ºè¿‡æ»¤æ•°æ®æ—¶æ˜¯å¦åªæ˜¾ç¤ºæœ¬åˆ†éƒ¨ä¸‹çš„æ•°æ®\n\t\t\t\t\t\t\t# is_company_limitedå¯ä»¥è¢«æ”¹å†™è¦†ç›–æˆtrue/falseæˆ–å…¶ä»–function\n\t\t\t\t\t\t\tif field.is_company_limited == undefined\n\t\t\t\t\t\t\t\t# æœªå®šä¹‰is_company_limitedå±žæ€§æ—¶é»˜è®¤å¤„ç†é€»è¾‘ï¼š\n\t\t\t\t\t\t\t\t# å¯¹å½“å‰å¯¹è±¡æœ‰viewAllRecordsæƒé™åˆ™ä¸é™åˆ¶æ‰€å±žåˆ†éƒ¨åˆ—è¡¨æŸ¥çœ‹æƒé™ï¼Œå¦åˆ™åªæ˜¾ç¤ºå½“å‰æ‰€å±žåˆ†éƒ¨\n\t\t\t\t\t\t\t\t# æ³¨æ„ä¸æ˜¯reference_toå¯¹è±¡çš„viewAllRecordsæƒé™ï¼Œè€Œæ˜¯å½“å‰å¯¹è±¡çš„\n\t\t\t\t\t\t\t\tif Meteor.isClient\n\t\t\t\t\t\t\t\t\tpermissions = obj.permissions?.get()\n\t\t\t\t\t\t\t\t\tisUnLimited = permissions?.viewAllRecords\n\t\t\t\t\t\t\t\t\tif _.include([\"organizations\", \"users\", \"space_users\"], obj.name)\n\t\t\t\t\t\t\t\t\t\t# å¦‚æžœå­—æ®µæ‰€å±žå¯¹è±¡æ˜¯ç”¨æˆ·æˆ–ç»„ç»‡ï¼Œåˆ™æ˜¯å¦é™åˆ¶æ˜¾ç¤ºæ‰€å±žåˆ†éƒ¨éƒ¨é—¨ä¸ŽmodifyAllRecordsæƒé™å…³è”\n\t\t\t\t\t\t\t\t\t\tisUnLimited = permissions?.modifyAllRecords\n\t\t\t\t\t\t\t\t\tif isUnLimited\n\t\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = false\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = true\n\t\t\t\t\t\t\telse if _.isFunction field.is_company_limited\n\t\t\t\t\t\t\t\tif Meteor.isClient\n\t\t\t\t\t\t\t\t\t# ä¼ å…¥å½“å‰å¯¹è±¡çš„æƒé™ï¼Œåœ¨å‡½æ•°ä¸­æ ¹æ®æƒé™è®¡ç®—æ˜¯å¦è¦é™åˆ¶åªæŸ¥çœ‹æœ¬åˆ†éƒ¨\n\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited(obj.permissions)\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t# æœåŠ¡ç«¯ç”¨ä¸åˆ°is_company_limited\n\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = true\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited\n\t\t\t\t\telse if field.reference_to == \"organizations\"\n\t\t\t\t\t\tfs.autoform.type = \"selectorg\"\n\t\t\t\t\t\tif !field.hidden && !field.omit\n\t\t\t\t\t\t\t# is_company_limitedè¡¨ç¤ºè¿‡æ»¤æ•°æ®æ—¶æ˜¯å¦åªæ˜¾ç¤ºæœ¬åˆ†éƒ¨ä¸‹çš„æ•°æ®\n\t\t\t\t\t\t\t# is_company_limitedå¯ä»¥è¢«æ”¹å†™è¦†ç›–æˆtrue/falseæˆ–å…¶ä»–function\n\t\t\t\t\t\t\tif field.is_company_limited == undefined\n\t\t\t\t\t\t\t\t# æœªå®šä¹‰is_company_limitedå±žæ€§æ—¶é»˜è®¤å¤„ç†é€»è¾‘ï¼š\n\t\t\t\t\t\t\t\t# å¯¹å½“å‰å¯¹è±¡æœ‰viewAllRecordsæƒé™åˆ™ä¸é™åˆ¶æ‰€å±žåˆ†éƒ¨åˆ—è¡¨æŸ¥çœ‹æƒé™ï¼Œå¦åˆ™åªæ˜¾ç¤ºå½“å‰æ‰€å±žåˆ†éƒ¨\n\t\t\t\t\t\t\t\t# æ³¨æ„ä¸æ˜¯reference_toå¯¹è±¡çš„viewAllRecordsæƒé™ï¼Œè€Œæ˜¯å½“å‰å¯¹è±¡çš„\n\t\t\t\t\t\t\t\tif Meteor.isClient\n\t\t\t\t\t\t\t\t\tpermissions = obj.permissions?.get()\n\t\t\t\t\t\t\t\t\tisUnLimited = permissions?.viewAllRecords\n\t\t\t\t\t\t\t\t\tif _.include([\"organizations\", \"users\", \"space_users\"], obj.name)\n\t\t\t\t\t\t\t\t\t\t# å¦‚æžœå­—æ®µæ‰€å±žå¯¹è±¡æ˜¯ç”¨æˆ·æˆ–ç»„ç»‡ï¼Œåˆ™æ˜¯å¦é™åˆ¶æ˜¾ç¤ºæ‰€å±žåˆ†éƒ¨éƒ¨é—¨ä¸ŽmodifyAllRecordsæƒé™å…³è”\n\t\t\t\t\t\t\t\t\t\tisUnLimited = permissions?.modifyAllRecords\n\t\t\t\t\t\t\t\t\tif isUnLimited\n\t\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = false\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = true\n\t\t\t\t\t\t\telse if _.isFunction field.is_company_limited\n\t\t\t\t\t\t\t\tif Meteor.isClient\n\t\t\t\t\t\t\t\t\t# ä¼ å…¥å½“å‰å¯¹è±¡çš„æƒé™ï¼Œåœ¨å‡½æ•°ä¸­æ ¹æ®æƒé™è®¡ç®—æ˜¯å¦è¦é™åˆ¶åªæŸ¥çœ‹æœ¬åˆ†éƒ¨\n\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited(obj.permissions)\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t# æœåŠ¡ç«¯ç”¨ä¸åˆ°is_company_limited\n\t\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = true\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tfs.autoform.is_company_limited = field.is_company_limited\n\t\t\t\t\telse\n\t\t\t\t\t\tif typeof(field.reference_to) == \"function\"\n\t\t\t\t\t\t\t_reference_to = field.reference_to()\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\t_reference_to = field.reference_to\n\n\t\t\t\t\t\tif _.isArray(_reference_to)\n\t\t\t\t\t\t\tfs.type = Object\n\t\t\t\t\t\t\tfs.blackbox = true\n\t\t\t\t\t\t\tfs.autoform.objectSwitche = true\n\n\t\t\t\t\t\t\tschema[field_name + \".o\"] = {\n\t\t\t\t\t\t\t\ttype: String\n\t\t\t\t\t\t\t\tautoform: {omit: true}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tschema[field_name + \".ids\"] = {\n\t\t\t\t\t\t\t\ttype: [String]\n\t\t\t\t\t\t\t\tautoform: {omit: true}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\t_reference_to = [_reference_to]\n\n\t\t\t\t\t\t_object = Creator.Objects[_reference_to[0]]\n\t\t\t\t\t\tif _object and _object.enable_tree\n\t\t\t\t\t\t\tfs.autoform.type = \"selectTree\"\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tfs.autoform.type = \"steedosLookups\"\n\t\t\t\t\t\t\tfs.autoform.optionsMethod = field.optionsMethod || \"creator.object_options\"\n\n\t\t\t\t\t\t\tif Meteor.isClient\n\t\t\t\t\t\t\t\tfs.autoform.optionsMethodParams = ()->\n\t\t\t\t\t\t\t\t\treturn {space: Session.get(\"spaceId\")}\n\t\t\t\t\t\t\t\tfs.autoform.references = []\n\t\t\t\t\t\t\t\t_reference_to.forEach (_reference)->\n\t\t\t\t\t\t\t\t\t_object = Creator.Objects[_reference]\n\t\t\t\t\t\t\t\t\tif _object\n\t\t\t\t\t\t\t\t\t\tfs.autoform.references.push {\n\t\t\t\t\t\t\t\t\t\t\tobject: _reference\n\t\t\t\t\t\t\t\t\t\t\tlabel: _object?.label\n\t\t\t\t\t\t\t\t\t\t\ticon: _object?.icon\n\t\t\t\t\t\t\t\t\t\t\tlink: ()->\n\t\t\t\t\t\t\t\t\t\t\t\treturn \"/app/#{Session.get('app_id')}/#{_reference}/view/\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\tfs.autoform.references.push {\n\t\t\t\t\t\t\t\t\t\t\tobject: _reference\n\t\t\t\t\t\t\t\t\t\t\tlink: ()->\n\t\t\t\t\t\t\t\t\t\t\t\treturn \"/app/#{Session.get('app_id')}/#{_reference}/view/\"\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\telse\n\t\t\t\t\tfs.autoform.type = \"steedosLookups\"\n\t\t\t\t\tfs.autoform.defaultIcon = field.defaultIcon\n\n\t\telse if field.type == \"select\"\n\t\t\tfs.type = String\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\t\t\t\tfs.autoform.type = \"steedosLookups\"\n\t\t\t\tfs.autoform.showIcon = false\n\t\t\t\tfs.autoform.options = field.options\n\t\t\telse\n\t\t\t\tfs.autoform.type = \"select\"\n\t\t\t\tfs.autoform.options = field.options\n\t\t\t\tif _.has(field, 'firstOption')\n\t\t\t\t\tfs.autoform.firstOption = field.firstOption\n\t\t\t\telse\n\t\t\t\t\tfs.autoform.firstOption = \"\"\n\t\t\t# å› ä¸ºåˆ—è¡¨è§†å›¾å³ä¾§è¿‡æ»¤å™¨è¿˜æ˜¯ç”¨çš„è€è¡¨å•çš„lookupå’ŒselectæŽ§ä»¶ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç å§‹ç»ˆä¿æŒåŽŸæ ·éœ€è¦æ‰§è¡Œ\n\t\t\t# ä¸‹é¢æ˜¯é…ç½®äº†data_typeæ—¶ï¼Œé¢å¤–å¤„ç†çš„é€»è¾‘\n\t\t\tif field.data_type and field.data_type != \"text\"\n\t\t\t\tif [\"number\", \"currency\", \"percent\"].indexOf(field.data_type) > -1\n\t\t\t\t\tfsType = Number\n\t\t\t\t\tfs.decimal = true\n\t\t\t\telse if field.data_type == \"boolean\"\n\t\t\t\t\tfsType = Boolean\n\t\t\t\telse\n\t\t\t\t\tfsType = String\n\t\t\t\tfs.type = fsType\n\t\t\t\tif field.multiple\n\t\t\t\t\tfs.type = [fsType]\n\t\t\t\t\t\n\t\t\t\tfs.autoform.options = Creator.getSelectOptions(field)\n\t\telse if field.type == \"currency\"\n\t\t\tfs.type = Number\n\t\t\tfs.autoform.type = \"steedosNumber\"\n\t\t\tfs.autoform.precision = field.precision || 18\n\t\t\tif field?.scale\n\t\t\t\tfs.autoform.scale = field.scale\n\t\t\t\tfs.decimal = true\n\t\t\telse if field?.scale != 0\n\t\t\t\tfs.autoform.scale = 2\n\t\t\t\tfs.decimal = true\n\t\telse if field.type == \"number\"\n\t\t\tfs.type = Number\n\t\t\tfs.autoform.type = \"steedosNumber\"\n\t\t\tfs.autoform.precision = field.precision || 18\n\t\t\tif field?.scale\n\t\t\t\tfs.autoform.scale = field.scale\n\t\t\t\tfs.decimal = true\n\t\telse if field.type == \"boolean\"\n\t\t\tfs.type = Boolean\n\t\t\tif field.readonly\n\t\t\t\tfs.autoform.disabled = true\n\t\t\tfs.autoform.type = \"steedos-boolean-checkbox\"\n\t\telse if field.type == \"toggle\"\n\t\t\tfs.type = Boolean\n\t\t\tif field.readonly\n\t\t\t\tfs.autoform.disabled = true\n\t\t\tfs.autoform.type = \"steedos-boolean-toggle\"\n\t\telse if field.type == \"reference\"\n\t\t\tfs.type = String\n\t\telse if field.type == \"checkbox\"\n\t\t\tfs.type = [String]\n\t\t\tfs.autoform.type = \"select-checkbox\"\n\t\t\tfs.autoform.options = field.options\n\t\telse if field.type == \"file\"\n\t\t\tcollectionName = field.collection || \"files\" # collection é»˜è®¤æ˜¯ 'files'\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\t\t\t\tschema[field_name + \".$\"] =\n\t\t\t\t\tautoform:\n\t\t\t\t\t\ttype: 'fileUpload'\n\t\t\t\t\t\tcollection: collectionName\n\t\t\telse\n\t\t\t\tfs.type = String\n\t\t\t\tfs.autoform.type = 'fileUpload'\n\t\t\t\tfs.autoform.collection = collectionName\n\t\telse if field.type == \"filesize\"\n\t\t\tfs.type = Number\n\t\t\tfs.autoform.type = 'filesize'\n\t\telse if field.type == \"Object\" || field.type == \"object\"\n\t\t\tfs.type = Object\n\t\telse if field.type == \"grid\"\n\t\t\tfs.type = Array\n\t\t\tfs.autoform.editable = true\n\t\t\tfs.autoform.type = \"steedosGrid\"\n\n\t\t\tschema[field_name + \".$\"] =\n\t\t\t\ttype: Object\n\t\telse if field.type == \"image\"\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\t\t\t\tschema[field_name + \".$\"] =\n\t\t\t\t\tautoform:\n\t\t\t\t\t\ttype: 'fileUpload'\n\t\t\t\t\t\tcollection: 'images'\n\t\t\t\t\t\taccept: 'image/*'\n\t\t\telse\n\t\t\t\tfs.type = String\n\t\t\t\tfs.autoform.type = 'fileUpload'\n\t\t\t\tfs.autoform.collection = 'images'\n\t\t\t\tfs.autoform.accept = 'image/*'\n\t\telse if field.type == \"avatar\"\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\t\t\t\tschema[field_name + \".$\"] =\n\t\t\t\t\tautoform:\n\t\t\t\t\t\ttype: 'fileUpload'\n\t\t\t\t\t\tcollection: 'avatars'\n\t\t\t\t\t\taccept: 'image/*'\n\t\t\telse\n\t\t\t\tfs.type = String\n\t\t\t\tfs.autoform.type = 'fileUpload'\n\t\t\t\tfs.autoform.collection = 'avatars'\n\t\t\t\tfs.autoform.accept = 'image/*'\n\t\telse if field.type == \"audio\"\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\t\t\t\tschema[field_name + \".$\"] =\n\t\t\t\t\tautoform:\n\t\t\t\t\t\ttype: 'fileUpload'\n\t\t\t\t\t\tcollection: 'audios'\n\t\t\t\t\t\taccept: 'audio/*'\n\t\t\telse\n\t\t\t\tfs.type = String\n\t\t\t\tfs.autoform.type = 'fileUpload'\n\t\t\t\tfs.autoform.collection = 'audios'\n\t\t\t\tfs.autoform.accept = 'audio/*'\n\t\telse if field.type == \"video\"\n\t\t\tif field.multiple\n\t\t\t\tfs.type = [String]\n\t\t\t\tschema[field_name + \".$\"] =\n\t\t\t\t\tautoform:\n\t\t\t\t\t\ttype: 'fileUpload'\n\t\t\t\t\t\tcollection: 'videos'\n\t\t\t\t\t\taccept: 'video/*'\n\t\t\telse\n\t\t\t\tfs.type = String\n\t\t\t\tfs.autoform.type = 'fileUpload'\n\t\t\t\tfs.autoform.collection = 'videos'\n\t\t\t\tfs.autoform.accept = 'video/*'\n\t\telse if field.type == \"location\"\n\t\t\tfs.type = Object\n\t\t\tfs.autoform.type = \"location\"\n\t\t\tfs.autoform.system = field.system || \"wgs84\"\n\t\t\tfs.blackbox = true\n\t\telse if field.type == \"markdown\"\n\t\t\tfs.type = String\n\t\t\tfs.autoform.type = \"text\"\n\t\telse if field.type == 'url'\n\t\t\tfs.type = String\n\t\t\t# fs.regEx = SimpleSchema.RegEx.Url\n\t\t\tfs.autoform.type = 'steedosUrl'\n\t\telse if field.type == 'email'\n\t\t\tfs.type = String\n\t\t\tfs.regEx = SimpleSchema.RegEx.Email\n\t\t\tfs.autoform.type = 'steedosEmail'\n\t\telse if field.type == 'autonumber'\n\t\t\tfs.type = String\n\t\telse if field.type == 'formula'\n\t\t\tfs = Creator.getObjectSchema({fields: {field: Object.assign({}, field, {type: field.data_type})}})[field.name]\n\t\telse if field.type == 'summary'\n\t\t\tfs = Creator.getObjectSchema({fields: {field: Object.assign({}, field, {type: field.data_type})}})[field.name]\n\t\t# else if field.type == 'select'\n\t\t# \tfs = Creator.getObjectSchema({fields: {field: Object.assign({}, field, {type: field.data_type})}})[field.name]\n\t\telse if field.type == 'percent'\n\t\t\tfs.type = Number\n\t\t\tfs.autoform.type = \"steedosNumber\"\n\t\t\tfs.autoform.precision = field.precision || 18\n\t\t\tunless _.isNumber(field.scale)\n\t\t\t\t# æ²¡é…ç½®å°æ•°ä½æ•°åˆ™æŒ‰å°æ•°ä½æ•°0æ¥å¤„ç†ï¼Œå³é»˜è®¤æ˜¾ç¤ºä¸ºæ•´æ•°çš„ç™¾åˆ†æ¯”ï¼Œæ¯”å¦‚20%ï¼Œæ­¤æ—¶æŽ§ä»¶å¯ä»¥è¾“å…¥2ä½å°æ•°ï¼Œè½¬æˆç™¾åˆ†æ¯”å°±æ˜¯æ•´æ•°\n\t\t\t\tfield.scale = 0\n\t\t\t# autoformæŽ§ä»¶ä¸­å°æ•°ä½æ•°å§‹ç»ˆæ¯”é…ç½®çš„ä½æ•°å¤š2ä½\n\t\t\tfs.autoform.scale = field.scale + 2\n\t\t\tfs.decimal = true\n\t\telse\n\t\t\tfs.type = field.type\n\n\t\tif field.label\n\t\t\tfs.label = field.label\n\n#\t\tif field.allowedValues\n#\t\t\tfs.allowedValues = field.allowedValues\n\n\t\tif !field.required\n\t\t\tfs.optional = true\n\n\t\t# [ç­¾çº¦å¯¹è±¡åŒæ—¶é…ç½®äº†company_idså¿…å¡«åŠuneditable_fieldsé€ æˆéƒ¨åˆ†ç”¨æˆ·æ–°å»ºç­¾çº¦å¯¹è±¡æ—¶æŠ¥é”™ #192](https://github.com/steedos/steedos-project-dzug/issues/192)\n\t\t# åŽå°å§‹ç»ˆè®¾ç½®requiredä¸ºfalse\n\t\tif !Meteor.isClient\n\t\t\tfs.optional = true\n\n\t\tif field.unique\n\t\t\tfs.unique = true\n\n\t\tif field.omit\n\t\t\tfs.autoform.omit = true\n\n\t\tif field.group\n\t\t\tfs.autoform.group = field.group\n\n\t\tif field.is_wide\n\t\t\tfs.autoform.is_wide = true\n\n\t\tif field.hidden\n\t\t\tfs.autoform.type = \"hidden\"\n\n\t\tif (field.type == \"select\") or (field.type == \"lookup\") or (field.type == \"master_detail\")\n\t\t\tif typeof(field.filterable) == 'undefined'\n\t\t\t\tfield.filterable = true\n\t\tif field.name == 'name' || field.is_name\n\t\t\tif typeof(field.searchable) == 'undefined'\n\t\t\t\tfield.searchable = true\n\n\t\tif autoform_type\n\t\t\tfs.autoform.type = autoform_type\n\n\t\tif field.defaultValue\n\t\t\tif Meteor.isClient and Creator.Formular.checkFormula(field.defaultValue)\n\t\t\t\tfs.autoform.defaultValue = ()->\n\t\t\t\t\treturn Creator.Formular.run(field.defaultValue, {userId: Meteor.userId(), spaceId: Session.get(\"spaceId\"), now: new Date()})\n\t\t\telse\n\t\t\t\tfs.autoform.defaultValue = field.defaultValue\n\t\t\t# \tif !_.isFunction(field.defaultValue)\n\t\t\t# \t\tfs.defaultValue = field.defaultValue\n\n\t\tif field.readonly\n\t\t\tfs.autoform.readonly = true\n\n\t\tif field.disabled\n\t\t\tfs.autoform.disabled = true\n\n\t\tif field.inlineHelpText\n\t\t\tfs.autoform.inlineHelpText = field.inlineHelpText\n\n\t\tif field.blackbox\n\t\t\tfs.blackbox = true\n\n\t\tif _.has(field, 'min')\n\t\t\tfs.min = field.min\n\t\tif _.has(field, 'max')\n\t\t\tfs.max = field.max\n\n\t\t# åªæœ‰ç”Ÿäº§çŽ¯å¢ƒæ‰é‡å»ºç´¢å¼•\n\t\tif Meteor.isProduction\n\t\t\tif field.index\n\t\t\t\tfs.index = field.index\n\t\t\telse if field.sortable\n\t\t\t\tfs.index = true\n\n\t\tschema[field_name] = fs\n\n\treturn schema\n\n\nCreator.getFieldDisplayValue = (object_name, field_name, field_value)->\n\thtml = field_value\n\tobject = Creator.getObject(object_name)\n\tif !object\n\t\treturn \"\"\n\tfield = object.fields(field_name)\n\tif !field\n\t\treturn \"\"\n\n\tif field.type == \"datetime\"\n\t\thtml = moment(this.val).format('YYYY-MM-DD H:mm')\n\telse if field.type == \"date\"\n\t\thtml = moment(this.val).format('YYYY-MM-DD')\n\n\treturn html\n\nCreator.checkFieldTypeSupportBetweenQuery = (field_type)->\n\treturn [\"date\", \"datetime\", \"time\", \"currency\", \"number\"].includes(field_type)\n\nCreator.pushBetweenBuiltinOptionals = (field_type, operations)->\n\tbuiltinValues = Creator.getBetweenBuiltinValues(field_type)\n\tif builtinValues\n\t\t_.forEach builtinValues, (builtinItem, key)->\n\t\t\toperations.push({label: builtinItem.label, value: key})\n\nCreator.getBetweenBuiltinValues = (field_type, is_check_only)->\n\t# è¿‡æ»¤å™¨å­—æ®µç±»åž‹å¯¹åº”çš„å†…ç½®é€‰é¡¹\n\tif [\"date\", \"datetime\"].includes(field_type)\n\t\treturn Creator.getBetweenTimeBuiltinValues(is_check_only, field_type)\n\nCreator.getBetweenBuiltinValueItem = (field_type, key)->\n\t# è¿‡æ»¤å™¨å­—æ®µç±»åž‹å¯¹åº”çš„å†…ç½®é€‰é¡¹\n\tif [\"date\", \"datetime\"].includes(field_type)\n\t\treturn Creator.getBetweenTimeBuiltinValueItem(field_type, key)\n\nCreator.getBetweenBuiltinOperation = (field_type, value)->\n\t# æ ¹æ®è¿‡æ»¤å™¨çš„è¿‡æ»¤å€¼ï¼ŒèŽ·å–å¯¹åº”çš„å†…ç½®è¿ç®—ç¬¦\n\t# æ¯”å¦‚valueä¸ºlast_yearï¼Œè¿”å›žbetween_time_last_year\n\tunless _.isString(value)\n\t\treturn\n\tbetweenBuiltinValues = Creator.getBetweenBuiltinValues(field_type)\n\tunless betweenBuiltinValues\n\t\treturn\n\tresult = null\n\t_.each betweenBuiltinValues, (item, operation)->\n\t\tif item.key == value\n\t\t\tresult = operation\n\treturn result\n\n# å¦‚æžœåªæ˜¯ä¸ºåˆ¤æ–­operationæ˜¯å¦å­˜åœ¨ï¼Œåˆ™æ²¡å¿…è¦è®¡ç®—valuesï¼Œä¼ å…¥is_check_onlyä¸ºtrueå³å¯\nCreator.getBetweenTimeBuiltinValues = (is_check_only, field_type)->\n\t# è¿‡æ»¤å™¨æ—¶é—´å­—æ®µç±»åž‹å¯¹åº”çš„å†…ç½®é€‰é¡¹\n\treturn {\n\t\t\"between_time_last_year\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_year\"),\n\t\t\"between_time_this_year\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_year\"),\n\t\t\"between_time_next_year\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_year\"),\n\t\t\"between_time_last_quarter\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_quarter\"),\n\t\t\"between_time_this_quarter\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_quarter\"),\n\t\t\"between_time_next_quarter\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_quarter\"),\n\t\t\"between_time_last_month\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_month\"),\n\t\t\"between_time_this_month\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_month\"),\n\t\t\"between_time_next_month\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_month\"),\n\t\t\"between_time_last_week\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_week\"),\n\t\t\"between_time_this_week\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_week\"),\n\t\t\"between_time_next_week\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_week\"),\n\t\t\"between_time_yestday\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"yestday\"),\n\t\t\"between_time_today\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"today\"),\n\t\t\"between_time_tomorrow\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"tomorrow\"),\n\t\t\"between_time_last_7_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_7_days\"),\n\t\t\"between_time_last_30_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_30_days\"),\n\t\t\"between_time_last_60_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_60_days\"),\n\t\t\"between_time_last_90_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_90_days\"),\n\t\t\"between_time_last_120_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_120_days\"),\n\t\t\"between_time_next_7_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_7_days\"),\n\t\t\"between_time_next_30_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_30_days\"),\n\t\t\"between_time_next_60_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_60_days\"),\n\t\t\"between_time_next_90_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_90_days\"),\n\t\t\"between_time_next_120_days\": if is_check_only then true else Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_120_days\")\n\t}\n\nCreator.getQuarterStartMonth = (month)->\n\tif !month\n\t\tmonth = new Date().getMonth()\n\t\n\tif month < 3\n\t\treturn 0\n\telse if month < 6\n\t\treturn 3\n\telse if month < 9\n\t\treturn 6\n\t\n\treturn 9\n\n\nCreator.getLastQuarterFirstDay = (year,month)->\n\tif !year\n\t\tyear = new Date().getFullYear()\n\tif !month\n\t\tmonth = new Date().getMonth()\n\t\n\tif month < 3\n\t\tyear--\n\t\tmonth = 9\n\telse if month < 6\n\t\tmonth = 0\n\telse if month < 9\n\t\tmonth = 3\n\telse \n\t\tmonth = 6\n\t\n\treturn new Date(year, month, 1)\n\t\n\nCreator.getNextQuarterFirstDay = (year,month)->\n\tif !year\n\t\tyear = new Date().getFullYear()\n\tif !month\n\t\tmonth = new Date().getMonth()\n\t\n\tif month < 3\n\t\tmonth = 3\n\telse if month < 6\n\t\tmonth = 6\n\telse if month < 9\n\t\tmonth = 9\n\telse\n\t\tyear++\n\t\tmonth = 0\n\t\n\treturn new Date(year, month, 1)\n\nCreator.getMonthDays = (year,month)->\n\tif month == 11\n\t\treturn 31\n\t\n\tmillisecond = 1000 * 60 * 60 * 24\n\tstartDate = new Date(year, month, 1)\n\tendDate = new Date(year, month+1, 1)\n\tdays = (endDate-startDate)/millisecond\n\treturn days\n\nCreator.getLastMonthFirstDay = (year, month)->\n\tif !year\n\t\tyear = new Date().getFullYear()\n\tif !month\n\t\tmonth = new Date().getMonth()\n\t\n\t# æœˆä»½ä¸º0ä»£è¡¨æœ¬å¹´çš„ç¬¬ä¸€æœˆ\n\tif month == 0\n\t\tmonth = 11\n\t\tyear--\n\t\treturn new Date(year, month, 1)\n\t\n\t# å¦åˆ™,åªå‡åŽ»æœˆä»½\n\tmonth--;\n\treturn new Date(year, month, 1)\n\t\nCreator.getBetweenTimeBuiltinValueItem = (field_type, key)->\n\t# è¿‡æ»¤å™¨betweenè¿ç®—ç¬¦ï¼ŒçŽ°ç®—æ—¥æœŸ/æ—¥æœŸæ—¶é—´ç±»åž‹å­—æ®µçš„valueså€¼\n\tnow = new Date()\n\t# ä¸€å¤©çš„æ¯«ç§’æ•°\n\tmillisecond = 1000 * 60 * 60 * 24\n\tyestday = new Date(now.getTime() - millisecond)\n\ttomorrow = new Date(now.getTime() + millisecond)\n\t# ä¸€å‘¨ä¸­çš„æŸä¸€å¤©\n\tweek = now.getDay()\n\t# å‡åŽ»çš„å¤©æ•°\n\tminusDay = if week != 0 then week - 1 else 6\n\tmonday = new Date(now.getTime() - (minusDay * millisecond))\n\tsunday = new Date(monday.getTime() + (6 * millisecond))\n\t# ä¸Šå‘¨æ—¥\n\tlastSunday = new Date(monday.getTime() - millisecond)\n\t# ä¸Šå‘¨ä¸€\n\tlastMonday = new Date(lastSunday.getTime() - (millisecond * 6))\n\t# ä¸‹å‘¨ä¸€\n\tnextMonday = new Date(sunday.getTime() + millisecond)\n\t# ä¸‹å‘¨æ—¥\n\tnextSunday = new Date(nextMonday.getTime() + (millisecond * 6))\n\tcurrentYear = now.getFullYear()\n\tpreviousYear = currentYear - 1\n\tnextYear = currentYear + 1\n\t# å½“å‰æœˆä»½\n\tcurrentMonth = now.getMonth()\n\t# è®¡æ•°å¹´ã€æœˆ\n\tyear = now.getFullYear()\n\tmonth = now.getMonth()\n\t# æœ¬æœˆç¬¬ä¸€å¤©\n\tfirstDay = new Date(currentYear,currentMonth,1)\n\n\t# å½“ä¸º12æœˆçš„æ—¶å€™å¹´ä»½éœ€è¦åŠ 1\n\t# æœˆä»½éœ€è¦æ›´æ–°ä¸º0 ä¹Ÿå°±æ˜¯ä¸‹ä¸€å¹´çš„ç¬¬ä¸€ä¸ªæœˆ\n\tif currentMonth == 11\n\t\tyear++\n\t\tmonth++\n\telse\n\t\tmonth++\n\t\n\t# ä¸‹æœˆç¬¬ä¸€å¤©\n\tnextMonthFirstDay = new Date(year, month, 1)\n\t# ä¸‹æœˆæœ€åŽä¸€å¤©\n\tnextMonthFinalDay = new Date(year,month,Creator.getMonthDays(year,month))\n\t# æœ¬æœˆæœ€åŽä¸€å¤©\n\tlastDay = new Date(nextMonthFirstDay.getTime() - millisecond)\n\t# ä¸Šæœˆç¬¬ä¸€å¤©\n\tlastMonthFirstDay = Creator.getLastMonthFirstDay(currentYear,currentMonth)\n\t# ä¸Šæœˆæœ€åŽä¸€å¤©\n\tlastMonthFinalDay = new Date(firstDay.getTime() - millisecond)\n\t# æœ¬å­£åº¦å¼€å§‹æ—¥\n\tthisQuarterStartDay = new Date(currentYear,Creator.getQuarterStartMonth(currentMonth),1)\n\t# æœ¬å­£åº¦ç»“æŸæ—¥\n\tthisQuarterEndDay = new Date(currentYear,Creator.getQuarterStartMonth(currentMonth)+2,Creator.getMonthDays(currentYear,Creator.getQuarterStartMonth(currentMonth)+2))\n\t# ä¸Šå­£åº¦å¼€å§‹æ—¥\n\tlastQuarterStartDay = Creator.getLastQuarterFirstDay(currentYear,currentMonth)\n\t# ä¸Šå­£åº¦ç»“æŸæ—¥\n\tlastQuarterEndDay = new Date(lastQuarterStartDay.getFullYear(),lastQuarterStartDay.getMonth()+2,Creator.getMonthDays(lastQuarterStartDay.getFullYear(),lastQuarterStartDay.getMonth()+2))\n\t# ä¸‹å­£åº¦å¼€å§‹æ—¥\n\tnextQuarterStartDay = Creator.getNextQuarterFirstDay(currentYear,currentMonth)\n\t# ä¸‹å­£åº¦ç»“æŸæ—¥\n\tnextQuarterEndDay = new Date(nextQuarterStartDay.getFullYear(),nextQuarterStartDay.getMonth()+2,Creator.getMonthDays(nextQuarterStartDay.getFullYear(),nextQuarterStartDay.getMonth()+2))\n\t# è¿‡åŽ»7å¤© \n\tlast_7_days = new Date(now.getTime() - (6 * millisecond))\n\t# è¿‡åŽ»30å¤©\n\tlast_30_days = new Date(now.getTime() - (29 * millisecond))\n\t# è¿‡åŽ»60å¤©\n\tlast_60_days = new Date(now.getTime() - (59 * millisecond))\n\t# è¿‡åŽ»90å¤©\n\tlast_90_days = new Date(now.getTime() - (89 * millisecond))\n\t# è¿‡åŽ»120å¤©\n\tlast_120_days = new Date(now.getTime() - (119 * millisecond))\n\t# æœªæ¥7å¤© \n\tnext_7_days = new Date(now.getTime() + (6 * millisecond))\n\t# æœªæ¥30å¤©\n\tnext_30_days = new Date(now.getTime() + (29 * millisecond))\n\t# æœªæ¥60å¤©\n\tnext_60_days = new Date(now.getTime() + (59 * millisecond))\n\t# æœªæ¥90å¤©\n\tnext_90_days = new Date(now.getTime() + (89 * millisecond))\n\t# æœªæ¥120å¤©\n\tnext_120_days = new Date(now.getTime() + (119 * millisecond))\n\n\tswitch key\n\t\twhen \"last_year\"\n\t\t\t#åŽ»å¹´\n\t\t\tlabel = t(\"creator_filter_operation_between_last_year\")\n\t\t\tstartValue = new Date(\"#{previousYear}-01-01T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{previousYear}-12-31T23:59:59Z\")\n\t\twhen \"this_year\"\n\t\t\t#ä»Šå¹´\n\t\t\tlabel = t(\"creator_filter_operation_between_this_year\")\n\t\t\tstartValue = new Date(\"#{currentYear}-01-01T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{currentYear}-12-31T23:59:59Z\")\n\t\twhen \"next_year\"\n\t\t\t#æ˜Žå¹´\n\t\t\tlabel = t(\"creator_filter_operation_between_next_year\")\n\t\t\tstartValue = new Date(\"#{nextYear}-01-01T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{nextYear}-12-31T23:59:59Z\")\n\t\twhen \"last_quarter\"\n\t\t\t#ä¸Šå­£åº¦\n\t\t\tstrFirstDay = moment(lastQuarterStartDay).format(\"YYYY-MM-DD\")\n\t\t\tstrLastDay = moment(lastQuarterEndDay).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_quarter\")\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\n\t\twhen \"this_quarter\"\n\t\t\t#æœ¬å­£åº¦\n\t\t\tstrFirstDay = moment(thisQuarterStartDay).format(\"YYYY-MM-DD\")\n\t\t\tstrLastDay = moment(thisQuarterEndDay).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_this_quarter\")\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\n\t\twhen \"next_quarter\"\n\t\t\t#ä¸‹å­£åº¦\n\t\t\tstrFirstDay = moment(nextQuarterStartDay).format(\"YYYY-MM-DD\")\n\t\t\tstrLastDay = moment(nextQuarterEndDay).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_quarter\")\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\n\t\twhen \"last_month\"\n\t\t\t#ä¸Šæœˆ\n\t\t\tstrFirstDay = moment(lastMonthFirstDay).format(\"YYYY-MM-DD\")\n\t\t\tstrLastDay = moment(lastMonthFinalDay).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_month\")\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\n\t\twhen \"this_month\"\n\t\t\t#æœ¬æœˆ\n\t\t\tstrFirstDay = moment(firstDay).format(\"YYYY-MM-DD\")\n\t\t\tstrLastDay = moment(lastDay).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_this_month\")\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\n\t\twhen \"next_month\"\n\t\t\t#ä¸‹æœˆ\n\t\t\tstrFirstDay = moment(nextMonthFirstDay).format(\"YYYY-MM-DD\")\n\t\t\tstrLastDay = moment(nextMonthFinalDay).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_month\")\n\t\t\tstartValue = new Date(\"#{strFirstDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strLastDay}T23:59:59Z\")\n\t\twhen \"last_week\"\n\t\t\t#ä¸Šå‘¨\n\t\t\tstrMonday = moment(lastMonday).format(\"YYYY-MM-DD\")\n\t\t\tstrSunday = moment(lastSunday).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_week\")\n\t\t\tstartValue = new Date(\"#{strMonday}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strSunday}T23:59:59Z\")\n\t\twhen \"this_week\"\n\t\t\t#æœ¬å‘¨\n\t\t\tstrMonday = moment(monday).format(\"YYYY-MM-DD\")\n\t\t\tstrSunday = moment(sunday).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_this_week\")\n\t\t\tstartValue = new Date(\"#{strMonday}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strSunday}T23:59:59Z\")\n\t\twhen \"next_week\"\n\t\t\t#ä¸‹å‘¨\n\t\t\tstrMonday = moment(nextMonday).format(\"YYYY-MM-DD\")\n\t\t\tstrSunday = moment(nextSunday).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_week\")\n\t\t\tstartValue = new Date(\"#{strMonday}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strSunday}T23:59:59Z\")\n\t\twhen \"yestday\"\n\t\t\t#æ˜¨å¤©\n\t\t\tstrYestday = moment(yestday).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_yestday\")\n\t\t\tstartValue = new Date(\"#{strYestday}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strYestday}T23:59:59Z\")\n\t\twhen \"today\"\n\t\t\t#ä»Šå¤©\n\t\t\tstrToday = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_today\")\n\t\t\tstartValue = new Date(\"#{strToday}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strToday}T23:59:59Z\")\n\t\twhen \"tomorrow\"\n\t\t\t#æ˜Žå¤©\n\t\t\tstrTomorrow = moment(tomorrow).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_tomorrow\")\n\t\t\tstartValue = new Date(\"#{strTomorrow}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strTomorrow}T23:59:59Z\")\n\t\twhen \"last_7_days\"\n\t\t\t#è¿‡åŽ»7å¤©\n\t\t\tstrStartDay = moment(last_7_days).format(\"YYYY-MM-DD\") \n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_7_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"last_30_days\"\n\t\t\t#è¿‡åŽ»30å¤©\n\t\t\tstrStartDay = moment(last_30_days).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_30_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"last_60_days\"\n\t\t\t#è¿‡åŽ»60å¤©\n\t\t\tstrStartDay = moment(last_60_days).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_60_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"last_90_days\"\n\t\t\t#è¿‡åŽ»90å¤©\n\t\t\tstrStartDay = moment(last_90_days).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_90_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"last_120_days\"\n\t\t\t#è¿‡åŽ»120å¤©\n\t\t\tstrStartDay = moment(last_120_days).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_last_120_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"next_7_days\"\n\t\t\t#æœªæ¥7å¤©\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(next_7_days).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_7_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"next_30_days\"\n\t\t\t#æœªæ¥30å¤©\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(next_30_days).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_30_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"next_60_days\"\n\t\t\t#æœªæ¥60å¤©\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(next_60_days).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_60_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"next_90_days\"\n\t\t\t#æœªæ¥90å¤©\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(next_90_days).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_90_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\twhen \"next_120_days\"\n\t\t\t#æœªæ¥120å¤©\n\t\t\tstrStartDay = moment(now).format(\"YYYY-MM-DD\")\n\t\t\tstrEndDay = moment(next_120_days).format(\"YYYY-MM-DD\")\n\t\t\tlabel = t(\"creator_filter_operation_between_next_120_days\")\n\t\t\tstartValue = new Date(\"#{strStartDay}T00:00:00Z\")\n\t\t\tendValue = new Date(\"#{strEndDay}T23:59:59Z\")\n\t\n\tvalues = [startValue, endValue]\n\tif field_type == \"datetime\"\n\t\t# æ—¶é—´ç±»åž‹å­—æ®µï¼Œå†…ç½®æ—¶é—´èŒƒå›´åº”è¯¥è€ƒè™‘åç§»æ—¶åŒºå€¼ï¼Œå¦åˆ™è¿‡æ»¤æ•°æ®å­˜åœ¨åå·®\n\t\t# éžå†…ç½®æ—¶é—´èŒƒå›´æ—¶ï¼Œç”¨æˆ·é€šè¿‡æ—¶é—´æŽ§ä»¶é€‰æ‹©çš„èŒƒå›´ï¼Œä¼šè‡ªåŠ¨å¤„ç†æ—¶åŒºåå·®æƒ…å†µ\n\t\t# æ—¥æœŸç±»åž‹å­—æ®µï¼Œæ•°æ®åº“æœ¬æ¥å°±å­˜çš„æ˜¯UTCçš„0ç‚¹ï¼Œä¸å­˜åœ¨åå·®\n\t\t_.forEach values, (fv)->\n\t\t\tif fv\n\t\t\t\tfv.setHours(fv.getHours() + fv.getTimezoneOffset() / 60 )\n\t\n\treturn {\n\t\tlabel: label\n\t\tkey: key\n\t\tvalues: values\n\t}\n\nCreator.getFieldDefaultOperation = (field_type)->\n\tif field_type && Creator.checkFieldTypeSupportBetweenQuery(field_type)\n\t\treturn 'between'\n\telse if [\"textarea\", \"text\", \"code\"].includes(field_type)\n\t\treturn 'contains'\n\telse\n\t\treturn \"=\"\n\nCreator.getFieldOperation = (field_type) ->\n\t# æ—¥æœŸç±»åž‹: date, datetime  æ”¯æŒæ“ä½œç¬¦: \"=\", \"<>\", \"<\", \">\", \"<=\", \">=\"\n\t# æ–‡æœ¬ç±»åž‹: text, textarea, html  æ”¯æŒæ“ä½œç¬¦: \"=\", \"<>\", \"contains\", \"notcontains\", \"startswith\"\n\t# é€‰æ‹©ç±»åž‹: lookup, master_detail, select æ”¯æŒæ“ä½œç¬¦: \"=\", \"<>\"\n\t# æ•°å€¼ç±»åž‹: currency, number  æ”¯æŒæ“ä½œç¬¦: \"=\", \"<>\", \"<\", \">\", \"<=\", \">=\"\n\t# å¸ƒå°”ç±»åž‹: boolean  æ”¯æŒæ“ä½œç¬¦: \"=\", \"<>\"\n\t# æ•°ç»„ç±»åž‹: checkbox, [text]  æ”¯æŒæ“ä½œç¬¦: \"=\", \"<>\"\n\n\toptionals = {\n\t\tequal: {label: t(\"creator_filter_operation_equal\"), value: \"=\"},\n\t\tunequal: {label: t(\"creator_filter_operation_unequal\"), value: \"<>\"},\n\t\tless_than: {label: t(\"creator_filter_operation_less_than\"), value: \"<\"},\n\t\tgreater_than: {label: t(\"creator_filter_operation_greater_than\"), value: \">\"},\n\t\tless_or_equal: {label: t(\"creator_filter_operation_less_or_equal\"), value: \"<=\"},\n\t\tgreater_or_equal: {label: t(\"creator_filter_operation_greater_or_equal\"), value: \">=\"},\n\t\tcontains: {label: t(\"creator_filter_operation_contains\"), value: \"contains\"},\n\t\tnot_contain: {label: t(\"creator_filter_operation_does_not_contain\"), value: \"notcontains\"},\n\t\tstarts_with: {label: t(\"creator_filter_operation_starts_with\"), value: \"startswith\"},\n\t\tbetween: {label: t(\"creator_filter_operation_between\"), value: \"between\"},\n\t}\n\n\tif field_type == undefined\n\t\treturn _.values(optionals)\n\n\toperations = []\n\n\tif Creator.checkFieldTypeSupportBetweenQuery(field_type)\n\t\toperations.push(optionals.between)\n\t\tCreator.pushBetweenBuiltinOptionals(field_type, operations)\n\telse if field_type == \"text\" or field_type == \"textarea\" or field_type == \"html\" or field_type == \"code\"\n#\t\toperations.push(optionals.equal, optionals.unequal, optionals.contains, optionals.not_contain, optionals.starts_with)\n\t\toperations.push(optionals.contains)\n\telse if field_type == \"lookup\" or field_type == \"master_detail\" or field_type == \"select\"\n\t\toperations.push(optionals.equal, optionals.unequal)\n\telse if field_type == \"currency\" or field_type == \"number\"\n\t\toperations.push(optionals.equal, optionals.unequal, optionals.less_than, optionals.greater_than, optionals.less_or_equal, optionals.greater_or_equal)\n\telse if field_type == \"boolean\"\n\t\toperations.push(optionals.equal, optionals.unequal)\n\telse if field_type == \"checkbox\"\n\t\toperations.push(optionals.equal, optionals.unequal)\n\telse if field_type == \"[text]\"\n\t\toperations.push(optionals.equal, optionals.unequal)\n\telse\n\t\toperations.push(optionals.equal, optionals.unequal)\n\n\treturn operations\n\n###\n    å…ˆæŒ‰ç…§æœ‰æŽ’åºå·çš„å°çš„åœ¨å‰ï¼Œå¤§çš„åœ¨åŽ\n    å†å°†æ²¡æœ‰æŽ’åºå·çš„æ˜¾ç¤ºåœ¨\n###\nCreator.getObjectFieldsName = (object_name)->\n\tfields = Creator.getObject(object_name)?.fields\n\tfieldsArr = []\n\n\t_.each fields, (field)->\n\t\tfieldsArr.push {name: field.name, sort_no: field.sort_no}\n\n\tfieldsName = []\n\t_.each _.sortBy(fieldsArr, \"sort_no\"), (field)->\n\t\tfieldsName.push(field.name)\n\treturn fieldsName\n","Creator.getSelectOptions = function(fieldSchema) {\n  var data_type, options;\n  options = fieldSchema.options;\n  if (!options) {\n    return;\n  }\n  data_type = fieldSchema.data_type;\n  if (!_.isFunction(options) && data_type && data_type !== 'text') {\n    options.forEach(function(optionItem) {\n      if (typeof optionItem.value !== 'string') {\n        return;\n      }\n      if (['number', 'currency', 'percent'].indexOf(data_type) > -1) {\n        return optionItem.value = Number(optionItem.value);\n      } else if (data_type === 'boolean') {\n        return optionItem.value = optionItem.value === 'true';\n      }\n    });\n  }\n  return options;\n};\n\nCreator.getObjectSchema = function(obj) {\n  var fieldsArr, schema;\n  if (!obj) {\n    return;\n  }\n  schema = {};\n  fieldsArr = [];\n  _.each(obj.fields, function(field, field_name) {\n    if (!_.has(field, \"name\")) {\n      field.name = field_name;\n    }\n    return fieldsArr.push(field);\n  });\n  _.each(_.sortBy(fieldsArr, \"sort_no\"), function(field) {\n    var _object, _ref_obj, _reference_to, autoform_type, collectionName, field_name, fs, fsType, isUnLimited, permissions, ref, ref1, ref2, ref3;\n    field_name = field.name;\n    fs = {};\n    if (field.regEx) {\n      fs.regEx = field.regEx;\n    }\n    fs.autoform = {};\n    fs.autoform.multiple = field.multiple;\n    fs.autoform.reference_to = field.reference_to;\n    autoform_type = (ref = field.autoform) != null ? ref.type : void 0;\n    if (field.type === \"text\" || field.type === \"phone\") {\n      fs.type = String;\n      if (field.multiple) {\n        fs.type = [String];\n        fs.autoform.type = \"tags\";\n      }\n    } else if (field.type === \"[text]\" || field.type === \"[phone]\") {\n      fs.type = [String];\n      fs.autoform.type = \"tags\";\n    } else if (field.type === 'code') {\n      fs.type = String;\n      fs.autoform.type = \"widearea\";\n      fs.autoform.rows = field.rows || 12;\n      if (field.language) {\n        fs.autoform.language = field.language;\n      }\n    } else if (field.type === \"textarea\") {\n      fs.type = String;\n      fs.autoform.type = \"widearea\";\n      fs.autoform.rows = field.rows || 2;\n    } else if (field.type === \"password\") {\n      fs.type = String;\n      fs.autoform.type = \"password\";\n    } else if (field.type === \"date\") {\n      fs.type = Date;\n      if (Meteor.isClient) {\n        if (Steedos.isMobile() || Steedos.isPad()) {\n          if (Steedos.isiOS()) {\n            fs.autoform.afFieldInput = {\n              type: \"dx-date-box\",\n              timezoneId: \"utc\",\n              dxDateBoxOptions: {\n                type: \"date\",\n                displayFormat: \"yyyy-MM-dd\",\n                pickerType: \"rollers\"\n              }\n            };\n          } else {\n            fs.autoform.afFieldInput = {\n              type: \"steedos-date-mobile\",\n              dateMobileOptions: {\n                type: \"date\"\n              }\n            };\n          }\n        } else {\n          fs.autoform.outFormat = 'yyyy-MM-dd';\n          fs.autoform.afFieldInput = {\n            type: \"dx-date-box\",\n            timezoneId: \"utc\",\n            dxDateBoxOptions: {\n              type: \"date\",\n              displayFormat: \"yyyy-MM-dd\"\n            }\n          };\n        }\n      }\n    } else if (field.type === \"time\") {\n      fs.type = Date;\n      if (Meteor.isClient) {\n        fs.autoform.afFieldInput = {\n          type: \"dx-date-box\",\n          timezoneId: \"utc\",\n          dxDateBoxOptions: {\n            type: \"time\",\n            displayFormat: \"HH:mm\"\n          }\n        };\n      }\n    } else if (field.type === \"datetime\") {\n      fs.type = Date;\n      if (Meteor.isClient) {\n        if (Steedos.isMobile() || Steedos.isPad()) {\n          if (Steedos.isiOS()) {\n            fs.autoform.afFieldInput = {\n              type: \"dx-date-box\",\n              dxDateBoxOptions: {\n                type: \"datetime\",\n                displayFormat: \"yyyy-MM-dd HH:mm\",\n                pickerType: \"rollers\"\n              }\n            };\n          } else {\n            fs.autoform.afFieldInput = {\n              type: \"steedos-date-mobile\",\n              dateMobileOptions: {\n                type: \"datetime\"\n              }\n            };\n          }\n        } else {\n          fs.autoform.afFieldInput = {\n            type: \"dx-date-box\",\n            dxDateBoxOptions: {\n              type: \"datetime\",\n              displayFormat: \"yyyy-MM-dd HH:mm\"\n            }\n          };\n        }\n      }\n    } else if (field.type === \"[Object]\") {\n      fs.type = [Object];\n    } else if (field.type === \"html\") {\n      fs.type = String;\n      if (Meteor.isClient) {\n        fs.autoform.type = 'steedosHtml';\n      }\n    } else if (field.type === \"lookup\" || field.type === \"master_detail\") {\n      fs.type = String;\n      fs.autoform.showIcon = field.showIcon;\n      if (field.multiple) {\n        fs.type = [String];\n      }\n      if (!field.hidden) {\n        fs.autoform.filters = field.filters;\n        fs.autoform.dependOn = field.depend_on;\n        if (field.beforeOpenFunction) {\n          fs.beforeOpenFunction = field.beforeOpenFunction;\n        }\n        fs.filtersFunction = field.filtersFunction ? field.filtersFunction : Creator.evaluateFilters;\n        if (field.optionsFunction) {\n          fs.optionsFunction = field.optionsFunction;\n        }\n        if (field.reference_to) {\n          if (Meteor.isClient) {\n            if (field.createFunction && _.isFunction(field.createFunction)) {\n              fs.createFunction = field.createFunction;\n            } else {\n              if (_.isString(field.reference_to)) {\n                _ref_obj = Creator.Objects[field.reference_to];\n                if (_ref_obj != null ? (ref1 = _ref_obj.permissions) != null ? ref1.allowCreate : void 0 : void 0) {\n                  fs.autoform.create = true;\n                  fs.createFunction = function(lookup_field) {\n                    return Modal.show(\"CreatorObjectModal\", {\n                      collection: \"Creator.Collections.\" + (Creator.getCollection(field.reference_to)._name),\n                      formId: \"new\" + (field.reference_to.replace('.', '_')),\n                      object_name: \"\" + field.reference_to,\n                      operation: \"insert\",\n                      onSuccess: function(operation, result) {\n                        var object;\n                        object = Creator.getObject(result.object_name);\n                        if (result.object_name === \"objects\") {\n                          return lookup_field.addItems([\n                            {\n                              label: result.value.label,\n                              value: result.value.name,\n                              icon: result.value.icon\n                            }\n                          ], result.value.name);\n                        } else {\n                          return lookup_field.addItems([\n                            {\n                              label: result.value[object.NAME_FIELD_KEY] || result.value.label || result.value.name,\n                              value: result._id\n                            }\n                          ], result._id);\n                        }\n                      }\n                    });\n                  };\n                } else {\n                  fs.autoform.create = false;\n                }\n              }\n            }\n          }\n          if (_.isBoolean(field.create)) {\n            fs.autoform.create = field.create;\n          }\n          if (field.reference_sort) {\n            fs.autoform.optionsSort = field.reference_sort;\n          }\n          if (field.reference_limit) {\n            fs.autoform.optionsLimit = field.reference_limit;\n          }\n          if (field.reference_to_field) {\n            fs.autoform.referenceToField = field.reference_to_field;\n          }\n          if (field.reference_to === \"users\") {\n            fs.autoform.type = \"selectuser\";\n            if (!field.hidden && !field.omit) {\n              if (field.is_company_limited === void 0) {\n                if (Meteor.isClient) {\n                  permissions = (ref2 = obj.permissions) != null ? ref2.get() : void 0;\n                  isUnLimited = permissions != null ? permissions.viewAllRecords : void 0;\n                  if (_.include([\"organizations\", \"users\", \"space_users\"], obj.name)) {\n                    isUnLimited = permissions != null ? permissions.modifyAllRecords : void 0;\n                  }\n                  if (isUnLimited) {\n                    fs.autoform.is_company_limited = false;\n                  } else {\n                    fs.autoform.is_company_limited = true;\n                  }\n                }\n              } else if (_.isFunction(field.is_company_limited)) {\n                if (Meteor.isClient) {\n                  fs.autoform.is_company_limited = field.is_company_limited(obj.permissions);\n                } else {\n                  fs.autoform.is_company_limited = true;\n                }\n              } else {\n                fs.autoform.is_company_limited = field.is_company_limited;\n              }\n            } else {\n              fs.autoform.is_company_limited = field.is_company_limited;\n            }\n          } else if (field.reference_to === \"organizations\") {\n            fs.autoform.type = \"selectorg\";\n            if (!field.hidden && !field.omit) {\n              if (field.is_company_limited === void 0) {\n                if (Meteor.isClient) {\n                  permissions = (ref3 = obj.permissions) != null ? ref3.get() : void 0;\n                  isUnLimited = permissions != null ? permissions.viewAllRecords : void 0;\n                  if (_.include([\"organizations\", \"users\", \"space_users\"], obj.name)) {\n                    isUnLimited = permissions != null ? permissions.modifyAllRecords : void 0;\n                  }\n                  if (isUnLimited) {\n                    fs.autoform.is_company_limited = false;\n                  } else {\n                    fs.autoform.is_company_limited = true;\n                  }\n                }\n              } else if (_.isFunction(field.is_company_limited)) {\n                if (Meteor.isClient) {\n                  fs.autoform.is_company_limited = field.is_company_limited(obj.permissions);\n                } else {\n                  fs.autoform.is_company_limited = true;\n                }\n              } else {\n                fs.autoform.is_company_limited = field.is_company_limited;\n              }\n            } else {\n              fs.autoform.is_company_limited = field.is_company_limited;\n            }\n          } else {\n            if (typeof field.reference_to === \"function\") {\n              _reference_to = field.reference_to();\n            } else {\n              _reference_to = field.reference_to;\n            }\n            if (_.isArray(_reference_to)) {\n              fs.type = Object;\n              fs.blackbox = true;\n              fs.autoform.objectSwitche = true;\n              schema[field_name + \".o\"] = {\n                type: String,\n                autoform: {\n                  omit: true\n                }\n              };\n              schema[field_name + \".ids\"] = {\n                type: [String],\n                autoform: {\n                  omit: true\n                }\n              };\n            } else {\n              _reference_to = [_reference_to];\n            }\n            _object = Creator.Objects[_reference_to[0]];\n            if (_object && _object.enable_tree) {\n              fs.autoform.type = \"selectTree\";\n            } else {\n              fs.autoform.type = \"steedosLookups\";\n              fs.autoform.optionsMethod = field.optionsMethod || \"creator.object_options\";\n              if (Meteor.isClient) {\n                fs.autoform.optionsMethodParams = function() {\n                  return {\n                    space: Session.get(\"spaceId\")\n                  };\n                };\n                fs.autoform.references = [];\n                _reference_to.forEach(function(_reference) {\n                  _object = Creator.Objects[_reference];\n                  if (_object) {\n                    return fs.autoform.references.push({\n                      object: _reference,\n                      label: _object != null ? _object.label : void 0,\n                      icon: _object != null ? _object.icon : void 0,\n                      link: function() {\n                        return \"/app/\" + (Session.get('app_id')) + \"/\" + _reference + \"/view/\";\n                      }\n                    });\n                  } else {\n                    return fs.autoform.references.push({\n                      object: _reference,\n                      link: function() {\n                        return \"/app/\" + (Session.get('app_id')) + \"/\" + _reference + \"/view/\";\n                      }\n                    });\n                  }\n                });\n              }\n            }\n          }\n        } else {\n          fs.autoform.type = \"steedosLookups\";\n          fs.autoform.defaultIcon = field.defaultIcon;\n        }\n      }\n    } else if (field.type === \"select\") {\n      fs.type = String;\n      if (field.multiple) {\n        fs.type = [String];\n        fs.autoform.type = \"steedosLookups\";\n        fs.autoform.showIcon = false;\n        fs.autoform.options = field.options;\n      } else {\n        fs.autoform.type = \"select\";\n        fs.autoform.options = field.options;\n        if (_.has(field, 'firstOption')) {\n          fs.autoform.firstOption = field.firstOption;\n        } else {\n          fs.autoform.firstOption = \"\";\n        }\n      }\n      if (field.data_type && field.data_type !== \"text\") {\n        if ([\"number\", \"currency\", \"percent\"].indexOf(field.data_type) > -1) {\n          fsType = Number;\n          fs.decimal = true;\n        } else if (field.data_type === \"boolean\") {\n          fsType = Boolean;\n        } else {\n          fsType = String;\n        }\n        fs.type = fsType;\n        if (field.multiple) {\n          fs.type = [fsType];\n        }\n        fs.autoform.options = Creator.getSelectOptions(field);\n      }\n    } else if (field.type === \"currency\") {\n      fs.type = Number;\n      fs.autoform.type = \"steedosNumber\";\n      fs.autoform.precision = field.precision || 18;\n      if (field != null ? field.scale : void 0) {\n        fs.autoform.scale = field.scale;\n        fs.decimal = true;\n      } else if ((field != null ? field.scale : void 0) !== 0) {\n        fs.autoform.scale = 2;\n        fs.decimal = true;\n      }\n    } else if (field.type === \"number\") {\n      fs.type = Number;\n      fs.autoform.type = \"steedosNumber\";\n      fs.autoform.precision = field.precision || 18;\n      if (field != null ? field.scale : void 0) {\n        fs.autoform.scale = field.scale;\n        fs.decimal = true;\n      }\n    } else if (field.type === \"boolean\") {\n      fs.type = Boolean;\n      if (field.readonly) {\n        fs.autoform.disabled = true;\n      }\n      fs.autoform.type = \"steedos-boolean-checkbox\";\n    } else if (field.type === \"toggle\") {\n      fs.type = Boolean;\n      if (field.readonly) {\n        fs.autoform.disabled = true;\n      }\n      fs.autoform.type = \"steedos-boolean-toggle\";\n    } else if (field.type === \"reference\") {\n      fs.type = String;\n    } else if (field.type === \"checkbox\") {\n      fs.type = [String];\n      fs.autoform.type = \"select-checkbox\";\n      fs.autoform.options = field.options;\n    } else if (field.type === \"file\") {\n      collectionName = field.collection || \"files\";\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: collectionName\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = collectionName;\n      }\n    } else if (field.type === \"filesize\") {\n      fs.type = Number;\n      fs.autoform.type = 'filesize';\n    } else if (field.type === \"Object\" || field.type === \"object\") {\n      fs.type = Object;\n    } else if (field.type === \"grid\") {\n      fs.type = Array;\n      fs.autoform.editable = true;\n      fs.autoform.type = \"steedosGrid\";\n      schema[field_name + \".$\"] = {\n        type: Object\n      };\n    } else if (field.type === \"image\") {\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: 'images',\n            accept: 'image/*'\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = 'images';\n        fs.autoform.accept = 'image/*';\n      }\n    } else if (field.type === \"avatar\") {\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: 'avatars',\n            accept: 'image/*'\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = 'avatars';\n        fs.autoform.accept = 'image/*';\n      }\n    } else if (field.type === \"audio\") {\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: 'audios',\n            accept: 'audio/*'\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = 'audios';\n        fs.autoform.accept = 'audio/*';\n      }\n    } else if (field.type === \"video\") {\n      if (field.multiple) {\n        fs.type = [String];\n        schema[field_name + \".$\"] = {\n          autoform: {\n            type: 'fileUpload',\n            collection: 'videos',\n            accept: 'video/*'\n          }\n        };\n      } else {\n        fs.type = String;\n        fs.autoform.type = 'fileUpload';\n        fs.autoform.collection = 'videos';\n        fs.autoform.accept = 'video/*';\n      }\n    } else if (field.type === \"location\") {\n      fs.type = Object;\n      fs.autoform.type = \"location\";\n      fs.autoform.system = field.system || \"wgs84\";\n      fs.blackbox = true;\n    } else if (field.type === \"markdown\") {\n      fs.type = String;\n      fs.autoform.type = \"text\";\n    } else if (field.type === 'url') {\n      fs.type = String;\n      fs.autoform.type = 'steedosUrl';\n    } else if (field.type === 'email') {\n      fs.type = String;\n      fs.regEx = SimpleSchema.RegEx.Email;\n      fs.autoform.type = 'steedosEmail';\n    } else if (field.type === 'autonumber') {\n      fs.type = String;\n    } else if (field.type === 'formula') {\n      fs = Creator.getObjectSchema({\n        fields: {\n          field: Object.assign({}, field, {\n            type: field.data_type\n          })\n        }\n      })[field.name];\n    } else if (field.type === 'summary') {\n      fs = Creator.getObjectSchema({\n        fields: {\n          field: Object.assign({}, field, {\n            type: field.data_type\n          })\n        }\n      })[field.name];\n    } else if (field.type === 'percent') {\n      fs.type = Number;\n      fs.autoform.type = \"steedosNumber\";\n      fs.autoform.precision = field.precision || 18;\n      if (!_.isNumber(field.scale)) {\n        field.scale = 0;\n      }\n      fs.autoform.scale = field.scale + 2;\n      fs.decimal = true;\n    } else {\n      fs.type = field.type;\n    }\n    if (field.label) {\n      fs.label = field.label;\n    }\n    if (!field.required) {\n      fs.optional = true;\n    }\n    if (!Meteor.isClient) {\n      fs.optional = true;\n    }\n    if (field.unique) {\n      fs.unique = true;\n    }\n    if (field.omit) {\n      fs.autoform.omit = true;\n    }\n    if (field.group) {\n      fs.autoform.group = field.group;\n    }\n    if (field.is_wide) {\n      fs.autoform.is_wide = true;\n    }\n    if (field.hidden) {\n      fs.autoform.type = \"hidden\";\n    }\n    if ((field.type === \"select\") || (field.type === \"lookup\") || (field.type === \"master_detail\")) {\n      if (typeof field.filterable === 'undefined') {\n        field.filterable = true;\n      }\n    }\n    if (field.name === 'name' || field.is_name) {\n      if (typeof field.searchable === 'undefined') {\n        field.searchable = true;\n      }\n    }\n    if (autoform_type) {\n      fs.autoform.type = autoform_type;\n    }\n    if (field.defaultValue) {\n      if (Meteor.isClient && Creator.Formular.checkFormula(field.defaultValue)) {\n        fs.autoform.defaultValue = function() {\n          return Creator.Formular.run(field.defaultValue, {\n            userId: Meteor.userId(),\n            spaceId: Session.get(\"spaceId\"),\n            now: new Date()\n          });\n        };\n      } else {\n        fs.autoform.defaultValue = field.defaultValue;\n      }\n    }\n    if (field.readonly) {\n      fs.autoform.readonly = true;\n    }\n    if (field.disabled) {\n      fs.autoform.disabled = true;\n    }\n    if (field.inlineHelpText) {\n      fs.autoform.inlineHelpText = field.inlineHelpText;\n    }\n    if (field.blackbox) {\n      fs.blackbox = true;\n    }\n    if (_.has(field, 'min')) {\n      fs.min = field.min;\n    }\n    if (_.has(field, 'max')) {\n      fs.max = field.max;\n    }\n    if (Meteor.isProduction) {\n      if (field.index) {\n        fs.index = field.index;\n      } else if (field.sortable) {\n        fs.index = true;\n      }\n    }\n    return schema[field_name] = fs;\n  });\n  return schema;\n};\n\nCreator.getFieldDisplayValue = function(object_name, field_name, field_value) {\n  var field, html, object;\n  html = field_value;\n  object = Creator.getObject(object_name);\n  if (!object) {\n    return \"\";\n  }\n  field = object.fields(field_name);\n  if (!field) {\n    return \"\";\n  }\n  if (field.type === \"datetime\") {\n    html = moment(this.val).format('YYYY-MM-DD H:mm');\n  } else if (field.type === \"date\") {\n    html = moment(this.val).format('YYYY-MM-DD');\n  }\n  return html;\n};\n\nCreator.checkFieldTypeSupportBetweenQuery = function(field_type) {\n  return [\"date\", \"datetime\", \"time\", \"currency\", \"number\"].includes(field_type);\n};\n\nCreator.pushBetweenBuiltinOptionals = function(field_type, operations) {\n  var builtinValues;\n  builtinValues = Creator.getBetweenBuiltinValues(field_type);\n  if (builtinValues) {\n    return _.forEach(builtinValues, function(builtinItem, key) {\n      return operations.push({\n        label: builtinItem.label,\n        value: key\n      });\n    });\n  }\n};\n\nCreator.getBetweenBuiltinValues = function(field_type, is_check_only) {\n  if ([\"date\", \"datetime\"].includes(field_type)) {\n    return Creator.getBetweenTimeBuiltinValues(is_check_only, field_type);\n  }\n};\n\nCreator.getBetweenBuiltinValueItem = function(field_type, key) {\n  if ([\"date\", \"datetime\"].includes(field_type)) {\n    return Creator.getBetweenTimeBuiltinValueItem(field_type, key);\n  }\n};\n\nCreator.getBetweenBuiltinOperation = function(field_type, value) {\n  var betweenBuiltinValues, result;\n  if (!_.isString(value)) {\n    return;\n  }\n  betweenBuiltinValues = Creator.getBetweenBuiltinValues(field_type);\n  if (!betweenBuiltinValues) {\n    return;\n  }\n  result = null;\n  _.each(betweenBuiltinValues, function(item, operation) {\n    if (item.key === value) {\n      return result = operation;\n    }\n  });\n  return result;\n};\n\nCreator.getBetweenTimeBuiltinValues = function(is_check_only, field_type) {\n  return {\n    \"between_time_last_year\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_year\"),\n    \"between_time_this_year\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_year\"),\n    \"between_time_next_year\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_year\"),\n    \"between_time_last_quarter\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_quarter\"),\n    \"between_time_this_quarter\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_quarter\"),\n    \"between_time_next_quarter\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_quarter\"),\n    \"between_time_last_month\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_month\"),\n    \"between_time_this_month\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_month\"),\n    \"between_time_next_month\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_month\"),\n    \"between_time_last_week\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_week\"),\n    \"between_time_this_week\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"this_week\"),\n    \"between_time_next_week\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_week\"),\n    \"between_time_yestday\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"yestday\"),\n    \"between_time_today\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"today\"),\n    \"between_time_tomorrow\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"tomorrow\"),\n    \"between_time_last_7_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_7_days\"),\n    \"between_time_last_30_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_30_days\"),\n    \"between_time_last_60_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_60_days\"),\n    \"between_time_last_90_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_90_days\"),\n    \"between_time_last_120_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"last_120_days\"),\n    \"between_time_next_7_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_7_days\"),\n    \"between_time_next_30_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_30_days\"),\n    \"between_time_next_60_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_60_days\"),\n    \"between_time_next_90_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_90_days\"),\n    \"between_time_next_120_days\": is_check_only ? true : Creator.getBetweenTimeBuiltinValueItem(field_type, \"next_120_days\")\n  };\n};\n\nCreator.getQuarterStartMonth = function(month) {\n  if (!month) {\n    month = new Date().getMonth();\n  }\n  if (month < 3) {\n    return 0;\n  } else if (month < 6) {\n    return 3;\n  } else if (month < 9) {\n    return 6;\n  }\n  return 9;\n};\n\nCreator.getLastQuarterFirstDay = function(year, month) {\n  if (!year) {\n    year = new Date().getFullYear();\n  }\n  if (!month) {\n    month = new Date().getMonth();\n  }\n  if (month < 3) {\n    year--;\n    month = 9;\n  } else if (month < 6) {\n    month = 0;\n  } else if (month < 9) {\n    month = 3;\n  } else {\n    month = 6;\n  }\n  return new Date(year, month, 1);\n};\n\nCreator.getNextQuarterFirstDay = function(year, month) {\n  if (!year) {\n    year = new Date().getFullYear();\n  }\n  if (!month) {\n    month = new Date().getMonth();\n  }\n  if (month < 3) {\n    month = 3;\n  } else if (month < 6) {\n    month = 6;\n  } else if (month < 9) {\n    month = 9;\n  } else {\n    year++;\n    month = 0;\n  }\n  return new Date(year, month, 1);\n};\n\nCreator.getMonthDays = function(year, month) {\n  var days, endDate, millisecond, startDate;\n  if (month === 11) {\n    return 31;\n  }\n  millisecond = 1000 * 60 * 60 * 24;\n  startDate = new Date(year, month, 1);\n  endDate = new Date(year, month + 1, 1);\n  days = (endDate - startDate) / millisecond;\n  return days;\n};\n\nCreator.getLastMonthFirstDay = function(year, month) {\n  if (!year) {\n    year = new Date().getFullYear();\n  }\n  if (!month) {\n    month = new Date().getMonth();\n  }\n  if (month === 0) {\n    month = 11;\n    year--;\n    return new Date(year, month, 1);\n  }\n  month--;\n  return new Date(year, month, 1);\n};\n\nCreator.getBetweenTimeBuiltinValueItem = function(field_type, key) {\n  var currentMonth, currentYear, endValue, firstDay, label, lastDay, lastMonday, lastMonthFinalDay, lastMonthFirstDay, lastQuarterEndDay, lastQuarterStartDay, lastSunday, last_120_days, last_30_days, last_60_days, last_7_days, last_90_days, millisecond, minusDay, monday, month, nextMonday, nextMonthFinalDay, nextMonthFirstDay, nextQuarterEndDay, nextQuarterStartDay, nextSunday, nextYear, next_120_days, next_30_days, next_60_days, next_7_days, next_90_days, now, previousYear, startValue, strEndDay, strFirstDay, strLastDay, strMonday, strStartDay, strSunday, strToday, strTomorrow, strYestday, sunday, thisQuarterEndDay, thisQuarterStartDay, tomorrow, values, week, year, yestday;\n  now = new Date();\n  millisecond = 1000 * 60 * 60 * 24;\n  yestday = new Date(now.getTime() - millisecond);\n  tomorrow = new Date(now.getTime() + millisecond);\n  week = now.getDay();\n  minusDay = week !== 0 ? week - 1 : 6;\n  monday = new Date(now.getTime() - (minusDay * millisecond));\n  sunday = new Date(monday.getTime() + (6 * millisecond));\n  lastSunday = new Date(monday.getTime() - millisecond);\n  lastMonday = new Date(lastSunday.getTime() - (millisecond * 6));\n  nextMonday = new Date(sunday.getTime() + millisecond);\n  nextSunday = new Date(nextMonday.getTime() + (millisecond * 6));\n  currentYear = now.getFullYear();\n  previousYear = currentYear - 1;\n  nextYear = currentYear + 1;\n  currentMonth = now.getMonth();\n  year = now.getFullYear();\n  month = now.getMonth();\n  firstDay = new Date(currentYear, currentMonth, 1);\n  if (currentMonth === 11) {\n    year++;\n    month++;\n  } else {\n    month++;\n  }\n  nextMonthFirstDay = new Date(year, month, 1);\n  nextMonthFinalDay = new Date(year, month, Creator.getMonthDays(year, month));\n  lastDay = new Date(nextMonthFirstDay.getTime() - millisecond);\n  lastMonthFirstDay = Creator.getLastMonthFirstDay(currentYear, currentMonth);\n  lastMonthFinalDay = new Date(firstDay.getTime() - millisecond);\n  thisQuarterStartDay = new Date(currentYear, Creator.getQuarterStartMonth(currentMonth), 1);\n  thisQuarterEndDay = new Date(currentYear, Creator.getQuarterStartMonth(currentMonth) + 2, Creator.getMonthDays(currentYear, Creator.getQuarterStartMonth(currentMonth) + 2));\n  lastQuarterStartDay = Creator.getLastQuarterFirstDay(currentYear, currentMonth);\n  lastQuarterEndDay = new Date(lastQuarterStartDay.getFullYear(), lastQuarterStartDay.getMonth() + 2, Creator.getMonthDays(lastQuarterStartDay.getFullYear(), lastQuarterStartDay.getMonth() + 2));\n  nextQuarterStartDay = Creator.getNextQuarterFirstDay(currentYear, currentMonth);\n  nextQuarterEndDay = new Date(nextQuarterStartDay.getFullYear(), nextQuarterStartDay.getMonth() + 2, Creator.getMonthDays(nextQuarterStartDay.getFullYear(), nextQuarterStartDay.getMonth() + 2));\n  last_7_days = new Date(now.getTime() - (6 * millisecond));\n  last_30_days = new Date(now.getTime() - (29 * millisecond));\n  last_60_days = new Date(now.getTime() - (59 * millisecond));\n  last_90_days = new Date(now.getTime() - (89 * millisecond));\n  last_120_days = new Date(now.getTime() - (119 * millisecond));\n  next_7_days = new Date(now.getTime() + (6 * millisecond));\n  next_30_days = new Date(now.getTime() + (29 * millisecond));\n  next_60_days = new Date(now.getTime() + (59 * millisecond));\n  next_90_days = new Date(now.getTime() + (89 * millisecond));\n  next_120_days = new Date(now.getTime() + (119 * millisecond));\n  switch (key) {\n    case \"last_year\":\n      label = t(\"creator_filter_operation_between_last_year\");\n      startValue = new Date(previousYear + \"-01-01T00:00:00Z\");\n      endValue = new Date(previousYear + \"-12-31T23:59:59Z\");\n      break;\n    case \"this_year\":\n      label = t(\"creator_filter_operation_between_this_year\");\n      startValue = new Date(currentYear + \"-01-01T00:00:00Z\");\n      endValue = new Date(currentYear + \"-12-31T23:59:59Z\");\n      break;\n    case \"next_year\":\n      label = t(\"creator_filter_operation_between_next_year\");\n      startValue = new Date(nextYear + \"-01-01T00:00:00Z\");\n      endValue = new Date(nextYear + \"-12-31T23:59:59Z\");\n      break;\n    case \"last_quarter\":\n      strFirstDay = moment(lastQuarterStartDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(lastQuarterEndDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_quarter\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"this_quarter\":\n      strFirstDay = moment(thisQuarterStartDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(thisQuarterEndDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_this_quarter\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"next_quarter\":\n      strFirstDay = moment(nextQuarterStartDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(nextQuarterEndDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_quarter\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"last_month\":\n      strFirstDay = moment(lastMonthFirstDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(lastMonthFinalDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_month\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"this_month\":\n      strFirstDay = moment(firstDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(lastDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_this_month\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"next_month\":\n      strFirstDay = moment(nextMonthFirstDay).format(\"YYYY-MM-DD\");\n      strLastDay = moment(nextMonthFinalDay).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_month\");\n      startValue = new Date(strFirstDay + \"T00:00:00Z\");\n      endValue = new Date(strLastDay + \"T23:59:59Z\");\n      break;\n    case \"last_week\":\n      strMonday = moment(lastMonday).format(\"YYYY-MM-DD\");\n      strSunday = moment(lastSunday).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_week\");\n      startValue = new Date(strMonday + \"T00:00:00Z\");\n      endValue = new Date(strSunday + \"T23:59:59Z\");\n      break;\n    case \"this_week\":\n      strMonday = moment(monday).format(\"YYYY-MM-DD\");\n      strSunday = moment(sunday).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_this_week\");\n      startValue = new Date(strMonday + \"T00:00:00Z\");\n      endValue = new Date(strSunday + \"T23:59:59Z\");\n      break;\n    case \"next_week\":\n      strMonday = moment(nextMonday).format(\"YYYY-MM-DD\");\n      strSunday = moment(nextSunday).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_week\");\n      startValue = new Date(strMonday + \"T00:00:00Z\");\n      endValue = new Date(strSunday + \"T23:59:59Z\");\n      break;\n    case \"yestday\":\n      strYestday = moment(yestday).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_yestday\");\n      startValue = new Date(strYestday + \"T00:00:00Z\");\n      endValue = new Date(strYestday + \"T23:59:59Z\");\n      break;\n    case \"today\":\n      strToday = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_today\");\n      startValue = new Date(strToday + \"T00:00:00Z\");\n      endValue = new Date(strToday + \"T23:59:59Z\");\n      break;\n    case \"tomorrow\":\n      strTomorrow = moment(tomorrow).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_tomorrow\");\n      startValue = new Date(strTomorrow + \"T00:00:00Z\");\n      endValue = new Date(strTomorrow + \"T23:59:59Z\");\n      break;\n    case \"last_7_days\":\n      strStartDay = moment(last_7_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_7_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"last_30_days\":\n      strStartDay = moment(last_30_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_30_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"last_60_days\":\n      strStartDay = moment(last_60_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_60_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"last_90_days\":\n      strStartDay = moment(last_90_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_90_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"last_120_days\":\n      strStartDay = moment(last_120_days).format(\"YYYY-MM-DD\");\n      strEndDay = moment(now).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_last_120_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_7_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_7_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_7_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_30_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_30_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_30_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_60_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_60_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_60_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_90_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_90_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_90_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n      break;\n    case \"next_120_days\":\n      strStartDay = moment(now).format(\"YYYY-MM-DD\");\n      strEndDay = moment(next_120_days).format(\"YYYY-MM-DD\");\n      label = t(\"creator_filter_operation_between_next_120_days\");\n      startValue = new Date(strStartDay + \"T00:00:00Z\");\n      endValue = new Date(strEndDay + \"T23:59:59Z\");\n  }\n  values = [startValue, endValue];\n  if (field_type === \"datetime\") {\n    _.forEach(values, function(fv) {\n      if (fv) {\n        return fv.setHours(fv.getHours() + fv.getTimezoneOffset() / 60);\n      }\n    });\n  }\n  return {\n    label: label,\n    key: key,\n    values: values\n  };\n};\n\nCreator.getFieldDefaultOperation = function(field_type) {\n  if (field_type && Creator.checkFieldTypeSupportBetweenQuery(field_type)) {\n    return 'between';\n  } else if ([\"textarea\", \"text\", \"code\"].includes(field_type)) {\n    return 'contains';\n  } else {\n    return \"=\";\n  }\n};\n\nCreator.getFieldOperation = function(field_type) {\n  var operations, optionals;\n  optionals = {\n    equal: {\n      label: t(\"creator_filter_operation_equal\"),\n      value: \"=\"\n    },\n    unequal: {\n      label: t(\"creator_filter_operation_unequal\"),\n      value: \"<>\"\n    },\n    less_than: {\n      label: t(\"creator_filter_operation_less_than\"),\n      value: \"<\"\n    },\n    greater_than: {\n      label: t(\"creator_filter_operation_greater_than\"),\n      value: \">\"\n    },\n    less_or_equal: {\n      label: t(\"creator_filter_operation_less_or_equal\"),\n      value: \"<=\"\n    },\n    greater_or_equal: {\n      label: t(\"creator_filter_operation_greater_or_equal\"),\n      value: \">=\"\n    },\n    contains: {\n      label: t(\"creator_filter_operation_contains\"),\n      value: \"contains\"\n    },\n    not_contain: {\n      label: t(\"creator_filter_operation_does_not_contain\"),\n      value: \"notcontains\"\n    },\n    starts_with: {\n      label: t(\"creator_filter_operation_starts_with\"),\n      value: \"startswith\"\n    },\n    between: {\n      label: t(\"creator_filter_operation_between\"),\n      value: \"between\"\n    }\n  };\n  if (field_type === void 0) {\n    return _.values(optionals);\n  }\n  operations = [];\n  if (Creator.checkFieldTypeSupportBetweenQuery(field_type)) {\n    operations.push(optionals.between);\n    Creator.pushBetweenBuiltinOptionals(field_type, operations);\n  } else if (field_type === \"text\" || field_type === \"textarea\" || field_type === \"html\" || field_type === \"code\") {\n    operations.push(optionals.contains);\n  } else if (field_type === \"lookup\" || field_type === \"master_detail\" || field_type === \"select\") {\n    operations.push(optionals.equal, optionals.unequal);\n  } else if (field_type === \"currency\" || field_type === \"number\") {\n    operations.push(optionals.equal, optionals.unequal, optionals.less_than, optionals.greater_than, optionals.less_or_equal, optionals.greater_or_equal);\n  } else if (field_type === \"boolean\") {\n    operations.push(optionals.equal, optionals.unequal);\n  } else if (field_type === \"checkbox\") {\n    operations.push(optionals.equal, optionals.unequal);\n  } else if (field_type === \"[text]\") {\n    operations.push(optionals.equal, optionals.unequal);\n  } else {\n    operations.push(optionals.equal, optionals.unequal);\n  }\n  return operations;\n};\n\n\n/*\n    å…ˆæŒ‰ç…§æœ‰æŽ’åºå·çš„å°çš„åœ¨å‰ï¼Œå¤§çš„åœ¨åŽ\n    å†å°†æ²¡æœ‰æŽ’åºå·çš„æ˜¾ç¤ºåœ¨\n */\n\nCreator.getObjectFieldsName = function(object_name) {\n  var fields, fieldsArr, fieldsName, ref;\n  fields = (ref = Creator.getObject(object_name)) != null ? ref.fields : void 0;\n  fieldsArr = [];\n  _.each(fields, function(field) {\n    return fieldsArr.push({\n      name: field.name,\n      sort_no: field.sort_no\n    });\n  });\n  fieldsName = [];\n  _.each(_.sortBy(fieldsArr, \"sort_no\"), function(field) {\n    return fieldsName.push(field.name);\n  });\n  return fieldsName;\n};\n","Creator._trigger_hooks = {}\n\ninitTrigger = (object_name, trigger)->\n\ttry\n\t\tcollection = Creator.getCollection(object_name)\n\t\tif !trigger.todo\n\t\t\treturn\n\t\ttodoWrapper = ()->\n\t\t\t  this.object_name = object_name\n\t\t\t  return trigger.todo.apply(this, arguments)\n\t\tif trigger.when == \"before.insert\"\n\t\t\t  return collection?.before?.insert(todoWrapper)\n\t\t  else if trigger.when == \"before.update\"\n\t\t\t  return collection?.before?.update(todoWrapper)\n\t\t  else if trigger.when == \"before.remove\"\n\t\t\t  return collection?.before?.remove(todoWrapper)\n\t\t  else if trigger.when == \"after.insert\"\n\t\t\t  return collection?.after?.insert(todoWrapper)\n\t\t  else if trigger.when == \"after.update\"\n\t\t\t  return collection?.after?.update(todoWrapper)\n\t\t  else if trigger.when == \"after.remove\"\n\t\t\t  return collection?.after?.remove(todoWrapper)\n\tcatch error\n\t\tconsole.error('initTrigger error', error)\n\ncleanTrigger = (object_name)->\n\t###\n    \tç”±äºŽcollection-hooks package çš„removeå‡½æ•°æ˜¯ä½¿ç”¨ä¸‹æ ‡åˆ é™¤å¯¹è±¡çš„ï¼Œæ‰€ä»¥æ­¤å¤„åè½¬hooksé›†åˆåŽï¼Œå†åˆ é™¤\n    \tå› ä¸ºä¸€ä¸ªæ•°ç»„å…ƒç´ åˆ é™¤åŽï¼Œå…¶ä»–å…ƒç´ çš„ä¸‹æ ‡ä¼šå‘ç”Ÿå˜åŒ–\n\t###\n    #TODO ç”±äºŽcollection-hooks package çš„removeå‡½æ•°bug\n\tCreator._trigger_hooks[object_name]?.reverse().forEach (_hook)->\n\t\t_hook.remove()\n\nCreator.initTriggers = (object_name)->\n#\tconsole.log('Creator.initTriggers object_name', object_name)\n\tobj = Creator.getObject(object_name)\n\n\tcleanTrigger(object_name)\n\n\tCreator._trigger_hooks[object_name] = []\n\n\t_.each obj.triggers, (trigger, trigger_name)->\n\t\tif Meteor.isServer and trigger.on == \"server\" and trigger.todo and trigger.when\n\t\t\t_trigger_hook = initTrigger object_name, trigger\n\t\t\tif _trigger_hook\n\t\t\t\tCreator._trigger_hooks[object_name].push(_trigger_hook)\n\t\tif Meteor.isClient and trigger.on == \"client\" and trigger.todo and trigger.when\n\t\t\t_trigger_hook = initTrigger object_name, trigger\n\t\t\tCreator._trigger_hooks[object_name].push(_trigger_hook)","var cleanTrigger, initTrigger;\n\nCreator._trigger_hooks = {};\n\ninitTrigger = function(object_name, trigger) {\n  var collection, error, ref, ref1, ref2, ref3, ref4, ref5, todoWrapper;\n  try {\n    collection = Creator.getCollection(object_name);\n    if (!trigger.todo) {\n      return;\n    }\n    todoWrapper = function() {\n      this.object_name = object_name;\n      return trigger.todo.apply(this, arguments);\n    };\n    if (trigger.when === \"before.insert\") {\n      return collection != null ? (ref = collection.before) != null ? ref.insert(todoWrapper) : void 0 : void 0;\n    } else if (trigger.when === \"before.update\") {\n      return collection != null ? (ref1 = collection.before) != null ? ref1.update(todoWrapper) : void 0 : void 0;\n    } else if (trigger.when === \"before.remove\") {\n      return collection != null ? (ref2 = collection.before) != null ? ref2.remove(todoWrapper) : void 0 : void 0;\n    } else if (trigger.when === \"after.insert\") {\n      return collection != null ? (ref3 = collection.after) != null ? ref3.insert(todoWrapper) : void 0 : void 0;\n    } else if (trigger.when === \"after.update\") {\n      return collection != null ? (ref4 = collection.after) != null ? ref4.update(todoWrapper) : void 0 : void 0;\n    } else if (trigger.when === \"after.remove\") {\n      return collection != null ? (ref5 = collection.after) != null ? ref5.remove(todoWrapper) : void 0 : void 0;\n    }\n  } catch (error1) {\n    error = error1;\n    return console.error('initTrigger error', error);\n  }\n};\n\ncleanTrigger = function(object_name) {\n\n  /*\n     \tç”±äºŽcollection-hooks package çš„removeå‡½æ•°æ˜¯ä½¿ç”¨ä¸‹æ ‡åˆ é™¤å¯¹è±¡çš„ï¼Œæ‰€ä»¥æ­¤å¤„åè½¬hooksé›†åˆåŽï¼Œå†åˆ é™¤\n     \tå› ä¸ºä¸€ä¸ªæ•°ç»„å…ƒç´ åˆ é™¤åŽï¼Œå…¶ä»–å…ƒç´ çš„ä¸‹æ ‡ä¼šå‘ç”Ÿå˜åŒ–\n   */\n  var ref;\n  return (ref = Creator._trigger_hooks[object_name]) != null ? ref.reverse().forEach(function(_hook) {\n    return _hook.remove();\n  }) : void 0;\n};\n\nCreator.initTriggers = function(object_name) {\n  var obj;\n  obj = Creator.getObject(object_name);\n  cleanTrigger(object_name);\n  Creator._trigger_hooks[object_name] = [];\n  return _.each(obj.triggers, function(trigger, trigger_name) {\n    var _trigger_hook;\n    if (Meteor.isServer && trigger.on === \"server\" && trigger.todo && trigger.when) {\n      _trigger_hook = initTrigger(object_name, trigger);\n      if (_trigger_hook) {\n        Creator._trigger_hooks[object_name].push(_trigger_hook);\n      }\n    }\n    if (Meteor.isClient && trigger.on === \"client\" && trigger.todo && trigger.when) {\n      _trigger_hook = initTrigger(object_name, trigger);\n      return Creator._trigger_hooks[object_name].push(_trigger_hook);\n    }\n  });\n};\n","clone = require('clone')\n\nbaseBooleanPermissionPropNames = [\"allowCreate\", \"allowDelete\", \"allowEdit\", \"allowRead\", \"modifyAllRecords\", \"viewAllRecords\", \"modifyCompanyRecords\", \"viewCompanyRecords\", \n\t\"allowReadFiles\", \"allowEditFiles\", \"allowCreateFiles\", \"allowDeleteFiles\", \"viewAllFiles\", \"modifyAllFiles\"] \notherPermissionPropNames = [\"disabled_list_views\", \"disabled_actions\", \"unreadable_fields\", \"uneditable_fields\", \"unrelated_objects\", \"uneditable_related_list\"]\npermissionPropNames = _.union baseBooleanPermissionPropNames, otherPermissionPropNames\n\nCreator.getPermissions = (object_name, spaceId, userId)->\n\tif Meteor.isClient\n\t\tif !object_name\n\t\t\tobject_name = Session.get(\"object_name\")\n\t\tobj = Creator.getObject(object_name)\n\t\tif !obj\n\t\t\treturn\n\t\treturn obj.permissions.get()\n\telse if Meteor.isServer\n\t\tCreator.getObjectPermissions(spaceId, userId, object_name)\n\nCreator.getRecordPermissions = (object_name, record, userId, spaceId)->\n\tif !object_name and Meteor.isClient\n\t\tobject_name = Session.get(\"object_name\")\n\n\tif !spaceId and Meteor.isClient\n\t\tspaceId = Session.get(\"spaceId\")\n\t\n\t# é™„ä»¶æƒé™ä¸å†ä¸Žå…¶çˆ¶è®°å½•ç¼–è¾‘é…ç½®å…³è”\n\t# if record and object_name == \"cms_files\" and Meteor.isClient\n\t# \t# å¦‚æžœæ˜¯cms_filesé™„ä»¶ï¼Œåˆ™æƒé™å–å…¶çˆ¶è®°å½•æƒé™\n\t# \tif object_name == Session.get('object_name')\n\t# \t\t# å½“å‰å¤„äºŽcms_filesé™„ä»¶è¯¦ç»†ç•Œé¢\n\t# \t\tobject_name = record.parent['reference_to._o'];\n\t# \t\trecord_id = record.parent._id;\n\t# \telse \n\t# \t\t# å½“å‰å¤„äºŽcms_filesé™„ä»¶çš„çˆ¶è®°å½•ç•Œé¢\n\t# \t\tobject_name = Session.get('object_name');\n\t# \t\trecord_id = Session.get(\"record_id\");\n\t# \tobject_fields_keys = _.keys(Creator.getObject(object_name, spaceId)?.fields or {}) || [];\n\t# \tselect = _.intersection(object_fields_keys, ['owner', 'company_id', 'company_ids', 'locked']) || [];\n\t# \tif select.length > 0\n\t# \t\trecord = Creator.getObjectRecord(object_name, record_id, select.join(','));\n\t# \telse\n\t# \t\trecord = null;\n\n\tpermissions = _.clone(Creator.getPermissions(object_name, spaceId, userId))\n\n\tif record\n\t\tif !_.isEmpty(record.record_permissions)\n\t\t\treturn record.record_permissions\n\n\t\tisOwner = record.owner == userId || record.owner?._id == userId\n\n\t\tif object_name == \"cms_files\"\n\t\t\t# é™„ä»¶çš„æŸ¥çœ‹æ‰€æœ‰ä¿®æ”¹æ‰€æœ‰æƒé™ä¸Žé™„ä»¶å¯¹è±¡çš„viewAllRecordsã€modifyAllRecordsæ— å…³ï¼Œåªä¸Žå…¶ä¸»è¡¨è®°å½•çš„viewAllFileså’ŒmodifyAllFilesæœ‰å…³\n\t\t\t# å¦‚æžœæ˜¯cms_filesé™„ä»¶ï¼Œåˆ™æƒé™éœ€è¦é¢å¤–è€ƒè™‘å…¶çˆ¶å¯¹è±¡ä¸Šå…³äºŽé™„ä»¶çš„æƒé™é…ç½®\n\t\t\tmasterObjectName = record.parent['reference_to._o'];\n\t\t\tmasterRecordPerm = Creator.getPermissions(masterObjectName, spaceId, userId)\n\t\t\tpermissions.allowCreate = permissions.allowCreate && masterRecordPerm.allowCreateFiles\n\t\t\tpermissions.allowEdit = permissions.allowEdit && masterRecordPerm.allowEditFiles\n\t\t\tpermissions.allowDelete = permissions.allowDelete && masterRecordPerm.allowDeleteFiles\n\t\t\tif !masterRecordPerm.modifyAllFiles and !isOwner\n\t\t\t\tpermissions.allowEdit = false\n\t\t\t\tpermissions.allowDelete = false\n\t\t\tpermissions.allowRead = permissions.allowRead && masterRecordPerm.allowReadFiles\n\t\t\tif !masterRecordPerm.viewAllFiles and !isOwner\n\t\t\t\tpermissions.allowRead = false\n\t\telse\n\t\t\tif Meteor.isClient\n\t\t\t\tuser_company_ids = Steedos.getUserCompanyIds()\n\t\t\telse\n\t\t\t\tuser_company_ids = Creator.getUserCompanyIds(userId, spaceId)\n\t\t\trecord_company_id = record?.company_id\n\t\t\tif record_company_id and _.isObject(record_company_id) and record_company_id._id\n\t\t\t\t# å› record_company_idæ˜¯lookupç±»åž‹ï¼Œæœ‰å¯èƒ½dxæŽ§ä»¶ä¼šæŠŠå®ƒæ˜ å°„è½¬ä¸ºå¯¹åº”çš„objectï¼Œæ‰€ä»¥è¿™é‡Œå–å‡ºå…¶_idå€¼\n\t\t\t\trecord_company_id = record_company_id._id\n\t\t\trecord_company_ids = record?.company_ids\n\t\t\tif record_company_ids and record_company_ids.length and _.isObject(record_company_ids[0])\n\t\t\t\t# å› record_company_idsæ˜¯lookupç±»åž‹ï¼Œæœ‰å¯èƒ½dxæŽ§ä»¶ä¼šæŠŠå®ƒæ˜ å°„è½¬ä¸ºå¯¹åº”çš„[object]ï¼Œæ‰€ä»¥è¿™é‡Œå–å‡ºå…¶_idå€¼\n\t\t\t\trecord_company_ids = record_company_ids.map((n)-> n._id)\n\t\t\trecord_company_ids = _.union(record_company_ids, [record_company_id])\n\t\t\tif !permissions.modifyAllRecords and !isOwner and !permissions.modifyCompanyRecords\n\t\t\t\tpermissions.allowEdit = false\n\t\t\t\tpermissions.allowDelete = false\n\t\t\telse if !permissions.modifyAllRecords and permissions.modifyCompanyRecords\n\t\t\t\tif record_company_ids and record_company_ids.length\n\t\t\t\t\tif user_company_ids and user_company_ids.length\n\t\t\t\t\t\tif !_.intersection(user_company_ids, record_company_ids).length\n\t\t\t\t\t\t\t# è®°å½•çš„company_id/company_idså±žæ€§ä¸åœ¨å½“å‰ç”¨æˆ·user_company_idsèŒƒå›´å†…æ—¶ï¼Œè®¤ä¸ºæ— æƒä¿®æ”¹\n\t\t\t\t\t\t\tpermissions.allowEdit = false\n\t\t\t\t\t\t\tpermissions.allowDelete = false\n\t\t\t\t\telse\n\t\t\t\t\t\t# è®°å½•æœ‰company_id/company_idså±žæ€§ï¼Œä½†æ˜¯å½“å‰ç”¨æˆ·user_company_idsä¸ºç©ºæ—¶ï¼Œè®¤ä¸ºæ— æƒä¿®æ”¹\n\t\t\t\t\t\tpermissions.allowEdit = false\n\t\t\t\t\t\tpermissions.allowDelete = false\n\t\t\t\n\t\t\tif record.locked and !permissions.modifyAllRecords\n\t\t\t\tpermissions.allowEdit = false\n\t\t\t\tpermissions.allowDelete = false\n\n\t\t\tif !permissions.viewAllRecords and !isOwner and !permissions.viewCompanyRecords\n\t\t\t\tpermissions.allowRead = false\n\t\t\telse if !permissions.viewAllRecords and permissions.viewCompanyRecords\n\t\t\t\tif record_company_ids and record_company_ids.length\n\t\t\t\t\tif user_company_ids and user_company_ids.length\n\t\t\t\t\t\tif !_.intersection(user_company_ids, record_company_ids).length\n\t\t\t\t\t\t\t# è®°å½•çš„company_id/company_idså±žæ€§ä¸åœ¨å½“å‰ç”¨æˆ·user_company_idsèŒƒå›´å†…æ—¶ï¼Œè®¤ä¸ºæ— æƒæŸ¥çœ‹\n\t\t\t\t\t\t\tpermissions.allowRead = false\n\t\t\t\t\telse\n\t\t\t\t\t\t# è®°å½•æœ‰company_idå±žæ€§ï¼Œä½†æ˜¯å½“å‰ç”¨æˆ·user_company_idsä¸ºç©ºæ—¶ï¼Œè®¤ä¸ºæ— æƒæŸ¥çœ‹\n\t\t\t\t\t\tpermissions.allowRead = false\n\t\n\treturn permissions\n\n\n# currentObjectNameï¼šå½“å‰ä¸»å¯¹è±¡\n# relatedListItemï¼šCreator.getRelatedList(Session.get(\"object_name\"), Session.get(\"record_id\"))ä¸­å–related_object_nameå¯¹åº”çš„å€¼\n# currentRecordå½“å‰ä¸»å¯¹è±¡çš„è¯¦ç»†è®°å½•\nif Meteor.isClient\n\tCreator.getRecordRelatedListPermissions = (currentObjectName, relatedListItem, currentRecord, userId, spaceId)->\n\t\tif !currentObjectName and Meteor.isClient\n\t\t\tcurrentObjectName = Session.get(\"object_name\")\n\n\t\tif !relatedListItem\n\t\t\tconsole.error(\"relatedListItem must not be empty for the function Creator.getRecordRelatedListPermissions\");\n\t\t\treturn {}\n\n\t\tif !currentRecord and Meteor.isClient\n\t\t\tcurrentRecord = Creator.getObjectRecord()\n\n\t\tif !userId and Meteor.isClient\n\t\t\tuserId = Meteor.userId()\n\n\t\tif !spaceId and Meteor.isClient\n\t\t\tspaceId = Session.get(\"spaceId\")\n\n\t\tmasterRecordPerm = Creator.getRecordPermissions(currentObjectName, currentRecord, userId, spaceId)\n\t\trelatedObjectPermissions = Creator.getPermissions(relatedListItem.object_name)\n\t\tresult = _.clone relatedObjectPermissions\n\n\t\tif relatedListItem.is_file\n\t\t\tresult.allowCreate = relatedObjectPermissions.allowCreate && masterRecordPerm.allowCreateFiles\n\t\t\tresult.allowEdit = relatedObjectPermissions.allowEdit && masterRecordPerm.allowEditFiles\n\t\telse\n\t\t\twrite_requires_master_read = relatedListItem.write_requires_master_read || false\n\t\t\tmasterAllow = false\n\t\t\tif write_requires_master_read == true\n\t\t\t\tmasterAllow = masterRecordPerm.allowRead\n\t\t\telse if write_requires_master_read == false\n\t\t\t\tmasterAllow = masterRecordPerm.allowEdit\n\n\t\t\tuneditable_related_list = Creator.getRecordSafeRelatedList(currentRecord, currentObjectName)\n\t\t\tisRelateObjectUneditable = uneditable_related_list.indexOf(relatedListItem.object_name) > -1\n\n\t\t\tresult.allowCreate = masterAllow && relatedObjectPermissions.allowCreate && !isRelateObjectUneditable\n\t\t\tresult.allowEdit = masterAllow && relatedObjectPermissions.allowEdit && !isRelateObjectUneditable\n\t\treturn result\n\nif Meteor.isServer\n\n\tCreator.getAllPermissions = (spaceId, userId) ->\n\t\tpermissions =\n\t\t\tobjects: {}\n\t\t\tassigned_apps: []\n\t\t###\n\t\tæƒé™é›†è¯´æ˜Ž:\n\t\tå†…ç½®æƒé™é›†-admin,user,member,guest,workflow_admin,organization_admin\n\t\tè‡ªå®šä¹‰æƒé™é›†-æ•°æ®åº“ä¸­æ–°å»ºçš„é™¤å†…ç½®æƒé™é›†ä»¥å¤–çš„å…¶ä»–æƒé™é›†\n\t\tç‰¹å®šç”¨æˆ·é›†åˆæƒé™é›†ï¼ˆå³userså±žæ€§ä¸å¯é…ç½®ï¼‰-admin,user,member,guest\n\t\tå¯é…ç½®ç”¨æˆ·é›†åˆæƒé™é›†ï¼ˆå³userså±žæ€§å¯é…ç½®ï¼‰-workflow_admin,organization_adminä»¥åŠè‡ªå®šä¹‰æƒé™é›†\n\t\t###\n\n\t\tisSpaceAdmin = false\n\t\tspaceUser = null\n\t\tif userId\n\t\t\tisSpaceAdmin = Creator.isSpaceAdmin(spaceId, userId)\n\t\t\tspaceUser = Creator.getCollection(\"space_users\").findOne({ space: spaceId, user: userId }, { fields: { profile: 1 } })\n\n\t\tpsetsAdmin = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'admin'}, {fields:{_id:1, assigned_apps:1}}) || null\n\t\tpsetsUser = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'user'}, {fields:{_id:1, assigned_apps:1}}) || null\n\t\tpsetsMember = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'member'}, {fields:{_id:1, assigned_apps:1}}) || null\n\t\tpsetsGuest = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'guest'}, {fields:{_id:1, assigned_apps:1}}) || null\n\n\t\tpsetsSupplier = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'supplier'}, {fields:{_id:1, assigned_apps:1}}) || null\n\t\tpsetsCustomer = Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'customer'}, {fields:{_id:1, assigned_apps:1}}) || null\n\t\tif spaceUser && spaceUser.profile\n\t\t\tpsetsCurrent = Creator.getCollection(\"permission_set\").find({space: spaceId, $or: [{users: userId}, {name: spaceUser.profile}]}, {fields:{_id:1, assigned_apps:1, name:1}}).fetch()\n\t\telse\n\t\t\tpsetsCurrent = Creator.getCollection(\"permission_set\").find({users: userId, space: spaceId}, {fields:{_id:1, assigned_apps:1, name:1}}).fetch()\n\n\t\tpsetsAdmin_pos = null\n\t\tpsetsUser_pos = null\n\t\tpsetsMember_pos = null\n\t\tpsetsGuest_pos = null\n\t\tpsetsCurrent_pos = null\n\t\tpsetsSupplier_pos = null\n\t\tpsetsCustomer_pos = null\n\n\t\tif psetsAdmin?._id\n\t\t\tpsetsAdmin_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsAdmin._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\n\t\tif psetsUser?._id\n\t\t\tpsetsUser_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsUser._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\n\t\tif psetsMember?._id\n\t\t\tpsetsMember_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsMember._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\n\t\tif psetsGuest?._id\n\t\t\tpsetsGuest_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsGuest._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\n\t\tif psetsSupplier?._id\n\t\t\tpsetsSupplier_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsSupplier._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\n\t\tif psetsCustomer?._id\n\t\t\tpsetsCustomer_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: psetsCustomer._id}, {fields: {created: 0, modified: 0, created_by: 0, modified_by: 0}}).fetch()\n\n\t\tif psetsCurrent.length > 0\n\t\t\tset_ids = _.pluck psetsCurrent, \"_id\"\n\t\t\tpsetsCurrent_pos = Creator.getCollection(\"permission_objects\").find({permission_set_id: {$in: set_ids}}).fetch()\n\t\t\tpsetsCurrentNames = _.pluck psetsCurrent, \"name\"\n\t\tpsets = {\n\t\t\tpsetsAdmin, \n\t\t\tpsetsUser, \n\t\t\tpsetsCurrent, \n\t\t\tpsetsMember, \n\t\t\tpsetsGuest,\n\t\t\tpsetsSupplier,\n\t\t\tpsetsCustomer,\n\t\t\tisSpaceAdmin,\n\t\t\tspaceUser, \n\t\t\tpsetsAdmin_pos, \n\t\t\tpsetsUser_pos, \n\t\t\tpsetsMember_pos, \n\t\t\tpsetsGuest_pos,\n\t\t\tpsetsSupplier_pos,\n\t\t\tpsetsCustomer_pos,\n\t\t\tpsetsCurrent_pos\n\t\t}\n\t\tpermissions.assigned_apps = Creator.getAssignedApps.bind(psets)(spaceId, userId)\n\t\tpermissions.assigned_menus = Creator.getAssignedMenus.bind(psets)(spaceId, userId)\n\t\tpermissions.user_permission_sets = psetsCurrentNames\n\t\t_i = 0\n\t\t_.each Creator.objectsByName, (object, object_name)->\n\t\t\t_i++\n\t\t\tif !_.has(object, 'space') || !object.space || object.space == spaceId\n\t\t\t\tif !_.has(object, 'in_development') || object.in_development == '0' || (object.in_development != '0' && isSpaceAdmin)\n\t\t\t\t\tpermissions.objects[object_name] = Creator.convertObject(clone(Creator.Objects[object_name]), spaceId)\n\t\t\t\t\tpermissions.objects[object_name][\"permissions\"] = Creator.getObjectPermissions.bind(psets)(spaceId, userId, object_name)\n\t\treturn permissions\n\n\tunionPlus = (array, other) ->\n\t\tif !array and !other\n\t\t\treturn undefined\n\t\tif !array\n\t\t\tarray = []\n\t\tif !other\n\t\t\tother = []\n\t\treturn _.union(array, other)\n\n\tintersectionPlus = (array, other) ->\n\t\tif !array and !other\n\t\t\treturn undefined\n\t\tif !array\n\t\t\tarray = []\n\t\tif !other\n\t\t\tother = []\n\t\treturn _.intersection(array, other)\n\n\textendPermissionProps = (target, props) ->\n\t\tpropNames = permissionPropNames\n\t\tfilesProNames = \n\t\tif props\n\t\t\t_.each propNames, (propName) ->\n\t\t\t\ttarget[propName] = props[propName]\n\n\t\t\t# target.allowCreate = props.allowCreate\n\t\t\t# target.allowDelete = props.allowDelete\n\t\t\t# target.allowEdit = props.allowEdit\n\t\t\t# target.allowRead = props.allowRead\n\t\t\t# target.modifyAllRecords = props.modifyAllRecords\n\t\t\t# target.viewAllRecords = props.viewAllRecords\n\t\t\t# target.modifyCompanyRecords = props.modifyCompanyRecords\n\t\t\t# target.viewCompanyRecords = props.viewCompanyRecords\n\t\t\t# target.disabled_list_views = props.disabled_list_views\n\t\t\t# target.disabled_actions = props.disabled_actions\n\t\t\t# target.unreadable_fields = props.unreadable_fields\n\t\t\t# target.uneditable_fields = props.uneditable_fields\n\t\t\t# target.unrelated_objects = props.unrelated_objects\n\t\t\t# target.uneditable_related_list = props.uneditable_related_list\n\n\toverlayBaseBooleanPermissionProps = (target, props) ->\n\t\tpropNames = baseBooleanPermissionPropNames\n\t\t_.each propNames, (propName) ->\n\t\t\tif props[propName]\n\t\t\t\ttarget[propName] = true\n\t\t\n\t\t# if po.allowRead\n\t\t# \tpermissions.allowRead = true\n\t\t# if po.allowCreate\n\t\t# \tpermissions.allowCreate = true\n\t\t# if po.allowEdit\n\t\t# \tpermissions.allowEdit = true\n\t\t# if po.allowDelete\n\t\t# \tpermissions.allowDelete = true\n\t\t# if po.modifyAllRecords\n\t\t# \tpermissions.modifyAllRecords = true\n\t\t# if po.viewAllRecords\n\t\t# \tpermissions.viewAllRecords = true\n\t\t# if po.modifyCompanyRecords\n\t\t# \tpermissions.modifyCompanyRecords = true\n\t\t# if po.viewCompanyRecords\n\t\t# \tpermissions.viewCompanyRecords = true\n\n\n\tCreator.getAssignedApps = (spaceId, userId)->\n\t\tpsetsAdmin = this.psetsAdmin || Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'admin'}, {fields:{_id:1, assigned_apps:1}})\n\t\tpsetsUser = this.psetsUser || Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'user'}, {fields:{_id:1, assigned_apps:1}})\n\t\tpsetsSupplier = this.psetsMember || Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'supplier'}, {fields:{_id:1, assigned_apps:1}})\n\t\tpsetsCustomer = this.psetsGuest || Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'customer'}, {fields:{_id:1, assigned_apps:1}})\n\t\t# psetsMember = this.psetsMember || Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'member'}, {fields:{_id:1, assigned_apps:1}})\n\t\t# psetsGuest = this.psetsGuest || Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'guest'}, {fields:{_id:1, assigned_apps:1}})\n\t\tspaceUser = null;\n\t\tif userId\n\t\t\tspaceUser = Creator.getCollection(\"space_users\").findOne({ space: spaceId, user: userId }, { fields: { profile: 1 } })\n\t\tif spaceUser && spaceUser.profile\n\t\t\tpsets = Creator.getCollection(\"permission_set\").find({space: spaceId, $or: [{users: userId}, {name: spaceUser.profile}]}, {fields:{_id:1, assigned_apps:1, name:1}}).fetch()\n\t\telse\n\t\t\tpsets = Creator.getCollection(\"permission_set\").find({users: userId, space: spaceId}, {fields:{_id:1, assigned_apps:1, name:1}}).fetch()\n\t\tisSpaceAdmin = if _.isBoolean(this.isSpaceAdmin) then this.isSpaceAdmin else Creator.isSpaceAdmin(spaceId, userId)\n\t\tapps = []\n\t\tif isSpaceAdmin\n\t\t\treturn []\n\t\telse\n\t\t\tuserProfile = Creator.getCollection(\"space_users\").findOne({space: spaceId, user: userId}, {fields: {profile: 1}})?.profile\n\t\t\tpsetBase = psetsUser\n\t\t\tif userProfile\n\t\t\t\tif userProfile == 'supplier'\n\t\t\t\t\tpsetBase = psetsSupplier\n\t\t\t\telse if userProfile == 'customer'\n\t\t\t\t\tpsetBase = psetsCustomer\n\t\t\tif psetBase?.assigned_apps?.length\n\t\t\t\tapps = _.union apps, psetBase.assigned_apps\n\t\t\telse\n\t\t\t\t# useræƒé™é›†ä¸­çš„assigned_appsè¡¨ç¤ºæ‰€æœ‰ç”¨æˆ·å…·æœ‰çš„appsæƒé™ï¼Œä¸ºç©ºåˆ™è¡¨ç¤ºæœ‰æ‰€æœ‰appsæƒé™ï¼Œä¸éœ€è¦ä½œæƒé™åˆ¤æ–­äº†\n\t\t\t\treturn []\n\t\t\t_.each psets, (pset)->\n\t\t\t\tif !pset.assigned_apps\n\t\t\t\t\treturn\n\t\t\t\tif pset.name == \"admin\" ||  pset.name == \"user\" || pset.name == 'supplier' || pset.name == 'customer'\n\t\t\t\t\t# è¿™é‡Œä¹‹æ‰€ä»¥è¦æŽ’é™¤admin/userï¼Œæ˜¯å› ä¸ºè¿™ä¸¤ä¸ªæƒé™é›†æ˜¯æ‰€æœ‰æƒé™é›†ä¸­userså±žæ€§æ— æ•ˆçš„æƒé™é›†ï¼Œç‰¹æŒ‡å·¥ä½œåŒºç®¡ç†å‘˜å’Œæ‰€æœ‰ç”¨æˆ·\n\t\t\t\t\treturn\n\t\t\t\tapps = _.union apps, pset.assigned_apps\n\t\t\treturn _.without(_.uniq(apps),undefined,null)\n\n\tCreator.getAssignedMenus = (spaceId, userId)->\n\t\tpsets =  this.psetsCurrent || Creator.getCollection(\"permission_set\").find({users: userId, space: spaceId}, {fields:{_id:1, assigned_apps:1, name:1}}).fetch()\n\t\tisSpaceAdmin = if _.isBoolean(this.isSpaceAdmin) then this.isSpaceAdmin else Creator.isSpaceAdmin(spaceId, userId)\n\t\tadminMenus = Creator.Apps.admin?.admin_menus\n\t\t# å¦‚æžœæ²¡æœ‰adminèœå•è¯´æ˜Žä¸éœ€è¦ç›¸å…³åŠŸèƒ½ï¼Œç›´æŽ¥è¿”å›žç©º\n\t\tunless adminMenus\n\t\t\treturn []\n\t\taboutMenu = adminMenus.find (n) ->\n\t\t\tn._id == 'about'\n\t\tadminMenus = adminMenus.filter (n) ->\n\t\t\tn._id != 'about'\n\t\totherMenuApps = _.sortBy _.filter(_.values(Creator.Apps), (n) ->\n\t\t\treturn n.admin_menus and n._id != 'admin'\n\t\t), 'sort'\n\t\totherMenus = _.flatten(_.pluck(otherMenuApps, \"admin_menus\"))\n\t\t# èœå•æœ‰ä¸‰éƒ¨åˆ†ç»„æˆï¼Œè®¾ç½®APPèœå•ã€å…¶ä»–APPèœå•ä»¥åŠaboutèœå•\n\t\tallMenus = _.union(adminMenus, otherMenus, [aboutMenu])\n\t\tif isSpaceAdmin\n\t\t\t# å·¥ä½œåŒºç®¡ç†å‘˜æœ‰å…¨éƒ¨èœå•åŠŸèƒ½\n\t\t\tresult = allMenus\n\t\telse\n\t\t\tuserProfile = Creator.getCollection(\"space_users\").findOne({space: spaceId, user: userId}, {fields: {profile: 1}})?.profile || 'user'\n\t\t\tcurrentPsetNames = psets.map (n) ->\n\t\t\t\treturn n.name\n\t\t\tmenus = allMenus.filter (menu)->\n\t\t\t\tpsetsMenu = menu.permission_sets\n\t\t\t\t# å¦‚æžœæ™®é€šç”¨æˆ·æœ‰æƒé™ï¼Œåˆ™ç›´æŽ¥è¿”å›žtrue\n\t\t\t\tif psetsMenu && psetsMenu.indexOf(userProfile) > -1\n\t\t\t\t\treturn true\n\t\t\t\t# å¦åˆ™å–å½“å‰ç”¨æˆ·çš„æƒé™é›†ä¸Žmenuèœå•è¦æ±‚çš„æƒé™é›†å¯¹æ¯”ï¼Œå¦‚æžœäº¤é›†å¤§äºŽ1ä¸ªåˆ™è¿”å›žtrue\n\t\t\t\treturn _.intersection(currentPsetNames, psetsMenu).length\n\t\t\tresult = menus\n\t\t\n\t\treturn _.sortBy(result,\"sort\")\n\n\tfindOne_permission_object = (permission_objects, object_name, permission_set_id)->\n\n\t\tif _.isNull(permission_objects)\n\t\t\treturn null\n\t\tif _.isArray(permission_objects)\n\t\t\treturn _.find permission_objects, (po)->\n\t\t\t\t\treturn po.object_name == object_name\n\t\treturn Creator.getCollection(\"permission_objects\").findOne({object_name: object_name, permission_set_id: permission_set_id})\n\n\tfind_permission_object = (permission_objects, object_name, permission_set_ids)->\n\t\tif _.isNull(permission_objects)\n\t\t\treturn null\n\t\tif _.isArray(permission_objects)\n\t\t\treturn _.filter permission_objects, (po)->\n\t\t\t\treturn po.object_name == object_name\n\t\tCreator.getCollection(\"permission_objects\").find({object_name: object_name, permission_set_id: {$in: permission_set_ids}}).fetch()\n\n\tunionPermissionObjects = (pos, object, psets)->\n\t\t# æŠŠdbåŠymlä¸­çš„permission_objectsåˆå¹¶ï¼Œä¼˜å…ˆå–dbä¸­çš„\n\t\tresult = []\n\t\t_.each object.permission_set, (ops, ops_key)->\n\t\t\t# æŠŠymlä¸­é™¤äº†ç‰¹å®šç”¨æˆ·é›†åˆæƒé™é›†\"admin\", \"user\", \"member\", \"guest\"å¤–çš„å…¶ä»–å¯¹è±¡æƒé™å…ˆå­˜å…¥result\n\t\t\t# if [\"admin\", \"user\", \"member\", \"guest\", \"workflow_admin\", \"organization_admin\"].indexOf(ops_key) < 0\n\t\t\tif [\"admin\", \"user\", \"member\", \"guest\"].indexOf(ops_key) < 0\n\t\t\t\tcurrentPset = psets.find (pset)-> return pset.name == ops_key\n\t\t\t\tif currentPset\n\t\t\t\t\ttempOps = _.clone(ops) || {}\n\t\t\t\t\ttempOps.permission_set_id = currentPset._id\n\t\t\t\t\ttempOps.object_name = object.object_name\n\t\t\t\t\tresult.push tempOps\n\t\tif result.length\n\t\t\tpos.forEach (po)->\n\t\t\t\trepeatIndex = 0\n\t\t\t\trepeatPo = result.find((item, index)-> repeatIndex = index;return item.permission_set_id == po.permission_set_id)\n\t\t\t\t# å¦‚æžœymlä¸­å·²ç»å­˜åœ¨poï¼Œåˆ™æ›¿æ¢ä¸ºæ•°æ®åº“ä¸­çš„poï¼Œåä¹‹åˆ™æŠŠæ•°æ®åº“ä¸­çš„poç›´æŽ¥ç´¯åŠ è¿›åŽ»\n\t\t\t\tif repeatPo\n\t\t\t\t\tresult[repeatIndex] = po\n\t\t\t\telse\n\t\t\t\t\tresult.push po\n\t\t\treturn result\n\t\telse\n\t\t\treturn pos\n\n\tCreator.getObjectPermissions = (spaceId, userId, object_name)->\n\t\tpermissions = {}\n\t\tobject = Creator.getObject(object_name, spaceId)\n\n\t\tif spaceId is 'guest' || object_name == \"users\"\n\t\t\tpermissions = _.clone(object.permission_set.guest) || {}\n\t\t\tCreator.processPermissions permissions\n\t\t\treturn permissions\n\t\tpsetsAdmin = if _.isNull(this.psetsAdmin) or this.psetsAdmin then this.psetsAdmin else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'admin'}, {fields:{_id:1}})\n\t\tpsetsUser = if _.isNull(this.psetsUser) or this.psetsUser then this.psetsUser else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'user'}, {fields:{_id:1}})\n\t\tpsetsMember = if _.isNull(this.psetsMember) or this.psetsMember then this.psetsMember else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'member'}, {fields:{_id:1}})\n\t\tpsetsGuest = if _.isNull(this.psetsGuest) or this.psetsGuest then this.psetsGuest else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'guest'}, {fields:{_id:1}})\n\n\t\tpsetsSupplier = if _.isNull(this.psetsSupplier) or this.psetsSupplier then this.psetsSupplier else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'supplier'}, {fields:{_id:1}})\n\t\tpsetsCustomer = if _.isNull(this.psetsCustomer) or this.psetsCustomer then this.psetsCustomer else Creator.getCollection(\"permission_set\").findOne({space: spaceId, name: 'customer'}, {fields:{_id:1}})\n\t\tpsets = this.psetsCurrent;\n\t\tif !psets\n\t\t\tspaceUser = null;\n\t\t\tif userId\n\t\t\t\tspaceUser = Creator.getCollection(\"space_users\").findOne({ space: spaceId, user: userId }, { fields: { profile: 1 } })\n\t\t\tif spaceUser && spaceUser.profile\n\t\t\t\tpsets = Creator.getCollection(\"permission_set\").find({space: spaceId, $or: [{users: userId}, {name: spaceUser.profile}]}, {fields:{_id:1, assigned_apps:1, name:1}}).fetch()\n\t\t\telse\n\t\t\t\tpsets = Creator.getCollection(\"permission_set\").find({users: userId, space: spaceId}, {fields:{_id:1, assigned_apps:1, name:1}}).fetch()\n\t\tisSpaceAdmin = if _.isBoolean(this.isSpaceAdmin) then this.isSpaceAdmin else Creator.isSpaceAdmin(spaceId, userId)\n\n\t\tpsetsAdmin_pos = this.psetsAdmin_pos\n\t\tpsetsUser_pos = this.psetsUser_pos\n\t\tpsetsMember_pos = this.psetsMember_pos\n\t\tpsetsGuest_pos = this.psetsGuest_pos\n\n\t\tpsetsSupplier_pos = this.psetsSupplier_pos\n\t\tpsetsCustomer_pos = this.psetsCustomer_pos\n\n\t\tpsetsCurrent_pos = this.psetsCurrent_pos\n\n\t\topsetAdmin = _.clone(object.permission_set.admin) || {}\n\t\topsetUser = _.clone(object.permission_set.user) || {}\n\t\topsetMember = _.clone(object.permission_set.member) || {}\n\t\topsetGuest = _.clone(object.permission_set.guest) || {}\n\n\t\topsetSupplier = _.clone(object.permission_set.supplier) || {}\n\t\topsetCustomer = _.clone(object.permission_set.customer) || {}\n\n\t\t# sharedListViews = Creator.getCollection('object_listviews').find({space: spaceId, object_name: object_name, shared: true}, {fields:{_id:1}}).fetch()\n\t\t# sharedListViews = _.pluck(sharedListViews,\"_id\")\n\t\t# if sharedListViews.length\n\t\t# \tunless opsetAdmin.list_views\n\t\t# \t\topsetAdmin.list_views = []\n\t\t# \topsetAdmin.list_views = _.union opsetAdmin.list_views, sharedListViews\n\t\t# \tunless opsetUser.list_views\n\t\t# \t\topsetUser.list_views = []\n\t\t# \topsetUser.list_views = _.union opsetUser.list_views, sharedListViews\n\t\t# æ•°æ®åº“ä¸­å¦‚æžœé…ç½®äº†é»˜è®¤çš„admin/useræƒé™é›†è®¾ç½®ï¼Œåº”è¯¥è¦†ç›–ä»£ç ä¸­admin/userçš„æƒé™é›†è®¾ç½®\n\t\tif psetsAdmin\n\t\t\tposAdmin = findOne_permission_object(psetsAdmin_pos, object_name, psetsAdmin._id)\n\t\t\textendPermissionProps opsetAdmin, posAdmin\n\t\tif psetsUser\n\t\t\tposUser = findOne_permission_object(psetsUser_pos, object_name, psetsUser._id)\n\t\t\textendPermissionProps opsetUser, posUser\n\t\tif psetsMember\n\t\t\tposMember = findOne_permission_object(psetsMember_pos, object_name, psetsMember._id)\n\t\t\textendPermissionProps opsetMember, posMember\n\t\tif psetsGuest\n\t\t\tposGuest = findOne_permission_object(psetsGuest_pos, object_name, psetsGuest._id)\n\t\t\textendPermissionProps opsetGuest, posGuest\n\t\tif psetsSupplier\n\t\t\tposSupplier = findOne_permission_object(psetsSupplier_pos, object_name, psetsSupplier._id);\n\t\t\textendPermissionProps opsetSupplier, posSupplier\n\t\tif psetsCustomer\n\t\t\tposCustomer = findOne_permission_object(psetsCustomer_pos, object_name, psetsCustomer._id);\n\t\t\textendPermissionProps opsetCustomer, posCustomer\n\n\t\tif !userId\n\t\t\tpermissions = opsetAdmin\n\t\telse\n\t\t\tif isSpaceAdmin\n\t\t\t\tpermissions = opsetAdmin\n\t\t\telse\n\t\t\t\tif spaceId is 'common'\n\t\t\t\t\tpermissions = opsetUser\n\t\t\t\telse\n\t\t\t\t\tspaceUser = if _.isNull(this.spaceUser) or this.spaceUser then this.spaceUser else Creator.getCollection(\"space_users\").findOne({ space: spaceId, user: userId }, { fields: { profile: 1 } })\n\t\t\t\t\tif spaceUser\n\t\t\t\t\t\tprof = spaceUser.profile\n\t\t\t\t\t\tif prof\n\t\t\t\t\t\t\tif prof is 'user'\n\t\t\t\t\t\t\t\tpermissions = opsetUser\n\t\t\t\t\t\t\telse if prof is 'member'\n\t\t\t\t\t\t\t\tpermissions = opsetMember\n\t\t\t\t\t\t\telse if prof is 'guest'\n\t\t\t\t\t\t\t\tpermissions = opsetGuest\n\t\t\t\t\t\t\telse if prof is 'supplier'\n\t\t\t\t\t\t\t\tpermissions = opsetSupplier\n\t\t\t\t\t\t\telse if prof is 'customer'\n\t\t\t\t\t\t\t\tpermissions = opsetCustomer\n\t\t\t\t\t\telse # æ²¡æœ‰profileåˆ™è®¤ä¸ºæ˜¯useræƒé™\n\t\t\t\t\t\t\tpermissions = opsetUser\n\t\t\t\t\telse\n\t\t\t\t\t\tpermissions = opsetGuest\n\t\tif psets.length > 0\n\t\t\tset_ids = _.pluck psets, \"_id\"\n\t\t\tpos = find_permission_object(psetsCurrent_pos, object_name, set_ids)\n\t\t\tpos = unionPermissionObjects(pos, object, psets)\n\t\t\t_.each pos, (po)->\n\t\t\t\tif po.permission_set_id == psetsAdmin?._id or \n\t\t\t\tpo.permission_set_id == psetsUser?._id or \n\t\t\t\tpo.permission_set_id == psetsMember?._id or \n\t\t\t\tpo.permission_set_id == psetsGuest?._id or\n\t\t\t\tpo.permission_set_id == psetsSupplier?._id or\n\t\t\t\tpo.permission_set_id == psetsCustomer?._id\n\t\t\t\t\t# é»˜è®¤çš„admin/useræƒé™å€¼åªå®žè¡Œä¸Šé¢çš„é»˜è®¤å€¼è¦†ç›–ï¼Œä¸åšç®—æ³•åˆ¤æ–­\n\t\t\t\t\treturn\n\t\t\t\tif _.isEmpty(permissions)\n\t\t\t\t\tpermissions = po\n\t\t\t\toverlayBaseBooleanPermissionProps permissions, po\n\n\t\t\t\tpermissions.disabled_list_views = intersectionPlus(permissions.disabled_list_views, po.disabled_list_views)\n\t\t\t\tpermissions.disabled_actions = intersectionPlus(permissions.disabled_actions, po.disabled_actions)\n\t\t\t\tpermissions.unreadable_fields = intersectionPlus(permissions.unreadable_fields, po.unreadable_fields)\n\t\t\t\tpermissions.uneditable_fields = intersectionPlus(permissions.uneditable_fields, po.uneditable_fields)\n\t\t\t\tpermissions.unrelated_objects = intersectionPlus(permissions.unrelated_objects, po.unrelated_objects)\n\t\t\t\tpermissions.uneditable_related_list = intersectionPlus(permissions.uneditable_related_list, po.uneditable_related_list)\n\t\t\n\t\tif object.is_view\n\t\t\tpermissions.allowCreate = false\n\t\t\tpermissions.allowEdit = false\n\t\t\tpermissions.allowDelete = false\n\t\t\tpermissions.modifyAllRecords = false\n\t\t\tpermissions.modifyCompanyRecords = false\n\t\t\tpermissions.disabled_actions = []\n\t\tCreator.processPermissions permissions\n\n\t\tif object.permission_set.owner\n\t\t\tpermissions.owner = object.permission_set.owner\n\t\treturn permissions\n\n\n\t# Creator.initPermissions = (object_name) ->\n\n\t\t# # åº”è¯¥æŠŠè®¡ç®—å‡ºæ¥çš„\n\t\t# Creator.Collections[object_name].allow\n\t\t# \tinsert: (userId, doc) ->\n\t\t# \t\tif !userId\n\t\t# \t\t\treturn false\n\t\t# \t\tif !doc.space\n\t\t# \t\t\treturn false\n\t    \t# \t\tpermissions = Creator.getObjectPermissions(doc.space, userId, object_name)\n\t\t# \t\tif !permissions.allowCreate\n\t\t# \t\t\treturn false\n\n\t\t# \t\treturn true\n\t\t# \tupdate: (userId, doc) ->\n\t\t# \t\tif !userId\n\t\t# \t\t\treturn false\n\t\t# \t\tif !doc.space\n\t\t# \t\t\treturn false\n\t\t# \t\tpermissions = Creator.getObjectPermissions(doc.space, userId, object_name)\n\t\t# \t\tif !permissions.allowEdit\n\t\t# \t\t\treturn false\n\t\t# \t\treturn true\n\t\t# \tremove: (userId, doc) ->\n\t\t# \t\tif !userId\n\t\t# \t\t\treturn false\n\t\t# \t\tif !doc.space\n\t\t# \t\t\treturn false\n\t\t# \t\tpermissions = Creator.getObjectPermissions(doc.space, userId, object_name)\n\t\t# \t\tif !permissions.allowDelete\n\t\t# \t\t\treturn false\n\t\t# \t\treturn true\n\n\tMeteor.methods\n\t\t# Calculate Permissions on Server\n\t\t\"creator.object_permissions\": (spaceId)->\n\t\t\treturn Creator.getAllPermissions(spaceId, this.userId)\n","var baseBooleanPermissionPropNames, clone, extendPermissionProps, findOne_permission_object, find_permission_object, intersectionPlus, otherPermissionPropNames, overlayBaseBooleanPermissionProps, permissionPropNames, unionPermissionObjects, unionPlus;\n\nclone = require('clone');\n\nbaseBooleanPermissionPropNames = [\"allowCreate\", \"allowDelete\", \"allowEdit\", \"allowRead\", \"modifyAllRecords\", \"viewAllRecords\", \"modifyCompanyRecords\", \"viewCompanyRecords\", \"allowReadFiles\", \"allowEditFiles\", \"allowCreateFiles\", \"allowDeleteFiles\", \"viewAllFiles\", \"modifyAllFiles\"];\n\notherPermissionPropNames = [\"disabled_list_views\", \"disabled_actions\", \"unreadable_fields\", \"uneditable_fields\", \"unrelated_objects\", \"uneditable_related_list\"];\n\npermissionPropNames = _.union(baseBooleanPermissionPropNames, otherPermissionPropNames);\n\nCreator.getPermissions = function(object_name, spaceId, userId) {\n  var obj;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n    obj = Creator.getObject(object_name);\n    if (!obj) {\n      return;\n    }\n    return obj.permissions.get();\n  } else if (Meteor.isServer) {\n    return Creator.getObjectPermissions(spaceId, userId, object_name);\n  }\n};\n\nCreator.getRecordPermissions = function(object_name, record, userId, spaceId) {\n  var isOwner, masterObjectName, masterRecordPerm, permissions, record_company_id, record_company_ids, ref, user_company_ids;\n  if (!object_name && Meteor.isClient) {\n    object_name = Session.get(\"object_name\");\n  }\n  if (!spaceId && Meteor.isClient) {\n    spaceId = Session.get(\"spaceId\");\n  }\n  permissions = _.clone(Creator.getPermissions(object_name, spaceId, userId));\n  if (record) {\n    if (!_.isEmpty(record.record_permissions)) {\n      return record.record_permissions;\n    }\n    isOwner = record.owner === userId || ((ref = record.owner) != null ? ref._id : void 0) === userId;\n    if (object_name === \"cms_files\") {\n      masterObjectName = record.parent['reference_to._o'];\n      masterRecordPerm = Creator.getPermissions(masterObjectName, spaceId, userId);\n      permissions.allowCreate = permissions.allowCreate && masterRecordPerm.allowCreateFiles;\n      permissions.allowEdit = permissions.allowEdit && masterRecordPerm.allowEditFiles;\n      permissions.allowDelete = permissions.allowDelete && masterRecordPerm.allowDeleteFiles;\n      if (!masterRecordPerm.modifyAllFiles && !isOwner) {\n        permissions.allowEdit = false;\n        permissions.allowDelete = false;\n      }\n      permissions.allowRead = permissions.allowRead && masterRecordPerm.allowReadFiles;\n      if (!masterRecordPerm.viewAllFiles && !isOwner) {\n        permissions.allowRead = false;\n      }\n    } else {\n      if (Meteor.isClient) {\n        user_company_ids = Steedos.getUserCompanyIds();\n      } else {\n        user_company_ids = Creator.getUserCompanyIds(userId, spaceId);\n      }\n      record_company_id = record != null ? record.company_id : void 0;\n      if (record_company_id && _.isObject(record_company_id) && record_company_id._id) {\n        record_company_id = record_company_id._id;\n      }\n      record_company_ids = record != null ? record.company_ids : void 0;\n      if (record_company_ids && record_company_ids.length && _.isObject(record_company_ids[0])) {\n        record_company_ids = record_company_ids.map(function(n) {\n          return n._id;\n        });\n      }\n      record_company_ids = _.union(record_company_ids, [record_company_id]);\n      if (!permissions.modifyAllRecords && !isOwner && !permissions.modifyCompanyRecords) {\n        permissions.allowEdit = false;\n        permissions.allowDelete = false;\n      } else if (!permissions.modifyAllRecords && permissions.modifyCompanyRecords) {\n        if (record_company_ids && record_company_ids.length) {\n          if (user_company_ids && user_company_ids.length) {\n            if (!_.intersection(user_company_ids, record_company_ids).length) {\n              permissions.allowEdit = false;\n              permissions.allowDelete = false;\n            }\n          } else {\n            permissions.allowEdit = false;\n            permissions.allowDelete = false;\n          }\n        }\n      }\n      if (record.locked && !permissions.modifyAllRecords) {\n        permissions.allowEdit = false;\n        permissions.allowDelete = false;\n      }\n      if (!permissions.viewAllRecords && !isOwner && !permissions.viewCompanyRecords) {\n        permissions.allowRead = false;\n      } else if (!permissions.viewAllRecords && permissions.viewCompanyRecords) {\n        if (record_company_ids && record_company_ids.length) {\n          if (user_company_ids && user_company_ids.length) {\n            if (!_.intersection(user_company_ids, record_company_ids).length) {\n              permissions.allowRead = false;\n            }\n          } else {\n            permissions.allowRead = false;\n          }\n        }\n      }\n    }\n  }\n  return permissions;\n};\n\nif (Meteor.isClient) {\n  Creator.getRecordRelatedListPermissions = function(currentObjectName, relatedListItem, currentRecord, userId, spaceId) {\n    var isRelateObjectUneditable, masterAllow, masterRecordPerm, relatedObjectPermissions, result, uneditable_related_list, write_requires_master_read;\n    if (!currentObjectName && Meteor.isClient) {\n      currentObjectName = Session.get(\"object_name\");\n    }\n    if (!relatedListItem) {\n      console.error(\"relatedListItem must not be empty for the function Creator.getRecordRelatedListPermissions\");\n      return {};\n    }\n    if (!currentRecord && Meteor.isClient) {\n      currentRecord = Creator.getObjectRecord();\n    }\n    if (!userId && Meteor.isClient) {\n      userId = Meteor.userId();\n    }\n    if (!spaceId && Meteor.isClient) {\n      spaceId = Session.get(\"spaceId\");\n    }\n    masterRecordPerm = Creator.getRecordPermissions(currentObjectName, currentRecord, userId, spaceId);\n    relatedObjectPermissions = Creator.getPermissions(relatedListItem.object_name);\n    result = _.clone(relatedObjectPermissions);\n    if (relatedListItem.is_file) {\n      result.allowCreate = relatedObjectPermissions.allowCreate && masterRecordPerm.allowCreateFiles;\n      result.allowEdit = relatedObjectPermissions.allowEdit && masterRecordPerm.allowEditFiles;\n    } else {\n      write_requires_master_read = relatedListItem.write_requires_master_read || false;\n      masterAllow = false;\n      if (write_requires_master_read === true) {\n        masterAllow = masterRecordPerm.allowRead;\n      } else if (write_requires_master_read === false) {\n        masterAllow = masterRecordPerm.allowEdit;\n      }\n      uneditable_related_list = Creator.getRecordSafeRelatedList(currentRecord, currentObjectName);\n      isRelateObjectUneditable = uneditable_related_list.indexOf(relatedListItem.object_name) > -1;\n      result.allowCreate = masterAllow && relatedObjectPermissions.allowCreate && !isRelateObjectUneditable;\n      result.allowEdit = masterAllow && relatedObjectPermissions.allowEdit && !isRelateObjectUneditable;\n    }\n    return result;\n  };\n}\n\nif (Meteor.isServer) {\n  Creator.getAllPermissions = function(spaceId, userId) {\n    var _i, isSpaceAdmin, permissions, psets, psetsAdmin, psetsAdmin_pos, psetsCurrent, psetsCurrentNames, psetsCurrent_pos, psetsCustomer, psetsCustomer_pos, psetsGuest, psetsGuest_pos, psetsMember, psetsMember_pos, psetsSupplier, psetsSupplier_pos, psetsUser, psetsUser_pos, set_ids, spaceUser;\n    permissions = {\n      objects: {},\n      assigned_apps: []\n    };\n\n    /*\n    \t\tæƒé™é›†è¯´æ˜Ž:\n    \t\tå†…ç½®æƒé™é›†-admin,user,member,guest,workflow_admin,organization_admin\n    \t\tè‡ªå®šä¹‰æƒé™é›†-æ•°æ®åº“ä¸­æ–°å»ºçš„é™¤å†…ç½®æƒé™é›†ä»¥å¤–çš„å…¶ä»–æƒé™é›†\n    \t\tç‰¹å®šç”¨æˆ·é›†åˆæƒé™é›†ï¼ˆå³userså±žæ€§ä¸å¯é…ç½®ï¼‰-admin,user,member,guest\n    \t\tå¯é…ç½®ç”¨æˆ·é›†åˆæƒé™é›†ï¼ˆå³userså±žæ€§å¯é…ç½®ï¼‰-workflow_admin,organization_adminä»¥åŠè‡ªå®šä¹‰æƒé™é›†\n     */\n    isSpaceAdmin = false;\n    spaceUser = null;\n    if (userId) {\n      isSpaceAdmin = Creator.isSpaceAdmin(spaceId, userId);\n      spaceUser = Creator.getCollection(\"space_users\").findOne({\n        space: spaceId,\n        user: userId\n      }, {\n        fields: {\n          profile: 1\n        }\n      });\n    }\n    psetsAdmin = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'admin'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }) || null;\n    psetsUser = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'user'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }) || null;\n    psetsMember = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'member'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }) || null;\n    psetsGuest = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'guest'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }) || null;\n    psetsSupplier = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'supplier'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }) || null;\n    psetsCustomer = Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'customer'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    }) || null;\n    if (spaceUser && spaceUser.profile) {\n      psetsCurrent = Creator.getCollection(\"permission_set\").find({\n        space: spaceId,\n        $or: [\n          {\n            users: userId\n          }, {\n            name: spaceUser.profile\n          }\n        ]\n      }, {\n        fields: {\n          _id: 1,\n          assigned_apps: 1,\n          name: 1\n        }\n      }).fetch();\n    } else {\n      psetsCurrent = Creator.getCollection(\"permission_set\").find({\n        users: userId,\n        space: spaceId\n      }, {\n        fields: {\n          _id: 1,\n          assigned_apps: 1,\n          name: 1\n        }\n      }).fetch();\n    }\n    psetsAdmin_pos = null;\n    psetsUser_pos = null;\n    psetsMember_pos = null;\n    psetsGuest_pos = null;\n    psetsCurrent_pos = null;\n    psetsSupplier_pos = null;\n    psetsCustomer_pos = null;\n    if (psetsAdmin != null ? psetsAdmin._id : void 0) {\n      psetsAdmin_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsAdmin._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsUser != null ? psetsUser._id : void 0) {\n      psetsUser_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsUser._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsMember != null ? psetsMember._id : void 0) {\n      psetsMember_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsMember._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsGuest != null ? psetsGuest._id : void 0) {\n      psetsGuest_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsGuest._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsSupplier != null ? psetsSupplier._id : void 0) {\n      psetsSupplier_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsSupplier._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsCustomer != null ? psetsCustomer._id : void 0) {\n      psetsCustomer_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: psetsCustomer._id\n      }, {\n        fields: {\n          created: 0,\n          modified: 0,\n          created_by: 0,\n          modified_by: 0\n        }\n      }).fetch();\n    }\n    if (psetsCurrent.length > 0) {\n      set_ids = _.pluck(psetsCurrent, \"_id\");\n      psetsCurrent_pos = Creator.getCollection(\"permission_objects\").find({\n        permission_set_id: {\n          $in: set_ids\n        }\n      }).fetch();\n      psetsCurrentNames = _.pluck(psetsCurrent, \"name\");\n    }\n    psets = {\n      psetsAdmin: psetsAdmin,\n      psetsUser: psetsUser,\n      psetsCurrent: psetsCurrent,\n      psetsMember: psetsMember,\n      psetsGuest: psetsGuest,\n      psetsSupplier: psetsSupplier,\n      psetsCustomer: psetsCustomer,\n      isSpaceAdmin: isSpaceAdmin,\n      spaceUser: spaceUser,\n      psetsAdmin_pos: psetsAdmin_pos,\n      psetsUser_pos: psetsUser_pos,\n      psetsMember_pos: psetsMember_pos,\n      psetsGuest_pos: psetsGuest_pos,\n      psetsSupplier_pos: psetsSupplier_pos,\n      psetsCustomer_pos: psetsCustomer_pos,\n      psetsCurrent_pos: psetsCurrent_pos\n    };\n    permissions.assigned_apps = Creator.getAssignedApps.bind(psets)(spaceId, userId);\n    permissions.assigned_menus = Creator.getAssignedMenus.bind(psets)(spaceId, userId);\n    permissions.user_permission_sets = psetsCurrentNames;\n    _i = 0;\n    _.each(Creator.objectsByName, function(object, object_name) {\n      _i++;\n      if (!_.has(object, 'space') || !object.space || object.space === spaceId) {\n        if (!_.has(object, 'in_development') || object.in_development === '0' || (object.in_development !== '0' && isSpaceAdmin)) {\n          permissions.objects[object_name] = Creator.convertObject(clone(Creator.Objects[object_name]), spaceId);\n          return permissions.objects[object_name][\"permissions\"] = Creator.getObjectPermissions.bind(psets)(spaceId, userId, object_name);\n        }\n      }\n    });\n    return permissions;\n  };\n  unionPlus = function(array, other) {\n    if (!array && !other) {\n      return void 0;\n    }\n    if (!array) {\n      array = [];\n    }\n    if (!other) {\n      other = [];\n    }\n    return _.union(array, other);\n  };\n  intersectionPlus = function(array, other) {\n    if (!array && !other) {\n      return void 0;\n    }\n    if (!array) {\n      array = [];\n    }\n    if (!other) {\n      other = [];\n    }\n    return _.intersection(array, other);\n  };\n  extendPermissionProps = function(target, props) {\n    var filesProNames, propNames;\n    propNames = permissionPropNames;\n    return filesProNames = props ? _.each(propNames, function(propName) {\n      return target[propName] = props[propName];\n    }) : void 0;\n  };\n  overlayBaseBooleanPermissionProps = function(target, props) {\n    var propNames;\n    propNames = baseBooleanPermissionPropNames;\n    return _.each(propNames, function(propName) {\n      if (props[propName]) {\n        return target[propName] = true;\n      }\n    });\n  };\n  Creator.getAssignedApps = function(spaceId, userId) {\n    var apps, isSpaceAdmin, psetBase, psets, psetsAdmin, psetsCustomer, psetsSupplier, psetsUser, ref, ref1, spaceUser, userProfile;\n    psetsAdmin = this.psetsAdmin || Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'admin'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    });\n    psetsUser = this.psetsUser || Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'user'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    });\n    psetsSupplier = this.psetsMember || Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'supplier'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    });\n    psetsCustomer = this.psetsGuest || Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'customer'\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1\n      }\n    });\n    spaceUser = null;\n    if (userId) {\n      spaceUser = Creator.getCollection(\"space_users\").findOne({\n        space: spaceId,\n        user: userId\n      }, {\n        fields: {\n          profile: 1\n        }\n      });\n    }\n    if (spaceUser && spaceUser.profile) {\n      psets = Creator.getCollection(\"permission_set\").find({\n        space: spaceId,\n        $or: [\n          {\n            users: userId\n          }, {\n            name: spaceUser.profile\n          }\n        ]\n      }, {\n        fields: {\n          _id: 1,\n          assigned_apps: 1,\n          name: 1\n        }\n      }).fetch();\n    } else {\n      psets = Creator.getCollection(\"permission_set\").find({\n        users: userId,\n        space: spaceId\n      }, {\n        fields: {\n          _id: 1,\n          assigned_apps: 1,\n          name: 1\n        }\n      }).fetch();\n    }\n    isSpaceAdmin = _.isBoolean(this.isSpaceAdmin) ? this.isSpaceAdmin : Creator.isSpaceAdmin(spaceId, userId);\n    apps = [];\n    if (isSpaceAdmin) {\n      return [];\n    } else {\n      userProfile = (ref = Creator.getCollection(\"space_users\").findOne({\n        space: spaceId,\n        user: userId\n      }, {\n        fields: {\n          profile: 1\n        }\n      })) != null ? ref.profile : void 0;\n      psetBase = psetsUser;\n      if (userProfile) {\n        if (userProfile === 'supplier') {\n          psetBase = psetsSupplier;\n        } else if (userProfile === 'customer') {\n          psetBase = psetsCustomer;\n        }\n      }\n      if (psetBase != null ? (ref1 = psetBase.assigned_apps) != null ? ref1.length : void 0 : void 0) {\n        apps = _.union(apps, psetBase.assigned_apps);\n      } else {\n        return [];\n      }\n      _.each(psets, function(pset) {\n        if (!pset.assigned_apps) {\n          return;\n        }\n        if (pset.name === \"admin\" || pset.name === \"user\" || pset.name === 'supplier' || pset.name === 'customer') {\n          return;\n        }\n        return apps = _.union(apps, pset.assigned_apps);\n      });\n      return _.without(_.uniq(apps), void 0, null);\n    }\n  };\n  Creator.getAssignedMenus = function(spaceId, userId) {\n    var aboutMenu, adminMenus, allMenus, currentPsetNames, isSpaceAdmin, menus, otherMenuApps, otherMenus, psets, ref, ref1, result, userProfile;\n    psets = this.psetsCurrent || Creator.getCollection(\"permission_set\").find({\n      users: userId,\n      space: spaceId\n    }, {\n      fields: {\n        _id: 1,\n        assigned_apps: 1,\n        name: 1\n      }\n    }).fetch();\n    isSpaceAdmin = _.isBoolean(this.isSpaceAdmin) ? this.isSpaceAdmin : Creator.isSpaceAdmin(spaceId, userId);\n    adminMenus = (ref = Creator.Apps.admin) != null ? ref.admin_menus : void 0;\n    if (!adminMenus) {\n      return [];\n    }\n    aboutMenu = adminMenus.find(function(n) {\n      return n._id === 'about';\n    });\n    adminMenus = adminMenus.filter(function(n) {\n      return n._id !== 'about';\n    });\n    otherMenuApps = _.sortBy(_.filter(_.values(Creator.Apps), function(n) {\n      return n.admin_menus && n._id !== 'admin';\n    }), 'sort');\n    otherMenus = _.flatten(_.pluck(otherMenuApps, \"admin_menus\"));\n    allMenus = _.union(adminMenus, otherMenus, [aboutMenu]);\n    if (isSpaceAdmin) {\n      result = allMenus;\n    } else {\n      userProfile = ((ref1 = Creator.getCollection(\"space_users\").findOne({\n        space: spaceId,\n        user: userId\n      }, {\n        fields: {\n          profile: 1\n        }\n      })) != null ? ref1.profile : void 0) || 'user';\n      currentPsetNames = psets.map(function(n) {\n        return n.name;\n      });\n      menus = allMenus.filter(function(menu) {\n        var psetsMenu;\n        psetsMenu = menu.permission_sets;\n        if (psetsMenu && psetsMenu.indexOf(userProfile) > -1) {\n          return true;\n        }\n        return _.intersection(currentPsetNames, psetsMenu).length;\n      });\n      result = menus;\n    }\n    return _.sortBy(result, \"sort\");\n  };\n  findOne_permission_object = function(permission_objects, object_name, permission_set_id) {\n    if (_.isNull(permission_objects)) {\n      return null;\n    }\n    if (_.isArray(permission_objects)) {\n      return _.find(permission_objects, function(po) {\n        return po.object_name === object_name;\n      });\n    }\n    return Creator.getCollection(\"permission_objects\").findOne({\n      object_name: object_name,\n      permission_set_id: permission_set_id\n    });\n  };\n  find_permission_object = function(permission_objects, object_name, permission_set_ids) {\n    if (_.isNull(permission_objects)) {\n      return null;\n    }\n    if (_.isArray(permission_objects)) {\n      return _.filter(permission_objects, function(po) {\n        return po.object_name === object_name;\n      });\n    }\n    return Creator.getCollection(\"permission_objects\").find({\n      object_name: object_name,\n      permission_set_id: {\n        $in: permission_set_ids\n      }\n    }).fetch();\n  };\n  unionPermissionObjects = function(pos, object, psets) {\n    var result;\n    result = [];\n    _.each(object.permission_set, function(ops, ops_key) {\n      var currentPset, tempOps;\n      if ([\"admin\", \"user\", \"member\", \"guest\"].indexOf(ops_key) < 0) {\n        currentPset = psets.find(function(pset) {\n          return pset.name === ops_key;\n        });\n        if (currentPset) {\n          tempOps = _.clone(ops) || {};\n          tempOps.permission_set_id = currentPset._id;\n          tempOps.object_name = object.object_name;\n          return result.push(tempOps);\n        }\n      }\n    });\n    if (result.length) {\n      pos.forEach(function(po) {\n        var repeatIndex, repeatPo;\n        repeatIndex = 0;\n        repeatPo = result.find(function(item, index) {\n          repeatIndex = index;\n          return item.permission_set_id === po.permission_set_id;\n        });\n        if (repeatPo) {\n          return result[repeatIndex] = po;\n        } else {\n          return result.push(po);\n        }\n      });\n      return result;\n    } else {\n      return pos;\n    }\n  };\n  Creator.getObjectPermissions = function(spaceId, userId, object_name) {\n    var isSpaceAdmin, object, opsetAdmin, opsetCustomer, opsetGuest, opsetMember, opsetSupplier, opsetUser, permissions, pos, posAdmin, posCustomer, posGuest, posMember, posSupplier, posUser, prof, psets, psetsAdmin, psetsAdmin_pos, psetsCurrent_pos, psetsCustomer, psetsCustomer_pos, psetsGuest, psetsGuest_pos, psetsMember, psetsMember_pos, psetsSupplier, psetsSupplier_pos, psetsUser, psetsUser_pos, set_ids, spaceUser;\n    permissions = {};\n    object = Creator.getObject(object_name, spaceId);\n    if (spaceId === 'guest' || object_name === \"users\") {\n      permissions = _.clone(object.permission_set.guest) || {};\n      Creator.processPermissions(permissions);\n      return permissions;\n    }\n    psetsAdmin = _.isNull(this.psetsAdmin) || this.psetsAdmin ? this.psetsAdmin : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'admin'\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    psetsUser = _.isNull(this.psetsUser) || this.psetsUser ? this.psetsUser : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'user'\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    psetsMember = _.isNull(this.psetsMember) || this.psetsMember ? this.psetsMember : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'member'\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    psetsGuest = _.isNull(this.psetsGuest) || this.psetsGuest ? this.psetsGuest : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'guest'\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    psetsSupplier = _.isNull(this.psetsSupplier) || this.psetsSupplier ? this.psetsSupplier : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'supplier'\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    psetsCustomer = _.isNull(this.psetsCustomer) || this.psetsCustomer ? this.psetsCustomer : Creator.getCollection(\"permission_set\").findOne({\n      space: spaceId,\n      name: 'customer'\n    }, {\n      fields: {\n        _id: 1\n      }\n    });\n    psets = this.psetsCurrent;\n    if (!psets) {\n      spaceUser = null;\n      if (userId) {\n        spaceUser = Creator.getCollection(\"space_users\").findOne({\n          space: spaceId,\n          user: userId\n        }, {\n          fields: {\n            profile: 1\n          }\n        });\n      }\n      if (spaceUser && spaceUser.profile) {\n        psets = Creator.getCollection(\"permission_set\").find({\n          space: spaceId,\n          $or: [\n            {\n              users: userId\n            }, {\n              name: spaceUser.profile\n            }\n          ]\n        }, {\n          fields: {\n            _id: 1,\n            assigned_apps: 1,\n            name: 1\n          }\n        }).fetch();\n      } else {\n        psets = Creator.getCollection(\"permission_set\").find({\n          users: userId,\n          space: spaceId\n        }, {\n          fields: {\n            _id: 1,\n            assigned_apps: 1,\n            name: 1\n          }\n        }).fetch();\n      }\n    }\n    isSpaceAdmin = _.isBoolean(this.isSpaceAdmin) ? this.isSpaceAdmin : Creator.isSpaceAdmin(spaceId, userId);\n    psetsAdmin_pos = this.psetsAdmin_pos;\n    psetsUser_pos = this.psetsUser_pos;\n    psetsMember_pos = this.psetsMember_pos;\n    psetsGuest_pos = this.psetsGuest_pos;\n    psetsSupplier_pos = this.psetsSupplier_pos;\n    psetsCustomer_pos = this.psetsCustomer_pos;\n    psetsCurrent_pos = this.psetsCurrent_pos;\n    opsetAdmin = _.clone(object.permission_set.admin) || {};\n    opsetUser = _.clone(object.permission_set.user) || {};\n    opsetMember = _.clone(object.permission_set.member) || {};\n    opsetGuest = _.clone(object.permission_set.guest) || {};\n    opsetSupplier = _.clone(object.permission_set.supplier) || {};\n    opsetCustomer = _.clone(object.permission_set.customer) || {};\n    if (psetsAdmin) {\n      posAdmin = findOne_permission_object(psetsAdmin_pos, object_name, psetsAdmin._id);\n      extendPermissionProps(opsetAdmin, posAdmin);\n    }\n    if (psetsUser) {\n      posUser = findOne_permission_object(psetsUser_pos, object_name, psetsUser._id);\n      extendPermissionProps(opsetUser, posUser);\n    }\n    if (psetsMember) {\n      posMember = findOne_permission_object(psetsMember_pos, object_name, psetsMember._id);\n      extendPermissionProps(opsetMember, posMember);\n    }\n    if (psetsGuest) {\n      posGuest = findOne_permission_object(psetsGuest_pos, object_name, psetsGuest._id);\n      extendPermissionProps(opsetGuest, posGuest);\n    }\n    if (psetsSupplier) {\n      posSupplier = findOne_permission_object(psetsSupplier_pos, object_name, psetsSupplier._id);\n      extendPermissionProps(opsetSupplier, posSupplier);\n    }\n    if (psetsCustomer) {\n      posCustomer = findOne_permission_object(psetsCustomer_pos, object_name, psetsCustomer._id);\n      extendPermissionProps(opsetCustomer, posCustomer);\n    }\n    if (!userId) {\n      permissions = opsetAdmin;\n    } else {\n      if (isSpaceAdmin) {\n        permissions = opsetAdmin;\n      } else {\n        if (spaceId === 'common') {\n          permissions = opsetUser;\n        } else {\n          spaceUser = _.isNull(this.spaceUser) || this.spaceUser ? this.spaceUser : Creator.getCollection(\"space_users\").findOne({\n            space: spaceId,\n            user: userId\n          }, {\n            fields: {\n              profile: 1\n            }\n          });\n          if (spaceUser) {\n            prof = spaceUser.profile;\n            if (prof) {\n              if (prof === 'user') {\n                permissions = opsetUser;\n              } else if (prof === 'member') {\n                permissions = opsetMember;\n              } else if (prof === 'guest') {\n                permissions = opsetGuest;\n              } else if (prof === 'supplier') {\n                permissions = opsetSupplier;\n              } else if (prof === 'customer') {\n                permissions = opsetCustomer;\n              }\n            } else {\n              permissions = opsetUser;\n            }\n          } else {\n            permissions = opsetGuest;\n          }\n        }\n      }\n    }\n    if (psets.length > 0) {\n      set_ids = _.pluck(psets, \"_id\");\n      pos = find_permission_object(psetsCurrent_pos, object_name, set_ids);\n      pos = unionPermissionObjects(pos, object, psets);\n      _.each(pos, function(po) {\n        if (po.permission_set_id === (psetsAdmin != null ? psetsAdmin._id : void 0) || po.permission_set_id === (psetsUser != null ? psetsUser._id : void 0) || po.permission_set_id === (psetsMember != null ? psetsMember._id : void 0) || po.permission_set_id === (psetsGuest != null ? psetsGuest._id : void 0) || po.permission_set_id === (psetsSupplier != null ? psetsSupplier._id : void 0) || po.permission_set_id === (psetsCustomer != null ? psetsCustomer._id : void 0)) {\n          return;\n        }\n        if (_.isEmpty(permissions)) {\n          permissions = po;\n        }\n        overlayBaseBooleanPermissionProps(permissions, po);\n        permissions.disabled_list_views = intersectionPlus(permissions.disabled_list_views, po.disabled_list_views);\n        permissions.disabled_actions = intersectionPlus(permissions.disabled_actions, po.disabled_actions);\n        permissions.unreadable_fields = intersectionPlus(permissions.unreadable_fields, po.unreadable_fields);\n        permissions.uneditable_fields = intersectionPlus(permissions.uneditable_fields, po.uneditable_fields);\n        permissions.unrelated_objects = intersectionPlus(permissions.unrelated_objects, po.unrelated_objects);\n        return permissions.uneditable_related_list = intersectionPlus(permissions.uneditable_related_list, po.uneditable_related_list);\n      });\n    }\n    if (object.is_view) {\n      permissions.allowCreate = false;\n      permissions.allowEdit = false;\n      permissions.allowDelete = false;\n      permissions.modifyAllRecords = false;\n      permissions.modifyCompanyRecords = false;\n      permissions.disabled_actions = [];\n    }\n    Creator.processPermissions(permissions);\n    if (object.permission_set.owner) {\n      permissions.owner = object.permission_set.owner;\n    }\n    return permissions;\n  };\n  Meteor.methods({\n    \"creator.object_permissions\": function(spaceId) {\n      return Creator.getAllPermissions(spaceId, this.userId);\n    }\n  });\n}\n","\nsteedosCore = require('@steedos/core')\n\nMeteor.startup ()->\n\tcreator_db_url = process.env.MONGO_URL_CREATOR\n\toplog_url = process.env.MONGO_OPLOG_URL_CREATOR\n\tif creator_db_url\n\t\tif !oplog_url\n\t\t\tthrow new Meteor.Error(500, \"Please configure environment variables: MONGO_OPLOG_URL_CREATOR\")\n\t\tCreator._CREATOR_DATASOURCE = {_driver: new MongoInternals.RemoteCollectionDriver(creator_db_url, {oplogUrl: oplog_url})}\n\nCreator.getCollectionName = (object)->\n#\tif object.table_name && object.table_name.endsWith(\"__c\")\n#\t\treturn object.table_name\n#\telse\n#\t\treturn object.name\n\treturn object.name\nCreator.createCollection = (object)->\n\tcollection_key = Creator.getCollectionName(object)\n\tif db[collection_key]\n\t\treturn db[collection_key]\n\telse if object.db\n\t\treturn object.db\n\n\tif Creator.Collections[collection_key]\n\t\treturn Creator.Collections[collection_key]\n\telse\n\t\tif object.custom\n\t\t\treturn steedosCore.newCollection(collection_key, Creator._CREATOR_DATASOURCE)\n\t\telse\n\t\t\tif collection_key == '_sms_queue' && SMSQueue?.collection\n\t\t\t\treturn SMSQueue.collection\n\t\t\treturn steedosCore.newCollection(collection_key)\n\n\n","var steedosCore;\n\nsteedosCore = require('@steedos/core');\n\nMeteor.startup(function() {\n  var creator_db_url, oplog_url;\n  creator_db_url = process.env.MONGO_URL_CREATOR;\n  oplog_url = process.env.MONGO_OPLOG_URL_CREATOR;\n  if (creator_db_url) {\n    if (!oplog_url) {\n      throw new Meteor.Error(500, \"Please configure environment variables: MONGO_OPLOG_URL_CREATOR\");\n    }\n    return Creator._CREATOR_DATASOURCE = {\n      _driver: new MongoInternals.RemoteCollectionDriver(creator_db_url, {\n        oplogUrl: oplog_url\n      })\n    };\n  }\n});\n\nCreator.getCollectionName = function(object) {\n  return object.name;\n};\n\nCreator.createCollection = function(object) {\n  var collection_key;\n  collection_key = Creator.getCollectionName(object);\n  if (db[collection_key]) {\n    return db[collection_key];\n  } else if (object.db) {\n    return object.db;\n  }\n  if (Creator.Collections[collection_key]) {\n    return Creator.Collections[collection_key];\n  } else {\n    if (object.custom) {\n      return steedosCore.newCollection(collection_key, Creator._CREATOR_DATASOURCE);\n    } else {\n      if (collection_key === '_sms_queue' && (typeof SMSQueue !== \"undefined\" && SMSQueue !== null ? SMSQueue.collection : void 0)) {\n        return SMSQueue.collection;\n      }\n      return steedosCore.newCollection(collection_key);\n    }\n  }\n};\n","Creator.actionsByName = {}\n\nif Meteor.isClient\n\t# å®šä¹‰å…¨å±€ actions å‡½æ•°\t\n\tCreator.actions = (actions)->\n\t\t_.each actions, (todo, action_name)->\n\t\t\tCreator.actionsByName[action_name] = todo \n\n\tCreator.executeAction = (object_name, action, record_id, item_element, list_view_id, record, callback)->\n\t\tif action && action.type == 'word-print'\n\t\t\tif record_id\n\t\t\t\tfilters = ['_id', '=', record_id]\n\t\t\telse\n\t\t\t\tfilters = ObjectGrid.getFilters(object_name, list_view_id, false, null, null)\n\t\t\turl = \"/api/v4/word_templates/\" + action.word_template + \"/print\" + \"?filters=\" + SteedosFilters.formatFiltersToODataQuery(filters);\n\t\t\turl = Steedos.absoluteUrl(url);\n\t\t\treturn window.open(url);\n\n\t\tobj = Creator.getObject(object_name)\n\t\tif action?.todo\n\t\t\tif typeof action.todo == \"string\"\n\t\t\t\ttodo = Creator.actionsByName[action.todo]\n\t\t\telse if typeof action.todo == \"function\"\n\t\t\t\ttodo = action.todo\t\n\t\t\tif !record && object_name && record_id\n\t\t\t\trecord = Creator.odata.get(object_name, record_id)\n\t\t\tif todo\n\t\t\t\t# item_elementä¸ºç©ºæ—¶åº”è¯¥è®¾ç½®é»˜è®¤å€¼ï¼ˆå¯¹è±¡çš„nameå­—æ®µï¼‰ï¼Œå¦åˆ™moreArgsæ‹¿åˆ°çš„åŽç»­å‚æ•°ä½ç½®å°±ä¸å¯¹\n\t\t\t\titem_element = if item_element then item_element else \"\"\n\t\t\t\tmoreArgs = Array.prototype.slice.call(arguments, 3)\n\t\t\t\ttodoArgs = [object_name, record_id].concat(moreArgs)\n\t\t\t\ttodo.apply {\n\t\t\t\t\tobject_name: object_name\n\t\t\t\t\trecord_id: record_id\n\t\t\t\t\tobject: obj\n\t\t\t\t\taction: action\n\t\t\t\t\titem_element: item_element\n\t\t\t\t\trecord: record\n\t\t\t\t}, todoArgs\n\t\t\telse\n\t\t\t\ttoastr.warning(t(\"_object_actions_none_todo\"))\n\t\telse\n\t\t\ttoastr.warning(t(\"_object_actions_none_todo\"))\n\n\n\t_deleteRecord = (object_name, record_id, record_title, list_view_id, record, call_back, call_back_error)->\n\t\t# console.log(\"===_deleteRecord===\", object_name, record_id, record_title, list_view_id, record, call_back, call_back_error);\n\t\tobject = Creator.getObject(object_name)\n\t\tpreviousDoc = FormManager.getPreviousDoc(object_name, record_id, 'delete')\n\t\tCreator.odata.delete object_name, record_id, ()->\n\t\t\tif record_title\n\t\t\t\t# info = object.label + \"\\\"#{record_title}\\\"\" + \"å·²åˆ é™¤\"\n\t\t\t\tinfo =t \"creator_record_remove_swal_title_suc\", object.label + \"\\\"#{record_title}\\\"\"\n\t\t\telse\n\t\t\t\tinfo = t('creator_record_remove_swal_suc')\n\t\t\ttoastr.success info\n\t\t\tif call_back and typeof call_back == \"function\"\n\t\t\t\tcall_back()\n\n\t\t\tFormManager.runHook(object_name, 'delete', 'after', {_id: record_id, previousDoc: previousDoc})\n\t\t, (error)->\n\t\t\tif call_back_error and typeof call_back_error == \"function\"\n\t\t\t\tcall_back_error()\n\t\t\tFormManager.runHook(object_name, 'delete', 'error', {_id: record_id, error: error})\n\n\tCreator.relatedObjectStandardNew = (related_object_name)->\n\t\trelateObject = Creator.getObject(related_object_name)\n\t\tcollection_name = relateObject.label\n\t\tcollection = \"Creator.Collections.#{Creator.getObject(related_object_name)._collection_name}\"\n\t\tcurrent_object_name = Session.get(\"object_name\")\n\t\tcurrent_record_id = Session.get(\"record_id\")\n\t\tids = Creator.TabularSelectedIds[related_object_name]\n\t\tinitialValues = {};\n\t\tif ids?.length\n\t\t\t# åˆ—è¡¨æœ‰é€‰ä¸­é¡¹æ—¶ï¼Œå–ç¬¬ä¸€ä¸ªé€‰ä¸­é¡¹ï¼Œå¤åˆ¶å…¶å†…å®¹åˆ°æ–°å»ºçª—å£ä¸­\n\t\t\t# è¿™çš„ç¬¬ä¸€ä¸ªæŒ‡çš„æ˜¯ç¬¬ä¸€æ¬¡å‹¾é€‰çš„é€‰ä¸­é¡¹ï¼Œè€Œä¸æ˜¯åˆ—è¡¨ä¸­å·²å‹¾é€‰çš„ç¬¬ä¸€é¡¹\n\t\t\trecord_id = ids[0]\n\t\t\tdoc = Creator.odata.get(related_object_name, record_id)\n\t\t\tinitialValues = doc\n\t\t\t# â€œä¿å­˜å¹¶æ–°å»ºâ€æ“ä½œä¸­è‡ªåŠ¨æ‰“å¼€çš„æ–°çª—å£ä¸­éœ€è¦å†æ¬¡å¤åˆ¶æœ€æ–°çš„docå†…å®¹åˆ°æ–°çª—å£ä¸­\n\t\t\tSession.set 'cmShowAgainDuplicated', true\n\t\telse\n\t\t\tdefaultDoc = FormManager.getRelatedInitialValues(current_object_name, current_record_id, related_object_name);\n\t\t\tif !_.isEmpty(defaultDoc)\n\t\t\t\tinitialValues = defaultDoc\n\t\tif relateObject?.version >= 2\n\t\t\treturn SteedosUI.showModal(stores.ComponentRegistry.components.ObjectForm, {\n\t\t\t\tname: \"#{related_object_name}_standard_new_form\",\n\t\t\t\tobjectApiName: related_object_name,\n\t\t\t\ttitle: 'æ–°å»º ' + relateObject.label,\n\t\t\t\tinitialValues: initialValues,\n\t\t\t\tafterInsert: (result)->\n\t\t\t\t\tsetTimeout(()->\n\t\t\t\t\t\t# ObjectFormæœ‰ç¼“å­˜ï¼Œæ–°å»ºå­è¡¨è®°å½•å¯èƒ½ä¼šæœ‰æ±‡æ€»å­—æ®µï¼Œéœ€è¦åˆ·æ–°è¡¨å•æ•°æ®\n\t\t\t\t\t\tif Creator.getObject(current_object_name).version > 1\n\t\t\t\t\t\t\tSteedosUI.reloadRecord(current_object_name, current_record_id)\n\t\t\t\t\t\tFlowRouter.reload();\n\t\t\t\t\t, 1);\n\t\t\t\t\treturn true;\n\t\t\t}, null, {iconPath: '/assets/icons'})\n\n\n\t\tif ids?.length\n\t\t\t# åˆ—è¡¨æœ‰é€‰ä¸­é¡¹æ—¶ï¼Œå–ç¬¬ä¸€ä¸ªé€‰ä¸­é¡¹ï¼Œå¤åˆ¶å…¶å†…å®¹åˆ°æ–°å»ºçª—å£ä¸­\n\t\t\t# è¿™çš„ç¬¬ä¸€ä¸ªæŒ‡çš„æ˜¯ç¬¬ä¸€æ¬¡å‹¾é€‰çš„é€‰ä¸­é¡¹ï¼Œè€Œä¸æ˜¯åˆ—è¡¨ä¸­å·²å‹¾é€‰çš„ç¬¬ä¸€é¡¹\n\t\t\tSession.set 'cmDoc', initialValues\n\t\t\t# â€œä¿å­˜å¹¶æ–°å»ºâ€æ“ä½œä¸­è‡ªåŠ¨æ‰“å¼€çš„æ–°çª—å£ä¸­éœ€è¦å†æ¬¡å¤åˆ¶æœ€æ–°çš„docå†…å®¹åˆ°æ–°çª—å£ä¸­\n\t\t\tSession.set 'cmShowAgainDuplicated', true\n\t\telse\n\t\t\tif !_.isEmpty(initialValues)\n\t\t\t\tSession.set 'cmDoc', initialValues\n\n\t\tSession.set(\"action_fields\", undefined)\n\t\tSession.set(\"action_collection\", collection)\n\t\tSession.set(\"action_collection_name\", collection_name)\n\t\tSession.set(\"action_save_and_insert\", false)\n\t\tMeteor.defer ()->\n\t\t\t$(\".creator-add-related\").click()\n\t\treturn\n\n\tCreator.actions \n\t\t# åœ¨æ­¤å®šä¹‰å…¨å±€ actions\n\t\t\"standard_query\": ()->\n\t\t\tModal.show(\"standard_query_modal\")\n\n\t\t\"standard_new\": (object_name, record_id, fields)->\n\t\t\t# current_record_id = Session.get(\"record_id\")\n\t\t\t# if current_record_id\n\t\t\t# \t# amis ç›¸å…³å­è¡¨å³ä¸Šè§’æ–°å»º\n\t\t\t# \tCreator.relatedObjectStandardNew(object_name)\n\t\t\t# \treturn \n\t\t\tobject = Creator.getObject(object_name);\n\t\t\tgridName = this.action.gridName;\n\t\t\tisRelated = this.action.isRelated;\n\t\t\tif isRelated\n\t\t\t\trelatedFieldName = this.action.relatedFieldName;\n\t\t\t\tmasterRecordId = this.action.masterRecordId;\n\t\t\t\tinitialValues = this.action.initialValues\n\t\t\t\tif !initialValues\n\t\t\t\t\tinitialValues = {};\n\t\t\t\t\tinitialValues[relatedFieldName] = masterRecordId\n\t\t\telse\n\t\t\t\tinitialValues={}\n\t\t\t\tif(gridName)\n\t\t\t\t\tselectedRows = window.gridRefs?[gridName].current?.api?.getSelectedRows()\n\t\t\t\telse\n\t\t\t\t\tselectedRows = window.gridRef?.current?.api?.getSelectedRows()\t\n\t\t\t\t\n\t\t\t\tif selectedRows?.length\n\t\t\t\t\trecord_id = selectedRows[0]._id;\n\t\t\t\t\tif record_id\n\t\t\t\t\t\tinitialValues = Creator.odata.get(object_name, record_id)\n\n\t\t\t\telse\n\t\t\t\t\tinitialValues = FormManager.getInitialValues(object_name)\n\n\t\t\tif object?.version >= 2\n\t\t\t\treturn Steedos.Page.Form.StandardNew.render(Session.get(\"app_id\"), object_name, t('New') + ' ' + object.label, initialValues , {gridName: gridName});\n\t\t\tSession.set 'action_object_name', object_name\n\t\t\tif selectedRows?.length\n\t\t\t\t# åˆ—è¡¨æœ‰é€‰ä¸­é¡¹æ—¶ï¼Œå–ç¬¬ä¸€ä¸ªé€‰ä¸­é¡¹ï¼Œå¤åˆ¶å…¶å†…å®¹åˆ°æ–°å»ºçª—å£ä¸­\n\t\t\t\t# è¿™çš„ç¬¬ä¸€ä¸ªæŒ‡çš„æ˜¯ç¬¬ä¸€æ¬¡å‹¾é€‰çš„é€‰ä¸­é¡¹ï¼Œè€Œä¸æ˜¯åˆ—è¡¨ä¸­å·²å‹¾é€‰çš„ç¬¬ä¸€é¡¹\n\t\t\t\tSession.set 'cmDoc', initialValues\n\t\t\t\t# â€œä¿å­˜å¹¶æ–°å»ºâ€æ“ä½œä¸­è‡ªåŠ¨æ‰“å¼€çš„æ–°çª—å£ä¸­éœ€è¦å†æ¬¡å¤åˆ¶æœ€æ–°çš„docå†…å®¹åˆ°æ–°çª—å£ä¸­\n\t\t\t\tSession.set 'cmShowAgainDuplicated', true\n\t\t\telse\n\t\t\t\tSession.set 'cmDoc', initialValues\n\t\t\tMeteor.defer ()->\n\t\t\t\t$(\".creator-add\").click()\n\t\t\treturn \n\n\t\t\"standard_open_view\": (object_name, record_id, fields)->\n\t\t\thref = Creator.getObjectUrl(object_name, record_id)\n\t\t\tFlowRouter.redirect(href)\n\t\t\treturn false\n\n\t\t\"standard_edit\": (object_name, record_id, fields)->\n\t\t\tif record_id\n\t\t\t\tobject = Creator.getObject(object_name);\n\t\t\t\tif object?.version >= 2\n\t\t\t\t\treturn Steedos.Page.Form.StandardEdit.render(Session.get(\"app_id\"), object_name, t('Edit') + ' ' + object.label, record_id, {\n\t\t\t\t\t\tgridName: this.action.gridName\n\t\t\t\t\t})\n\t\t\t\tif Steedos.isMobile() && false\n#\t\t\t\t\trecord = Creator.getObjectRecord(object_name, record_id)\n#\t\t\t\t\tSession.set 'cmDoc', record\n#\t\t\t\t\tSession.set 'reload_dxlist', false\n\t\t\t\t\tSession.set 'action_object_name', object_name\n\t\t\t\t\tSession.set 'action_record_id', record_id\n\t\t\t\t\tif this.record\n\t\t\t\t\t\tSession.set 'cmDoc', this.record\n\t\t\t\t\tMeteor.defer ()->\n\t\t\t\t\t\t$(\".btn-edit-record\").click()\n\t\t\t\telse\n\t\t\t\t\tSession.set 'action_object_name', object_name\n\t\t\t\t\tSession.set 'action_record_id', record_id\n\t\t\t\t\tif this.record\n\t\t\t\t\t\tSession.set 'cmDoc', this.record\n\t\t\t\t\t\tMeteor.defer ()->\n\t\t\t\t\t\t\t$(\".btn.creator-edit\").click()\n\n\t\t\"standard_delete\": (object_name, record_id, record_title, list_view_id, record, call_back)->\n\t\t\tgridName = this.action.gridName;\n\t\t\t# console.log(\"===standard_delete===\", object_name, record_id, record_title, list_view_id, record, call_back);\n\t\t\tif record_id\n\t\t\t\tbeforeHook = FormManager.runHook(object_name, 'delete', 'before', {_id: record_id})\n\t\t\t\tif !beforeHook\n\t\t\t\t\treturn false;\n\t\t\tobject = Creator.getObject(object_name)\n\t\t\tnameField = object.NAME_FIELD_KEY || \"name\"\n\n\t\t\tunless list_view_id\n\t\t\t\tlist_view_id = Session.get(\"list_view_id\")\n\t\t\tunless list_view_id\n\t\t\t\tlist_view_id = \"all\"\n\n\t\t\tif(!_.isString(record_title) && record_title)\n\t\t\t\trecord_title = record_title[nameField]\n\t\t\t\n\t\t\tif record && !record_title\n\t\t\t\trecord_title = record[nameField]\n\t\t\t\n\t\t\ti18nTitleKey = \"creator_record_remove_swal_title\"\n\t\t\ti18nTextKey = \"creator_record_remove_swal_text\"\n\n\t\t\tunless record_id\n\t\t\t\ti18nTitleKey = \"creator_record_remove_many_swal_title\"\n\t\t\t\ti18nTextKey = \"creator_record_remove_many_swal_text\"\n\n\t\t\t\t# å¦‚æžœæ˜¯æ‰¹é‡åˆ é™¤ï¼Œåˆ™ä¼ å…¥çš„list_view_idä¸ºåˆ—è¡¨è§†å›¾çš„nameï¼Œç”¨äºŽèŽ·å–åˆ—è¡¨é€‰ä¸­é¡¹\n\t\t\t\t# ä¸»åˆ—è¡¨è§„åˆ™æ˜¯\"listview_#{object_name}_#{list_view_id}\"ï¼Œç›¸å…³è¡¨è§„åˆ™æ˜¯\"related_listview_#{object_name}_#{related_object_name}_#{related_field_name}\"\n\t\t\t\tselectedRecords = SteedosUI.getTableSelectedRows(gridName || list_view_id)\n\t\t\t\tif !selectedRecords || !selectedRecords.length\n\t\t\t\t\ttoastr.warning(t(\"creator_record_remove_many_no_selection\"))\n\t\t\t\t\treturn\n\n\t\t\tif record_title\n\t\t\t\ttext = t i18nTextKey, \"#{object.label} \\\"#{record_title}\\\"\"\n\t\t\telse\n\t\t\t\ttext = t i18nTextKey, \"#{object.label}\"\n\t\t\tswal\n\t\t\t\ttitle: t i18nTitleKey, \"#{object.label}\"\n\t\t\t\ttext: \"<div class='delete-creator-warning'>#{text}</div>\"\n\t\t\t\thtml: true\n\t\t\t\tshowCancelButton:true\n\t\t\t\tconfirmButtonText: t('Delete')\n\t\t\t\tcancelButtonText: t('Cancel')\n\t\t\t\t(option) ->\n\t\t\t\t\tif option\n\t\t\t\t\t\tif record_id\n\t\t\t\t\t\t\t# å•æ¡è®°å½•åˆ é™¤\n\t\t\t\t\t\t\t_deleteRecord object_name, record_id, record_title, list_view_id, record, ()->\n\t\t\t\t\t\t\t\t# æ–‡ä»¶ç‰ˆæœ¬ä¸º\"cfs.files.filerecord\"ï¼Œéœ€è¦æ›¿æ¢ä¸º\"cfs-files-filerecord\"\n\t\t\t\t\t\t\t\tgridObjectNameClass = object_name.replace(/\\./g,\"-\")\n\t\t\t\t\t\t\t\tgridContainer = $(\".gridContainer.#{gridObjectNameClass}\")\n\t\t\t\t\t\t\t\tunless gridContainer?.length\n\t\t\t\t\t\t\t\t\tif window.opener\n\t\t\t\t\t\t\t\t\t\tisOpenerRemove = false\n\t\t\t\t\t\t\t\t\t\tgridContainer = window.opener.$(\".gridContainer.#{gridObjectNameClass}\")\n\t\t\t\t\t\t\t\ttry\n\t\t\t\t\t\t\t\t\t# ObjectFormæœ‰ç¼“å­˜ï¼Œåˆ é™¤å­è¡¨è®°å½•å¯èƒ½ä¼šæœ‰æ±‡æ€»å­—æ®µï¼Œéœ€è¦åˆ·æ–°è¡¨å•æ•°æ®\n\t\t\t\t\t\t\t\t\tcurrent_object_name = Session.get(\"object_name\")\n\t\t\t\t\t\t\t\t\tcurrent_record_id = Session.get(\"record_id\")\n\t\t\t\t\t\t\t\t\tif current_object_name && Creator.getObject(current_object_name)?.version > 1\n\t\t\t\t\t\t\t\t\t\tSteedosUI.reloadRecord(current_object_name, current_record_id)\n\t\t\t\t\t\t\t\t\tif FlowRouter.current().route.path.endsWith(\"/:record_id\")\n\t\t\t\t\t\t\t\t\t\tif object_name != Session.get(\"object_name\")\n\t\t\t\t\t\t\t\t\t\t\tFlowRouter.reload();\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\twindow.refreshGrid(gridName);\n\t\t\t\t\t\t\t\tcatch _e\n\t\t\t\t\t\t\t\t\tconsole.error(_e);\n\t\t\t\t\t\t\t\tif gridContainer?.length\n\t\t\t\t\t\t\t\t\tif object.enable_tree\n\t\t\t\t\t\t\t\t\t\tdxDataGridInstance = gridContainer.dxTreeList().dxTreeList('instance')\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\tdxDataGridInstance = gridContainer.dxDataGrid().dxDataGrid('instance')\n\t\t\t\t\t\t\t\tif dxDataGridInstance\n\t\t\t\t\t\t\t\t\tif object.enable_tree\n\t\t\t\t\t\t\t\t\t\tdxDataGridInstance.refresh()\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\tif object_name != Session.get(\"object_name\")\n\t\t\t\t\t\t\t\t\t\t\tFlowRouter.reload();\n\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\tTemplate.creator_grid.refresh(dxDataGridInstance)\n\t\t\t\t\t\t\t\trecordUrl = Creator.getObjectUrl(object_name, record_id)\n\t\t\t\t\t\t\t\ttempNavRemoved = Creator.removeTempNavItem(object_name, recordUrl) #æ— è®ºæ˜¯åœ¨è®°å½•è¯¦ç»†ç•Œé¢è¿˜æ˜¯åˆ—è¡¨ç•Œé¢æ‰§è¡Œåˆ é™¤æ“ä½œï¼Œéƒ½ä¼šæŠŠä¸´æ—¶å¯¼èˆªåˆ é™¤æŽ‰\n\t\t\t\t\t\t\t\tif isOpenerRemove or !dxDataGridInstance\n\t\t\t\t\t\t\t\t\tif isOpenerRemove\n\t\t\t\t\t\t\t\t\t\twindow.close()\n\t\t\t\t\t\t\t\t\telse if record_id == Session.get(\"record_id\") and list_view_id != 'calendar'\n\t\t\t\t\t\t\t\t\t\tappid = Session.get(\"app_id\")\n\t\t\t\t\t\t\t\t\t\tunless tempNavRemoved\n\t\t\t\t\t\t\t\t\t\t\t# å¦‚æžœç¡®å®žåˆ é™¤äº†ä¸´æ—¶å¯¼èˆªï¼Œå°±å¯èƒ½å·²ç»é‡å®šå‘åˆ°ä¸Šä¸€ä¸ªé¡µé¢äº†ï¼Œæ²¡å¿…è¦å†é‡å®šå‘ä¸€æ¬¡\n\t\t\t\t\t\t\t\t\t\t\tFlowRouter.go \"/app/#{appid}/#{object_name}/grid/#{list_view_id}\"\n\t\t\t\t\t\t\t\tif call_back and typeof call_back == \"function\"\n\t\t\t\t\t\t\t\t\tcall_back()\t\t\t\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\t# æ‰¹é‡åˆ é™¤\n\t\t\t\t\t\t\tif selectedRecords && selectedRecords.length\n\t\t\t\t\t\t\t\t$(\"body\").addClass(\"loading\")\n\t\t\t\t\t\t\t\tdeleteCounter = 0;\n\t\t\t\t\t\t\t\tafterBatchesDelete = ()->\n\t\t\t\t\t\t\t\t\tdeleteCounter++\n\t\t\t\t\t\t\t\t\tif deleteCounter >= selectedRecords.length\n\t\t\t\t\t\t\t\t\t\t# console.log(\"deleteCounter, selectedRecords.length===\", deleteCounter, selectedRecords.length);\n\t\t\t\t\t\t\t\t\t\t$(\"body\").removeClass(\"loading\")\n\t\t\t\t\t\t\t\t\t\twindow.refreshGrid(gridName);\n\t\t\t\t\t\t\t\tselectedRecords.forEach (record)->\n\t\t\t\t\t\t\t\t\trecord_id = record._id\n\t\t\t\t\t\t\t\t\tbeforeHook = FormManager.runHook(object_name, 'delete', 'before', {_id: record_id})\n\t\t\t\t\t\t\t\t\tif !beforeHook\n\t\t\t\t\t\t\t\t\t\tafterBatchesDelete()\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\trecordTitle = record[nameField] || record_id\n\t\t\t\t\t\t\t\t\t_deleteRecord object_name, record._id, recordTitle, list_view_id, record, (()->\n\t\t\t\t\t\t\t\t\t\trecordUrl = Creator.getObjectUrl(object_name, record_id)\n\t\t\t\t\t\t\t\t\t\tCreator.removeTempNavItem(object_name, recordUrl) #æ— è®ºæ˜¯åœ¨è®°å½•è¯¦ç»†ç•Œé¢è¿˜æ˜¯åˆ—è¡¨ç•Œé¢æ‰§è¡Œåˆ é™¤æ“ä½œï¼Œéƒ½ä¼šæŠŠä¸´æ—¶å¯¼èˆªåˆ é™¤æŽ‰\n\t\t\t\t\t\t\t\t\t\tafterBatchesDelete()\n\t\t\t\t\t\t\t\t\t), ()->\n\t\t\t\t\t\t\t\t\t\tafterBatchesDelete()","var _deleteRecord;\n\nCreator.actionsByName = {};\n\nif (Meteor.isClient) {\n  Creator.actions = function(actions) {\n    return _.each(actions, function(todo, action_name) {\n      return Creator.actionsByName[action_name] = todo;\n    });\n  };\n  Creator.executeAction = function(object_name, action, record_id, item_element, list_view_id, record, callback) {\n    var filters, moreArgs, obj, todo, todoArgs, url;\n    if (action && action.type === 'word-print') {\n      if (record_id) {\n        filters = ['_id', '=', record_id];\n      } else {\n        filters = ObjectGrid.getFilters(object_name, list_view_id, false, null, null);\n      }\n      url = \"/api/v4/word_templates/\" + action.word_template + \"/print\" + \"?filters=\" + SteedosFilters.formatFiltersToODataQuery(filters);\n      url = Steedos.absoluteUrl(url);\n      return window.open(url);\n    }\n    obj = Creator.getObject(object_name);\n    if (action != null ? action.todo : void 0) {\n      if (typeof action.todo === \"string\") {\n        todo = Creator.actionsByName[action.todo];\n      } else if (typeof action.todo === \"function\") {\n        todo = action.todo;\n      }\n      if (!record && object_name && record_id) {\n        record = Creator.odata.get(object_name, record_id);\n      }\n      if (todo) {\n        item_element = item_element ? item_element : \"\";\n        moreArgs = Array.prototype.slice.call(arguments, 3);\n        todoArgs = [object_name, record_id].concat(moreArgs);\n        return todo.apply({\n          object_name: object_name,\n          record_id: record_id,\n          object: obj,\n          action: action,\n          item_element: item_element,\n          record: record\n        }, todoArgs);\n      } else {\n        return toastr.warning(t(\"_object_actions_none_todo\"));\n      }\n    } else {\n      return toastr.warning(t(\"_object_actions_none_todo\"));\n    }\n  };\n  _deleteRecord = function(object_name, record_id, record_title, list_view_id, record, call_back, call_back_error) {\n    var object, previousDoc;\n    object = Creator.getObject(object_name);\n    previousDoc = FormManager.getPreviousDoc(object_name, record_id, 'delete');\n    return Creator.odata[\"delete\"](object_name, record_id, function() {\n      var info;\n      if (record_title) {\n        info = t(\"creator_record_remove_swal_title_suc\", object.label + (\"\\\"\" + record_title + \"\\\"\"));\n      } else {\n        info = t('creator_record_remove_swal_suc');\n      }\n      toastr.success(info);\n      if (call_back && typeof call_back === \"function\") {\n        call_back();\n      }\n      return FormManager.runHook(object_name, 'delete', 'after', {\n        _id: record_id,\n        previousDoc: previousDoc\n      });\n    }, function(error) {\n      if (call_back_error && typeof call_back_error === \"function\") {\n        call_back_error();\n      }\n      return FormManager.runHook(object_name, 'delete', 'error', {\n        _id: record_id,\n        error: error\n      });\n    });\n  };\n  Creator.relatedObjectStandardNew = function(related_object_name) {\n    var collection, collection_name, current_object_name, current_record_id, defaultDoc, doc, ids, initialValues, record_id, relateObject;\n    relateObject = Creator.getObject(related_object_name);\n    collection_name = relateObject.label;\n    collection = \"Creator.Collections.\" + (Creator.getObject(related_object_name)._collection_name);\n    current_object_name = Session.get(\"object_name\");\n    current_record_id = Session.get(\"record_id\");\n    ids = Creator.TabularSelectedIds[related_object_name];\n    initialValues = {};\n    if (ids != null ? ids.length : void 0) {\n      record_id = ids[0];\n      doc = Creator.odata.get(related_object_name, record_id);\n      initialValues = doc;\n      Session.set('cmShowAgainDuplicated', true);\n    } else {\n      defaultDoc = FormManager.getRelatedInitialValues(current_object_name, current_record_id, related_object_name);\n      if (!_.isEmpty(defaultDoc)) {\n        initialValues = defaultDoc;\n      }\n    }\n    if ((relateObject != null ? relateObject.version : void 0) >= 2) {\n      return SteedosUI.showModal(stores.ComponentRegistry.components.ObjectForm, {\n        name: related_object_name + \"_standard_new_form\",\n        objectApiName: related_object_name,\n        title: 'æ–°å»º ' + relateObject.label,\n        initialValues: initialValues,\n        afterInsert: function(result) {\n          setTimeout(function() {\n            if (Creator.getObject(current_object_name).version > 1) {\n              SteedosUI.reloadRecord(current_object_name, current_record_id);\n            }\n            return FlowRouter.reload();\n          }, 1);\n          return true;\n        }\n      }, null, {\n        iconPath: '/assets/icons'\n      });\n    }\n    if (ids != null ? ids.length : void 0) {\n      Session.set('cmDoc', initialValues);\n      Session.set('cmShowAgainDuplicated', true);\n    } else {\n      if (!_.isEmpty(initialValues)) {\n        Session.set('cmDoc', initialValues);\n      }\n    }\n    Session.set(\"action_fields\", void 0);\n    Session.set(\"action_collection\", collection);\n    Session.set(\"action_collection_name\", collection_name);\n    Session.set(\"action_save_and_insert\", false);\n    Meteor.defer(function() {\n      return $(\".creator-add-related\").click();\n    });\n  };\n  Creator.actions({\n    \"standard_query\": function() {\n      return Modal.show(\"standard_query_modal\");\n    },\n    \"standard_new\": function(object_name, record_id, fields) {\n      var gridName, initialValues, isRelated, masterRecordId, object, ref, ref1, ref2, ref3, ref4, ref5, relatedFieldName, selectedRows;\n      object = Creator.getObject(object_name);\n      gridName = this.action.gridName;\n      isRelated = this.action.isRelated;\n      if (isRelated) {\n        relatedFieldName = this.action.relatedFieldName;\n        masterRecordId = this.action.masterRecordId;\n        initialValues = this.action.initialValues;\n        if (!initialValues) {\n          initialValues = {};\n          initialValues[relatedFieldName] = masterRecordId;\n        }\n      } else {\n        initialValues = {};\n        if (gridName) {\n          selectedRows = (ref = window.gridRefs) != null ? (ref1 = ref[gridName].current) != null ? (ref2 = ref1.api) != null ? ref2.getSelectedRows() : void 0 : void 0 : void 0;\n        } else {\n          selectedRows = (ref3 = window.gridRef) != null ? (ref4 = ref3.current) != null ? (ref5 = ref4.api) != null ? ref5.getSelectedRows() : void 0 : void 0 : void 0;\n        }\n        if (selectedRows != null ? selectedRows.length : void 0) {\n          record_id = selectedRows[0]._id;\n          if (record_id) {\n            initialValues = Creator.odata.get(object_name, record_id);\n          }\n        } else {\n          initialValues = FormManager.getInitialValues(object_name);\n        }\n      }\n      if ((object != null ? object.version : void 0) >= 2) {\n        return Steedos.Page.Form.StandardNew.render(Session.get(\"app_id\"), object_name, t('New') + ' ' + object.label, initialValues, {\n          gridName: gridName\n        });\n      }\n      Session.set('action_object_name', object_name);\n      if (selectedRows != null ? selectedRows.length : void 0) {\n        Session.set('cmDoc', initialValues);\n        Session.set('cmShowAgainDuplicated', true);\n      } else {\n        Session.set('cmDoc', initialValues);\n      }\n      Meteor.defer(function() {\n        return $(\".creator-add\").click();\n      });\n    },\n    \"standard_open_view\": function(object_name, record_id, fields) {\n      var href;\n      href = Creator.getObjectUrl(object_name, record_id);\n      FlowRouter.redirect(href);\n      return false;\n    },\n    \"standard_edit\": function(object_name, record_id, fields) {\n      var object;\n      if (record_id) {\n        object = Creator.getObject(object_name);\n        if ((object != null ? object.version : void 0) >= 2) {\n          return Steedos.Page.Form.StandardEdit.render(Session.get(\"app_id\"), object_name, t('Edit') + ' ' + object.label, record_id, {\n            gridName: this.action.gridName\n          });\n        }\n        if (Steedos.isMobile() && false) {\n          Session.set('action_object_name', object_name);\n          Session.set('action_record_id', record_id);\n          if (this.record) {\n            Session.set('cmDoc', this.record);\n          }\n          return Meteor.defer(function() {\n            return $(\".btn-edit-record\").click();\n          });\n        } else {\n          Session.set('action_object_name', object_name);\n          Session.set('action_record_id', record_id);\n          if (this.record) {\n            Session.set('cmDoc', this.record);\n            return Meteor.defer(function() {\n              return $(\".btn.creator-edit\").click();\n            });\n          }\n        }\n      }\n    },\n    \"standard_delete\": function(object_name, record_id, record_title, list_view_id, record, call_back) {\n      var beforeHook, gridName, i18nTextKey, i18nTitleKey, nameField, object, selectedRecords, text;\n      gridName = this.action.gridName;\n      if (record_id) {\n        beforeHook = FormManager.runHook(object_name, 'delete', 'before', {\n          _id: record_id\n        });\n        if (!beforeHook) {\n          return false;\n        }\n      }\n      object = Creator.getObject(object_name);\n      nameField = object.NAME_FIELD_KEY || \"name\";\n      if (!list_view_id) {\n        list_view_id = Session.get(\"list_view_id\");\n      }\n      if (!list_view_id) {\n        list_view_id = \"all\";\n      }\n      if (!_.isString(record_title) && record_title) {\n        record_title = record_title[nameField];\n      }\n      if (record && !record_title) {\n        record_title = record[nameField];\n      }\n      i18nTitleKey = \"creator_record_remove_swal_title\";\n      i18nTextKey = \"creator_record_remove_swal_text\";\n      if (!record_id) {\n        i18nTitleKey = \"creator_record_remove_many_swal_title\";\n        i18nTextKey = \"creator_record_remove_many_swal_text\";\n        selectedRecords = SteedosUI.getTableSelectedRows(gridName || list_view_id);\n        if (!selectedRecords || !selectedRecords.length) {\n          toastr.warning(t(\"creator_record_remove_many_no_selection\"));\n          return;\n        }\n      }\n      if (record_title) {\n        text = t(i18nTextKey, object.label + \" \\\"\" + record_title + \"\\\"\");\n      } else {\n        text = t(i18nTextKey, \"\" + object.label);\n      }\n      return swal({\n        title: t(i18nTitleKey, \"\" + object.label),\n        text: \"<div class='delete-creator-warning'>\" + text + \"</div>\",\n        html: true,\n        showCancelButton: true,\n        confirmButtonText: t('Delete'),\n        cancelButtonText: t('Cancel')\n      }, function(option) {\n        var afterBatchesDelete, deleteCounter;\n        if (option) {\n          if (record_id) {\n            return _deleteRecord(object_name, record_id, record_title, list_view_id, record, function() {\n              var _e, appid, current_object_name, current_record_id, dxDataGridInstance, gridContainer, gridObjectNameClass, isOpenerRemove, recordUrl, ref, tempNavRemoved;\n              gridObjectNameClass = object_name.replace(/\\./g, \"-\");\n              gridContainer = $(\".gridContainer.\" + gridObjectNameClass);\n              if (!(gridContainer != null ? gridContainer.length : void 0)) {\n                if (window.opener) {\n                  isOpenerRemove = false;\n                  gridContainer = window.opener.$(\".gridContainer.\" + gridObjectNameClass);\n                }\n              }\n              try {\n                current_object_name = Session.get(\"object_name\");\n                current_record_id = Session.get(\"record_id\");\n                if (current_object_name && ((ref = Creator.getObject(current_object_name)) != null ? ref.version : void 0) > 1) {\n                  SteedosUI.reloadRecord(current_object_name, current_record_id);\n                }\n                if (FlowRouter.current().route.path.endsWith(\"/:record_id\")) {\n                  if (object_name !== Session.get(\"object_name\")) {\n                    FlowRouter.reload();\n                  }\n                } else {\n                  window.refreshGrid(gridName);\n                }\n              } catch (error1) {\n                _e = error1;\n                console.error(_e);\n              }\n              if (gridContainer != null ? gridContainer.length : void 0) {\n                if (object.enable_tree) {\n                  dxDataGridInstance = gridContainer.dxTreeList().dxTreeList('instance');\n                } else {\n                  dxDataGridInstance = gridContainer.dxDataGrid().dxDataGrid('instance');\n                }\n              }\n              if (dxDataGridInstance) {\n                if (object.enable_tree) {\n                  dxDataGridInstance.refresh();\n                } else {\n                  if (object_name !== Session.get(\"object_name\")) {\n                    FlowRouter.reload();\n                  } else {\n                    Template.creator_grid.refresh(dxDataGridInstance);\n                  }\n                }\n              }\n              recordUrl = Creator.getObjectUrl(object_name, record_id);\n              tempNavRemoved = Creator.removeTempNavItem(object_name, recordUrl);\n              if (isOpenerRemove || !dxDataGridInstance) {\n                if (isOpenerRemove) {\n                  window.close();\n                } else if (record_id === Session.get(\"record_id\") && list_view_id !== 'calendar') {\n                  appid = Session.get(\"app_id\");\n                  if (!tempNavRemoved) {\n                    FlowRouter.go(\"/app/\" + appid + \"/\" + object_name + \"/grid/\" + list_view_id);\n                  }\n                }\n              }\n              if (call_back && typeof call_back === \"function\") {\n                return call_back();\n              }\n            });\n          } else {\n            if (selectedRecords && selectedRecords.length) {\n              $(\"body\").addClass(\"loading\");\n              deleteCounter = 0;\n              afterBatchesDelete = function() {\n                deleteCounter++;\n                if (deleteCounter >= selectedRecords.length) {\n                  $(\"body\").removeClass(\"loading\");\n                  return window.refreshGrid(gridName);\n                }\n              };\n              return selectedRecords.forEach(function(record) {\n                var recordTitle;\n                record_id = record._id;\n                beforeHook = FormManager.runHook(object_name, 'delete', 'before', {\n                  _id: record_id\n                });\n                if (!beforeHook) {\n                  afterBatchesDelete();\n                  return;\n                }\n                recordTitle = record[nameField] || record_id;\n                return _deleteRecord(object_name, record._id, recordTitle, list_view_id, record, (function() {\n                  var recordUrl;\n                  recordUrl = Creator.getObjectUrl(object_name, record_id);\n                  Creator.removeTempNavItem(object_name, recordUrl);\n                  return afterBatchesDelete();\n                }), function() {\n                  return afterBatchesDelete();\n                });\n              });\n            }\n          }\n        }\n      });\n    }\n  });\n}\n"]}