{"version":3,"sources":["meteor://ðŸ’»app/packages/steedos:creator/checkNpm.js","meteor://ðŸ’»app/packages/steedos_creator/core.coffee","meteor://ðŸ’»app/core.coffee","meteor://ðŸ’»app/packages/steedos_creator/lib/apps.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/methods/object_recent_viewed.coffee","meteor://ðŸ’»app/server/methods/object_recent_viewed.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/methods/object_recent_record.coffee","meteor://ðŸ’»app/server/methods/object_recent_record.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/methods/object_listviews_options.coffee","meteor://ðŸ’»app/server/methods/object_listviews_options.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/methods/report_data.coffee","meteor://ðŸ’»app/server/methods/report_data.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/methods/user_tabular_settings.coffee","meteor://ðŸ’»app/server/methods/user_tabular_settings.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/methods/object_export2xml.coffee","meteor://ðŸ’»app/server/methods/object_export2xml.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/methods/related_objects_records.coffee","meteor://ðŸ’»app/server/methods/related_objects_records.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/methods/pending_space.coffee","meteor://ðŸ’»app/server/methods/pending_space.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/publications/object.coffee","meteor://ðŸ’»app/server/publications/object.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/publications/object_tabular.coffee","meteor://ðŸ’»app/server/publications/object_tabular.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/publications/object_listviews.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/publications/user_tabular_settings.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/publications/related_objects_records.coffee","meteor://ðŸ’»app/server/publications/related_objects_records.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/publications/space_user_info.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/publications/contacts_view_limits.coffee","meteor://ðŸ’»app/server/publications/contacts_view_limits.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/publications/contacts_no_force_phone_users.coffee","meteor://ðŸ’»app/server/publications/contacts_no_force_phone_users.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/publications/space_need_to_confirm.coffee","meteor://ðŸ’»app/server/publications/space_need_to_confirm.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/lib/permission_manager.coffee","meteor://ðŸ’»app/server/lib/permission_manager.coffee","meteor://ðŸ’»app/packages/steedos_creator/server/lib/uuflowManagerForInitApproval.coffee","meteor://ðŸ’»app/server/lib/uuflowManagerForInitApproval.coffee"],"names":["checkNpmVersions","module","link","v","busboy","Meteor","settings","cfs","aliyun","Creator","getSchema","object_name","ref","getObject","schema","getObjectHomeComponent","getObjectUrl","record_id","app_id","list_view","list_view_id","Session","get","getListView","_id","getRelativeUrl","getObjectAbsoluteUrl","Steedos","absoluteUrl","getObjectRouterUrl","getListViewUrl","url","getListViewRelativeUrl","getSwitchListUrl","getRelatedObjectUrl","related_object_name","related_field_name","getObjectLookupFieldOptions","is_deep","is_skip_hide","is_related","_object","_options","fields","icon","relatedObjects","_","forEach","f","k","hidden","type","push","label","value","r_object","reference_to","isString","f2","k2","getRelatedObjects","each","_this","_relatedObject","relatedObject","relatedOptions","relatedOption","foreign_key","name","getObjectFilterFieldOptions","permission_fields","getFields","include","test","indexOf","getObjectFieldOptions","getFiltersWithFilterFields","filters","filter_fields","length","n","field","required","findWhere","is_default","is_required","filterItem","matchField","find","getObjectRecord","select_fields","expand","collection","obj","record","ref1","ref2","isClient","Template","instance","odata","database_name","getCollection","findOne","getObjectRecordName","name_field_key","NAME_FIELD_KEY","getApp","appMenus","currentApp","menuItem","id","getAppDashboard","app","dashboard","Dashboards","apps","getAppDashboardComponent","getAppObjectNames","appObjects","isMobile","objects","mobile_objects","permissions","allowRead","getUrlWithToken","expressionFormData","hasQuerySymbol","linkStr","params","spaceId","userId","getUserCompanyIds","Accounts","_storedLoginToken","isExpression","parseSingleExpression","USER_CONTEXT","$","param","getAppMenu","menu_id","menus","getAppMenus","menu","getAppMenuUrlForInternet","path","getAppMenuUrl","target","curentAppMenus","children","loadAppsMenus","data","options","mobile","success","set","authRequest","creatorAppsSelector","assigned_apps","adminApp","creatorApps","sortedApps","key","is_creator","visible","sortBy","values","admin","visibleAppsSelector","includeAdmin","getVisibleApps","changeApp","_subApp","Object","assign","Apps","getVisibleAppsObjects","visibleObjectNames","flatten","pluck","filter","Objects","sort","sortingMethod","bind","uniq","getAppsObjects","tempObjects","concat","validateFilters","logic","e","errorMsg","filter_items","filter_length","flag","index","word","map","isEmpty","compact","replace","match","i","includes","w","error","console","log","toastr","formatFiltersToMongo","selector","Array","operation","option","reg","sub_selector","evaluateFormula","RegExp","isBetweenFilterOperation","getBetweenTimeBuiltinValues","formatFiltersToDev","logicTempFilters","is_logic_or","pop","SteedosFilters","formatLogicFiltersToDev","filter_logic","format_logic","x","_f","isArray","JSON","stringify","related_object_names","related_objects","unrelated_objects","getObjectRelateds","_collection_name","getPermissions","difference","related_object","isActive","allowReadFiles","getRelatedObjectNames","getRelatedObjectListActions","relatedObjectName","actions","getActions","action","on","disabled_actions","has","allow_customActions","keys","exclude_actions","getListViews","disabled_list_views","listViews","list_views","object","item","item_name","isDisabled","owner","fieldsName","unreadable_fields","getObjectFieldsName","isloading","bootstrapLoaded","convertSpecialCharacter","str","getDisabledFields","fieldName","autoform","disabled","omit","getHiddenFields","getFieldsWithNoGroup","group","getSortedFieldGroupNames","names","unique","getFieldsForGroup","groupName","getSystemBaseFields","getFieldsWithoutSystemBase","getFieldsWithoutOmit","pick","getFieldsInFirstLevel","firstLevelKeys","getFieldsForReorder","isSingle","_keys","childKeys","is_wide_1","is_wide_2","sc_1","sc_2","endsWith","is_wide","slice","isFilterValueEmpty","Number","isNaN","getFieldDataType","objectFields","result","data_type","isServer","getAllRelatedObjects","related_field","enable_files","formatIndex","array","indexName","isdocumentDB","background","datasources","documentDB","join","substring","appsByName","methods","space_id","collection_recent_viewed","current_recent_viewed","doc","space","update","$inc","count","$set","modified","Date","modified_by","insert","_makeNewID","o","ids","created","created_by","validate","async_recent_aggregate","recent_aggregate","search_object","_records","callback","Collections","object_recent_viewed","rawCollection","aggregate","$match","$group","maxCreated","$max","$sort","$limit","toArray","err","Error","isFunction","wrapAsync","searchText","_object_collection","_object_name_key","query","query_and","records","search_Keywords","split","keyword","subquery","$regex","trim","$and","$in","limit","_name","_object_name","record_object","record_object_collection","self","objectsByName","object_record","enable_search","update_filters","listview_id","filter_scope","object_listviews","direct","update_columns","columns","check","compoundFields","cursor","filterFields","childKey","objectField","splits","isCommonSpace","isSpaceAdmin","skip","fetch","compoundFieldItem","compoundFilterFields","itemKey","itemValue","referenceItem","setting","column_width","obj1","_id_actions","_mixFieldsData","_mixRelatedData","_writeXmlFile","fs","logger","mkdirp","xml2js","require","Logger","jsonObj","objName","builder","day","fileAddress","fileName","filePath","month","now","stream","xml","year","Builder","buildObject","Buffer","getFullYear","getMonth","getDate","__meteor_bootstrap__","serverDir","existsSync","sync","writeFile","mixBool","mixDate","mixDefault","objFields","field_name","date","dateStr","format","moment","relatedObjNames","relatedObjName","relatedCollection","relatedRecordList","relatedTableData","relatedObj","fieldsData","Export2xml","recordList","info","time","recordObj","timeEnd","related_objects_records","related_records","viewAllRecords","getPendingSpaceInfo","inviterId","inviterName","spaceName","db","users","spaces","inviter","refuseJoinSpace","space_users","invite_state","acceptJoinSpace","user_accepted","publish","publishComposite","tableName","_fields","object_colleciton","reference_fields","ready","String","Match","Optional","getObjectName","unblock","field_keys","_objectKeys","reference_field","parent","children_fields","p_k","reference_ids","reference_to_object","s_k","getProperty","reduce","isObject","shared","user","space_settings","permissionManagerForInitApproval","getFlowPermissions","flow_id","user_id","flow","my_permissions","org_ids","organizations","orgs_can_add","orgs_can_admin","orgs_can_monitor","users_can_add","users_can_admin","users_can_monitor","uuflowManagerForInitApproval","getFlow","parents","org","parent_id","perms","org_id","_eval","checkRequiredDetails","getFieldOdataValue","getFileFieldValue","getFormField","getFormTableField","getFormTableFieldCode","getFormTableSubField","getInstanceFieldValue","getObjectConfig","getObjectNameFieldKey","getRelatedObjectFieldCode","getRelateds","getSelectOrgValue","getSelectOrgValues","getSelectUserValue","getSelectUserValues","objectFind","objectFindOne","objectUpdate","objectql","objectApiName","toConfig","cb","then","resolve","reject","top","relatedObjectsKeys","relatedObjectsKey","startsWith","formTableFieldsCode","formTableFieldCode","formTableFields","code","formFields","ff","sf","tableField","subFieldCode","referenceToFieldName","_record","nameKey","su","userIds","sus","orgId","fullname","orgIds","orgs","recordFieldId","fType","files","newFile","FS","File","attachData","createReadStream","original","metadata","reason","size","instances","objField","formField","object_field","recordFieldValue","enableAmisform","odataFieldValue","referenceToObjectName","selectFieldValue","steedos_field","reference_to_field","multiple","is_multiselect","formatDate","formatTime","hasOwnProperty","requiredDetails","masterRecord","rd","masterField","masterFieldValue","refId","subObjConfig","subTableMasterField","subTableName","subTableRecord","check_authorization","req","authToken","hashedToken","_hashLoginToken","getSpace","flows","getSpaceUser","space_user","getSpaceUserOrgInfo","organization","organization_name","organization_fullname","isFlowEnabled","state","isFlowSpaceMatched","getForm","form_id","form","forms","getCategory","category_id","categories","checkSyncDirection","ow","syncDirection","object_workflows","sync_direction","create_instance","instance_from_client","user_info","appr_obj","approve_from_client","category","ins_obj","new_ins_id","relatedTablesInfo","space_user_org_info","start_step","trace_from_client","trace_obj","checkIsInApproval","permissionManager","flow_version","current","form_version","submitter","submitter_name","applicant","applicant_name","applicant_organization","applicant_organization_name","applicant_organization_fullname","applicant_company","company_id","is_archived","is_deleted","record_ids","Mongo","ObjectID","_str","is_finished","steps","step","step_type","start_date","trace","user_name","handler","handler_name","handler_organization","handler_organization_name","handler_organization_fullname","read_date","is_read","is_error","description","initiateValues","approves","traces","inbox_users","current_step_name","auto_remind","flow_name","category_name","initiateRecordInstanceInfo","initiateAttach","recordIds","flowId","fieldCodes","filterValues","objectName","recordId","tableFieldCodes","tableFieldMap","tableToRelatedMap","enable_amisform","required_details","field_map","fm","gridCode","lookupFieldName","lookupFieldObj","lookupObjectRecord","oTableCode","oTableCodeReferenceField","oTableCodeReferenceFieldCode","oTableFieldCode","objectFieldName","objectFieldObjectName","objectLookupField","referenceToDoc","referenceToFieldValue","relatedObjectFieldCode","tableToRelatedMapKey","wTableCode","workflow_field","table1","workflow_table_field_code","object_table_field_code","tfc","c","parse","tr","newTr","tdValue","tfm","wTdCode","formTableField","relatedField","relatedFieldName","relatedRecords","relatedTableItems","tableCode","tableValues","_FROM_TABLE_CODE","warn","relatedRecord","tableValueItem","valueKey","fieldKey","formFieldKey","relatedObjectField","tableFieldValue","_table","_code","field_map_script","extend","evalFieldMapScript","objectId","func","script","insId","approveId","cf","versions","versionId","idx","owner_name","approve","locked","instance_state","initiateRelatedRecordInstanceInfo","tableItems","utcOffset"],"mappings":"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","file":"/packages/steedos_creator.js","sourcesContent":["import {\n\tcheckNpmVersions\n} from 'meteor/tmeasday:check-npm-versions';\ncheckNpmVersions({\n\tbusboy: \"^0.2.13\",\n\t\"xml2js\": \"^0.4.19\",\n}, 'steedos:creator');\n\nif (Meteor.settings && Meteor.settings.cfs && Meteor.settings.cfs.aliyun) {\n\tcheckNpmVersions({\n\t\t\"aliyun-sdk\": \"^1.11.12\"\n\t}, 'steedos:creator');\n}","\n\t# Creator.initApps()\n\n\n# Creator.initApps = ()->\n# \tif Meteor.isServer\n# \t\t_.each Creator.Apps, (app, app_id)->\n# \t\t\tdb_app = db.apps.findOne(app_id)\n# \t\t\tif !db_app\n# \t\t\t\tapp._id = app_id\n# \t\t\t\tdb.apps.insert(app)\n# else\n# \tapp._id = app_id\n# \tdb.apps.update({_id: app_id}, app)\n\nCreator.getSchema = (object_name)->\n\treturn Creator.getObject(object_name)?.schema\n\nCreator.getObjectHomeComponent = (object_name)->\n\t# if Meteor.isClient\n\t# \treturn BuilderCreator.pluginComponentSelector(BuilderCreator.store.getState(), \"ObjectHome\", object_name)\n\treturn false;\n\nCreator.getObjectUrl = (object_name, record_id, app_id) ->\n\tif !app_id\n\t\tapp_id = Session.get(\"app_id\")\n\tif !object_name\n\t\tobject_name = Session.get(\"object_name\")\n\n\tlist_view = Creator.getListView(object_name, null)\n\tlist_view_id = list_view?._id\n\n\tif record_id\n\t\treturn Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name + \"/view/\" + record_id)\n\telse\n\t\tif Creator.getObjectHomeComponent(object_name)\n\t\t\treturn Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name)\n\t\telse\n\t\t\tif list_view_id\n\t\t\t\treturn Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name + \"/grid/\" + list_view_id)\n\t\t\telse\n\t\t\t\treturn Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name)\n\nCreator.getObjectAbsoluteUrl = (object_name, record_id, app_id) ->\n\tif !app_id\n\t\tapp_id = Session.get(\"app_id\")\n\tif !object_name\n\t\tobject_name = Session.get(\"object_name\")\n\n\tlist_view = Creator.getListView(object_name, null)\n\tlist_view_id = list_view?._id\n\n\tif record_id\n\t\treturn Steedos.absoluteUrl(\"/app/\" + app_id + \"/\" + object_name + \"/view/\" + record_id, true)\n\telse\n\t\treturn Steedos.absoluteUrl(\"/app/\" + app_id + \"/\" + object_name + \"/grid/\" + list_view_id, true)\n\nCreator.getObjectRouterUrl = (object_name, record_id, app_id) ->\n\tif !app_id\n\t\tapp_id = Session.get(\"app_id\")\n\tif !object_name\n\t\tobject_name = Session.get(\"object_name\")\n\n\tlist_view = Creator.getListView(object_name, null)\n\tlist_view_id = list_view?._id\n\n\tif record_id\n\t\treturn \"/app/\" + app_id + \"/\" + object_name + \"/view/\" + record_id\n\telse\n\t\treturn \"/app/\" + app_id + \"/\" + object_name + \"/grid/\" + list_view_id\n\nCreator.getListViewUrl = (object_name, app_id, list_view_id) ->\n\turl = Creator.getListViewRelativeUrl(object_name, app_id, list_view_id)\n\treturn Creator.getRelativeUrl(url)\n\nCreator.getListViewRelativeUrl = (object_name, app_id, list_view_id) ->\n\treturn \"/app/\" + app_id + \"/\" + object_name + \"/grid/\" + list_view_id\n\nCreator.getSwitchListUrl = (object_name, app_id, list_view_id) ->\n\tif list_view_id\n\t\treturn Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name + \"/\" + list_view_id + \"/list\")\n\telse\n\t\treturn Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name + \"/list/switch\")\n\nCreator.getRelatedObjectUrl = (object_name, app_id, record_id, related_object_name, related_field_name) ->\n\tif related_field_name\n\t\treturn Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name + \"/\" + record_id + \"/\" + related_object_name + \"/grid?related_field_name=\" + related_field_name)\n\telse\n\t\treturn Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name + \"/\" + record_id + \"/\" + related_object_name + \"/grid\")\n\nCreator.getObjectLookupFieldOptions = (object_name, is_deep, is_skip_hide, is_related)->\n\t_options = []\n\tunless object_name\n\t\treturn _options\n\t_object = Creator.getObject(object_name)\n\tfields = _object?.fields\n\ticon = _object?.icon\n\t_.forEach fields, (f, k)->\n\t\tif is_skip_hide and f.hidden\n\t\t\treturn\n\t\tif f.type == \"select\"\n\t\t\t_options.push {label: \"#{f.label || k}\", value: \"#{k}\", icon: icon}\n\t\telse\n\t\t\t_options.push {label: f.label || k, value: k, icon: icon}\n\tif is_deep\n\t\t_.forEach fields, (f, k)->\n\t\t\tif is_skip_hide and f.hidden\n\t\t\t\treturn\n\t\t\tif (f.type == \"lookup\" || f.type == \"master_detail\") && f.reference_to && _.isString(f.reference_to)\n\t\t\t\t# ä¸æ”¯æŒf.reference_toä¸ºfunctionçš„æƒ…å†µï¼Œæœ‰éœ€æ±‚å†è¯´\n\t\t\t\tr_object = Creator.getObject(f.reference_to)\n\t\t\t\tif r_object\n\t\t\t\t\t_.forEach r_object.fields, (f2, k2)->\n\t\t\t\t\t\t_options.push {label: \"#{f.label || k}=>#{f2.label || k2}\", value: \"#{k}.#{k2}\", icon: r_object?.icon}\n\tif is_related\n\t\trelatedObjects = Creator.getRelatedObjects(object_name)\n\t\t_.each relatedObjects, (_relatedObject)=>\n\t\t\trelatedOptions = Creator.getObjectLookupFieldOptions(_relatedObject.object_name, false, false, false)\n\t\t\trelatedObject = Creator.getObject(_relatedObject.object_name)\n\t\t\t_.each relatedOptions, (relatedOption)->\n\t\t\t\tif _relatedObject.foreign_key != relatedOption.value\n\t\t\t\t\t_options.push {label: \"#{relatedObject.label || relatedObject.name}=>#{relatedOption.label}\", value: \"#{relatedObject.name}.#{relatedOption.value}\", icon: relatedObject?.icon}\n\treturn _options\n\n# ç»Ÿä¸€ä¸ºå¯¹è±¡object_nameæä¾›å¯ç”¨äºŽè¿‡è™‘å™¨è¿‡è™‘å­—æ®µ\nCreator.getObjectFilterFieldOptions = (object_name)->\n\t_options = []\n\tunless object_name\n\t\treturn _options\n\t_object = Creator.getObject(object_name)\n\tfields = _object?.fields\n\tpermission_fields = Creator.getFields(object_name)\n\ticon = _object?.icon\n\t_.forEach fields, (f, k)->\n\t\t# hidden,gridç­‰ç±»åž‹çš„å­—æ®µï¼Œä¸éœ€è¦è¿‡æ»¤\n\t\tif !_.include([\"grid\",\"object\", \"[Object]\", \"[object]\", \"Object\", \"avatar\", \"image\", \"markdown\", \"html\"], f.type) and !f.hidden\n\t\t\t# filters.$.fieldåŠflow.currentç­‰å­å­—æ®µä¹Ÿä¸éœ€è¦è¿‡æ»¤\n\t\t\tif !/\\w+\\./.test(k) and _.indexOf(permission_fields, k) > -1\n\t\t\t\t_options.push {label: f.label || k, value: k, icon: icon}\n\n\treturn _options\n\nCreator.getObjectFieldOptions = (object_name)->\n\t_options = []\n\tunless object_name\n\t\treturn _options\n\t_object = Creator.getObject(object_name)\n\tfields = _object?.fields\n\tpermission_fields = Creator.getFields(object_name)\n\ticon = _object?.icon\n\t_.forEach fields, (f, k)->\n\t\tif !_.include([\"grid\",\"object\", \"[Object]\", \"[object]\", \"Object\", \"markdown\", \"html\"], f.type)\n\t\t\tif !/\\w+\\./.test(k) and _.indexOf(permission_fields, k) > -1\n\t\t\t\t_options.push {label: f.label || k, value: k, icon: icon}\n\treturn _options\n\n###\nfilters: è¦è½¬æ¢çš„filters\nfields: å¯¹è±¡å­—æ®µ\nfilter_fields: é»˜è®¤è¿‡æ»¤å­—æ®µï¼Œæ”¯æŒå­—ç¬¦ä¸²æ•°ç»„å’Œå¯¹è±¡æ•°ç»„ä¸¤ç§æ ¼å¼ï¼Œå¦‚:['filed_name1','filed_name2'],[{field:'filed_name1',required:true}]\nå¤„ç†é€»è¾‘: æŠŠfiltersä¸­å­˜åœ¨äºŽfilter_fieldsçš„è¿‡æ»¤æ¡ä»¶å¢žåŠ æ¯é¡¹çš„is_defaultã€is_requiredå±žæ€§ï¼Œä¸å­˜åœ¨äºŽfilter_fieldsçš„è¿‡æ»¤æ¡ä»¶å¯¹åº”çš„ç§»é™¤æ¯é¡¹çš„ç›¸å…³å±žæ€§\nè¿”å›žç»“æžœ: å¤„ç†åŽçš„filters\n###\nCreator.getFiltersWithFilterFields = (filters, fields, filter_fields)->\n\tunless filters\n\t\tfilters = []\n\tunless filter_fields\n\t\tfilter_fields = []\n\tif filter_fields?.length\n\t\tfilter_fields.forEach (n)->\n\t\t\tif _.isString(n)\n\t\t\t\tn = \n\t\t\t\t\tfield: n,\n\t\t\t\t\trequired: false\n\t\t\tif fields[n.field] and !_.findWhere(filters,{field:n.field})\n\t\t\t\tfilters.push\n\t\t\t\t\tfield: n.field,\n\t\t\t\t\tis_default: true,\n\t\t\t\t\tis_required: n.required\n\tfilters.forEach (filterItem)->\n\t\tmatchField = filter_fields.find (n)-> return n == filterItem.field or n.field == filterItem.field\n\t\tif _.isString(matchField)\n\t\t\tmatchField = \n\t\t\t\tfield: matchField,\n\t\t\t\trequired: false\n\t\tif matchField\n\t\t\tfilterItem.is_default = true\n\t\t\tfilterItem.is_required = matchField.required\n\t\telse\n\t\t\tdelete filterItem.is_default\n\t\t\tdelete filterItem.is_required\n\treturn filters\n\nCreator.getObjectRecord = (object_name, record_id, select_fields, expand)->\n\n\tif !object_name\n\t\tobject_name = Session.get(\"object_name\")\n\n\tif !record_id\n\t\trecord_id = Session.get(\"record_id\")\n\tif Meteor.isClient\n\t\tif object_name == Session.get(\"object_name\") &&  record_id == Session.get(\"record_id\")\n\t\t\tif Template.instance()?.record\n\t\t\t\treturn Template.instance()?.record?.get()\n\t\telse\n\t\t\treturn Creator.odata.get(object_name, record_id, select_fields, expand)\n\n\tobj = Creator.getObject(object_name)\n\n\tif obj.database_name == \"meteor\" || !obj.database_name\n\t\tcollection = Creator.getCollection(object_name)\n\t\tif collection\n\t\t\trecord = collection.findOne(record_id)\n\t\t\treturn record\n\telse if object_name && record_id\n\t\treturn Creator.odata.get(object_name, record_id, select_fields, expand)\n\nCreator.getObjectRecordName = (record, object_name)->\n\tunless record\n\t\trecord = Creator.getObjectRecord()\n\tif record\n\t\t# æ˜¾ç¤ºç»„ç»‡åˆ—è¡¨æ—¶ï¼Œç‰¹æ®Šå¤„ç†name_field_keyä¸ºnameå­—æ®µ\n\t\tname_field_key = if object_name == \"organizations\" then \"name\" else Creator.getObject(object_name)?.NAME_FIELD_KEY\n\t\tif record and name_field_key\n\t\t\treturn record.label || record[name_field_key]\n\nCreator.getApp = (app_id)->\n\tappMenus = Session.get(\"_app_menus\") || Session.get(\"app_menus\");\n\tunless appMenus\n\t\treturn {}\n\tcurrentApp = appMenus.find (menuItem) ->\n\t\treturn menuItem.id == app_id\n\treturn currentApp\n\nCreator.getAppDashboard = (app_id)->\n\tapp = Creator.getApp(app_id)\n\tif !app\n\t\treturn\n\tdashboard = null\n\t_.each Creator.Dashboards, (v, k)->\n\t\tif v.apps?.indexOf(app._id) > -1\n\t\t\tdashboard = v;\n\treturn dashboard;\n\nCreator.getAppDashboardComponent = (app_id)->\n\tapp = Creator.getApp(app_id)\n\tif !app || true\n\t\treturn\n\t# return BuilderCreator.pluginComponentSelector(BuilderCreator.store.getState(), \"Dashboard\", app._id);\n\nCreator.getAppObjectNames = (app_id)->\n\tapp = Creator.getApp(app_id)\n\tif !app\n\t\treturn\n\tisMobile = Steedos.isMobile()\n\tappObjects = if isMobile then app.mobile_objects else app.objects\n\tobjects = []\n\tif app\n\t\t_.each appObjects, (v)->\n\t\t\tobj = Creator.getObject(v)\n\t\t\tif obj?.permissions.get().allowRead\n\t\t\t\tobjects.push v\n\treturn objects\n\nCreator.getUrlWithToken = (url, expressionFormData) ->\n\t# ç»™urlæ—¶æ‹¼æŽ¥å½“å‰ç”¨æˆ·tokenç›¸å…³ä¿¡æ¯ç”¨äºŽç™»å½•éªŒè¯ï¼Œæ”¯æŒé…ç½®è¡¨è¾¾å¼\n\tparams = {};\n\tparams[\"X-Space-Id\"] = Steedos.spaceId()\n\tparams[\"X-User-Id\"] = Steedos.userId();\n\tparams[\"X-Company-Ids\"] = Steedos.getUserCompanyIds();\n\tparams[\"X-Auth-Token\"] = Accounts._storedLoginToken();\n\tif Steedos.isExpression(url)\n\t\turl = Steedos.parseSingleExpression(url, expressionFormData, \"#\", Creator.USER_CONTEXT)\n\t# å¤–éƒ¨é“¾æŽ¥åœ°å€ä¸­å¯èƒ½ä¼šå¸¦æœ‰#å·ï¼Œæ¯”å¦‚/builder/?p_ids=619383545b2e9a72ec0558b3#/page/public/test\n\t# æ­¤æ—¶urlä¸­å·²ç»åœ¨#å·å‰é¢å‡ºçŽ°äº†ä¸€ä¸ª?å·ï¼Œè¿™ä¸ªé—®å·ä¸å¯ä»¥è¢«è¯†åˆ«ä¸ºurlå‚æ•°ï¼Œåªæœ‰#å·åŽé¢çš„?å·æ‰åº”è¯¥è¢«è¯†åˆ«ä¸ºurlå‚æ•°\n\thasQuerySymbol = /(\\#.+\\?)|(\\?[^#]*$)/g.test(url)\n\tlinkStr = if hasQuerySymbol then \"&\" else \"?\"\n\treturn \"#{url}#{linkStr}#{$.param(params)}\"\n\nCreator.getAppMenu = (app_id, menu_id)->\n\tmenus = Creator.getAppMenus(app_id)\n\treturn menus && menus.find (menu)-> return menu.id == menu_id\n\nCreator.getAppMenuUrlForInternet = (menu)->\n\t# å½“tabsç±»åž‹ä¸ºurlæ—¶ï¼ŒæŒ‰å¤–éƒ¨é“¾æŽ¥å¤„ç†ï¼Œæ”¯æŒé…ç½®è¡¨è¾¾å¼å¹¶åŠ ä¸Šç»Ÿä¸€çš„urlå‚æ•°\n\treturn Creator.getUrlWithToken menu.path, menu\n\nCreator.getAppMenuUrl = (menu)->\n\turl = menu.path\n\tif menu.type == \"url\"\n\t\tif menu.target\n\t\t\treturn Creator.getAppMenuUrlForInternet(menu)\n\t\telse\n\t\t\t# åœ¨iframeä¸­æ˜¾ç¤ºurlç•Œé¢\n\t\t\treturn \"/app/-/tab_iframe/#{menu.id}\"\n\telse\n\t\treturn menu.path\n\nCreator.getAppMenus = (app_id)->\n\tappMenus = Session.get(\"_app_menus\") || Session.get(\"app_menus\");\n\tunless appMenus\n\t\treturn []\n\tcurentAppMenus = appMenus.find (menuItem) ->\n\t\treturn menuItem.id == app_id\n\tif curentAppMenus\n\t\treturn curentAppMenus.children\n\nCreator.loadAppsMenus = ()->\n\tisMobile = Steedos.isMobile()\n\tdata = { }\n\tif isMobile\n\t\tdata.mobile = isMobile\n\toptions = { \n\t\ttype: 'get', \n\t\tdata: data, \n\t\tsuccess: (data)->\n\t\t\tSession.set(\"app_menus\", data);\n\t }\n\tSteedos?.authRequest \"/service/api/apps/menus\", options\n\nCreator.creatorAppsSelector = (apps, assigned_apps) ->\n\tadminApp = undefined\n\tsortedApps = undefined\n\t_.each apps, (app, key) ->\n\t\tif !app._id\n\t\t\tapp._id = key\n\t\tif app.is_creator\n\t\t\t# ä¸éœ€è¦isSpaceAdminé€»è¾‘\n\t\t\t# if (isSpaceAdmin) {\n\t\t\t#\t\t app.visible = true;\n\t\t\t# }\n\t\telse\n\t\t\t# éžcreatoråº”è¯¥ä¸€å¾‹ä¸æ˜¾ç¤º\n\t\t\tapp.visible = false\n\t\treturn\n\tsortedApps = _.sortBy(_.values(apps), 'sort')\n\tcreatorApps = {}\n\tadminApp = {}\n\t# æŒ‰é’®sortæŽ’åºæ¬¡åºè®¾ç½®Creator.Appså€¼\n\t_.each sortedApps, (n) ->\n\t\tif n._id == 'admin'\n\t\t\tadminApp = n\n\t\telse\n\t\t\tcreatorApps[n._id] = n\n\t# adminèœå•æ˜¾ç¤ºåœ¨æœ€åŽ\n\tcreatorApps.admin = adminApp\n\tif assigned_apps.length\n\t\t_.each creatorApps, (app, key) ->\n\t\t\tif assigned_apps.indexOf(key) > -1\n\t\t\t\tapp.visible = app.is_creator\n\t\t\telse\n\t\t\t\tapp.visible = false\n\t\t\treturn\n\tcreatorApps\n\nCreator.visibleAppsSelector = (creatorApps, includeAdmin = true) ->\n\tapps = []\n\t_.each creatorApps, (v, k) ->\n\t\tif v.visible != false and v._id != 'admin' or includeAdmin and v._id == 'admin'\n\t\t\tapps.push v\n\t\treturn\n\tapps\n\nCreator.getVisibleApps = (includeAdmin)->\n\tchangeApp = Creator._subApp.get();\n\tcreatorApps = Object.assign({}, Creator.Apps, {apps: changeApp});\n\treturn Creator.visibleAppsSelector(creatorApps, includeAdmin)\n\nCreator.getVisibleAppsObjects = ()->\n\tapps = Creator.getVisibleApps()\n\tvisibleObjectNames = _.flatten(_.pluck(apps,'objects'))\n\tobjects = _.filter Creator.Objects, (obj)->\n\t\tif visibleObjectNames.indexOf(obj.name) < 0\n\t\t\treturn false\n\t\telse\n\t\t\treturn true\n\tobjects = objects.sort(Creator.sortingMethod.bind({key:\"label\"}))\n\tobjects = _.pluck(objects,'name')\n\treturn _.uniq objects\n\nCreator.getAppsObjects = ()->\n\tobjects = []\n\ttempObjects = []\n\t_.forEach Creator.Apps, (app)->\n\t\ttempObjects = _.filter app.objects, (obj)->\n\t\t\treturn !obj.hidden\n\t\tobjects = objects.concat(tempObjects)\n\treturn _.uniq objects\n\nCreator.validateFilters = (filters, logic)->\n\tfilter_items = _.map filters, (obj) ->\n\t\tif _.isEmpty(obj)\n\t\t\treturn false\n\t\telse\n\t\t\treturn obj\n\tfilter_items = _.compact(filter_items)\n\terrorMsg = \"\"\n\tfilter_length = filter_items.length\n\tif logic\n\t\t# æ ¼å¼åŒ–filter\n\t\tlogic = logic.replace(/\\n/g, \"\").replace(/\\s+/g, \" \")\n\n\t\t# åˆ¤æ–­ç‰¹æ®Šå­—ç¬¦\n\t\tif /[._\\-!+]+/ig.test(logic)\n\t\t\terrorMsg = \"å«æœ‰ç‰¹æ®Šå­—ç¬¦ã€‚\"\n\n\t\tif !errorMsg\n\t\t\tindex = logic.match(/\\d+/ig)\n\t\t\tif !index\n\t\t\t\terrorMsg = \"æœ‰äº›ç­›é€‰æ¡ä»¶è¿›è¡Œäº†å®šä¹‰ï¼Œä½†æœªåœ¨é«˜çº§ç­›é€‰æ¡ä»¶ä¸­è¢«å¼•ç”¨ã€‚\"\n\t\t\telse\n\t\t\t\tindex.forEach (i)->\n\t\t\t\t\tif i < 1 or i > filter_length\n\t\t\t\t\t\terrorMsg = \"æ‚¨çš„ç­›é€‰æ¡ä»¶å¼•ç”¨äº†æœªå®šä¹‰çš„ç­›é€‰å™¨ï¼š#{i}ã€‚\"\n\n\t\t\t\tflag = 1\n\t\t\t\twhile flag <= filter_length\n\t\t\t\t\tif !index.includes(\"#{flag}\")\n\t\t\t\t\t\terrorMsg = \"æœ‰äº›ç­›é€‰æ¡ä»¶è¿›è¡Œäº†å®šä¹‰ï¼Œä½†æœªåœ¨é«˜çº§ç­›é€‰æ¡ä»¶ä¸­è¢«å¼•ç”¨ã€‚\"\n\t\t\t\t\tflag++;\n\n\t\tif !errorMsg\n\t\t\t# åˆ¤æ–­æ˜¯å¦æœ‰éžæ³•è‹±æ–‡å­—ç¬¦\n\t\t\tword = logic.match(/[a-zA-Z]+/ig)\n\t\t\tif word\n\t\t\t\tword.forEach (w)->\n\t\t\t\t\tif !/^(and|or)$/ig.test(w)\n\t\t\t\t\t\terrorMsg = \"æ£€æŸ¥æ‚¨çš„é«˜çº§ç­›é€‰æ¡ä»¶ä¸­çš„æ‹¼å†™ã€‚\"\n\n\t\tif !errorMsg\n\t\t\t# åˆ¤æ–­æ ¼å¼æ˜¯å¦æ­£ç¡®\n\t\t\ttry\n\t\t\t\tCreator.eval(logic.replace(/and/ig, \"&&\").replace(/or/ig, \"||\"))\n\t\t\tcatch e\n\t\t\t\terrorMsg = \"æ‚¨çš„ç­›é€‰å™¨ä¸­å«æœ‰ç‰¹æ®Šå­—ç¬¦\"\n\n\t\t\tif /(AND)[^()]+(OR)/ig.test(logic) ||  /(OR)[^()]+(AND)/ig.test(logic)\n\t\t\t\terrorMsg = \"æ‚¨çš„ç­›é€‰å™¨å¿…é¡»åœ¨è¿žç»­æ€§çš„ AND å’Œ OR è¡¨è¾¾å¼å‰åŽä½¿ç”¨æ‹¬å·ã€‚\"\n\tif errorMsg\n\t\tconsole.log \"error\", errorMsg\n\t\tif Meteor.isClient\n\t\t\ttoastr.error(errorMsg)\n\t\treturn false\n\telse\n\t\treturn true\n\n# \"=\", \"<>\", \">\", \">=\", \"<\", \"<=\", \"startswith\", \"contains\", \"notcontains\".\n###\noptionså‚æ•°ï¼š\n\textend-- æ˜¯å¦éœ€è¦æŠŠå½“å‰ç”¨æˆ·åŸºæœ¬ä¿¡æ¯åŠ å…¥å…¬å¼ï¼Œå³è®©å…¬å¼æ”¯æŒCreator.USER_CONTEXTä¸­çš„å€¼ï¼Œé»˜è®¤ä¸ºtrue\n\tuserId-- å½“å‰ç™»å½•ç”¨æˆ·\n\tspaceId-- å½“å‰æ‰€åœ¨å·¥ä½œåŒº\nextendä¸ºtrueæ—¶ï¼ŒåŽç«¯éœ€è¦é¢å¤–ä¼ å…¥userIdåŠspaceIdç”¨äºŽæŠ“å–Creator.USER_CONTEXTå¯¹åº”çš„å€¼\n###\nCreator.formatFiltersToMongo = (filters, options)->\n\tunless filters?.length\n\t\treturn\n\t# å½“filtersä¸æ˜¯[Array]ç±»åž‹è€Œæ˜¯[Object]ç±»åž‹æ—¶ï¼Œè¿›è¡Œæ ¼å¼è½¬æ¢\n\tunless filters[0] instanceof Array\n\t\tfilters = _.map filters, (obj)->\n\t\t\treturn [obj.field, obj.operation, obj.value]\n\tselector = []\n\t_.each filters, (filter)->\n\t\tfield = filter[0]\n\t\toption = filter[1]\n\t\tif Meteor.isClient\n\t\t\tvalue = Creator.evaluateFormula(filter[2])\n\t\telse\n\t\t\tvalue = Creator.evaluateFormula(filter[2], null, options)\n\t\tsub_selector = {}\n\t\tsub_selector[field] = {}\n\t\tif option == \"=\"\n\t\t\tsub_selector[field][\"$eq\"] = value\n\t\telse if option == \"<>\"\n\t\t\tsub_selector[field][\"$ne\"] = value\n\t\telse if option == \">\"\n\t\t\tsub_selector[field][\"$gt\"] = value\n\t\telse if option == \">=\"\n\t\t\tsub_selector[field][\"$gte\"] = value\n\t\telse if option == \"<\"\n\t\t\tsub_selector[field][\"$lt\"] = value\n\t\telse if option == \"<=\"\n\t\t\tsub_selector[field][\"$lte\"] = value\n\t\telse if option == \"startswith\"\n\t\t\treg = new RegExp(\"^\" + value, \"i\")\n\t\t\tsub_selector[field][\"$regex\"] = reg\n\t\telse if option == \"contains\"\n\t\t\treg = new RegExp(value, \"i\")\n\t\t\tsub_selector[field][\"$regex\"] = reg\n\t\telse if option == \"notcontains\"\n\t\t\treg = new RegExp(\"^((?!\" + value + \").)*$\", \"i\")\n\t\t\tsub_selector[field][\"$regex\"] = reg\n\t\tselector.push sub_selector\n\treturn selector\n\nCreator.isBetweenFilterOperation = (operation)->\n\treturn operation == \"between\" or !!Creator.getBetweenTimeBuiltinValues(true)?[operation]\n\n###\noptionså‚æ•°ï¼š\n\textend-- æ˜¯å¦éœ€è¦æŠŠå½“å‰ç”¨æˆ·åŸºæœ¬ä¿¡æ¯åŠ å…¥å…¬å¼ï¼Œå³è®©å…¬å¼æ”¯æŒCreator.USER_CONTEXTä¸­çš„å€¼ï¼Œé»˜è®¤ä¸ºtrue\n\tuserId-- å½“å‰ç™»å½•ç”¨æˆ·\n\tspaceId-- å½“å‰æ‰€åœ¨å·¥ä½œåŒº\n\textendä¸ºtrueæ—¶ï¼ŒåŽç«¯éœ€è¦é¢å¤–ä¼ å…¥userIdåŠspaceIdç”¨äºŽæŠ“å–Creator.USER_CONTEXTå¯¹åº”çš„å€¼\n###\nCreator.formatFiltersToDev = (filters, object_name, options)->\n\tunless filters.length\n\t\treturn\n\tif options?.is_logic_or\n\t\t# å¦‚æžœis_logic_orä¸ºtrueï¼Œä¸ºfiltersç¬¬ä¸€å±‚å…ƒç´ å¢žåŠ oré—´éš”\n\t\tlogicTempFilters = []\n\t\tfilters.forEach (n)->\n\t\t\tlogicTempFilters.push(n)\n\t\t\tlogicTempFilters.push(\"or\")\n\t\tlogicTempFilters.pop()\n\t\tfilters = logicTempFilters\n\tselector = SteedosFilters.formatFiltersToDev(filters, Creator.USER_CONTEXT)\n\treturn selector\n\n###\noptionså‚æ•°ï¼š\n\textend-- æ˜¯å¦éœ€è¦æŠŠå½“å‰ç”¨æˆ·åŸºæœ¬ä¿¡æ¯åŠ å…¥å…¬å¼ï¼Œå³è®©å…¬å¼æ”¯æŒCreator.USER_CONTEXTä¸­çš„å€¼ï¼Œé»˜è®¤ä¸ºtrue\n\tuserId-- å½“å‰ç™»å½•ç”¨æˆ·\n\tspaceId-- å½“å‰æ‰€åœ¨å·¥ä½œåŒº\nextendä¸ºtrueæ—¶ï¼ŒåŽç«¯éœ€è¦é¢å¤–ä¼ å…¥userIdåŠspaceIdç”¨äºŽæŠ“å–Creator.USER_CONTEXTå¯¹åº”çš„å€¼\n###\nCreator.formatLogicFiltersToDev = (filters, filter_logic, options)->\n\tformat_logic = filter_logic.replace(/\\(\\s+/ig, \"(\").replace(/\\s+\\)/ig, \")\").replace(/\\(/g, \"[\").replace(/\\)/g, \"]\").replace(/\\s+/g, \",\").replace(/(and|or)/ig, \"'$1'\")\n\tformat_logic = format_logic.replace(/(\\d)+/ig, (x)->\n\t\t_f = filters[x-1]\n\t\tfield = _f.field\n\t\toption = _f.operation\n\t\tif Meteor.isClient\n\t\t\tvalue = Creator.evaluateFormula(_f.value)\n\t\telse\n\t\t\tvalue = Creator.evaluateFormula(_f.value, null, options)\n\t\tsub_selector = []\n\t\tif _.isArray(value) == true\n\t\t\tif option == \"=\"\n\t\t\t\t_.each value, (v)->\n\t\t\t\t\tsub_selector.push [field, option, v], \"or\"\n\t\t\telse if option == \"<>\"\n\t\t\t\t_.each value, (v)->\n\t\t\t\t\tsub_selector.push [field, option, v], \"and\"\n\t\t\telse\n\t\t\t\t_.each value, (v)->\n\t\t\t\t\tsub_selector.push [field, option, v], \"or\"\n\t\t\tif sub_selector[sub_selector.length - 1] == \"and\" || sub_selector[sub_selector.length - 1] == \"or\"\n\t\t\t\tsub_selector.pop()\n\t\telse\n\t\t\tsub_selector = [field, option, value]\n\t\t# console.log \"sub_selector\", sub_selector\n\t\treturn JSON.stringify(sub_selector)\n\t)\n\tformat_logic = \"[#{format_logic}]\"\n\treturn Creator.eval(format_logic)\n\nCreator.getRelatedObjects = (object_name, spaceId, userId)->\n\tif Meteor.isClient\n\t\tif !object_name\n\t\t\tobject_name = Session.get(\"object_name\")\n\t\tif !spaceId\n\t\t\tspaceId = Session.get(\"spaceId\")\n\t\tif !userId\n\t\t\tuserId = Meteor.userId()\n\n\trelated_object_names = []\n\t_object = Creator.getObject(object_name)\n\n\tif !_object\n\t\treturn related_object_names\n\n#\trelated_object_names = _.pluck(_object.related_objects,\"object_name\")\n\n\trelated_objects = Creator.getObjectRelateds(_object._collection_name)\n\n\trelated_object_names = _.pluck(related_objects,\"object_name\")\n\tif related_object_names?.length == 0\n\t\treturn related_object_names\n\n\tpermissions = Creator.getPermissions(object_name, spaceId, userId)\n\tunrelated_objects = permissions.unrelated_objects\n\n\trelated_object_names = _.difference related_object_names, unrelated_objects\n\treturn _.filter related_objects, (related_object)->\n\t\trelated_object_name = related_object.object_name\n\t\tisActive = related_object_names.indexOf(related_object_name) > -1\n\t\t# related_object_name = if related_object_name == \"cfs_files_filerecord\" then \"cfs.files.filerecord\" else related_object_name\n\t\tallowRead = Creator.getPermissions(related_object_name, spaceId, userId)?.allowRead\n\t\tif related_object_name == \"cms_files\"\n\t\t\tallowRead = allowRead && permissions.allowReadFiles\n\t\treturn isActive and allowRead\n\nCreator.getRelatedObjectNames = (object_name, spaceId, userId)->\n\trelated_objects = Creator.getRelatedObjects(object_name, spaceId, userId)\n\treturn _.pluck(related_objects,\"object_name\")\n\nCreator.getRelatedObjectListActions = (relatedObjectName, spaceId, userId)->\n\tactions = Creator.getActions(relatedObjectName, spaceId, userId)\n\tactions = _.filter actions, (action)->\n\t\tif action.name == \"standard_follow\"\n\t\t\treturn false\n\t\tif action.name == \"standard_query\"\n\t\t\treturn false\n\t\tif action.on == \"list\"\n\t\t\tif typeof action.visible == \"function\"\n\t\t\t\treturn action.visible()\n\t\t\telse\n\t\t\t\treturn action.visible\n\t\telse\n\t\t\treturn false\n\treturn actions\n\nCreator.getActions = (object_name, spaceId, userId)->\n\tif Meteor.isClient\n\t\tif !object_name\n\t\t\tobject_name = Session.get(\"object_name\")\n\t\tif !spaceId\n\t\t\tspaceId = Session.get(\"spaceId\")\n\t\tif !userId\n\t\t\tuserId = Meteor.userId()\n\n\tobj = Creator.getObject(object_name)\n\n\tif !obj\n\t\treturn\n\n\tpermissions = Creator.getPermissions(object_name, spaceId, userId)\n\tdisabled_actions = permissions.disabled_actions\n\tactions = _.sortBy(_.values(obj.actions) , 'sort');\n\n\tif _.has(obj, 'allow_customActions')\n\t\tactions = _.filter actions, (action)->\n\t\t\treturn _.include(obj.allow_customActions, action.name) || _.include(_.keys(Creator.getObject('base').actions) || {}, action.name)\n\tif _.has(obj, 'exclude_actions')\n\t\tactions = _.filter actions, (action)->\n\t\t\treturn !_.include(obj.exclude_actions, action.name)\n\n\t_.each actions, (action)->\n\t\t# æ‰‹æœºä¸Šåªæ˜¾ç¤ºç¼–è¾‘æŒ‰é’®ï¼Œå…¶ä»–çš„æ”¾åˆ°æŠ˜å ä¸‹æ‹‰èœå•ä¸­\n\t\tif Steedos.isMobile() && [\"record\", \"record_only\"].indexOf(action.on) > -1 && action.name != 'standard_edit'\n\t\t\tif action.on == \"record_only\"\n\t\t\t\taction.on = 'record_only_more'\n\t\t\telse\n\t\t\t\taction.on = 'record_more'\n\n\tif Steedos.isMobile() && [\"cms_files\", \"cfs.files.filerecord\"].indexOf(object_name) > -1\n\t\t# é™„ä»¶ç‰¹æ®Šå¤„ç†ï¼Œä¸‹è½½æŒ‰é’®æ”¾åœ¨ä¸»èœå•ï¼Œç¼–è¾‘æŒ‰é’®æ”¾åˆ°åº•ä¸‹æŠ˜å ä¸‹æ‹‰èœå•ä¸­\n\t\tactions.find((n)-> return n.name == \"standard_edit\")?.on = \"record_more\"\n\t\tactions.find((n)-> return n.name == \"download\")?.on = \"record\"\n\n\tactions = _.filter actions, (action)->\n\t\treturn _.indexOf(disabled_actions, action.name) < 0\n\n\treturn actions\n\n///\n\tè¿”å›žå½“å‰ç”¨æˆ·æœ‰æƒé™è®¿é—®çš„æ‰€æœ‰list_viewï¼ŒåŒ…æ‹¬åˆ†äº«çš„ï¼Œç”¨æˆ·è‡ªå®šä¹‰éžåˆ†äº«çš„ï¼ˆé™¤éžownerå˜äº†ï¼‰ï¼Œä»¥åŠé»˜è®¤çš„å…¶ä»–è§†å›¾\n\tæ³¨æ„Creator.getPermissionså‡½æ•°ä¸­æ˜¯ä¸ä¼šæœ‰ç”¨æˆ·è‡ªå®šä¹‰éžåˆ†äº«çš„è§†å›¾çš„ï¼Œæ‰€ä»¥Creator.getPermissionså‡½æ•°ä¸­æ‹¿åˆ°çš„ç»“æžœä¸å…¨ï¼Œå¹¶ä¸æ˜¯å½“å‰ç”¨æˆ·èƒ½çœ‹åˆ°æ‰€æœ‰è§†å›¾\n///\nCreator.getListViews = (object_name, spaceId, userId)->\n\tif Meteor.isClient\n\t\tif !object_name\n\t\t\tobject_name = Session.get(\"object_name\")\n\t\tif !spaceId\n\t\t\tspaceId = Session.get(\"spaceId\")\n\t\tif !userId\n\t\t\tuserId = Meteor.userId()\n\t\n\tunless object_name\n\t\treturn\n\n\tobject = Creator.getObject(object_name)\n\n\tif !object\n\t\treturn\n\n\tdisabled_list_views = Creator.getPermissions(object_name, spaceId, userId)?.disabled_list_views || []\n\n\tlist_views = []\n\n\tisMobile = Steedos.isMobile()\n\n\t_.each object.list_views, (item, item_name)->\n\t\titem.name = item_name\n\n\tlistViews = _.sortBy(_.values(object.list_views) , 'sort_no');\n\n\t_.each listViews, (item)->\n\t\tif isMobile and item.type == \"calendar\"\n\t\t\t# æ‰‹æœºä¸Šå…ˆä¸æ˜¾ç¤ºæ—¥åŽ†è§†å›¾\n\t\t\treturn\n\t\tif item.name  != \"default\"\n\t\t\tisDisabled = _.indexOf(disabled_list_views, item.name) > -1 || (item._id && _.indexOf(disabled_list_views, item._id) > -1)\n\t\t\tif !isDisabled || item.owner == userId\n\t\t\t\tlist_views.push item\n\treturn list_views\n\n# å‰å°ç†è®ºä¸Šä¸åº”è¯¥è°ƒç”¨è¯¥å‡½æ•°ï¼Œå› ä¸ºå­—æ®µçš„æƒé™éƒ½åœ¨Creator.getObject(object_name).fieldsçš„ç›¸å…³å±žæ€§ä¸­æœ‰æ ‡è¯†äº†\nCreator.getFields = (object_name, spaceId, userId)->\n\tif Meteor.isClient\n\t\tif !object_name\n\t\t\tobject_name = Session.get(\"object_name\")\n\t\tif !spaceId\n\t\t\tspaceId = Session.get(\"spaceId\")\n\t\tif !userId\n\t\t\tuserId = Meteor.userId()\n\n\tfieldsName = Creator.getObjectFieldsName(object_name)\n\tunreadable_fields =  Creator.getPermissions(object_name, spaceId, userId)?.unreadable_fields\n\treturn _.difference(fieldsName, unreadable_fields)\n\nCreator.isloading = ()->\n\treturn !Creator.bootstrapLoaded.get()\n\nCreator.convertSpecialCharacter = (str)->\n\treturn str.replace(/([\\^\\$\\(\\)\\*\\+\\?\\.\\\\\\|\\[\\]\\{\\}])/g, \"\\\\$1\")\n\n# è®¡ç®—fieldsç›¸å…³å‡½æ•°\n# START\nCreator.getDisabledFields = (schema)->\n\tfields = _.map(schema, (field, fieldName) ->\n\t\treturn field.autoform and field.autoform.disabled and !field.autoform.omit and fieldName\n\t)\n\tfields = _.compact(fields)\n\treturn fields\n\nCreator.getHiddenFields = (schema)->\n\tfields = _.map(schema, (field, fieldName) ->\n\t\treturn field.autoform and field.autoform.type == \"hidden\" and !field.autoform.omit and fieldName\n\t)\n\tfields = _.compact(fields)\n\treturn fields\n\nCreator.getFieldsWithNoGroup = (schema)->\n\tfields = _.map(schema, (field, fieldName) ->\n\t\treturn (!field.autoform or !field.autoform.group or field.autoform.group == \"-\") and (!field.autoform or field.autoform.type != \"hidden\") and fieldName\n\t)\n\tfields = _.compact(fields)\n\treturn fields\n\nCreator.getSortedFieldGroupNames = (schema)->\n\tnames = _.map(schema, (field) ->\n \t\treturn field.autoform and field.autoform.group != \"-\" and field.autoform.group\n\t)\n\tnames = _.compact(names)\n\tnames = _.unique(names)\n\treturn names\n\nCreator.getFieldsForGroup = (schema, groupName) ->\n  \tfields = _.map(schema, (field, fieldName) ->\n    \treturn field.autoform and field.autoform.group == groupName and field.autoform.type != \"hidden\" and fieldName\n  \t)\n  \tfields = _.compact(fields)\n  \treturn fields\n\nCreator.getSystemBaseFields = () ->\n\treturn [\"created\", \"created_by\", \"modified\", \"modified_by\"]\n\nCreator.getFieldsWithoutSystemBase = (keys) ->\n\treturn _.difference(keys, Creator.getSystemBaseFields());\n\nCreator.getFieldsWithoutOmit = (schema, keys) ->\n\tkeys = _.map(keys, (key) ->\n\t\tfield = _.pick(schema, key)\n\t\tif field[key].autoform?.omit\n\t\t\treturn false\n\t\telse\n\t\t\treturn key\n\t)\n\tkeys = _.compact(keys)\n\treturn keys\n\nCreator.getFieldsInFirstLevel = (firstLevelKeys, keys) ->\n\tkeys = _.map(keys, (key) ->\n\t\tif _.indexOf(firstLevelKeys, key) > -1\n\t\t\treturn key\n\t\telse\n\t\t\treturn false\n\t)\n\tkeys = _.compact(keys)\n\treturn keys\n\nCreator.getFieldsForReorder = (schema, keys, isSingle) ->\n\tfields = []\n\ti = 0\n\t_keys = _.filter(keys, (key)->\n\t\treturn !key.endsWith('_endLine')\n\t);\n\twhile i < _keys.length\n\t\tsc_1 = _.pick(schema, _keys[i])\n\t\tsc_2 = _.pick(schema, _keys[i+1])\n\n\t\tis_wide_1 = false\n\t\tis_wide_2 = false\n\n#\t\tis_range_1 = false\n#\t\tis_range_2 = false\n\n\t\t_.each sc_1, (value) ->\n\t\t\tif value.autoform?.is_wide || value.autoform?.type == \"table\"\n\t\t\t\tis_wide_1 = true\n\n#\t\t\tif value.autoform?.is_range\n#\t\t\t\tis_range_1 = true\n\n\t\t_.each sc_2, (value) ->\n\t\t\tif value.autoform?.is_wide || value.autoform?.type == \"table\"\n\t\t\t\tis_wide_2 = true\n\n#\t\t\tif value.autoform?.is_range\n#\t\t\t\tis_range_2 = true\n\n\t\tif Steedos.isMobile()\n\t\t\tis_wide_1 = true\n\t\t\tis_wide_2 = true\n\n\t\tif isSingle\n\t\t\tfields.push _keys.slice(i, i+1)\n\t\t\ti += 1\n\t\telse\n#\t\t\tif !is_range_1 && is_range_2\n#\t\t\t\tchildKeys = _keys.slice(i, i+1)\n#\t\t\t\tchildKeys.push undefined\n#\t\t\t\tfields.push childKeys\n#\t\t\t\ti += 1\n#\t\t\telse\n\t\t\tif is_wide_1\n\t\t\t\tfields.push _keys.slice(i, i+1)\n\t\t\t\ti += 1\n\t\t\telse if !is_wide_1 and is_wide_2\n\t\t\t\tchildKeys = _keys.slice(i, i+1)\n\t\t\t\tchildKeys.push undefined\n\t\t\t\tfields.push childKeys\n\t\t\t\ti += 1\n\t\t\telse if !is_wide_1 and !is_wide_2\n\t\t\t\tchildKeys = _keys.slice(i, i+1)\n\t\t\t\tif _keys[i+1]\n\t\t\t\t\tchildKeys.push _keys[i+1]\n\t\t\t\telse\n\t\t\t\t\tchildKeys.push undefined\n\t\t\t\tfields.push childKeys\n\t\t\t\ti += 2\n\n\treturn fields\n\nCreator.isFilterValueEmpty = (v) ->\n\treturn typeof v == \"undefined\" || v == null || Number.isNaN(v) || v.length == 0\n\nCreator.getFieldDataType = (objectFields, key)->\n\tif objectFields and key\n\t\tresult = objectFields[key]?.type\n\t\tif [\"formula\", \"summary\"].indexOf(result) > -1\n\t\t\tresult = objectFields[key].data_type\n\t\t# else if result == \"select\" and objectFields[key]?.data_type and objectFields[key].data_type != \"text\"\n\t\t# \tresult = objectFields[key].data_type\n\t\treturn result\n\telse\n\t\treturn \"text\"\n\n# END\n\nif Meteor.isServer\n\tCreator.getAllRelatedObjects = (object_name)->\n\t\trelated_object_names = []\n\t\t_.each Creator.Objects, (related_object, related_object_name)->\n\t\t\t_.each related_object.fields, (related_field, related_field_name)->\n\t\t\t\tif related_field.type == \"master_detail\" and related_field.reference_to and related_field.reference_to == object_name\n\t\t\t\t\trelated_object_names.push related_object_name\n\n\t\tif Creator.getObject(object_name).enable_files\n\t\t\trelated_object_names.push \"cms_files\"\n\n\t\treturn related_object_names\n\nif Meteor.isServer\n\tSteedos.formatIndex = (array) ->\n\t\tobject = {\n        \tbackground: true\n    \t};\n\t\tisdocumentDB = Meteor.settings?.datasources?.default?.documentDB || false;\n\t\tif isdocumentDB\n\t\t\tif array.length > 0\n\t\t\t\tindexName = array.join(\".\");\n\t\t\t\tobject.name = indexName;\n\t\t\t\t\n\t\t\t\tif (indexName.length > 52)\n\t\t\t\t\tobject.name = indexName.substring(0,52);\n\n\t\treturn object;","Creator.getSchema = function(object_name) {\n  var ref;\n  return (ref = Creator.getObject(object_name)) != null ? ref.schema : void 0;\n};\n\nCreator.getObjectHomeComponent = function(object_name) {\n  return false;\n};\n\nCreator.getObjectUrl = function(object_name, record_id, app_id) {\n  var list_view, list_view_id;\n  if (!app_id) {\n    app_id = Session.get(\"app_id\");\n  }\n  if (!object_name) {\n    object_name = Session.get(\"object_name\");\n  }\n  list_view = Creator.getListView(object_name, null);\n  list_view_id = list_view != null ? list_view._id : void 0;\n  if (record_id) {\n    return Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name + \"/view/\" + record_id);\n  } else {\n    if (Creator.getObjectHomeComponent(object_name)) {\n      return Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name);\n    } else {\n      if (list_view_id) {\n        return Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name + \"/grid/\" + list_view_id);\n      } else {\n        return Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name);\n      }\n    }\n  }\n};\n\nCreator.getObjectAbsoluteUrl = function(object_name, record_id, app_id) {\n  var list_view, list_view_id;\n  if (!app_id) {\n    app_id = Session.get(\"app_id\");\n  }\n  if (!object_name) {\n    object_name = Session.get(\"object_name\");\n  }\n  list_view = Creator.getListView(object_name, null);\n  list_view_id = list_view != null ? list_view._id : void 0;\n  if (record_id) {\n    return Steedos.absoluteUrl(\"/app/\" + app_id + \"/\" + object_name + \"/view/\" + record_id, true);\n  } else {\n    return Steedos.absoluteUrl(\"/app/\" + app_id + \"/\" + object_name + \"/grid/\" + list_view_id, true);\n  }\n};\n\nCreator.getObjectRouterUrl = function(object_name, record_id, app_id) {\n  var list_view, list_view_id;\n  if (!app_id) {\n    app_id = Session.get(\"app_id\");\n  }\n  if (!object_name) {\n    object_name = Session.get(\"object_name\");\n  }\n  list_view = Creator.getListView(object_name, null);\n  list_view_id = list_view != null ? list_view._id : void 0;\n  if (record_id) {\n    return \"/app/\" + app_id + \"/\" + object_name + \"/view/\" + record_id;\n  } else {\n    return \"/app/\" + app_id + \"/\" + object_name + \"/grid/\" + list_view_id;\n  }\n};\n\nCreator.getListViewUrl = function(object_name, app_id, list_view_id) {\n  var url;\n  url = Creator.getListViewRelativeUrl(object_name, app_id, list_view_id);\n  return Creator.getRelativeUrl(url);\n};\n\nCreator.getListViewRelativeUrl = function(object_name, app_id, list_view_id) {\n  return \"/app/\" + app_id + \"/\" + object_name + \"/grid/\" + list_view_id;\n};\n\nCreator.getSwitchListUrl = function(object_name, app_id, list_view_id) {\n  if (list_view_id) {\n    return Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name + \"/\" + list_view_id + \"/list\");\n  } else {\n    return Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name + \"/list/switch\");\n  }\n};\n\nCreator.getRelatedObjectUrl = function(object_name, app_id, record_id, related_object_name, related_field_name) {\n  if (related_field_name) {\n    return Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name + \"/\" + record_id + \"/\" + related_object_name + \"/grid?related_field_name=\" + related_field_name);\n  } else {\n    return Creator.getRelativeUrl(\"/app/\" + app_id + \"/\" + object_name + \"/\" + record_id + \"/\" + related_object_name + \"/grid\");\n  }\n};\n\nCreator.getObjectLookupFieldOptions = function(object_name, is_deep, is_skip_hide, is_related) {\n  var _object, _options, fields, icon, relatedObjects;\n  _options = [];\n  if (!object_name) {\n    return _options;\n  }\n  _object = Creator.getObject(object_name);\n  fields = _object != null ? _object.fields : void 0;\n  icon = _object != null ? _object.icon : void 0;\n  _.forEach(fields, function(f, k) {\n    if (is_skip_hide && f.hidden) {\n      return;\n    }\n    if (f.type === \"select\") {\n      return _options.push({\n        label: \"\" + (f.label || k),\n        value: \"\" + k,\n        icon: icon\n      });\n    } else {\n      return _options.push({\n        label: f.label || k,\n        value: k,\n        icon: icon\n      });\n    }\n  });\n  if (is_deep) {\n    _.forEach(fields, function(f, k) {\n      var r_object;\n      if (is_skip_hide && f.hidden) {\n        return;\n      }\n      if ((f.type === \"lookup\" || f.type === \"master_detail\") && f.reference_to && _.isString(f.reference_to)) {\n        r_object = Creator.getObject(f.reference_to);\n        if (r_object) {\n          return _.forEach(r_object.fields, function(f2, k2) {\n            return _options.push({\n              label: (f.label || k) + \"=>\" + (f2.label || k2),\n              value: k + \".\" + k2,\n              icon: r_object != null ? r_object.icon : void 0\n            });\n          });\n        }\n      }\n    });\n  }\n  if (is_related) {\n    relatedObjects = Creator.getRelatedObjects(object_name);\n    _.each(relatedObjects, (function(_this) {\n      return function(_relatedObject) {\n        var relatedObject, relatedOptions;\n        relatedOptions = Creator.getObjectLookupFieldOptions(_relatedObject.object_name, false, false, false);\n        relatedObject = Creator.getObject(_relatedObject.object_name);\n        return _.each(relatedOptions, function(relatedOption) {\n          if (_relatedObject.foreign_key !== relatedOption.value) {\n            return _options.push({\n              label: (relatedObject.label || relatedObject.name) + \"=>\" + relatedOption.label,\n              value: relatedObject.name + \".\" + relatedOption.value,\n              icon: relatedObject != null ? relatedObject.icon : void 0\n            });\n          }\n        });\n      };\n    })(this));\n  }\n  return _options;\n};\n\nCreator.getObjectFilterFieldOptions = function(object_name) {\n  var _object, _options, fields, icon, permission_fields;\n  _options = [];\n  if (!object_name) {\n    return _options;\n  }\n  _object = Creator.getObject(object_name);\n  fields = _object != null ? _object.fields : void 0;\n  permission_fields = Creator.getFields(object_name);\n  icon = _object != null ? _object.icon : void 0;\n  _.forEach(fields, function(f, k) {\n    if (!_.include([\"grid\", \"object\", \"[Object]\", \"[object]\", \"Object\", \"avatar\", \"image\", \"markdown\", \"html\"], f.type) && !f.hidden) {\n      if (!/\\w+\\./.test(k) && _.indexOf(permission_fields, k) > -1) {\n        return _options.push({\n          label: f.label || k,\n          value: k,\n          icon: icon\n        });\n      }\n    }\n  });\n  return _options;\n};\n\nCreator.getObjectFieldOptions = function(object_name) {\n  var _object, _options, fields, icon, permission_fields;\n  _options = [];\n  if (!object_name) {\n    return _options;\n  }\n  _object = Creator.getObject(object_name);\n  fields = _object != null ? _object.fields : void 0;\n  permission_fields = Creator.getFields(object_name);\n  icon = _object != null ? _object.icon : void 0;\n  _.forEach(fields, function(f, k) {\n    if (!_.include([\"grid\", \"object\", \"[Object]\", \"[object]\", \"Object\", \"markdown\", \"html\"], f.type)) {\n      if (!/\\w+\\./.test(k) && _.indexOf(permission_fields, k) > -1) {\n        return _options.push({\n          label: f.label || k,\n          value: k,\n          icon: icon\n        });\n      }\n    }\n  });\n  return _options;\n};\n\n\n/*\nfilters: è¦è½¬æ¢çš„filters\nfields: å¯¹è±¡å­—æ®µ\nfilter_fields: é»˜è®¤è¿‡æ»¤å­—æ®µï¼Œæ”¯æŒå­—ç¬¦ä¸²æ•°ç»„å’Œå¯¹è±¡æ•°ç»„ä¸¤ç§æ ¼å¼ï¼Œå¦‚:['filed_name1','filed_name2'],[{field:'filed_name1',required:true}]\nå¤„ç†é€»è¾‘: æŠŠfiltersä¸­å­˜åœ¨äºŽfilter_fieldsçš„è¿‡æ»¤æ¡ä»¶å¢žåŠ æ¯é¡¹çš„is_defaultã€is_requiredå±žæ€§ï¼Œä¸å­˜åœ¨äºŽfilter_fieldsçš„è¿‡æ»¤æ¡ä»¶å¯¹åº”çš„ç§»é™¤æ¯é¡¹çš„ç›¸å…³å±žæ€§\nè¿”å›žç»“æžœ: å¤„ç†åŽçš„filters\n */\n\nCreator.getFiltersWithFilterFields = function(filters, fields, filter_fields) {\n  if (!filters) {\n    filters = [];\n  }\n  if (!filter_fields) {\n    filter_fields = [];\n  }\n  if (filter_fields != null ? filter_fields.length : void 0) {\n    filter_fields.forEach(function(n) {\n      if (_.isString(n)) {\n        n = {\n          field: n,\n          required: false\n        };\n      }\n      if (fields[n.field] && !_.findWhere(filters, {\n        field: n.field\n      })) {\n        return filters.push({\n          field: n.field,\n          is_default: true,\n          is_required: n.required\n        });\n      }\n    });\n  }\n  filters.forEach(function(filterItem) {\n    var matchField;\n    matchField = filter_fields.find(function(n) {\n      return n === filterItem.field || n.field === filterItem.field;\n    });\n    if (_.isString(matchField)) {\n      matchField = {\n        field: matchField,\n        required: false\n      };\n    }\n    if (matchField) {\n      filterItem.is_default = true;\n      return filterItem.is_required = matchField.required;\n    } else {\n      delete filterItem.is_default;\n      return delete filterItem.is_required;\n    }\n  });\n  return filters;\n};\n\nCreator.getObjectRecord = function(object_name, record_id, select_fields, expand) {\n  var collection, obj, record, ref, ref1, ref2;\n  if (!object_name) {\n    object_name = Session.get(\"object_name\");\n  }\n  if (!record_id) {\n    record_id = Session.get(\"record_id\");\n  }\n  if (Meteor.isClient) {\n    if (object_name === Session.get(\"object_name\") && record_id === Session.get(\"record_id\")) {\n      if ((ref = Template.instance()) != null ? ref.record : void 0) {\n        return (ref1 = Template.instance()) != null ? (ref2 = ref1.record) != null ? ref2.get() : void 0 : void 0;\n      }\n    } else {\n      return Creator.odata.get(object_name, record_id, select_fields, expand);\n    }\n  }\n  obj = Creator.getObject(object_name);\n  if (obj.database_name === \"meteor\" || !obj.database_name) {\n    collection = Creator.getCollection(object_name);\n    if (collection) {\n      record = collection.findOne(record_id);\n      return record;\n    }\n  } else if (object_name && record_id) {\n    return Creator.odata.get(object_name, record_id, select_fields, expand);\n  }\n};\n\nCreator.getObjectRecordName = function(record, object_name) {\n  var name_field_key, ref;\n  if (!record) {\n    record = Creator.getObjectRecord();\n  }\n  if (record) {\n    name_field_key = object_name === \"organizations\" ? \"name\" : (ref = Creator.getObject(object_name)) != null ? ref.NAME_FIELD_KEY : void 0;\n    if (record && name_field_key) {\n      return record.label || record[name_field_key];\n    }\n  }\n};\n\nCreator.getApp = function(app_id) {\n  var appMenus, currentApp;\n  appMenus = Session.get(\"_app_menus\") || Session.get(\"app_menus\");\n  if (!appMenus) {\n    return {};\n  }\n  currentApp = appMenus.find(function(menuItem) {\n    return menuItem.id === app_id;\n  });\n  return currentApp;\n};\n\nCreator.getAppDashboard = function(app_id) {\n  var app, dashboard;\n  app = Creator.getApp(app_id);\n  if (!app) {\n    return;\n  }\n  dashboard = null;\n  _.each(Creator.Dashboards, function(v, k) {\n    var ref;\n    if (((ref = v.apps) != null ? ref.indexOf(app._id) : void 0) > -1) {\n      return dashboard = v;\n    }\n  });\n  return dashboard;\n};\n\nCreator.getAppDashboardComponent = function(app_id) {\n  var app;\n  app = Creator.getApp(app_id);\n  if (!app || true) {\n\n  }\n};\n\nCreator.getAppObjectNames = function(app_id) {\n  var app, appObjects, isMobile, objects;\n  app = Creator.getApp(app_id);\n  if (!app) {\n    return;\n  }\n  isMobile = Steedos.isMobile();\n  appObjects = isMobile ? app.mobile_objects : app.objects;\n  objects = [];\n  if (app) {\n    _.each(appObjects, function(v) {\n      var obj;\n      obj = Creator.getObject(v);\n      if (obj != null ? obj.permissions.get().allowRead : void 0) {\n        return objects.push(v);\n      }\n    });\n  }\n  return objects;\n};\n\nCreator.getUrlWithToken = function(url, expressionFormData) {\n  var hasQuerySymbol, linkStr, params;\n  params = {};\n  params[\"X-Space-Id\"] = Steedos.spaceId();\n  params[\"X-User-Id\"] = Steedos.userId();\n  params[\"X-Company-Ids\"] = Steedos.getUserCompanyIds();\n  params[\"X-Auth-Token\"] = Accounts._storedLoginToken();\n  if (Steedos.isExpression(url)) {\n    url = Steedos.parseSingleExpression(url, expressionFormData, \"#\", Creator.USER_CONTEXT);\n  }\n  hasQuerySymbol = /(\\#.+\\?)|(\\?[^#]*$)/g.test(url);\n  linkStr = hasQuerySymbol ? \"&\" : \"?\";\n  return \"\" + url + linkStr + ($.param(params));\n};\n\nCreator.getAppMenu = function(app_id, menu_id) {\n  var menus;\n  menus = Creator.getAppMenus(app_id);\n  return menus && menus.find(function(menu) {\n    return menu.id === menu_id;\n  });\n};\n\nCreator.getAppMenuUrlForInternet = function(menu) {\n  return Creator.getUrlWithToken(menu.path, menu);\n};\n\nCreator.getAppMenuUrl = function(menu) {\n  var url;\n  url = menu.path;\n  if (menu.type === \"url\") {\n    if (menu.target) {\n      return Creator.getAppMenuUrlForInternet(menu);\n    } else {\n      return \"/app/-/tab_iframe/\" + menu.id;\n    }\n  } else {\n    return menu.path;\n  }\n};\n\nCreator.getAppMenus = function(app_id) {\n  var appMenus, curentAppMenus;\n  appMenus = Session.get(\"_app_menus\") || Session.get(\"app_menus\");\n  if (!appMenus) {\n    return [];\n  }\n  curentAppMenus = appMenus.find(function(menuItem) {\n    return menuItem.id === app_id;\n  });\n  if (curentAppMenus) {\n    return curentAppMenus.children;\n  }\n};\n\nCreator.loadAppsMenus = function() {\n  var data, isMobile, options;\n  isMobile = Steedos.isMobile();\n  data = {};\n  if (isMobile) {\n    data.mobile = isMobile;\n  }\n  options = {\n    type: 'get',\n    data: data,\n    success: function(data) {\n      return Session.set(\"app_menus\", data);\n    }\n  };\n  return typeof Steedos !== \"undefined\" && Steedos !== null ? Steedos.authRequest(\"/service/api/apps/menus\", options) : void 0;\n};\n\nCreator.creatorAppsSelector = function(apps, assigned_apps) {\n  var adminApp, creatorApps, sortedApps;\n  adminApp = void 0;\n  sortedApps = void 0;\n  _.each(apps, function(app, key) {\n    if (!app._id) {\n      app._id = key;\n    }\n    if (app.is_creator) {\n\n    } else {\n      app.visible = false;\n    }\n  });\n  sortedApps = _.sortBy(_.values(apps), 'sort');\n  creatorApps = {};\n  adminApp = {};\n  _.each(sortedApps, function(n) {\n    if (n._id === 'admin') {\n      return adminApp = n;\n    } else {\n      return creatorApps[n._id] = n;\n    }\n  });\n  creatorApps.admin = adminApp;\n  if (assigned_apps.length) {\n    _.each(creatorApps, function(app, key) {\n      if (assigned_apps.indexOf(key) > -1) {\n        app.visible = app.is_creator;\n      } else {\n        app.visible = false;\n      }\n    });\n  }\n  return creatorApps;\n};\n\nCreator.visibleAppsSelector = function(creatorApps, includeAdmin) {\n  var apps;\n  if (includeAdmin == null) {\n    includeAdmin = true;\n  }\n  apps = [];\n  _.each(creatorApps, function(v, k) {\n    if (v.visible !== false && v._id !== 'admin' || includeAdmin && v._id === 'admin') {\n      apps.push(v);\n    }\n  });\n  return apps;\n};\n\nCreator.getVisibleApps = function(includeAdmin) {\n  var changeApp, creatorApps;\n  changeApp = Creator._subApp.get();\n  creatorApps = Object.assign({}, Creator.Apps, {\n    apps: changeApp\n  });\n  return Creator.visibleAppsSelector(creatorApps, includeAdmin);\n};\n\nCreator.getVisibleAppsObjects = function() {\n  var apps, objects, visibleObjectNames;\n  apps = Creator.getVisibleApps();\n  visibleObjectNames = _.flatten(_.pluck(apps, 'objects'));\n  objects = _.filter(Creator.Objects, function(obj) {\n    if (visibleObjectNames.indexOf(obj.name) < 0) {\n      return false;\n    } else {\n      return true;\n    }\n  });\n  objects = objects.sort(Creator.sortingMethod.bind({\n    key: \"label\"\n  }));\n  objects = _.pluck(objects, 'name');\n  return _.uniq(objects);\n};\n\nCreator.getAppsObjects = function() {\n  var objects, tempObjects;\n  objects = [];\n  tempObjects = [];\n  _.forEach(Creator.Apps, function(app) {\n    tempObjects = _.filter(app.objects, function(obj) {\n      return !obj.hidden;\n    });\n    return objects = objects.concat(tempObjects);\n  });\n  return _.uniq(objects);\n};\n\nCreator.validateFilters = function(filters, logic) {\n  var e, errorMsg, filter_items, filter_length, flag, index, word;\n  filter_items = _.map(filters, function(obj) {\n    if (_.isEmpty(obj)) {\n      return false;\n    } else {\n      return obj;\n    }\n  });\n  filter_items = _.compact(filter_items);\n  errorMsg = \"\";\n  filter_length = filter_items.length;\n  if (logic) {\n    logic = logic.replace(/\\n/g, \"\").replace(/\\s+/g, \" \");\n    if (/[._\\-!+]+/ig.test(logic)) {\n      errorMsg = \"å«æœ‰ç‰¹æ®Šå­—ç¬¦ã€‚\";\n    }\n    if (!errorMsg) {\n      index = logic.match(/\\d+/ig);\n      if (!index) {\n        errorMsg = \"æœ‰äº›ç­›é€‰æ¡ä»¶è¿›è¡Œäº†å®šä¹‰ï¼Œä½†æœªåœ¨é«˜çº§ç­›é€‰æ¡ä»¶ä¸­è¢«å¼•ç”¨ã€‚\";\n      } else {\n        index.forEach(function(i) {\n          if (i < 1 || i > filter_length) {\n            return errorMsg = \"æ‚¨çš„ç­›é€‰æ¡ä»¶å¼•ç”¨äº†æœªå®šä¹‰çš„ç­›é€‰å™¨ï¼š\" + i + \"ã€‚\";\n          }\n        });\n        flag = 1;\n        while (flag <= filter_length) {\n          if (!index.includes(\"\" + flag)) {\n            errorMsg = \"æœ‰äº›ç­›é€‰æ¡ä»¶è¿›è¡Œäº†å®šä¹‰ï¼Œä½†æœªåœ¨é«˜çº§ç­›é€‰æ¡ä»¶ä¸­è¢«å¼•ç”¨ã€‚\";\n          }\n          flag++;\n        }\n      }\n    }\n    if (!errorMsg) {\n      word = logic.match(/[a-zA-Z]+/ig);\n      if (word) {\n        word.forEach(function(w) {\n          if (!/^(and|or)$/ig.test(w)) {\n            return errorMsg = \"æ£€æŸ¥æ‚¨çš„é«˜çº§ç­›é€‰æ¡ä»¶ä¸­çš„æ‹¼å†™ã€‚\";\n          }\n        });\n      }\n    }\n    if (!errorMsg) {\n      try {\n        Creator[\"eval\"](logic.replace(/and/ig, \"&&\").replace(/or/ig, \"||\"));\n      } catch (error) {\n        e = error;\n        errorMsg = \"æ‚¨çš„ç­›é€‰å™¨ä¸­å«æœ‰ç‰¹æ®Šå­—ç¬¦\";\n      }\n      if (/(AND)[^()]+(OR)/ig.test(logic) || /(OR)[^()]+(AND)/ig.test(logic)) {\n        errorMsg = \"æ‚¨çš„ç­›é€‰å™¨å¿…é¡»åœ¨è¿žç»­æ€§çš„ AND å’Œ OR è¡¨è¾¾å¼å‰åŽä½¿ç”¨æ‹¬å·ã€‚\";\n      }\n    }\n  }\n  if (errorMsg) {\n    console.log(\"error\", errorMsg);\n    if (Meteor.isClient) {\n      toastr.error(errorMsg);\n    }\n    return false;\n  } else {\n    return true;\n  }\n};\n\n\n/*\noptionså‚æ•°ï¼š\n\textend-- æ˜¯å¦éœ€è¦æŠŠå½“å‰ç”¨æˆ·åŸºæœ¬ä¿¡æ¯åŠ å…¥å…¬å¼ï¼Œå³è®©å…¬å¼æ”¯æŒCreator.USER_CONTEXTä¸­çš„å€¼ï¼Œé»˜è®¤ä¸ºtrue\n\tuserId-- å½“å‰ç™»å½•ç”¨æˆ·\n\tspaceId-- å½“å‰æ‰€åœ¨å·¥ä½œåŒº\nextendä¸ºtrueæ—¶ï¼ŒåŽç«¯éœ€è¦é¢å¤–ä¼ å…¥userIdåŠspaceIdç”¨äºŽæŠ“å–Creator.USER_CONTEXTå¯¹åº”çš„å€¼\n */\n\nCreator.formatFiltersToMongo = function(filters, options) {\n  var selector;\n  if (!(filters != null ? filters.length : void 0)) {\n    return;\n  }\n  if (!(filters[0] instanceof Array)) {\n    filters = _.map(filters, function(obj) {\n      return [obj.field, obj.operation, obj.value];\n    });\n  }\n  selector = [];\n  _.each(filters, function(filter) {\n    var field, option, reg, sub_selector, value;\n    field = filter[0];\n    option = filter[1];\n    if (Meteor.isClient) {\n      value = Creator.evaluateFormula(filter[2]);\n    } else {\n      value = Creator.evaluateFormula(filter[2], null, options);\n    }\n    sub_selector = {};\n    sub_selector[field] = {};\n    if (option === \"=\") {\n      sub_selector[field][\"$eq\"] = value;\n    } else if (option === \"<>\") {\n      sub_selector[field][\"$ne\"] = value;\n    } else if (option === \">\") {\n      sub_selector[field][\"$gt\"] = value;\n    } else if (option === \">=\") {\n      sub_selector[field][\"$gte\"] = value;\n    } else if (option === \"<\") {\n      sub_selector[field][\"$lt\"] = value;\n    } else if (option === \"<=\") {\n      sub_selector[field][\"$lte\"] = value;\n    } else if (option === \"startswith\") {\n      reg = new RegExp(\"^\" + value, \"i\");\n      sub_selector[field][\"$regex\"] = reg;\n    } else if (option === \"contains\") {\n      reg = new RegExp(value, \"i\");\n      sub_selector[field][\"$regex\"] = reg;\n    } else if (option === \"notcontains\") {\n      reg = new RegExp(\"^((?!\" + value + \").)*$\", \"i\");\n      sub_selector[field][\"$regex\"] = reg;\n    }\n    return selector.push(sub_selector);\n  });\n  return selector;\n};\n\nCreator.isBetweenFilterOperation = function(operation) {\n  var ref;\n  return operation === \"between\" || !!((ref = Creator.getBetweenTimeBuiltinValues(true)) != null ? ref[operation] : void 0);\n};\n\n\n/*\noptionså‚æ•°ï¼š\n\textend-- æ˜¯å¦éœ€è¦æŠŠå½“å‰ç”¨æˆ·åŸºæœ¬ä¿¡æ¯åŠ å…¥å…¬å¼ï¼Œå³è®©å…¬å¼æ”¯æŒCreator.USER_CONTEXTä¸­çš„å€¼ï¼Œé»˜è®¤ä¸ºtrue\n\tuserId-- å½“å‰ç™»å½•ç”¨æˆ·\n\tspaceId-- å½“å‰æ‰€åœ¨å·¥ä½œåŒº\n\textendä¸ºtrueæ—¶ï¼ŒåŽç«¯éœ€è¦é¢å¤–ä¼ å…¥userIdåŠspaceIdç”¨äºŽæŠ“å–Creator.USER_CONTEXTå¯¹åº”çš„å€¼\n */\n\nCreator.formatFiltersToDev = function(filters, object_name, options) {\n  var logicTempFilters, selector;\n  if (!filters.length) {\n    return;\n  }\n  if (options != null ? options.is_logic_or : void 0) {\n    logicTempFilters = [];\n    filters.forEach(function(n) {\n      logicTempFilters.push(n);\n      return logicTempFilters.push(\"or\");\n    });\n    logicTempFilters.pop();\n    filters = logicTempFilters;\n  }\n  selector = SteedosFilters.formatFiltersToDev(filters, Creator.USER_CONTEXT);\n  return selector;\n};\n\n\n/*\noptionså‚æ•°ï¼š\n\textend-- æ˜¯å¦éœ€è¦æŠŠå½“å‰ç”¨æˆ·åŸºæœ¬ä¿¡æ¯åŠ å…¥å…¬å¼ï¼Œå³è®©å…¬å¼æ”¯æŒCreator.USER_CONTEXTä¸­çš„å€¼ï¼Œé»˜è®¤ä¸ºtrue\n\tuserId-- å½“å‰ç™»å½•ç”¨æˆ·\n\tspaceId-- å½“å‰æ‰€åœ¨å·¥ä½œåŒº\nextendä¸ºtrueæ—¶ï¼ŒåŽç«¯éœ€è¦é¢å¤–ä¼ å…¥userIdåŠspaceIdç”¨äºŽæŠ“å–Creator.USER_CONTEXTå¯¹åº”çš„å€¼\n */\n\nCreator.formatLogicFiltersToDev = function(filters, filter_logic, options) {\n  var format_logic;\n  format_logic = filter_logic.replace(/\\(\\s+/ig, \"(\").replace(/\\s+\\)/ig, \")\").replace(/\\(/g, \"[\").replace(/\\)/g, \"]\").replace(/\\s+/g, \",\").replace(/(and|or)/ig, \"'$1'\");\n  format_logic = format_logic.replace(/(\\d)+/ig, function(x) {\n    var _f, field, option, sub_selector, value;\n    _f = filters[x - 1];\n    field = _f.field;\n    option = _f.operation;\n    if (Meteor.isClient) {\n      value = Creator.evaluateFormula(_f.value);\n    } else {\n      value = Creator.evaluateFormula(_f.value, null, options);\n    }\n    sub_selector = [];\n    if (_.isArray(value) === true) {\n      if (option === \"=\") {\n        _.each(value, function(v) {\n          return sub_selector.push([field, option, v], \"or\");\n        });\n      } else if (option === \"<>\") {\n        _.each(value, function(v) {\n          return sub_selector.push([field, option, v], \"and\");\n        });\n      } else {\n        _.each(value, function(v) {\n          return sub_selector.push([field, option, v], \"or\");\n        });\n      }\n      if (sub_selector[sub_selector.length - 1] === \"and\" || sub_selector[sub_selector.length - 1] === \"or\") {\n        sub_selector.pop();\n      }\n    } else {\n      sub_selector = [field, option, value];\n    }\n    return JSON.stringify(sub_selector);\n  });\n  format_logic = \"[\" + format_logic + \"]\";\n  return Creator[\"eval\"](format_logic);\n};\n\nCreator.getRelatedObjects = function(object_name, spaceId, userId) {\n  var _object, permissions, related_object_names, related_objects, unrelated_objects;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n    if (!spaceId) {\n      spaceId = Session.get(\"spaceId\");\n    }\n    if (!userId) {\n      userId = Meteor.userId();\n    }\n  }\n  related_object_names = [];\n  _object = Creator.getObject(object_name);\n  if (!_object) {\n    return related_object_names;\n  }\n  related_objects = Creator.getObjectRelateds(_object._collection_name);\n  related_object_names = _.pluck(related_objects, \"object_name\");\n  if ((related_object_names != null ? related_object_names.length : void 0) === 0) {\n    return related_object_names;\n  }\n  permissions = Creator.getPermissions(object_name, spaceId, userId);\n  unrelated_objects = permissions.unrelated_objects;\n  related_object_names = _.difference(related_object_names, unrelated_objects);\n  return _.filter(related_objects, function(related_object) {\n    var allowRead, isActive, ref, related_object_name;\n    related_object_name = related_object.object_name;\n    isActive = related_object_names.indexOf(related_object_name) > -1;\n    allowRead = (ref = Creator.getPermissions(related_object_name, spaceId, userId)) != null ? ref.allowRead : void 0;\n    if (related_object_name === \"cms_files\") {\n      allowRead = allowRead && permissions.allowReadFiles;\n    }\n    return isActive && allowRead;\n  });\n};\n\nCreator.getRelatedObjectNames = function(object_name, spaceId, userId) {\n  var related_objects;\n  related_objects = Creator.getRelatedObjects(object_name, spaceId, userId);\n  return _.pluck(related_objects, \"object_name\");\n};\n\nCreator.getRelatedObjectListActions = function(relatedObjectName, spaceId, userId) {\n  var actions;\n  actions = Creator.getActions(relatedObjectName, spaceId, userId);\n  actions = _.filter(actions, function(action) {\n    if (action.name === \"standard_follow\") {\n      return false;\n    }\n    if (action.name === \"standard_query\") {\n      return false;\n    }\n    if (action.on === \"list\") {\n      if (typeof action.visible === \"function\") {\n        return action.visible();\n      } else {\n        return action.visible;\n      }\n    } else {\n      return false;\n    }\n  });\n  return actions;\n};\n\nCreator.getActions = function(object_name, spaceId, userId) {\n  var actions, disabled_actions, obj, permissions, ref, ref1;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n    if (!spaceId) {\n      spaceId = Session.get(\"spaceId\");\n    }\n    if (!userId) {\n      userId = Meteor.userId();\n    }\n  }\n  obj = Creator.getObject(object_name);\n  if (!obj) {\n    return;\n  }\n  permissions = Creator.getPermissions(object_name, spaceId, userId);\n  disabled_actions = permissions.disabled_actions;\n  actions = _.sortBy(_.values(obj.actions), 'sort');\n  if (_.has(obj, 'allow_customActions')) {\n    actions = _.filter(actions, function(action) {\n      return _.include(obj.allow_customActions, action.name) || _.include(_.keys(Creator.getObject('base').actions) || {}, action.name);\n    });\n  }\n  if (_.has(obj, 'exclude_actions')) {\n    actions = _.filter(actions, function(action) {\n      return !_.include(obj.exclude_actions, action.name);\n    });\n  }\n  _.each(actions, function(action) {\n    if (Steedos.isMobile() && [\"record\", \"record_only\"].indexOf(action.on) > -1 && action.name !== 'standard_edit') {\n      if (action.on === \"record_only\") {\n        return action.on = 'record_only_more';\n      } else {\n        return action.on = 'record_more';\n      }\n    }\n  });\n  if (Steedos.isMobile() && [\"cms_files\", \"cfs.files.filerecord\"].indexOf(object_name) > -1) {\n    if ((ref = actions.find(function(n) {\n      return n.name === \"standard_edit\";\n    })) != null) {\n      ref.on = \"record_more\";\n    }\n    if ((ref1 = actions.find(function(n) {\n      return n.name === \"download\";\n    })) != null) {\n      ref1.on = \"record\";\n    }\n  }\n  actions = _.filter(actions, function(action) {\n    return _.indexOf(disabled_actions, action.name) < 0;\n  });\n  return actions;\n};\n\n/è¿”å›žå½“å‰ç”¨æˆ·æœ‰æƒé™è®¿é—®çš„æ‰€æœ‰list_viewï¼ŒåŒ…æ‹¬åˆ†äº«çš„ï¼Œç”¨æˆ·è‡ªå®šä¹‰éžåˆ†äº«çš„ï¼ˆé™¤éžownerå˜äº†ï¼‰ï¼Œä»¥åŠé»˜è®¤çš„å…¶ä»–è§†å›¾æ³¨æ„Creator.getPermissionså‡½æ•°ä¸­æ˜¯ä¸ä¼šæœ‰ç”¨æˆ·è‡ªå®šä¹‰éžåˆ†äº«çš„è§†å›¾çš„ï¼Œæ‰€ä»¥Creator.getPermissionså‡½æ•°ä¸­æ‹¿åˆ°çš„ç»“æžœä¸å…¨ï¼Œå¹¶ä¸æ˜¯å½“å‰ç”¨æˆ·èƒ½çœ‹åˆ°æ‰€æœ‰è§†å›¾/;\n\nCreator.getListViews = function(object_name, spaceId, userId) {\n  var disabled_list_views, isMobile, listViews, list_views, object, ref;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n    if (!spaceId) {\n      spaceId = Session.get(\"spaceId\");\n    }\n    if (!userId) {\n      userId = Meteor.userId();\n    }\n  }\n  if (!object_name) {\n    return;\n  }\n  object = Creator.getObject(object_name);\n  if (!object) {\n    return;\n  }\n  disabled_list_views = ((ref = Creator.getPermissions(object_name, spaceId, userId)) != null ? ref.disabled_list_views : void 0) || [];\n  list_views = [];\n  isMobile = Steedos.isMobile();\n  _.each(object.list_views, function(item, item_name) {\n    return item.name = item_name;\n  });\n  listViews = _.sortBy(_.values(object.list_views), 'sort_no');\n  _.each(listViews, function(item) {\n    var isDisabled;\n    if (isMobile && item.type === \"calendar\") {\n      return;\n    }\n    if (item.name !== \"default\") {\n      isDisabled = _.indexOf(disabled_list_views, item.name) > -1 || (item._id && _.indexOf(disabled_list_views, item._id) > -1);\n      if (!isDisabled || item.owner === userId) {\n        return list_views.push(item);\n      }\n    }\n  });\n  return list_views;\n};\n\nCreator.getFields = function(object_name, spaceId, userId) {\n  var fieldsName, ref, unreadable_fields;\n  if (Meteor.isClient) {\n    if (!object_name) {\n      object_name = Session.get(\"object_name\");\n    }\n    if (!spaceId) {\n      spaceId = Session.get(\"spaceId\");\n    }\n    if (!userId) {\n      userId = Meteor.userId();\n    }\n  }\n  fieldsName = Creator.getObjectFieldsName(object_name);\n  unreadable_fields = (ref = Creator.getPermissions(object_name, spaceId, userId)) != null ? ref.unreadable_fields : void 0;\n  return _.difference(fieldsName, unreadable_fields);\n};\n\nCreator.isloading = function() {\n  return !Creator.bootstrapLoaded.get();\n};\n\nCreator.convertSpecialCharacter = function(str) {\n  return str.replace(/([\\^\\$\\(\\)\\*\\+\\?\\.\\\\\\|\\[\\]\\{\\}])/g, \"\\\\$1\");\n};\n\nCreator.getDisabledFields = function(schema) {\n  var fields;\n  fields = _.map(schema, function(field, fieldName) {\n    return field.autoform && field.autoform.disabled && !field.autoform.omit && fieldName;\n  });\n  fields = _.compact(fields);\n  return fields;\n};\n\nCreator.getHiddenFields = function(schema) {\n  var fields;\n  fields = _.map(schema, function(field, fieldName) {\n    return field.autoform && field.autoform.type === \"hidden\" && !field.autoform.omit && fieldName;\n  });\n  fields = _.compact(fields);\n  return fields;\n};\n\nCreator.getFieldsWithNoGroup = function(schema) {\n  var fields;\n  fields = _.map(schema, function(field, fieldName) {\n    return (!field.autoform || !field.autoform.group || field.autoform.group === \"-\") && (!field.autoform || field.autoform.type !== \"hidden\") && fieldName;\n  });\n  fields = _.compact(fields);\n  return fields;\n};\n\nCreator.getSortedFieldGroupNames = function(schema) {\n  var names;\n  names = _.map(schema, function(field) {\n    return field.autoform && field.autoform.group !== \"-\" && field.autoform.group;\n  });\n  names = _.compact(names);\n  names = _.unique(names);\n  return names;\n};\n\nCreator.getFieldsForGroup = function(schema, groupName) {\n  var fields;\n  fields = _.map(schema, function(field, fieldName) {\n    return field.autoform && field.autoform.group === groupName && field.autoform.type !== \"hidden\" && fieldName;\n  });\n  fields = _.compact(fields);\n  return fields;\n};\n\nCreator.getSystemBaseFields = function() {\n  return [\"created\", \"created_by\", \"modified\", \"modified_by\"];\n};\n\nCreator.getFieldsWithoutSystemBase = function(keys) {\n  return _.difference(keys, Creator.getSystemBaseFields());\n};\n\nCreator.getFieldsWithoutOmit = function(schema, keys) {\n  keys = _.map(keys, function(key) {\n    var field, ref;\n    field = _.pick(schema, key);\n    if ((ref = field[key].autoform) != null ? ref.omit : void 0) {\n      return false;\n    } else {\n      return key;\n    }\n  });\n  keys = _.compact(keys);\n  return keys;\n};\n\nCreator.getFieldsInFirstLevel = function(firstLevelKeys, keys) {\n  keys = _.map(keys, function(key) {\n    if (_.indexOf(firstLevelKeys, key) > -1) {\n      return key;\n    } else {\n      return false;\n    }\n  });\n  keys = _.compact(keys);\n  return keys;\n};\n\nCreator.getFieldsForReorder = function(schema, keys, isSingle) {\n  var _keys, childKeys, fields, i, is_wide_1, is_wide_2, sc_1, sc_2;\n  fields = [];\n  i = 0;\n  _keys = _.filter(keys, function(key) {\n    return !key.endsWith('_endLine');\n  });\n  while (i < _keys.length) {\n    sc_1 = _.pick(schema, _keys[i]);\n    sc_2 = _.pick(schema, _keys[i + 1]);\n    is_wide_1 = false;\n    is_wide_2 = false;\n    _.each(sc_1, function(value) {\n      var ref, ref1;\n      if (((ref = value.autoform) != null ? ref.is_wide : void 0) || ((ref1 = value.autoform) != null ? ref1.type : void 0) === \"table\") {\n        return is_wide_1 = true;\n      }\n    });\n    _.each(sc_2, function(value) {\n      var ref, ref1;\n      if (((ref = value.autoform) != null ? ref.is_wide : void 0) || ((ref1 = value.autoform) != null ? ref1.type : void 0) === \"table\") {\n        return is_wide_2 = true;\n      }\n    });\n    if (Steedos.isMobile()) {\n      is_wide_1 = true;\n      is_wide_2 = true;\n    }\n    if (isSingle) {\n      fields.push(_keys.slice(i, i + 1));\n      i += 1;\n    } else {\n      if (is_wide_1) {\n        fields.push(_keys.slice(i, i + 1));\n        i += 1;\n      } else if (!is_wide_1 && is_wide_2) {\n        childKeys = _keys.slice(i, i + 1);\n        childKeys.push(void 0);\n        fields.push(childKeys);\n        i += 1;\n      } else if (!is_wide_1 && !is_wide_2) {\n        childKeys = _keys.slice(i, i + 1);\n        if (_keys[i + 1]) {\n          childKeys.push(_keys[i + 1]);\n        } else {\n          childKeys.push(void 0);\n        }\n        fields.push(childKeys);\n        i += 2;\n      }\n    }\n  }\n  return fields;\n};\n\nCreator.isFilterValueEmpty = function(v) {\n  return typeof v === \"undefined\" || v === null || Number.isNaN(v) || v.length === 0;\n};\n\nCreator.getFieldDataType = function(objectFields, key) {\n  var ref, result;\n  if (objectFields && key) {\n    result = (ref = objectFields[key]) != null ? ref.type : void 0;\n    if ([\"formula\", \"summary\"].indexOf(result) > -1) {\n      result = objectFields[key].data_type;\n    }\n    return result;\n  } else {\n    return \"text\";\n  }\n};\n\nif (Meteor.isServer) {\n  Creator.getAllRelatedObjects = function(object_name) {\n    var related_object_names;\n    related_object_names = [];\n    _.each(Creator.Objects, function(related_object, related_object_name) {\n      return _.each(related_object.fields, function(related_field, related_field_name) {\n        if (related_field.type === \"master_detail\" && related_field.reference_to && related_field.reference_to === object_name) {\n          return related_object_names.push(related_object_name);\n        }\n      });\n    });\n    if (Creator.getObject(object_name).enable_files) {\n      related_object_names.push(\"cms_files\");\n    }\n    return related_object_names;\n  };\n}\n\nif (Meteor.isServer) {\n  Steedos.formatIndex = function(array) {\n    var indexName, isdocumentDB, object, ref, ref1, ref2;\n    object = {\n      background: true\n    };\n    isdocumentDB = ((ref = Meteor.settings) != null ? (ref1 = ref.datasources) != null ? (ref2 = ref1[\"default\"]) != null ? ref2.documentDB : void 0 : void 0 : void 0) || false;\n    if (isdocumentDB) {\n      if (array.length > 0) {\n        indexName = array.join(\".\");\n        object.name = indexName;\n        if (indexName.length > 52) {\n          object.name = indexName.substring(0, 52);\n        }\n      }\n    }\n    return object;\n  };\n}\n","Creator.appsByName = {}\n\n","Meteor.methods\n\t\"object_recent_viewed\": (object_name, record_id, space_id)->\n\t\tif !this.userId\n\t\t\treturn null\n\n\t\tif object_name == \"object_recent_viewed\"\n\t\t\treturn\n\t\tif object_name and record_id\n\t\t\tif !space_id\n\t\t\t\tdoc = Creator.getCollection(object_name).findOne({_id: record_id}, {fields: {space: 1}})\n\t\t\t\tspace_id = doc?.space\n\n\t\t\tcollection_recent_viewed = Creator.getCollection(\"object_recent_viewed\")\n\t\t\tfilters = { owner: this.userId, space: space_id, 'record.o': object_name, 'record.ids': [record_id]}\n\t\t\tcurrent_recent_viewed = collection_recent_viewed.findOne(filters)\n\t\t\tif current_recent_viewed\n\t\t\t\tcollection_recent_viewed.update(\n\t\t\t\t\tcurrent_recent_viewed._id,\n\t\t\t\t\t{\n\t\t\t\t\t\t$inc: {\n\t\t\t\t\t\t\tcount: 1\n\t\t\t\t\t\t},\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tmodified: new Date()\n\t\t\t\t\t\t\tmodified_by: this.userId\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\telse\n\t\t\t\tcollection_recent_viewed.insert(\n\t\t\t\t\t{\n\t\t\t\t\t\t_id: collection_recent_viewed._makeNewID()\n\t\t\t\t\t\towner: this.userId\n\t\t\t\t\t\tspace: space_id\n\t\t\t\t\t\trecord: {o: object_name, ids: [record_id]}\n\t\t\t\t\t\tcount: 1\n\t\t\t\t\t\tcreated: new Date()\n\t\t\t\t\t\tcreated_by: this.userId\n\t\t\t\t\t\tmodified: new Date()\n\t\t\t\t\t\tmodified_by: this.userId\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tvalidate: false\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\treturn","Meteor.methods({\n  \"object_recent_viewed\": function(object_name, record_id, space_id) {\n    var collection_recent_viewed, current_recent_viewed, doc, filters;\n    if (!this.userId) {\n      return null;\n    }\n    if (object_name === \"object_recent_viewed\") {\n      return;\n    }\n    if (object_name && record_id) {\n      if (!space_id) {\n        doc = Creator.getCollection(object_name).findOne({\n          _id: record_id\n        }, {\n          fields: {\n            space: 1\n          }\n        });\n        space_id = doc != null ? doc.space : void 0;\n      }\n      collection_recent_viewed = Creator.getCollection(\"object_recent_viewed\");\n      filters = {\n        owner: this.userId,\n        space: space_id,\n        'record.o': object_name,\n        'record.ids': [record_id]\n      };\n      current_recent_viewed = collection_recent_viewed.findOne(filters);\n      if (current_recent_viewed) {\n        collection_recent_viewed.update(current_recent_viewed._id, {\n          $inc: {\n            count: 1\n          },\n          $set: {\n            modified: new Date(),\n            modified_by: this.userId\n          }\n        });\n      } else {\n        collection_recent_viewed.insert({\n          _id: collection_recent_viewed._makeNewID(),\n          owner: this.userId,\n          space: space_id,\n          record: {\n            o: object_name,\n            ids: [record_id]\n          },\n          count: 1,\n          created: new Date(),\n          created_by: this.userId,\n          modified: new Date(),\n          modified_by: this.userId\n        }, {\n          validate: false\n        });\n      }\n    }\n  }\n});\n","recent_aggregate = (created_by, spaceId, _records, callback)->\n\tCreator.Collections.object_recent_viewed.rawCollection().aggregate([\n\t\t{$match: {created_by: created_by, space: spaceId}},\n\t\t{$group: {_id: {object_name: \"$record.o\", record_id: \"$record.ids\", space: \"$space\"}, maxCreated: {$max: \"$created\"}}},\n\t\t{$sort: {maxCreated: -1}},\n\t\t{$limit: 10}\n\t]).toArray (err, data)->\n\t\tif err\n\t\t\tthrow new Error(err)\n\n\t\tdata.forEach (doc) ->\n\t\t\t_records.push doc._id\n\n\t\tif callback && _.isFunction(callback)\n\t\t\tcallback()\n\n\t\treturn\n\nasync_recent_aggregate = Meteor.wrapAsync(recent_aggregate)\n\nsearch_object = (space, object_name,userId, searchText)->\n\tdata = new Array()\n\n\tif searchText\n\n\t\t_object = Creator.getObject(object_name)\n\n\t\t_object_collection = Creator.getCollection(object_name)\n\t\t_object_name_key = _object?.NAME_FIELD_KEY\n\t\tif _object && _object_collection && _object_name_key\n\t\t\tquery = {}\n\t\t\tsearch_Keywords = searchText.split(\" \")\n\t\t\tquery_and = []\n\t\t\tsearch_Keywords.forEach (keyword)->\n\t\t\t\tsubquery = {}\n\t\t\t\tsubquery[_object_name_key] = {$regex: keyword.trim()}\n\t\t\t\tquery_and.push subquery\n\n\t\t\tquery.$and = query_and\n\t\t\tquery.space = {$in: [space]}\n\n\t\t\tfields = {_id: 1}\n\t\t\tfields[_object_name_key] = 1\n\n\t\t\trecords = _object_collection.find(query, {fields: fields, sort: {modified: 1}, limit: 5})\n\n\t\t\trecords.forEach (record)->\n\t\t\t\tdata.push {_id: record._id, _name: record[_object_name_key], _object_name: object_name}\n\t\n\treturn data\n\nMeteor.methods\n\t'object_recent_record': (spaceId)->\n\t\tdata = new Array()\n\t\trecords = new Array()\n\t\tasync_recent_aggregate(this.userId, spaceId, records)\n\t\trecords.forEach (item)->\n\t\t\trecord_object = Creator.getObject(item.object_name, item.space)\n\n\t\t\tif !record_object\n\t\t\t\treturn\n\n\t\t\trecord_object_collection = Creator.getCollection(item.object_name, item.space)\n\n\t\t\tif record_object && record_object_collection\n\t\t\t\tfields = {_id: 1}\n\n\t\t\t\tfields[record_object.NAME_FIELD_KEY] = 1\n\n\t\t\t\trecord = record_object_collection.findOne(item.record_id[0], {fields: fields})\n\t\t\t\tif record\n\t\t\t\t\tdata.push {_id: record._id, _name: record[record_object.NAME_FIELD_KEY], _object_name: item.object_name}\n\n\t\treturn data\n\n\t'object_record_search': (options)->\n\t\tself = this\n\n\t\tdata = new Array()\n\n\t\tsearchText = options.searchText\n\t\tspace = options.space\n\n\t\t_.forEach Creator.objectsByName, (_object, name)->\n\t\t\tif _object.enable_search\n\t\t\t\tobject_record = search_object(space, _object.name, self.userId, searchText)\n\t\t\t\tdata = data.concat(object_record)\n\n\t\treturn data\n","var async_recent_aggregate, recent_aggregate, search_object;\n\nrecent_aggregate = function(created_by, spaceId, _records, callback) {\n  return Creator.Collections.object_recent_viewed.rawCollection().aggregate([\n    {\n      $match: {\n        created_by: created_by,\n        space: spaceId\n      }\n    }, {\n      $group: {\n        _id: {\n          object_name: \"$record.o\",\n          record_id: \"$record.ids\",\n          space: \"$space\"\n        },\n        maxCreated: {\n          $max: \"$created\"\n        }\n      }\n    }, {\n      $sort: {\n        maxCreated: -1\n      }\n    }, {\n      $limit: 10\n    }\n  ]).toArray(function(err, data) {\n    if (err) {\n      throw new Error(err);\n    }\n    data.forEach(function(doc) {\n      return _records.push(doc._id);\n    });\n    if (callback && _.isFunction(callback)) {\n      callback();\n    }\n  });\n};\n\nasync_recent_aggregate = Meteor.wrapAsync(recent_aggregate);\n\nsearch_object = function(space, object_name, userId, searchText) {\n  var _object, _object_collection, _object_name_key, data, fields, query, query_and, records, search_Keywords;\n  data = new Array();\n  if (searchText) {\n    _object = Creator.getObject(object_name);\n    _object_collection = Creator.getCollection(object_name);\n    _object_name_key = _object != null ? _object.NAME_FIELD_KEY : void 0;\n    if (_object && _object_collection && _object_name_key) {\n      query = {};\n      search_Keywords = searchText.split(\" \");\n      query_and = [];\n      search_Keywords.forEach(function(keyword) {\n        var subquery;\n        subquery = {};\n        subquery[_object_name_key] = {\n          $regex: keyword.trim()\n        };\n        return query_and.push(subquery);\n      });\n      query.$and = query_and;\n      query.space = {\n        $in: [space]\n      };\n      fields = {\n        _id: 1\n      };\n      fields[_object_name_key] = 1;\n      records = _object_collection.find(query, {\n        fields: fields,\n        sort: {\n          modified: 1\n        },\n        limit: 5\n      });\n      records.forEach(function(record) {\n        return data.push({\n          _id: record._id,\n          _name: record[_object_name_key],\n          _object_name: object_name\n        });\n      });\n    }\n  }\n  return data;\n};\n\nMeteor.methods({\n  'object_recent_record': function(spaceId) {\n    var data, records;\n    data = new Array();\n    records = new Array();\n    async_recent_aggregate(this.userId, spaceId, records);\n    records.forEach(function(item) {\n      var fields, record, record_object, record_object_collection;\n      record_object = Creator.getObject(item.object_name, item.space);\n      if (!record_object) {\n        return;\n      }\n      record_object_collection = Creator.getCollection(item.object_name, item.space);\n      if (record_object && record_object_collection) {\n        fields = {\n          _id: 1\n        };\n        fields[record_object.NAME_FIELD_KEY] = 1;\n        record = record_object_collection.findOne(item.record_id[0], {\n          fields: fields\n        });\n        if (record) {\n          return data.push({\n            _id: record._id,\n            _name: record[record_object.NAME_FIELD_KEY],\n            _object_name: item.object_name\n          });\n        }\n      }\n    });\n    return data;\n  },\n  'object_record_search': function(options) {\n    var data, searchText, self, space;\n    self = this;\n    data = new Array();\n    searchText = options.searchText;\n    space = options.space;\n    _.forEach(Creator.objectsByName, function(_object, name) {\n      var object_record;\n      if (_object.enable_search) {\n        object_record = search_object(space, _object.name, self.userId, searchText);\n        return data = data.concat(object_record);\n      }\n    });\n    return data;\n  }\n});\n","Meteor.methods\n    update_filters: (listview_id, filters, filter_scope, filter_logic)->\n        Creator.Collections.object_listviews.direct.update({_id: listview_id}, {$set: {filters: filters, filter_scope: filter_scope, filter_logic: filter_logic}})\n\n    update_columns: (listview_id, columns)->\n        check(columns, Array)\n        \n        if columns.length < 1\n            throw new Meteor.Error 400, \"Select at least one field to display\"\n        Creator.Collections.object_listviews.update({_id: listview_id}, {$set: {columns: columns}})\n","Meteor.methods({\n  update_filters: function(listview_id, filters, filter_scope, filter_logic) {\n    return Creator.Collections.object_listviews.direct.update({\n      _id: listview_id\n    }, {\n      $set: {\n        filters: filters,\n        filter_scope: filter_scope,\n        filter_logic: filter_logic\n      }\n    });\n  },\n  update_columns: function(listview_id, columns) {\n    check(columns, Array);\n    if (columns.length < 1) {\n      throw new Meteor.Error(400, \"Select at least one field to display\");\n    }\n    return Creator.Collections.object_listviews.update({\n      _id: listview_id\n    }, {\n      $set: {\n        columns: columns\n      }\n    });\n  }\n});\n","Meteor.methods\n\t'report_data': (options)->\n\t\tcheck(options, Object)\n\t\tspace = options.space\n\t\tfields = options.fields\n\t\tobject_name = options.object_name\n\t\tfilter_scope = options.filter_scope\n\t\tfilters = options.filters\n\t\tfilterFields = {}\n\t\tcompoundFields = []\n\t\tobjectFields = Creator.getObject(object_name)?.fields\n\t\t_.each fields, (item, index)->\n\t\t\tsplits = item.split(\".\")\n\t\t\tname = splits[0]\n\t\t\tobjectField = objectFields[name]\n\t\t\tif splits.length > 1 and objectField\n\t\t\t\tchildKey = item.replace name + \".\", \"\"\n\t\t\t\tcompoundFields.push({name: name, childKey: childKey, field: objectField})\n\t\t\tfilterFields[name] = 1\n\n\t\tselector = {}\n\t\tuserId = this.userId\n\t\tselector.space = space\n\t\tif filter_scope == \"spacex\"\n\t\t\tselector.space = \n\t\t\t\t$in: [null,space]\n\t\telse if filter_scope == \"mine\"\n\t\t\tselector.owner = userId\n\n\t\tif Creator.isCommonSpace(space) && Creator.isSpaceAdmin(space, @userId)\n\t\t\tdelete selector.space\n\n\t\tif filters and filters.length > 0\n\t\t\tselector[\"$and\"] = filters\n\n\t\tcursor = Creator.getCollection(object_name).find(selector, {fields: filterFields, skip: 0, limit: 10000})\n#\t\tif cursor.count() > 10000\n#\t\t\treturn []\n\t\tresult = cursor.fetch()\n\t\tif compoundFields.length\n\t\t\tresult = result.map (item,index)->\n\t\t\t\t_.each compoundFields, (compoundFieldItem, index)->\n\t\t\t\t\titemKey = compoundFieldItem.name + \"*%*\" + compoundFieldItem.childKey.replace(/\\./g, \"*%*\")\n\t\t\t\t\titemValue = item[compoundFieldItem.name]\n\t\t\t\t\ttype = compoundFieldItem.field.type\n\t\t\t\t\tif [\"lookup\", \"master_detail\"].indexOf(type) > -1\n\t\t\t\t\t\treference_to = compoundFieldItem.field.reference_to\n\t\t\t\t\t\tcompoundFilterFields = {}\n\t\t\t\t\t\tcompoundFilterFields[compoundFieldItem.childKey] = 1\n\t\t\t\t\t\treferenceItem = Creator.getCollection(reference_to).findOne {_id: itemValue}, fields: compoundFilterFields\n\t\t\t\t\t\tif referenceItem\n\t\t\t\t\t\t\titem[itemKey] = referenceItem[compoundFieldItem.childKey]\n\t\t\t\t\telse if type == \"select\"\n\t\t\t\t\t\toptions = compoundFieldItem.field.options\n\t\t\t\t\t\titem[itemKey] = _.findWhere(options, {value: itemValue})?.label or itemValue\n\t\t\t\t\telse\n\t\t\t\t\t\titem[itemKey] = itemValue\n\t\t\t\t\tunless item[itemKey]\n\t\t\t\t\t\titem[itemKey] = \"--\"\n\t\t\t\treturn item\n\t\t\treturn result\n\t\telse\n\t\t\treturn result\n\n","Meteor.methods({\n  'report_data': function(options) {\n    var compoundFields, cursor, fields, filterFields, filter_scope, filters, objectFields, object_name, ref, result, selector, space, userId;\n    check(options, Object);\n    space = options.space;\n    fields = options.fields;\n    object_name = options.object_name;\n    filter_scope = options.filter_scope;\n    filters = options.filters;\n    filterFields = {};\n    compoundFields = [];\n    objectFields = (ref = Creator.getObject(object_name)) != null ? ref.fields : void 0;\n    _.each(fields, function(item, index) {\n      var childKey, name, objectField, splits;\n      splits = item.split(\".\");\n      name = splits[0];\n      objectField = objectFields[name];\n      if (splits.length > 1 && objectField) {\n        childKey = item.replace(name + \".\", \"\");\n        compoundFields.push({\n          name: name,\n          childKey: childKey,\n          field: objectField\n        });\n      }\n      return filterFields[name] = 1;\n    });\n    selector = {};\n    userId = this.userId;\n    selector.space = space;\n    if (filter_scope === \"spacex\") {\n      selector.space = {\n        $in: [null, space]\n      };\n    } else if (filter_scope === \"mine\") {\n      selector.owner = userId;\n    }\n    if (Creator.isCommonSpace(space) && Creator.isSpaceAdmin(space, this.userId)) {\n      delete selector.space;\n    }\n    if (filters && filters.length > 0) {\n      selector[\"$and\"] = filters;\n    }\n    cursor = Creator.getCollection(object_name).find(selector, {\n      fields: filterFields,\n      skip: 0,\n      limit: 10000\n    });\n    result = cursor.fetch();\n    if (compoundFields.length) {\n      result = result.map(function(item, index) {\n        _.each(compoundFields, function(compoundFieldItem, index) {\n          var compoundFilterFields, itemKey, itemValue, ref1, referenceItem, reference_to, type;\n          itemKey = compoundFieldItem.name + \"*%*\" + compoundFieldItem.childKey.replace(/\\./g, \"*%*\");\n          itemValue = item[compoundFieldItem.name];\n          type = compoundFieldItem.field.type;\n          if ([\"lookup\", \"master_detail\"].indexOf(type) > -1) {\n            reference_to = compoundFieldItem.field.reference_to;\n            compoundFilterFields = {};\n            compoundFilterFields[compoundFieldItem.childKey] = 1;\n            referenceItem = Creator.getCollection(reference_to).findOne({\n              _id: itemValue\n            }, {\n              fields: compoundFilterFields\n            });\n            if (referenceItem) {\n              item[itemKey] = referenceItem[compoundFieldItem.childKey];\n            }\n          } else if (type === \"select\") {\n            options = compoundFieldItem.field.options;\n            item[itemKey] = ((ref1 = _.findWhere(options, {\n              value: itemValue\n            })) != null ? ref1.label : void 0) || itemValue;\n          } else {\n            item[itemKey] = itemValue;\n          }\n          if (!item[itemKey]) {\n            return item[itemKey] = \"--\";\n          }\n        });\n        return item;\n      });\n      return result;\n    } else {\n      return result;\n    }\n  }\n});\n","###\n    type: \"user\"\n    object_name: \"object_listviews\"\n    record_id: \"{object_name},{listview_id}\"\n    settings:\n        column_width: { field_a: 100, field_2: 150 }\n        sort: [[\"field_a\", \"desc\"]]\n    owner: {userId}\n###\n\nMeteor.methods\n    \"tabular_sort_settings\": (object_name, list_view_id, sort)->\n        userId = this.userId\n        setting = Creator.Collections.settings.findOne({object_name: object_name, record_id: \"object_listviews\", owner: userId})\n        if setting\n            Creator.Collections.settings.update({_id: setting._id}, {$set: {\"settings.#{list_view_id}.sort\": sort}})\n        else\n            doc = \n                type: \"user\"\n                object_name: object_name\n                record_id: \"object_listviews\"\n                settings: {}\n                owner: userId\n\n            doc.settings[list_view_id] = {}\n            doc.settings[list_view_id].sort = sort\n\n            Creator.Collections.settings.insert(doc)\n\n    \"tabular_column_width_settings\": (object_name, list_view_id, column_width)->\n        userId = this.userId\n        setting = Creator.Collections.settings.findOne({object_name: object_name, record_id: \"object_listviews\", owner: userId})\n        if setting\n            Creator.Collections.settings.update({_id: setting._id}, {$set: {\"settings.#{list_view_id}.column_width\": column_width}})\n        else\n            doc = \n                type: \"user\"\n                object_name: object_name\n                record_id: \"object_listviews\"\n                settings: {}\n                owner: userId\n\n            doc.settings[list_view_id] = {}\n            doc.settings[list_view_id].column_width = column_width\n\n            Creator.Collections.settings.insert(doc)\n\n    \"grid_settings\": (object_name, list_view_id, column_width, sort)->\n        userId = this.userId\n        setting = Creator.Collections.settings.findOne({object_name: object_name, record_id: \"object_gridviews\", owner: userId})\n        if setting\n            # æ¯æ¬¡éƒ½å¼ºåˆ¶æ”¹å˜_id_actionsåˆ—çš„å®½åº¦ï¼Œä»¥è§£å†³å½“ç”¨æˆ·åªæ”¹å˜å­—æ®µæ¬¡åºè€Œæ²¡æœ‰æ”¹å˜ä»»ä½•å­—æ®µå®½åº¦æ—¶ï¼Œå‰ç«¯æ²¡æœ‰è®¢é˜…åˆ°å­—æ®µæ¬¡åºå˜æ›´çš„æ•°æ®çš„é—®é¢˜\n            column_width._id_actions = if setting.settings[\"#{list_view_id}\"]?.column_width?._id_actions == 46 then 47 else 46\n            if sort\n                Creator.Collections.settings.update({_id: setting._id}, {$set: {\"settings.#{list_view_id}.sort\": sort, \"settings.#{list_view_id}.column_width\": column_width}})\n            else\n                Creator.Collections.settings.update({_id: setting._id}, {$set: {\"settings.#{list_view_id}.column_width\": column_width}})\n        else\n            doc =\n                type: \"user\"\n                object_name: object_name\n                record_id: \"object_gridviews\"\n                settings: {}\n                owner: userId\n            \n            doc.settings[list_view_id] = {}\n            doc.settings[list_view_id].column_width = column_width\n            doc.settings[list_view_id].sort = sort\n\n            Creator.Collections.settings.insert(doc)","\n/*\n    type: \"user\"\n    object_name: \"object_listviews\"\n    record_id: \"{object_name},{listview_id}\"\n    settings:\n        column_width: { field_a: 100, field_2: 150 }\n        sort: [[\"field_a\", \"desc\"]]\n    owner: {userId}\n */\nMeteor.methods({\n  \"tabular_sort_settings\": function(object_name, list_view_id, sort) {\n    var doc, obj, setting, userId;\n    userId = this.userId;\n    setting = Creator.Collections.settings.findOne({\n      object_name: object_name,\n      record_id: \"object_listviews\",\n      owner: userId\n    });\n    if (setting) {\n      return Creator.Collections.settings.update({\n        _id: setting._id\n      }, {\n        $set: (\n          obj = {},\n          obj[\"settings.\" + list_view_id + \".sort\"] = sort,\n          obj\n        )\n      });\n    } else {\n      doc = {\n        type: \"user\",\n        object_name: object_name,\n        record_id: \"object_listviews\",\n        settings: {},\n        owner: userId\n      };\n      doc.settings[list_view_id] = {};\n      doc.settings[list_view_id].sort = sort;\n      return Creator.Collections.settings.insert(doc);\n    }\n  },\n  \"tabular_column_width_settings\": function(object_name, list_view_id, column_width) {\n    var doc, obj, setting, userId;\n    userId = this.userId;\n    setting = Creator.Collections.settings.findOne({\n      object_name: object_name,\n      record_id: \"object_listviews\",\n      owner: userId\n    });\n    if (setting) {\n      return Creator.Collections.settings.update({\n        _id: setting._id\n      }, {\n        $set: (\n          obj = {},\n          obj[\"settings.\" + list_view_id + \".column_width\"] = column_width,\n          obj\n        )\n      });\n    } else {\n      doc = {\n        type: \"user\",\n        object_name: object_name,\n        record_id: \"object_listviews\",\n        settings: {},\n        owner: userId\n      };\n      doc.settings[list_view_id] = {};\n      doc.settings[list_view_id].column_width = column_width;\n      return Creator.Collections.settings.insert(doc);\n    }\n  },\n  \"grid_settings\": function(object_name, list_view_id, column_width, sort) {\n    var doc, obj, obj1, ref, ref1, setting, userId;\n    userId = this.userId;\n    setting = Creator.Collections.settings.findOne({\n      object_name: object_name,\n      record_id: \"object_gridviews\",\n      owner: userId\n    });\n    if (setting) {\n      column_width._id_actions = ((ref = setting.settings[\"\" + list_view_id]) != null ? (ref1 = ref.column_width) != null ? ref1._id_actions : void 0 : void 0) === 46 ? 47 : 46;\n      if (sort) {\n        return Creator.Collections.settings.update({\n          _id: setting._id\n        }, {\n          $set: (\n            obj = {},\n            obj[\"settings.\" + list_view_id + \".sort\"] = sort,\n            obj[\"settings.\" + list_view_id + \".column_width\"] = column_width,\n            obj\n          )\n        });\n      } else {\n        return Creator.Collections.settings.update({\n          _id: setting._id\n        }, {\n          $set: (\n            obj1 = {},\n            obj1[\"settings.\" + list_view_id + \".column_width\"] = column_width,\n            obj1\n          )\n        });\n      }\n    } else {\n      doc = {\n        type: \"user\",\n        object_name: object_name,\n        record_id: \"object_gridviews\",\n        settings: {},\n        owner: userId\n      };\n      doc.settings[list_view_id] = {};\n      doc.settings[list_view_id].column_width = column_width;\n      doc.settings[list_view_id].sort = sort;\n      return Creator.Collections.settings.insert(doc);\n    }\n  }\n});\n","xml2js = require 'xml2js'\nfs = require 'fs'\npath = require 'path'\nmkdirp = require 'mkdirp'\n\nlogger = new Logger 'Export_TO_XML'\n\n_writeXmlFile = (jsonObj,objName) ->\n\t# è½¬xml\n\tbuilder = new xml2js.Builder()\n\txml = builder.buildObject jsonObj\n\n\t# è½¬ä¸ºbuffer\n\tstream = new Buffer xml\n\n\t# æ ¹æ®å½“å¤©æ—¶é—´çš„å¹´æœˆæ—¥ä½œä¸ºå­˜å‚¨è·¯å¾„\n\tnow = new Date\n\tyear = now.getFullYear()\n\tmonth = now.getMonth() + 1\n\tday = now.getDate()\n\n\t# æ–‡ä»¶è·¯å¾„\n\tfilePath = path.join(__meteor_bootstrap__.serverDir,'../../../export/' + year + '/' + month + '/' + day + '/' + objName )\n\tfileName = jsonObj?._id + \".xml\"\n\tfileAddress = path.join filePath, fileName\n\n\tif !fs.existsSync filePath\n\t\tmkdirp.sync filePath\n\n\t# å†™å…¥æ–‡ä»¶\n\tfs.writeFile fileAddress, stream, (err) ->\n\t\tif err\n\t\t\tlogger.error \"#{jsonObj._id}å†™å…¥xmlæ–‡ä»¶å¤±è´¥\",err\n\t\n\treturn filePath\n\n\n# æ•´ç†Fieldsçš„jsonæ•°æ®\n_mixFieldsData = (obj,objName) ->\n\t# åˆå§‹åŒ–å¯¹è±¡æ•°æ®\n\tjsonObj = {}\n\t# èŽ·å–fields\n\tobjFields = Creator?.getObject(objName)?.fields\n\n\tmixDefault = (field_name)->\n\t\tjsonObj[field_name] = obj[field_name] || \"\"\n\n\tmixDate = (field_name,type)->\n\t\tdate = obj[field_name]\n\t\tif type == \"date\"\n\t\t\tformat = \"YYYY-MM-DD\"\n\t\telse\n\t\t\tformat = \"YYYY-MM-DD HH:mm:ss\"\n\t\tif date? and format?\n\t\t\tdateStr = moment(date).format(format)\n\t\tjsonObj[field_name] = dateStr || \"\"\n\n\tmixBool = (field_name)->\n\t\tif obj[field_name] == true\n\t\t\tjsonObj[field_name] = \"æ˜¯\"\n\t\telse if obj[field_name] == false\n\t\t\tjsonObj[field_name] = \"å¦\"\n\t\telse\n\t\t\tjsonObj[field_name] = \"\"\n\n\t# å¾ªçŽ¯æ¯ä¸ªfields,å¹¶åˆ¤æ–­å–å€¼\n\t_.each objFields, (field, field_name)->\n\t\tswitch field?.type\n\t\t\twhen \"date\",\"datetime\" then mixDate field_name,field.type\n\t\t\twhen \"boolean\" then mixBool field_name\n\t\t\telse mixDefault field_name\n\n\treturn jsonObj\n\n# èŽ·å–å­è¡¨æ•´ç†æ•°æ®\n_mixRelatedData = (obj,objName) ->\n\t# åˆå§‹åŒ–å¯¹è±¡æ•°æ®\n\trelated_objects = {}\n\n\t# èŽ·å–ç›¸å…³è¡¨\n\trelatedObjNames = Creator?.getAllRelatedObjects objName\n\n\t# å¾ªçŽ¯ç›¸å…³è¡¨\n\trelatedObjNames.forEach (relatedObjName) ->\n\t\t# æ¯ä¸ªè¡¨å®šä¹‰ä¸€ä¸ªå¯¹è±¡æ•°ç»„\n\t\trelatedTableData = []\n\n\t\t# *è®¾ç½®å…³è”æœç´¢æŸ¥è¯¢çš„å­—æ®µ\n\t\t# é™„ä»¶çš„å…³è”æœç´¢å­—æ®µæ˜¯å®šæ­»çš„\n\t\tif relatedObjName == \"cms_files\"\n\t\t\trelated_field_name = \"parent.ids\"\n\t\telse\n\t\t\t# èŽ·å–fields\n\t\t\tfields = Creator?.Objects[relatedObjName]?.fields\n\t\t\t# å¾ªçŽ¯æ¯ä¸ªfield,æ‰¾å‡ºreference_toçš„å…³è”å­—æ®µ\n\t\t\trelated_field_name = \"\"\n\t\t\t_.each fields, (field, field_name)->\n\t\t\t\tif field?.reference_to == objName\n\t\t\t\t\trelated_field_name = field_name\n\n\t\t# æ ¹æ®æ‰¾å‡ºçš„å…³è”å­—æ®µï¼ŒæŸ¥å­è¡¨æ•°æ®\n\t\tif related_field_name\n\t\t\trelatedCollection = Creator.getCollection(relatedObjName)\n\t\t\t# èŽ·å–åˆ°æ‰€æœ‰çš„æ•°æ®\n\t\t\trelatedRecordList = relatedCollection.find({\"#{related_field_name}\":obj._id}).fetch()\n\t\t\t# å¾ªçŽ¯æ¯ä¸€æ¡æ•°æ®\n\t\t\trelatedRecordList.forEach (relatedObj)->\n\t\t\t\t# æ•´åˆfieldsæ•°æ®\n\t\t\t\tfieldsData = _mixFieldsData relatedObj,relatedObjName\n\t\t\t\t# æŠŠä¸€æ¡è®°å½•æ’å…¥åˆ°å¯¹è±¡æ•°ç»„ä¸­\n\t\t\t\trelatedTableData.push fieldsData\n\n\t\t# æŠŠä¸€ä¸ªå­è¡¨çš„æ‰€æœ‰æ•°æ®æ’å…¥åˆ°related_objectsä¸­ï¼Œå†å¾ªçŽ¯ä¸‹ä¸€ä¸ª\n\t\trelated_objects[relatedObjName] = relatedTableData\n\n\treturn related_objects\n\n# Creator.Export2xml()\nCreator.Export2xml = (objName, recordList) ->\n\tlogger.info \"Run Creator.Export2xml\"\n\n\tconsole.time \"Creator.Export2xml\"\n\n\t# æµ‹è¯•æ•°æ®\n\t# objName = \"archive_records\"\n\n\t# æŸ¥æ‰¾å¯¹è±¡æ•°æ®\n\tcollection = Creator.getCollection(objName)\n\t# æµ‹è¯•æ•°æ®\n\trecordList = collection.find({}).fetch()\n\n\trecordList.forEach (recordObj)->\n\t\tjsonObj = {}\n\t\tjsonObj._id = recordObj._id\n\n\t\t# æ•´ç†ä¸»è¡¨çš„Fieldsæ•°æ®\n\t\tfieldsData = _mixFieldsData recordObj,objName\n\t\tjsonObj[objName] = fieldsData\n\n\t\t# æ•´ç†ç›¸å…³è¡¨æ•°æ®\n\t\trelated_objects = _mixRelatedData recordObj,objName\n\n\t\tjsonObj[\"related_objects\"] = related_objects\n\n\t\t# è½¬ä¸ºxmlä¿å­˜æ–‡ä»¶\n\t\tfilePath = _writeXmlFile jsonObj,objName\n\n\tconsole.timeEnd \"Creator.Export2xml\"\n\treturn filePath","var _mixFieldsData, _mixRelatedData, _writeXmlFile, fs, logger, mkdirp, path, xml2js;\n\nxml2js = require('xml2js');\n\nfs = require('fs');\n\npath = require('path');\n\nmkdirp = require('mkdirp');\n\nlogger = new Logger('Export_TO_XML');\n\n_writeXmlFile = function(jsonObj, objName) {\n  var builder, day, fileAddress, fileName, filePath, month, now, stream, xml, year;\n  builder = new xml2js.Builder();\n  xml = builder.buildObject(jsonObj);\n  stream = new Buffer(xml);\n  now = new Date;\n  year = now.getFullYear();\n  month = now.getMonth() + 1;\n  day = now.getDate();\n  filePath = path.join(__meteor_bootstrap__.serverDir, '../../../export/' + year + '/' + month + '/' + day + '/' + objName);\n  fileName = (jsonObj != null ? jsonObj._id : void 0) + \".xml\";\n  fileAddress = path.join(filePath, fileName);\n  if (!fs.existsSync(filePath)) {\n    mkdirp.sync(filePath);\n  }\n  fs.writeFile(fileAddress, stream, function(err) {\n    if (err) {\n      return logger.error(jsonObj._id + \"å†™å…¥xmlæ–‡ä»¶å¤±è´¥\", err);\n    }\n  });\n  return filePath;\n};\n\n_mixFieldsData = function(obj, objName) {\n  var jsonObj, mixBool, mixDate, mixDefault, objFields, ref;\n  jsonObj = {};\n  objFields = typeof Creator !== \"undefined\" && Creator !== null ? (ref = Creator.getObject(objName)) != null ? ref.fields : void 0 : void 0;\n  mixDefault = function(field_name) {\n    return jsonObj[field_name] = obj[field_name] || \"\";\n  };\n  mixDate = function(field_name, type) {\n    var date, dateStr, format;\n    date = obj[field_name];\n    if (type === \"date\") {\n      format = \"YYYY-MM-DD\";\n    } else {\n      format = \"YYYY-MM-DD HH:mm:ss\";\n    }\n    if ((date != null) && (format != null)) {\n      dateStr = moment(date).format(format);\n    }\n    return jsonObj[field_name] = dateStr || \"\";\n  };\n  mixBool = function(field_name) {\n    if (obj[field_name] === true) {\n      return jsonObj[field_name] = \"æ˜¯\";\n    } else if (obj[field_name] === false) {\n      return jsonObj[field_name] = \"å¦\";\n    } else {\n      return jsonObj[field_name] = \"\";\n    }\n  };\n  _.each(objFields, function(field, field_name) {\n    switch (field != null ? field.type : void 0) {\n      case \"date\":\n      case \"datetime\":\n        return mixDate(field_name, field.type);\n      case \"boolean\":\n        return mixBool(field_name);\n      default:\n        return mixDefault(field_name);\n    }\n  });\n  return jsonObj;\n};\n\n_mixRelatedData = function(obj, objName) {\n  var relatedObjNames, related_objects;\n  related_objects = {};\n  relatedObjNames = typeof Creator !== \"undefined\" && Creator !== null ? Creator.getAllRelatedObjects(objName) : void 0;\n  relatedObjNames.forEach(function(relatedObjName) {\n    var fields, obj1, ref, relatedCollection, relatedRecordList, relatedTableData, related_field_name;\n    relatedTableData = [];\n    if (relatedObjName === \"cms_files\") {\n      related_field_name = \"parent.ids\";\n    } else {\n      fields = typeof Creator !== \"undefined\" && Creator !== null ? (ref = Creator.Objects[relatedObjName]) != null ? ref.fields : void 0 : void 0;\n      related_field_name = \"\";\n      _.each(fields, function(field, field_name) {\n        if ((field != null ? field.reference_to : void 0) === objName) {\n          return related_field_name = field_name;\n        }\n      });\n    }\n    if (related_field_name) {\n      relatedCollection = Creator.getCollection(relatedObjName);\n      relatedRecordList = relatedCollection.find((\n        obj1 = {},\n        obj1[\"\" + related_field_name] = obj._id,\n        obj1\n      )).fetch();\n      relatedRecordList.forEach(function(relatedObj) {\n        var fieldsData;\n        fieldsData = _mixFieldsData(relatedObj, relatedObjName);\n        return relatedTableData.push(fieldsData);\n      });\n    }\n    return related_objects[relatedObjName] = relatedTableData;\n  });\n  return related_objects;\n};\n\nCreator.Export2xml = function(objName, recordList) {\n  var collection;\n  logger.info(\"Run Creator.Export2xml\");\n  console.time(\"Creator.Export2xml\");\n  collection = Creator.getCollection(objName);\n  recordList = collection.find({}).fetch();\n  recordList.forEach(function(recordObj) {\n    var fieldsData, filePath, jsonObj, related_objects;\n    jsonObj = {};\n    jsonObj._id = recordObj._id;\n    fieldsData = _mixFieldsData(recordObj, objName);\n    jsonObj[objName] = fieldsData;\n    related_objects = _mixRelatedData(recordObj, objName);\n    jsonObj[\"related_objects\"] = related_objects;\n    return filePath = _writeXmlFile(jsonObj, objName);\n  });\n  console.timeEnd(\"Creator.Export2xml\");\n  return filePath;\n};\n","Meteor.methods \n\trelated_objects_records: (object_name, related_object_name, related_field_name, record_id, spaceId)->\n\t\tuserId = this.userId\n\t\tif related_object_name == \"cfs.files.filerecord\"\n\t\t\tselector = {\"metadata.space\": spaceId}\n\t\telse\n\t\t\tselector = {space: spaceId}\n\t\t\n\t\tif related_object_name == \"cms_files\"\n\t\t\t# é™„ä»¶çš„å…³è”æœç´¢æ¡ä»¶æ˜¯å®šæ­»çš„\n\t\t\tselector[\"parent.o\"] = object_name\n\t\t\tselector[\"parent.ids\"] = [record_id]\n\t\telse\n\t\t\tselector[related_field_name] = record_id\n\n\t\tpermissions = Creator.getPermissions(related_object_name, spaceId, userId)\n\t\tif !permissions.viewAllRecords and permissions.allowRead\n\t\t\tselector.owner = userId\n\t\t\n\t\trelated_records = Creator.getCollection(related_object_name).find(selector)\n\t\treturn related_records.count()","Meteor.methods({\n  related_objects_records: function(object_name, related_object_name, related_field_name, record_id, spaceId) {\n    var permissions, related_records, selector, userId;\n    userId = this.userId;\n    if (related_object_name === \"cfs.files.filerecord\") {\n      selector = {\n        \"metadata.space\": spaceId\n      };\n    } else {\n      selector = {\n        space: spaceId\n      };\n    }\n    if (related_object_name === \"cms_files\") {\n      selector[\"parent.o\"] = object_name;\n      selector[\"parent.ids\"] = [record_id];\n    } else {\n      selector[related_field_name] = record_id;\n    }\n    permissions = Creator.getPermissions(related_object_name, spaceId, userId);\n    if (!permissions.viewAllRecords && permissions.allowRead) {\n      selector.owner = userId;\n    }\n    related_records = Creator.getCollection(related_object_name).find(selector);\n    return related_records.count();\n  }\n});\n","Meteor.methods\n\tgetPendingSpaceInfo: (inviterId, spaceId)->\n\t\tinviterName = db.users.findOne({_id: inviterId}).name\n\t\tspaceName = db.spaces.findOne({_id: spaceId}).name\n\n\t\treturn {inviter: inviterName, space: spaceName}\n\n\trefuseJoinSpace: (_id)->\n\t\tdb.space_users.direct.update({_id: _id},{$set: {invite_state: \"refused\"}})\n\n\tacceptJoinSpace: (_id)->\n\t\tdb.space_users.direct.update({_id: _id},{$set: {invite_state: \"accepted\", user_accepted: true}})\n\n","Meteor.methods({\n  getPendingSpaceInfo: function(inviterId, spaceId) {\n    var inviterName, spaceName;\n    inviterName = db.users.findOne({\n      _id: inviterId\n    }).name;\n    spaceName = db.spaces.findOne({\n      _id: spaceId\n    }).name;\n    return {\n      inviter: inviterName,\n      space: spaceName\n    };\n  },\n  refuseJoinSpace: function(_id) {\n    return db.space_users.direct.update({\n      _id: _id\n    }, {\n      $set: {\n        invite_state: \"refused\"\n      }\n    });\n  },\n  acceptJoinSpace: function(_id) {\n    return db.space_users.direct.update({\n      _id: _id\n    }, {\n      $set: {\n        invite_state: \"accepted\",\n        user_accepted: true\n      }\n    });\n  }\n});\n","Meteor.publish \"creator_object_record\", (object_name, id, space_id)->\n\tcollection = Creator.getCollection(object_name, space_id)\n\tif collection\n\t\treturn collection.find({_id: id})\n\n","Meteor.publish(\"creator_object_record\", function(object_name, id, space_id) {\n  var collection;\n  collection = Creator.getCollection(object_name, space_id);\n  if (collection) {\n    return collection.find({\n      _id: id\n    });\n  }\n});\n","Meteor.publishComposite \"steedos_object_tabular\", (tableName, ids, fields, spaceId)->\n\tunless this.userId\n\t\treturn this.ready()\n\n\tcheck(tableName, String);\n\tcheck(ids, Array);\n\tcheck(fields, Match.Optional(Object));\n\n\t_object_name = tableName.replace(\"creator_\",\"\")\n\t_object = Creator.getObject(_object_name, spaceId)\n\n\tif spaceId\n\t\t_object_name = Creator.getObjectName(_object)\n\n\tobject_colleciton = Creator.getCollection(_object_name)\n\n\n\t_fields = _object?.fields\n\tif !_fields || !object_colleciton\n\t\treturn this.ready()\n\n\treference_fields = _.filter _fields, (f)->\n\t\treturn _.isFunction(f.reference_to) || !_.isEmpty(f.reference_to)\n\n\tself = this\n\n\tself.unblock();\n\n\tif reference_fields.length > 0\n\t\tdata = {\n\t\t\tfind: ()->\n\t\t\t\tself.unblock();\n\t\t\t\tfield_keys = {}\n\t\t\t\t_.each _.keys(fields), (f)->\n\t\t\t\t\tunless /\\w+(\\.\\$){1}\\w?/.test(f)\n\t\t\t\t\t\tfield_keys[f] = 1\n\t\t\t\t\n\t\t\t\treturn object_colleciton.find({_id: {$in: ids}}, {fields: field_keys});\n\t\t}\n\n\t\tdata.children = []\n\n\t\tkeys = _.keys(fields)\n\n\t\tif keys.length < 1\n\t\t\tkeys = _.keys(_fields)\n\n\t\t_keys = []\n\n\t\tkeys.forEach (key)->\n\t\t\tif _object.schema._objectKeys[key + '.']\n\t\t\t\t_keys = _keys.concat(_.map(_object.schema._objectKeys[key + '.'], (k)->\n\t\t\t\t\treturn key + '.' + k\n\t\t\t\t))\n\t\t\t_keys.push(key)\n\n\t\t_keys.forEach (key)->\n\t\t\treference_field = _fields[key]\n\n\t\t\tif reference_field && (_.isFunction(reference_field.reference_to) || !_.isEmpty(reference_field.reference_to))  # and Creator.Collections[reference_field.reference_to]\n\t\t\t\tdata.children.push {\n\t\t\t\t\tfind: (parent) ->\n\t\t\t\t\t\ttry\n\t\t\t\t\t\t\tself.unblock();\n\n\t\t\t\t\t\t\tquery = {}\n\n\t\t\t\t\t\t\t# è¡¨æ ¼å­å­—æ®µç‰¹æ®Šå¤„ç†\n\t\t\t\t\t\t\tif /\\w+(\\.\\$\\.){1}\\w+/.test(key)\n\t\t\t\t\t\t\t\tp_k = key.replace(/(\\w+)\\.\\$\\.\\w+/ig, \"$1\")\n\t\t\t\t\t\t\t\ts_k = key.replace(/\\w+\\.\\$\\.(\\w+)/ig, \"$1\")\n\t\t\t\t\t\t\t\treference_ids = parent[p_k].getProperty(s_k)\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\treference_ids = key.split('.').reduce (o, x) ->\n\t\t\t\t\t\t\t\t\t\to?[x]\n\t\t\t\t\t\t\t\t, parent\n\n\t\t\t\t\t\t\treference_to = reference_field.reference_to\n\n\t\t\t\t\t\t\tif _.isFunction(reference_to)\n\t\t\t\t\t\t\t\treference_to = reference_to()\n\n\t\t\t\t\t\t\tif _.isArray(reference_to)\n\t\t\t\t\t\t\t\tif _.isObject(reference_ids) && !_.isArray(reference_ids)\n\t\t\t\t\t\t\t\t\treference_to = reference_ids.o\n\t\t\t\t\t\t\t\t\treference_ids = reference_ids.ids || []\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\treturn []\n\n\t\t\t\t\t\t\tif _.isArray(reference_ids)\n\t\t\t\t\t\t\t\tquery._id = {$in: reference_ids}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tquery._id = reference_ids\n\n\t\t\t\t\t\t\treference_to_object = Creator.getObject(reference_to, spaceId)\n\n\t\t\t\t\t\t\tname_field_key = reference_to_object.NAME_FIELD_KEY\n\n\t\t\t\t\t\t\tchildren_fields = {_id: 1, space: 1}\n\n\t\t\t\t\t\t\tif name_field_key\n\t\t\t\t\t\t\t\tchildren_fields[name_field_key] = 1\n\n\t\t\t\t\t\t\treturn Creator.getCollection(reference_to, spaceId).find(query, {\n\t\t\t\t\t\t\t\tfields: children_fields\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\tcatch e\n\t\t\t\t\t\t\tconsole.log(reference_to, parent, e)\n\t\t\t\t\t\t\treturn []\n\t\t\t\t}\n\n\t\treturn data\n\telse\n\t\treturn {\n\t\t\tfind: ()->\n\t\t\t\tself.unblock();\n\t\t\t\treturn object_colleciton.find({_id: {$in: ids}}, {fields: fields})\n\t\t};\n\n","Meteor.publishComposite(\"steedos_object_tabular\", function(tableName, ids, fields, spaceId) {\n  var _fields, _keys, _object, _object_name, data, keys, object_colleciton, reference_fields, self;\n  if (!this.userId) {\n    return this.ready();\n  }\n  check(tableName, String);\n  check(ids, Array);\n  check(fields, Match.Optional(Object));\n  _object_name = tableName.replace(\"creator_\", \"\");\n  _object = Creator.getObject(_object_name, spaceId);\n  if (spaceId) {\n    _object_name = Creator.getObjectName(_object);\n  }\n  object_colleciton = Creator.getCollection(_object_name);\n  _fields = _object != null ? _object.fields : void 0;\n  if (!_fields || !object_colleciton) {\n    return this.ready();\n  }\n  reference_fields = _.filter(_fields, function(f) {\n    return _.isFunction(f.reference_to) || !_.isEmpty(f.reference_to);\n  });\n  self = this;\n  self.unblock();\n  if (reference_fields.length > 0) {\n    data = {\n      find: function() {\n        var field_keys;\n        self.unblock();\n        field_keys = {};\n        _.each(_.keys(fields), function(f) {\n          if (!/\\w+(\\.\\$){1}\\w?/.test(f)) {\n            return field_keys[f] = 1;\n          }\n        });\n        return object_colleciton.find({\n          _id: {\n            $in: ids\n          }\n        }, {\n          fields: field_keys\n        });\n      }\n    };\n    data.children = [];\n    keys = _.keys(fields);\n    if (keys.length < 1) {\n      keys = _.keys(_fields);\n    }\n    _keys = [];\n    keys.forEach(function(key) {\n      if (_object.schema._objectKeys[key + '.']) {\n        _keys = _keys.concat(_.map(_object.schema._objectKeys[key + '.'], function(k) {\n          return key + '.' + k;\n        }));\n      }\n      return _keys.push(key);\n    });\n    _keys.forEach(function(key) {\n      var reference_field;\n      reference_field = _fields[key];\n      if (reference_field && (_.isFunction(reference_field.reference_to) || !_.isEmpty(reference_field.reference_to))) {\n        return data.children.push({\n          find: function(parent) {\n            var children_fields, e, name_field_key, p_k, query, reference_ids, reference_to, reference_to_object, s_k;\n            try {\n              self.unblock();\n              query = {};\n              if (/\\w+(\\.\\$\\.){1}\\w+/.test(key)) {\n                p_k = key.replace(/(\\w+)\\.\\$\\.\\w+/ig, \"$1\");\n                s_k = key.replace(/\\w+\\.\\$\\.(\\w+)/ig, \"$1\");\n                reference_ids = parent[p_k].getProperty(s_k);\n              } else {\n                reference_ids = key.split('.').reduce(function(o, x) {\n                  return o != null ? o[x] : void 0;\n                }, parent);\n              }\n              reference_to = reference_field.reference_to;\n              if (_.isFunction(reference_to)) {\n                reference_to = reference_to();\n              }\n              if (_.isArray(reference_to)) {\n                if (_.isObject(reference_ids) && !_.isArray(reference_ids)) {\n                  reference_to = reference_ids.o;\n                  reference_ids = reference_ids.ids || [];\n                } else {\n                  return [];\n                }\n              }\n              if (_.isArray(reference_ids)) {\n                query._id = {\n                  $in: reference_ids\n                };\n              } else {\n                query._id = reference_ids;\n              }\n              reference_to_object = Creator.getObject(reference_to, spaceId);\n              name_field_key = reference_to_object.NAME_FIELD_KEY;\n              children_fields = {\n                _id: 1,\n                space: 1\n              };\n              if (name_field_key) {\n                children_fields[name_field_key] = 1;\n              }\n              return Creator.getCollection(reference_to, spaceId).find(query, {\n                fields: children_fields\n              });\n            } catch (error) {\n              e = error;\n              console.log(reference_to, parent, e);\n              return [];\n            }\n          }\n        });\n      }\n    });\n    return data;\n  } else {\n    return {\n      find: function() {\n        self.unblock();\n        return object_colleciton.find({\n          _id: {\n            $in: ids\n          }\n        }, {\n          fields: fields\n        });\n      }\n    };\n  }\n});\n","Meteor.publish \"object_listviews\", (object_name, spaceId)->\n    userId = this.userId\n    return Creator.getCollection(\"object_listviews\").find({object_name: object_name, space: spaceId ,\"$or\":[{owner: userId}, {shared: true}]})","Meteor.publish \"user_tabular_settings\", (object_name)->\n    userId = this.userId\n    return Creator.Collections.settings.find({object_name: {$in: object_name}, record_id: {$in: [\"object_listviews\", \"object_gridviews\"]}, owner: userId})\n","Meteor.publish \"related_objects_records\", (object_name, related_object_name, related_field_name, record_id, spaceId)->\n\tuserId = this.userId\n\tif related_object_name == \"cfs.files.filerecord\"\n\t\tselector = {\"metadata.space\": spaceId}\n\telse\n\t\tselector = {space: spaceId}\n\t\n\tif related_object_name == \"cms_files\"\n\t\t# é™„ä»¶çš„å…³è”æœç´¢æ¡ä»¶æ˜¯å®šæ­»çš„\n\t\tselector[\"parent.o\"] = object_name\n\t\tselector[\"parent.ids\"] = [record_id]\n\telse\n\t\tselector[related_field_name] = record_id\n\n\tpermissions = Creator.getPermissions(related_object_name, spaceId, userId)\n\tif !permissions.viewAllRecords and permissions.allowRead\n\t\tselector.owner = userId\n\t\n\treturn Creator.getCollection(related_object_name).find(selector)","Meteor.publish(\"related_objects_records\", function(object_name, related_object_name, related_field_name, record_id, spaceId) {\n  var permissions, selector, userId;\n  userId = this.userId;\n  if (related_object_name === \"cfs.files.filerecord\") {\n    selector = {\n      \"metadata.space\": spaceId\n    };\n  } else {\n    selector = {\n      space: spaceId\n    };\n  }\n  if (related_object_name === \"cms_files\") {\n    selector[\"parent.o\"] = object_name;\n    selector[\"parent.ids\"] = [record_id];\n  } else {\n    selector[related_field_name] = record_id;\n  }\n  permissions = Creator.getPermissions(related_object_name, spaceId, userId);\n  if (!permissions.viewAllRecords && permissions.allowRead) {\n    selector.owner = userId;\n  }\n  return Creator.getCollection(related_object_name).find(selector);\n});\n","Meteor.publish 'space_user_info', (spaceId, userId)->\n\treturn Creator.getCollection(\"space_users\").find({space: spaceId, user: userId})","\nif Meteor.isServer\n\n\tMeteor.publish 'contacts_view_limits', (spaceId)->\n\n\t\tunless this.userId\n\t\t\treturn this.ready()\n\n\t\tunless spaceId\n\t\t\treturn this.ready()\n\n\t\tselector =\n\t\t\tspace: spaceId\n\t\t\tkey: 'contacts_view_limits'\n\n\t\treturn db.space_settings.find(selector)","if (Meteor.isServer) {\n  Meteor.publish('contacts_view_limits', function(spaceId) {\n    var selector;\n    if (!this.userId) {\n      return this.ready();\n    }\n    if (!spaceId) {\n      return this.ready();\n    }\n    selector = {\n      space: spaceId,\n      key: 'contacts_view_limits'\n    };\n    return db.space_settings.find(selector);\n  });\n}\n","\nif Meteor.isServer\n\n\tMeteor.publish 'contacts_no_force_phone_users', (spaceId)->\n\n\t\tunless this.userId\n\t\t\treturn this.ready()\n\n\t\tunless spaceId\n\t\t\treturn this.ready()\n\n\t\tselector =\n\t\t\tspace: spaceId\n\t\t\tkey: 'contacts_no_force_phone_users'\n\n\t\treturn db.space_settings.find(selector)","if (Meteor.isServer) {\n  Meteor.publish('contacts_no_force_phone_users', function(spaceId) {\n    var selector;\n    if (!this.userId) {\n      return this.ready();\n    }\n    if (!spaceId) {\n      return this.ready();\n    }\n    selector = {\n      space: spaceId,\n      key: 'contacts_no_force_phone_users'\n    };\n    return db.space_settings.find(selector);\n  });\n}\n","if Meteor.isServer\n\tMeteor.publish 'space_need_to_confirm', ()->\n\t\tuserId = this.userId\n\t\treturn db.space_users.find({user: userId, invite_state: \"pending\"})","if (Meteor.isServer) {\n  Meteor.publish('space_need_to_confirm', function() {\n    var userId;\n    userId = this.userId;\n    return db.space_users.find({\n      user: userId,\n      invite_state: \"pending\"\n    });\n  });\n}\n","permissionManagerForInitApproval = {}\n\npermissionManagerForInitApproval.getFlowPermissions = (flow_id, user_id) ->\n\t# æ ¹æ®:flow_idæŸ¥åˆ°å¯¹åº”çš„flow\n\tflow = uuflowManagerForInitApproval.getFlow(flow_id)\n\tspace_id = flow.space\n\t# æ ¹æ®space_idå’Œ:user_idåˆ°organizationsè¡¨ä¸­æŸ¥åˆ°ç”¨æˆ·æ‰€å±žæ‰€æœ‰çš„org_idï¼ˆåŒ…æ‹¬ä¸Šçº§ç»„IDï¼‰\n\torg_ids = new Array\n\torganizations = db.organizations.find({\n\t\tspace: space_id, users: user_id }, { fields: { parents: 1 } }).fetch()\n\t_.each(organizations, (org) ->\n\t\torg_ids.push(org._id)\n\t\tif org.parents\n\t\t\t_.each(org.parents, (parent_id) ->\n\t\t\t\torg_ids.push(parent_id)\n\t\t\t)\n\t)\n\torg_ids = _.uniq(org_ids)\n\tmy_permissions = new Array\n\tif flow.perms\n\t\t# åˆ¤æ–­flow.perms.users_can_adminä¸­æ˜¯å¦åŒ…å«å½“å‰ç”¨æˆ·ï¼Œ\n\t\t# æˆ–è€…flow.perms.orgs_can_addæ˜¯å¦åŒ…å«4æ­¥å¾—åˆ°çš„org_idæ•°ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œ\n\t\t# è‹¥æ˜¯ï¼Œåˆ™åœ¨è¿”å›žçš„æ•°ç»„ä¸­åŠ ä¸Šadd\n\t\tif flow.perms.users_can_add\n\t\t\tusers_can_add = flow.perms.users_can_add\n\t\t\tif users_can_add.includes(user_id)\n\t\t\t\tmy_permissions.push(\"add\")\n\n\t\tif flow.perms.orgs_can_add\n\t\t\torgs_can_add = flow.perms.orgs_can_add\n\t\t\t_.each(org_ids, (org_id) ->\n\t\t\t\tif orgs_can_add.includes(org_id)\n\t\t\t\t\tmy_permissions.push(\"add\")\n\t\t\t)\n\t\t# åˆ¤æ–­flow.perms.users_can_monitorä¸­æ˜¯å¦åŒ…å«å½“å‰ç”¨æˆ·ï¼Œ\n\t\t# æˆ–è€…flow.perms.orgs_can_monitoræ˜¯å¦åŒ…å«4æ­¥å¾—åˆ°çš„org_idæ•°ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œ\n\t\t# è‹¥æ˜¯ï¼Œåˆ™åœ¨è¿”å›žçš„æ•°ç»„ä¸­åŠ ä¸Šmonitor\n\t\tif flow.perms.users_can_monitor\n\t\t\tusers_can_monitor = flow.perms.users_can_monitor\n\t\t\tif users_can_monitor.includes(user_id)\n\t\t\t\tmy_permissions.push(\"monitor\")\n\n\t\tif flow.perms.orgs_can_monitor\n\t\t\torgs_can_monitor = flow.perms.orgs_can_monitor\n\t\t\t_.each(org_ids, (org_id) ->\n\t\t\t\tif orgs_can_monitor.includes(org_id)\n\t\t\t\t\tmy_permissions.push(\"monitor\")\n\t\t\t)\n\t\t# åˆ¤æ–­flow.perms.users_can_adminä¸­æ˜¯å¦åŒ…å«å½“å‰ç”¨æˆ·ï¼Œ\n\t\t# æˆ–è€…flow.perms.orgs_can_adminæ˜¯å¦åŒ…å«4æ­¥å¾—åˆ°çš„org_idæ•°ç»„ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œ\n\t\t# è‹¥æ˜¯ï¼Œåˆ™åœ¨è¿”å›žçš„æ•°ç»„ä¸­åŠ ä¸Šadmin\n\t\tif flow.perms.users_can_admin\n\t\t\tusers_can_admin = flow.perms.users_can_admin\n\t\t\tif users_can_admin.includes(user_id)\n\t\t\t\tmy_permissions.push(\"admin\")\n\n\t\tif flow.perms.orgs_can_admin\n\t\t\torgs_can_admin = flow.perms.orgs_can_admin\n\t\t\t_.each(org_ids, (org_id) ->\n\t\t\t\tif orgs_can_admin.includes(org_id)\n\t\t\t\t\tmy_permissions.push(\"admin\")\n\t\t\t)\n\n\tmy_permissions = _.uniq(my_permissions)\n\treturn my_permissions","                                     \n\npermissionManagerForInitApproval = {};\n\npermissionManagerForInitApproval.getFlowPermissions = function(flow_id, user_id) {\n  var flow, my_permissions, org_ids, organizations, orgs_can_add, orgs_can_admin, orgs_can_monitor, space_id, users_can_add, users_can_admin, users_can_monitor;\n  flow = uuflowManagerForInitApproval.getFlow(flow_id);\n  space_id = flow.space;\n  org_ids = new Array;\n  organizations = db.organizations.find({\n    space: space_id,\n    users: user_id\n  }, {\n    fields: {\n      parents: 1\n    }\n  }).fetch();\n  _.each(organizations, function(org) {\n    org_ids.push(org._id);\n    if (org.parents) {\n      return _.each(org.parents, function(parent_id) {\n        return org_ids.push(parent_id);\n      });\n    }\n  });\n  org_ids = _.uniq(org_ids);\n  my_permissions = new Array;\n  if (flow.perms) {\n    if (flow.perms.users_can_add) {\n      users_can_add = flow.perms.users_can_add;\n      if (users_can_add.includes(user_id)) {\n        my_permissions.push(\"add\");\n      }\n    }\n    if (flow.perms.orgs_can_add) {\n      orgs_can_add = flow.perms.orgs_can_add;\n      _.each(org_ids, function(org_id) {\n        if (orgs_can_add.includes(org_id)) {\n          return my_permissions.push(\"add\");\n        }\n      });\n    }\n    if (flow.perms.users_can_monitor) {\n      users_can_monitor = flow.perms.users_can_monitor;\n      if (users_can_monitor.includes(user_id)) {\n        my_permissions.push(\"monitor\");\n      }\n    }\n    if (flow.perms.orgs_can_monitor) {\n      orgs_can_monitor = flow.perms.orgs_can_monitor;\n      _.each(org_ids, function(org_id) {\n        if (orgs_can_monitor.includes(org_id)) {\n          return my_permissions.push(\"monitor\");\n        }\n      });\n    }\n    if (flow.perms.users_can_admin) {\n      users_can_admin = flow.perms.users_can_admin;\n      if (users_can_admin.includes(user_id)) {\n        my_permissions.push(\"admin\");\n      }\n    }\n    if (flow.perms.orgs_can_admin) {\n      orgs_can_admin = flow.perms.orgs_can_admin;\n      _.each(org_ids, function(org_id) {\n        if (orgs_can_admin.includes(org_id)) {\n          return my_permissions.push(\"admin\");\n        }\n      });\n    }\n  }\n  my_permissions = _.uniq(my_permissions);\n  return my_permissions;\n};\n","# å‘èµ·å®¡æ‰¹\n_eval = require('eval')\nobjectql = require('@steedos/objectql');\n\ngetObjectConfig = (objectApiName) ->\n\treturn objectql.getObject(objectApiName).toConfig()\n\ngetObjectNameFieldKey = (objectApiName) ->\n\treturn objectql.getObject(objectApiName).NAME_FIELD_KEY\n\ngetRelateds = (objectApiName) ->\n\treturn Meteor.wrapAsync((objectApiName, cb) ->\n\t\tobjectql.getObject(objectApiName).getRelateds().then (resolve, reject) ->\n\t\t\tcb(reject, resolve)\n\t\t)(objectApiName)\n\nobjectFindOne = (objectApiName, query) ->\n\treturn Meteor.wrapAsync((objectApiName, query, cb) ->\n\t\tquery.top = 1\n\t\tobjectql.getObject(objectApiName).find(query).then (resolve, reject) ->\n\t\t\tif (resolve && resolve.length > 0)\n\t\t\t\tcb(reject, resolve[0])\n\t\t\telse\n\t\t\t\tcb(reject, null)\n\t\t)(objectApiName, query)\n\nobjectFind = (objectApiName, query) ->\n\treturn Meteor.wrapAsync((objectApiName, query, cb) ->\n\t\tobjectql.getObject(objectApiName).find(query).then (resolve, reject) ->\n\t\t\tcb(reject, resolve)\n\t\t)(objectApiName, query)\n\nobjectUpdate = (objectApiName, id, data) ->\n\treturn Meteor.wrapAsync((objectApiName, id, data, cb) ->\n\t\tobjectql.getObject(objectApiName).update(id, data).then (resolve, reject) ->\n\t\t\tcb(reject, resolve)\n\t\t)(objectApiName, id, data)\n\ngetRelatedObjectFieldCode =  (relatedObjectsKeys, key) ->\n\treturn _.find relatedObjectsKeys,  (relatedObjectsKey) ->\n\t\treturn key.startsWith(relatedObjectsKey + '.')\n\ngetFormTableFieldCode = (formTableFieldsCode, key) ->\n\treturn _.find formTableFieldsCode,  (formTableFieldCode) ->\n\t\treturn key.startsWith(formTableFieldCode + '.')\n\ngetFormTableField = (formTableFields, key) ->\n\treturn _.find formTableFields,  (f) ->\n\t\treturn f.code == key\n\ngetFormField = (formFields, key) ->\n\tff = null\n\t_.forEach formFields, (f) ->\n\t\tif ff\n\t\t\treturn\n\t\tif f.type == 'section'\n\t\t\tff = _.find f.fields,  (sf) ->\n\t\t\t\treturn sf.code == key\n\t\telse if f.code == key\n\t\t\tff = f\n\n\treturn ff\n\ngetFormTableSubField = (tableField, subFieldCode) ->\n\treturn _.find tableField.fields,  (f) ->\n\t\treturn f.code == subFieldCode\n\ngetFieldOdataValue = (objName, id, referenceToFieldName) ->\n\t# obj = Creator.getCollection(objName)\n\tobj = objectql.getObject(objName)\n\tnameKey = getObjectNameFieldKey(objName)\n\tif !obj\n\t\treturn\n\tif _.isString id\n\t\t# _record = obj.findOne(id)\n\t\t_record = objectFindOne(objName, { filters: [[referenceToFieldName, '=', id]]})\n\t\tif _record\n\t\t\t_record['@label'] = _record[nameKey]\n\t\t\treturn _record\n\telse if _.isArray id\n\t\t_records = []\n\t\t# obj.find({ _id: { $in: id } })\n\t\tobjectFind(objName, { filters: [[referenceToFieldName, 'in', id]]}).forEach (_record) ->\n\t\t\t_record['@label'] = _record[nameKey]\n\t\t\t_records.push _record\n\t\tif !_.isEmpty _records\n\t\t\treturn _records\n\treturn\n\ngetSelectUserValue = (userId, spaceId) ->\n\tsu = Creator.getCollection('space_users').findOne({ space: spaceId, user: userId })\n\tsu.id = userId\n\treturn su\n\ngetSelectUserValues = (userIds, spaceId) ->\n\tsus = []\n\tif _.isArray userIds\n\t\t_.each userIds, (userId) ->\n\t\t\tsu = getSelectUserValue(userId, spaceId)\n\t\t\tif su\n\t\t\t\tsus.push(su)\n\treturn sus\n\ngetSelectOrgValue = (orgId, spaceId) ->\n\torg = Creator.getCollection('organizations').findOne(orgId, { fields: { _id: 1, name: 1, fullname: 1 } })\n\torg.id = orgId\n\treturn org\n\ngetSelectOrgValues = (orgIds, spaceId) ->\n\torgs = []\n\tif _.isArray orgIds\n\t\t_.each orgIds, (orgId) ->\n\t\t\torg = getSelectOrgValue(orgId, spaceId)\n\t\t\tif org\n\t\t\t\torgs.push(org)\n\treturn orgs\n\ngetFileFieldValue = (recordFieldId, fType)->\n\tif _.isEmpty(recordFieldId)\n\t\treturn \n\tif fType == 'image'\n\t\tcollection = 'images'\n\telse if fType == 'file'\n\t\tcollection = 'files'\n\tif _.isString(recordFieldId)\n\t\tquery = {_id: {$in: [recordFieldId]}}\n\telse\n\t\tquery = {_id: {$in: recordFieldId}}\n\tfiles = Creator.Collections[\"cfs.#{collection}.filerecord\"].find(query);\n\tvalue = []\n\tfiles.forEach (f) ->\n\t\tnewFile = new FS.File()\n\t\tnewFile.attachData f.createReadStream('files'), {\n\t\t\t\ttype: f.original.type\n\t\t}, (err) ->\n\t\t\tif (err)\n\t\t\t\tthrow new Meteor.Error(err.error, err.reason)\n\n\t\t\tnewFile.name(f.name())\n\t\t\tnewFile.size(f.size())\n\t\t\tmetadata = {\n\t\t\t\towner: f.metadata.owner\n\t\t\t}\n\t\t\tnewFile.metadata = metadata;\n\t\t\tnewFile._id = Creator.Collections.instances._makeNewID();\n\t\t\tcfs[collection].insert(newFile);\n\t\t\tvalue.push(newFile._id)\n\tif value.length > 0\n\t\tif _.isString(recordFieldId)\n\t\t\treturn value[0]\n\t\telse\n\t\t\treturn value;\n\ngetInstanceFieldValue = (objField, formField, record, object_field, spaceId, recordFieldValue, enableAmisform) ->\n\n\tif enableAmisform && formField.steedos_field\n\t\treturn recordFieldValue\n\n\trecordFieldValue = record[objField.name]\n\tvalue\n\t# lookupã€master_detailå­—æ®µåŒæ­¥åˆ°odataå­—æ®µ\n\tif formField && objField && formField.type == 'odata' && ['lookup', 'master_detail'].includes(objField.type) && _.isString(objField.reference_to)\n\t\treferenceToFieldName = objField.reference_to_field || '_id'\n\t\treferenceToObjectName = objField.reference_to\n\t\todataFieldValue\n\t\tif objField.multiple && formField.is_multiselect\n\t\t\todataFieldValue = getFieldOdataValue(referenceToObjectName, recordFieldValue, referenceToFieldName)\n\t\telse if !objField.multiple && !formField.is_multiselect\n\t\t\todataFieldValue = getFieldOdataValue(referenceToObjectName, recordFieldValue, referenceToFieldName)\n\t\tvalue = odataFieldValue\n\telse if formField && objField && ['user', 'group'].includes(formField.type) && ['lookup', 'master_detail'].includes(objField.type) && (['users', 'organizations'].includes(objField.reference_to) || ('space_users' == objField.reference_to && 'user' == objField.reference_to_field) )\n\t\tif !_.isEmpty(recordFieldValue)\n\t\t\tselectFieldValue\n\t\t\tif formField.type == 'user'\n\t\t\t\tif objField.multiple && formField.is_multiselect\n\t\t\t\t\tselectFieldValue = getSelectUserValues(recordFieldValue, spaceId)\n\t\t\t\telse if !objField.multiple && !formField.is_multiselect\n\t\t\t\t\tselectFieldValue = getSelectUserValue(recordFieldValue, spaceId)\n\t\t\telse if formField.type == 'group'\n\t\t\t\tif objField.multiple && formField.is_multiselect\n\t\t\t\t\tselectFieldValue = getSelectOrgValues(recordFieldValue, spaceId)\n\t\t\t\telse if !objField.multiple && !formField.is_multiselect\n\t\t\t\t\tselectFieldValue = getSelectOrgValue(recordFieldValue, spaceId)\n\t\t\tif selectFieldValue\n\t\t\t\tvalue = selectFieldValue\n\telse if formField && objField && formField.type == 'date' && recordFieldValue\n\t\tvalue = uuflowManagerForInitApproval.formatDate(recordFieldValue) # Dateè½¬String\n\telse if formField && objField && formField.type == 'time' && recordFieldValue\n\t\tvalue = uuflowManagerForInitApproval.formatTime(recordFieldValue) # Timeè½¬String\n\telse if formField && objField && recordFieldValue && (formField.type == 'image' || formField.type == 'file')\n\t\tvalue = getFileFieldValue(recordFieldValue, formField.type)\n\telse if formField && objField && recordFieldValue && formField.type == 'lookup' && ['lookup', 'master_detail'].includes(objField.type) && _.isString(objField.reference_to)\n\t\tvalue = recordFieldValue\n\telse if formField && objField && recordFieldValue && (formField.type == 'multiSelect')\n\t\tvalue = recordFieldValue.join(',')\n\telse if record.hasOwnProperty(object_field)\n\t\tvalue = recordFieldValue\n\t\n\treturn value\n\n# requiredDetailsç»“æž„[\"å­è¡¨å.å­è¡¨ä¸­master_detailå­—æ®µå\", ...]\ncheckRequiredDetails = (requiredDetails, masterRecord) ->\n\tif !_.isEmpty requiredDetails\n\t\t# æ£€æŸ¥å­è¡¨å¿…å¡«ï¼Œå³å­è¡¨å¿…é¡»æœ‰è®°å½•\n\t\trequiredDetails.forEach (rd) ->\n\t\t\tsubTableName = rd.split('.')[0]\n\t\t\tsubTableMasterField = rd.split('.')[1]\n\t\t\tsubObjConfig = getObjectConfig subTableName\n\t\t\tmasterField = subObjConfig.fields[subTableMasterField]\n\t\t\trefId = masterField.reference_to_field || '_id'\n\t\t\tmasterFieldValue = masterRecord[refId]\n\t\t\t# æŸ¥è¯¢å­è¡¨è®°å½•\n\t\t\tsubTableRecord = objectFindOne(subTableName, { filters: [[subTableMasterField, '=', masterFieldValue]], fields: [subTableMasterField] })\n\t\t\tif !subTableRecord\n\t\t\t\tthrow new Error \"è¯·å…ˆæ–°å¢ž#{subObjConfig.label}\"\n\t\treturn\n\nuuflowManagerForInitApproval = {}\n\nuuflowManagerForInitApproval.check_authorization = (req) ->\n\tquery = req.query\n\tuserId = query[\"X-User-Id\"]\n\tauthToken = query[\"X-Auth-Token\"]\n\n\tif not userId or not authToken\n\t\tthrow new Meteor.Error 401, 'Unauthorized'\n\n\thashedToken = Accounts._hashLoginToken(authToken)\n\tuser = Meteor.users.findOne\n\t\t_id: userId,\n\t\t\"services.resume.loginTokens.hashedToken\": hashedToken\n\n\tif not user\n\t\tthrow new Meteor.Error 401, 'Unauthorized'\n\n\treturn user\n\nuuflowManagerForInitApproval.getSpace = (space_id) ->\n\tspace = Creator.Collections.spaces.findOne(space_id)\n\tif not space\n\t\tthrow new Meteor.Error('error!', \"space_idæœ‰è¯¯æˆ–æ­¤spaceå·²ç»è¢«åˆ é™¤\")\n\treturn space\n\nuuflowManagerForInitApproval.getFlow = (flow_id) ->\n\tflow = Creator.Collections.flows.findOne(flow_id)\n\tif not flow\n\t\tthrow new Meteor.Error('error!', \"idæœ‰è¯¯æˆ–æ­¤æµç¨‹å·²ç»è¢«åˆ é™¤\")\n\treturn flow\n\nuuflowManagerForInitApproval.getSpaceUser = (space_id, user_id) ->\n\tspace_user = Creator.Collections.space_users.findOne({ space: space_id, user: user_id })\n\tif not space_user\n\t\tthrow new Meteor.Error('error!', \"user_idå¯¹åº”çš„ç”¨æˆ·ä¸å±žäºŽå½“å‰space\")\n\treturn space_user\n\nuuflowManagerForInitApproval.getSpaceUserOrgInfo = (space_user) ->\n\tinfo = new Object\n\tinfo.organization = space_user.organization\n\torg = Creator.Collections.organizations.findOne(space_user.organization, { fields: { name: 1 , fullname: 1 } })\n\tinfo.organization_name = org.name\n\tinfo.organization_fullname = org.fullname\n\treturn info\n\nuuflowManagerForInitApproval.isFlowEnabled = (flow) ->\n\tif flow.state isnt \"enabled\"\n\t\tthrow new Meteor.Error('error!', \"æµç¨‹æœªå¯ç”¨,æ“ä½œå¤±è´¥\")\n\nuuflowManagerForInitApproval.isFlowSpaceMatched = (flow, space_id) ->\n\tif flow.space isnt space_id\n\t\tthrow new Meteor.Error('error!', \"æµç¨‹å’Œå·¥ä½œåŒºIDä¸åŒ¹é…\")\n\nuuflowManagerForInitApproval.getForm = (form_id) ->\n\tform = Creator.Collections.forms.findOne(form_id)\n\tif not form\n\t\tthrow new Meteor.Error('error!', 'è¡¨å•IDæœ‰è¯¯æˆ–æ­¤è¡¨å•å·²ç»è¢«åˆ é™¤')\n\n\treturn form\n\nuuflowManagerForInitApproval.getCategory = (category_id) ->\n\treturn Creator.Collections.categories.findOne(category_id)\n\nuuflowManagerForInitApproval.checkSyncDirection = (object_name, flow_id) ->\n\tow = Creator.Collections.object_workflows.findOne({\n\t\tobject_name: object_name,\n\t\tflow_id: flow_id\n\t})\n\tif !ow\n\t\tthrow new Meteor.Error('error!', 'æœªæ‰¾åˆ°å¯¹è±¡æµç¨‹æ˜ å°„è®°å½•ã€‚')\n\tsyncDirection = ow.sync_direction || 'both'\n\tif !['both', 'obj_to_ins'].includes(syncDirection)\n\t\tthrow new Meteor.Error('error!', 'ä¸æ”¯æŒçš„åŒæ­¥æ–¹å‘ã€‚')\n\n\treturn \n\nuuflowManagerForInitApproval.create_instance = (instance_from_client, user_info) ->\n\tcheck instance_from_client[\"applicant\"], String\n\tcheck instance_from_client[\"space\"], String\n\tcheck instance_from_client[\"flow\"], String\n\tcheck instance_from_client[\"record_ids\"], [{o: String, ids: [String]}]\n\n\t# æ ¡éªŒåŒæ­¥æ–¹å‘\n\tuuflowManagerForInitApproval.checkSyncDirection(instance_from_client[\"record_ids\"][0].o, instance_from_client[\"flow\"])\n\n\t# æ ¡éªŒæ˜¯å¦recordå·²ç»å‘èµ·çš„ç”³è¯·è¿˜åœ¨å®¡æ‰¹ä¸­\n\tuuflowManagerForInitApproval.checkIsInApproval(instance_from_client[\"record_ids\"][0], instance_from_client[\"space\"])\n\n\tspace_id = instance_from_client[\"space\"]\n\tflow_id = instance_from_client[\"flow\"]\n\tuser_id = user_info._id\n\t# èŽ·å–å‰å°æ‰€ä¼ çš„trace\n\ttrace_from_client = null\n\t# èŽ·å–å‰å°æ‰€ä¼ çš„approve\n\tapprove_from_client = null\n\tif instance_from_client[\"traces\"] and instance_from_client[\"traces\"][0]\n\t\ttrace_from_client = instance_from_client[\"traces\"][0]\n\t\tif trace_from_client[\"approves\"] and trace_from_client[\"approves\"][0]\n\t\t\tapprove_from_client = instance_from_client[\"traces\"][0][\"approves\"][0]\n\n\t# èŽ·å–ä¸€ä¸ªspace\n\tspace = uuflowManagerForInitApproval.getSpace(space_id)\n\t# èŽ·å–ä¸€ä¸ªflow\n\tflow = uuflowManagerForInitApproval.getFlow(flow_id)\n\t# èŽ·å–ä¸€ä¸ªspaceä¸‹çš„ä¸€ä¸ªuser\n\tspace_user = uuflowManagerForInitApproval.getSpaceUser(space_id, user_id)\n\t# èŽ·å–space_useræ‰€åœ¨çš„éƒ¨é—¨ä¿¡æ¯\n\tspace_user_org_info = uuflowManagerForInitApproval.getSpaceUserOrgInfo(space_user)\n\t# åˆ¤æ–­ä¸€ä¸ªflowæ˜¯å¦ä¸ºå¯ç”¨çŠ¶æ€\n\tuuflowManagerForInitApproval.isFlowEnabled(flow)\n\t# åˆ¤æ–­ä¸€ä¸ªflowå’Œspace_idæ˜¯å¦åŒ¹é…\n\tuuflowManagerForInitApproval.isFlowSpaceMatched(flow, space_id)\n\n\tform = uuflowManagerForInitApproval.getForm(flow.form)\n\n\tpermissions = permissionManager.getFlowPermissions(flow_id, user_id)\n\n\tif not permissions.includes(\"add\")\n\t\tthrow new Meteor.Error('error!', \"å½“å‰ç”¨æˆ·æ²¡æœ‰æ­¤æµç¨‹çš„æ–°å»ºæƒé™\")\n\n\tnow = new Date\n\tins_obj = {}\n\tins_obj._id = Creator.Collections.instances._makeNewID()\n\tins_obj.space = space_id\n\tins_obj.flow = flow_id\n\tins_obj.flow_version = flow.current._id\n\tins_obj.form = flow.form\n\tins_obj.form_version = flow.current.form_version\n\tins_obj.name = flow.name\n\tins_obj.submitter = user_id\n\tins_obj.submitter_name = user_info.name\n\tins_obj.applicant = if instance_from_client[\"applicant\"] then instance_from_client[\"applicant\"] else user_id\n\tins_obj.applicant_name = if instance_from_client[\"applicant_name\"] then instance_from_client[\"applicant_name\"] else user_info.name\n\tins_obj.applicant_organization = if instance_from_client[\"applicant_organization\"] then instance_from_client[\"applicant_organization\"] else space_user.organization\n\tins_obj.applicant_organization_name = if instance_from_client[\"applicant_organization_name\"] then instance_from_client[\"applicant_organization_name\"] else space_user_org_info.organization_name\n\tins_obj.applicant_organization_fullname = if instance_from_client[\"applicant_organization_fullname\"] then instance_from_client[\"applicant_organization_fullname\"] else  space_user_org_info.organization_fullname\n\tins_obj.applicant_company = if instance_from_client[\"applicant_company\"] then instance_from_client[\"applicant_company\"] else space_user.company_id\n\tins_obj.state = 'draft'\n\tins_obj.code = ''\n\tins_obj.is_archived = false\n\tins_obj.is_deleted = false\n\tins_obj.created = now\n\tins_obj.created_by = user_id\n\tins_obj.modified = now\n\tins_obj.modified_by = user_id\n\n\tins_obj.record_ids = instance_from_client[\"record_ids\"]\n\n\tif space_user.company_id\n\t\tins_obj.company_id = space_user.company_id\n\n\t# æ–°å»ºTrace\n\ttrace_obj = {}\n\ttrace_obj._id = new Mongo.ObjectID()._str\n\ttrace_obj.instance = ins_obj._id\n\ttrace_obj.is_finished = false\n\t# å½“å‰æœ€æ–°ç‰ˆflowä¸­å¼€å§‹èŠ‚ç‚¹\n\tstart_step = _.find(flow.current.steps, (step) ->\n\t\treturn step.step_type is 'start'\n\t)\n\ttrace_obj.step = start_step._id\n\ttrace_obj.name = start_step.name\n\n\ttrace_obj.start_date = now\n\t# æ–°å»ºApprove\n\tappr_obj = {}\n\tappr_obj._id = new Mongo.ObjectID()._str\n\tappr_obj.instance = ins_obj._id\n\tappr_obj.trace = trace_obj._id\n\tappr_obj.is_finished = false\n\tappr_obj.user = if instance_from_client[\"applicant\"] then instance_from_client[\"applicant\"] else user_id\n\tappr_obj.user_name = if instance_from_client[\"applicant_name\"] then instance_from_client[\"applicant_name\"] else user_info.name\n\tappr_obj.handler = user_id\n\tappr_obj.handler_name = user_info.name\n\tappr_obj.handler_organization = space_user.organization\n\tappr_obj.handler_organization_name = space_user_org_info.name\n\tappr_obj.handler_organization_fullname = space_user_org_info.fullname\n\tappr_obj.type = 'draft'\n\tappr_obj.start_date = now\n\tappr_obj.read_date = now\n\tappr_obj.is_read = true\n\tappr_obj.is_error = false\n\tappr_obj.description = ''\n\trelatedTablesInfo = {}\n\tappr_obj.values = uuflowManagerForInitApproval.initiateValues(ins_obj.record_ids[0], flow_id, space_id, form.current.fields, relatedTablesInfo)\n\n\ttrace_obj.approves = [appr_obj]\n\tins_obj.traces = [trace_obj]\n\n\tins_obj.values = appr_obj.values\n\n\tins_obj.inbox_users = instance_from_client.inbox_users || []\n\n\tins_obj.current_step_name = start_step.name\n\n\tif flow.auto_remind is true\n\t\tins_obj.auto_remind = true\n\n\t# æ–°å»ºç”³è¯·å•æ—¶ï¼Œinstancesè®°å½•æµç¨‹åç§°ã€æµç¨‹åˆ†ç±»åç§° #1313\n\tins_obj.flow_name = flow.name\n\tif form.category\n\t\tcategory = uuflowManagerForInitApproval.getCategory(form.category)\n\t\tif category\n\t\t\tins_obj.category_name = category.name\n\t\t\tins_obj.category = category._id\n\n\tnew_ins_id = Creator.Collections.instances.insert(ins_obj)\n\n\tuuflowManagerForInitApproval.initiateRecordInstanceInfo(ins_obj.record_ids[0], new_ins_id, space_id)\n\n\t# uuflowManagerForInitApproval.initiateRelatedRecordInstanceInfo(relatedTablesInfo, new_ins_id, space_id)\n\n\tuuflowManagerForInitApproval.initiateAttach(ins_obj.record_ids[0], space_id, ins_obj._id, appr_obj._id)\n\n\treturn new_ins_id\n\nuuflowManagerForInitApproval.initiateValues = (recordIds, flowId, spaceId, fields, relatedTablesInfo) ->\n\tfieldCodes = []\n\t_.each fields, (f) ->\n\t\tif f.type == 'section'\n\t\t\t_.each f.fields, (ff) ->\n\t\t\t\tfieldCodes.push ff.code\n\t\telse\n\t\t\tfieldCodes.push f.code\n\n\tvalues = {}\n\tobjectName = recordIds.o\n\tobject = getObjectConfig(objectName)\n\trecordId = recordIds.ids[0]\n\tow = Creator.Collections.object_workflows.findOne({\n\t\tobject_name: objectName,\n\t\tflow_id: flowId\n\t})\n\t# record = Creator.getCollection(objectName, spaceId).findOne(recordId)\n\trecord = objectFindOne(objectName, { filters: [['_id', '=', recordId]]})\n\tflow = Creator.getCollection('flows').findOne(flowId, { fields: { form: 1, enableAmisform: 1 } })\n\tenableAmisform = flow.enable_amisform\n\tif ow and record\n\t\trequiredDetails = ow.required_details || []\n\t\tcheckRequiredDetails(requiredDetails, record)\n\n\t\tform = Creator.getCollection(\"forms\").findOne(flow.form)\n\t\tformFields = form.current.fields || []\n\t\trelatedObjects = getRelateds(objectName)\n\t\trelatedObjectsKeys = _.pluck(relatedObjects, 'object_name')\n\t\tformTableFields = _.filter formFields, (formField) ->\n\t\t\treturn formField.type == 'table'\n\t\tformTableFieldsCode = _.pluck(formTableFields, 'code')\n\n\t\t# steedos field ä¸­å®šä¹‰çš„gridã€tableç±»åž‹å­—æ®µ\n\t\ttableFieldCodes = []\n\t\ttableFieldMap = []\n\t\t# ç›¸å…³è¡¨\n\t\ttableToRelatedMap = {}\n\n\t\t# field_map: ä»Žå°è´¦åˆ°å®¡æ‰¹å•çš„å­—æ®µåŒæ­¥æ˜ å°„è§„åˆ™\n\t\tow.field_map?.forEach (fm) ->\n\t\t\tobject_field = fm.object_field\n\t\t\tworkflow_field = fm.workflow_field\n\t\t\tif !object_field || !workflow_field\n\t\t\t\tthrow new Meteor.Error(400, 'æœªæ‰¾åˆ°å­—æ®µï¼Œè¯·æ£€æŸ¥å¯¹è±¡æµç¨‹æ˜ å°„å­—æ®µé…ç½®')\n\t\t\trelatedObjectFieldCode = getRelatedObjectFieldCode(relatedObjectsKeys, object_field)\n\t\t\tformTableFieldCode = getFormTableFieldCode(formTableFieldsCode, workflow_field)\n\t\t\tobjField = object.fields[object_field]\n\t\t\tformField = getFormField(formFields, workflow_field)\n\t\t\trecordFieldValue = record[object_field]\n\t\t\t# å¤„ç†å­è¡¨å­—æ®µ\n\t\t\tif relatedObjectFieldCode\n\t\t\t\t\n\t\t\t\toTableCode = object_field.split('.')[0]\n\t\t\t\toTableFieldCode = object_field.split('.')[1]\n\t\t\t\ttableToRelatedMapKey = oTableCode\n\t\t\t\tif !tableToRelatedMap[tableToRelatedMapKey]\n\t\t\t\t\ttableToRelatedMap[tableToRelatedMapKey] = {}\n\n\t\t\t\tif formTableFieldCode\n\t\t\t\t\twTableCode = workflow_field.split('.')[0]\n\t\t\t\t\ttableToRelatedMap[tableToRelatedMapKey]['_FROM_TABLE_CODE'] = wTableCode\n\n\t\t\t\ttableToRelatedMap[tableToRelatedMapKey][oTableFieldCode] = workflow_field\n\t\t\t# åˆ¤æ–­æ˜¯å¦æ˜¯è¡¨æ ¼å­—æ®µ(object field çš„ gridã€table)\n\t\t\telse if workflow_field.indexOf('.') > 0 and object_field.indexOf('.$.') > 0\n\t\t\t\twTableCode = workflow_field.split('.')[0]\n\t\t\t\toTableCode = object_field.split('.$.')[0]  ref1.table1.$.name\n\t\t\t\tif record.hasOwnProperty(oTableCode) and _.isArray(record[oTableCode])\n\t\t\t\t\ttableFieldCodes.push(JSON.stringify({\n\t\t\t\t\t\tworkflow_table_field_code: wTableCode,\n\t\t\t\t\t\tobject_table_field_code: oTableCode\n\t\t\t\t\t}))\n\t\t\t\t\ttableFieldMap.push(fm)\n\t\t\t\telse if oTableCode.indexOf('.') > 0 # è¯´æ˜Žæ˜¯å…³è”è¡¨çš„gridå­—æ®µ\n\t\t\t\t\toTableCodeReferenceFieldCode = oTableCode.split('.')[0];\n\t\t\t\t\tgridCode = oTableCode.split('.')[1];\n\t\t\t\t\toTableCodeReferenceField = object.fields[oTableCodeReferenceFieldCode];\n\t\t\t\t\tif oTableCodeReferenceField && ['lookup', 'master_detail'].includes(oTableCodeReferenceField.type) && _.isString(oTableCodeReferenceField.reference_to)\n\t\t\t\t\t\tif record[oTableCode]\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\treferenceToFieldName = oTableCodeReferenceField.reference_to_field || '_id';\n\t\t\t\t\t\treferenceToObjectName = oTableCodeReferenceField.reference_to;\n\t\t\t\t\t\treferenceToFieldValue = record[oTableCodeReferenceField.name];\n\t\t\t\t\t\t# æ­¤å¤„å€ŸåŠ©getFieldOdataValueå‡½æ•°çš„èƒ½åŠ›, èŽ·å–å…³è”è¡¨(lookup)çš„è®°å½•. æ­¤å¤„æœªæœªè€ƒè™‘lookupå•é€‰çš„æƒ…å†µ. æ­¤å¤„èŽ·å–å…³ç³»æ•°æ®çš„æ‰€æœ‰å­—æ®µ, äº¤ç”±ä¸‹æ–¹çš„è¡¨æ ¼æ•°æ®åŒæ­¥ç»Ÿä¸€æ•´ç†æ•°æ®\n\t\t\t\t\t\treferenceToDoc = getFieldOdataValue(referenceToObjectName, referenceToFieldValue, referenceToFieldName);\n\t\t\t\t\t\tif referenceToDoc[gridCode]\n\t\t\t\t\t\t\trecord[oTableCode] = referenceToDoc[gridCode];\n\t\t\t\t\t\t\ttableFieldCodes.push(JSON.stringify({\n\t\t\t\t\t\t\t\tworkflow_table_field_code: wTableCode,\n\t\t\t\t\t\t\t\tobject_table_field_code: oTableCode\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\treturn tableFieldMap.push(fm);\n\n\t\t\t# å¤„ç†lookupã€master_detailç±»åž‹å­—æ®µ\n\t\t\telse if object_field.indexOf('.') > 0 and object_field.indexOf('.$.') == -1\n\t\t\t\tobjectFieldName = object_field.split('.')[0]\n\t\t\t\tlookupFieldName = object_field.split('.')[1]\n\t\t\t\tif object\n\t\t\t\t\tobjectField = object.fields[objectFieldName]\n\t\t\t\t\tif objectField && formField && ['lookup', 'master_detail'].includes(objectField.type) && _.isString(objectField.reference_to)\n\t\t\t\t\t\tlookupObjectRecord = objectFindOne(objectField.reference_to, { filters: [['_id', '=', record[objectFieldName]]], fields: [lookupFieldName] })\n\t\t\t\t\t\tif !lookupObjectRecord\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\tobjectFieldObjectName = objectField.reference_to\n\t\t\t\t\t\tlookupFieldObj = getObjectConfig(objectFieldObjectName)\n\t\t\t\t\t\tobjectLookupField = lookupFieldObj.fields[lookupFieldName]\n\n\t\t\t\t\t\tvalues[workflow_field] = getInstanceFieldValue(objectLookupField, formField, lookupObjectRecord, lookupFieldName, spaceId, record[lookupFieldName], enableAmisform)\n\t\t\telse\n\t\t\t\tvalues[workflow_field] = getInstanceFieldValue(objField, formField, record, object_field, spaceId, record[object_field], enableAmisform)\n\n\t\t# è¡¨æ ¼å­—æ®µ\n\t\t_.uniq(tableFieldCodes).forEach (tfc) ->\n\t\t\tc = JSON.parse(tfc)\n\t\t\tvalues[c.workflow_table_field_code] = []\n\t\t\trecord[c.object_table_field_code].forEach (tr) ->\n\t\t\t\tnewTr = {}\n\t\t\t\t_.each tr, (tdValue, k) ->\n\t\t\t\t\ttableFieldMap.forEach (tfm) ->\n\t\t\t\t\t\tif tfm.object_field is (c.object_table_field_code + '.$.' + k)\n\t\t\t\t\t\t\twTdCode = tfm.workflow_field.split('.')[1]\n\t\t\t\t\t\t\tnewTr[wTdCode] = tdValue\n\t\t\t\tif not _.isEmpty(newTr)\n\t\t\t\t\tvalues[c.workflow_table_field_code].push(newTr)\n\n\t\t# åŒæ­¥å­è¡¨æ•°æ®è‡³è¡¨å•è¡¨æ ¼\n\t\t_.each tableToRelatedMap,  (map, key) ->\n\t\t\ttableCode = map._FROM_TABLE_CODE\n\t\t\tformTableField = getFormTableField(formTableFields, tableCode)\n\t\t\tif !tableCode\n\t\t\t\tconsole.warn('tableToRelated: [' + key + '] missing corresponding table.')\n\t\t\telse\n\t\t\t\trelatedObjectName = key\n\t\t\t\ttableValues = []\n\t\t\t\trelatedTableItems = []\n\t\t\t\trelatedObject = getObjectConfig(relatedObjectName)\n\t\t\t\trelatedField = _.find relatedObject.fields, (f) ->\n\t\t\t\t\treturn ['lookup', 'master_detail'].includes(f.type) && f.reference_to == objectName\n\n\t\t\t\trelatedFieldName = relatedField.name\n\n\t\t\t\trelatedRecords = objectFind(relatedObjectName, {\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t[relatedFieldName, '=', recordId]\n\t\t\t\t\t]\n\t\t\t\t})\n\n\t\t\t\trelatedRecords.forEach (relatedRecord) ->\n\t\t\t\t\ttableValueItem = {}\n\t\t\t\t\t_.each map, (valueKey, fieldKey) ->\n\t\t\t\t\t\tif fieldKey != '_FROM_TABLE_CODE'\n\t\t\t\t\t\t\ttableFieldValue\n\t\t\t\t\t\t\tformFieldKey\n\t\t\t\t\t\t\tif valueKey.startsWith(tableCode + '.')\n\t\t\t\t\t\t\t\tformFieldKey = (valueKey.split(\".\")[1])\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tformFieldKey = valueKey\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tformField = getFormTableSubField(formTableField, formFieldKey)\n\t\t\t\t\t\t\trelatedObjectField = relatedObject.fields[fieldKey]\n\t\t\t\t\t\t\tif !formField || !relatedObjectField\n\t\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t\ttableFieldValue = getInstanceFieldValue(relatedObjectField, formField, relatedRecord, fieldKey, spaceId, relatedRecord[fieldKey], enableAmisform)\n\t\t\t\t\t\t\ttableValueItem[formFieldKey] = tableFieldValue\n\t\t\t\t\tif !_.isEmpty(tableValueItem)\n\t\t\t\t\t\ttableValueItem._id = relatedRecord._id\n\t\t\t\t\t\ttableValues.push(tableValueItem)\n\t\t\t\t\t\trelatedTableItems.push({ _table: { _id: relatedRecord._id, _code: tableCode } } )\n\n\t\t\t\tvalues[tableCode] = tableValues\n\t\t\t\trelatedTablesInfo[relatedObjectName] = relatedTableItems\n\n\t\t# å¦‚æžœé…ç½®äº†è„šæœ¬åˆ™æ‰§è¡Œè„šæœ¬\n\t\tif ow.field_map_script\n\t\t\t_.extend(values, uuflowManagerForInitApproval.evalFieldMapScript(ow.field_map_script, objectName, spaceId, recordId))\n\n\t# è¿‡æ»¤æŽ‰valuesä¸­çš„éžæ³•key\n\tfilterValues = {}\n\t_.each _.keys(values), (k) ->\n\t\tif fieldCodes.includes(k)\n\t\t\tfilterValues[k] = values[k]\n\n\treturn filterValues\n\nuuflowManagerForInitApproval.evalFieldMapScript = (field_map_script, objectName, spaceId, objectId) ->\n\t# record = Creator.getCollection(objectName, spaceId).findOne(objectId)\n\trecord = objectFindOne(objectName, { filters: [['_id', '=', objectId]] })\n\tscript = \"module.exports = function (record) { \" + field_map_script + \" }\"\n\tfunc = _eval(script, \"field_map_script\")\n\tvalues = func(record)\n\tif _.isObject values\n\t\treturn values\n\telse\n\t\tconsole.error \"evalFieldMapScript: è„šæœ¬è¿”å›žå€¼ç±»åž‹ä¸æ˜¯å¯¹è±¡\"\n\treturn {}\n\n\n\nuuflowManagerForInitApproval.initiateAttach = (recordIds, spaceId, insId, approveId) ->\n\n\tCreator.Collections['cms_files'].find({\n\t\tspace: spaceId,\n\t\tparent: recordIds\n\t}).forEach (cf) ->\n\t\t_.each cf.versions, (versionId, idx) ->\n\t\t\tf = Creator.Collections['cfs.files.filerecord'].findOne(versionId)\n\t\t\tnewFile = new FS.File()\n\n\t\t\tnewFile.attachData f.createReadStream('files'), {\n\t\t\t\t\ttype: f.original.type\n\t\t\t}, (err) ->\n\t\t\t\tif (err)\n\t\t\t\t\tthrow new Meteor.Error(err.error, err.reason)\n\n\t\t\t\tnewFile.name(f.name())\n\t\t\t\tnewFile.size(f.size())\n\t\t\t\tmetadata = {\n\t\t\t\t\towner: f.metadata.owner,\n\t\t\t\t\towner_name: f.metadata.owner_name,\n\t\t\t\t\tspace: spaceId,\n\t\t\t\t\tinstance: insId,\n\t\t\t\t\tapprove: approveId\n\t\t\t\t\tparent: cf._id\n\t\t\t\t}\n\n\t\t\t\tif idx is 0\n\t\t\t\t\tmetadata.current = true\n\n\t\t\t\tnewFile.metadata = metadata\n\t\t\t\tcfs.instances.insert(newFile)\n\n\treturn\n\nuuflowManagerForInitApproval.initiateRecordInstanceInfo = (recordIds, insId, spaceId) ->\n\t# Creator.getCollection(recordIds.o, spaceId).update(recordIds.ids[0], {\n\t# \t$push: {\n\t# \t\tinstances: {\n\t# \t\t\t$each: [{\n\t# \t\t\t\t_id: insId,\n\t# \t\t\t\tstate: 'draft'\n\t# \t\t\t}],\n\t# \t\t\t$position: 0\n\t# \t\t}\n\t# \t},\n\t# \t$set: {\n\t# \t\tlocked: true\n\t# \t\tinstance_state: 'draft'\n\t# \t}\n\t# })\n\tobjectUpdate(recordIds.o, recordIds.ids[0], {\n\t\tinstances: [{\n\t\t\t_id: insId,\n\t\t\tstate: 'draft'\n\t\t}],\n\t\tlocked: true,\n\t\tinstance_state: 'draft'\n\t})\n\n\treturn\n\n\nuuflowManagerForInitApproval.initiateRelatedRecordInstanceInfo = (relatedTablesInfo, insId, spaceId) ->\n\t_.each relatedTablesInfo, (tableItems, relatedObjectName) ->\n\t\trelatedCollection = Creator.getCollection(relatedObjectName, spaceId)\n\t\t_.each tableItems, (item) ->\n\t\t\trelatedCollection.direct.update(item._table._id, {\n\t\t\t\t$set: {\n\t\t\t\t\tinstances: [{\n\t\t\t\t\t\t_id: insId,\n\t\t\t\t\t\tstate: 'draft'\n\t\t\t\t\t}],\n\t\t\t\t\t_table: item._table\n\t\t\t\t}\n\t\t\t})\n\n\treturn\n\nuuflowManagerForInitApproval.checkIsInApproval = (recordIds, spaceId) ->\n\t# record = Creator.getCollection(recordIds.o, spaceId).findOne({\n\t# \t_id: recordIds.ids[0], instances: { $exists: true }\n\t# }, { fields: { instances: 1 } })\n\trecord = objectFindOne(recordIds.o, { filters: [['_id', '=', recordIds.ids[0]]], fields: ['instances'] })\n\n\tif record and record.instances and record.instances[0].state isnt 'completed' and Creator.Collections.instances.find(record.instances[0]._id).count() > 0\n\t\tthrow new Meteor.Error('error!', \"æ­¤è®°å½•å·²å‘èµ·æµç¨‹æ­£åœ¨å®¡æ‰¹ä¸­ï¼Œå¾…å®¡æ‰¹ç»“æŸæ–¹å¯å‘èµ·ä¸‹ä¸€æ¬¡å®¡æ‰¹ï¼\")\n\n\treturn\n\n\nuuflowManagerForInitApproval.formatDate = (date) ->\n\treturn moment(date).format(\"YYYY-MM-DD\")\n\nuuflowManagerForInitApproval.formatTime = (date) ->\n\treturn moment(date).utcOffset(0).format(\"1970-01-01THH:mm:00.000[Z]\")","var _eval, checkRequiredDetails, getFieldOdataValue, getFileFieldValue, getFormField, getFormTableField, getFormTableFieldCode, getFormTableSubField, getInstanceFieldValue, getObjectConfig, getObjectNameFieldKey, getRelatedObjectFieldCode, getRelateds, getSelectOrgValue, getSelectOrgValues, getSelectUserValue, getSelectUserValues, objectFind, objectFindOne, objectUpdate, objectql;                              \n\n_eval = require('eval');\n\nobjectql = require('@steedos/objectql');\n\ngetObjectConfig = function(objectApiName) {\n  return objectql.getObject(objectApiName).toConfig();\n};\n\ngetObjectNameFieldKey = function(objectApiName) {\n  return objectql.getObject(objectApiName).NAME_FIELD_KEY;\n};\n\ngetRelateds = function(objectApiName) {\n  return Meteor.wrapAsync(function(objectApiName, cb) {\n    return objectql.getObject(objectApiName).getRelateds().then(function(resolve, reject) {\n      return cb(reject, resolve);\n    });\n  })(objectApiName);\n};\n\nobjectFindOne = function(objectApiName, query) {\n  return Meteor.wrapAsync(function(objectApiName, query, cb) {\n    query.top = 1;\n    return objectql.getObject(objectApiName).find(query).then(function(resolve, reject) {\n      if (resolve && resolve.length > 0) {\n        return cb(reject, resolve[0]);\n      } else {\n        return cb(reject, null);\n      }\n    });\n  })(objectApiName, query);\n};\n\nobjectFind = function(objectApiName, query) {\n  return Meteor.wrapAsync(function(objectApiName, query, cb) {\n    return objectql.getObject(objectApiName).find(query).then(function(resolve, reject) {\n      return cb(reject, resolve);\n    });\n  })(objectApiName, query);\n};\n\nobjectUpdate = function(objectApiName, id, data) {\n  return Meteor.wrapAsync(function(objectApiName, id, data, cb) {\n    return objectql.getObject(objectApiName).update(id, data).then(function(resolve, reject) {\n      return cb(reject, resolve);\n    });\n  })(objectApiName, id, data);\n};\n\ngetRelatedObjectFieldCode = function(relatedObjectsKeys, key) {\n  return _.find(relatedObjectsKeys, function(relatedObjectsKey) {\n    return key.startsWith(relatedObjectsKey + '.');\n  });\n};\n\ngetFormTableFieldCode = function(formTableFieldsCode, key) {\n  return _.find(formTableFieldsCode, function(formTableFieldCode) {\n    return key.startsWith(formTableFieldCode + '.');\n  });\n};\n\ngetFormTableField = function(formTableFields, key) {\n  return _.find(formTableFields, function(f) {\n    return f.code === key;\n  });\n};\n\ngetFormField = function(formFields, key) {\n  var ff;\n  ff = null;\n  _.forEach(formFields, function(f) {\n    if (ff) {\n      return;\n    }\n    if (f.type === 'section') {\n      return ff = _.find(f.fields, function(sf) {\n        return sf.code === key;\n      });\n    } else if (f.code === key) {\n      return ff = f;\n    }\n  });\n  return ff;\n};\n\ngetFormTableSubField = function(tableField, subFieldCode) {\n  return _.find(tableField.fields, function(f) {\n    return f.code === subFieldCode;\n  });\n};\n\ngetFieldOdataValue = function(objName, id, referenceToFieldName) {\n  var _record, _records, nameKey, obj;\n  obj = objectql.getObject(objName);\n  nameKey = getObjectNameFieldKey(objName);\n  if (!obj) {\n    return;\n  }\n  if (_.isString(id)) {\n    _record = objectFindOne(objName, {\n      filters: [[referenceToFieldName, '=', id]]\n    });\n    if (_record) {\n      _record['@label'] = _record[nameKey];\n      return _record;\n    }\n  } else if (_.isArray(id)) {\n    _records = [];\n    objectFind(objName, {\n      filters: [[referenceToFieldName, 'in', id]]\n    }).forEach(function(_record) {\n      _record['@label'] = _record[nameKey];\n      return _records.push(_record);\n    });\n    if (!_.isEmpty(_records)) {\n      return _records;\n    }\n  }\n};\n\ngetSelectUserValue = function(userId, spaceId) {\n  var su;\n  su = Creator.getCollection('space_users').findOne({\n    space: spaceId,\n    user: userId\n  });\n  su.id = userId;\n  return su;\n};\n\ngetSelectUserValues = function(userIds, spaceId) {\n  var sus;\n  sus = [];\n  if (_.isArray(userIds)) {\n    _.each(userIds, function(userId) {\n      var su;\n      su = getSelectUserValue(userId, spaceId);\n      if (su) {\n        return sus.push(su);\n      }\n    });\n  }\n  return sus;\n};\n\ngetSelectOrgValue = function(orgId, spaceId) {\n  var org;\n  org = Creator.getCollection('organizations').findOne(orgId, {\n    fields: {\n      _id: 1,\n      name: 1,\n      fullname: 1\n    }\n  });\n  org.id = orgId;\n  return org;\n};\n\ngetSelectOrgValues = function(orgIds, spaceId) {\n  var orgs;\n  orgs = [];\n  if (_.isArray(orgIds)) {\n    _.each(orgIds, function(orgId) {\n      var org;\n      org = getSelectOrgValue(orgId, spaceId);\n      if (org) {\n        return orgs.push(org);\n      }\n    });\n  }\n  return orgs;\n};\n\ngetFileFieldValue = function(recordFieldId, fType) {\n  var collection, files, query, value;\n  if (_.isEmpty(recordFieldId)) {\n    return;\n  }\n  if (fType === 'image') {\n    collection = 'images';\n  } else if (fType === 'file') {\n    collection = 'files';\n  }\n  if (_.isString(recordFieldId)) {\n    query = {\n      _id: {\n        $in: [recordFieldId]\n      }\n    };\n  } else {\n    query = {\n      _id: {\n        $in: recordFieldId\n      }\n    };\n  }\n  files = Creator.Collections[\"cfs.\" + collection + \".filerecord\"].find(query);\n  value = [];\n  files.forEach(function(f) {\n    var newFile;\n    newFile = new FS.File();\n    return newFile.attachData(f.createReadStream('files'), {\n      type: f.original.type\n    }, function(err) {\n      var metadata;\n      if (err) {\n        throw new Meteor.Error(err.error, err.reason);\n      }\n      newFile.name(f.name());\n      newFile.size(f.size());\n      metadata = {\n        owner: f.metadata.owner\n      };\n      newFile.metadata = metadata;\n      newFile._id = Creator.Collections.instances._makeNewID();\n      cfs[collection].insert(newFile);\n      return value.push(newFile._id);\n    });\n  });\n  if (value.length > 0) {\n    if (_.isString(recordFieldId)) {\n      return value[0];\n    } else {\n      return value;\n    }\n  }\n};\n\ngetInstanceFieldValue = function(objField, formField, record, object_field, spaceId, recordFieldValue, enableAmisform) {\n  var odataFieldValue, referenceToFieldName, referenceToObjectName, selectFieldValue, value;\n  if (enableAmisform && formField.steedos_field) {\n    return recordFieldValue;\n  }\n  recordFieldValue = record[objField.name];\n  value;\n  if (formField && objField && formField.type === 'odata' && ['lookup', 'master_detail'].includes(objField.type) && _.isString(objField.reference_to)) {\n    referenceToFieldName = objField.reference_to_field || '_id';\n    referenceToObjectName = objField.reference_to;\n    odataFieldValue;\n    if (objField.multiple && formField.is_multiselect) {\n      odataFieldValue = getFieldOdataValue(referenceToObjectName, recordFieldValue, referenceToFieldName);\n    } else if (!objField.multiple && !formField.is_multiselect) {\n      odataFieldValue = getFieldOdataValue(referenceToObjectName, recordFieldValue, referenceToFieldName);\n    }\n    value = odataFieldValue;\n  } else if (formField && objField && ['user', 'group'].includes(formField.type) && ['lookup', 'master_detail'].includes(objField.type) && (['users', 'organizations'].includes(objField.reference_to) || ('space_users' === objField.reference_to && 'user' === objField.reference_to_field))) {\n    if (!_.isEmpty(recordFieldValue)) {\n      selectFieldValue;\n      if (formField.type === 'user') {\n        if (objField.multiple && formField.is_multiselect) {\n          selectFieldValue = getSelectUserValues(recordFieldValue, spaceId);\n        } else if (!objField.multiple && !formField.is_multiselect) {\n          selectFieldValue = getSelectUserValue(recordFieldValue, spaceId);\n        }\n      } else if (formField.type === 'group') {\n        if (objField.multiple && formField.is_multiselect) {\n          selectFieldValue = getSelectOrgValues(recordFieldValue, spaceId);\n        } else if (!objField.multiple && !formField.is_multiselect) {\n          selectFieldValue = getSelectOrgValue(recordFieldValue, spaceId);\n        }\n      }\n      if (selectFieldValue) {\n        value = selectFieldValue;\n      }\n    }\n  } else if (formField && objField && formField.type === 'date' && recordFieldValue) {\n    value = uuflowManagerForInitApproval.formatDate(recordFieldValue);\n  } else if (formField && objField && formField.type === 'time' && recordFieldValue) {\n    value = uuflowManagerForInitApproval.formatTime(recordFieldValue);\n  } else if (formField && objField && recordFieldValue && (formField.type === 'image' || formField.type === 'file')) {\n    value = getFileFieldValue(recordFieldValue, formField.type);\n  } else if (formField && objField && recordFieldValue && formField.type === 'lookup' && ['lookup', 'master_detail'].includes(objField.type) && _.isString(objField.reference_to)) {\n    value = recordFieldValue;\n  } else if (formField && objField && recordFieldValue && (formField.type === 'multiSelect')) {\n    value = recordFieldValue.join(',');\n  } else if (record.hasOwnProperty(object_field)) {\n    value = recordFieldValue;\n  }\n  return value;\n};\n\ncheckRequiredDetails = function(requiredDetails, masterRecord) {\n  if (!_.isEmpty(requiredDetails)) {\n    requiredDetails.forEach(function(rd) {\n      var masterField, masterFieldValue, refId, subObjConfig, subTableMasterField, subTableName, subTableRecord;\n      subTableName = rd.split('.')[0];\n      subTableMasterField = rd.split('.')[1];\n      subObjConfig = getObjectConfig(subTableName);\n      masterField = subObjConfig.fields[subTableMasterField];\n      refId = masterField.reference_to_field || '_id';\n      masterFieldValue = masterRecord[refId];\n      subTableRecord = objectFindOne(subTableName, {\n        filters: [[subTableMasterField, '=', masterFieldValue]],\n        fields: [subTableMasterField]\n      });\n      if (!subTableRecord) {\n        throw new Error(\"è¯·å…ˆæ–°å¢ž\" + subObjConfig.label);\n      }\n    });\n  }\n};\n\nuuflowManagerForInitApproval = {};\n\nuuflowManagerForInitApproval.check_authorization = function(req) {\n  var authToken, hashedToken, query, user, userId;\n  query = req.query;\n  userId = query[\"X-User-Id\"];\n  authToken = query[\"X-Auth-Token\"];\n  if (!userId || !authToken) {\n    throw new Meteor.Error(401, 'Unauthorized');\n  }\n  hashedToken = Accounts._hashLoginToken(authToken);\n  user = Meteor.users.findOne({\n    _id: userId,\n    \"services.resume.loginTokens.hashedToken\": hashedToken\n  });\n  if (!user) {\n    throw new Meteor.Error(401, 'Unauthorized');\n  }\n  return user;\n};\n\nuuflowManagerForInitApproval.getSpace = function(space_id) {\n  var space;\n  space = Creator.Collections.spaces.findOne(space_id);\n  if (!space) {\n    throw new Meteor.Error('error!', \"space_idæœ‰è¯¯æˆ–æ­¤spaceå·²ç»è¢«åˆ é™¤\");\n  }\n  return space;\n};\n\nuuflowManagerForInitApproval.getFlow = function(flow_id) {\n  var flow;\n  flow = Creator.Collections.flows.findOne(flow_id);\n  if (!flow) {\n    throw new Meteor.Error('error!', \"idæœ‰è¯¯æˆ–æ­¤æµç¨‹å·²ç»è¢«åˆ é™¤\");\n  }\n  return flow;\n};\n\nuuflowManagerForInitApproval.getSpaceUser = function(space_id, user_id) {\n  var space_user;\n  space_user = Creator.Collections.space_users.findOne({\n    space: space_id,\n    user: user_id\n  });\n  if (!space_user) {\n    throw new Meteor.Error('error!', \"user_idå¯¹åº”çš„ç”¨æˆ·ä¸å±žäºŽå½“å‰space\");\n  }\n  return space_user;\n};\n\nuuflowManagerForInitApproval.getSpaceUserOrgInfo = function(space_user) {\n  var info, org;\n  info = new Object;\n  info.organization = space_user.organization;\n  org = Creator.Collections.organizations.findOne(space_user.organization, {\n    fields: {\n      name: 1,\n      fullname: 1\n    }\n  });\n  info.organization_name = org.name;\n  info.organization_fullname = org.fullname;\n  return info;\n};\n\nuuflowManagerForInitApproval.isFlowEnabled = function(flow) {\n  if (flow.state !== \"enabled\") {\n    throw new Meteor.Error('error!', \"æµç¨‹æœªå¯ç”¨,æ“ä½œå¤±è´¥\");\n  }\n};\n\nuuflowManagerForInitApproval.isFlowSpaceMatched = function(flow, space_id) {\n  if (flow.space !== space_id) {\n    throw new Meteor.Error('error!', \"æµç¨‹å’Œå·¥ä½œåŒºIDä¸åŒ¹é…\");\n  }\n};\n\nuuflowManagerForInitApproval.getForm = function(form_id) {\n  var form;\n  form = Creator.Collections.forms.findOne(form_id);\n  if (!form) {\n    throw new Meteor.Error('error!', 'è¡¨å•IDæœ‰è¯¯æˆ–æ­¤è¡¨å•å·²ç»è¢«åˆ é™¤');\n  }\n  return form;\n};\n\nuuflowManagerForInitApproval.getCategory = function(category_id) {\n  return Creator.Collections.categories.findOne(category_id);\n};\n\nuuflowManagerForInitApproval.checkSyncDirection = function(object_name, flow_id) {\n  var ow, syncDirection;\n  ow = Creator.Collections.object_workflows.findOne({\n    object_name: object_name,\n    flow_id: flow_id\n  });\n  if (!ow) {\n    throw new Meteor.Error('error!', 'æœªæ‰¾åˆ°å¯¹è±¡æµç¨‹æ˜ å°„è®°å½•ã€‚');\n  }\n  syncDirection = ow.sync_direction || 'both';\n  if (!['both', 'obj_to_ins'].includes(syncDirection)) {\n    throw new Meteor.Error('error!', 'ä¸æ”¯æŒçš„åŒæ­¥æ–¹å‘ã€‚');\n  }\n};\n\nuuflowManagerForInitApproval.create_instance = function(instance_from_client, user_info) {\n  var appr_obj, approve_from_client, category, flow, flow_id, form, ins_obj, new_ins_id, now, permissions, relatedTablesInfo, space, space_id, space_user, space_user_org_info, start_step, trace_from_client, trace_obj, user_id;\n  check(instance_from_client[\"applicant\"], String);\n  check(instance_from_client[\"space\"], String);\n  check(instance_from_client[\"flow\"], String);\n  check(instance_from_client[\"record_ids\"], [\n    {\n      o: String,\n      ids: [String]\n    }\n  ]);\n  uuflowManagerForInitApproval.checkSyncDirection(instance_from_client[\"record_ids\"][0].o, instance_from_client[\"flow\"]);\n  uuflowManagerForInitApproval.checkIsInApproval(instance_from_client[\"record_ids\"][0], instance_from_client[\"space\"]);\n  space_id = instance_from_client[\"space\"];\n  flow_id = instance_from_client[\"flow\"];\n  user_id = user_info._id;\n  trace_from_client = null;\n  approve_from_client = null;\n  if (instance_from_client[\"traces\"] && instance_from_client[\"traces\"][0]) {\n    trace_from_client = instance_from_client[\"traces\"][0];\n    if (trace_from_client[\"approves\"] && trace_from_client[\"approves\"][0]) {\n      approve_from_client = instance_from_client[\"traces\"][0][\"approves\"][0];\n    }\n  }\n  space = uuflowManagerForInitApproval.getSpace(space_id);\n  flow = uuflowManagerForInitApproval.getFlow(flow_id);\n  space_user = uuflowManagerForInitApproval.getSpaceUser(space_id, user_id);\n  space_user_org_info = uuflowManagerForInitApproval.getSpaceUserOrgInfo(space_user);\n  uuflowManagerForInitApproval.isFlowEnabled(flow);\n  uuflowManagerForInitApproval.isFlowSpaceMatched(flow, space_id);\n  form = uuflowManagerForInitApproval.getForm(flow.form);\n  permissions = permissionManager.getFlowPermissions(flow_id, user_id);\n  if (!permissions.includes(\"add\")) {\n    throw new Meteor.Error('error!', \"å½“å‰ç”¨æˆ·æ²¡æœ‰æ­¤æµç¨‹çš„æ–°å»ºæƒé™\");\n  }\n  now = new Date;\n  ins_obj = {};\n  ins_obj._id = Creator.Collections.instances._makeNewID();\n  ins_obj.space = space_id;\n  ins_obj.flow = flow_id;\n  ins_obj.flow_version = flow.current._id;\n  ins_obj.form = flow.form;\n  ins_obj.form_version = flow.current.form_version;\n  ins_obj.name = flow.name;\n  ins_obj.submitter = user_id;\n  ins_obj.submitter_name = user_info.name;\n  ins_obj.applicant = instance_from_client[\"applicant\"] ? instance_from_client[\"applicant\"] : user_id;\n  ins_obj.applicant_name = instance_from_client[\"applicant_name\"] ? instance_from_client[\"applicant_name\"] : user_info.name;\n  ins_obj.applicant_organization = instance_from_client[\"applicant_organization\"] ? instance_from_client[\"applicant_organization\"] : space_user.organization;\n  ins_obj.applicant_organization_name = instance_from_client[\"applicant_organization_name\"] ? instance_from_client[\"applicant_organization_name\"] : space_user_org_info.organization_name;\n  ins_obj.applicant_organization_fullname = instance_from_client[\"applicant_organization_fullname\"] ? instance_from_client[\"applicant_organization_fullname\"] : space_user_org_info.organization_fullname;\n  ins_obj.applicant_company = instance_from_client[\"applicant_company\"] ? instance_from_client[\"applicant_company\"] : space_user.company_id;\n  ins_obj.state = 'draft';\n  ins_obj.code = '';\n  ins_obj.is_archived = false;\n  ins_obj.is_deleted = false;\n  ins_obj.created = now;\n  ins_obj.created_by = user_id;\n  ins_obj.modified = now;\n  ins_obj.modified_by = user_id;\n  ins_obj.record_ids = instance_from_client[\"record_ids\"];\n  if (space_user.company_id) {\n    ins_obj.company_id = space_user.company_id;\n  }\n  trace_obj = {};\n  trace_obj._id = new Mongo.ObjectID()._str;\n  trace_obj.instance = ins_obj._id;\n  trace_obj.is_finished = false;\n  start_step = _.find(flow.current.steps, function(step) {\n    return step.step_type === 'start';\n  });\n  trace_obj.step = start_step._id;\n  trace_obj.name = start_step.name;\n  trace_obj.start_date = now;\n  appr_obj = {};\n  appr_obj._id = new Mongo.ObjectID()._str;\n  appr_obj.instance = ins_obj._id;\n  appr_obj.trace = trace_obj._id;\n  appr_obj.is_finished = false;\n  appr_obj.user = instance_from_client[\"applicant\"] ? instance_from_client[\"applicant\"] : user_id;\n  appr_obj.user_name = instance_from_client[\"applicant_name\"] ? instance_from_client[\"applicant_name\"] : user_info.name;\n  appr_obj.handler = user_id;\n  appr_obj.handler_name = user_info.name;\n  appr_obj.handler_organization = space_user.organization;\n  appr_obj.handler_organization_name = space_user_org_info.name;\n  appr_obj.handler_organization_fullname = space_user_org_info.fullname;\n  appr_obj.type = 'draft';\n  appr_obj.start_date = now;\n  appr_obj.read_date = now;\n  appr_obj.is_read = true;\n  appr_obj.is_error = false;\n  appr_obj.description = '';\n  relatedTablesInfo = {};\n  appr_obj.values = uuflowManagerForInitApproval.initiateValues(ins_obj.record_ids[0], flow_id, space_id, form.current.fields, relatedTablesInfo);\n  trace_obj.approves = [appr_obj];\n  ins_obj.traces = [trace_obj];\n  ins_obj.values = appr_obj.values;\n  ins_obj.inbox_users = instance_from_client.inbox_users || [];\n  ins_obj.current_step_name = start_step.name;\n  if (flow.auto_remind === true) {\n    ins_obj.auto_remind = true;\n  }\n  ins_obj.flow_name = flow.name;\n  if (form.category) {\n    category = uuflowManagerForInitApproval.getCategory(form.category);\n    if (category) {\n      ins_obj.category_name = category.name;\n      ins_obj.category = category._id;\n    }\n  }\n  new_ins_id = Creator.Collections.instances.insert(ins_obj);\n  uuflowManagerForInitApproval.initiateRecordInstanceInfo(ins_obj.record_ids[0], new_ins_id, space_id);\n  uuflowManagerForInitApproval.initiateAttach(ins_obj.record_ids[0], space_id, ins_obj._id, appr_obj._id);\n  return new_ins_id;\n};\n\nuuflowManagerForInitApproval.initiateValues = function(recordIds, flowId, spaceId, fields, relatedTablesInfo) {\n  var enableAmisform, fieldCodes, filterValues, flow, form, formFields, formTableFields, formTableFieldsCode, object, objectName, ow, record, recordId, ref, relatedObjects, relatedObjectsKeys, requiredDetails, tableFieldCodes, tableFieldMap, tableToRelatedMap, values;\n  fieldCodes = [];\n  _.each(fields, function(f) {\n    if (f.type === 'section') {\n      return _.each(f.fields, function(ff) {\n        return fieldCodes.push(ff.code);\n      });\n    } else {\n      return fieldCodes.push(f.code);\n    }\n  });\n  values = {};\n  objectName = recordIds.o;\n  object = getObjectConfig(objectName);\n  recordId = recordIds.ids[0];\n  ow = Creator.Collections.object_workflows.findOne({\n    object_name: objectName,\n    flow_id: flowId\n  });\n  record = objectFindOne(objectName, {\n    filters: [['_id', '=', recordId]]\n  });\n  flow = Creator.getCollection('flows').findOne(flowId, {\n    fields: {\n      form: 1,\n      enableAmisform: 1\n    }\n  });\n  enableAmisform = flow.enable_amisform;\n  if (ow && record) {\n    requiredDetails = ow.required_details || [];\n    checkRequiredDetails(requiredDetails, record);\n    form = Creator.getCollection(\"forms\").findOne(flow.form);\n    formFields = form.current.fields || [];\n    relatedObjects = getRelateds(objectName);\n    relatedObjectsKeys = _.pluck(relatedObjects, 'object_name');\n    formTableFields = _.filter(formFields, function(formField) {\n      return formField.type === 'table';\n    });\n    formTableFieldsCode = _.pluck(formTableFields, 'code');\n    tableFieldCodes = [];\n    tableFieldMap = [];\n    tableToRelatedMap = {};\n    if ((ref = ow.field_map) != null) {\n      ref.forEach(function(fm) {\n        var formField, formTableFieldCode, gridCode, lookupFieldName, lookupFieldObj, lookupObjectRecord, oTableCode, oTableCodeReferenceField, oTableCodeReferenceFieldCode, oTableFieldCode, objField, objectField, objectFieldName, objectFieldObjectName, objectLookupField, object_field, recordFieldValue, referenceToDoc, referenceToFieldName, referenceToFieldValue, referenceToObjectName, relatedObjectFieldCode, tableToRelatedMapKey, wTableCode, workflow_field;\n        object_field = fm.object_field;\n        workflow_field = fm.workflow_field;\n        if (!object_field || !workflow_field) {\n          throw new Meteor.Error(400, 'æœªæ‰¾åˆ°å­—æ®µï¼Œè¯·æ£€æŸ¥å¯¹è±¡æµç¨‹æ˜ å°„å­—æ®µé…ç½®');\n        }\n        relatedObjectFieldCode = getRelatedObjectFieldCode(relatedObjectsKeys, object_field);\n        formTableFieldCode = getFormTableFieldCode(formTableFieldsCode, workflow_field);\n        objField = object.fields[object_field];\n        formField = getFormField(formFields, workflow_field);\n        recordFieldValue = record[object_field];\n        if (relatedObjectFieldCode) {\n          oTableCode = object_field.split('.')[0];\n          oTableFieldCode = object_field.split('.')[1];\n          tableToRelatedMapKey = oTableCode;\n          if (!tableToRelatedMap[tableToRelatedMapKey]) {\n            tableToRelatedMap[tableToRelatedMapKey] = {};\n          }\n          if (formTableFieldCode) {\n            wTableCode = workflow_field.split('.')[0];\n            tableToRelatedMap[tableToRelatedMapKey]['_FROM_TABLE_CODE'] = wTableCode;\n          }\n          return tableToRelatedMap[tableToRelatedMapKey][oTableFieldCode] = workflow_field;\n        } else if (workflow_field.indexOf('.') > 0 && object_field.indexOf('.$.') > 0) {\n          wTableCode = workflow_field.split('.')[0];\n          oTableCode = object_field.split('.$.')[0](ref1.table1.$.name);\n          if (record.hasOwnProperty(oTableCode) && _.isArray(record[oTableCode])) {\n            tableFieldCodes.push(JSON.stringify({\n              workflow_table_field_code: wTableCode,\n              object_table_field_code: oTableCode\n            }));\n            return tableFieldMap.push(fm);\n          } else if (oTableCode.indexOf('.') > 0) {\n            oTableCodeReferenceFieldCode = oTableCode.split('.')[0];\n            gridCode = oTableCode.split('.')[1];\n            oTableCodeReferenceField = object.fields[oTableCodeReferenceFieldCode];\n            if (oTableCodeReferenceField && ['lookup', 'master_detail'].includes(oTableCodeReferenceField.type) && _.isString(oTableCodeReferenceField.reference_to)) {\n              if (record[oTableCode]) {\n                return;\n              }\n              referenceToFieldName = oTableCodeReferenceField.reference_to_field || '_id';\n              referenceToObjectName = oTableCodeReferenceField.reference_to;\n              referenceToFieldValue = record[oTableCodeReferenceField.name];\n              referenceToDoc = getFieldOdataValue(referenceToObjectName, referenceToFieldValue, referenceToFieldName);\n              if (referenceToDoc[gridCode]) {\n                record[oTableCode] = referenceToDoc[gridCode];\n                tableFieldCodes.push(JSON.stringify({\n                  workflow_table_field_code: wTableCode,\n                  object_table_field_code: oTableCode\n                }));\n                return tableFieldMap.push(fm);\n              }\n            }\n          }\n        } else if (object_field.indexOf('.') > 0 && object_field.indexOf('.$.') === -1) {\n          objectFieldName = object_field.split('.')[0];\n          lookupFieldName = object_field.split('.')[1];\n          if (object) {\n            objectField = object.fields[objectFieldName];\n            if (objectField && formField && ['lookup', 'master_detail'].includes(objectField.type) && _.isString(objectField.reference_to)) {\n              lookupObjectRecord = objectFindOne(objectField.reference_to, {\n                filters: [['_id', '=', record[objectFieldName]]],\n                fields: [lookupFieldName]\n              });\n              if (!lookupObjectRecord) {\n                return;\n              }\n              objectFieldObjectName = objectField.reference_to;\n              lookupFieldObj = getObjectConfig(objectFieldObjectName);\n              objectLookupField = lookupFieldObj.fields[lookupFieldName];\n              return values[workflow_field] = getInstanceFieldValue(objectLookupField, formField, lookupObjectRecord, lookupFieldName, spaceId, record[lookupFieldName], enableAmisform);\n            }\n          }\n        } else {\n          return values[workflow_field] = getInstanceFieldValue(objField, formField, record, object_field, spaceId, record[object_field], enableAmisform);\n        }\n      });\n    }\n    _.uniq(tableFieldCodes).forEach(function(tfc) {\n      var c;\n      c = JSON.parse(tfc);\n      values[c.workflow_table_field_code] = [];\n      return record[c.object_table_field_code].forEach(function(tr) {\n        var newTr;\n        newTr = {};\n        _.each(tr, function(tdValue, k) {\n          return tableFieldMap.forEach(function(tfm) {\n            var wTdCode;\n            if (tfm.object_field === (c.object_table_field_code + '.$.' + k)) {\n              wTdCode = tfm.workflow_field.split('.')[1];\n              return newTr[wTdCode] = tdValue;\n            }\n          });\n        });\n        if (!_.isEmpty(newTr)) {\n          return values[c.workflow_table_field_code].push(newTr);\n        }\n      });\n    });\n    _.each(tableToRelatedMap, function(map, key) {\n      var formTableField, relatedField, relatedFieldName, relatedObject, relatedObjectName, relatedRecords, relatedTableItems, tableCode, tableValues;\n      tableCode = map._FROM_TABLE_CODE;\n      formTableField = getFormTableField(formTableFields, tableCode);\n      if (!tableCode) {\n        return console.warn('tableToRelated: [' + key + '] missing corresponding table.');\n      } else {\n        relatedObjectName = key;\n        tableValues = [];\n        relatedTableItems = [];\n        relatedObject = getObjectConfig(relatedObjectName);\n        relatedField = _.find(relatedObject.fields, function(f) {\n          return ['lookup', 'master_detail'].includes(f.type) && f.reference_to === objectName;\n        });\n        relatedFieldName = relatedField.name;\n        relatedRecords = objectFind(relatedObjectName, {\n          filters: [[relatedFieldName, '=', recordId]]\n        });\n        relatedRecords.forEach(function(relatedRecord) {\n          var tableValueItem;\n          tableValueItem = {};\n          _.each(map, function(valueKey, fieldKey) {\n            var formField, formFieldKey, relatedObjectField, tableFieldValue;\n            if (fieldKey !== '_FROM_TABLE_CODE') {\n              tableFieldValue;\n              formFieldKey;\n              if (valueKey.startsWith(tableCode + '.')) {\n                formFieldKey = (valueKey.split(\".\")[1]);\n              } else {\n                formFieldKey = valueKey;\n              }\n              formField = getFormTableSubField(formTableField, formFieldKey);\n              relatedObjectField = relatedObject.fields[fieldKey];\n              if (!formField || !relatedObjectField) {\n                return;\n              }\n              tableFieldValue = getInstanceFieldValue(relatedObjectField, formField, relatedRecord, fieldKey, spaceId, relatedRecord[fieldKey], enableAmisform);\n              return tableValueItem[formFieldKey] = tableFieldValue;\n            }\n          });\n          if (!_.isEmpty(tableValueItem)) {\n            tableValueItem._id = relatedRecord._id;\n            tableValues.push(tableValueItem);\n            return relatedTableItems.push({\n              _table: {\n                _id: relatedRecord._id,\n                _code: tableCode\n              }\n            });\n          }\n        });\n        values[tableCode] = tableValues;\n        return relatedTablesInfo[relatedObjectName] = relatedTableItems;\n      }\n    });\n    if (ow.field_map_script) {\n      _.extend(values, uuflowManagerForInitApproval.evalFieldMapScript(ow.field_map_script, objectName, spaceId, recordId));\n    }\n  }\n  filterValues = {};\n  _.each(_.keys(values), function(k) {\n    if (fieldCodes.includes(k)) {\n      return filterValues[k] = values[k];\n    }\n  });\n  return filterValues;\n};\n\nuuflowManagerForInitApproval.evalFieldMapScript = function(field_map_script, objectName, spaceId, objectId) {\n  var func, record, script, values;\n  record = objectFindOne(objectName, {\n    filters: [['_id', '=', objectId]]\n  });\n  script = \"module.exports = function (record) { \" + field_map_script + \" }\";\n  func = _eval(script, \"field_map_script\");\n  values = func(record);\n  if (_.isObject(values)) {\n    return values;\n  } else {\n    console.error(\"evalFieldMapScript: è„šæœ¬è¿”å›žå€¼ç±»åž‹ä¸æ˜¯å¯¹è±¡\");\n  }\n  return {};\n};\n\nuuflowManagerForInitApproval.initiateAttach = function(recordIds, spaceId, insId, approveId) {\n  Creator.Collections['cms_files'].find({\n    space: spaceId,\n    parent: recordIds\n  }).forEach(function(cf) {\n    return _.each(cf.versions, function(versionId, idx) {\n      var f, newFile;\n      f = Creator.Collections['cfs.files.filerecord'].findOne(versionId);\n      newFile = new FS.File();\n      return newFile.attachData(f.createReadStream('files'), {\n        type: f.original.type\n      }, function(err) {\n        var metadata;\n        if (err) {\n          throw new Meteor.Error(err.error, err.reason);\n        }\n        newFile.name(f.name());\n        newFile.size(f.size());\n        metadata = {\n          owner: f.metadata.owner,\n          owner_name: f.metadata.owner_name,\n          space: spaceId,\n          instance: insId,\n          approve: approveId,\n          parent: cf._id\n        };\n        if (idx === 0) {\n          metadata.current = true;\n        }\n        newFile.metadata = metadata;\n        return cfs.instances.insert(newFile);\n      });\n    });\n  });\n};\n\nuuflowManagerForInitApproval.initiateRecordInstanceInfo = function(recordIds, insId, spaceId) {\n  objectUpdate(recordIds.o, recordIds.ids[0], {\n    instances: [\n      {\n        _id: insId,\n        state: 'draft'\n      }\n    ],\n    locked: true,\n    instance_state: 'draft'\n  });\n};\n\nuuflowManagerForInitApproval.initiateRelatedRecordInstanceInfo = function(relatedTablesInfo, insId, spaceId) {\n  _.each(relatedTablesInfo, function(tableItems, relatedObjectName) {\n    var relatedCollection;\n    relatedCollection = Creator.getCollection(relatedObjectName, spaceId);\n    return _.each(tableItems, function(item) {\n      return relatedCollection.direct.update(item._table._id, {\n        $set: {\n          instances: [\n            {\n              _id: insId,\n              state: 'draft'\n            }\n          ],\n          _table: item._table\n        }\n      });\n    });\n  });\n};\n\nuuflowManagerForInitApproval.checkIsInApproval = function(recordIds, spaceId) {\n  var record;\n  record = objectFindOne(recordIds.o, {\n    filters: [['_id', '=', recordIds.ids[0]]],\n    fields: ['instances']\n  });\n  if (record && record.instances && record.instances[0].state !== 'completed' && Creator.Collections.instances.find(record.instances[0]._id).count() > 0) {\n    throw new Meteor.Error('error!', \"æ­¤è®°å½•å·²å‘èµ·æµç¨‹æ­£åœ¨å®¡æ‰¹ä¸­ï¼Œå¾…å®¡æ‰¹ç»“æŸæ–¹å¯å‘èµ·ä¸‹ä¸€æ¬¡å®¡æ‰¹ï¼\");\n  }\n};\n\nuuflowManagerForInitApproval.formatDate = function(date) {\n  return moment(date).format(\"YYYY-MM-DD\");\n};\n\nuuflowManagerForInitApproval.formatTime = function(date) {\n  return moment(date).utcOffset(0).format(\"1970-01-01THH:mm:00.000[Z]\");\n};\n"]}