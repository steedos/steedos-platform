name: object_listviews
label: List View
icon: forecasts
version: 2
enable_dataloader: false
hidden: true
fields:
  label:
    label: Label
    type: text
    is_name: true
    required: true
  name:
    label: API Name
    type: text
    searchable: true
    index: true
    inlineHelpText: Can only contain lowercase letters and numbers, must start with a letter, cannot end with an underscore character or contain two consecutive underscore characters
    amis:
      requiredOn: "${!!recordId}" #编辑记录时必填，新建记录时不必填走触发器给默认值
  object_name:
    label: Object
    type: master_detail
    write_requires_master_read: true
    required: true
    reference_to: objects
    reference_to_field: name
  filter_scope:
    label: Filter Scope
    type: select
    defaultValue: space
    required: true
    options:
      - label: 我的
        value: mine
      - label: 工作区
        value: space 
  shared:
    label: Shared to All Users
    type: boolean
  show_count:
    label: Show Record Count
    type: boolean
  type:
    label: Type
    type: select
    options: 
      - label: Grid
        value: grid
      - label: Calendar
        value: calendar
    defaultValue: '"grid"'
    hidden: true
  scrolling_mode:
    label: Scrolling Mode
    inlineHelpText: Define the scroll bar display style for the data list.
    type: select
    options: 
      - label: Standard ( Click the page number to load the data of the corresponding page. )
        value: standard
      - label: Virtual ( Switch the page through the scroll bar. When you scroll to the corresponding page, the data will be loaded remotely. )
        value: virtual
      - label: Infinite ( Initially, only the first page will be loaded, and the next page will be loaded while scrolling. )
        value: infinite
    defaultValue: '"standard"'
    hidden: true
  sort_no:
    label: Sort no
    type: number
    scale: 0
    defaultValue: 100
  is_enable:
    type: toggle
    label: Enable
    defaultValue: true
  crud_mode:
    label: 显示模式
    type: select
    options:
      - label: 表格
        value: table
      - label: 卡片
        value: cards
    defaultValue: table
  columns:
    label: Columns
    type: table
    is_wide: true
    required: true
    group: show_columns
    amis:
      columns:
        - field
        - name: width
          width: 100
        - name: wrap
          width: 100
  columns.$:
    label: Column
    blackbox: true
    type: object
  columns.$.field:
    label: Field
    type: lookup
    multiple: false
    is_wide: false
    required: true
    depend_on:
      - object_name
    reference_to: object_fields
    reference_to_field: name
    enable_enhanced_lookup: false
    filtersFunction: !<tag:yaml.org,2002:js/function> |-
      function(filters, values){
        return ['object', '=', values.object_name]
      }
  columns.$.width:
    label: Width
    type: text
  columns.$.wrap:
    label: Wrap
    type: boolean
  filter_fields:
    label: Default Filter Fields
    type: lookup
    multiple: true
    is_wide: true
    hidden: true
    depend_on:
      - object_name
    reference_to: object_fields
    reference_to_field: name
  sort:
    label: Default Sort Order
    type: grid
    is_wide: true
    depend_on:
      - object_name
    group: sort
  sort.$:
    label: Order
    blackbox: true
    type: object
  sort.$.field_name:
    label: Field Name
    type: lookup
    reference_to: object_fields
    reference_to_field: name
  sort.$.order:
    label: Sort Order
    type: select
    defaultValue: asc
    options:
      - label: ASC
        value: asc
      - label: DESC
        value: desc
  filters:
    label: Filters
    type: code
    is_wide: true
    hidden: false
    readonly: false
    depend_on:
      - object_name
    group: filters
  # filters.$:
  #   label: Filter
  #   blackbox: true
  # filters.$.field:
  #   label: Field
  #   type: lookup
  #   showIcon: false
  #   optionsFunction: !!js/function |
  #     function(values){
  #       if(values.object_name){
  #         return Creator.getObjectFilterFieldOptions(values.object_name)
  #       }
  #       return []
  #     }
  # filters.$.operation:
  #   label: Operator
  #   type: lookup
  #   showIcon: false
  #   optionsFunction: !!js/function |
  #     function(values){
  #       if(values.object_name){
  #         if(!this.template){
  #           let options = Creator.getFieldOperation();
  #           Creator.pushBetweenBuiltinOptionals('date', options);
  #           return options;
  #         }
          
  #         const filter = _.find(values.filters, function (item) {
  #           return item._id === values._grid_row_id
  #         })

  #         if(filter){
  #           var field = filter.field;
  #           if(field){
  #             var object_fields = Creator.getObject(values.object_name).fields
  #             var filter_field_type;
  #             if(object_fields[field]){
  #               filter_field_type = object_fields[field].type
  #               return Creator.getFieldOperation(filter_field_type);
  #             }
  #           }
  #         }
  #       }
  #       return [];
  #     }
  # filters.$.value:
  #   label: Value
  #   blackbox: true
  filter_logic:
    label: Logic
    type: text
    readonly: true
    hidden: true
    visible_on: "{{global.mode ==='read' ? true : false}}"
  mobile_columns:
    label: Mobile Columns
    type: table
    is_wide: true
    depend_on:
      - object_name
    group: show_columns
  mobile_columns.$:
    label: Column
    blackbox: true
    type: object
  mobile_columns.$.field:
    label: Field
    type: lookup
    multiple: false
    is_wide: false
    required: true
    depend_on:
      - object_name
    reference_to: object_fields
    reference_to_field: name
    enable_enhanced_lookup: false
    filtersFunction: !<tag:yaml.org,2002:js/function> |-
      function(filters, values){
        return ['object', '=', values.object_name]
      }
  searchable_fields:
    label: Searchable Fields
    type: grid
    is_wide: true
    depend_on:
      - object_name
    group: search_term
  searchable_fields.$:
    label: Column
    blackbox: true
    type: object
  searchable_fields.$.field:
    label: Field
    type: lookup
    multiple: false
    is_wide: false
    reference_to: object_fields
    reference_to_field: name
  is_system:
    type: boolean
    label: System
    # omit: true
    readonly: true
    visible_on: "{{global.mode ==='read' ? true : false}}"
    disabled: true
  enable_amis_schema: 
    label: Enable amis_schema
    type: boolean
    group: advanced
    required: false
  amis_schema: 
    label: Amis Schema
    type: code
    group: advanced
    language: json
    required: false
    is_wide: true
    # visible_on: "{{formData.enable_amis_schema}}"
    visible_on: "{{false}}"
  requestAdaptor:
    label: Request Adaptor
    type: code
    language: "javascript"
    is_wide: true
    inlineHelpText: "函数签名：(api) => api， 数据在 api.data 中，修改后返回 api 对象。"
    group: data_interface
    # amis: 
    #   description: "函数签名：(api) => api， 数据在 api.data 中，修改后返回 api 对象。"
  adaptor:
    label: Adaptor
    type: code
    language: "javascript"
    is_wide: true
    inlineHelpText: "函数签名: (payload, response, api) => payload"
    group: data_interface
    # amis: 
    #   description: "函数签名: (payload, response, api) => payload"
    
paging:
  enabled: false
list_views:
  all:
    columns:
      - label
      - name
      - shared
      - owner
      - modified
      - is_enable
      - is_system
    label: All List Views
    filter_scope: space
  customize:
    columns:
      - label
      - name
      - shared
      - owner
      - modified
      - is_system
    label: 自定义
    filters:
      - ["is_system","<>",true]
    filter_scope: space
actions:
  customize:
    label: Customize
    on: record_only
  copy:
    label: 复制 
    on: record_only
  showDesign: 
    label: 设计器
    on: record_only
permission_set:
  user:
    allowCreate: true
    allowDelete: true
    allowEdit: true
    allowRead: false
    modifyAllRecords: false
    viewAllRecords: false
  admin:
    allowCreate: true
    allowDelete: true
    allowEdit: true
    allowRead: false
    modifyAllRecords: true
    viewAllRecords: true