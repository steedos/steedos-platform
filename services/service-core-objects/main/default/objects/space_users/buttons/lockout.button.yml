name: lockout
label: Lockout
'on': record_only
type: amis_button
amis_schema: |-
  {
    "type": "service",
    "body": [{
      "type": "service",
      "api": {
        "url": "/service/api/space_users/is_lockout",
        "method": "post",
        "requestAdaptor": "api.data={suId: context.recordId}\n\n\nreturn api;",
        "adaptor": ""
      },
      "body": [
        {
          "type": "button",
          "label": "锁定",
          "id": "u:lockout",
          "confirmText": "确定要锁定此用户吗?",
          "onEvent": {
            "click": {
              "weight": 0,
              "actions": [
                {
                  "actionType": "ajax",
                  "api": {
                    "url": "/service/api/space_users/lockout",
                    "method": "post",
                    "requestAdaptor": "api.data={suId: context.recordId}\n\n\nreturn api;",
                    "adaptor": "",
                    "messages": {
                      "success": "用户已锁定",
                      "failed": "用户锁定失败,请稍后再试"
                    }
                  }
                },
                {
                  "actionType": "broadcast",
                  "args": {
                    "eventName": "@data.changed.space_users"
                  },
                  "data": {
                    "objectName": "space_users",
                    "displayAs": "${displayAs}"
                  }
                },
                {
                  "actionType": "refresh"
                }
              ]
            }
          },
          "visibleOn": "context.user.is_space_admin == true && invite_state != 'refused' && invite_state != 'pending'  && context.user.spaceUserId != context.recordId && lockout != true"
        }
      ],
      "regions": [
        "body"
      ],
      "bodyClassName": "p-0",
      "id": "u:6d7a34bd662e",
      "dsType": "api"
    }]
  }